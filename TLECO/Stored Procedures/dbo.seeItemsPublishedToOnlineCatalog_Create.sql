SET QUOTED_IDENTIFIER OFF
GO
SET ANSI_NULLS ON
GO
 CREATE PROCEDURE [dbo].[seeItemsPublishedToOnlineCatalog_Create] @iLanguageID int   as   set nocount on   declare @sqldropstring varchar(400),   @sqlstring1 varchar(8000),   @sqlstring2 varchar(8000),   @sqlstring3 varchar(8000),   @sqlstring4 varchar(8000),   @sqlstring5 varchar(8000),   @sqlstring6 varchar(8000),   @sqlstring7 varchar(8000),   @sqlstring8 varchar(8000),   @sqlstring9 varchar(8000),   @sqlstring10 varchar(8000),   @sqljoinstring varchar(8000),   @sqlaccessstring varchar(2000),   @tNumberSegments int,   @tSegment int,   @I_iDictID int,   @I_iLangID int,   @I_iMessageNumber int,   @I_iAliasMessageNumber int,   @I_iIntegerValue int,  @Item_Number varchar(255), @Item_Number_For_DrillBack varchar(255)  select @I_iDictID = 1493 select @I_iMessageNumber = 23100 select @I_iAliasMessageNumber = 0 exec DYNAMICS..smGetBIMsgStringForProcs  @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @Item_Number output   select @I_iDictID = 1493 select @I_iMessageNumber = 23100 select @I_iAliasMessageNumber = 22214 exec DYNAMICS..smGetBIMsgStringForProcs  @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @Item_Number_For_DrillBack output    select @sqldropstring =   'IF EXISTS (SELECT * FROM   sys.objects WHERE  object_id = OBJECT_ID(N''[dbo].[seeItemsPublishedToOnlineCatalog]'') AND type in ( N''P'', N''PC'' ))  ' +   '  DROP PROCEDURE [dbo].[seeItemsPublishedToOnlineCatalog]  '   select @sqlstring1 =   'CREATE Procedure [dbo].[seeItemsPublishedToOnlineCatalog] '+   '    @ItemNumberStart varchar(31) = null, '+   '    @ItemNumberEnd varchar(31) = null '+   'As  '+   'SELECT iv1.ITEMNMBR as ItemNumber, iv1.ITEMDESC as ItemDesc, i.['+@Item_Number_For_DrillBack+'], SUM(QTYONHND - ATYALLOC) as QtyAvail '+   'FROM IV00101 iv1 '+   'INNER JOIN IV00102 iv2 ON iv1.ITEMNMBR = iv2.ITEMNMBR AND iv2.LOCNCODE <> ''''  '+   'INNER JOIN Items i on iv1.ITEMNMBR = i.['+@Item_Number+'] '+   'WHERE  '+   ' (ITEMTYPE = 1 OR  '+   ' ITEMTYPE = 2 AND '+   '     INCLUDEINDP = 1) AND  '+   ' iv1.ITEMNMBR >=  CASE WHEN @ItemNumberStart is null THEN iv1.ITEMNMBR ELSE @ItemNumberStart END AND '+   ' iv1.ITEMNMBR <= CASE WHEN @ItemNumberEnd is null THEN iv1.ITEMNMBR ELSE @ItemNumberEnd END '+   'GROUP BY iv1.ITEMNMBR, iv1.ITEMDESC, i.['+@Item_Number_For_DrillBack+'] '+   'ORDER BY QtyAvail DESC '   select @sqlaccessstring =   'GRANT execute ON [dbo].[seeItemsPublishedToOnlineCatalog] TO [rpt_accounting manager],[rpt_operations manager] '   exec (@sqldropstring)   exec (@sqlstring1+' '+@sqlstring2+' '+@sqlstring3+' '+@sqlstring4+' '+@sqlstring5+' '+@sqlstring6+' '+@sqlstring7+' '+@sqlstring8+' '+@sqlstring9+' '+@sqlstring10)   exec (@sqlaccessstring)   set nocount off    
GO
GRANT EXECUTE ON  [dbo].[seeItemsPublishedToOnlineCatalog_Create] TO [DYNGRP]
GO
