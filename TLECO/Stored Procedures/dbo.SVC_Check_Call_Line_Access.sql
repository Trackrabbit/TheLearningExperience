SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO
 CREATE Procedure [dbo].[SVC_Check_Call_Line_Access] (  @Delete tinyint,  @USERID char(15),  @SRVRECTYPE smallint,  @CALLNBR char(11),  @LineType char(3),  @Lineseq integer,  @Error tinyint OUTPUT,  @OtherUser char(15) OUTPUT ) As declare @ErrNum int declare @ErrMsg char(255)  select @Error = 0,@OtherUser = '' if @Delete = 1  BEGIN  if @Lineseq = 0  delete SVC00205 where SRVRECTYPE = @SRVRECTYPE and  SVC_Document_Number = @CALLNBR and USERID = @USERID    else  delete SVC00205 where SRVRECTYPE = @SRVRECTYPE and  SVC_Document_Number = @CALLNBR and LNITMSEQ = @Lineseq and LINITMTYP = @LineType and USERID = @USERID return END if @LineType = ''   begin  select @OtherUser = USERID from SVC00205 where SRVRECTYPE = @SRVRECTYPE and SVC_Document_Number = @CALLNBR and USERID <> @USERID  if @OtherUser > '' select @Error = 1  end if @Lineseq = 0 return select @OtherUser = USERID from SVC00205 where SRVRECTYPE = @SRVRECTYPE and  SVC_Document_Number = @CALLNBR and LNITMSEQ = @Lineseq and LINITMTYP = @LineType and USERID <> @USERID if @OtherUser > ''  select @Error = 1 else  BEGIN  exec SVC_Check_Call_Billing @USERID, @SRVRECTYPE, @CALLNBR, @ErrNum output , @ErrMsg output  if @ErrNum > 0 begin select @Error = 1   select  @OtherUser = USERID from SVC00215 where SRVRECTYPE = @SRVRECTYPE and CALLNBR = @CALLNBR  and MKDTOPST = 1 and USERID <> @USERID  return end     if exists(select * from SVC00205 where SRVRECTYPE = @SRVRECTYPE and  SVC_Document_Number = @CALLNBR and LNITMSEQ = @Lineseq and LINITMTYP = @LineType and USERID = @USERID) return  insert SVC00205 select   @SRVRECTYPE,@Lineseq,@LineType,'',@USERID,  convert(char(10),getdate(),101),convert(char(10),getdate(),108),1, @CALLNBR  END return     
GO
GRANT EXECUTE ON  [dbo].[SVC_Check_Call_Line_Access] TO [DYNGRP]
GO
