SET QUOTED_IDENTIFIER OFF
GO
SET ANSI_NULLS ON
GO
 create procedure [dbo].[seeChangeInExpensesDetail]  @UserDate datetime = NULL,  @TimeUnit char(10) = 'Period',  @AccountCategory int   = 9999  as  declare  @CurrentBalance numeric(19,5),  @LastYearBalance numeric(19,5),  @PreviousBalance numeric(19,5),  @CategoryDescription varchar(51)  create table #Expenses (  CurrentBalance Numeric(19,5),  LastYearBalance Numeric(19,5),  Variance Numeric(19,5),  CategoryNumber Int,  CategoryDescription varchar(51) )  SELECT  @CurrentBalance = sum(CurrentBalance),  @PreviousBalance = sum(PreviousBalance),  @LastYearBalance = sum(LastYearBalance) FROM  (SELECT * FROM GetGLAcctCatBalanceKPI(@UserDate, @TimeUnit, 'NetChange', 33)) s1  select @CategoryDescription = ACCATDSC from GL00102 where ACCATNUM = 33  if @TimeUnit = 'Year'  set @LastYearBalance = @PreviousBalance INSERT INTO #Expenses SELECT  @CurrentBalance,  @LastYearBalance,  (@CurrentBalance - @LastYearBalance),  33,  @CategoryDescription  SELECT  @CurrentBalance = sum(CurrentBalance),  @PreviousBalance = sum(PreviousBalance),  @LastYearBalance = sum(LastYearBalance) FROM  (SELECT * FROM GetGLAcctCatBalanceKPI(@UserDate, @TimeUnit, 'NetChange', 34)) s1  select @CategoryDescription = ACCATDSC from GL00102 where ACCATNUM = 34  if @TimeUnit = 'Year'  set @LastYearBalance = @PreviousBalance INSERT INTO #Expenses SELECT  @CurrentBalance,  @LastYearBalance,  (@CurrentBalance - @LastYearBalance),  34,  @CategoryDescription SELECT  @CurrentBalance = sum(CurrentBalance),  @PreviousBalance = sum(PreviousBalance),  @LastYearBalance = sum(LastYearBalance) FROM  (SELECT * FROM GetGLAcctCatBalanceKPI(@UserDate, @TimeUnit, 'NetChange', 35)) s1  select @CategoryDescription = ACCATDSC from GL00102 where ACCATNUM = 35  if @TimeUnit = 'Year'  set @LastYearBalance = @PreviousBalance INSERT INTO #Expenses SELECT  @CurrentBalance,  @LastYearBalance,  (@CurrentBalance - @LastYearBalance),  35,  @CategoryDescription  SELECT  @CurrentBalance = sum(CurrentBalance),  @PreviousBalance = sum(PreviousBalance),  @LastYearBalance = sum(LastYearBalance) FROM  (SELECT * FROM GetGLAcctCatBalanceKPI(@UserDate, @TimeUnit, 'NetChange', 36)) s1  select @CategoryDescription = ACCATDSC from GL00102 where ACCATNUM = 36  if @TimeUnit = 'Year'  set @LastYearBalance = @PreviousBalance INSERT INTO #Expenses SELECT  @CurrentBalance,  @LastYearBalance,  (@CurrentBalance - @LastYearBalance),  36,  @CategoryDescription  SELECT  @CurrentBalance = sum(CurrentBalance),  @PreviousBalance = sum(PreviousBalance),  @LastYearBalance = sum(LastYearBalance) FROM  (SELECT * FROM GetGLAcctCatBalanceKPI(@UserDate, @TimeUnit, 'NetChange', 37)) s1  select @CategoryDescription = ACCATDSC from GL00102 where ACCATNUM = 37  if @TimeUnit = 'Year'  set @LastYearBalance = @PreviousBalance INSERT INTO #Expenses SELECT  @CurrentBalance,  @LastYearBalance,  (@CurrentBalance - @LastYearBalance),  37,  @CategoryDescription  SELECT  @CurrentBalance = sum(CurrentBalance),  @PreviousBalance = sum(PreviousBalance),  @LastYearBalance = sum(LastYearBalance) FROM  (SELECT * FROM GetGLAcctCatBalanceKPI(@UserDate, @TimeUnit, 'NetChange', 38)) s1  select @CategoryDescription = ACCATDSC from GL00102 where ACCATNUM = 38  if @TimeUnit = 'Year'  set @LastYearBalance = @PreviousBalance INSERT INTO #Expenses SELECT  @CurrentBalance,  @LastYearBalance,  (@CurrentBalance - @LastYearBalance),  38,  @CategoryDescription  SELECT  @CurrentBalance = sum(CurrentBalance),  @PreviousBalance = sum(PreviousBalance),  @LastYearBalance = sum(LastYearBalance) FROM  (SELECT * FROM GetGLAcctCatBalanceKPI(@UserDate, @TimeUnit, 'NetChange', 39)) s1  select @CategoryDescription = ACCATDSC from GL00102 where ACCATNUM = 39  if @TimeUnit = 'Year'  set @LastYearBalance = @PreviousBalance INSERT INTO #Expenses SELECT  @CurrentBalance,  @LastYearBalance,  (@CurrentBalance - @LastYearBalance),  39,  @CategoryDescription  SELECT  @CurrentBalance = sum(CurrentBalance),  @PreviousBalance = sum(PreviousBalance),  @LastYearBalance = sum(LastYearBalance) FROM  (SELECT * FROM GetGLAcctCatBalanceKPI(@UserDate, @TimeUnit, 'NetChange', 40)) s1  select @CategoryDescription = ACCATDSC from GL00102 where ACCATNUM = 40  if @TimeUnit = 'Year'  set @LastYearBalance = @PreviousBalance INSERT INTO #Expenses SELECT  @CurrentBalance,  @LastYearBalance,  (@CurrentBalance - @LastYearBalance),  40,  @CategoryDescription  SELECT  @CurrentBalance = sum(CurrentBalance),  @PreviousBalance = sum(PreviousBalance),  @LastYearBalance = sum(LastYearBalance) FROM  (SELECT * FROM GetGLAcctCatBalanceKPI(@UserDate, @TimeUnit, 'NetChange', 41)) s1  select @CategoryDescription = ACCATDSC from GL00102 where ACCATNUM = 41  if @TimeUnit = 'Year'  set @LastYearBalance = @PreviousBalance INSERT INTO #Expenses SELECT  @CurrentBalance,  @LastYearBalance,  (@CurrentBalance - @LastYearBalance),  41,  @CategoryDescription  SELECT  @CurrentBalance = sum(CurrentBalance),  @PreviousBalance = sum(PreviousBalance),  @LastYearBalance = sum(LastYearBalance) FROM  (SELECT * FROM GetGLAcctCatBalanceKPI(@UserDate, @TimeUnit, 'NetChange', 42)) s1  select @CategoryDescription = ACCATDSC from GL00102 where ACCATNUM = 42  if @TimeUnit = 'Year'  set @LastYearBalance = @PreviousBalance INSERT INTO #Expenses SELECT  @CurrentBalance,  @LastYearBalance,  (@CurrentBalance - @LastYearBalance),  42,  @CategoryDescription  SELECT  @CurrentBalance = sum(CurrentBalance),  @PreviousBalance = sum(PreviousBalance),  @LastYearBalance = sum(LastYearBalance) FROM  (SELECT * FROM GetGLAcctCatBalanceKPI(@UserDate, @TimeUnit, 'NetChange', 47)) s1  select @CategoryDescription = ACCATDSC from GL00102 where ACCATNUM = 47  if @TimeUnit = 'Year'  set @LastYearBalance = @PreviousBalance INSERT INTO #Expenses SELECT  @CurrentBalance,  @LastYearBalance,  (@CurrentBalance - @LastYearBalance),  47,  @CategoryDescription  SELECT  @CurrentBalance = sum(CurrentBalance),  @PreviousBalance = sum(PreviousBalance),  @LastYearBalance = sum(LastYearBalance) FROM  (SELECT * FROM GetGLAcctCatBalanceKPI(@UserDate, @TimeUnit, 'NetChange', 46)) s1  select @CategoryDescription = ACCATDSC from GL00102 where ACCATNUM = 46  if @TimeUnit = 'Year'  set @LastYearBalance = @PreviousBalance  INSERT INTO #Expenses SELECT  @CurrentBalance,  @LastYearBalance,  (@CurrentBalance - @LastYearBalance),  46,  @CategoryDescription   if @AccountCategory = 9999    select CategoryNumber, RTRIM(CategoryDescription) as CategoryDescription, Variance, LastYearBalance, CurrentBalance   from #Expenses with (noLock)  order by Variance desc else  select CategoryNumber, RTRIM(CategoryDescription) as CategoryDescription, Variance, LastYearBalance, CurrentBalance   from #Expenses with (noLock)   where CategoryNumber = @AccountCategory   order by Variance desc   
GO
GRANT EXECUTE ON  [dbo].[seeChangeInExpensesDetail] TO [DYNGRP]
GO
GRANT EXECUTE ON  [dbo].[seeChangeInExpensesDetail] TO [rpt_accounting manager]
GO
GRANT EXECUTE ON  [dbo].[seeChangeInExpensesDetail] TO [rpt_bookkeeper]
GO
GRANT EXECUTE ON  [dbo].[seeChangeInExpensesDetail] TO [rpt_certified accountant]
GO
GRANT EXECUTE ON  [dbo].[seeChangeInExpensesDetail] TO [rpt_executive]
GO
