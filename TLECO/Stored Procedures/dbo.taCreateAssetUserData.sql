SET QUOTED_IDENTIFIER OFF
GO
SET ANSI_NULLS ON
GO
 create procedure [dbo].[taCreateAssetUserData]  @I_vASSETID char(15),     @I_vASSETIDSUF  smallint = 1,    @I_vUSRFIELD1 char(6)= null,     @I_vUSRFIELD2 char(6)= null,      @I_vUSRFIELD3 char(10) = null,   @I_vUSRFIELD4  char(10) = null,    @I_vUSRFIELD5 char(20) = null,    @I_vUSRFIELD6   char(20) = null,    @I_vUSRFIELD7   char(20) = null,    @I_vUSRFIELD8   char(20) = null,    @I_vUSRFIELD9   char(40) = null,    @I_vUSRFIELD10  char(40) = null,    @I_vUSRFIELD11  numeric(19,5) = null,   @I_vUSRFIELD12  numeric(19,5) = null,   @I_vUSRFIELD13  numeric(19,5) = null,   @I_vUSRFIELD14  numeric(19,5) = null,   @I_vUSRFIELD15  numeric(19,5) = null,   @I_vUpdateIfExists tinyint = 1,    @I_vRequesterTrx smallint = 0,    @I_vUSRDEFND1 char(50) = '',        @I_vUSRDEFND2 char(50) = '',        @I_vUSRDEFND3 char(50) = '',        @I_vUSRDEFND4 varchar(8000) = '',   @I_vUSRDEFND5 varchar(8000) = '',   @O_iErrorState int output,    @oErrString varchar(255) output     with encryption as  set transaction isolation level read uncommitted set nocount on  declare  @ASSETINDEX int,     @LASTMNTDDATE datetime,     @LASTMNTDTIME datetime,     @LASTMNTDUSERID char,     @sCompanyID int,  @iStatus int,  @iCustomState int,  @iCustomErrString varchar(255),  @nNextNoteIndex int,     @iGetNextNoteIdxErrState int,    @iAddCodeErrState int,  @O_oErrorState int,  @iError int      select  @ASSETINDEX = 0 ,     @LASTMNTDDATE = '',   @LASTMNTDTIME = '',   @LASTMNTDUSERID = '',   @O_iErrorState = 0,     @sCompanyID = CMPANYID from DYNAMICS..SY01500 where INTERID = db_name()  if (@oErrString is NULL) begin  select @oErrString = '' end  exec @iStatus = taCreateAssetUserDataPre  @I_vASSETID output,  @I_vASSETIDSUF  output,  @I_vUSRFIELD1 output,  @I_vUSRFIELD2 output,  @I_vUSRFIELD3 output,  @I_vUSRFIELD4  output,  @I_vUSRFIELD5 output,  @I_vUSRFIELD6   output,  @I_vUSRFIELD7   output,  @I_vUSRFIELD8   output,  @I_vUSRFIELD9   output,  @I_vUSRFIELD10  output,  @I_vUSRFIELD11  output,  @I_vUSRFIELD12  output,  @I_vUSRFIELD13  output,  @I_vUSRFIELD14  output,  @I_vUSRFIELD15  output,  @I_vUpdateIfExists output,  @I_vRequesterTrx output,  @I_vUSRDEFND1 output,  @I_vUSRDEFND2 output,  @I_vUSRDEFND3 output,  @I_vUSRDEFND4 output,  @I_vUSRDEFND5 output,  @O_iErrorState = @iCustomState output,  @oErrString = @oErrString  output select @iError = @@error if @iStatus = 0 and @iError <> 0 begin  select @iStatus = @iError end if (@iStatus <> 0) or (@iCustomState <> 0) begin  select @O_iErrorState = 7138    exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output  return (@O_iErrorState) end  if (  @I_vASSETID is NULL or  @I_vUpdateIfExists is NULL or  @I_vRequesterTrx is NULL or  @I_vUSRDEFND1 is NULL or  @I_vUSRDEFND2 is NULL or  @I_vUSRDEFND3 is NULL or  @I_vUSRDEFND4 is NULL or  @I_vUSRDEFND5 is NULL   ) begin  select @O_iErrorState = 7139    exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @iAddCodeErrState output end  select @I_vASSETID =UPPER(@I_vASSETID)  if ( @I_vASSETID = '' ) begin  select @O_iErrorState = 7140    exec @iStatus = taUpdateString   @O_iErrorState,  @oErrString,  @oErrString output,  @iAddCodeErrState output end  if ( @I_vASSETIDSUF < 1 or @I_vASSETIDSUF > 999 )  begin   select @O_iErrorState = 7026    exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @iAddCodeErrState output end  if ( @I_vASSETID <> '' ) begin  if (not exists(select 1 from FA00100 (nolock) where ASSETID = @I_vASSETID and ASSETIDSUF = @I_vASSETIDSUF))  begin  select @O_iErrorState = 7141    exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @iAddCodeErrState output  end end  select @ASSETINDEX = ASSETINDEX from FA00100 (nolock) where ASSETID = @I_vASSETID and ASSETIDSUF = @I_vASSETIDSUF  if ( @I_vUpdateIfExists < 0 or @I_vUpdateIfExists > 1 ) begin  select @O_iErrorState = 7142     exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @iAddCodeErrState output end  if ( @I_vRequesterTrx < 0 or @I_vRequesterTrx > 1 ) begin  select @O_iErrorState = 7143     exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @iAddCodeErrState output end  exec @iStatus = DYNAMICS..tasmGetNextNoteIndex  @I_sCompanyID   = @sCompanyID,  @I_iSQLSessionID = 0,  @I_noteincrement  = 1,  @O_mNoteIndex   = @nNextNoteIndex output,  @O_iErrorState  = @iGetNextNoteIdxErrState output select @iError = @@error if ((@iStatus <> 0) or (@iGetNextNoteIdxErrState <> 0) or (@iError <> 0)) begin  select @oErrString = rtrim(@oErrString) + ' ' + ltrim(rtrim(@iGetNextNoteIdxErrState))  select @O_iErrorState = 7144   exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output end  if @O_iErrorState <> 0  return (@O_iErrorState)  if not exists( select 1 from FA19900 (nolock) where ASSETINDEX = @ASSETINDEX ) begin  insert FA19900(  ASSETINDEX,   USRFIELD1,   USRFIELD2,   USRFIELD3,   USRFIELD4,   USRFIELD5,   USRFIELD6,   USRFIELD7,   USRFIELD8,   USRFIELD9,   USRFIELD10,   USRFIELD11,   USRFIELD12,   USRFIELD13,   USRFIELD14,   USRFIELD15,   NOTEINDX,   LASTMNTDDATE,   LASTMNTDTIME,   LASTMNTDUSERID  )  select  @ASSETINDEX,       case     when @I_vUSRFIELD1 is null  then ''  else @I_vUSRFIELD1  end,   case    when @I_vUSRFIELD2 is null  then ''  else @I_vUSRFIELD2  end,   case     when @I_vUSRFIELD3 is null  then ''  else @I_vUSRFIELD3   end,   case    when @I_vUSRFIELD4 is null  then ''  else @I_vUSRFIELD4  end,   case    when @I_vUSRFIELD5 is null  then ''  else @I_vUSRFIELD5  end,   case    when @I_vUSRFIELD6 is null  then ''  else @I_vUSRFIELD6   end,   case     when @I_vUSRFIELD7 is null  then ''  else @I_vUSRFIELD7   end,   case    when @I_vUSRFIELD8 is null  then ''  else @I_vUSRFIELD8  end,   case    when @I_vUSRFIELD9 is null  then ''  else @I_vUSRFIELD9  end,   case    when @I_vUSRFIELD10 is null  then ''  else @I_vUSRFIELD10  end,   case    when @I_vUSRFIELD11 is null  then 0  else @I_vUSRFIELD11  end,   case    when @I_vUSRFIELD12 is null  then 0   else @I_vUSRFIELD12  end,   case     when @I_vUSRFIELD13 is null  then 0  else @I_vUSRFIELD13  end,   case    when @I_vUSRFIELD14 is null  then 0  else @I_vUSRFIELD14  end,   case    when @I_vUSRFIELD15 is null  then 0   else @I_vUSRFIELD15  end,   @nNextNoteIndex,         @LASTMNTDDATE,           @LASTMNTDTIME,           @LASTMNTDUSERID     if @@error <> 0  begin  select @O_iErrorState = 7145    exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @iAddCodeErrState output  return (@O_iErrorState)  end  end else begin  if ( @I_vUpdateIfExists = 1 )  begin  update FA19900   set  USRFIELD1 =   case   when @I_vUSRFIELD1 is null   then USRFIELD1  else @I_vUSRFIELD1  end,  USRFIELD2 =   case   when @I_vUSRFIELD2 is null   then USRFIELD2  else @I_vUSRFIELD2  end,  USRFIELD3 =  case   when @I_vUSRFIELD3 is null   then USRFIELD3  else @I_vUSRFIELD3  end,  USRFIELD4 =  case   when @I_vUSRFIELD4 is null   then USRFIELD4  else @I_vUSRFIELD4  end,  USRFIELD5 =  case   when @I_vUSRFIELD5 is null   then USRFIELD5  else @I_vUSRFIELD5  end,  USRFIELD6 =  case   when @I_vUSRFIELD6 is null   then USRFIELD6  else @I_vUSRFIELD6  end,  USRFIELD7 =   case   when @I_vUSRFIELD7 is null   then USRFIELD7  else @I_vUSRFIELD7  end,  USRFIELD8 =   case   when @I_vUSRFIELD8 is null   then USRFIELD8  else @I_vUSRFIELD8  end,  USRFIELD9 =   case   when @I_vUSRFIELD9 is null   then USRFIELD9  else @I_vUSRFIELD9  end,  USRFIELD10 =   case   when @I_vUSRFIELD10 is null   then USRFIELD10  else @I_vUSRFIELD10  end,  USRFIELD11 =   case   when @I_vUSRFIELD11 is null   then USRFIELD11  else @I_vUSRFIELD11  end,  USRFIELD12 =   case   when @I_vUSRFIELD12 is null   then USRFIELD12  else @I_vUSRFIELD12  end,  USRFIELD13 =   case   when @I_vUSRFIELD13 is null   then USRFIELD13  else @I_vUSRFIELD13  end,  USRFIELD14 =   case   when @I_vUSRFIELD14 is null   then USRFIELD14  else @I_vUSRFIELD14  end,  USRFIELD15 =  case   when @I_vUSRFIELD15 is null   then USRFIELD15  else @I_vUSRFIELD15  end  where  ASSETINDEX = @ASSETINDEX  if @@error <> 0  begin  select @O_iErrorState = 7146    exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @iAddCodeErrState output  return (@O_iErrorState)  end  end end  exec @iStatus = taCreateAssetUserDataPost  @I_vASSETID ,  @I_vASSETIDSUF  ,  @I_vUSRFIELD1 ,  @I_vUSRFIELD2 ,  @I_vUSRFIELD3 ,  @I_vUSRFIELD4  ,  @I_vUSRFIELD5 ,  @I_vUSRFIELD6   ,  @I_vUSRFIELD7   ,  @I_vUSRFIELD8   ,  @I_vUSRFIELD9   ,  @I_vUSRFIELD10  ,  @I_vUSRFIELD11  ,  @I_vUSRFIELD12  ,  @I_vUSRFIELD13  ,  @I_vUSRFIELD14  ,  @I_vUSRFIELD15  ,  @I_vUpdateIfExists ,  @I_vRequesterTrx,  @I_vUSRDEFND1,  @I_vUSRDEFND2,  @I_vUSRDEFND3,  @I_vUSRDEFND4,  @I_vUSRDEFND5,  @O_iErrorState = @iCustomState output,  @oErrString = @oErrString  output select @iError = @@error if @iStatus = 0 and @iError <> 0 begin  select @iStatus = @iError end if (@iStatus <> 0) or (@iCustomState <> 0) begin  select @O_iErrorState = 7147    exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output  return (@O_iErrorState) end  return (@O_iErrorState)   
GO
GRANT EXECUTE ON  [dbo].[taCreateAssetUserData] TO [DYNGRP]
GO
