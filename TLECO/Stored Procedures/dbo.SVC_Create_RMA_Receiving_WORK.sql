SET QUOTED_IDENTIFIER OFF
GO
SET ANSI_NULLS ON
GO
 CREATE PROCEDURE [dbo].[SVC_Create_RMA_Receiving_WORK]  (@USERID char(15),  @RMA char(15),  @Customer char(15),  @Item char(31),  @Office char(11),  @Tech char(11),  @Type smallint,  @Error integer OUTPUT)  AS delete from SVC05015 where USERID = @USERID IF @Type = 0 BEGIN   if (select count(*) from SVC00200) > 1   insert into SVC05015   SELECT @USERID,SVC05200.RETDOCID, SVC05200.LNSEQNBR,   case when IV00101.ITEMTYPE = 3 then 30 else SVC05200.RMA_Status end  ,  isnull(SVC00200.TECHID,''),   SVC05200.RETTYPE, isnull(SVC05200.OFFID,''),   SVC05200.CUSTNMBR, SVC05200.ADRSCODE,   SVC05200.CUSTNAME, SVC05200.QUANTITY, isnull(SVC05200.ITEMNMBR,''),   isnull(SVC05200.Return_Item_Number,''),  isnull(SVC05200.QUANTITY,0),   isnull(SVC05200.Return_Location_Code,''),   case when SVC05200.CUSTOWN = 1 then '1' else '0' end,  isnull(SVC05200.ORDDOCID,''),   isnull(SVC05200.CALLNBR,''),  isnull(SVC05200.RETREF,''), 0,  case when ITMTRKOP > 1 then 1 else 0 end,  0,0,0,'','',SOPTYPE, SOPNUMBE,SVC05200.UOFM,SVC05200.Return_U_Of_M, SVC05200.DECPLQTY  FROM SVC05200 LEFT JOIN  SVC00200 WITH (NOLOCK) ON (SVC05200.CALLNBR = SVC00200.CALLNBR and SVC05200.SRVRECTYPE = SVC00200.SRVRECTYPE)  Left join IV00101 on (SVC05200.Return_Item_Number = IV00101.ITEMNMBR)  WHERE SVC05200.Received = 0 and SVC05200.QUANTITY > 0 and SVC05200.svcRMAComponentSeq = 0  else  insert into SVC05015   SELECT @USERID,SVC05200.RETDOCID, SVC05200.LNSEQNBR,   case when IV00101.ITEMTYPE = 3 then 30 else SVC05200.RMA_Status end  ,  '',   SVC05200.RETTYPE, isnull(SVC05200.OFFID,''),   SVC05200.CUSTNMBR, SVC05200.ADRSCODE,   SVC05200.CUSTNAME, SVC05200.QUANTITY, isnull(SVC05200.ITEMNMBR,''),   isnull(SVC05200.Return_Item_Number,''),  isnull(SVC05200.QUANTITY,0),   isnull(SVC05200.Return_Location_Code,''),   case when SVC05200.CUSTOWN = 1 then '1' else '0' end,  isnull(SVC05200.ORDDOCID,''),   isnull(SVC05200.CALLNBR,''),  isnull(SVC05200.RETREF,''), 0,  case when ITMTRKOP > 1 then 1 else 0 end,  0,0,0,'','',SOPTYPE, SOPNUMBE, SVC05200.UOFM,SVC05200.Return_U_Of_M, SVC05200.DECPLQTY  FROM SVC05200 Left join IV00101 on (SVC05200.Return_Item_Number = IV00101.ITEMNMBR)  WHERE SVC05200.Received = 0 and SVC05200.QUANTITY > 0 and SVC05200.svcRMAComponentSeq = 0 END ELSE IF @Type = 1 BEGIN  insert into SVC05015   SELECT @USERID,SVC05200.RETDOCID, SVC05200.LNSEQNBR,   case when IV00101.ITEMTYPE = 3 then 30 else SVC05200.RMA_Status end ,  isnull(SVC00200.TECHID,''),   SVC05200.RETTYPE, isnull(SVC05200.OFFID,''),   SVC05200.CUSTNMBR, SVC05200.ADRSCODE,   SVC05200.CUSTNAME, SVC05200.QUANTITY, isnull(SVC05200.ITEMNMBR,''),   isnull(SVC05200.Return_Item_Number,''),  isnull(SVC05200.QUANTITY,0),   isnull(SVC05200.Return_Location_Code,''),   case when SVC05200.CUSTOWN = 1 then '1' else '0' end,  isnull(SVC05200.ORDDOCID,''),   isnull(SVC05200.CALLNBR,''),  isnull(SVC05200.RETREF,''), 0,  case when ITMTRKOP > 1 then 1 else 0 end,  0,0,0,'','',SOPTYPE, SOPNUMBE, SVC05200.UOFM,SVC05200.Return_U_Of_M, SVC05200.DECPLQTY FROM SVC05200 LEFT JOIN  SVC00200 WITH (NOLOCK) ON (SVC05200.CALLNBR = SVC00200.CALLNBR and SVC05200.SRVRECTYPE = SVC00200.SRVRECTYPE)  Left join IV00101 on (SVC05200.Return_Item_Number = IV00101.ITEMNMBR) WHERE SVC05200.Received = 0 and SVC05200.QUANTITY > 0 AND SVC05200.RETDOCID = @RMA and SVC05200.svcRMAComponentSeq = 0 END ELSE IF @Type = 2 BEGIN  insert into SVC05015   SELECT @USERID,SVC05200.RETDOCID, SVC05200.LNSEQNBR,   case when IV00101.ITEMTYPE = 3 then 30 else SVC05200.RMA_Status end ,  isnull(SVC00200.TECHID,''),   SVC05200.RETTYPE, isnull(SVC05200.OFFID,''),   SVC05200.CUSTNMBR, SVC05200.ADRSCODE,   SVC05200.CUSTNAME, SVC05200.QUANTITY, isnull(SVC05200.ITEMNMBR,''),   isnull(SVC05200.Return_Item_Number,''), isnull(SVC05200.QUANTITY,0),   isnull(SVC05200.Return_Location_Code,''),   case when SVC05200.CUSTOWN = 1 then '1' else '0' end,  isnull(SVC05200.ORDDOCID,''),   isnull(SVC05200.CALLNBR,''),  isnull(SVC05200.RETREF,''), 0,  case when ITMTRKOP > 1 then 1 else 0 end,  0,0,0,'','',SOPTYPE, SOPNUMBE, SVC05200.UOFM,SVC05200.Return_U_Of_M, SVC05200.DECPLQTY FROM SVC05200 LEFT JOIN  SVC00200 WITH (NOLOCK) ON (SVC05200.CALLNBR = SVC00200.CALLNBR and SVC05200.SRVRECTYPE = SVC00200.SRVRECTYPE)  Left join IV00101 on (SVC05200.Return_Item_Number = IV00101.ITEMNMBR) WHERE SVC05200.Received = 0 and SVC05200.QUANTITY > 0 AND SVC05200.CUSTNMBR = @Customer and SVC05200.svcRMAComponentSeq = 0 END ELSE IF @Type = 3 BEGIN  insert into SVC05015   SELECT @USERID,SVC05200.RETDOCID, SVC05200.LNSEQNBR,   case when IV00101.ITEMTYPE = 3 then 30 else SVC05200.RMA_Status end , isnull(SVC00200.TECHID,''),   SVC05200.RETTYPE, isnull(SVC05200.OFFID,''),   SVC05200.CUSTNMBR, SVC05200.ADRSCODE,   SVC05200.CUSTNAME, SVC05200.QUANTITY, isnull(SVC05200.ITEMNMBR,''),  isnull(SVC05200.Return_Item_Number,''),  isnull(SVC05200.QUANTITY,0),   isnull(SVC05200.Return_Location_Code,''),   case when SVC05200.CUSTOWN = 1 then '1' else '0' end,  isnull(SVC05200.ORDDOCID,''),   isnull(SVC05200.CALLNBR,''),  isnull(SVC05200.RETREF,''), 0,  case when ITMTRKOP > 1 then 1 else 0 end,  0,0,0,'','',SOPTYPE, SOPNUMBE, SVC05200.UOFM,SVC05200.Return_U_Of_M, SVC05200.DECPLQTY FROM SVC05200 LEFT JOIN  SVC00200 WITH (NOLOCK) ON (SVC05200.CALLNBR = SVC00200.CALLNBR and SVC05200.SRVRECTYPE = SVC00200.SRVRECTYPE)  Left join IV00101 on (SVC05200.Return_Item_Number = IV00101.ITEMNMBR) WHERE SVC05200.Received = 0 and SVC05200.QUANTITY > 0 AND SVC05200.ITEMNMBR = @Item and SVC05200.svcRMAComponentSeq = 0 END ELSE IF @Type = 4 BEGIN  insert into SVC05015   SELECT @USERID,SVC05200.RETDOCID, SVC05200.LNSEQNBR,   case when IV00101.ITEMTYPE = 3 then 30 else SVC05200.RMA_Status end , isnull(SVC00200.TECHID,''),   SVC05200.RETTYPE, isnull(SVC05200.OFFID,''),   SVC05200.CUSTNMBR, SVC05200.ADRSCODE,   SVC05200.CUSTNAME, SVC05200.QUANTITY, isnull(SVC05200.ITEMNMBR,''),   isnull(SVC05200.Return_Item_Number,''),  isnull(SVC05200.QUANTITY,0),   isnull(SVC05200.Return_Location_Code,''),   case when SVC05200.CUSTOWN = 1 then '1' else '0' end,  isnull(SVC05200.ORDDOCID,''),   isnull(SVC05200.CALLNBR,''),  isnull(SVC05200.RETREF,''), 0,  case when ITMTRKOP > 1 then 1 else 0 end,  0,0,0,'','',SOPTYPE, SOPNUMBE, SVC05200.UOFM,SVC05200.Return_U_Of_M, SVC05200.DECPLQTY FROM SVC05200 LEFT JOIN  SVC00200 WITH (NOLOCK) ON (SVC05200.CALLNBR = SVC00200.CALLNBR and SVC05200.SRVRECTYPE = SVC00200.SRVRECTYPE)  Left join IV00101 on (SVC05200.Return_Item_Number = IV00101.ITEMNMBR) WHERE SVC05200.Received = 0 and SVC05200.QUANTITY > 0 AND SVC05200.OFFID = @Office and SVC05200.svcRMAComponentSeq = 0 END ELSE IF @Type = 5 BEGIN  insert into SVC05015   SELECT @USERID,SVC05200.RETDOCID, SVC05200.LNSEQNBR,   case when IV00101.ITEMTYPE = 3 then 30 else SVC05200.RMA_Status end , isnull(SVC00200.TECHID,''),   SVC05200.RETTYPE, isnull(SVC05200.OFFID,''),   SVC05200.CUSTNMBR, SVC05200.ADRSCODE,   SVC05200.CUSTNAME, SVC05200.QUANTITY, isnull(SVC05200.ITEMNMBR,''),   isnull(SVC05200.Return_Item_Number,''),  isnull(SVC05200.QUANTITY,0),   isnull(SVC05200.Return_Location_Code,''),   case when SVC05200.CUSTOWN = 1 then '1' else '0' end,  isnull(SVC05200.ORDDOCID,''),   isnull(SVC05200.CALLNBR,''),  isnull(SVC05200.RETREF,''), 0,  case when ITMTRKOP > 1 then 1 else 0 end,  0,0,0,'','',SOPTYPE, SOPNUMBE, SVC05200.UOFM,SVC05200.Return_U_Of_M, SVC05200.DECPLQTY FROM SVC05200 LEFT JOIN  SVC00200 WITH (NOLOCK) ON (SVC05200.CALLNBR = SVC00200.CALLNBR and SVC05200.SRVRECTYPE = SVC00200.SRVRECTYPE)  Left join IV00101 on (SVC05200.Return_Item_Number = IV00101.ITEMNMBR) WHERE SVC05200.Received = 0 and SVC05200.QUANTITY > 0 AND SVC00200.TECHID = @Tech and SVC05200.svcRMAComponentSeq = 0  UNION  SELECT @USERID,SVC05200.RETDOCID, SVC05200.LNSEQNBR,   case when IV00101.ITEMTYPE = 3 then 30 else SVC05200.RMA_Status end , isnull(SVC30200.TECHID,''),   SVC05200.RETTYPE, isnull(SVC05200.OFFID,''),   SVC05200.CUSTNMBR, SVC05200.ADRSCODE,   SVC05200.CUSTNAME, SVC05200.QUANTITY, isnull(SVC05200.ITEMNMBR,''),   isnull(SVC05200.Return_Item_Number,''),  isnull(SVC05200.QUANTITY,0),   isnull(SVC05200.Return_Location_Code,''),   case when SVC05200.CUSTOWN = 1 then '1' else '0' end,  isnull(SVC05200.ORDDOCID,''),   isnull(SVC05200.CALLNBR,''),  isnull(SVC05200.RETREF,''), 0,  case when ITMTRKOP > 1 then 1 else 0 end,  0,0,0,'','',SOPTYPE, SOPNUMBE, SVC05200.UOFM,SVC05200.Return_U_Of_M, SVC05200.DECPLQTY FROM SVC05200 LEFT JOIN  SVC30200 WITH (NOLOCK) ON (SVC05200.CALLNBR = SVC30200.CALLNBR and SVC05200.SRVRECTYPE = SVC30200.SRVRECTYPE)  Left join IV00101 on (SVC05200.Return_Item_Number = IV00101.ITEMNMBR) WHERE SVC05200.Received = 0 and SVC05200.QUANTITY > 0 AND SVC30200.TECHID = @Tech and SVC05200.svcRMAComponentSeq = 0  END  return    
GO
GRANT EXECUTE ON  [dbo].[SVC_Create_RMA_Receiving_WORK] TO [DYNGRP]
GO
