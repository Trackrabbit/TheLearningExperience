SET QUOTED_IDENTIFIER OFF
GO
SET ANSI_NULLS ON
GO
 create procedure [dbo].[taCreateEmployeeAddress] @I_vEMPLOYID char(15),    @I_vADRSCODE char(15),    @I_vADDRESS1 char(60) = '',   @I_vADDRESS2 char(60)= '',   @I_vADDRESS3 char(60)= '',   @I_vCITY char(35)= '',    @I_vSTATE char(29)= '',    @I_vZIPCODE char(10)= '',   @I_vCOUNTY char(60)= '',   @I_vCOUNTRY char(60)= '',   @I_vPHONE1 char(21)= '',   @I_vPHONE2 char(21)= '',   @I_vPHONE3 char(21)= '',   @I_vFAX char(21)= '',    @I_vForeign_Address tinyint=0,   @I_vForeign_StateProvince char(23)='',  @I_vForeign_Postal_Code char(15)='',  @I_vCCode char(6)='',    @I_vUpdateIfExists tinyint=1,   @I_vRequesterTrx smallint = 0,   @I_vUSRDEFND1 char(50) = '',       @I_vUSRDEFND2 char(50) = '',       @I_vUSRDEFND3 char(50) = '',       @I_vUSRDEFND4 varchar(8000) = '',  @I_vUSRDEFND5 varchar(8000) = '',  @O_iErrorState int output,   @oErrString varchar(255) output    with encryption as  set transaction isolation level read uncommitted set nocount on  declare  @iStatus int,  @iAddCodeErrState int,  @iStatement int,  @iCustomState int,  @iCustomErrString varchar(255),  @O_oErrorState int,  @iError int     select  @iStatus = 0,  @iAddCodeErrState = 0,  @O_oErrorState = 0,  @iStatement = 0,  @O_iErrorState = 0    if (@oErrString is NULL) begin  select @oErrString = '' end  exec @iStatus = taCreateEmployeeAddressPre  @I_vEMPLOYID output,  @I_vADRSCODE output,  @I_vADDRESS1 output,  @I_vADDRESS2 output,  @I_vADDRESS3 output,  @I_vCITY output,  @I_vSTATE output,  @I_vZIPCODE output,  @I_vCOUNTY output,  @I_vCOUNTRY output,  @I_vPHONE1 output,  @I_vPHONE2 output,  @I_vPHONE3 output,  @I_vFAX output,  @I_vForeign_Address output,  @I_vForeign_StateProvince output,  @I_vForeign_Postal_Code output,  @I_vCCode output,  @I_vUpdateIfExists output,  @I_vRequesterTrx output,  @I_vUSRDEFND1 output,  @I_vUSRDEFND2 output,  @I_vUSRDEFND3 output,  @I_vUSRDEFND4 output,  @I_vUSRDEFND5 output,  @O_iErrorState = @iCustomState output,  @oErrString = @oErrString  output select @iError = @@error if @iStatus = 0 and @iError <> 0 begin  select @iStatus = @iError end if (@iStatus <> 0) or (@iCustomState <> 0) begin  select @O_iErrorState = 4501    exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output  return (@O_iErrorState) end  if (  @I_vEMPLOYID is NULL or  @I_vADRSCODE is NULL or  @I_vADDRESS1 is NULL or  @I_vADDRESS2 is NULL or  @I_vADDRESS3 is NULL or  @I_vCITY is NULL or  @I_vSTATE is NULL or  @I_vZIPCODE is NULL or  @I_vCOUNTY is NULL or  @I_vCOUNTRY is NULL or  @I_vPHONE1 is NULL or  @I_vPHONE2 is NULL or  @I_vPHONE3 is NULL or  @I_vFAX is NULL or  @I_vForeign_Address is NULL or  @I_vForeign_StateProvince is NULL or  @I_vForeign_Postal_Code is NULL or  @I_vCCode is NULL  ) begin  select @O_iErrorState = 4502    exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @iAddCodeErrState output end  select @I_vEMPLOYID =UPPER(@I_vEMPLOYID),  @I_vADRSCODE =UPPER(@I_vADRSCODE),  @I_vCCode=UPPER(@I_vCCode)  if ( @I_vEMPLOYID = '' ) begin  select @O_iErrorState = 4503    exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @iAddCodeErrState output end  if ( @I_vADRSCODE = '' ) begin  select @O_iErrorState = 4504    exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @iAddCodeErrState output end  if ( @I_vEMPLOYID <> '' ) begin  if (not exists (select 1 from UPR00100 (nolock) where EMPLOYID = @I_vEMPLOYID ))  begin  select @O_iErrorState = 4505    exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @iAddCodeErrState output  end end  if ( @I_vForeign_Address < 0 or @I_vForeign_Address > 1 ) begin  select @O_iErrorState = 4506     exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @iAddCodeErrState output end  if ( @I_vUpdateIfExists < 0 or @I_vUpdateIfExists > 1)  begin  select @O_iErrorState = 3679     exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @iAddCodeErrState output end  if ( @I_vRequesterTrx < 0 or @I_vRequesterTrx > 1)  begin  select @O_iErrorState = 3680     exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @iAddCodeErrState output end  if (exists (select 1 from UPR00102 (nolock) where EMPLOYID = @I_vEMPLOYID and ADRSCODE = @I_vADRSCODE)) and (@I_vUpdateIfExists = 0) begin  select @O_iErrorState = 20199     exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output end  if @O_iErrorState <> 0  return (@O_iErrorState)  if (not exists (select 1 from UPR00102 (nolock) where EMPLOYID = @I_vEMPLOYID and ADRSCODE = @I_vADRSCODE)) begin  insert into UPR00102 (  EMPLOYID,  ADRSCODE,  ADDRESS1,  ADDRESS2,  ADDRESS3,  CITY,  STATE,  ZIPCODE,  COUNTY,  COUNTRY,  PHONE1,  PHONE2,  PHONE3,  FAX,  Foreign_Address,  Foreign_StateProvince,  Foreign_Postal_Code,  CCode )  select  @I_vEMPLOYID,     @I_vADRSCODE,     @I_vADDRESS1,     @I_vADDRESS2,     @I_vADDRESS3,     @I_vCITY,     @I_vSTATE,     @I_vZIPCODE,     @I_vCOUNTY,     @I_vCOUNTRY,     @I_vPHONE1,     @I_vPHONE2,     @I_vPHONE3,     @I_vFAX,     @I_vForeign_Address,    @I_vForeign_StateProvince,   @I_vForeign_Postal_Code,   @I_vCCode      if (@@error <> 0)  begin  select @O_iErrorState = 4507    exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @iAddCodeErrState output  end end else if ( @I_vUpdateIfExists = 1 ) begin  update UPR00102 set  ADDRESS1 = @I_vADDRESS1,  ADDRESS2 = @I_vADDRESS2,  ADDRESS3 = @I_vADDRESS3,  CITY = @I_vCITY,  STATE = @I_vSTATE,  ZIPCODE = @I_vZIPCODE,  COUNTY = @I_vCOUNTY,  COUNTRY = @I_vCOUNTRY,  PHONE1 = @I_vPHONE1,  PHONE2 = @I_vPHONE2,  PHONE3 = @I_vPHONE3,  FAX = @I_vFAX,  Foreign_Address = @I_vForeign_Address,  Foreign_StateProvince = @I_vForeign_StateProvince,  Foreign_Postal_Code = @I_vForeign_Postal_Code,  CCode = @I_vCCode  where EMPLOYID = @I_vEMPLOYID and ADRSCODE = @I_vADRSCODE  if (@@error <> 0)  begin  select @O_iErrorState = 4508    exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @iAddCodeErrState output  end end  exec @iStatus = taCreateEmployeeAddressPost  @I_vEMPLOYID,  @I_vADRSCODE,  @I_vADDRESS1,  @I_vADDRESS2,  @I_vADDRESS3,  @I_vCITY,  @I_vSTATE,  @I_vZIPCODE,  @I_vCOUNTY,  @I_vCOUNTRY,  @I_vPHONE1,  @I_vPHONE2,  @I_vPHONE3,  @I_vFAX,  @I_vForeign_Address,  @I_vForeign_StateProvince,  @I_vForeign_Postal_Code,  @I_vCCode,  @I_vUpdateIfExists ,  @I_vRequesterTrx,  @I_vUSRDEFND1,  @I_vUSRDEFND2,  @I_vUSRDEFND3,  @I_vUSRDEFND4,  @I_vUSRDEFND5,  @O_iErrorState = @iCustomState output,  @oErrString = @oErrString  output select @iError = @@error if @iStatus = 0 and @iError <> 0 begin  select @iStatus = @iError end if (@iStatus <> 0) or (@iCustomState <> 0) begin  select @O_iErrorState = 4509    exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output  return (@O_iErrorState) end  return (@O_iErrorState)   
GO
GRANT EXECUTE ON  [dbo].[taCreateEmployeeAddress] TO [DYNGRP]
GO
