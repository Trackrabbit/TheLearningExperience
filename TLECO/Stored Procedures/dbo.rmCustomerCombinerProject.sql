SET QUOTED_IDENTIFIER OFF
GO
SET ANSI_NULLS ON
GO
 create procedure [dbo].[rmCustomerCombinerProject]   @I_charStartCustomer  char(30),   @I_charEndCustomer  char(30),   @cStartCustomer char(50),  @cEndCustomer char(50),  @O_iErrorState   int = NULL  output  as  set transaction isolation level read uncommitted set nocount on  declare   @AGPERAMT_1   numeric (19,5),  @AGPERAMT_2   numeric (19,5),  @AGPERAMT_3   numeric (19,5),  @AGPERAMT_4   numeric (19,5),  @AGPERAMT_5   numeric (19,5),  @AGPERAMT_6   numeric (19,5),  @AGPERAMT_7   numeric (19,5),  @PA_Unpaid_Amount  numeric (19,5),  @AGPERAMT_1_2 numeric (19,5),  @AGPERAMT_2_2   numeric (19,5),  @AGPERAMT_3_2 numeric (19,5),  @AGPERAMT_4_2   numeric (19,5),  @AGPERAMT_5_2   numeric (19,5),  @AGPERAMT_6_2   numeric (19,5),  @AGPERAMT_7_2   numeric (19,5),  @PA_Unpaid_Amount_2  numeric (19,5),  @LASTAGED   datetime,  @AGE1    numeric (19,5),  @AGE2    numeric (19,5),  @AGE3    numeric (19,5),  @AGE4    numeric (19,5),  @AGE5    numeric (19,5),  @AGE6    numeric (19,5),  @AGE7    numeric (19,5),  @PAACREV   numeric (19,5),  @AGE1_2   numeric (19,5),  @AGE2_2   numeric (19,5),  @AGE3_2   numeric (19,5),  @AGE4_2   numeric (19,5),  @AGE5_2   numeric (19,5),  @AGE6_2   numeric (19,5),  @AGE7_2   numeric (19,5),   @PAACREV_2   numeric (19,5),  @LASTAGE   datetime,  @iStatus   int,  @tLoop tinyint,  @tTransaction tinyint  exec @iStatus = smFormatStringsForExecs  @I_vInputString  = @I_charStartCustomer,  @O_cOutputString = @cStartCustomer output,  @O_iErrorState  = @O_iErrorState output  if @iStatus <> 0 or @O_iErrorState <> 0 begin  set @O_iErrorState = 1  return end  exec @iStatus = smFormatStringsForExecs  @I_vInputString  = @I_charEndCustomer,  @O_cOutputString = @cEndCustomer output,  @O_iErrorState  = @O_iErrorState output  if @iStatus <> 0 or @O_iErrorState <> 0 begin  set @O_iErrorState = 2  return end  select  @O_iErrorState   = 0  if @@trancount = 0  begin  select @tTransaction = 1  begin transaction end  while ( @tLoop is NULL ) begin  select @tLoop = 1   if @I_charStartCustomer is NULL or  @I_charEndCustomer is NULL or  @cStartCustomer is NULL or  @cEndCustomer is NULL  begin  select @O_iErrorState = 127   break  end    CREATE TABLE dbo.#tmpPA00511 (  YEAR1 smallint NOT NULL,  PERIODID smallint NOT NULL,  PABQuantity numeric(19, 5) NOT NULL,  PABProfit numeric(19, 5) NOT NULL,  PABBillings numeric(19, 5) NOT NULL,  PABTaxPaidAmt numeric(19, 5) NOT NULL,  PABTaxChargedAmt numeric(19, 5) NOT NULL,  PABaselineOvhdCost numeric(19, 5) NOT NULL,  PAFQuantity numeric(19, 5) NOT NULL,  PAFProfit numeric(19, 5) NOT NULL,  PAFBillings numeric(19, 5) NOT NULL,  PAFTaxPaidAmt numeric(19, 5) NOT NULL,  PAFTaxChargedAmt numeric(19, 5) NOT NULL,  PAForecastOvhdCost numeric(19, 5) NOT NULL,  PA_Earnings numeric(19, 5) NOT NULL,  PA_Cost_of_Earnings numeric(19, 5) NOT NULL,  PAUnpostedQty numeric(19, 5) NOT NULL,  PAPostedQty numeric(19, 5) NOT NULL,  PAUnpostedProfitN numeric(19, 5) NOT NULL,  PAPostedProfitN numeric(19, 5) NOT NULL,  PAUnpostAccrRevN numeric(19, 5) NOT NULL,  PAPosted_Accr_RevN numeric(19, 5) NOT NULL,  PAUnpostedTotalCostN numeric(19, 5) NOT NULL,  PAPostedTotalCostN numeric(19, 5) NOT NULL,  PAUnposted_Overhead numeric(19, 5) NOT NULL,  PAPosted_Overhead numeric(19, 5) NOT NULL,  PAUnpostBillN numeric(19, 5) NOT NULL,  PAPostedBillingsN numeric(19, 5) NOT NULL,  PAUnposted_Fee_Amount numeric(19, 5) NOT NULL,  PAPosted_Fee_Amount numeric(19, 5) NOT NULL,  PAUnpostedRecogRevN numeric(19, 5) NOT NULL,  PAPostRecogRevN numeric(19, 5) NOT NULL,  PAUNPEIEBAMOUNT numeric(19, 5) NOT NULL,  PAPOSEIEBAMOUNT numeric(19, 5) NOT NULL,  PAUNPOSTBIEEAMOUNT numeric(19, 5) NOT NULL,  PAPOSBIEEAMOUNT numeric(19, 5) NOT NULL,  PAWrite_UpDown_Amount numeric(19, 5) NOT NULL,  PAUnposted_Retainer_Fee numeric(19, 5) NOT NULL,  PA_Unposted_Billed_Reten numeric(19, 5) NOT NULL,  PAUNPOSTRETAMT numeric(19, 5) NOT NULL,  PAUnposted_Service_Fee numeric(19, 5) NOT NULL,  PAUnposted_Project_Fee numeric(19, 5) NOT NULL,  PA_Actual_Billed_Retenti numeric(19, 5) NOT NULL,  PAPosted_Project_Fee numeric(19, 5) NOT NULL,  PAPosted_Retainer_Fee numeric(19, 5) NOT NULL,  PAPOSTRETAMT numeric(19, 5) NOT NULL,  PAPosted_Service_Fee numeric(19, 5) NOT NULL,  PA_Receipts_Amount numeric(19, 5) NOT NULL,  PA_Actual_Receipts_Amoun numeric(19,5) NOT NULL,   PAFeeAmount numeric(19, 5) NOT NULL,  WROFAMNT numeric(19, 5) NOT NULL,  ActualWriteOffAmount numeric (19,5) NOT NULL,   DISTKNAM numeric(19, 5) NOT NULL,  ActualDiscTakenAmount numeric (19,5) NOT NULL,   PABTotalCost numeric(19, 5) NOT NULL,  PAFTotalCost numeric(19, 5) NOT NULL,  PAUnposted_Sales_Tax_Am numeric(19, 5) NOT NULL,  PAPosted_Sales_Tax_Amou numeric(19, 5) NOT NULL,  PACostPcntCompleted numeric(19, 5) NOT NULL,  PAQuantityPcntCompleted numeric(19, 5) NOT NULL,  PACommitted_Costs numeric(19, 5) NOT NULL,  PACommitted_Qty numeric(19, 5) NOT NULL,  PAPOPostedCost numeric(19, 5) NOT NULL,  PAPOPostedQty numeric(19, 5) NOT NULL,  PAPOCost numeric(19, 5) NOT NULL,  PAPOQty numeric(19, 5) NOT NULL,  PAUnposted_Tax_Amount numeric(19, 5) NOT NULL,  PAPosted_Tax_Amount numeric(19, 5) NOT NULL,  PAtaxpaidamt numeric(19, 5) NOT NULL,  PAPostedTaxPaidN numeric(19,5) NOT NULL,   PAPostedDiscDolAmtN numeric(19, 5) NOT NULL,  PAUnpostDiscDolAmtN numeric(19, 5) NOT NULL,  PABilled_Accrued_Revenu numeric(19, 5) NOT NULL,  PABilled_QtyN numeric(19, 5) NOT NULL,  PAApproved_Accrued_Reve numeric(19, 5) NOT NULL,  PAApproved_Quantity numeric(19, 5) NOT NULL,  PApretainage numeric(19, 5) NOT NULL,  PAunpretainage numeric(19, 5) NOT NULL,  PA_Actual_Freight_Amount numeric(19, 5) NOT NULL,  PA_Unposted_Freight_Amou numeric(19, 5) NOT NULL,  PA_Actual_Misc_Amount numeric(19, 5) NOT NULL,  PA_Unposted_Misc_Amount numeric(19, 5) NOT NULL,  PA_Write_Off_Tax_Amount numeric(19, 5) NOT NULL,  PAActualWOTaxAmt numeric (19,5) NOT NULL,   PA_Terms_Taken_Tax_Amt numeric(19, 5) NOT NULL,  PAActualTermsTakenTax int  )   update PA01901 set PACOSTOWNER = @I_charEndCustomer where PACOSTOWNER = @I_charStartCustomer and (PATranType = 7 or PATranType = 10)  if @@error <> 0   begin  select @O_iErrorState = 83   break  end   update PA01901 set CUSTNMBR = @I_charEndCustomer where CUSTNMBR = @I_charStartCustomer and (PATranType = 7 or PATranType = 10)  if @@error <> 0   begin  select @O_iErrorState = 116   break  end   update PA43001 set PArecordid = @I_charEndCustomer where PArecordid = @I_charStartCustomer and (PAsfid = 21 or PAsfid = 36)  and cast(PAsfid as varchar)+PAcosttrxid+cast(PAaccttype as varchar)  not in(select cast(PAsfid as varchar)+PAcosttrxid+cast(PAaccttype as varchar) from PA43001 (nolock) where PArecordid = @I_charEndCustomer)  if @@error <> 0   begin  select @O_iErrorState = 89   break  end   delete PA43001 where PArecordid = @I_charStartCustomer and (PAsfid = 21 or PAsfid = 36)  if @@error <> 0   begin  select @O_iErrorState = 90   break  end   select   @AGPERAMT_1 = AGPERAMT_1,  @AGPERAMT_2 = AGPERAMT_2,  @AGPERAMT_3 = AGPERAMT_3,  @AGPERAMT_4 = AGPERAMT_4,  @AGPERAMT_5 = AGPERAMT_5,  @AGPERAMT_6 = AGPERAMT_6,  @AGPERAMT_7 = AGPERAMT_7,  @PA_Unpaid_Amount = PA_Unpaid_Amount from PA00521  where CUSTNMBR = @I_charStartCustomer  if @@error <> 0   begin  select @O_iErrorState = 120   break  end   select   @AGPERAMT_1_2 = AGPERAMT_1,  @AGPERAMT_2_2 = AGPERAMT_2,  @AGPERAMT_3_2 = AGPERAMT_3,  @AGPERAMT_4_2 = AGPERAMT_4,  @AGPERAMT_5_2 = AGPERAMT_5,  @AGPERAMT_6_2 = AGPERAMT_6,  @AGPERAMT_7_2 = AGPERAMT_7,  @PA_Unpaid_Amount_2 = PA_Unpaid_Amount,  @LASTAGED = LASTAGED from PA00521  where CUSTNMBR = @I_charEndCustomer  if @@error <> 0  begin  select @O_iErrorState = 121   break  end   update PA00521 set   AGPERAMT_1 = @AGPERAMT_1 + @AGPERAMT_1_2,   AGPERAMT_2 = @AGPERAMT_2 + @AGPERAMT_2_2,  AGPERAMT_3 = @AGPERAMT_3 + @AGPERAMT_3_2,  AGPERAMT_4 = @AGPERAMT_4 + @AGPERAMT_4_2,  AGPERAMT_5 = @AGPERAMT_5 + @AGPERAMT_5_2,  AGPERAMT_6 = @AGPERAMT_6 + @AGPERAMT_6_2,  AGPERAMT_7 = @AGPERAMT_7 + @AGPERAMT_7_2,  PA_Unpaid_Amount = @PA_Unpaid_Amount + @PA_Unpaid_Amount_2,  LASTAGED = @LASTAGED   where CUSTNMBR = @I_charEndCustomer  if @@error <> 0  begin  select @O_iErrorState = 122   break  end   select   @AGE1 = AGPERAMT_1,  @AGE2 = AGPERAMT_2,  @AGE3 = AGPERAMT_3,  @AGE4 = AGPERAMT_4,  @AGE5 = AGPERAMT_5,  @AGE6 = AGPERAMT_6,  @AGE7 = AGPERAMT_7,  @PAACREV = PAACREV from PA00531  where CUSTNMBR = @I_charStartCustomer  if @@error <> 0  begin  select @O_iErrorState = 124   break  end   select   @AGE1_2 = AGPERAMT_1,  @AGE2_2 = AGPERAMT_2,  @AGE3_2 = AGPERAMT_3,  @AGE4_2 = AGPERAMT_4,  @AGE5_2 = AGPERAMT_5,  @AGE6_2 = AGPERAMT_6,  @AGE7_2 = AGPERAMT_7,  @LASTAGE = LASTAGED,   @PAACREV_2 = PAACREV from PA00531  where CUSTNMBR = @I_charStartCustomer  if @@error <> 0  begin  select @O_iErrorState = 125   break  end   update PA00531 set   AGPERAMT_1 = @AGE1 + @AGE1_2,   AGPERAMT_2 = @AGE2 + @AGE2_2,  AGPERAMT_3 = @AGE3 + @AGE3_2,  AGPERAMT_4 = @AGE4 + @AGE4_2,  AGPERAMT_5 = @AGE5 + @AGE5_2,  AGPERAMT_6 = @AGE6 + @AGE6_2,  AGPERAMT_7 = @AGE7 + @AGE7_2,  PAACREV = @PAACREV + @PAACREV_2,  LASTAGED = @LASTAGE   where CUSTNMBR = @I_charEndCustomer  if @@error <> 0   begin  select @O_iErrorState = 126   break  end   update PA00532 set CUSTNMBR = @I_charEndCustomer where CUSTNMBR = @I_charStartCustomer  and not exists(select CUSTNMBR from PA00532 where CUSTNMBR = @I_charEndCustomer)  if (@@error<>0)  begin  select @O_iErrorState = 60   return  end   update i2 set  PA_Aging_Period_WIP_Amt_1 = (i.PA_Aging_Period_WIP_Amt_1 + i2.PA_Aging_Period_WIP_Amt_1),  PA_Aging_Period_WIP_Amt_2 = (i.PA_Aging_Period_WIP_Amt_2 + i2.PA_Aging_Period_WIP_Amt_2),  PA_Aging_Period_WIP_Amt_3 = (i.PA_Aging_Period_WIP_Amt_3 + i2.PA_Aging_Period_WIP_Amt_3),  PA_Aging_Period_WIP_Amt_4 = (i.PA_Aging_Period_WIP_Amt_4 + i2.PA_Aging_Period_WIP_Amt_4),  PA_Aging_Period_WIP_Amt_5 = (i.PA_Aging_Period_WIP_Amt_5 + i2.PA_Aging_Period_WIP_Amt_5),  PA_Aging_Period_WIP_Amt_6 = (i.PA_Aging_Period_WIP_Amt_6 + i2.PA_Aging_Period_WIP_Amt_6),  PA_Aging_Period_WIP_Amt_7 = (i.PA_Aging_Period_WIP_Amt_7 + i2.PA_Aging_Period_WIP_Amt_7),  PATOTCST = (i.PATOTCST + i2.PATOTCST)  from PA00532 i, PA00532 i2  where   i.CUSTNMBR = @I_charStartCustomer and  i2.CUSTNMBR = @I_charEndCustomer  if (@@error<>0)  begin  select @O_iErrorState = 61   return  end   insert into #tmpPA00511  select YEAR1, PERIODID, isnull(sum(PABQuantity),0),isnull(sum(PABProfit),0),isnull(sum(PABBillings),0),  isnull(sum(PABTaxPaidAmt),0),isnull(sum(PABTaxChargedAmt),0),isnull(sum(PABaselineOvhdCost),0),isnull(sum(PAFQuantity),0),  isnull(sum(PAFProfit),0),isnull(sum(PAFBillings),0), isnull(sum(PAFTaxPaidAmt),0),isnull(sum(PAFTaxChargedAmt),0),  isnull(sum(PAForecastOvhdCost),0),isnull(sum(PA_Earnings),0),isnull(sum(PA_Cost_of_Earnings),0),isnull(sum(PAUnpostedQty),0),  isnull(sum(PAPostedQty),0),isnull(sum(PAUnpostedProfitN),0),isnull(sum(PAPostedProfitN),0),isnull(sum(PAUnpostAccrRevN),0),  isnull(sum(PAPosted_Accr_RevN),0),isnull(sum(PAUnpostedTotalCostN),0),isnull(sum(PAPostedTotalCostN),0),isnull(sum(PAUnposted_Overhead),0),  isnull(sum(PAPosted_Overhead),0),isnull(sum(PAUnpostBillN),0),isnull(sum(PAPostedBillingsN),0),isnull(sum(PAUnposted_Fee_Amount),0),  isnull(sum(PAPosted_Fee_Amount),0),isnull(sum(PAUnpostedRecogRevN),0),isnull(sum(PAPostRecogRevN),0),isnull(sum(PAUNPEIEBAMOUNT),0),  isnull(sum(PAPOSEIEBAMOUNT),0),isnull(sum(PAUNPOSTBIEEAMOUNT),0),isnull(sum(PAPOSBIEEAMOUNT),0),isnull(sum(PAWrite_UpDown_Amount),0),  isnull(sum(PAUnposted_Retainer_Fee),0),isnull(sum(PA_Unposted_Billed_Reten),0),isnull(sum(PAUNPOSTRETAMT),0),isnull(sum(PAUnposted_Service_Fee),0),  isnull(sum(PAUnposted_Project_Fee),0),isnull(sum(PA_Actual_Billed_Retenti),0),isnull(sum(PAPosted_Project_Fee),0),isnull(sum(PAPosted_Retainer_Fee),0),  isnull(sum(PAPOSTRETAMT),0),isnull(sum(PAPosted_Service_Fee),0),isnull(sum(PA_Receipts_Amount),0),isnull(sum(PA_Actual_Receipts_Amoun),0),isnull(sum(PAFeeAmount),0),  isnull(sum(WROFAMNT),0),isnull(sum(ActualWriteOffAmount),0),isnull(sum(DISTKNAM),0),isnull(sum(ActualDiscTakenAmount),0),isnull(sum(PABTotalCost),0),isnull(sum(PAFTotalCost),0),  isnull(sum(PAUnposted_Sales_Tax_Am),0),isnull(sum(PAPosted_Sales_Tax_Amou),0),isnull(sum(PACostPcntCompleted),0),isnull(sum(PAQuantityPcntCompleted),0),  isnull(sum(PACommitted_Costs),0),isnull(sum(PACommitted_Qty),0),isnull(sum(PAPOPostedCost),0),isnull(sum(PAPOPostedQty),0),  isnull(sum(PAPOCost),0),isnull(sum(PAPOQty),0),isnull(sum(PAUnposted_Tax_Amount),0),isnull(sum(PAPosted_Tax_Amount),0),  isnull(sum(PAtaxpaidamt),0),isnull(sum(PAPostedTaxPaidN),0),isnull(sum(PAPostedDiscDolAmtN),0),isnull(sum(PAUnpostDiscDolAmtN),0),isnull(sum(PABilled_Accrued_Revenu),0),  isnull(sum(PABilled_QtyN),0),isnull(sum(PAApproved_Accrued_Reve),0),isnull(sum(PAApproved_Quantity),0),isnull(sum(PApretainage),0),  isnull(sum(PAunpretainage),0),isnull(sum(PA_Actual_Freight_Amount),0),isnull(sum(PA_Unposted_Freight_Amou),0),isnull(sum(PA_Actual_Misc_Amount),0),  isnull(sum(PA_Unposted_Misc_Amount),0),isnull(sum(PA_Write_Off_Tax_Amount),0),isnull(sum(PAActualWOTaxAmt),0),isnull(sum(PA_Terms_Taken_Tax_Amt),0),  isnull(sum(PAActualTermsTakenTax),0)  from PA00511 where CUSTNMBR = @I_charStartCustomer or CUSTNMBR = @I_charEndCustomer  group by YEAR1, PERIODID  if @@error <> 0   begin  select @O_iErrorState = 112   break  end   update a set CUSTNMBR = @I_charEndCustomer  from PA00511 a where a.CUSTNMBR = @I_charStartCustomer  and str(a.YEAR1)+str(a.PERIODID) not in (select str(YEAR1)+str(PERIODID) from PA00511 where CUSTNMBR = @I_charEndCustomer)  if @@error <> 0   begin  select @O_iErrorState = 113   break  end   update a set  a.PABQuantity = b.PABQuantity,  a.PABProfit = b.PABProfit,  a.PABBillings = b.PABBillings,  a.PABTaxPaidAmt = b.PABTaxPaidAmt ,  a.PABTaxChargedAmt = b.PABTaxChargedAmt ,  a.PABaselineOvhdCost = b.PABaselineOvhdCost,  a.PAFQuantity = b.PAFQuantity,  a.PAFProfit = b.PAFProfit,  a.PAFBillings = b.PAFBillings,  a.PAFTaxPaidAmt = b.PAFTaxPaidAmt,  a.PAFTaxChargedAmt = b.PAFTaxChargedAmt,  a.PAForecastOvhdCost = b.PAForecastOvhdCost,  a.PA_Earnings = b.PA_Earnings,  a.PA_Cost_of_Earnings = b.PA_Cost_of_Earnings,  a.PAUnpostedQty = b.PAUnpostedQty,  a.PAPostedQty = b.PAPostedQty,  a.PAUnpostedProfitN = b.PAUnpostedProfitN,  a.PAPostedProfitN = b.PAPostedProfitN,  a.PAUnpostAccrRevN = b.PAUnpostAccrRevN,  a.PAPosted_Accr_RevN = b.PAPosted_Accr_RevN,  a.PAUnpostedTotalCostN = b.PAUnpostedTotalCostN,  a.PAPostedTotalCostN = b.PAPostedTotalCostN,  a.PAUnposted_Overhead = b.PAUnposted_Overhead,  a.PAPosted_Overhead = b.PAPosted_Overhead,  a.PAUnpostBillN = b.PAUnpostBillN,  a.PAPostedBillingsN = b.PAPostedBillingsN,  a.PAUnposted_Fee_Amount = b.PAUnposted_Fee_Amount,  a.PAPosted_Fee_Amount = b.PAPosted_Fee_Amount,  a.PAUnpostedRecogRevN = b.PAUnpostedRecogRevN,  a.PAPostRecogRevN = b.PAPostRecogRevN,  a.PAUNPEIEBAMOUNT = b.PAUNPEIEBAMOUNT,  a.PAPOSEIEBAMOUNT = b.PAPOSEIEBAMOUNT,  a.PAUNPOSTBIEEAMOUNT = b.PAUNPOSTBIEEAMOUNT,  a.PAPOSBIEEAMOUNT = b.PAPOSBIEEAMOUNT,  a.PAWrite_UpDown_Amount = b.PAWrite_UpDown_Amount,  a.PAUnposted_Retainer_Fee = b.PAUnposted_Retainer_Fee,  a.PA_Unposted_Billed_Reten = b.PA_Unposted_Billed_Reten,  a.PAUNPOSTRETAMT = b.PAUNPOSTRETAMT,  a.PAUnposted_Service_Fee = b.PAUnposted_Service_Fee,  a.PAUnposted_Project_Fee = b.PAUnposted_Project_Fee,  a.PA_Actual_Billed_Retenti = b.PA_Actual_Billed_Retenti,  a.PAPosted_Project_Fee = b.PAPosted_Project_Fee,  a.PAPosted_Retainer_Fee = b.PAPosted_Retainer_Fee,  a.PAPOSTRETAMT = b.PAPOSTRETAMT,  a.PAPosted_Service_Fee = b.PAPosted_Service_Fee,  a.PA_Receipts_Amount = b.PA_Receipts_Amount,  a.PA_Actual_Receipts_Amoun = b.PA_Actual_Receipts_Amoun,  a.PAFeeAmount = b.PAFeeAmount,  a.WROFAMNT = b.WROFAMNT,  a.ActualWriteOffAmount = b.ActualWriteOffAmount,  a.DISTKNAM = b.DISTKNAM,  a.ActualDiscTakenAmount = b.ActualDiscTakenAmount,  a.PABTotalCost = b.PABTotalCost,  a.PAFTotalCost = b.PAFTotalCost,  a.PAUnposted_Sales_Tax_Am = b.PAUnposted_Sales_Tax_Am,  a.PAPosted_Sales_Tax_Amou = b.PAPosted_Sales_Tax_Amou,  a.PACostPcntCompleted = b.PACostPcntCompleted,  a.PAQuantityPcntCompleted = b.PAQuantityPcntCompleted,  a.PACommitted_Costs = b.PACommitted_Costs,  a.PACommitted_Qty = b.PACommitted_Qty,  a.PAPOPostedCost = b.PAPOPostedCost,  a.PAPOPostedQty = b.PAPOPostedQty,  a.PAPOCost = b.PAPOCost,  a.PAPOQty = b.PAPOQty,  a.PAUnposted_Tax_Amount = b.PAUnposted_Tax_Amount,  a.PAPosted_Tax_Amount = b.PAPosted_Tax_Amount,  a.PAtaxpaidamt = b.PAtaxpaidamt,  a.PAPostedTaxPaidN = b.PAPostedTaxPaidN,  a.PAPostedDiscDolAmtN = b.PAPostedDiscDolAmtN,  a.PAUnpostDiscDolAmtN = b.PAUnpostDiscDolAmtN,  a.PABilled_Accrued_Revenu = b.PABilled_Accrued_Revenu,  a.PABilled_QtyN = b.PABilled_QtyN,  a.PAApproved_Accrued_Reve = b.PAApproved_Accrued_Reve,  a.PAApproved_Quantity = b.PAApproved_Quantity,  a.PApretainage = b.PApretainage,  a.PAunpretainage = b.PAunpretainage,  a.PA_Actual_Freight_Amount = b.PA_Actual_Freight_Amount,  a.PA_Unposted_Freight_Amou = b.PA_Unposted_Freight_Amou,  a.PA_Actual_Misc_Amount = b.PA_Actual_Misc_Amount,  a.PA_Unposted_Misc_Amount = b.PA_Unposted_Misc_Amount,  a.PA_Write_Off_Tax_Amount = b.PA_Write_Off_Tax_Amount,  a.PAActualWOTaxAmt = b.PAActualWOTaxAmt,  a.PA_Terms_Taken_Tax_Amt = b.PA_Terms_Taken_Tax_Amt,  a.PAActualTermsTakenTax = b.PAActualTermsTakenTax  from PA00511 a, #tmpPA00511 b where a.YEAR1 = b.YEAR1 and a.PERIODID = b.PERIODID and a.CUSTNMBR = @I_charEndCustomer  if @@error <> 0   begin  select @O_iErrorState = 114   break  end   delete #tmpPA00511  if @@error <> 0   begin  select @O_iErrorState = 115   break  end   update b set  PABQuantity = a.PABQuantity + b.PABQuantity,  PABTotalCost = a.PABTotalCost + b.PABTotalCost,  PABBillings = a.PABBillings + b.PABBillings,  PABProfit = a.PABProfit + b.PABProfit,  PABTaxPaidAmt = a.PABTaxPaidAmt + b.PABTaxPaidAmt,  PABTaxChargedAmt = a.PABTaxChargedAmt + b.PABTaxChargedAmt,  PABaselineOvhdCost = a.PABaselineOvhdCost + b.PABaselineOvhdCost,  PAFQuantity = a.PAFQuantity + b.PAFQuantity,  PAFTotalCost = a.PAFTotalCost + b.PAFTotalCost,  PAFBillings = a.PAFBillings + b.PAFBillings,  PAFProfit = a.PAFProfit + b.PAFProfit,  PAFTaxPaidAmt = a.PAFTaxPaidAmt + b.PAFTaxPaidAmt,  PAFTaxChargedAmt = a.PAFTaxChargedAmt + b.PAFTaxChargedAmt,  PAForecastOvhdCost = a.PAForecastOvhdCost + b.PAForecastOvhdCost,  PAProject_Amount = a.PAProject_Amount + b.PAProject_Amount,  PAUnpostedQty = a.PAUnpostedQty + b.PAUnpostedQty,  PAUnpostedTotalCostN = a.PAUnpostedTotalCostN + b.PAUnpostedTotalCostN,  PAUnposted_Overhead = a.PAUnposted_Overhead + b.PAUnposted_Overhead,  PAUnpostedProfitN = a.PAUnpostedProfitN + b.PAUnpostedProfitN,  PAUnposted_Tax_Amount = a.PAUnposted_Tax_Amount + b.PAUnposted_Tax_Amount,  PAUnpostAccrRevN = a.PAUnpostAccrRevN + b.PAUnpostAccrRevN,  PAUnpostedCommitedQty = a.PAUnpostedCommitedQty + b.PAUnpostedCommitedQty,  PAUnpostedCommitedCost = a.PAUnpostedCommitedCost + b.PAUnpostedCommitedCost,  PAUnpostedCommitedTaxAmt = a.PAUnpostedCommitedTaxAmt + b.PAUnpostedCommitedTaxAmt,  PAUnpostedRecogRevN = a.PAUnpostedRecogRevN + b.PAUnpostedRecogRevN,  PAUnposted_Project_Fee = a.PAUnposted_Project_Fee + b.PAUnposted_Project_Fee,  PAUnposted_Retainer_Fee = a.PAUnposted_Retainer_Fee + b.PAUnposted_Retainer_Fee,  PAUnposted_Service_Fee = a.PAUnposted_Service_Fee + b.PAUnposted_Service_Fee,  PAUNPOSTRETAMT = a.PAUNPOSTRETAMT + b.PAUNPOSTRETAMT,  PA_Unposted_Billed_Reten = a.PA_Unposted_Billed_Reten + b.PA_Unposted_Billed_Reten,  PAUNPOSTBIEEAMOUNT = a.PAUNPOSTBIEEAMOUNT + b.PAUNPOSTBIEEAMOUNT,  PAUNPEIEBAMOUNT = a.PAUNPEIEBAMOUNT + b.PAUNPEIEBAMOUNT,  PAPostedQty = a.PAPostedQty + b.PAPostedQty,  PAPostedTotalCostN = a.PAPostedTotalCostN + b.PAPostedTotalCostN,  PAPosted_Overhead = a.PAPosted_Overhead + b.PAPosted_Overhead,  PAPostedProfitN = a.PAPostedProfitN + b.PAPostedProfitN,  PAPosted_Tax_Amount = a.PAPosted_Tax_Amount + b.PAPosted_Tax_Amount,  PAPosted_Accr_RevN = a.PAPosted_Accr_RevN + b.PAPosted_Accr_RevN,  PA_Actual_Billed_Retenti = a.PA_Actual_Billed_Retenti + b.PA_Actual_Billed_Retenti,  PAPostedCommitedQty = a.PAPostedCommitedQty + b.PAPostedCommitedQty,  PAPostedCommitedCost = a.PAPostedCommitedCost + b.PAPostedCommitedCost,  PAPostedCommitedTaxAmt = a.PAPostedCommitedTaxAmt + b.PAPostedCommitedTaxAmt,  PAPostRecogRevN = a.PAPostRecogRevN + b.PAPostRecogRevN,  PAPosted_Project_Fee = a.PAPosted_Project_Fee + b.PAPosted_Project_Fee,  PAPosted_Retainer_Fee = a.PAPosted_Retainer_Fee + b.PAPosted_Retainer_Fee,  PAPosted_Service_Fee = a.PAPosted_Service_Fee + b.PAPosted_Service_Fee,  PAPOSTRETAMT = a.PAPOSTRETAMT + b.PAPOSTRETAMT,  PAPOSBIEEAMOUNT = a.PAPOSBIEEAMOUNT + b.PAPOSBIEEAMOUNT,  PAPOSEIEBAMOUNT = a.PAPOSEIEBAMOUNT + b.PAPOSEIEBAMOUNT,  PAWrite_UpDown_Amount = a.PAWrite_UpDown_Amount + b.PAWrite_UpDown_Amount,  PABilled_QtyN = a.PABilled_QtyN + b.PABilled_QtyN,  PABilled_Cost = a.PABilled_Cost + b.PABilled_Cost,  PABilled_Accrued_Revenu = a.PABilled_Accrued_Revenu + b.PABilled_Accrued_Revenu,  PACostPcntCompleted = a.PACostPcntCompleted + b.PACostPcntCompleted,  PAQuantityPcntCompleted = a.PAQuantityPcntCompleted + b.PAQuantityPcntCompleted,  PA_Receipts_Amount = a.PA_Receipts_Amount + b.PA_Receipts_Amount,  PA_Actual_Receipts_Amoun = a.PA_Actual_Receipts_Amoun + b.PA_Actual_Receipts_Amoun,  PA_Earnings = a.PA_Earnings + b.PA_Earnings,  PA_Cost_of_Earnings = a.PA_Cost_of_Earnings + b.PA_Cost_of_Earnings,  PAUnpostBillN = a.PAUnpostBillN + b.PAUnpostBillN,  PAUnpostDiscDolAmtN = a.PAUnpostDiscDolAmtN + b.PAUnpostDiscDolAmtN,  PAUnposted_Sales_Tax_Am = a.PAUnposted_Sales_Tax_Am + b.PAUnposted_Sales_Tax_Am,  PAPostedBillingsN = a.PAPostedBillingsN + b.PAPostedBillingsN,  PAPostedDiscDolAmtN = a.PAPostedDiscDolAmtN + b.PAPostedDiscDolAmtN,  PAPosted_Sales_Tax_Amou = a.PAPosted_Sales_Tax_Amou + b.PAPosted_Sales_Tax_Amou,  PAService_Fee_Amount = a.PAService_Fee_Amount + b.PAService_Fee_Amount,  PARetainer_Fee_Amount = a.PARetainer_Fee_Amount + b.PARetainer_Fee_Amount,  PAProject_Fee_Amount = a.PAProject_Fee_Amount + b.PAProject_Fee_Amount,  PARetentionFeeAmount = a.PARetentionFeeAmount + b.PARetentionFeeAmount,  PABCWPAMT = a.PABCWPAMT + b.PABCWPAMT,  PABCWSAMT = a.PABCWSAMT + b.PABCWSAMT,  PAACWPAMT = a.PAACWPAMT + b.PAACWPAMT,  PAApproved_Accrued_Reve = a.PAApproved_Accrued_Reve + b.PAApproved_Accrued_Reve,  PAApproved_Cost = a.PAApproved_Cost + b.PAApproved_Cost,  PAApproved_Quantity = a.PAApproved_Quantity + b.PAApproved_Quantity,  WROFAMNT = a.WROFAMNT + b.WROFAMNT,  ActualWriteOffAmount = a.ActualWriteOffAmount + b.ActualWriteOffAmount,  DISTKNAM = a.DISTKNAM + b.DISTKNAM,  ActualDiscTakenAmount = a.ActualDiscTakenAmount + b.ActualDiscTakenAmount,  PACommitted_Costs = a.PACommitted_Costs + b.PACommitted_Costs,  PACommitted_Qty = a.PACommitted_Qty + b.PACommitted_Qty,  PAPOCost = a.PAPOCost + b.PAPOCost,  PAPOQty = a.PAPOQty + b.PAPOQty,  PAPOPostedCost = a.PAPOPostedCost + b.PAPOPostedCost,  PAPOPostedQty = a.PAPOPostedQty + b.PAPOPostedQty,  PAtaxpaidamt = a.PAtaxpaidamt + b.PAtaxpaidamt,  PAPostedTaxPaidN = a.PAPostedTaxPaidN + b.PAPostedTaxPaidN,  PApretainage = a.PApretainage + b.PApretainage,  PAunpretainage = a.PAunpretainage + b.PAunpretainage,  PA_Actual_Freight_Amount = a.PA_Actual_Freight_Amount + b.PA_Actual_Freight_Amount,  PA_Unposted_Freight_Amou = a.PA_Unposted_Freight_Amou + b.PA_Unposted_Freight_Amou,  PA_Actual_Misc_Amount = a.PA_Actual_Misc_Amount + b.PA_Actual_Misc_Amount,  PA_Unposted_Misc_Amount = a.PA_Unposted_Misc_Amount + b.PA_Unposted_Misc_Amount,  PA_Write_Off_Tax_Amount = a.PA_Write_Off_Tax_Amount + b.PA_Write_Off_Tax_Amount,  PAActualWOTaxAmt = a.PAActualWOTaxAmt + b.PAActualWOTaxAmt,  PA_Terms_Taken_Tax_Amt = a.PA_Terms_Taken_Tax_Amt + b.PA_Terms_Taken_Tax_Amt,  PAActualTermsTakenTax = a.PAActualTermsTakenTax + b.PAActualTermsTakenTax  from PA00501 a, PA00501 b where a.CUSTNMBR = @I_charStartCustomer and b.CUSTNMBR = @I_charEndCustomer  if @@error <> 0   begin  select @O_iErrorState = 59   break  end   if @O_iErrorState <> 0 begin  if @tTransaction = 1  rollback transaction end else if @tTransaction = 1 begin  commit transaction end  return end   
GO
GRANT EXECUTE ON  [dbo].[rmCustomerCombinerProject] TO [DYNGRP]
GO
