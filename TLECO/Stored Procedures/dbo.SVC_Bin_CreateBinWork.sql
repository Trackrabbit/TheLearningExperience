SET QUOTED_IDENTIFIER OFF
GO
SET ANSI_NULLS ON
GO
 Create Procedure [dbo].[SVC_Bin_CreateBinWork]  (@DocType smallint,  @RecType smallint,  @DocNumber char(20),  @Line numeric(19,5),  @Item char(30),  @FromLocation char(10),  @Location char(10),  @Bin char(15),  @ToBin char(15),  @Qty numeric(19,5),  @CMPNTSEQ int = 0  ,  @QtyType smallint = 1 ) As declare @SEQNUMBR int declare @QTYONHND numeric(19,5), @QTYRTRND numeric(19,5), @QTYINUSE numeric(19,5), @QTYINSVC numeric(19,5), @QTYDMGED numeric(19,5)   if @ToBin ='' or @ToBin is null  select @ToBin = 'AUTOCREATE'  if @DocType = 1   begin  select @SEQNUMBR = isnull(Max(SEQNUMBR),0) + 16384 from SVC00212 where   SRVRECTYPE = @RecType and CALLNBR = @DocNumber and EQPLINE = 1 and LINITMTYP = 'P' and LNITMSEQ = @Line and CMPNTSEQ = @CMPNTSEQ  insert into SVC00212 select @RecType, @DocNumber, 1, 'P', @Line, @SEQNUMBR,  @Item, @Location, @Bin, 1, @Qty, 0 ,0, @CMPNTSEQ  end else if @DocType = 2  begin  select @SEQNUMBR = isnull(Max(SEQNUMBR),0) + 16384 from SVC00712 where ORDDOCID = @DocNumber and LNITMSEQ = @Line  insert into SVC00712 select @DocNumber, @Line, @SEQNUMBR,  @Item, @FromLocation, @Location, @Bin, @ToBin, 1, @Qty, 0   end else if @DocType = 3     begin  if @QtyType > 0   begin  select @SEQNUMBR = isnull(Max(SEQNUMBR),0) + 16384 from SVC05212   where Return_Record_Type = @RecType and RETDOCID = @DocNumber and LNSEQNBR = @Line and CMPNTSEQ = @CMPNTSEQ  insert into SVC05212 select @RecType, @DocNumber, @Line, @SEQNUMBR, @Item, @Location, @Bin, @QtyType, @Qty, 0 , @CMPNTSEQ  end  else  Begin  select @QTYONHND = QTYONHND, @QTYRTRND = QTYRTRND, @QTYINUSE = QTYINUSE, @QTYINSVC = QTYINSVC, @QTYDMGED = QTYDMGED from SVC05200  where RETDOCID = @DocNumber and Return_Record_Type = @RecType and LNSEQNBR = @Line and svcRMAComponentSeq = @CMPNTSEQ   delete from SVC05212 where Return_Record_Type = @RecType and RETDOCID = @DocNumber and LNSEQNBR = @Line and CMPNTSEQ = @CMPNTSEQ and POSTED = 0  select @SEQNUMBR = isnull(Max(SEQNUMBR),0) + 16384 from SVC05212   where Return_Record_Type = @RecType and RETDOCID = @DocNumber and LNSEQNBR = @Line and CMPNTSEQ = @CMPNTSEQ  if @QTYONHND > 0   begin  insert into SVC05212 select @RecType, @DocNumber, @Line, @SEQNUMBR, @Item, @Location, @Bin, 1, @QTYONHND, 0 , @CMPNTSEQ  select @SEQNUMBR = @SEQNUMBR + 16384  end  if @QTYRTRND > 0   begin  insert into SVC05212 select @RecType, @DocNumber, @Line, @SEQNUMBR, @Item, @Location, @Bin, 2, @QTYRTRND, 0 , @CMPNTSEQ  select @SEQNUMBR = @SEQNUMBR + 16384  end  if @QTYINUSE > 0   begin  insert into SVC05212 select @RecType, @DocNumber, @Line, @SEQNUMBR, @Item, @Location, @Bin, 3, @QTYINUSE, 0 , @CMPNTSEQ  select @SEQNUMBR = @SEQNUMBR + 16384  end  if @QTYINSVC > 0   begin  insert into SVC05212 select @RecType, @DocNumber, @Line, @SEQNUMBR, @Item, @Location, @Bin, 4, @QTYINSVC, 0 , @CMPNTSEQ  select @SEQNUMBR = @SEQNUMBR + 16384  end  if @QTYDMGED > 0   begin  insert into SVC05212 select @RecType, @DocNumber, @Line, @SEQNUMBR, @Item, @Location, @Bin, 5, @QTYDMGED, 0 , @CMPNTSEQ  end  End  end else if @DocType = 4  begin  if @QtyType = 0 select @QtyType = 1  select @SEQNUMBR = isnull(Max(SEQNUMBR),0) + 16384 from SVC05612 where RTV_Number = @DocNumber and RTV_Line = @Line  insert into SVC05612 select @DocNumber, @Line, @SEQNUMBR,  @Item, @FromLocation, @Location, @Bin, @ToBin, @QtyType, @Qty, 0   end else if @DocType = 5  begin  select @SEQNUMBR = isnull(Max(SEQNUMBR),0) + 16384 from SVC06112 where   WORECTYPE = @RecType and WORKORDNUM = @DocNumber and LINITMTYP = 'P' and LNITMSEQ = @Line  insert into SVC06112 select @RecType, @DocNumber, 'P', @Line, @SEQNUMBR,  @Item, @Location, @Bin, 1, @Qty, 0 ,0, @CMPNTSEQ  end  return (0)    
GO
GRANT EXECUTE ON  [dbo].[SVC_Bin_CreateBinWork] TO [DYNGRP]
GO
