SET QUOTED_IDENTIFIER OFF
GO
SET ANSI_NULLS ON
GO
 CREATE PROCEDURE [dbo].[seeEmployeeStatusByDeptDetail_Create] @iLanguageID int   as   set nocount on   declare @sqldropstring varchar(400),   @sqlstring1 varchar(8000),   @sqlstring2 varchar(8000),   @sqlstring3 varchar(8000),   @sqlstring4 varchar(8000),   @sqlstring5 varchar(8000),   @sqlstring6 varchar(8000),   @sqlstring7 varchar(8000),   @sqlstring8 varchar(8000),   @sqlstring9 varchar(8000),   @sqlstring10 varchar(8000),   @sqljoinstring varchar(8000),   @sqlaccessstring varchar(2000),   @tNumberSegments int,   @tSegment int,   @I_iDictID int,   @I_iLangID int,   @I_iMessageNumber int,   @I_iAliasMessageNumber int,   @I_iIntegerValue int,   @Inactive varchar(255),  @Start_Date varchar(255),  @Department varchar(255),  @Employee_ID varchar(255),  @Type_of_Employment varchar(255),  @Employee_Class varchar(255),  @Division_Code varchar(255),  @Location_ID varchar(255), @Supervisor_Code varchar(255), @Last_Name varchar(255), @First_Name varchar(255), @Address_1 varchar(255), @Address_2 varchar(255), @City varchar(255), @State varchar(255), @Zip_Code varchar(255), @EmployeeID_For_DrillBack varchar(255), @HR_Status varchar(255)   select @I_iDictID = 1493 select @I_iMessageNumber = 22402 select @I_iAliasMessageNumber = 0 exec DYNAMICS..smGetBIMsgStringForProcs  @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @Inactive output   select @I_iDictID = 1493 select @I_iMessageNumber = 22425 select @I_iAliasMessageNumber = 0 exec DYNAMICS..smGetBIMsgStringForProcs  @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @Start_Date output  select @I_iDictID = 1493 select @I_iMessageNumber = 22420 select @I_iAliasMessageNumber = 0 exec DYNAMICS..smGetBIMsgStringForProcs  @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @Department output   select @I_iDictID = 1493 select @I_iMessageNumber = 22400 select @I_iAliasMessageNumber = 0 exec DYNAMICS..smGetBIMsgStringForProcs  @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @Employee_ID output   select @I_iDictID = 1493 select @I_iMessageNumber = 24344 select @I_iAliasMessageNumber = 0 exec DYNAMICS..smGetBIMsgStringForProcs  @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @Type_of_Employment output  select @I_iDictID = 1493 select @I_iMessageNumber = 22401 select @I_iAliasMessageNumber = 0 exec DYNAMICS..smGetBIMsgStringForProcs  @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @Employee_Class output   select @I_iDictID = 1493 select @I_iMessageNumber = 24328 select @I_iAliasMessageNumber = 0 exec DYNAMICS..smGetBIMsgStringForProcs  @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @Division_Code output   select @I_iDictID = 1493 select @I_iMessageNumber = 24334 select @I_iAliasMessageNumber = 0 exec DYNAMICS..smGetBIMsgStringForProcs  @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @Location_ID output   select @I_iDictID = 1493 select @I_iMessageNumber = 24343 select @I_iAliasMessageNumber = 0 exec DYNAMICS..smGetBIMsgStringForProcs  @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @Supervisor_Code output   select @I_iDictID = 1493 select @I_iMessageNumber = 22403 select @I_iAliasMessageNumber = 0 exec DYNAMICS..smGetBIMsgStringForProcs  @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @Last_Name output   select @I_iDictID = 1493 select @I_iMessageNumber = 22404 select @I_iAliasMessageNumber = 0 exec DYNAMICS..smGetBIMsgStringForProcs  @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @First_Name output   select @I_iDictID = 1493 select @I_iMessageNumber = 22406 select @I_iAliasMessageNumber = 0 exec DYNAMICS..smGetBIMsgStringForProcs  @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @Address_1 output   select @I_iDictID = 1493 select @I_iMessageNumber = 22407 select @I_iAliasMessageNumber = 0 exec DYNAMICS..smGetBIMsgStringForProcs  @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @Address_2 output   select @I_iDictID = 1493 select @I_iMessageNumber = 22409 select @I_iAliasMessageNumber = 0 exec DYNAMICS..smGetBIMsgStringForProcs  @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @City output   select @I_iDictID = 1493 select @I_iMessageNumber = 22410 select @I_iAliasMessageNumber = 0 exec DYNAMICS..smGetBIMsgStringForProcs  @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @State output   select @I_iDictID = 1493 select @I_iMessageNumber = 22412 select @I_iAliasMessageNumber = 0 exec DYNAMICS..smGetBIMsgStringForProcs  @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @Zip_Code output   select @I_iDictID = 1493 select @I_iMessageNumber = 22400 select @I_iAliasMessageNumber = 22214 exec DYNAMICS..smGetBIMsgStringForProcs  @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @EmployeeID_For_DrillBack output   select @I_iDictID = 1493 select @I_iMessageNumber = 24331 select @I_iAliasMessageNumber = 0 exec DYNAMICS..smGetBIMsgStringForProcs  @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @HR_Status output    select @sqldropstring =   'IF EXISTS (SELECT * FROM   sys.objects WHERE  object_id = OBJECT_ID(N''[dbo].[seeEmployeeStatusByDeptDetail]'') AND type in ( N''P'', N''PC'' ))  ' +   '  DROP PROCEDURE [dbo].[seeEmployeeStatusByDeptDetail]  '   select @sqlstring1 =   'CREATE  procedure [dbo].[seeEmployeeStatusByDeptDetail] @UserDate       datetime = NULL,  '+   '                                                      @Department     varchar(18) = '''',  '+   '                                                      @MaxDepartments int  '+   'as  '+   '  if @MaxDepartments > 0  '+   '     and @Department = ''''  '+   '    begin  '+   '        select a.['+@Department+'],  '+   '               a.['+@HR_Status+'],  '+   '               a.['+@Type_of_Employment+'],  '+   '               a.['+@Employee_Class+'],  '+   '               a.['+@Division_Code+'],  '+   '               a.['+@Location_ID+'],  '+   '               a.['+@Supervisor_Code+'],  '+   '               a.['+@Start_Date+'],  '+   '               a.['+@Employee_ID+'],  '+   '               a.['+@Last_Name+'],  '+   '               a.['+@First_Name+'],  '+   '               a.['+@Address_1+'],  '+   '               a.['+@Address_2+'],  '+   '               a.['+@City+'],  '+   '               a.['+@State+'],  '+   '               a.['+@Zip_Code+']  '+   '        from   Employees a,  '+   '               (select top (select @MaxDepartments)  '+   '               COUNT(['+@Employee_ID+']) as EmpCount,  '+   '               ['+@Department+']  '+   '                from   Employees  '+   '                group  by ['+@Department+']  '+   '                order  by EmpCount desc,  '+   '                          ['+@Department+']) b  '+   '        where  ( a.['+@Department+'] = b.['+@Department+'] )  '+   '               and ( a.['+@Start_Date+'] <= @UserDate  '+   '                     and a.['+@Inactive+'] = ''No'' )  '+   '    end  '+   '  else  '+   '    begin  '+   '        if @Department = ''''  '+   '          select ['+@Department+'],  '+   '                 ['+@HR_Status+'],  '+   '                 ['+@Type_of_Employment+'],  '+   '                 ['+@Employee_Class+'],  '+   '                 ['+@Division_Code+'],  '+   '                 ['+@Location_ID+'],  '+   '                 ['+@Supervisor_Code+'],  '+   '                 ['+@Start_Date+'],  '+   '                 ['+@Employee_ID+'],  '+   '                 ['+@Last_Name+'],  '+   '                 ['+@First_Name+'],  '+   '                 ['+@Address_1+'],  '+   '                 ['+@Address_2+'],  '+   '                 ['+@City+'],  '+   '                 ['+@State+'],  '+   '                 ['+@Zip_Code+'], '+   '                 ['+@EmployeeID_For_DrillBack+']  '+   '          from   Employees  '+   '          where  ( ['+@Start_Date+'] <= @UserDate  '+   '                   and ['+@Inactive+'] = ''No'' )  '+   '        else  '+   '          select ['+@Department+'],  '+   '                 ['+@HR_Status+'],  '+   '                 ['+@Type_of_Employment+'],  '+   '                 ['+@Employee_Class+'],  '+   '                 ['+@Division_Code+'],  '+   '                 ['+@Location_ID+'],  '+   '                 ['+@Supervisor_Code+'],  '+   '                 ['+@Start_Date+'],  '+   '                 ['+@Employee_ID+'],  '+   '                 ['+@Last_Name+'],  '+   '                 ['+@First_Name+'],  '+   '                 ['+@Address_1+'],  '+   '                 ['+@Address_2+'],  '+   '                 ['+@City+'],  '+   '                 ['+@State+'],  '+   '                 ['+@Zip_Code+'] , '+   '                 ['+@EmployeeID_For_DrillBack+'] '+   '          from   Employees  '+   '          where  ( ['+@Department+'] = @Department )  '+   '                 and ( ['+@Start_Date+'] <= @UserDate  '+   '                       and ['+@Inactive+'] = ''No'' )  '+   '    end  '  select @sqlaccessstring =   'GRANT execute ON [dbo].[seeEmployeeStatusByDeptDetail] TO [rpt_executive], [rpt_payroll], [rpt_human resource administrator] '   exec (@sqldropstring)   exec (@sqlstring1+' '+@sqlstring2+' '+@sqlstring3+' '+@sqlstring4+' '+@sqlstring5+' '+@sqlstring6+' '+@sqlstring7+' '+@sqlstring8+' '+@sqlstring9+' '+@sqlstring10)   exec (@sqlaccessstring)   set nocount off    
GO
GRANT EXECUTE ON  [dbo].[seeEmployeeStatusByDeptDetail_Create] TO [DYNGRP]
GO
