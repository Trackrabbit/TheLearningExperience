SET QUOTED_IDENTIFIER OFF
GO
SET ANSI_NULLS ON
GO
 CREATE PROCEDURE [dbo].[sp_HumanResources_HRPCombined] @iLanguageID int  as  set nocount on   declare @sqldropstring varchar(400),  @sqldefaultstring varchar(8000),  @sqlstring1 varchar(8000),  @sqlstring2 varchar(8000),  @sqlstring3 varchar(8000),  @sqlstring4 varchar(8000),  @sqlstring5 varchar(8000),  @sqlstring6 varchar(8000),  @sqlstring7 varchar(8000),  @sqlstring8 varchar(8000),  @sqlstring9 varchar(8000),  @sqlstring10 varchar(8000),  @sqljoinstring varchar(8000),  @sqlaccessstring varchar(1000), @tNumberSegments int,  @tSegment int,  @I_iDictID int,  @I_iLangID int,  @I_iMessageNumber int,  @I_iAliasMessageNumber int,  @I_iIntegerValue int,   @Employee_ID varchar(255), @Employee_Name varchar(255), @Time_Code varchar(255), @Pay_Code varchar(255), @Hours_Available varchar(255), @Pay_Rate_Per_Hour varchar(255), @Liability varchar(255), @Primary_Pay_Code varchar(255), @Pay_Rate varchar(255), @Pay_Unit varchar(255), @Primary_Pay_Rate varchar(255), @Time_Available varchar(255), @TRX varchar(255), @Start_Date varchar(255), @Job_Title varchar(255), @Department varchar(255), @TRX_Date varchar(255), @TRX_Ending_Date varchar(255), @Hours varchar(255), @Accrual_Flag varchar(255), @Accrue_Time_Benefits varchar(255), @Posted varchar(255), @Attendance_Type varchar(255), @Attendance_Reason varchar(255), @Pay_Rate_Amount varchar(255)  select @I_iDictID = 414 select @I_iMessageNumber = 26600 select @I_iAliasMessageNumber = 0  exec DYNAMICS..smGetBIMsgString  @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @Employee_ID output   select @I_iDictID = 0 select @I_iMessageNumber = 22051 select @I_iAliasMessageNumber = 0  exec DYNAMICS..smGetBIMsgString  @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @Employee_Name output   select @I_iDictID = 0 select @I_iMessageNumber = 22064 select @I_iAliasMessageNumber = 0  exec DYNAMICS..smGetBIMsgString  @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @Time_Code output   select @I_iDictID = 414 select @I_iMessageNumber = 00002 select @I_iAliasMessageNumber = 0  exec DYNAMICS..smGetBIMsgString  @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @Pay_Code output   select @I_iDictID = 0 select @I_iMessageNumber = 22073 select @I_iAliasMessageNumber = 0  exec DYNAMICS..smGetBIMsgString  @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @Hours_Available output   select @I_iDictID = 414 select @I_iMessageNumber = 00003 select @I_iAliasMessageNumber = 0  exec DYNAMICS..smGetBIMsgString  @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @Pay_Rate_Per_Hour output   select @I_iDictID = 414 select @I_iMessageNumber = 00004 select @I_iAliasMessageNumber = 0  exec DYNAMICS..smGetBIMsgString  @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @Liability output   select @I_iDictID = 414 select @I_iMessageNumber = 00005 select @I_iAliasMessageNumber = 0  exec DYNAMICS..smGetBIMsgString  @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @Primary_Pay_Code output   select @I_iDictID = 414 select @I_iMessageNumber = 00006 select @I_iAliasMessageNumber = 0  exec DYNAMICS..smGetBIMsgString  @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @Pay_Rate output   select @I_iDictID = 414 select @I_iMessageNumber = 00007 select @I_iAliasMessageNumber = 0  exec DYNAMICS..smGetBIMsgString  @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @Pay_Unit output   select @I_iDictID = 414 select @I_iMessageNumber = 00008 select @I_iAliasMessageNumber = 0  exec DYNAMICS..smGetBIMsgString  @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @Primary_Pay_Rate output   select @I_iDictID = 414 select @I_iMessageNumber = 00009 select @I_iAliasMessageNumber = 0  exec DYNAMICS..smGetBIMsgString  @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @Time_Available output   select @I_iDictID = 0 select @I_iMessageNumber = 22065 select @I_iAliasMessageNumber = 0  exec DYNAMICS..smGetBIMsgString  @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @TRX output   select @I_iDictID = 414 select @I_iMessageNumber = 26682 select @I_iAliasMessageNumber = 0  exec DYNAMICS..smGetBIMsgString  @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @Start_Date output   select @I_iDictID = 414 select @I_iMessageNumber = 26676 select @I_iAliasMessageNumber = 0  exec DYNAMICS..smGetBIMsgString  @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @Job_Title output   select @I_iDictID = 414 select @I_iMessageNumber = 26675 select @I_iAliasMessageNumber = 0  exec DYNAMICS..smGetBIMsgString  @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @Department output   select @I_iDictID = 414 select @I_iMessageNumber = 00011 select @I_iAliasMessageNumber = 0  exec DYNAMICS..smGetBIMsgString  @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @TRX_Date output   select @I_iDictID = 414 select @I_iMessageNumber = 00012 select @I_iAliasMessageNumber = 0  exec DYNAMICS..smGetBIMsgString  @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @TRX_Ending_Date output   select @I_iDictID = 0 select @I_iMessageNumber = 22063 select @I_iAliasMessageNumber = 0  exec DYNAMICS..smGetBIMsgString  @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @Hours output   select @I_iDictID = 0 select @I_iMessageNumber = 22076 select @I_iAliasMessageNumber = 0  exec DYNAMICS..smGetBIMsgString  @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @Accrual_Flag output   select @I_iDictID = 414 select @I_iMessageNumber = 00013 select @I_iAliasMessageNumber = 0  exec DYNAMICS..smGetBIMsgString  @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @Accrue_Time_Benefits output   select @I_iDictID = 414 select @I_iMessageNumber = 00014 select @I_iAliasMessageNumber = 0  exec DYNAMICS..smGetBIMsgString  @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @Posted output   select @I_iDictID = 0 select @I_iMessageNumber = 22066 select @I_iAliasMessageNumber = 0  exec DYNAMICS..smGetBIMsgString  @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @Attendance_Type output   select @I_iDictID = 0 select @I_iMessageNumber = 22067 select @I_iAliasMessageNumber = 0  exec DYNAMICS..smGetBIMsgString  @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @Attendance_Reason output   select @I_iDictID = 414 select @I_iMessageNumber = 00015 select @I_iAliasMessageNumber = 0  exec DYNAMICS..smGetBIMsgString  @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @Pay_Rate_Amount output   select @sqldropstring =   'if exists (select * from dbo.sysobjects where id = object_id(N''[dbo].[HRPCombined]'') and OBJECTPROPERTY(id, N''IsView'') = 1) ' +  'drop view [dbo].[HRPCombined] '  select @sqlstring1 =   'CREATE VIEW HRPCombined AS ' +   'select ' +   '[''a''].[EMPLOYID] as ''' + @Employee_ID + ''', ' +  'rtrim([''a''].[LASTNAME]) + '', '' + rtrim([''a''].[FRSTNAME]) as ''' + @Employee_Name + ''', ' +  '[''a''].[Primary_Pay_Record] as ''' + @Primary_Pay_Code + ''', ' +   '[''b''].[PAYRCORD] as ''' + @Pay_Code + ''', ' +  '[''b''].[PAYRTAMT] as ''' + @Pay_Rate_Amount + ''', ' +  '[''b''].[PAYUNIT] as ''' + @Pay_Unit + ''', ' +  '[''c''].[PAYRTAMT] as ''' + @Primary_Pay_Rate + ''', ' +  '[''e''].[TIMECODE_I] as ''' + @Time_Code + ''', ' + 'convert(decimal(9,2),[''e''].[HOURSAVAILABLE_I]/100) as ''' + @Time_Available + ''', ' +  'case [''b''].[PAYUNIT] when ''Hourly'' ' + '  then convert(decimal(9,2), ([''b''].[PAYRTAMT] * ([''e''].[HOURSAVAILABLE_I]/100.00)))  ' + '  else convert(decimal(9,2), ([''b''].[PAYRTAMT] * ([''e''].[HOURSAVAILABLE_I]/100.00) / [''a''].[WKHRPRYR])) ' + ' end as ''' + @Liability + ''' '   select @sqljoinstring =  'from [UPR00100] as [''a''] WITH (NOLOCK)  '  + 'left outer join [UPR00400] as [''b''] WITH (NOLOCK) on [''a''].[EMPLOYID] = [''b''].[EMPLOYID] '  + 'left outer join [UPR00400] as [''c''] WITH (NOLOCK) on [''a''].[EMPLOYID] = [''c''].[EMPLOYID] '  + 'and [''a''].[Primary_Pay_Record] = [''c''].[PAYRCORD] '  + 'left outer join [TATM0130] as [''d''] WITH (NOLOCK) on [''b''].[PAYRCORD] = [''d''].[PAYRCORD] '  + 'left outer join [TATM1030] as [''e''] WITH (NOLOCK) on [''e''].[TIMECODE_I] = [''d''].[TIMECODE_I] '  + ' and [''e''].[EMPID_I] = [''b''].[EMPLOYID] '  select @sqlaccessstring =   'GRANT SELECT ON [dbo].[HRPCombined] TO [rpt_executive] ' + 'GRANT SELECT ON [dbo].[HRPCombined] TO [rpt_human resource administrator]'   exec (@sqldropstring)  exec (@sqldefaultstring+' '+@sqlstring1+' '+@sqlstring2+' '+@sqlstring3+' '+@sqlstring4+' '+@sqlstring5+' '+@sqlstring6+' '+@sqlstring7+' '+@sqlstring8+' '+@sqlstring9+' '+@sqlstring10+' '+@sqljoinstring)  exec (@sqlaccessstring)   set nocount off    
GO
GRANT EXECUTE ON  [dbo].[sp_HumanResources_HRPCombined] TO [DYNGRP]
GO
