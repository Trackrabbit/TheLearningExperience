SET QUOTED_IDENTIFIER OFF
GO
SET ANSI_NULLS ON
GO
 CREATE PROCEDURE [dbo].[sp_Dynamics_TaxDetailTransactions] @iLanguageID int  as  set nocount on   declare @sqldropstring varchar(400),  @sqldefaultstring varchar(8000),  @sqlstring1 varchar(8000),  @sqlstring2 varchar(8000),  @sqlstring3 varchar(8000),  @sqlstring4 varchar(8000),  @sqlstring5 varchar(8000),  @sqlstring6 varchar(8000),  @sqlstring7 varchar(8000),  @sqlstring8 varchar(8000),  @sqlstring9 varchar(8000),  @sqlstring10 varchar(8000),  @sqljoinstring varchar(8000),  @sqlaccessstring varchar(2000),  @tNumberSegments int,  @tSegment int,  @I_iDictID int,  @I_iLangID int,  @I_iMessageNumber int,  @I_iAliasMessageNumber int,  @I_iIntegerValue int,  @Tax_Detail_ID varchar(255), @Tax_Detail_Description varchar(255), @Tax_Detail_Type varchar(255), @Tax_Detail_Base varchar(255), @Tax_Detail_Percent varchar(255), @Tax_Detail_Amount varchar(255), @Document_Number varchar(255), @Customer_Vendor_ID varchar(255), @Vendor_ID varchar(255), @Customer_Number varchar(255), @Vendor_Name varchar(255), @Customer_Name varchar(255), @Customer_Vendor_Name varchar(255), @Document_Date varchar(255), @Posting_Date varchar(255), @Total_Sales_Purchases varchar(255), @Taxable_Sales_Purchases varchar(255), @Tax_Amount varchar(255), @Document_Type varchar(255), @Account_Number varchar(255), @Tax_Date varchar(255), @Originating_Tax_Amount varchar(255), @Originating_Taxable_Sales_Purchases varchar(255), @Originating_Total_Sales_Purchases varchar(255), @EC_Transaction varchar(255), @Voided varchar(255), @Currency_Index varchar(255), @Included_On_Return varchar(255), @Tax_Return_ID varchar(255), @Series varchar(255), @DrillBack_Base_Url varchar(255), @Customer_Number_For_DrillBack varchar(255), @Vendor_ID_For_DrillBack varchar(255), @Account_Number_For_DrillBack varchar(255)  select @DrillBack_Base_Url = DYNAMICS.dbo.createBaseDrillBackUrlString(DB_NAME(),0)  select @I_iDictID = 1493 select @I_iMessageNumber = 25150 select @I_iAliasMessageNumber = 0 exec DYNAMICS..smGetBIMsgString  @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @Tax_Detail_ID output  select @I_iDictID = 1493 select @I_iMessageNumber = 25151 select @I_iAliasMessageNumber = 0 exec DYNAMICS..smGetBIMsgString  @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @Tax_Detail_Description output  select @I_iDictID = 1493 select @I_iMessageNumber = 25152 select @I_iAliasMessageNumber = 0 exec DYNAMICS..smGetBIMsgString  @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @Tax_Detail_Type output  select @I_iDictID = 0 select @I_iMessageNumber = 22000 select @I_iAliasMessageNumber = 0 exec DYNAMICS..smGetBIMsgString  @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @Tax_Detail_Base output  select @I_iDictID = 0 select @I_iMessageNumber = 22001 select @I_iAliasMessageNumber = 0 exec DYNAMICS..smGetBIMsgString  @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @Tax_Detail_Percent output  select @I_iDictID = 0 select @I_iMessageNumber = 22002 select @I_iAliasMessageNumber = 0 exec DYNAMICS..smGetBIMsgString  @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @Tax_Detail_Amount output  select @I_iDictID = 1493 select @I_iMessageNumber = 25154 select @I_iAliasMessageNumber = 0 exec DYNAMICS..smGetBIMsgString  @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @Document_Number output  select @I_iDictID = 1493 select @I_iMessageNumber = 25155 select @I_iAliasMessageNumber = 0 exec DYNAMICS..smGetBIMsgString  @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @Customer_Vendor_ID output  select @I_iDictID = 1493 select @I_iMessageNumber = 24800 select @I_iAliasMessageNumber = 0 exec DYNAMICS..smGetBIMsgString  @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @Vendor_ID output  select @I_iDictID = 1493 select @I_iMessageNumber = 26901 select @I_iAliasMessageNumber = 0 exec DYNAMICS..smGetBIMsgString  @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @Customer_Number output  select @I_iDictID = 1493 select @I_iMessageNumber = 24802 select @I_iAliasMessageNumber = 0 exec DYNAMICS..smGetBIMsgString  @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @Vendor_Name output  select @I_iDictID = 1493 select @I_iMessageNumber = 22901 select @I_iAliasMessageNumber = 0 exec DYNAMICS..smGetBIMsgString  @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @Customer_Name output  select @I_iDictID = 1493 select @I_iMessageNumber = 25156 select @I_iAliasMessageNumber = 0 exec DYNAMICS..smGetBIMsgString  @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @Customer_Vendor_Name output  select @I_iDictID = 1493 select @I_iMessageNumber = 25157 select @I_iAliasMessageNumber = 0 exec DYNAMICS..smGetBIMsgString  @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @Document_Date output  select @I_iDictID = 1493 select @I_iMessageNumber = 25158 select @I_iAliasMessageNumber = 0 exec DYNAMICS..smGetBIMsgString  @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @Posting_Date output  select @I_iDictID = 1493 select @I_iMessageNumber = 25159 select @I_iAliasMessageNumber = 0 exec DYNAMICS..smGetBIMsgString  @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @Total_Sales_Purchases output  select @I_iDictID = 1493 select @I_iMessageNumber = 25160 select @I_iAliasMessageNumber = 0 exec DYNAMICS..smGetBIMsgString  @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @Taxable_Sales_Purchases output  select @I_iDictID = 1493 select @I_iMessageNumber = 25161 select @I_iAliasMessageNumber = 0 exec DYNAMICS..smGetBIMsgString  @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @Tax_Amount output  select @I_iDictID = 1493 select @I_iMessageNumber = 25162 select @I_iAliasMessageNumber = 0 exec DYNAMICS..smGetBIMsgString  @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @Document_Type output  select @I_iDictID = 1493 select @I_iMessageNumber = 25163 select @I_iAliasMessageNumber = 0 exec DYNAMICS..smGetBIMsgString  @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @Account_Number output  select @I_iDictID = 1493 select @I_iMessageNumber = 25164 select @I_iAliasMessageNumber = 0 exec DYNAMICS..smGetBIMsgString  @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @Tax_Date output  select @I_iDictID = 1493 select @I_iMessageNumber = 25165 select @I_iAliasMessageNumber = 0 exec DYNAMICS..smGetBIMsgString  @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @Originating_Tax_Amount output  select @I_iDictID = 1493 select @I_iMessageNumber = 25166 select @I_iAliasMessageNumber = 0 exec DYNAMICS..smGetBIMsgString  @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @Originating_Taxable_Sales_Purchases output  select @I_iDictID = 1493 select @I_iMessageNumber = 25167 select @I_iAliasMessageNumber = 0 exec DYNAMICS..smGetBIMsgString  @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @Originating_Total_Sales_Purchases output  select @I_iDictID = 1493 select @I_iMessageNumber = 25168 select @I_iAliasMessageNumber = 0 exec DYNAMICS..smGetBIMsgString  @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @EC_Transaction output  select @I_iDictID = 1493 select @I_iMessageNumber = 25169 select @I_iAliasMessageNumber = 0 exec DYNAMICS..smGetBIMsgString  @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @Voided output  select @I_iDictID = 1493 select @I_iMessageNumber = 25170 select @I_iAliasMessageNumber = 0 exec DYNAMICS..smGetBIMsgString  @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @Currency_Index output  select @I_iDictID = 1493 select @I_iMessageNumber = 25171 select @I_iAliasMessageNumber = 0 exec DYNAMICS..smGetBIMsgString  @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @Included_On_Return output  select @I_iDictID = 1493 select @I_iMessageNumber = 25172 select @I_iAliasMessageNumber = 0 exec DYNAMICS..smGetBIMsgString  @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @Tax_Return_ID output  select @I_iDictID = 1493 select @I_iMessageNumber = 25173 select @I_iAliasMessageNumber = 0 exec DYNAMICS..smGetBIMsgString  @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @Series output   select @I_iDictID = 1493 select @I_iMessageNumber = 26901 select @I_iAliasMessageNumber = 22214 exec DYNAMICS..smGetBIMsgString  @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @Customer_Number_For_DrillBack output   select @I_iDictID = 1493 select @I_iMessageNumber = 24800 select @I_iAliasMessageNumber = 22214 exec DYNAMICS..smGetBIMsgString  @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @Vendor_ID_For_DrillBack output   select @I_iDictID = 1493 select @I_iMessageNumber = 25163 select @I_iAliasMessageNumber = 22214 exec DYNAMICS..smGetBIMsgString  @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @Account_Number_For_DrillBack output   select @sqldropstring =   'if exists (select * from dbo.sysobjects where id = object_id(N''[dbo].[TaxDetailTransactions]'') and OBJECTPROPERTY(id, N''IsView'') = 1) ' +  'drop view [dbo].[TaxDetailTransactions] '  select @sqldefaultstring =   'CREATE VIEW TaxDetailTransactions AS ' +   'select ' +   'rtrim([''Tax History''].[TAXDTLID]) as ''' + @Tax_Detail_ID + ''', ' + 'rtrim([''Sales/Purchases Tax Master''].[TXDTLDSC]) as ''' + @Tax_Detail_Description + ''', ' + '''' + @Tax_Detail_Type + ''' = dbo.DYN_FUNC_Tax_Detail_Type([''Sales/Purchases Tax Master''].[TXDTLTYP]), ' + 'rtrim([''Tax History''].[DOCNUMBR]) as ''' + @Document_Number + ''', ' + 'rtrim([''Tax History''].[CustomerVendor_ID]) as ''' + @Customer_Vendor_ID + ''', ' + 'case ISNULL([''PM Vendor Master File''].[VENDORID],''empty'') WHEN ''empty'' ' +  ' THEN rtrim([''RM Customer MSTR''].[CUSTNAME]) ' + ' ELSE rtrim([''PM Vendor Master File''].[VENDNAME]) ' + 'END as ''' + @Customer_Vendor_Name + ''', ' +  '[''Tax History''].[DOCDATE] as ''' + @Document_Date + ''', ' + '[''Tax History''].[PSTGDATE] as ''' + @Posting_Date + ''', ' + '[''Tax History''].[DOCAMNT] as ''' + @Total_Sales_Purchases + ''', ' + '[''Tax History''].[Taxable_Amount] as ''' + @Taxable_Sales_Purchases + ''', ' + '[''Tax History''].[TAXAMNT] as ''' + @Tax_Amount + ''', '   select @sqlstring1 =   '(select rtrim([ACTNUMST]) from [GL00105] as [''Account Index Master''] where [''Account Index Master''].[ACTINDX] = [''Tax History''].[ACTINDX]) as ''' + @Account_Number + ''', ' +  '[''Tax History''].[CURRNIDX] as ''' + @Currency_Index + ''', ' +  'rtrim([''RM Customer MSTR''].[CUSTNAME]) as ''' + @Customer_Name + ''', ' +  'rtrim([''RM Customer MSTR''].[CUSTNMBR]) as ''' + @Customer_Number + ''', ' +  '''' + @Document_Type + ''' = dbo.DYN_FUNC_Document_Type_Tax_Detail_Trx([''Tax History''].[DOCTYPE]), ' +  '''' + @EC_Transaction + ''' = dbo.DYN_FUNC_Boolean_All([''Tax History''].[ECTRX]), ' +  '''' + @Included_On_Return + ''' = dbo.DYN_FUNC_Boolean_All([''Tax History''].[Included_On_Return]), ' +  '[''Tax History''].[ORTAXAMT] as ''' + @Originating_Tax_Amount + ''', ' +  '[''Tax History''].[Originating_Taxable_Amt] as ''' + @Originating_Taxable_Sales_Purchases + ''', ' +  '[''Tax History''].[ORDOCAMT] as ''' + @Originating_Total_Sales_Purchases + ''', ' +  '''' + @Series + ''' = dbo.DYN_FUNC_Series_Tax_Detail_Trx([''Tax History''].[SERIES]), ' +  '[''Tax History''].[Tax_Date] as ''' + @Tax_Date + ''', ' +  '[''Sales/Purchases Tax Master''].[TXDTLAMT] as ''' + @Tax_Detail_Amount + ''', ' +  '[''Sales/Purchases Tax Master''].[TXDTLBSE] as ''' + @Tax_Detail_Base + ''', ' +  '[''Sales/Purchases Tax Master''].[TXDTLPCT] as ''' + @Tax_Detail_Percent + ''', ' +  'rtrim([''Tax History''].[Tax_Return_ID]) as ''' + @Tax_Return_ID + ''', ' +  'rtrim([''PM Vendor Master File''].[VENDORID]) as ''' + @Vendor_ID + ''', ' +  'rtrim([''PM Vendor Master File''].[VENDNAME]) as ''' + @Vendor_Name + ''', ' +  '''' + @Voided + ''' = dbo.DYN_FUNC_Voided([''Tax History''].[VOIDSTTS]), '   select @sqlstring2 =  '''' + @Account_Number_For_DrillBack + ''' = ''' + @DrillBack_Base_Url + ''' +dbo.dgppAccountIndex(1,[''Tax History''].[ACTINDX] ), '+ '''' + @Customer_Number_For_DrillBack + ''' = ''' + @DrillBack_Base_Url + ''' +dbo.dgppCustomerID(1,[''RM Customer MSTR''].[CUSTNMBR] ), '+ '''' + @Vendor_ID_For_DrillBack + ''' = ''' + @DrillBack_Base_Url + ''' +dbo.dgppVendorID(1,[''PM Vendor Master File''].[VENDORID] ) '  select @sqljoinstring =   'from [TX30000] as [''Tax History''] with (NOLOCK) '   + 'left outer join [TX00201] as [''Sales/Purchases Tax Master''] with (NOLOCK) on '   + '[''Tax History''].[TAXDTLID] = [''Sales/Purchases Tax Master''].[TAXDTLID] '   + 'left outer join [PM00200] as [''PM Vendor Master File''] with (NOLOCK) on '   + '[''Tax History''].[CustomerVendor_ID] = [''PM Vendor Master File''].[VENDORID] '   + 'left outer join [RM00101] as [''RM Customer MSTR''] with (NOLOCK) on '   + '[''Tax History''].[CustomerVendor_ID] = [''RM Customer MSTR''].[CUSTNMBR] '   select @sqlaccessstring =   'GRANT SELECT ON [dbo].[TaxDetailTransactions] TO [rpt_warehouse manager]' + 'GRANT SELECT ON [dbo].[TaxDetailTransactions] TO [rpt_materials manager]' + 'GRANT SELECT ON [dbo].[TaxDetailTransactions] TO [rpt_operations manager]' + 'GRANT SELECT ON [dbo].[TaxDetailTransactions] TO [rpt_production manager]' + 'GRANT SELECT ON [dbo].[TaxDetailTransactions] TO [rpt_purchasing agent]' + 'GRANT SELECT ON [dbo].[TaxDetailTransactions] TO [rpt_accounting manager]' + 'GRANT SELECT ON [dbo].[TaxDetailTransactions] TO [rpt_accounts receivable coordinator]' + 'GRANT SELECT ON [dbo].[TaxDetailTransactions] TO [rpt_bookkeeper]' + 'GRANT SELECT ON [dbo].[TaxDetailTransactions] TO [rpt_dispatcher]' + 'GRANT SELECT ON [dbo].[TaxDetailTransactions] TO [rpt_customer service rep]' + 'GRANT SELECT ON [dbo].[TaxDetailTransactions] TO [rpt_sales manager]' + 'GRANT SELECT ON [dbo].[TaxDetailTransactions] TO [rpt_executive]' + 'GRANT SELECT ON [dbo].[TaxDetailTransactions] TO [rpt_project manager]'   exec (@sqldropstring)  exec (@sqldefaultstring+' '+@sqlstring1+' '+@sqlstring2+' '+@sqlstring3+' '+@sqlstring4+' '+@sqlstring5+' '+@sqlstring6+' '+@sqlstring7+' '+@sqlstring8+' '+@sqlstring9+' '+@sqlstring10+' '+@sqljoinstring)  exec (@sqlaccessstring)   set nocount off    
GO
GRANT EXECUTE ON  [dbo].[sp_Dynamics_TaxDetailTransactions] TO [DYNGRP]
GO
