SET QUOTED_IDENTIFIER OFF
GO
SET ANSI_NULLS ON
GO
 CREATE Procedure [dbo].[SVC_Create_Contract_Audit] (  @ConRECTYPE smallint,  @ContractNumber char(11),  @ContractLineSeq numeric(19,5),  @ItemNumber char(31),  @SerialNumber char(21),  @AddressCode char(15),  @USERID char(15),  @ITEMDESC char(100),    @FromHistory smallint = 0) As declare @vCURRENTDATE datetime declare @CREATEDDATE datetime declare @CREATEDTIME datetime declare @LNITMSEQ integer DECLARE @HistoryRecord smallint DECLARE @HistoryVersion int select @vCURRENTDATE = GETDATE() exec SVC_util_split_datetime @vCURRENTDATE, @CREATEDDATE OUTPUT, @CREATEDTIME OUTPUT  if @FromHistory = 1 begin  select TOP 1 @HistoryVersion = isnull(SVC_Contract_Version,0) from SVC30600 where CONTNBR = @ContractNumber ORDER BY CONSTS ASC, CONTNBR ASC, SVC_Contract_Version DESC  if @HistoryVersion > 0  SET @HistoryRecord = 1  else  SET @HistoryRecord = 0 end else  SET @HistoryRecord = 0  IF @HistoryRecord = 0 begin  select @LNITMSEQ = MAX(LNITMSEQ) + 1 from SVC00620 T2 where   T2.CONSTS = @ConRECTYPE and T2.CONTNBR = @ContractNumber   insert SVC00620 with (rowlock)   VALUES(@ConRECTYPE,  @ContractNumber,  isnull(@LNITMSEQ,1),  @ContractLineSeq,  @CREATEDDATE,  @CREATEDTIME,  @ItemNumber,  @SerialNumber,  @AddressCode,  @ITEMDESC,  @USERID ) end ELSE begin  select @LNITMSEQ = MAX(LNITMSEQ) + 1 from SVC30620 T2 where   T2.CONSTS = @ConRECTYPE and T2.CONTNBR = @ContractNumber and SVC_Contract_Version = @HistoryVersion   insert SVC30620 with (rowlock)   VALUES(@ConRECTYPE,  @ContractNumber,  isnull(@LNITMSEQ,1),  @ContractLineSeq,  @CREATEDDATE,  @CREATEDTIME,  @ItemNumber,  @SerialNumber,  @AddressCode,  @ITEMDESC,  @USERID,  @HistoryVersion) end  return (0)   
GO
GRANT EXECUTE ON  [dbo].[SVC_Create_Contract_Audit] TO [DYNGRP]
GO
