SET QUOTED_IDENTIFIER OFF
GO
SET ANSI_NULLS ON
GO
 create procedure [dbo].[glUMatchIVTransactions]  @iGLTempTable varchar(50),  @iIVTempTable varchar(50),  @iIVMatchTable varchar(50),  @iGLMatchTable varchar(50),  @iIVUMatchTable varchar(50),  @iGLUMatchTable varchar(50)  AS  DECLARE  @lSQLError int  EXEC(' if (select count(*) from '+@iGLTempTable+' where DEBITAMT=0.0 and CRDTAMNT=0.0)=0  begin  INSERT INTO ' +  @iIVMatchTable +  ' (POSTEDDT,  JRNENTRY,  DOCNUMBR,  DOCTYPE,  TRXSORCE,  STRVAL,  TRX_ID,  EXTDCOST,  DocumentNumberDrillback,  JournalEntryDrillback)  SELECT  POSTEDDT,  JRNENTRY,  DOCNUMBR,  DOCTYPE,  TRXSORCE,  '''',  '''',  EXTDCOST,  DYNAMICS.dbo.createBaseDrillBackUrlString(DB_NAME(),0)   + dbo.dgppItemTransactionNumber(1,ITEMNMBR,DOCTYPE,DOCNUMBR,DCSTATUS),  DYNAMICS.dbo.createBaseDrillBackUrlString(DB_NAME(),0)   + dbo.dgppJournalInquiry(1,JRNENTRY,0,dbo.glFuncGetFiscalYear(POSTEDDT),POSTEDDT)  FROM '  + @iIVTempTable + ' where EXTDCOST=0.0   end ')  EXEC(' if (select count(*) from '+@iGLTempTable+' where DEBITAMT=0.0 and CRDTAMNT=0.0)=0  begin  delete FROM '  + @iIVTempTable + ' where EXTDCOST=0.0   end ')  EXEC( 'INSERT INTO ' +  @iIVUMatchTable +   ' (POSTEDDT,  JRNENTRY,  DOCNUMBR,  DOCTYPE,  TRXSORCE,  STRVAL,  TRX_ID,  EXTDCOST,  DocumentNumberDrillback,  JournalEntryDrillback)  SELECT  POSTEDDT,  JRNENTRY,  DOCNUMBR,  DOCTYPE,  TRXSORCE,  '''',  '''',  EXTDCOST,  DYNAMICS.dbo.createBaseDrillBackUrlString(DB_NAME(),0)   + dbo.dgppItemTransactionNumber(1,ITEMNMBR,DOCTYPE,DOCNUMBR,DCSTATUS),  DYNAMICS.dbo.createBaseDrillBackUrlString(DB_NAME(),0)   + dbo.dgppJournalInquiry(1,JRNENTRY,0,dbo.glFuncGetFiscalYear(POSTEDDT),POSTEDDT)  FROM '  + @iIVTempTable)  EXEC(  'INSERT INTO ' +  @iGLUMatchTable +  ' (TRXDATE,  JRNENTRY,  ORTRXSRC,  ORCTRNUM,  ACTINDX,  DEBITAMT,  CRDTAMNT,  AccountNumberDrillback,  JournalEntryDrillback)  SELECT  TRXDATE,  JRNENTRY,  ORTRXSRC,  ORCTRNUM,  ACTINDX,  DEBITAMT,  CRDTAMNT,  DYNAMICS.dbo.createBaseDrillBackUrlString(DB_NAME(),0)   + dbo.dgppAccountIndex(1,ACTINDX),  DYNAMICS.dbo.createBaseDrillBackUrlString(DB_NAME(),0)   + dbo.dgppJournalInquiry(1,JRNENTRY,RCTRXSEQ,YEAR1,TRXDATE)   FROM '  + @iGLTempTable) RETURN (@lSQLError)    
GO
GRANT EXECUTE ON  [dbo].[glUMatchIVTransactions] TO [DYNGRP]
GO
