SET QUOTED_IDENTIFIER OFF
GO
SET ANSI_NULLS ON
GO
 CREATE PROCEDURE [dbo].[sp_Dynamics_PurchaseRequisitionLines] @iLanguageID int  as  set nocount on   declare @sqldropstring varchar(400),  @sqldefaultstring varchar(8000),  @sqlstring1 varchar(8000),  @sqlstring2 varchar(8000),  @sqlstring3 varchar(8000),  @sqlstring4 varchar(8000),  @sqlstring5 varchar(8000),  @sqlstring6 varchar(8000),  @sqlstring7 varchar(8000),  @sqlstring8 varchar(8000),  @sqlstring9 varchar(8000),  @sqlstring10 varchar(8000),  @sqljoinstring varchar(8000),  @sqlaccessstring varchar(2000),  @tNumberSegments int,  @tSegment int,  @I_iDictID int,  @I_iLangID int,  @I_iMessageNumber int,  @I_iAliasMessageNumber int,  @I_iIntegerValue int,   @Requisition_Number varchar(255), @Status varchar(255), @Item_Number varchar(255), @Item_Description varchar(255), @Vendor_ID varchar(255), @QTY_Ordered varchar(255), @Unit_Cost varchar(255), @Extended_Cost varchar(255), @Address_1 varchar(255), @Address_2 varchar(255), @Address_3 varchar(255), @Address_ID varchar(255), @Address_Source varchar(255), @City varchar(255), @Comment_ID varchar(255), @Company_Name varchar(255), @Contact varchar(255), @Country varchar(255), @Country_Code varchar(255), @Currency_ID varchar(255), @Currency_Index varchar(255), @Currency_Note_Index varchar(255), @Decimal_Places_Currency varchar(255), @Decimal_Places_QTYS varchar(255), @Denomination_Exchange_Rate varchar(255), @Document_Status varchar(255), @Exchange_Date varchar(255), @Exchange_Rate varchar(255), @Exchange_Table_ID varchar(255), @Fax varchar(255), @Freight_Amount varchar(255), @Invalid_Data_Flag varchar(255), @Inventory_Account_Number varchar(255), @Item_Tracking_Option varchar(255), @LineNumber varchar(255), @MC_Transaction_State varchar(255), @Non_IV varchar(255), @Ord varchar(255), @Originating_Decimal_Places_Currency varchar(255), @Originating_Extended_Cost varchar(255), @Originating_Freight_Amount varchar(255), @Originating_Tax_Amount varchar(255), @Originating_Unit_Cost varchar(255), @Phone_1 varchar(255), @Phone_2 varchar(255), @Phone_3 varchar(255), @QTY_Committed_In_Base varchar(255), @QTY_Uncommitted_In_Base varchar(255), @Rate_Calc_Method varchar(255), @Rate_Type_ID varchar(255), @Req_Note_ID_Req varchar(255), @Req_Note_ID_Account varchar(255), @Req_Note_ID_Comment varchar(255), @Req_Note_ID_Inventory varchar(255), @Req_Note_ID_Location varchar(255), @Req_Note_ID_Shipping varchar(255), @Req_Note_ID_Vendor varchar(255), @Requested_By varchar(255), @Required_Date varchar(255), @Requisition_Status varchar(255), @Shipping_Method varchar(255), @Site_ID varchar(255), @State varchar(255), @Tax_Amount varchar(255), @U_Of_M varchar(255), @U_Of_M_QTY_In_Base varchar(255), @User_Defined_1 varchar(255), @User_Defined_2 varchar(255), @Valuation_Method varchar(255), @Zip_Code varchar(255), @POPRequisitionNumber_For_DrillBack varchar(255),  @DrillBack_Base_Url varchar(255)  select @DrillBack_Base_Url = DYNAMICS.dbo.createBaseDrillBackUrlString(DB_NAME(),0)  select @I_iAliasMessageNumber = 0  select @I_iDictID = 414  select @I_iMessageNumber = 26116  exec DYNAMICS..smGetBIMsgString @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @Requisition_Number output select @I_iDictID = 258  select @I_iMessageNumber = 32409  exec DYNAMICS..smGetBIMsgString @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @Status output select @I_iDictID = 1493  select @I_iMessageNumber = 23100  exec DYNAMICS..smGetBIMsgString @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @Item_Number output select @I_iDictID = 1493  select @I_iMessageNumber = 23101  exec DYNAMICS..smGetBIMsgString @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @Item_Description output select @I_iDictID = 1493  select @I_iMessageNumber = 22823  exec DYNAMICS..smGetBIMsgString @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @Vendor_ID output select @I_iDictID = 1493  select @I_iMessageNumber = 24056  exec DYNAMICS..smGetBIMsgString @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @QTY_Ordered output select @I_iDictID = 1493  select @I_iMessageNumber = 24085  exec DYNAMICS..smGetBIMsgString @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @Unit_Cost output select @I_iDictID = 1493  select @I_iMessageNumber = 22666  exec DYNAMICS..smGetBIMsgString @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @Extended_Cost output select @I_iDictID = 1493  select @I_iMessageNumber = 22406  exec DYNAMICS..smGetBIMsgString @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @Address_1 output select @I_iDictID = 1493  select @I_iMessageNumber = 22407  exec DYNAMICS..smGetBIMsgString @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @Address_2 output select @I_iDictID = 1493  select @I_iMessageNumber = 22408  exec DYNAMICS..smGetBIMsgString @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @Address_3 output select @I_iDictID = 258  select @I_iMessageNumber = 32264  exec DYNAMICS..smGetBIMsgString @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @Address_ID output select @I_iDictID = 1493  select @I_iMessageNumber = 26389  exec DYNAMICS..smGetBIMsgString @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @Address_Source output select @I_iDictID = 1493  select @I_iMessageNumber = 22409  exec DYNAMICS..smGetBIMsgString @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @City output select @I_iDictID = 1493 select @I_iMessageNumber = 22700 exec DYNAMICS..smGetBIMsgString @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @Comment_ID  output  select @I_iDictID = 1493  select @I_iMessageNumber = 22830  exec DYNAMICS..smGetBIMsgString @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @Company_Name output select @I_iDictID = 1493  select @I_iMessageNumber = 22831  exec DYNAMICS..smGetBIMsgString @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @Contact output select @I_iDictID = 1493  select @I_iMessageNumber = 22411  exec DYNAMICS..smGetBIMsgString @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @Country output select @I_iDictID = 1493  select @I_iMessageNumber = 24360  exec DYNAMICS..smGetBIMsgString @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @Country_Code output select @I_iDictID = 1493  select @I_iMessageNumber = 22743  exec DYNAMICS..smGetBIMsgString @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @Currency_ID output select @I_iDictID = 1493  select @I_iMessageNumber = 22765  exec DYNAMICS..smGetBIMsgString @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @Currency_Index output select @I_iDictID = 0  select @I_iMessageNumber = 22245  exec DYNAMICS..smGetBIMsgString @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @Currency_Note_Index output select @I_iDictID = 1493  select @I_iMessageNumber = 23111  exec DYNAMICS..smGetBIMsgString @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @Decimal_Places_Currency output select @I_iDictID = 1493  select @I_iMessageNumber = 23110  exec DYNAMICS..smGetBIMsgString @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @Decimal_Places_QTYS output select @I_iDictID = 1493  select @I_iMessageNumber = 22747  exec DYNAMICS..smGetBIMsgString @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @Denomination_Exchange_Rate output select @I_iDictID = 1493  select @I_iMessageNumber = 22602  exec DYNAMICS..smGetBIMsgString @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @Document_Status output select @I_iDictID = 1493  select @I_iMessageNumber = 22748  exec DYNAMICS..smGetBIMsgString @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @Exchange_Date output select @I_iDictID = 1493  select @I_iMessageNumber = 22746  exec DYNAMICS..smGetBIMsgString @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @Exchange_Rate output select @I_iDictID = 1493  select @I_iMessageNumber = 22745  exec DYNAMICS..smGetBIMsgString @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @Exchange_Table_ID output select @I_iDictID = 1493  select @I_iMessageNumber = 22841  exec DYNAMICS..smGetBIMsgString @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @Fax output select @I_iDictID = 1493  select @I_iMessageNumber = 22667  exec DYNAMICS..smGetBIMsgString @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @Freight_Amount output select @I_iDictID = 0  select @I_iMessageNumber = 22237  exec DYNAMICS..smGetBIMsgString @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @Invalid_Data_Flag output select @I_iDictID = 1493 select @I_iMessageNumber = 22960 exec DYNAMICS..smGetBIMsgString @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @Inventory_Account_Number output  select @I_iDictID = 1493  select @I_iMessageNumber = 23130  exec DYNAMICS..smGetBIMsgString @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @Item_Tracking_Option output select @I_iDictID = 0  select @I_iMessageNumber = 22003  exec DYNAMICS..smGetBIMsgString @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @LineNumber output select @I_iDictID = 1493  select @I_iMessageNumber = 22767  exec DYNAMICS..smGetBIMsgString @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @MC_Transaction_State output select @I_iDictID = 1493  select @I_iMessageNumber = 24032  exec DYNAMICS..smGetBIMsgString @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @Non_IV output select @I_iDictID = 1493  select @I_iMessageNumber = 26302  exec DYNAMICS..smGetBIMsgString @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @Ord output select @I_iDictID = 1493  select @I_iMessageNumber = 24094  exec DYNAMICS..smGetBIMsgString @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @Originating_Decimal_Places_Currency output select @I_iDictID = 1493  select @I_iMessageNumber = 22725  exec DYNAMICS..smGetBIMsgString @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @Originating_Extended_Cost output select @I_iDictID = 1493  select @I_iMessageNumber = 22726  exec DYNAMICS..smGetBIMsgString @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @Originating_Freight_Amount output select @I_iDictID = 1493  select @I_iMessageNumber = 22735  exec DYNAMICS..smGetBIMsgString @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @Originating_Tax_Amount output select @I_iDictID = 1493  select @I_iMessageNumber = 24042  exec DYNAMICS..smGetBIMsgString @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @Originating_Unit_Cost output select @I_iDictID = 1493  select @I_iMessageNumber = 22839  exec DYNAMICS..smGetBIMsgString @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @Phone_1 output select @I_iDictID = 1493  select @I_iMessageNumber = 22840  exec DYNAMICS..smGetBIMsgString @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @Phone_2 output select @I_iDictID = 1493  select @I_iMessageNumber = 22778  exec DYNAMICS..smGetBIMsgString @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @Phone_3 output select @I_iDictID = 1493  select @I_iMessageNumber = 26316  exec DYNAMICS..smGetBIMsgString @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @QTY_Committed_In_Base output select @I_iDictID = 1493  select @I_iMessageNumber = 26317  exec DYNAMICS..smGetBIMsgString @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @QTY_Uncommitted_In_Base output select @I_iDictID = 1493  select @I_iMessageNumber = 22866  exec DYNAMICS..smGetBIMsgString @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @Rate_Calc_Method output select @I_iDictID = 1493  select @I_iMessageNumber = 22744  exec DYNAMICS..smGetBIMsgString @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @Rate_Type_ID output select @I_iDictID = 0  select @I_iMessageNumber = 22238  exec DYNAMICS..smGetBIMsgString @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @Req_Note_ID_Req output select @I_iDictID = 0  select @I_iMessageNumber = 22239  exec DYNAMICS..smGetBIMsgString @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @Req_Note_ID_Account output select @I_iDictID = 0  select @I_iMessageNumber = 22240  exec DYNAMICS..smGetBIMsgString @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @Req_Note_ID_Comment output select @I_iDictID = 0  select @I_iMessageNumber = 22241  exec DYNAMICS..smGetBIMsgString @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @Req_Note_ID_Inventory output select @I_iDictID = 0  select @I_iMessageNumber = 22242  exec DYNAMICS..smGetBIMsgString @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @Req_Note_ID_Location output select @I_iDictID = 0  select @I_iMessageNumber = 22243  exec DYNAMICS..smGetBIMsgString @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @Req_Note_ID_Shipping output select @I_iDictID = 0  select @I_iMessageNumber = 22244  exec DYNAMICS..smGetBIMsgString @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @Req_Note_ID_Vendor output select @I_iDictID = 1493  select @I_iMessageNumber = 26324  exec DYNAMICS..smGetBIMsgString @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @Requested_By output select @I_iDictID = 1493  select @I_iMessageNumber = 22811  exec DYNAMICS..smGetBIMsgString @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @Required_Date output select @I_iDictID = 0  select @I_iMessageNumber = 22247  exec DYNAMICS..smGetBIMsgString @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @Requisition_Status output select @I_iDictID = 1493  select @I_iMessageNumber = 22661  exec DYNAMICS..smGetBIMsgString @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @Shipping_Method output select @I_iDictID = 1493  select @I_iMessageNumber = 23990  exec DYNAMICS..smGetBIMsgString @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @Site_ID output select @I_iDictID = 1493  select @I_iMessageNumber = 22410  exec DYNAMICS..smGetBIMsgString @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @State output select @I_iDictID = 1493  select @I_iMessageNumber = 22680  exec DYNAMICS..smGetBIMsgString @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @Tax_Amount output select @I_iDictID = 1493  select @I_iMessageNumber = 24084  exec DYNAMICS..smGetBIMsgString @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @U_Of_M output select @I_iDictID = 1493  select @I_iMessageNumber = 26313  exec DYNAMICS..smGetBIMsgString @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @U_Of_M_QTY_In_Base output select @I_iDictID = 1493  select @I_iMessageNumber = 22441  exec DYNAMICS..smGetBIMsgString @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @User_Defined_1 output select @I_iDictID = 1493  select @I_iMessageNumber = 22442  exec DYNAMICS..smGetBIMsgString @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @User_Defined_2 output select @I_iDictID = 1493  select @I_iMessageNumber = 23137  exec DYNAMICS..smGetBIMsgString @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @Valuation_Method output select @I_iDictID = 1493  select @I_iMessageNumber = 22412  exec DYNAMICS..smGetBIMsgString @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @Zip_Code output  select @I_iDictID = 414  select @I_iMessageNumber = 26116 select @I_iAliasMessageNumber = 11111 exec DYNAMICS..smGetBIMsgString  @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @POPRequisitionNumber_For_DrillBack output   select @sqldropstring =   'if exists (select * from dbo.sysobjects where id = object_id(N''[dbo].[PurchaseRequisitionLines]'') and OBJECTPROPERTY(id, N''IsView'') = 1) ' +  'drop view [dbo].[PurchaseRequisitionLines] '  select @sqldefaultstring =   'CREATE VIEW PurchaseRequisitionLines AS ' +   'select ' +   'rtrim([''Purchasing Requisition Line''].[POPRequisitionNumber]) as ''' + @Requisition_Number + ''', ' + '''' + @Status + ''' = dbo.DYN_FUNC_Requisition_Line_Status([''Purchasing Requisition Line''].[RequisitionLineStatus]), ' + 'rtrim([''Purchasing Requisition Line''].[ITEMNMBR]) as ''' + @Item_Number + ''', ' + 'rtrim([''Purchasing Requisition Line''].[ITEMDESC]) as ''' + @Item_Description + ''', ' + 'rtrim([''Purchasing Requisition Line''].[VENDORID]) as ''' + @Vendor_ID + ''', ' + '[''Purchasing Requisition Line''].[QTYORDER] as ''' + @QTY_Ordered + ''', ' + '[''Purchasing Requisition Line''].[UNITCOST] as ''' + @Unit_Cost + ''', ' + '[''Purchasing Requisition Line''].[EXTDCOST] as ''' + @Extended_Cost + ''', '   select @sqlstring1 =   'rtrim([''Purchasing Requisition Line''].[ADDRESS1]) as ''' + @Address_1 + ''', ' +  'rtrim([''Purchasing Requisition Line''].[ADDRESS2]) as ''' + @Address_2 + ''', ' +  'rtrim([''Purchasing Requisition Line''].[ADDRESS3]) as ''' + @Address_3 + ''', ' +  'rtrim([''Purchasing Requisition Line''].[ADRSCODE]) as ''' + @Address_ID + ''', ' +  '''' + @Address_Source + ''' = dbo.DYN_FUNC_Address_Source([''Purchasing Requisition Line''].[ADDRSOURCE]), '+ 'rtrim([''Purchasing Requisition Line''].[CITY]) as ''' + @City + ''', ' +  'rtrim([''Purchasing Requisition Line''].[COMMNTID]) as ''' + @Comment_ID + ''', ' +  'rtrim([''Purchasing Requisition Line''].[CMPNYNAM]) as ''' + @Company_Name + ''', ' + 'rtrim([''Purchasing Requisition Line''].[CONTACT]) as ''' + @Contact + ''', ' +  'rtrim([''Purchasing Requisition Line''].[COUNTRY]) as ''' + @Country + ''', ' +  'rtrim([''Purchasing Requisition Line''].[CCode]) as ''' + @Country_Code + ''', ' +  'rtrim([''Purchasing Requisition Line''].[CURNCYID]) as ''' + @Currency_ID + ''', ' +  'rtrim([''Purchasing Requisition Line''].[CURRNIDX]) as ''' + @Currency_Index + ''', ' +  'rtrim([''Purchasing Requisition Line''].[Currency_Note_Index]) as ''' + @Currency_Note_Index + ''', ' +  '''' + @Decimal_Places_Currency + ''' = dbo.DYN_FUNC_Decimal_Places_Currency([''Purchasing Requisition Line''].[DECPLCUR]), '+ '''' + @Decimal_Places_QTYS + ''' = dbo.DYN_FUNC_Decimal_Places_QTYS([''Purchasing Requisition Line''].[DECPLQTY]), '+ '[''Purchasing Requisition Line''].[DENXRATE] as ''' + @Denomination_Exchange_Rate + ''', ' + '''' + @Document_Status + ''' = dbo.DYN_FUNC_Requisition_Document_Status(1), ' +  '[''Purchasing Requisition Line''].[EXCHDATE] as ''' + @Exchange_Date + ''', ' + '[''Purchasing Requisition Line''].[XCHGRATE] as ''' + @Exchange_Rate + ''', ' + 'rtrim([''Purchasing Requisition Line''].[EXGTBLID]) as ''' + @Exchange_Table_ID + ''', ' +  'rtrim([''Purchasing Requisition Line''].[FAX]) as ''' + @Fax + ''', ' +  '[''Purchasing Requisition Line''].[FRTAMNT] as ''' + @Freight_Amount + ''', ' + '''' + @Invalid_Data_Flag + ''' = case [''Purchasing Requisition Line''].[Flags] when 0 then dbo.DYN_FUNC_Boolean_All(0) else dbo.DYN_FUNC_Boolean_All(1) end, ' + '(select rtrim([ACTNUMST]) from [GL00105] as [''Account Index Master''] where [''Account Index Master''].[ACTINDX] = [''Purchasing Requisition Line''].[INVINDX]) as ''' + @Inventory_Account_Number + ''', ' + '''' + @Item_Tracking_Option+ ''' = dbo.DYN_FUNC_Item_Tracking_Option([''Purchasing Requisition Line''].[ITMTRKOP]), '+ '[''Purchasing Requisition Line''].[LineNumber] as ''' + @LineNumber + ''', ' + '''' + @MC_Transaction_State + ''' = dbo.DYN_FUNC_MC_Transaction_State([''Purchasing Requisition Line''].[MCTRXSTT]), ' + '''' + @Non_IV + ''' = dbo.DYN_FUNC_Boolean_All([''Purchasing Requisition Line''].[NONINVEN]), ' +  '[''Purchasing Requisition Line''].[ORD] as ''' + @Ord + ''', ' +  '''' + @Originating_Decimal_Places_Currency+ ''' = dbo.DYN_FUNC_Currency_Decimals([''Purchasing Requisition Line''].[ODECPLCU]), '+ '[''Purchasing Requisition Line''].[OREXTCST] as ''' + @Originating_Extended_Cost + ''', ' + '[''Purchasing Requisition Line''].[ORFRTAMT] as ''' + @Originating_Freight_Amount + ''', ' + '[''Purchasing Requisition Line''].[ORTAXAMT] as ''' + @Originating_Tax_Amount + ''', ' + 'rtrim([''Purchasing Requisition Line''].[PHONE1]) as ''' + @Phone_1 + ''', ' +  'rtrim([''Purchasing Requisition Line''].[PHONE2]) as ''' + @Phone_2 + ''', ' +  'rtrim([''Purchasing Requisition Line''].[PHONE3]) as ''' + @Phone_3 + ''', ' +  '[''Purchasing Requisition Line''].[QTYCMTBASE] as ''' + @QTY_Committed_In_Base + ''', ' +  '[''Purchasing Requisition Line''].[QTYUNCMTBASE] as ''' + @QTY_Uncommitted_In_Base + ''', ' +  '''' + @Rate_Calc_Method + ''' = dbo.DYN_FUNC_Rate_Calculation_Method([''Purchasing Requisition Line''].[RATECALC]), ' +  'rtrim([''Purchasing Requisition Line''].[RATETPID]) as ''' + @Rate_Type_ID + ''', ' +  '[''Purchasing Requisition Line''].[ACCNTNTINDX] as ''' + @Req_Note_ID_Account + ''', ' +  '[''Purchasing Requisition Line''].[Comment_Note_Index] as ''' + @Req_Note_ID_Comment + ''', ' +  '[''Purchasing Requisition Line''].[Item_Number_Note_Index] as ''' + @Req_Note_ID_Inventory + ''', ' +  '[''Purchasing Requisition Line''].[Location_Code_Note_Index] as ''' + @Req_Note_ID_Location + ''', ' +  '[''Purchasing Requisition Line''].[ShippingMethodNoteIndex] as ''' + @Req_Note_ID_Shipping + ''', ' +  '[''Purchasing Requisition Line''].[Vendor_Note_Index] as ''' + @Req_Note_ID_Vendor + ''', ' +  '[''Purchasing Requisition Line''].[REQDATE] as ''' + @Required_Date + ''', ' +  '''' + @Requisition_Status + ''' = dbo.DYN_FUNC_Requisition_Status([''Purchasing Requisitions''].[RequisitionStatus]), '+ 'rtrim([''Purchasing Requisition Line''].[SHIPMTHD]) as ''' + @Shipping_Method + ''', ' +  'rtrim([''Purchasing Requisition Line''].[LOCNCODE]) as ''' + @Site_ID + ''', ' +  'rtrim([''Purchasing Requisition Line''].[STATE]) as ''' + @State + ''', ' +  '[''Purchasing Requisition Line''].[TAXAMNT] as ''' + @Tax_Amount + ''', ' + 'rtrim([''Purchasing Requisition Line''].[UOFM]) as ''' + @U_Of_M + ''', ' +  '[''Purchasing Requisition Line''].[UMQTYINB] as ''' + @U_Of_M_QTY_In_Base + ''', ' + 'rtrim([''Purchasing Requisition Line''].[USERDEF1]) as ''' + @User_Defined_1 + ''', ' +  'rtrim([''Purchasing Requisition Line''].[USERDEF1]) as ''' + @User_Defined_2 + ''', ' +  '''' + @Valuation_Method + ''' = dbo.DYN_FUNC_Valuation_Method([''Purchasing Requisition Line''].[VCTNMTHD]), '+ 'rtrim([''Purchasing Requisition Line''].[ZIPCODE]) as ''' + @Zip_Code + ''', '+ '''' + @POPRequisitionNumber_For_DrillBack + ''' = ''' + @DrillBack_Base_Url + ''' +dbo.dgppPurchaseRequisitionNumber(1,[''Purchasing Requisition Line''].[POPRequisitionNumber],0 ) '  select @sqlstring2 =   'from [POP10210] as [''Purchasing Requisition Line''] with (NOLOCK) ' + 'left outer join [POP10200] as [''Purchasing Requisitions''] with (NOLOCK) ' + 'on [''Purchasing Requisition Line''].[POPRequisitionNumber] = [''Purchasing Requisitions''].[POPRequisitionNumber] '  select @sqlstring3 =  'union all ' +  'select ' +   'rtrim([''Purchasing Requisition Line History''].[POPRequisitionNumber]) as ''' + @Requisition_Number + ''', ' + '''' + @Status + ''' = dbo.DYN_FUNC_Requisition_Line_Status([''Purchasing Requisition Line History''].[RequisitionLineStatus]), ' + 'rtrim([''Purchasing Requisition Line History''].[ITEMNMBR]) as ''' + @Item_Number + ''', ' + 'rtrim([''Purchasing Requisition Line History''].[ITEMDESC]) as ''' + @Item_Description + ''', ' + 'rtrim([''Purchasing Requisition Line History''].[VENDORID]) as ''' + @Vendor_ID + ''', ' + '[''Purchasing Requisition Line History''].[QTYORDER] as ''' + @QTY_Ordered + ''', ' + '[''Purchasing Requisition Line History''].[UNITCOST] as ''' + @Unit_Cost + ''', ' + '[''Purchasing Requisition Line History''].[EXTDCOST] as ''' + @Extended_Cost + ''', '   select @sqlstring4 =   'rtrim([''Purchasing Requisition Line History''].[ADDRESS1]) as ''' + @Address_1 + ''', ' +  'rtrim([''Purchasing Requisition Line History''].[ADDRESS2]) as ''' + @Address_2 + ''', ' +  'rtrim([''Purchasing Requisition Line History''].[ADDRESS3]) as ''' + @Address_3 + ''', ' +  'rtrim([''Purchasing Requisition Line History''].[ADRSCODE]) as ''' + @Address_ID + ''', ' +  '''' + @Address_Source + ''' = dbo.DYN_FUNC_Address_Source([''Purchasing Requisition Line History''].[ADDRSOURCE]), '+ 'rtrim([''Purchasing Requisition Line History''].[CITY]) as ''' + @City + ''', ' +  'rtrim([''Purchasing Requisition Line History''].[COMMNTID]) as ''' + @Comment_ID + ''', ' +  'rtrim([''Purchasing Requisition Line History''].[CMPNYNAM]) as ''' + @Company_Name + ''', ' + 'rtrim([''Purchasing Requisition Line History''].[CONTACT]) as ''' + @Contact + ''', ' +  'rtrim([''Purchasing Requisition Line History''].[COUNTRY]) as ''' + @Country + ''', ' +  'rtrim([''Purchasing Requisition Line History''].[CCode]) as ''' + @Country_Code + ''', ' +  'rtrim([''Purchasing Requisition Line History''].[CURNCYID]) as ''' + @Currency_ID + ''', ' +  'rtrim([''Purchasing Requisition Line History''].[CURRNIDX]) as ''' + @Currency_Index + ''', ' +  'rtrim([''Purchasing Requisition Line History''].[Currency_Note_Index]) as ''' + @Currency_Note_Index + ''', ' +  '''' + @Decimal_Places_Currency + ''' = dbo.DYN_FUNC_Decimal_Places_Currency([''Purchasing Requisition Line History''].[DECPLCUR]), '+ '''' + @Decimal_Places_QTYS + ''' = dbo.DYN_FUNC_Decimal_Places_QTYS([''Purchasing Requisition Line History''].[DECPLQTY]), '+ '[''Purchasing Requisition Line History''].[DENXRATE] as ''' + @Denomination_Exchange_Rate + ''', ' + '''' + @Document_Status + ''' = dbo.DYN_FUNC_Requisition_Document_Status(2), ' +  '[''Purchasing Requisition Line History''].[EXCHDATE] as ''' + @Exchange_Date + ''', ' + '[''Purchasing Requisition Line History''].[XCHGRATE] as ''' + @Exchange_Rate + ''', ' + 'rtrim([''Purchasing Requisition Line History''].[EXGTBLID]) as ''' + @Exchange_Table_ID + ''', ' +  'rtrim([''Purchasing Requisition Line History''].[FAX]) as ''' + @Fax + ''', ' +  '[''Purchasing Requisition Line History''].[FRTAMNT] as ''' + @Freight_Amount + ''', ' + '''' + @Invalid_Data_Flag + ''' = case [''Purchasing Requisition Line History''].[Flags] when 0 then dbo.DYN_FUNC_Boolean_All(0) else dbo.DYN_FUNC_Boolean_All(1) end, ' + '(select rtrim([ACTNUMST]) from [GL00105] as [''Account Index Master''] where [''Account Index Master''].[ACTINDX] = [''Purchasing Requisition Line History''].[INVINDX]) as ''' + @Inventory_Account_Number + ''', ' + '''' + @Item_Tracking_Option+ ''' = dbo.DYN_FUNC_Item_Tracking_Option([''Purchasing Requisition Line History''].[ITMTRKOP]), '+ '[''Purchasing Requisition Line History''].[LineNumber] as ''' + @LineNumber + ''', ' + '''' + @MC_Transaction_State + ''' = dbo.DYN_FUNC_MC_Transaction_State([''Purchasing Requisition Line History''].[MCTRXSTT]), ' + '''' + @Non_IV + ''' = dbo.DYN_FUNC_Boolean_All([''Purchasing Requisition Line History''].[NONINVEN]), ' +  '[''Purchasing Requisition Line History''].[ORD] as ''' + @Ord + ''', ' +  '''' + @Originating_Decimal_Places_Currency+ ''' = dbo.DYN_FUNC_Currency_Decimals([''Purchasing Requisition Line History''].[ODECPLCU]), '+ '[''Purchasing Requisition Line History''].[OREXTCST] as ''' + @Originating_Extended_Cost + ''', ' + '[''Purchasing Requisition Line History''].[ORFRTAMT] as ''' + @Originating_Freight_Amount + ''', ' + '[''Purchasing Requisition Line History''].[ORTAXAMT] as ''' + @Originating_Tax_Amount + ''', ' + 'rtrim([''Purchasing Requisition Line History''].[PHONE1]) as ''' + @Phone_1 + ''', ' +  'rtrim([''Purchasing Requisition Line History''].[PHONE2]) as ''' + @Phone_2 + ''', ' +  'rtrim([''Purchasing Requisition Line History''].[PHONE3]) as ''' + @Phone_3 + ''', ' +  '[''Purchasing Requisition Line History''].[QTYCMTBASE] as ''' + @QTY_Committed_In_Base + ''', ' +  '[''Purchasing Requisition Line History''].[QTYUNCMTBASE] as ''' + @QTY_Uncommitted_In_Base + ''', ' +  '''' + @Rate_Calc_Method + ''' = dbo.DYN_FUNC_Rate_Calculation_Method([''Purchasing Requisition Line History''].[RATECALC]), ' +  'rtrim([''Purchasing Requisition Line History''].[RATETPID]) as ''' + @Rate_Type_ID + ''', ' +  '[''Purchasing Requisition Line History''].[ACCNTNTINDX] as ''' + @Req_Note_ID_Account + ''', ' +  '[''Purchasing Requisition Line History''].[Comment_Note_Index] as ''' + @Req_Note_ID_Comment + ''', ' +  '[''Purchasing Requisition Line History''].[Item_Number_Note_Index] as ''' + @Req_Note_ID_Inventory + ''', ' +  '[''Purchasing Requisition Line History''].[Location_Code_Note_Index] as ''' + @Req_Note_ID_Location + ''', ' +  '[''Purchasing Requisition Line History''].[ShippingMethodNoteIndex] as ''' + @Req_Note_ID_Shipping + ''', ' +  '[''Purchasing Requisition Line History''].[Vendor_Note_Index] as ''' + @Req_Note_ID_Vendor + ''', ' +  '[''Purchasing Requisition Line History''].[REQDATE] as ''' + @Required_Date + ''', ' +  '''' + @Requisition_Status + ''' = dbo.DYN_FUNC_Requisition_Status([''Purchasing Requisition History''].[RequisitionStatus]), '+ 'rtrim([''Purchasing Requisition Line History''].[SHIPMTHD]) as ''' + @Shipping_Method + ''', ' +  'rtrim([''Purchasing Requisition Line History''].[LOCNCODE]) as ''' + @Site_ID + ''', ' +  'rtrim([''Purchasing Requisition Line History''].[STATE]) as ''' + @State + ''', ' +  '[''Purchasing Requisition Line History''].[TAXAMNT] as ''' + @Tax_Amount + ''', ' + 'rtrim([''Purchasing Requisition Line History''].[UOFM]) as ''' + @U_Of_M + ''', ' +  '[''Purchasing Requisition Line History''].[UMQTYINB] as ''' + @U_Of_M_QTY_In_Base + ''', ' + 'rtrim([''Purchasing Requisition Line History''].[USERDEF1]) as ''' + @User_Defined_1 + ''', ' +  'rtrim([''Purchasing Requisition Line History''].[USERDEF1]) as ''' + @User_Defined_2 + ''', ' +  '''' + @Valuation_Method + ''' = dbo.DYN_FUNC_Valuation_Method([''Purchasing Requisition Line History''].[VCTNMTHD]), '+ 'rtrim([''Purchasing Requisition Line History''].[ZIPCODE]) as ''' + @Zip_Code + ''', ' + '''' + @POPRequisitionNumber_For_DrillBack + ''' = ''' + @DrillBack_Base_Url + ''' +dbo.dgppPurchaseRequisitionNumber(1,[''Purchasing Requisition Line History''].[POPRequisitionNumber],1 ) '  select @sqljoinstring =   'from [POP30210] as [''Purchasing Requisition Line History''] with (NOLOCK) ' + 'left outer join [POP30200] as [''Purchasing Requisition History''] with (NOLOCK) ' + 'on [''Purchasing Requisition Line History''].[POPRequisitionNumber] = [''Purchasing Requisition History''].[POPRequisitionNumber] '  select @sqlaccessstring =   'GRANT SELECT ON [dbo].[PurchaseRequisitionLines] TO [rpt_operations manager]' + 'GRANT SELECT ON [dbo].[PurchaseRequisitionLines] TO [rpt_purchasing agent]' + 'GRANT SELECT ON [dbo].[PurchaseRequisitionLines] TO [rpt_purchasing manager]' + 'GRANT SELECT ON [dbo].[PurchaseRequisitionLines] TO [rpt_accounting manager]' + 'GRANT SELECT ON [dbo].[PurchaseRequisitionLines] TO [rpt_executive]' + 'GRANT SELECT ON [dbo].[PurchaseRequisitionLines] TO [DYNGRP]'   exec (@sqldropstring)  exec (@sqldefaultstring+' '+@sqlstring1+' '+@sqlstring2+' '+@sqlstring3+' '+@sqlstring4+' '+@sqlstring5+' '+@sqlstring6+' '+@sqlstring7+' '+@sqlstring8+' '+@sqlstring9  +' '+@sqlstring10+' '+@sqljoinstring)  exec (@sqlaccessstring)   set nocount off    
GO
GRANT EXECUTE ON  [dbo].[sp_Dynamics_PurchaseRequisitionLines] TO [DYNGRP]
GO
