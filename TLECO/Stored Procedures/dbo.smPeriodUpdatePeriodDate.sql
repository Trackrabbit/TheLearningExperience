SET QUOTED_IDENTIFIER OFF
GO
SET ANSI_NULLS ON
GO
 create procedure [dbo].[smPeriodUpdatePeriodDate] @I_dPeriodDate datetime = NULL, @I_sPeriodID smallint = NULL, @I_sYear smallint = NULL, @I_iSQLSessionID int = NULL, @O_iErrorState int = NULL output  as  declare  @tTransaction tinyint,  @iNumberOfRecords1  int,  @iNumberOfRecords2  int,  @iNumberOfRecords3  int,  @iNumberOfRecords4  int,  @RowCount1      int,  @RowCount2      int,  @RowCount3      int,  @RowCount4      int   if @I_dPeriodDate is NULL or  @I_sPeriodID is NULL or  @I_sYear is NULL or  @I_iSQLSessionID is NULL begin  select  @O_iErrorState = 20317  return end  select  @O_iErrorState = 0  if @@trancount = 0 begin  select  @tTransaction = 1   begin transaction end  select  @iNumberOfRecords1 = count ( FORIGIN ) from  SY40100 where  FORIGIN  >= 0 and  SERIES  >= 0 and  PERIODID = @I_sPeriodID and  YEAR1  = @I_sYear  select  @iNumberOfRecords2 = count ( 1 ) from GL00201 where  PERIODID = @I_sPeriodID and  YEAR1  = @I_sYear  select  @iNumberOfRecords3 = count ( 1 ) from GL12001 where  PERIODID = @I_sPeriodID and  YEAR1  = @I_sYear  select  @iNumberOfRecords4 = count ( 1 ) from GL32000 where  PERIODID = @I_sPeriodID and  YEAR1  = @I_sYear  if @iNumberOfRecords1 > 0 or @iNumberOfRecords2 > 0 or @iNumberOfRecords3 > 0 or @iNumberOfRecords4 > 0 begin  update  SY40100  set  PERIODDT = @I_dPeriodDate  where  FORIGIN  >= 0 and  SERIES  >= 0 and  PERIODID = @I_sPeriodID and  YEAR1  = @I_sYear   select @RowCount1 = @@RowCount  UPDATE   GL00201   SET   PERIODDT   =  @I_dPeriodDate   WHERE  GL00201.YEAR1   =  @I_sYear  AND   GL00201.PERIODID  =  @I_sPeriodID   Select @RowCount2 = @@RowCount   UPDATE   GL12001   SET   PERIODDT   =  @I_dPeriodDate   WHERE  GL12001.YEAR1   =  @I_sYear  AND   GL12001.PERIODID  =  @I_sPeriodID  Select @RowCount3 = @@RowCount   UPDATE   GL32000   SET   PERIODDT   =  @I_dPeriodDate   WHERE  GL32000.YEAR1   =  @I_sYear  AND   GL32000.PERIODID  =  @I_sPeriodID  Select @RowCount4 = @@RowCount   if @iNumberOfRecords1 <> @RowCount1 or   @iNumberOfRecords2 <> @RowCount2 or   @iNumberOfRecords3 <> @RowCount3 or   @iNumberOfRecords4 <> @RowCount4  begin  select  @O_iErrorState = 20340   if @tTransaction > 0  rollback transaction  return  end end  if @tTransaction > 0  commit transaction return    
GO
GRANT EXECUTE ON  [dbo].[smPeriodUpdatePeriodDate] TO [DYNGRP]
GO
