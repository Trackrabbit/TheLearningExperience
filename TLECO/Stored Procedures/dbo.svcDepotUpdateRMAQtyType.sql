SET QUOTED_IDENTIFIER OFF
GO
SET ANSI_NULLS ON
GO
 CREATE Procedure [dbo].[svcDepotUpdateRMAQtyType]  (  @WO char(15),  @RMANumber char(15),   @Line Numeric(19,5),  @svcRMAComponentSeq int ,  @ProcessSeq numeric(19,5),  @ProcessQty numeric(19,5),  @FromQtyType smallint,  @ToQtyType smallint ) as  declare @SerialLotSeq int  if exists(select * from SVC05210 where SVC_Document_Number = @WO and SVC_Process_QTY > 0 and SVC_Process_Type =5 and   RETDOCID = @RMANumber and LNSEQNBR = @Line and CMPNTSEQ = @svcRMAComponentSeq and QTYTYPE = @FromQtyType and SVC_Process_SEQ_Number = @ProcessSeq)  begin   update SVC05210 with (rowlock) set QTYTYPE = @ToQtyType, @SerialLotSeq = SLTSQNUM  where SVC_Document_Number = @WO and SVC_Process_QTY > 0 and SVC_Process_Type =5 and   RETDOCID = @RMANumber and LNSEQNBR = @Line and CMPNTSEQ = @svcRMAComponentSeq and QTYTYPE = @FromQtyType and SVC_Process_SEQ_Number = @ProcessSeq  if exists(select * from SVC05255 where RETDOCID = @RMANumber and LNSEQNBR = @Line and CMPNTSEQ = @svcRMAComponentSeq and QTYTYPE = @FromQtyType)  update SVC05255 with (rowlock) set QTYTYPE = @ToQtyType  where RETDOCID = @RMANumber and LNSEQNBR = @Line and CMPNTSEQ = @svcRMAComponentSeq and QTYTYPE = @FromQtyType  if exists(select * from SVC05212 where RETDOCID = @RMANumber and LNSEQNBR = @Line and CMPNTSEQ = @svcRMAComponentSeq and QTYTYPE = @FromQtyType)  update SVC05212 with (rowlock) set QTYTYPE = @ToQtyType  where RETDOCID = @RMANumber and LNSEQNBR = @Line and CMPNTSEQ = @svcRMAComponentSeq and QTYTYPE = @FromQtyType  update SVC05200 with (rowlock) set   QTYONHND = case when @FromQtyType = 1 then QTYONHND - @ProcessQty when @ToQtyType = 1 then QTYONHND + @ProcessQty else QTYONHND end,  QTYRTRND = case when @FromQtyType = 2 then QTYRTRND - @ProcessQty when @ToQtyType = 2 then QTYRTRND + @ProcessQty else QTYRTRND end ,  QTYINUSE = case when @FromQtyType = 3 then QTYINUSE - @ProcessQty when @ToQtyType = 3 then QTYINUSE + @ProcessQty else QTYINUSE end,  QTYINSVC = case when @FromQtyType = 4 then QTYINSVC - @ProcessQty when @ToQtyType = 4 then QTYINSVC + @ProcessQty else QTYINSVC end,  QTYDMGED = case when @FromQtyType = 5 then QTYDMGED - @ProcessQty when @ToQtyType = 5 then QTYDMGED + @ProcessQty else QTYDMGED end   where RETDOCID = @RMANumber and LNSEQNBR = @Line and svcRMAComponentSeq = @svcRMAComponentSeq  end  return    
GO
GRANT EXECUTE ON  [dbo].[svcDepotUpdateRMAQtyType] TO [DYNGRP]
GO
