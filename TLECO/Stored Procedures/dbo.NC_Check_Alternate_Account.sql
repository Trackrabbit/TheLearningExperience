SET QUOTED_IDENTIFIER OFF
GO
SET ANSI_NULLS ON
GO
create procedure [dbo].[NC_Check_Alternate_Account]    @Module  int,    @Account varchar(1000) output,    @JRNENTRY int,    @VCHRNMBR char(21)   as   begin    set nocount on    declare  @NC_Dest_Accs_Required  smallint,       @NC_Dest_Account_Index  int,       @DSTINDX     int,       @SQL      nvarchar(4000),       @Parameter     nvarchar(4000)    set @DSTINDX = 0    set @NC_Dest_Account_Index = 0    select top 1 @NC_Dest_Accs_Required = NC_Dest_Accs_Required from NCIC3000     if @NC_Dest_Accs_Required <> 1 return     if @Module = 1 /*GL*/    begin     select top 1 @DSTINDX = ACTINDX from GL10001 where ACTINDX in (select NC_Src_IC_Account_Index from NCIC3005)  		and  JRNENTRY = @JRNENTRY   if @DSTINDX is null set @DSTINDX = 0      if @DSTINDX <> 0      begin      select @NC_Dest_Account_Index = NC_Dest_Account_Index from NCIC3006        where JRNENTRY = @JRNENTRY and NC_Src_IC_Account_Index = @DSTINDX      if @NC_Dest_Account_Index is null set @NC_Dest_Account_Index = 0      if @NC_Dest_Account_Index = 0       select top 1 @Account = ACTNUMST from GL00105 where ACTINDX = @DSTINDX     end      end    if @Module = 2 /*PM*/    begin     select top 1 @DSTINDX = DSTINDX from PM10100 where DSTINDX in (select NC_Src_IC_Account_Index from NCIC3005) and 		VCHRNMBR = @VCHRNMBR   if @DSTINDX is null set @DSTINDX = 0      if @DSTINDX <> 0      begin      select @NC_Dest_Account_Index = NC_Dest_Account_Index from NCIC3006        where VCHRNMBR = @VCHRNMBR and NC_Src_IC_Account_Index = @DSTINDX      if @NC_Dest_Account_Index is null set @NC_Dest_Account_Index = 0      if @NC_Dest_Account_Index = 0       select top 1 @Account = ACTNUMST from GL00105 where ACTINDX = @DSTINDX     end      end    if @Module = 3 /*JOB*/    begin     set @SQL = 'select top 1 @DSTINDX = ACTINDX from JC10302 where ACTINDX in (select NC_Src_IC_Account_Index from NCIC3005) and JRNENTRY =  @JRNENTRY'     set @Parameter = '@DSTINDX int output , @JRNENTRY int'     exec sp_executesql @SQL,@Parameter, @DSTINDX = @DSTINDX output, @JRNENTRY = @JRNENTRY       if @DSTINDX is null set @DSTINDX = 0      if @DSTINDX <> 0      begin      select @NC_Dest_Account_Index = NC_Dest_Account_Index from NCIC3006        where JRNENTRY = @JRNENTRY and NC_Src_IC_Account_Index = @DSTINDX      if @NC_Dest_Account_Index is null set @NC_Dest_Account_Index = 0      if @NC_Dest_Account_Index = 0      select top 1 @Account = ACTNUMST from GL00105 where ACTINDX = @DSTINDX     end      end    set nocount off   end  
GO
GRANT EXECUTE ON  [dbo].[NC_Check_Alternate_Account] TO [DYNGRP]
GO
GRANT EXECUTE ON  [dbo].[NC_Check_Alternate_Account] TO [public]
GO
