SET QUOTED_IDENTIFIER OFF
GO
SET ANSI_NULLS ON
GO
 create procedure [dbo].[taCreateVendorAddress]  @I_vVENDORID char(15),    @I_vADRSCODE char(15),    @I_vUPSZONE char(3) = null,   @I_vSHIPMTHD char(15) = null,   @I_vTAXSCHID char(15) = null,   @I_vVNDCNTCT char(60) = null,   @I_vADDRESS1 char(60) = null,   @I_vADDRESS2 char(60) = null,     @I_vADDRESS3 char(60) = null,     @I_vCOUNTRY char(60) = null,   @I_vCITY char(35) = null,   @I_vSTATE char(29) = null,   @I_vZIPCODE char(10) = null,    @I_vPHNUMBR1 char(21) = null,   @I_vPHNUMBR2 char(21) = null,   @I_vPHNUMBR3 char(21) = null,   @I_vFAXNUMBR char(21) = null,   @I_vUpdateIfExists tinyint = 1,   @I_vRequesterTrx smallint = 0,   @I_vCCode char(6) = null,   @I_vUSRDEFND1 char(50) = null,       @I_vUSRDEFND2 char(50) = null,       @I_vUSRDEFND3 char(50) = null,       @I_vUSRDEFND4 varchar(8000) = null,  @I_vUSRDEFND5 varchar(8000) = null,  @O_iErrorState int output, @oErrString varchar(255) output  with encryption as  set transaction isolation level read uncommitted set nocount on  declare  @EmailPOs tinyint,     @POEmailRecipient char(80),    @EmailPOFormat smallint,    @FaxPOs tinyint,     @POFaxNumber char(21),     @FaxPOFormat smallint,     @iAddCodeErrState int,     @iStatus int,      @iAddShippingErrState int,    @iAddShippingErrString varchar(255),   @iError int,      @iCustomState int,  @iCustomErrString varchar(255),  @O_oErrorState int,  @CCode char(6),  @COUNTRY char(60),  @exists tinyint,  @Workflow_Status smallint,  @Workflow_Priority smallint  select  @O_iErrorState = 0,     @EmailPOs = 0,      @POEmailRecipient = '',     @EmailPOFormat = 0,     @FaxPOs = 0,      @POFaxNumber = '',     @FaxPOFormat = 0,     @iAddCodeErrState = 0,  @iStatus = 0,  @iAddShippingErrState = 0,  @iAddShippingErrString = '',  @iError = 0,  @iCustomState = 0,  @iCustomErrString = '',  @O_oErrorState = 0,  @CCode = '',  @COUNTRY = '',  @exists = 0,  @Workflow_Status = 0,  @Workflow_Priority = 0  if (@oErrString is NULL) begin  select @oErrString = '' end  exec @iStatus = taCreateVendorAddressPre  @I_vVENDORID output,  @I_vADRSCODE output,  @I_vUPSZONE output,  @I_vSHIPMTHD output,  @I_vTAXSCHID output,  @I_vVNDCNTCT output,  @I_vADDRESS1 output,  @I_vADDRESS2 output,  @I_vADDRESS3 output,  @I_vCOUNTRY output,  @I_vCITY output,  @I_vSTATE output,  @I_vZIPCODE output,  @I_vPHNUMBR1 output,  @I_vPHNUMBR2 output,  @I_vPHNUMBR3 output,  @I_vFAXNUMBR output,  @I_vUpdateIfExists output,  @I_vRequesterTrx output,  @I_vCCode output,  @I_vUSRDEFND1 output,  @I_vUSRDEFND2 output,  @I_vUSRDEFND3 output,  @I_vUSRDEFND4 output,  @I_vUSRDEFND5 output,  @O_iErrorState  = @iCustomState output,  @oErrString = @iCustomErrString output  select @iError = @@error if ((@iStatus <> 0) or (@iCustomState <> 0) or (@iError <> 0)) begin  select @O_iErrorState = 9225    exec @iStatus = taUpdateString  @O_iErrorState,  @iCustomErrString,  @oErrString output,  @O_oErrorState output  return (@O_iErrorState) end  if (  @I_vVENDORID is null or  @I_vADRSCODE is null or  @I_vUpdateIfExists is null or  @I_vRequesterTrx is null  ) begin  select @O_iErrorState = 902    exec @iStatus = taUpdateString  @O_iErrorState,  @iCustomErrString,  @oErrString output,  @O_oErrorState output end  select  @I_vVENDORID = UPPER(@I_vVENDORID),  @I_vADRSCODE = UPPER(@I_vADRSCODE),  @I_vSHIPMTHD = UPPER(@I_vSHIPMTHD),  @I_vTAXSCHID = UPPER(@I_vTAXSCHID),  @I_vCCode = UPPER(@I_vCCode)     select  @CCode = @I_vCCode,  @COUNTRY = @I_vCOUNTRY  if (@I_vVENDORID = '') begin  select @O_iErrorState = 900    exec @iStatus = taUpdateString  @O_iErrorState,  @iCustomErrString,  @oErrString output,  @O_oErrorState output end  if (@I_vADRSCODE = '') begin  select @O_iErrorState = 903    exec @iStatus = taUpdateString  @O_iErrorState,  @iCustomErrString,  @oErrString output,  @O_oErrorState output end  if (exists(select 1 from PM00300 (nolock) where VENDORID = @I_vVENDORID and ADRSCODE = @I_vADRSCODE)) begin  select @exists = 1 end  if (@exists = 0) begin  select  @I_vUPSZONE =  case  when @I_vUPSZONE is null  then ''  else @I_vUPSZONE  end,  @I_vSHIPMTHD =  case  when @I_vSHIPMTHD is null  then ''  else @I_vSHIPMTHD  end,  @I_vTAXSCHID =  case  when @I_vTAXSCHID is null  then ''  else @I_vTAXSCHID  end,  @I_vVNDCNTCT =  case  when @I_vVNDCNTCT is null  then ''  else @I_vVNDCNTCT  end,  @I_vADDRESS1 =  case  when @I_vADDRESS1 is null  then ''  else @I_vADDRESS1  end,  @I_vADDRESS2 =  case  when @I_vADDRESS2 is null  then ''  else @I_vADDRESS2  end,  @I_vADDRESS3 =  case  when @I_vADDRESS3 is null  then ''  else @I_vADDRESS3  end,  @I_vCITY =  case  when @I_vCITY is null  then ''  else @I_vCITY  end,  @I_vSTATE =  case  when @I_vSTATE is null  then ''  else @I_vSTATE  end,  @I_vZIPCODE =  case  when @I_vZIPCODE is null  then ''  else @I_vZIPCODE  end,  @I_vPHNUMBR1 =  case  when @I_vPHNUMBR1 is null  then ''  else @I_vPHNUMBR1  end,  @I_vPHNUMBR2 =  case  when @I_vPHNUMBR2 is null  then ''  else @I_vPHNUMBR2  end,  @I_vPHNUMBR3 =  case  when @I_vPHNUMBR3 is null  then ''  else @I_vPHNUMBR3  end,  @I_vFAXNUMBR =  case  when @I_vFAXNUMBR is null  then ''  else @I_vFAXNUMBR  end,  @I_vCCode =  case  when @I_vCCode is null  then ''  else @I_vCCode  end   if ((@I_vCOUNTRY is null) and (@I_vCCode <> ''))  begin  select @I_vCOUNTRY = CCodeDesc from VAT10001 (nolock) where CCode = @I_vCCode  end   if (@I_vCOUNTRY is null)  begin  select @I_vCOUNTRY = ''  end end else begin  select  @I_vUPSZONE =  case  when @I_vUPSZONE is null  then UPSZONE  else @I_vUPSZONE  end,  @I_vSHIPMTHD =  case  when @I_vSHIPMTHD is null  then SHIPMTHD  else @I_vSHIPMTHD  end,  @I_vTAXSCHID =  case  when @I_vTAXSCHID is null  then TAXSCHID  else @I_vTAXSCHID  end,  @I_vVNDCNTCT =  case  when @I_vVNDCNTCT is null  then VNDCNTCT  else @I_vVNDCNTCT  end,  @I_vADDRESS1 =  case  when @I_vADDRESS1 is null  then ADDRESS1  else @I_vADDRESS1  end,  @I_vADDRESS2 =  case  when @I_vADDRESS2 is null  then ADDRESS2  else @I_vADDRESS2  end,  @I_vADDRESS3 =  case  when @I_vADDRESS3 is null  then ADDRESS3  else @I_vADDRESS3  end,  @I_vCOUNTRY =       case  when @I_vCOUNTRY is null  then COUNTRY  else @I_vCOUNTRY  end,  @I_vCITY =  case  when @I_vCITY is null  then CITY  else @I_vCITY  end,  @I_vSTATE =  case  when @I_vSTATE is null  then STATE  else @I_vSTATE  end,  @I_vZIPCODE =  case  when @I_vZIPCODE is null  then ZIPCODE  else @I_vZIPCODE  end,  @I_vPHNUMBR1 =  case  when @I_vPHNUMBR1 is null  then PHNUMBR1  else @I_vPHNUMBR1  end,  @I_vPHNUMBR2 =  case  when @I_vPHNUMBR2 is null  then PHNUMBR2  else @I_vPHNUMBR2  end,  @I_vPHNUMBR3 =  case  when @I_vPHNUMBR3 is null  then PHONE3  else @I_vPHNUMBR3  end,  @I_vFAXNUMBR =  case  when @I_vFAXNUMBR is null  then FAXNUMBR  else @I_vFAXNUMBR  end,  @I_vCCode =  case  when @I_vCCode is null  then CCode  else @I_vCCode  end  from PM00300 (nolock) where VENDORID = @I_vVENDORID and ADRSCODE = @I_vADRSCODE   if ((@CCode is not null) and (@COUNTRY is null))  begin  select @I_vCOUNTRY = CCodeDesc from VAT10001 (nolock) where CCode = @I_vCCode  end   if ((@CCode = '') and (@COUNTRY is null))  begin  select @I_vCOUNTRY = ''  end end  if (@I_vVENDORID <> '') begin  if not exists(select 1 from PM00200 (nolock) where VENDORID = @I_vVENDORID)  begin   select @O_iErrorState = 906    exec @iStatus = taUpdateString  @O_iErrorState,  @iCustomErrString,  @oErrString output,  @O_oErrorState output  end end  if (@I_vTAXSCHID <> '') begin  if not exists(select 1 from TX00102 (nolock) where TAXSCHID = @I_vTAXSCHID)  begin   select @O_iErrorState = 904    exec @iStatus = taUpdateString  @O_iErrorState,  @iCustomErrString,  @oErrString output,  @O_oErrorState output  end end  if (@I_vCCode <> '') begin  if (not exists(select 1 from VAT10001 (nolock) where CCode = @I_vCCode))  begin   select @O_iErrorState = 6301     exec @iStatus = taUpdateString  @O_iErrorState,  @iCustomErrString,  @oErrString output,  @O_oErrorState output  end end  if (@I_vUpdateIfExists not in(0,1)) begin  select @O_iErrorState = 8145     exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output end  if (exists (select 1 from PM00300 (nolock) where VENDORID = @I_vVENDORID and ADRSCODE = @I_vADRSCODE)) and (@I_vUpdateIfExists = 0) begin  select @O_iErrorState = 8146     exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output end  if (@I_vSHIPMTHD <> '') begin  if (not exists(select 1 from SY03000 (nolock) where SHIPMTHD = @I_vSHIPMTHD))  begin  exec @iStatus = taCreateShippingMethod  @I_vSHIPMTHD = @I_vSHIPMTHD,  @I_vUpdateIfExists = 0,  @O_iErrorState = @iAddShippingErrState output,  @oErrString = @iAddShippingErrString output  select @iError = @@error  if ((@iStatus <> 0) or (@iAddShippingErrState <> 0) or (@iError <> 0))  begin  select @oErrString = rtrim(@oErrString) + ' ' + @iAddShippingErrString  select @O_iErrorState = 911    exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output  return (@O_iErrorState)  end  end end  if (@I_vRequesterTrx = 0) begin  exec @iStatus = eConnectOutVerify  @I_vDOCTYPE = 'Vendor',  @I_vINDEX1 = @I_vVENDORID,  @I_vINDEX2 = '',  @I_vINDEX3 = '',  @I_vINDEX4 = '',  @I_vINDEX5 = '',  @I_vINDEX6 = '',  @I_vINDEX7 = '',  @I_vINDEX8 = '',  @I_vINDEX9 = '',  @I_vINDEX10 = '',  @I_vINDEX11 = '',  @I_vINDEX12 = '',  @I_vINDEX13 = '',  @I_vINDEX14 = '',  @I_vINDEX15 = '',  @I_vDelete = 0,  @O_iErrorState = @iCustomState output  select @iError = @@error  if ((@iStatus <> 0) or (@iCustomState <> 0) or (@iError <> 0))  begin  select @oErrString = rtrim(@oErrString) + ' ' + @iCustomState  select @O_iErrorState = 2023    exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output  return (@O_iErrorState)  end end  if (@O_iErrorState = 0) begin  if (not exists (select 1 from PM00300 (nolock) where VENDORID = @I_vVENDORID and ADRSCODE = @I_vADRSCODE))  begin  if exists (select Workflow_Type_Name from  WF100001 where FormID = 210) and exists (select 1 from WF100002 where WF100002.ACTIVE = 1 and   Workflow_Type_Name = (select Workflow_Type_Name from WF100001 where FormID = 210 ))   Begin  select @Workflow_Status = Workflow_Status , @Workflow_Priority = Workflow_Priority from PM00200 where VENDORID = @I_vVENDORID  if @Workflow_Status not in (1,9)  Begin  select @O_iErrorState = 12015    exec @iStatus = taUpdateString  @O_iErrorState,  @iCustomErrString,  @oErrString output,  @O_oErrorState output  end  End  if @O_iErrorState = 0  Begin  insert into PM00300 (  VENDORID,  ADRSCODE,  UPSZONE,  SHIPMTHD,  TAXSCHID,  VNDCNTCT,  ADDRESS1,  ADDRESS2,  ADDRESS3,  COUNTRY,  CITY,  STATE,  ZIPCODE,  PHNUMBR1,  PHNUMBR2,  PHONE3,  FAXNUMBR,  EmailPOs,  POEmailRecipient,  EmailPOFormat,  FaxPOs,  POFaxNumber,  FaxPOFormat,  CCode,      DECLID      )  select  @I_vVENDORID,    @I_vADRSCODE,    @I_vUPSZONE,    @I_vSHIPMTHD,    @I_vTAXSCHID,    @I_vVNDCNTCT,    @I_vADDRESS1,    @I_vADDRESS2,    @I_vADDRESS3,    @I_vCOUNTRY,    @I_vCITY,    @I_vSTATE,    @I_vZIPCODE,    @I_vPHNUMBR1,    @I_vPHNUMBR2,    @I_vPHNUMBR3,    @I_vFAXNUMBR,    @EmailPOs,    @POEmailRecipient,   @EmailPOFormat,    @FaxPOs,    @POFaxNumber,    @FaxPOFormat,    @I_vCCode,    ''     if (@@error <> 0)  begin  select @O_iErrorState = 905    exec @iStatus = taUpdateString  @O_iErrorState,  @iCustomErrString,  @oErrString output,  @O_oErrorState output  end  end  end  else  begin  if (@I_vUpdateIfExists = 1)   begin  if exists (select Workflow_Type_Name from  WF100001 where FormID = 210) and exists (select 1 from WF100002 where WF100002.ACTIVE = 1 and   Workflow_Type_Name = (select Workflow_Type_Name from WF100001 where FormID = 210 ))   Begin  select @Workflow_Status = Workflow_Status , @Workflow_Priority = Workflow_Priority from PM00200 where VENDORID = @I_vVENDORID  if @Workflow_Status not in (1,9)  Begin  select @O_iErrorState = 12009    exec @iStatus = taUpdateString  @O_iErrorState,  @iCustomErrString,  @oErrString output,  @O_oErrorState output  end  End  Else  Begin  select @Workflow_Status = 9, @Workflow_Priority = 0  End   if @O_iErrorState = 0  Begin   update PM00300 set  UPSZONE  = @I_vUPSZONE,  SHIPMTHD = @I_vSHIPMTHD,  TAXSCHID = @I_vTAXSCHID,  VNDCNTCT = @I_vVNDCNTCT,  ADDRESS1 = @I_vADDRESS1,  ADDRESS2 = @I_vADDRESS2,  ADDRESS3 = @I_vADDRESS3,  COUNTRY  = @I_vCOUNTRY,  CITY  = @I_vCITY,  STATE  = @I_vSTATE,  ZIPCODE  = @I_vZIPCODE,  PHNUMBR1 = @I_vPHNUMBR1,  PHNUMBR2 = @I_vPHNUMBR2,  PHONE3  = @I_vPHNUMBR3,  FAXNUMBR = @I_vFAXNUMBR,  CCode = @I_vCCode     where VENDORID = @I_vVENDORID and ADRSCODE = @I_vADRSCODE  if (@@error <> 0)  begin  select @O_iErrorState = 912    exec @iStatus = taUpdateString  @O_iErrorState,  @iCustomErrString,  @oErrString output,  @O_oErrorState output  end  end  end   if @O_iErrorState = 0  Begin  update PM00200 set  ADDRESS1 = @I_vADDRESS1,  ADDRESS2 = @I_vADDRESS2,  ADDRESS3 = @I_vADDRESS3,  CITY = @I_vCITY,  STATE = @I_vSTATE,  ZIPCODE = @I_vZIPCODE,  COUNTRY = @I_vCOUNTRY,  PHNUMBR1 = @I_vPHNUMBR1,  PHNUMBR2 = @I_vPHNUMBR2,  PHONE3 = @I_vPHNUMBR3,  FAXNUMBR = @I_vFAXNUMBR,  UPSZONE = @I_vUPSZONE,  SHIPMTHD = @I_vSHIPMTHD,  TAXSCHID = @I_vTAXSCHID,  MODIFDT = convert(varchar(12),getdate()),  CCode = @I_vCCode  where VENDORID = @I_vVENDORID and VADDCDPR = @I_vADRSCODE  if (@@error <> 0)  begin  select @O_iErrorState = 9385    exec @iStatus = taUpdateString  @O_iErrorState,  @iCustomErrString,  @oErrString output,  @O_oErrorState output  return (@O_iErrorState)  end  End  end end  exec @iStatus = taCreateVendorAddressPost  @I_vVENDORID,  @I_vADRSCODE,  @I_vUPSZONE,  @I_vSHIPMTHD,  @I_vTAXSCHID,  @I_vVNDCNTCT,  @I_vADDRESS1,  @I_vADDRESS2,  @I_vADDRESS3,  @I_vCOUNTRY,  @I_vCITY,  @I_vSTATE,  @I_vZIPCODE,  @I_vPHNUMBR1,  @I_vPHNUMBR2,  @I_vPHNUMBR3,  @I_vFAXNUMBR,  @I_vUpdateIfExists,  @I_vRequesterTrx,  @I_vCCode,  @I_vUSRDEFND1,  @I_vUSRDEFND2,  @I_vUSRDEFND3,  @I_vUSRDEFND4,  @I_vUSRDEFND5,  @O_iErrorState  = @iCustomState output,  @oErrString = @iCustomErrString output  select @iError = @@error if ((@iStatus <> 0) or (@iCustomState <> 0) or (@iError <> 0)) begin  select @O_iErrorState = 9226    exec @iStatus = taUpdateString  @O_iErrorState,  @iCustomErrString,  @oErrString output,  @O_oErrorState output  return (@O_iErrorState) end  if (@I_vRequesterTrx = 0) begin  exec @iStatus = eConnectOutVerify  @I_vDOCTYPE = 'Vendor',  @I_vINDEX1 = @I_vVENDORID,  @I_vINDEX2 = '',  @I_vINDEX3 = '',  @I_vINDEX4 = '',  @I_vINDEX5 = '',  @I_vINDEX6 = '',  @I_vINDEX7 = '',  @I_vINDEX8 = '',  @I_vINDEX9 = '',  @I_vINDEX10 = '',  @I_vINDEX11 = '',  @I_vINDEX12 = '',  @I_vINDEX13 = '',  @I_vINDEX14 = '',  @I_vINDEX15 = '',  @I_vDelete = 1,  @O_iErrorState = @iCustomState output  select @iError = @@error  if ((@iStatus <> 0) or (@iCustomState <> 0) or (@iError <> 0))  begin  select @oErrString = rtrim(@oErrString) + ' ' + @iCustomState  select @O_iErrorState = 2024    exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output  return (@O_iErrorState)  end end  return (@O_iErrorState)   
GO
GRANT EXECUTE ON  [dbo].[taCreateVendorAddress] TO [DYNGRP]
GO
