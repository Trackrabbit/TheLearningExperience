SET QUOTED_IDENTIFIER OFF
GO
SET ANSI_NULLS ON
GO
 CREATE PROCEDURE [dbo].[sp_Dynamics_InventoryPurchaseReceipts] @iLanguageID int  as  set nocount on   declare @sqldropstring varchar(400),  @sqldefaultstring varchar(8000),  @sqlstring1 varchar(8000),  @sqlstring2 varchar(8000),  @sqlstring3 varchar(8000),  @sqlstring4 varchar(8000),  @sqlstring5 varchar(8000),  @sqlstring6 varchar(8000),  @sqlstring7 varchar(8000),  @sqlstring8 varchar(8000),  @sqlstring9 varchar(8000),  @sqlstring10 varchar(8000),  @sqljoinstring varchar(8000),  @sqlaccessstring varchar(2000),  @tNumberSegments int,  @tSegment int,  @I_iDictID int,  @I_iLangID int,  @I_iMessageNumber int,  @I_iAliasMessageNumber int,  @I_iIntegerValue int,  @Item_Number varchar(255), @Date_Received varchar(255), @QTY_Received varchar(255), @QTY_Sold varchar(255), @Unit_Cost varchar(255), @QTY_Type varchar(255), @TRX_Location varchar(255), @Purchase_Receipt_Type varchar(255), @Receipt_Number varchar(255), @Vendor_ID varchar(255), @Purchase_Order_Number varchar(255), @Receipt_SEQ_Number varchar(255), @Receipt_Sold varchar(255), @QTY_Reserved varchar(255), @Landed_Cost varchar(255), @Item_Generic_Description varchar(255), @Item_Description varchar(255), @User_Category_Value_1 varchar(255), @User_Category_Value_2 varchar(255), @User_Category_Value_3 varchar(255), @User_Category_Value_4 varchar(255), @User_Category_Value_5 varchar(255), @User_Category_Value_6 varchar(255), @DrillBack_Base_Url varchar(255), @Vendor_ID_For_DrillBack varchar(255), @Item_Number_For_DrillBack varchar(255)  select @DrillBack_Base_Url = DYNAMICS.dbo.createBaseDrillBackUrlString(DB_NAME(),0)  select @I_iDictID = 1493 select @I_iMessageNumber = 31100 select @I_iAliasMessageNumber = 0 exec DYNAMICS..smGetBIMsgString  @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @Item_Number output  select @I_iDictID = 1493 select @I_iMessageNumber = 31101 select @I_iAliasMessageNumber = 0 exec DYNAMICS..smGetBIMsgString  @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @Date_Received output  select @I_iDictID = 1493 select @I_iMessageNumber = 31102 select @I_iAliasMessageNumber = 0 exec DYNAMICS..smGetBIMsgString  @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @QTY_Received output  select @I_iDictID = 1493 select @I_iMessageNumber = 31103 select @I_iAliasMessageNumber = 0 exec DYNAMICS..smGetBIMsgString  @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @QTY_Sold output  select @I_iDictID = 1493 select @I_iMessageNumber = 31104 select @I_iAliasMessageNumber = 0 exec DYNAMICS..smGetBIMsgString  @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @Unit_Cost output  select @I_iDictID = 1493 select @I_iMessageNumber = 31105 select @I_iAliasMessageNumber = 0 exec DYNAMICS..smGetBIMsgString  @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @QTY_Type output  select @I_iDictID = 1493 select @I_iMessageNumber = 31106 select @I_iAliasMessageNumber = 0 exec DYNAMICS..smGetBIMsgString  @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @TRX_Location output  select @I_iDictID = 1493 select @I_iMessageNumber = 31107 select @I_iAliasMessageNumber = 0 exec DYNAMICS..smGetBIMsgString  @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @Purchase_Receipt_Type output  select @I_iDictID = 1493 select @I_iMessageNumber = 31108 select @I_iAliasMessageNumber = 0 exec DYNAMICS..smGetBIMsgString  @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @Receipt_Number output  select @I_iDictID = 1493 select @I_iMessageNumber = 31109 select @I_iAliasMessageNumber = 0 exec DYNAMICS..smGetBIMsgString  @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @Vendor_ID output  select @I_iDictID = 1493 select @I_iMessageNumber = 31110 select @I_iAliasMessageNumber = 0 exec DYNAMICS..smGetBIMsgString  @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @Purchase_Order_Number output  select @I_iDictID = 1493 select @I_iMessageNumber = 31111 select @I_iAliasMessageNumber = 0 exec DYNAMICS..smGetBIMsgString  @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @Receipt_SEQ_Number output  select @I_iDictID = 1493 select @I_iMessageNumber = 31112 select @I_iAliasMessageNumber = 0 exec DYNAMICS..smGetBIMsgString  @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @Receipt_Sold output  select @I_iDictID = 1493 select @I_iMessageNumber = 31113 select @I_iAliasMessageNumber = 0 exec DYNAMICS..smGetBIMsgString  @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @QTY_Reserved output  select @I_iDictID = 1493 select @I_iMessageNumber = 31114 select @I_iAliasMessageNumber = 0 exec DYNAMICS..smGetBIMsgString  @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @Landed_Cost output select @I_iDictID = 1493 select @I_iMessageNumber = 23105 select @I_iAliasMessageNumber = 0 exec DYNAMICS..smGetBIMsgString  @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @Item_Generic_Description output  select @I_iDictID = 1493 select @I_iMessageNumber = 23101 select @I_iAliasMessageNumber = 0 exec DYNAMICS..smGetBIMsgString  @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @Item_Description output  select @I_iDictID = 1493 select @I_iMessageNumber = 23142 select @I_iAliasMessageNumber = 0 exec DYNAMICS..smGetBIMsgString  @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @User_Category_Value_1 output  select @I_iDictID = 1493 select @I_iMessageNumber = 23143 select @I_iAliasMessageNumber = 0 exec DYNAMICS..smGetBIMsgString  @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @User_Category_Value_2 output  select @I_iDictID = 1493 select @I_iMessageNumber = 23144 select @I_iAliasMessageNumber = 0 exec DYNAMICS..smGetBIMsgString  @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @User_Category_Value_3 output  select @I_iDictID = 1493 select @I_iMessageNumber = 23145 select @I_iAliasMessageNumber = 0 exec DYNAMICS..smGetBIMsgString  @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @User_Category_Value_4 output  select @I_iDictID = 1493 select @I_iMessageNumber = 23146 select @I_iAliasMessageNumber = 0 exec DYNAMICS..smGetBIMsgString  @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @User_Category_Value_5 output  select @I_iDictID = 1493 select @I_iMessageNumber = 23147 select @I_iAliasMessageNumber = 0 exec DYNAMICS..smGetBIMsgString  @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @User_Category_Value_6 output  select @I_iDictID = 1493 select @I_iMessageNumber = 23148 select @I_iAliasMessageNumber = 0 exec DYNAMICS..smGetBIMsgString   select @I_iDictID = 1493 select @I_iMessageNumber = 31109 select @I_iAliasMessageNumber = 22214 exec DYNAMICS..smGetBIMsgString  @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @Vendor_ID_For_DrillBack output   select @I_iDictID = 1493 select @I_iMessageNumber = 31100 select @I_iAliasMessageNumber = 22214 exec DYNAMICS..smGetBIMsgString  @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @Item_Number_For_DrillBack output   select @sqldropstring =   'if exists (select * from dbo.sysobjects where id = object_id(N''[dbo].[InventoryPurchaseReceipts]'') and OBJECTPROPERTY(id, N''IsView'') = 1) ' +  'drop view [dbo].[InventoryPurchaseReceipts] '  select @sqldefaultstring =   'CREATE VIEW InventoryPurchaseReceipts AS ' +   'select ' +   'rtrim([''Inventory Purchase Receipts Work''].[ITEMNMBR]) as ''' + @Item_Number + ''', ' + '[''Inventory Purchase Receipts Work''].[DATERECD] as ''' + @Date_Received + ''', ' + '[''Inventory Purchase Receipts Work''].[QTYRECVD] as ''' + @QTY_Received + ''', ' + '[''Inventory Purchase Receipts Work''].[QTYSOLD] as ''' + @QTY_Sold + ''', ' + '[''Inventory Purchase Receipts Work''].[UNITCOST] as ''' + @Unit_Cost + ''', ' + '''' + @QTY_Type + ''' = dbo.DYN_FUNC_QTY_Type([''Inventory Purchase Receipts Work''].[QTYTYPE]), ' + 'rtrim([''Inventory Purchase Receipts Work''].[TRXLOCTN]) as ''' + @TRX_Location + ''', ' + '''' + @Purchase_Receipt_Type + ''' = dbo.DYN_FUNC_Purchase_Receipt_Type([''Inventory Purchase Receipts Work''].[PCHSRCTY]), ' + 'rtrim([''Inventory Purchase Receipts Work''].[RCPTNMBR]) as ''' + @Receipt_Number + ''', ' + 'rtrim([''Inventory Purchase Receipts Work''].[VENDORID]) as ''' + @Vendor_ID + ''', ' + 'rtrim([''Inventory Purchase Receipts Work''].[PORDNMBR]) as ''' + @Purchase_Order_Number + ''', '   select @sqlstring1 =   '''' + @Landed_Cost + ''' = dbo.DYN_FUNC_Boolean_All([''Inventory Purchase Receipts Work''].[Landed_Cost]), ' +  '[''Inventory Purchase Receipts Work''].[QTYRESERVED] as ''' + @QTY_Reserved + ''', ' +  '[''Inventory Purchase Receipts Work''].[RCTSEQNM] as ''' + @Receipt_SEQ_Number + ''', ' +  '''' + @Receipt_Sold + ''' = dbo.DYN_FUNC_Boolean_All([''Inventory Purchase Receipts Work''].[RCPTSOLD]), ' + 'rtrim([''Item Master''].[ITMGEDSC]) as ''' + @Item_Generic_Description + ''', ' +  'rtrim([''Item Master''].[ITEMDESC]) as ''' + @Item_Description + ''', ' + 'rtrim([''Item Master''].[USCATVLS_1]) as ''' + @User_Category_Value_1 + ''', ' +  'rtrim([''Item Master''].[USCATVLS_2]) as ''' + @User_Category_Value_2 + ''', ' +  'rtrim([''Item Master''].[USCATVLS_3]) as ''' + @User_Category_Value_3 + ''', ' +  'rtrim([''Item Master''].[USCATVLS_4]) as ''' + @User_Category_Value_4 + ''', ' +  'rtrim([''Item Master''].[USCATVLS_5]) as ''' + @User_Category_Value_5 + ''', ' +  'rtrim([''Item Master''].[USCATVLS_6]) as ''' + @User_Category_Value_6 + ''', ' + '''' + @Item_Number_For_DrillBack + ''' = ''' + @DrillBack_Base_Url + ''' +dbo.dgppItemID(1,[''Inventory Purchase Receipts Work''].[ITEMNMBR],'''' ), '+ '''' + @Vendor_ID_For_DrillBack + ''' = ''' + @DrillBack_Base_Url + ''' +dbo.dgppVendorID(1,[''Inventory Purchase Receipts Work''].[VENDORID] ) '  select @sqljoinstring =   'from [IV10200] as [''Inventory Purchase Receipts Work''] with (NOLOCK) '   + 'left outer join [IV00101] as [''Item Master''] with (NOLOCK) on '   + '[''Inventory Purchase Receipts Work''].[ITEMNMBR] = [''Item Master''].[ITEMNMBR] '   select @sqlaccessstring =   'GRANT SELECT ON [dbo].[InventoryPurchaseReceipts] TO [rpt_warehouse manager]' + 'GRANT SELECT ON [dbo].[InventoryPurchaseReceipts] TO [rpt_materials manager]' + 'GRANT SELECT ON [dbo].[InventoryPurchaseReceipts] TO [rpt_operations manager]' + 'GRANT SELECT ON [dbo].[InventoryPurchaseReceipts] TO [rpt_executive]' + 'GRANT SELECT ON [dbo].[InventoryPurchaseReceipts] TO [rpt_production manager]'   exec (@sqldropstring)  exec (@sqldefaultstring+' '+@sqlstring1+' '+@sqlstring2+' '+@sqlstring3+' '+@sqlstring4+' '+@sqlstring5+' '+@sqlstring6+' '+@sqlstring7+' '+@sqlstring8+' '+@sqlstring9+' '+@sqlstring10+' '+@sqljoinstring)  exec (@sqlaccessstring)   set nocount off    
GO
GRANT EXECUTE ON  [dbo].[sp_Dynamics_InventoryPurchaseReceipts] TO [DYNGRP]
GO
