SET QUOTED_IDENTIFIER OFF
GO
SET ANSI_NULLS ON
GO
 CREATE Procedure [dbo].[SVC_RET_GetPostingRevenues] ( @Year integer, @Period integer, @PrePaid tinyint, @User char(15) )  As   delete from SVC00625 where USERID = @User and CNTTYPE <> 'Expired' if @Year = 0 and @Period = 0 return  if (select SVC_PrePaid_Override from SVC00998) = 0 begin insert into SVC00625  SELECT @User, SVC00601.CONSTS, SVC00601.CONTNBR, SVC00600.CNTTYPE,SVC00601.CUSTNMBR, YEAR1,  PERIODID,0,0, SUM(Net_Transaction_Amount - PSTDAMNT), SUM(OrigNetTransactionAmount - Originating_PostedAmount) , '','','' FROM SVC00604 INNER JOIN SVC00601  on (SVC00604.CONSTS = SVC00601.CONSTS AND SVC00604.CONTNBR = SVC00601.CONTNBR and SVC00604.LNSEQNBR = SVC00601.LNSEQNBR)  inner join SVC00600  on (SVC00604.CONSTS = SVC00600.CONSTS AND SVC00604.CONTNBR = SVC00600.CONTNBR)   WHERE ((YEAR1 <= @Year and PERIODID <= @Period) or (YEAR1 < @Year)) and (Status = 0) and SVC00601.PREPAID = @PrePaid and SVC00601.CONSTS = 2 and SVC00601.Credit_Hold = 0 and SVC00600.BILSTAT > 0   GROUP BY SVC00601.CONSTS, SVC00601.CONTNBR,SVC00600.CNTTYPE,SVC00601.CUSTNMBR,YEAR1, PERIODID  end else begin insert into SVC00625  SELECT @User, SVC00601.CONSTS, SVC00601.CONTNBR, SVC00600.CNTTYPE,SVC00601.CUSTNMBR, YEAR1,  PERIODID,0,0, SUM(Net_Transaction_Amount - PSTDAMNT), SUM(OrigNetTransactionAmount - Originating_PostedAmount) , '','','' FROM SVC00604 INNER JOIN SVC00601  on (SVC00604.CONSTS = SVC00601.CONSTS AND SVC00604.CONTNBR = SVC00601.CONTNBR and SVC00604.LNSEQNBR = SVC00601.LNSEQNBR)  inner join SVC00600  on (SVC00604.CONSTS = SVC00600.CONSTS AND SVC00604.CONTNBR = SVC00600.CONTNBR)   WHERE ((YEAR1 <= @Year and PERIODID <= @Period) or (YEAR1 < @Year)) and (Status = 0) and SVC00601.PREPAID = @PrePaid and SVC00601.CONSTS = 2 and SVC00601.Credit_Hold = 0 GROUP BY SVC00601.CONSTS, SVC00601.CONTNBR,SVC00600.CNTTYPE,SVC00601.CUSTNMBR,YEAR1, PERIODID  end return    
GO
GRANT EXECUTE ON  [dbo].[SVC_RET_GetPostingRevenues] TO [DYNGRP]
GO
