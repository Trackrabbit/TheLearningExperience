SET QUOTED_IDENTIFIER OFF
GO
SET ANSI_NULLS ON
GO
 CREATE                         procedure [dbo].[aagValidateCodeCombAccClass]  @I_cTableAccClassDim nvarchar(30) = null,   @O_nTrxDim  char(15)= ''  output,   @O_nTrxDimCode char(30)= ''  output,  @O_nRelTrxDim char(15)= ''  output,   @O_nRelTrxDimCode char(30)= ''  output,  @IO_fValidCodeComb tinyint = 1 output as  set @O_nTrxDim  = '' set @O_nTrxDimCode = '' set @O_nRelTrxDim = ''  set @O_nRelTrxDimCode = '' set @IO_fValidCodeComb = 1  begin  declare  @nTrxDimID int,   @nTrxDimCodeID int,  @nRelTrxDimID int,   @nRelTrxDimCodeID int  exec ('declare aaAccountClass cursor fast_forward FOR  select aaTrxDimID, aaTrxDimCodeIDDflt from ' + @I_cTableAccClassDim +   ' where aaDataType = 1')   open aaAccountClass  fetch next from aaAccountClass into @nTrxDimID,@nTrxDimCodeID  WHILE @@fetch_status = 0  begin  exec ('declare aaAccountClassDup cursor fast_forward FOR  select aaTrxDimID, aaTrxDimCodeIDDflt from ' + @I_cTableAccClassDim +  ' where aaDataType = 1')  open aaAccountClassDup  fetch next from aaAccountClassDup into @nRelTrxDimID,@nRelTrxDimCodeID  WHILE @@fetch_status = 0   begin  if @nTrxDimID <> @nRelTrxDimID   and @nTrxDimID <> 0 and @nTrxDimCodeID <> 0  and @nRelTrxDimID <> 0 and @nRelTrxDimCodeID <> 0  begin  exec aagValidateCodes  @nTrxDimID,   @nTrxDimCodeID,  @nRelTrxDimID,   @nRelTrxDimCodeID,  @IO_fValidCodeComb output  if @IO_fValidCodeComb = 0  begin  select @O_nTrxDim =  aaTrxDim from AAG00400 where aaTrxDimID = @nTrxDimID   select @O_nTrxDimCode = aaTrxDimCode from AAG00401 where aaTrxDimID = @nTrxDimID and aaTrxDimCodeID = @nTrxDimCodeID  select @O_nRelTrxDim = aaTrxDim from AAG00400 where aaTrxDimID = @nRelTrxDimID   select @O_nRelTrxDimCode = aaTrxDimCode from AAG00401 where aaTrxDimID = @nRelTrxDimID and aaTrxDimCodeID = @nRelTrxDimCodeID   close aaAccountClassDup  deallocate aaAccountClassDup  close aaAccountClass  deallocate aaAccountClass  return  end  end  fetch next from aaAccountClassDup into @nRelTrxDimID,@nRelTrxDimCodeID  end  close aaAccountClassDup  deallocate aaAccountClassDup  fetch next from aaAccountClass into @nTrxDimID,@nTrxDimCodeID  end  close aaAccountClass  deallocate aaAccountClass  return(0) end    
GO
GRANT EXECUTE ON  [dbo].[aagValidateCodeCombAccClass] TO [DYNGRP]
GO
