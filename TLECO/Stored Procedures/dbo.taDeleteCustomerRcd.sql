SET QUOTED_IDENTIFIER OFF
GO
SET ANSI_NULLS ON
GO
 create procedure [dbo].[taDeleteCustomerRcd]  @I_vCUSTNMBR char(15),    @I_vRequesterTrx smallint = 0,   @I_vUSRDEFND1 char(50) = '',       @I_vUSRDEFND2 char(50) = '',       @I_vUSRDEFND3 char(50) = '',       @I_vUSRDEFND4 varchar(8000) = '',  @I_vUSRDEFND5 varchar(8000) = '',  @O_iErrorState int output, @oErrString varchar(255) output  with encryption as  set transaction isolation level read uncommitted set nocount on  declare   @iStatus int,  @iAddCodeErrState int,  @iCustomState int,  @iError int,  @O_oErrorState int,  @iCustomErrString varchar(255)  select @O_iErrorState = 0,  @iStatus = 0,  @iCustomState = 0,  @iError = 0,  @O_oErrorState = 0,  @iCustomErrString = ''  if (@oErrString is NULL) begin  select @oErrString = '' end  exec @iStatus = taDeleteCustomerRcdPre  @I_vCUSTNMBR output,  @I_vRequesterTrx output,  @I_vUSRDEFND1 output,  @I_vUSRDEFND2 output,  @I_vUSRDEFND3 output,  @I_vUSRDEFND4 output,  @I_vUSRDEFND5 output,  @O_iErrorState  = @iCustomState output,  @oErrString = @iCustomErrString output  select @iError = @@error if ((@iStatus <> 0) or (@iCustomState <> 0) or (@iError <> 0)) begin  select @O_iErrorState = 9232    exec @iStatus = taUpdateString  @O_iErrorState,  @iCustomErrString,  @oErrString output,  @O_oErrorState output  return (@O_iErrorState) end  if ( @I_vCUSTNMBR is NULL ) begin  select @O_iErrorState = 20999    exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @iAddCodeErrState output  return (@O_iErrorState) end  if ( @I_vCUSTNMBR = '' ) begin  select @O_iErrorState = 21000    exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @iAddCodeErrState output  return (@O_iErrorState) end  select @I_vCUSTNMBR = UPPER(@I_vCUSTNMBR)  if (@I_vCUSTNMBR <> '') begin  if not exists(select 1 from RM00101 (nolock) where CUSTNMBR = @I_vCUSTNMBR)  begin   select @O_iErrorState = 5529    exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @iAddCodeErrState output  end end  if exists( select 1 from RM00101 (nolock) where CUSTNMBR = @I_vCUSTNMBR and CPRCSTNM <> '' ) begin  select @O_iErrorState = 21001    exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @iAddCodeErrState output  return (@O_iErrorState) end  if ( @I_vRequesterTrx < 0 or @I_vRequesterTrx > 1 ) begin  select @O_iErrorState = 3716     exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @iAddCodeErrState output end  if exists( select 1 from RM00401 (nolock) where CUSTNMBR = @I_vCUSTNMBR and RMDTYPAL <> 0 ) begin  select @O_iErrorState = 21002    exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @iAddCodeErrState output  return (@O_iErrorState) end  if exists( select 1 from RM00401 a (nolock), RM20101 b (nolock)   where   a.CUSTNMBR = @I_vCUSTNMBR and   a.RMDTYPAL = 0 and  a.DCSTATUS = 2 and  a.DOCNUMBR = b.DOCNUMBR and  b.CURTRXAM <> 0 ) begin  select @O_iErrorState = 21003    exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @iAddCodeErrState output  return (@O_iErrorState) end  if exists( select 1 from IVC10100 (nolock) where CUSTNMBR = @I_vCUSTNMBR  ) or   exists( select 1 from IVC30101 (nolock) where CUSTNMBR = @I_vCUSTNMBR  ) begin  select @O_iErrorState = 21004    exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @iAddCodeErrState output  return (@O_iErrorState) end  if exists( select 1 from SOP10100 (nolock) where CUSTNMBR = @I_vCUSTNMBR and PROSPECT = 0 ) or   exists( select 1 from SOP30200 (nolock) where CUSTNMBR = @I_vCUSTNMBR and PROSPECT = 0 ) begin  select @O_iErrorState = 21005    exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @iAddCodeErrState output  return (@O_iErrorState) end  if (@I_vRequesterTrx=0) begin  exec @iStatus = eConnectOutVerify  @I_vDOCTYPE='Customer',  @I_vINDEX1=@I_vCUSTNMBR,  @I_vINDEX2='',  @I_vINDEX3='',  @I_vINDEX4='',  @I_vINDEX5='',  @I_vINDEX6='',  @I_vINDEX7='',  @I_vINDEX8='',  @I_vINDEX9='',  @I_vINDEX10='',  @I_vINDEX11='',  @I_vINDEX12='',  @I_vINDEX13='',  @I_vINDEX14='',  @I_vINDEX15='',  @I_vDelete = 0,  @O_iErrorState = @iCustomState output  select @iError = @@error  if @iStatus = 0 and @iError <> 0  begin  select @iStatus = @iError  end  if (@iStatus <> 0) or (@iCustomState <> 0)  begin  select @O_iErrorState = 2927    exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output  return (@O_iErrorState)   end end  delete RM00101 where CUSTNMBR = @I_vCUSTNMBR if @@error <> 0  begin  select @O_iErrorState = 21006    exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @iAddCodeErrState output  return (@O_iErrorState) end  delete RM00103 where CUSTNMBR = @I_vCUSTNMBR if @@error <> 0  begin  select @O_iErrorState = 21008    exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @iAddCodeErrState output  return (@O_iErrorState) end  delete SY01200 where Master_ID = @I_vCUSTNMBR and Master_Type = 'CUS' if @@error <> 0  begin  select @O_iErrorState = 21009    exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @iAddCodeErrState output  return (@O_iErrorState) end  delete RM00104 where CUSTNMBR = @I_vCUSTNMBR if @@error <> 0  begin  select @O_iErrorState = 21010    exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @iAddCodeErrState output  return (@O_iErrorState) end  delete RM00102 where CUSTNMBR = @I_vCUSTNMBR if @@error <> 0  begin  select @O_iErrorState = 21011    exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @iAddCodeErrState output  return (@O_iErrorState) end  delete VAT10101 where CUSTNMBR = @I_vCUSTNMBR if @@error <> 0  begin  select @O_iErrorState = 21012    exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @iAddCodeErrState output  return (@O_iErrorState) end  delete RM00106 where CUSTNMBR = @I_vCUSTNMBR if @@error <> 0  begin  select @O_iErrorState = 1997    exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @iAddCodeErrState output  return (@O_iErrorState) end  exec @iStatus = taDeleteCustomerRcdPost  @I_vCUSTNMBR,  @I_vRequesterTrx,  @I_vUSRDEFND1,  @I_vUSRDEFND2,  @I_vUSRDEFND3,  @I_vUSRDEFND4,  @I_vUSRDEFND5,  @O_iErrorState  = @iCustomState output,  @oErrString = @iCustomErrString output  select @iError = @@error if ((@iStatus <> 0) or (@iCustomState <> 0) or (@iError <> 0)) begin  select @O_iErrorState = 9233    exec @iStatus = taUpdateString  @O_iErrorState,  @iCustomErrString,  @oErrString output,  @O_oErrorState output  return (@O_iErrorState) end  if (@I_vRequesterTrx=0) begin  exec @iStatus = eConnectOutVerify  @I_vDOCTYPE='Customer',  @I_vINDEX1=@I_vCUSTNMBR,  @I_vINDEX2='',  @I_vINDEX3='',  @I_vINDEX4='',  @I_vINDEX5='',  @I_vINDEX6='',  @I_vINDEX7='',  @I_vINDEX8='',  @I_vINDEX9='',  @I_vINDEX10='',  @I_vINDEX11='',  @I_vINDEX12='',  @I_vINDEX13='',  @I_vINDEX14='',  @I_vINDEX15='',  @I_vDelete = 1,  @O_iErrorState = @iCustomState output  select @iError = @@error  if @iStatus = 0 and @iError <> 0  begin  select @iStatus = @iError  end  if (@iStatus <> 0) or (@iCustomState <> 0)  begin  select @O_iErrorState = 2791    exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output  return (@O_iErrorState)   end end  return (@O_iErrorState)   
GO
GRANT EXECUTE ON  [dbo].[taDeleteCustomerRcd] TO [DYNGRP]
GO
