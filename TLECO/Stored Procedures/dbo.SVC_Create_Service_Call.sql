SET QUOTED_IDENTIFIER OFF
GO
SET ANSI_NULLS ON
GO
 CREATE procedure [dbo].[SVC_Create_Service_Call]  (@srvrectype int,  @srvstat    varchar(3) = NULL,   @srvtype varchar(11) = NULL,   @svcdescr varchar(61),  @custnmbr varchar(15) = NULL,   @adrscode varchar(15),  @custreference varchar(21),  @cntcprsn varchar(31),  @phone1 varchar(21),  @pordnmbr varchar(21),  @entdte datetime = NULL,   @enttme datetime = NULL  ) as declare @callnbr varchar(10) declare @custname varchar(65) declare @retadrs varchar(15) declare @address1 varchar(31) declare @address2 varchar(31) declare @address3 varchar(31) declare @city varchar(31) declare @statecd varchar(30) declare @zip varchar(11) declare @country varchar(21) declare @taxschid varchar(15) declare @prclevel varchar(15) declare @taxexmt1 varchar(25) declare @taxexmt2 varchar(25) declare @pymtrmid varchar(21) declare @slspersonid varchar(15) declare @svcarea varchar(10) declare @techid varchar(10) declare @timezone varchar(3) declare @offid varchar(10) declare @prioritylevel int declare @total money declare @invoicedamt money declare @noteindx int declare @contnbr varchar(10) declare @default_status varchar(3) declare @default_type varchar(10) declare @BILLTOCUST char(15) declare @BILLTOADDRESS char(15) declare @ETADATE datetime declare @ETATIME datetime declare @CurrencyID char(15) ,  @OnHold tinyint,  @PrintToWeb tinyint declare @MinDate datetime  exec smGetMinDate @MinDate output  if @custnmbr is NULL   begin  return 200  end select  @default_status = SRVSTAT,  @default_type = SRVTYPE,  @PrintToWeb = Print_to_Web  from SVC00998 if @@error <> 0   begin  return 250  end select  @prioritylevel = 99,    @techid = ' ',  @total = 0,  @invoicedamt = 0,  @noteindx = 0,  @contnbr = ' ' if @srvstat is NULL or @srvstat = ''  begin  select @srvstat = @default_status  end if @srvtype is NULL or @srvtype = ''  begin  select @srvtype = @default_type  end if @entdte is NULL  begin select @entdte = CONVERT(char(10),GETDATE(),102) + ' 00:00:00'  end if @enttme is NULL   begin select @enttme = CONVERT(char(10),@MinDate,102) + CONVERT(char(5),GETDATE(),108)  end select @ETADATE = @entdte,@ETATIME = @enttme   exec SVC_Get_Customer_Info @custnmbr, @adrscode,   @custname output, @retadrs output, @cntcprsn output,  @phone1 output, @address1 output, @address2 output,@address3 output,  @city output, @statecd output, @zip output, @country output,  @taxschid output, @prclevel output,   @taxexmt1 output, @taxexmt2 output, @pymtrmid output,  @slspersonid output,  @svcarea output, @offid output, @timezone output,   @CurrencyID OUTPUT,  @BILLTOCUST OUTPUT,  @BILLTOADDRESS OUTPUT ,  @OnHold OUTPUT if @custname is NULL   begin  return 201  end  begin transaction   update SVC00999 set CALLNBR = CONVERT(varchar(10), CONVERT(int,CALLNBR) + 1)  select @callnbr = CALLNBR  from SVC00999  insert SVC00200  values (  @callnbr,  @srvrectype,  @srvstat,  @srvtype,  @svcdescr,  @prioritylevel,  @custnmbr, @custreference,  @adrscode,  @custname,  @address1,  @address2,  @city, @statecd,  @zip,  @cntcprsn,  @phone1,  @offid, @svcarea,  @techid,  @timezone, @entdte,  @enttme,  @MinDate,  @MinDate,  @ETADATE,  @ETATIME,  @MinDate,  @MinDate,  @MinDate,  @MinDate,  @MinDate,  @MinDate, @MinDate,  @MinDate, @prclevel,  @pymtrmid,  @slspersonid, 0, 0, 0,  0, 0, 0, 0, 0, 0, @taxschid,  @taxexmt1, @taxexmt2, 0, 0, @total,  @invoicedamt, 0, 0, 0, @pordnmbr,  @noteindx, 0,'', '', '', '', '', 0, ' ', @MinDate, @MinDate, 1, @pymtrmid, 0, '', '', '', '', '', 0, @contnbr, 0, 0, @OnHold, @PrintToWeb, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, @BILLTOCUST, '', @BILLTOADDRESS, 0, '', '', 0, @MinDate, 0, @MinDate, 0, 0, 0, @MinDate, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, isnull(@address3,''), isnull(@country,''), 0, '',  0,0,0,0,0 ,9,2 ) exec SVC_Obj_CreateServiceLineAddons @callnbr    insert SVC00210 values (@callnbr, @srvrectype, 1, @srvstat, @srvstat, @techid, 'New Call Created', 'SYSTEM', CONVERT(varchar(10),GETDATE(),102) + ' 00:00:00', CONVERT(char(10),@MinDate,102) + CONVERT(varchar(8),GETDATE(),108)) if @@error = 0  begin  commit transaction  return end else  begin  rollback transaction  return 99 end return   
GO
GRANT EXECUTE ON  [dbo].[SVC_Create_Service_Call] TO [DYNGRP]
GO
