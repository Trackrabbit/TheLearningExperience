SET QUOTED_IDENTIFIER OFF
GO
SET ANSI_NULLS ON
GO
 CREATE     PROCEDURE [dbo].[ivExtPricingUofMDTLUpdate]  @UofMSchd  char(11),  @UofMOLD char(9),  @UofMNEW char(9),  @QTYBSUOM numeric(19,5),  @EQUIVUOM char(9)  AS  DECLARE  @loST_ITEMNMBR  char(31),  @loST_GroupCode char(31),  @loIN_DECPLQTY integer,  @loDE_MinVal decimal(19,5),  @loDE_MaxVal decimal(19,5),  @loIN_DPQty integer,  @loST_FUNLCURR char(16),  @EXTPRCLVL CHAR(15),  @cDBName CHAR(10),  @iMessageNumber INTEGER,  @iStatus INTEGER,  @oErrorState INTEGER  UPDATE IV10402  SET UOFM = @UofMNEW, QTYBSUOM = @QTYBSUOM  FROM IV10402,IV00101  WHERE IV10402.EPITMTYP = 'I' AND   IV10402.UOFM = @UofMOLD AND   IV00101.UOMSCHDL = @UofMSchd AND  IV10402.ITEMNMBR=IV00101.ITEMNMBR  UPDATE IV10403  SET UOFM = @UofMNEW  FROM IV10402,IV00101  WHERE IV10402.EPITMTYP = 'I' AND   IV10402.UOFM = @UofMOLD AND   IV00101.UOMSCHDL = @UofMSchd AND  IV10402.ITEMNMBR=IV00101.ITEMNMBR  UPDATE IV10402  SET UOFM = @UofMNEW, QTYBSUOM = @QTYBSUOM  FROM IV10402,SOP10108  WHERE IV10402.EPITMTYP = 'G' AND   IV10402.UOFM = @UofMOLD AND   SOP10108.UOMSCHDL = @UofMSchd AND  IV10402.ITEMNMBR=SOP10108.PRCGRPID  UPDATE IV10403  SET UOFM = @UofMNEW  FROM IV10403,SOP10108  WHERE IV10403.EPITMTYP = 'G' AND   IV10403.UOFM = @UofMOLD AND   SOP10108.UOMSCHDL = @UofMSchd AND  IV10403.ITEMNMBR=SOP10108.PRCGRPID  EXECUTE ExtPricingGetFunctionalCurrency @loST_FUNLCURR OUTPUT  IF (SELECT COUNT(*)FROM IV40201  WHERE IV40201.UOMSCHDL = @UofMSchd AND  IV40201.BASEUOFM = @EQUIVUOM) <> 0 BEGIN  SELECT @cDBName = db_name()   SELECT @iMessageNumber = 5005  exec @iStatus = DYNAMICS..smGetMsgString  @iMessageNumber,   @cDBName,   @EXTPRCLVL output,  @oErrorState output   DECLARE CUR2 CURSOR FOR  SELECT IV00101.ITEMNMBR,  IV00101.DECPLQTY  FROM IV00101  WHERE IV00101.UOMSCHDL = @UofMSchd  OPEN CUR2  FETCH CUR2 INTO @loST_ITEMNMBR, @loIN_DECPLQTY  WHILE @@FETCH_STATUS = 0  BEGIN  SET @loIN_DPQty = @loIN_DECPLQTY - 1  IF @loIN_DPQty > 0   BEGIN  SET @loDE_MinVal = '0.' + SUBSTRING('0000', 1, @loIN_DPQty - 1) + '1'  SET @loDE_MaxVal = 1000000000000 - @loDE_MinVal  END  ELSE  BEGIN  SET @loDE_MinVal  = 1  SET @loDE_MaxVal = 999999999999  END  DELETE IV00107   WHERE IV00107.ITEMNMBR = @loST_ITEMNMBR AND  IV00107.UOFM = @UofMNEW AND  IV00107.PRCLEVEL = @EXTPRCLVL  DELETE IV00108   WHERE IV00108.ITEMNMBR = @loST_ITEMNMBR AND  IV00108.UOFM = @UofMNEW AND  IV00108.PRCLEVEL = @EXTPRCLVL  INSERT INTO IV00107  (ITEMNMBR,  CURNCYID,  PRCLEVEL,  UOFM,  RNDGAMNT,  ROUNDHOW,  ROUNDTO,  UMSLSOPT,  QTYBSUOM)  VALUES (@loST_ITEMNMBR,  @loST_FUNLCURR,   @EXTPRCLVL,   @UofMNEW,   0,  0,  1,  2,   @QTYBSUOM)   INSERT INTO IV00108  (ITEMNMBR,  CURNCYID,  PRCLEVEL,  UOFM,  TOQTY,  FROMQTY,   UOMPRICE,  QTYBSUOM)  VALUES (@loST_ITEMNMBR,   @loST_FUNLCURR,  @EXTPRCLVL,   @UofMNEW,   @loDE_MaxVal,  @loDE_MinVal,  0,  @QTYBSUOM)   FETCH CUR2 INTO @loST_ITEMNMBR, @loIN_DECPLQTY  END  CLOSE CUR2  DEALLOCATE CUR2 END    
GO
GRANT EXECUTE ON  [dbo].[ivExtPricingUofMDTLUpdate] TO [DYNGRP]
GO
