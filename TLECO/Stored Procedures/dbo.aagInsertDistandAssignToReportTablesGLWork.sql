SET QUOTED_IDENTIFIER OFF
GO
SET ANSI_NULLS ON
GO
 CREATE    procedure [dbo].[aagInsertDistandAssignToReportTablesGLWork] @cUserID char(16), @cTrxBatchSrc char(61), @iSeries int, @iHdrID int, @iOnlyUnposted tinyint = 0  as  SELECT @cTrxBatchSrc = replace(@cTrxBatchSrc,'''','''''')  exec('delete from AAG60001 where USERID = ''' + @cUserID + ''' and TRXBTCHSRC = ''' + @cTrxBatchSrc +  ''' and SERIES = ' +@iSeries + ' and aaGLWorkHdrID = ' + @iHdrID)  exec('delete from AAG60002 where USERID = ''' + @cUserID + ''' and TRXBTCHSRC = ''' + @cTrxBatchSrc +  ''' and aaGLWorkHdrID = ' + @iHdrID)  begin if @iOnlyUnposted = 1  begin   insert into AAG60001(aaGLWorkHdrID,aaGLWorkDistID, ACTINDX,   DEBITAMT, CRDTAMNT, ORDBTAMT, ORCRDAMT, CURNCYID, CURRNIDX)  select aaGLWorkHdrID,aaGLWorkDistID, ACTINDX,   DEBITAMT, CRDTAMNT, ORDBTAMT, ORCRDAMT, CURNCYID, CURRNIDX  from AAG10001 where aaGLWorkHdrID = @iHdrID   end  else  begin  insert into AAG60001(aaGLWorkHdrID,aaGLWorkDistID, ACTINDX,   DEBITAMT, CRDTAMNT, ORDBTAMT, ORCRDAMT, CURNCYID, CURRNIDX)  select aaGLWorkHdrID,aaGLWorkDistID, ACTINDX,   DEBITAMT, CRDTAMNT, ORDBTAMT, ORCRDAMT, CURNCYID, CURRNIDX   from AAG10001 where aaGLWorkHdrID = @iHdrID  end end  exec('update AAG60001 set USERID = ''' + @cUserID + ''', TRXBTCHSRC = ''' + @cTrxBatchSrc +  ''', SERIES = ' +@iSeries + ' where aaGLWorkHdrID = ' + @iHdrID)  begin if @iOnlyUnposted = 1  begin   insert into AAG60002(aaGLWorkHdrID,aaGLWorkDistID,aaGLWorkAssignID,   DEBITAMT, CRDTAMNT, ORDBTAMT, ORCRDAMT, DistRef)  select aaGLWorkHdrID,aaGLWorkDistID,aaGLWorkAssignID,   DEBITAMT, CRDTAMNT, ORDBTAMT, ORCRDAMT,  DistRef  from AAG10002 where aaGLWorkHdrID = @iHdrID   and aaGLWorkDistID in(select aaGLWorkDistID from AAG10001   where aaGLWorkHdrID = @iHdrID)  end else  begin  insert into AAG60002(aaGLWorkHdrID,aaGLWorkDistID,aaGLWorkAssignID,   DEBITAMT, CRDTAMNT, ORDBTAMT, ORCRDAMT, DistRef)  select aaGLWorkHdrID,aaGLWorkDistID,aaGLWorkAssignID,   DEBITAMT, CRDTAMNT, ORDBTAMT, ORCRDAMT, DistRef  from AAG10002 where aaGLWorkHdrID = @iHdrID  end  end  exec('update AAG60002 set USERID = ''' + @cUserID + ''', TRXBTCHSRC = ''' + @cTrxBatchSrc +  ''' where aaGLWorkHdrID = ' + @iHdrID)    
GO
GRANT EXECUTE ON  [dbo].[aagInsertDistandAssignToReportTablesGLWork] TO [DYNGRP]
GO
