SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO
 create procedure [dbo].[glGetRMTransactions]  @iStartDate datetime,  @iEndDate datetime,  @iRMTempTable varchar(50)  AS  DECLARE  @lSQLError int  EXEC(  'INSERT INTO ' +  @iRMTempTable +  ' (POSTEDDT,  CUSTNMBR,  TRXSORCE,  DOCNUMBR,  STRVAL,  ACCTAMNT,  TRX_ID,  RMDTYPAL,  HISTRX,  VOIDSTTS)  SELECT  RM10101.POSTEDDT,  RM10101.CUSTNMBR,  RM10101.TRXSORCE,  RM10101.DOCNUMBR,  '''',  (SUM(RM10101.DEBITAMT) - SUM(RM10101.CRDTAMNT)),  SUBSTRING(RM10101.TRXSORCE, 1, 5),  RM20101.RMDTYPAL,  0,  RM20101.VOIDSTTS  FROM  RM10101 JOIN RM20101   ON  RM10101.TRXSORCE = RM20101.TRXSORCE  AND  RM10101.DOCNUMBR = RM20101.DOCNUMBR  AND  RM10101.RMDTYPAL = RM20101.RMDTYPAL  WHERE  RM10101.PSTGSTUS = 1  AND  (RM10101.DISTTYPE = 3 OR RM10101.DISTTYPE = 5)  AND  RM10101.POSTEDDT BETWEEN ' + '''' + @iStartDate + '''' + ' AND ' + '''' + @iEndDate + '''' +  ' GROUP BY  RM10101.POSTEDDT,  RM10101.CUSTNMBR,  RM10101.TRXSORCE,  RM10101.DOCNUMBR,  RM20101.RMDTYPAL,  RM20101.VOIDSTTS ')  EXEC(  'INSERT INTO ' +  @iRMTempTable +  ' (POSTEDDT,  CUSTNMBR,  TRXSORCE,  DOCNUMBR,  STRVAL,  ACCTAMNT,  TRX_ID,  RMDTYPAL,  HISTRX,  VOIDSTTS)  SELECT  RM30301.POSTEDDT,  RM30301.CUSTNMBR,  RM30301.TRXSORCE,  RM30301.DOCNUMBR,  '''',  (SUM(RM30301.DEBITAMT) - SUM(RM30301.CRDTAMNT)),  SUBSTRING(RM30301.TRXSORCE, 1, 5),  RM30101.RMDTYPAL,  1,  RM30101.VOIDSTTS  FROM  RM30301 JOIN RM30101  ON  RM30301.TRXSORCE = RM30101.TRXSORCE  AND  RM30301.DOCNUMBR = RM30101.DOCNUMBR  AND  RM30301.RMDTYPAL = RM30101.RMDTYPAL  WHERE  (RM30301.DISTTYPE = 3 OR RM30301.DISTTYPE = 5)  AND  RM30301.POSTEDDT BETWEEN ' + '''' + @iStartDate + '''' + ' AND ' + '''' + @iEndDate + '''' +  ' GROUP BY  RM30301.POSTEDDT,  RM30301.CUSTNMBR,  RM30301.TRXSORCE,  RM30301.DOCNUMBR,  RM30101.RMDTYPAL,  RM30101.VOIDSTTS ')  EXEC(  'SELECT   TRXSORCE,  DOCNUMBR,  ISNULL(SUM(DEBITAMT - CRDTAMNT),0) AS PYMNTAMNT,  RMDTYPAL  INTO  ##AccountAmountOpen  FROM  RM10101  WHERE  (TRXSORCE LIKE ''RMSLS%''   OR  TRXSORCE LIKE ''INVCE%''  OR  TRXSORCE LIKE ''SLSTE%'')  AND  (DISTTYPE = 1 OR DISTTYPE = 2)  AND  PSTGSTUS = 1  AND  POSTEDDT BETWEEN ' + '''' + @iStartDate + '''' + ' AND ' + '''' + @iEndDate + '''' +  'GROUP BY  TRXSORCE,  DOCNUMBR,  RMDTYPAL')  EXEC(  'SELECT   TRXSORCE,  DOCNUMBR,  ISNULL(SUM(DEBITAMT - CRDTAMNT),0) AS PYMNTAMNT,  RMDTYPAL  INTO  ##AccountAmountHistory  FROM  RM30301  WHERE  (TRXSORCE LIKE ''RMSLS%''   OR  TRXSORCE LIKE ''INVCE%''  OR  TRXSORCE LIKE ''SLSTE%'')  AND  (DISTTYPE = 1 OR DISTTYPE = 2)  AND  POSTEDDT BETWEEN ' + '''' + @iStartDate + '''' + ' AND ' + '''' + @iEndDate + '''' +  'GROUP BY  TRXSORCE,  DOCNUMBR,  RMDTYPAL')  EXEC(  'UPDATE ' +  @iRMTempTable +  ' SET  ACCTAMNT = ACCTAMNT + PYMNTAMNT  FROM ' +  @iRMTempTable + ' JOIN ##AccountAmountOpen  ON ' +  @iRMTempTable + '.TRXSORCE = ##AccountAmountOpen.TRXSORCE  AND ' +  @iRMTempTable + '.DOCNUMBR = ##AccountAmountOpen.DOCNUMBR   AND ' +  @iRMTempTable + '.RMDTYPAL = ##AccountAmountOpen.RMDTYPAL ')  EXEC(  'UPDATE ' +  @iRMTempTable +  ' SET  ACCTAMNT = ACCTAMNT + PYMNTAMNT  FROM ' +  @iRMTempTable + ' JOIN ##AccountAmountHistory  ON ' +  @iRMTempTable + '.TRXSORCE = ##AccountAmountHistory.TRXSORCE  AND ' +  @iRMTempTable + '.DOCNUMBR = ##AccountAmountHistory.DOCNUMBR   AND ' +   @iRMTempTable + '.RMDTYPAL = ##AccountAmountHistory.RMDTYPAL ')  EXEC(  'INSERT INTO ' +  @iRMTempTable +  ' (POSTEDDT,  CUSTNMBR,  TRXSORCE,  DOCNUMBR,  STRVAL,  ACCTAMNT,  TRX_ID,  RMDTYPAL,  HISTRX,  VOIDSTTS)  SELECT  RM10101.POSTEDDT,  RM10101.CUSTNMBR,  RM10101.TRXSORCE,  RM20101.DOCNUMBR,  '''',  -RM20101.ORTRXAMT,  SUBSTRING(RM10101.TRXSORCE, 1, 5),  RM20101.RMDTYPAL,  0,  RM20101.VOIDSTTS  FROM  RM10101 JOIN RM20201   ON  RM10101.DOCNUMBR = RM20201.APTODCNM  AND  RM10101.RMDTYPAL = RM20201.APTODCTY  JOIN RM20101   ON  RM20201.APFRDCNM = RM20101.DOCNUMBR  AND  RM20201.APFRDCTY = RM20101.RMDTYPAL  WHERE  RM10101.TRXSORCE = RM20101.TRXSORCE  AND  (RM10101.TRXSORCE LIKE ''RMSLS%''  OR  RM10101.TRXSORCE LIKE ''INVCE%''  OR  RM10101.TRXSORCE LIKE ''SLSTE%'')  AND  RM10101.PSTGSTUS = 1  AND  (RM10101.DISTTYPE = 3 OR RM10101.DISTTYPE = 5)   AND  RM20101.RMDTYPAL = 9  AND  RM10101.POSTEDDT BETWEEN ' + '''' + @iStartDate + '''' + ' AND ' + '''' + @iEndDate + '''' +  ' GROUP BY  RM10101.POSTEDDT,  RM10101.CUSTNMBR,  RM10101.TRXSORCE,  RM20101.DOCNUMBR,  RM20101.ORTRXAMT,  RM20101.RMDTYPAL,  RM20101.VOIDSTTS ')  EXEC(  'INSERT INTO ' +  @iRMTempTable +  ' (POSTEDDT,  CUSTNMBR,  TRXSORCE,  DOCNUMBR,  STRVAL,  ACCTAMNT,  TRX_ID,  RMDTYPAL,  HISTRX,  VOIDSTTS)  SELECT  RM30301.POSTEDDT,  RM30301.CUSTNMBR,  RM30301.TRXSORCE,  RM30101.DOCNUMBR,  '''',  -RM30101.ORTRXAMT,  SUBSTRING(RM30301.TRXSORCE, 1, 5),  RM30101.RMDTYPAL,  1,  RM30101.VOIDSTTS  FROM  RM30301 JOIN RM30201   ON  RM30301.DOCNUMBR = RM30201.APTODCNM  AND  RM30301.RMDTYPAL = RM30201.APTODCTY  JOIN RM30101   ON  RM30201.APFRDCNM = RM30101.DOCNUMBR AND RM30201.APFRDCTY = RM30101.RMDTYPAL  WHERE  RM30301.TRXSORCE = RM30101.TRXSORCE  AND  (RM30301.TRXSORCE LIKE ''RMSLS%''  OR  RM30301.TRXSORCE LIKE ''INVCE%''  OR  RM30301.TRXSORCE LIKE ''SLSTE%'')  AND  (RM30301.DISTTYPE = 3 OR RM30301.DISTTYPE = 5)  AND  RM30101.RMDTYPAL = 9  AND  RM30301.POSTEDDT BETWEEN ' + '''' + @iStartDate + '''' + ' AND ' + '''' + @iEndDate + '''' +  ' GROUP BY  RM30301.POSTEDDT,  RM30301.CUSTNMBR,  RM30301.TRXSORCE,  RM30101.DOCNUMBR,  RM30101.ORTRXAMT,  RM30101.RMDTYPAL,  RM30101.VOIDSTTS ')  EXEC(  'INSERT INTO ' +  @iRMTempTable +  ' (POSTEDDT,  CUSTNMBR,  TRXSORCE,  DOCNUMBR,  STRVAL,  ACCTAMNT,  TRX_ID,  RMDTYPAL,  HISTRX,  VOIDSTTS)  SELECT  RM10101.POSTEDDT,  RM10101.CUSTNMBR,  RM10101.TRXSORCE,  RM30101.DOCNUMBR,  '''',  -RM30101.ORTRXAMT,  SUBSTRING(RM10101.TRXSORCE, 1, 5),  RM30101.RMDTYPAL,  0,  RM30101.VOIDSTTS  FROM  RM10101 JOIN RM30201   ON  RM10101.DOCNUMBR = RM30201.APTODCNM AND RM10101.RMDTYPAL = RM30201.APTODCTY  JOIN RM30101   ON  RM30201.APFRDCNM = RM30101.DOCNUMBR   AND   RM30201.APFRDCTY = RM30101.RMDTYPAL  WHERE   RM10101.TRXSORCE = RM30101.TRXSORCE   AND  (RM10101.TRXSORCE LIKE ''RMSLS%''  OR  RM10101.TRXSORCE LIKE ''INVCE%''  OR  RM10101.TRXSORCE LIKE ''SLSTE%'')   AND  RM10101.PSTGSTUS = 1   AND   (RM10101.DISTTYPE = 3 OR RM10101.DISTTYPE = 5)   AND  RM30101.RMDTYPAL = 9  AND  RM10101.POSTEDDT BETWEEN ' + '''' + @iStartDate + '''' + ' AND ' + '''' + @iEndDate + '''' +  ' GROUP BY  RM10101.POSTEDDT,  RM10101.CUSTNMBR,  RM10101.TRXSORCE,  RM30101.DOCNUMBR,  RM30101.ORTRXAMT,  RM30101.RMDTYPAL,  RM30101.VOIDSTTS ')  EXEC(  'INSERT INTO ' +  @iRMTempTable +  ' (POSTEDDT,  CUSTNMBR,  TRXSORCE,  DOCNUMBR,  STRVAL,  ACCTAMNT,  TRX_ID,  RMDTYPAL,  HISTRX,  VOIDSTTS)  SELECT  RM30301.POSTEDDT,  RM30301.CUSTNMBR,  RM30301.TRXSORCE,  RM20101.DOCNUMBR,  '''',  -RM20101.ORTRXAMT,  SUBSTRING(RM30301.TRXSORCE, 1, 5),  RM20101.RMDTYPAL,  1,  RM20101.VOIDSTTS  FROM  RM30301 JOIN RM20201   ON  RM30301.DOCNUMBR = RM20201.APTODCNM AND RM30301.RMDTYPAL = RM20201.APTODCTY JOIN RM20101   ON  RM20201.APFRDCNM = RM20101.DOCNUMBR AND RM20201.APFRDCTY = RM20101.RMDTYPAL  WHERE  RM30301.TRXSORCE = RM20101.TRXSORCE  AND  (RM30301.TRXSORCE LIKE ''RMSLS%''  OR  RM30301.TRXSORCE LIKE ''INVCE%''  OR  RM30301.TRXSORCE LIKE ''SLSTE%'')  AND  (RM30301.DISTTYPE = 3 OR RM30301.DISTTYPE = 5)   AND  RM20101.RMDTYPAL = 9  AND  RM30301.POSTEDDT BETWEEN ' + '''' + @iStartDate + '''' + ' AND ' + '''' + @iEndDate + '''' +  ' GROUP BY  RM30301.POSTEDDT,  RM30301.CUSTNMBR,  RM30301.TRXSORCE,  RM20101.DOCNUMBR,  RM20101.ORTRXAMT,  RM20101.RMDTYPAL,  RM20101.VOIDSTTS ')  EXEC(   'INSERT INTO ' +   @iRMTempTable +   ' (POSTEDDT,   CUSTNMBR,   TRXSORCE,   DOCNUMBR,   STRVAL,   ACCTAMNT,   TRX_ID,   RMDTYPAL,   HISTRX,   VOIDSTTS)   SELECT   RM10101.POSTEDDT,   RM10101.CUSTNMBR,   RM10101.TRXSORCE,   RM20101.DOCNUMBR,   '''',   -RM20101.ORTRXAMT,   SUBSTRING(RM10101.TRXSORCE, 1, 5),   RM20101.RMDTYPAL,   0,   RM20101.VOIDSTTS   FROM   RM10101  JOIN RM30202   ON   RM10101.DOCNUMBR = RM30202.APTODCNM AND RM10101.RMDTYPAL = RM30202.APTODCTY JOIN RM20101   ON   RM30202.APFRDCNM = RM20101.DOCNUMBR AND RM30202.APFRDCTY = RM20101.RMDTYPAL   WHERE   RM10101.TRXSORCE = RM20101.TRXSORCE   AND   (RM10101.TRXSORCE LIKE ''RMSLS%''   OR   RM10101.TRXSORCE LIKE ''INVCE%''   OR   RM10101.TRXSORCE LIKE ''SLSTE%'')   AND   RM10101.PSTGSTUS = 1   AND   (RM10101.DISTTYPE = 3 OR RM10101.DISTTYPE = 5)   AND   RM20101.RMDTYPAL = 9   AND   RM10101.POSTEDDT BETWEEN ' + '''' + @iStartDate + '''' + ' AND ' + '''' + @iEndDate + '''' + '   AND   RM20101.VOIDSTTS = 1   AND   RM30202.TRXSORCE LIKE ''RMSLS%''   GROUP BY   RM10101.POSTEDDT,   RM10101.CUSTNMBR,   RM10101.TRXSORCE,   RM20101.DOCNUMBR,   RM20101.ORTRXAMT,   RM20101.RMDTYPAL,   RM20101.VOIDSTTS ')   EXEC(   'INSERT INTO ' +   @iRMTempTable +   ' (POSTEDDT,   CUSTNMBR,   TRXSORCE,   DOCNUMBR,   STRVAL,   ACCTAMNT,   TRX_ID,   RMDTYPAL,   HISTRX,   VOIDSTTS)   SELECT   RM30301.POSTEDDT,   RM30301.CUSTNMBR,   RM30301.TRXSORCE,   RM30101.DOCNUMBR,   '''',   -RM30101.ORTRXAMT,   SUBSTRING(RM30301.TRXSORCE, 1, 5),   RM30101.RMDTYPAL,   1,   RM30101.VOIDSTTS   FROM   RM30301  JOIN RM30202   ON   RM30301.DOCNUMBR = RM30202.APTODCNM AND RM30301.RMDTYPAL = RM30202.APTODCTY JOIN RM30101   ON   RM30202.APFRDCNM = RM30101.DOCNUMBR AND RM30202.APFRDCTY = RM30101.RMDTYPAL   WHERE   RM30301.TRXSORCE = RM30101.TRXSORCE   AND   (RM30301.TRXSORCE LIKE ''RMSLS%''   OR   RM30301.TRXSORCE LIKE ''INVCE%''   OR   RM30301.TRXSORCE LIKE ''SLSTE%'')   AND   (RM30301.DISTTYPE = 3 OR RM30301.DISTTYPE = 5)   AND   RM30101.RMDTYPAL = 9   AND   RM30301.POSTEDDT BETWEEN ' + '''' + @iStartDate + '''' + ' AND ' + '''' + @iEndDate + '''' + '   AND   RM30101.VOIDSTTS = 1   AND   RM30202.TRXSORCE LIKE ''RMSLS%''   GROUP BY   RM30301.POSTEDDT,   RM30301.CUSTNMBR,   RM30301.TRXSORCE,   RM30101.DOCNUMBR,   RM30101.ORTRXAMT,   RM30101.RMDTYPAL,   RM30101.VOIDSTTS ')   EXEC(   'INSERT INTO ' +   @iRMTempTable +   ' (POSTEDDT,   CUSTNMBR,   TRXSORCE,   DOCNUMBR,   STRVAL,   ACCTAMNT,   TRX_ID,   RMDTYPAL,   HISTRX,   VOIDSTTS)   SELECT   RM10101.POSTEDDT,   RM10101.CUSTNMBR,   RM10101.TRXSORCE,   RM30101.DOCNUMBR,   '''',   -RM30101.ORTRXAMT,   SUBSTRING(RM10101.TRXSORCE, 1, 5),   RM30101.RMDTYPAL,   0,   RM30101.VOIDSTTS   FROM   RM10101  JOIN RM30202   ON   RM10101.DOCNUMBR = RM30202.APTODCNM AND RM10101.RMDTYPAL = RM30202.APTODCTY JOIN RM30101   ON   RM30202.APFRDCNM = RM30101.DOCNUMBR AND RM30202.APFRDCTY = RM30101.RMDTYPAL   WHERE   RM10101.TRXSORCE = RM30101.TRXSORCE   AND   (RM10101.TRXSORCE LIKE ''RMSLS%''   OR   RM10101.TRXSORCE LIKE ''INVCE%''   OR   RM10101.TRXSORCE LIKE ''SLSTE%'')   AND   RM10101.PSTGSTUS = 1   AND   (RM10101.DISTTYPE = 3 OR RM10101.DISTTYPE = 5)   AND   RM30101.RMDTYPAL = 9   AND   RM10101.POSTEDDT BETWEEN ' + '''' + @iStartDate + '''' + ' AND ' + '''' + @iEndDate + '''' + '   AND   RM30101.VOIDSTTS = 1   AND   RM30202.TRXSORCE LIKE ''RMSLS%''   GROUP BY   RM10101.POSTEDDT,   RM10101.CUSTNMBR,   RM10101.TRXSORCE,   RM30101.DOCNUMBR,   RM30101.ORTRXAMT,   RM30101.RMDTYPAL,   RM30101.VOIDSTTS ')   EXEC(   'INSERT INTO ' +   @iRMTempTable +   ' (POSTEDDT,   CUSTNMBR,   TRXSORCE,   DOCNUMBR,   STRVAL,   ACCTAMNT,   TRX_ID,   RMDTYPAL,   HISTRX,   VOIDSTTS)   SELECT   RM30301.POSTEDDT,   RM30301.CUSTNMBR,   RM30301.TRXSORCE,   RM20101.DOCNUMBR,   '''',   -RM20101.ORTRXAMT,   SUBSTRING(RM30301.TRXSORCE, 1, 5),   RM20101.RMDTYPAL,   1,   RM20101.VOIDSTTS   FROM   RM30301  JOIN RM30202   ON   RM30301.DOCNUMBR = RM30202.APTODCNM AND RM30301.RMDTYPAL = RM30202.APTODCTY JOIN RM20101   ON   RM30202.APFRDCNM = RM20101.DOCNUMBR AND RM30202.APFRDCTY = RM20101.RMDTYPAL   WHERE   RM30301.TRXSORCE = RM20101.TRXSORCE   AND   (RM30301.TRXSORCE LIKE ''RMSLS%''  OR  RM30301.TRXSORCE LIKE ''INVCE%''  OR  RM30301.TRXSORCE LIKE ''SLSTE%'')   AND   (RM30301.DISTTYPE = 3 OR RM30301.DISTTYPE = 5)   AND   RM20101.RMDTYPAL = 9   AND   RM30301.POSTEDDT BETWEEN ' + '''' + @iStartDate + '''' + ' AND ' + '''' + @iEndDate + '''' + '   AND   RM20101.VOIDSTTS = 1   AND   RM30202.TRXSORCE LIKE ''RMSLS%''   GROUP BY   RM30301.POSTEDDT,   RM30301.CUSTNMBR,   RM30301.TRXSORCE,   RM20101.DOCNUMBR,   RM20101.ORTRXAMT,   RM20101.RMDTYPAL,   RM20101.VOIDSTTS ')    EXEC(   'INSERT INTO ' +   @iRMTempTable +   ' (POSTEDDT,   CUSTNMBR,   TRXSORCE,   DOCNUMBR,   STRVAL,   ACCTAMNT,   TRX_ID,   RMDTYPAL,   HISTRX,   VOIDSTTS)   SELECT   RM10101.POSTEDDT,   RM10101.CUSTNMBR,   RM10101.TRXSORCE,   RM20101.DOCNUMBR,   '''',   -RM20101.ORTRXAMT,   SUBSTRING(RM10101.TRXSORCE, 1, 5),   RM20101.RMDTYPAL,   0,   RM20101.VOIDSTTS   FROM   RM10101  JOIN SOP10103   ON   RM10101.DOCNUMBR = SOP10103.SOPNUMBE AND RM10101.TRXSORCE = SOP10103.TRXSORCE JOIN RM20101   ON   SOP10103.DOCNUMBR = RM20101.DOCNUMBR   WHERE   RM10101.TRXSORCE = RM20101.TRXSORCE   AND   (RM10101.TRXSORCE LIKE ''RMSLS%''   OR   RM10101.TRXSORCE LIKE ''INVCE%''   OR   RM10101.TRXSORCE LIKE ''SLSTE%'')   AND   RM10101.PSTGSTUS = 1   AND   (RM10101.DISTTYPE = 3 OR RM10101.DISTTYPE = 5)   AND   RM20101.RMDTYPAL = 9   AND   RM10101.POSTEDDT BETWEEN ' + '''' + @iStartDate + '''' + ' AND ' + '''' + @iEndDate + '''' + '   AND   RM20101.VOIDSTTS = 1   AND   SOP10103.TRXSORCE LIKE ''SLSTE%''   GROUP BY   RM10101.POSTEDDT,   RM10101.CUSTNMBR,   RM10101.TRXSORCE,   RM20101.DOCNUMBR,   RM20101.ORTRXAMT,   RM20101.RMDTYPAL,   RM20101.VOIDSTTS ')    EXEC(   'INSERT INTO ' +   @iRMTempTable +   ' (POSTEDDT,   CUSTNMBR,   TRXSORCE,   DOCNUMBR,   STRVAL,   ACCTAMNT,   TRX_ID,   RMDTYPAL,   HISTRX,   VOIDSTTS)   SELECT   RM30301.POSTEDDT,   RM30301.CUSTNMBR,   RM30301.TRXSORCE,   RM30101.DOCNUMBR,   '''',   -RM30101.ORTRXAMT,   SUBSTRING(RM30301.TRXSORCE, 1, 5),   RM30101.RMDTYPAL,   1,   RM30101.VOIDSTTS   FROM   RM30301  JOIN SOP10103   ON   RM30301.DOCNUMBR = SOP10103.SOPNUMBE AND RM30301.TRXSORCE = SOP10103.TRXSORCE JOIN RM30101   ON   SOP10103.DOCNUMBR = RM30101.DOCNUMBR  WHERE   RM30301.TRXSORCE = RM30101.TRXSORCE   AND   (RM30301.TRXSORCE LIKE ''RMSLS%''   OR   RM30301.TRXSORCE LIKE ''INVCE%''   OR   RM30301.TRXSORCE LIKE ''SLSTE%'')   AND   (RM30301.DISTTYPE = 3 OR RM30301.DISTTYPE = 5)   AND   RM30101.RMDTYPAL = 9   AND   RM30301.POSTEDDT BETWEEN ' + '''' + @iStartDate + '''' + ' AND ' + '''' + @iEndDate + '''' + '   AND   RM30101.VOIDSTTS = 1   AND   SOP10103.TRXSORCE LIKE ''SLSTE%''   GROUP BY   RM30301.POSTEDDT,   RM30301.CUSTNMBR,   RM30301.TRXSORCE,   RM30101.DOCNUMBR,   RM30101.ORTRXAMT,   RM30101.RMDTYPAL,   RM30101.VOIDSTTS ')    EXEC(   'INSERT INTO ' +   @iRMTempTable +   ' (POSTEDDT,   CUSTNMBR,   TRXSORCE,   DOCNUMBR,   STRVAL,   ACCTAMNT,   TRX_ID,   RMDTYPAL,   HISTRX,   VOIDSTTS)   SELECT   RM10101.POSTEDDT,   RM10101.CUSTNMBR,   RM10101.TRXSORCE,   RM30101.DOCNUMBR,   '''',   -RM30101.ORTRXAMT,   SUBSTRING(RM10101.TRXSORCE, 1, 5),   RM30101.RMDTYPAL,   0,   RM30101.VOIDSTTS   FROM   RM10101  JOIN SOP10103   ON   RM10101.DOCNUMBR = SOP10103.SOPNUMBE AND RM10101.TRXSORCE = SOP10103.TRXSORCE JOIN RM30101   ON   SOP10103.DOCNUMBR = RM30101.DOCNUMBR   WHERE   RM10101.TRXSORCE = RM30101.TRXSORCE   AND   (RM10101.TRXSORCE LIKE ''RMSLS%''   OR   RM10101.TRXSORCE LIKE ''INVCE%''   OR   RM10101.TRXSORCE LIKE ''SLSTE%'')   AND   RM10101.PSTGSTUS = 1   AND   (RM10101.DISTTYPE = 3 OR RM10101.DISTTYPE = 5)   AND   RM30101.RMDTYPAL = 9   AND   RM10101.POSTEDDT BETWEEN ' + '''' + @iStartDate + '''' + ' AND ' + '''' + @iEndDate + '''' + '   AND   RM30101.VOIDSTTS = 1   AND   SOP10103.TRXSORCE LIKE ''SLSTE%''   GROUP BY   RM10101.POSTEDDT,   RM10101.CUSTNMBR,   RM10101.TRXSORCE,   RM30101.DOCNUMBR,   RM30101.ORTRXAMT,   RM30101.RMDTYPAL,   RM30101.VOIDSTTS ')    EXEC(   'INSERT INTO ' +   @iRMTempTable +   ' (POSTEDDT,   CUSTNMBR,   TRXSORCE,   DOCNUMBR,   STRVAL,   ACCTAMNT,   TRX_ID,   RMDTYPAL,   HISTRX,   VOIDSTTS)   SELECT   RM30301.POSTEDDT,   RM30301.CUSTNMBR,   RM30301.TRXSORCE,   RM20101.DOCNUMBR,   '''',   -RM20101.ORTRXAMT,   SUBSTRING(RM30301.TRXSORCE, 1, 5),   RM20101.RMDTYPAL,   1,   RM20101.VOIDSTTS   FROM   RM30301  JOIN SOP10103   ON   RM30301.DOCNUMBR = SOP10103.SOPNUMBE AND RM30301.TRXSORCE = SOP10103.TRXSORCE JOIN RM20101   ON   SOP10103.DOCNUMBR = RM20101.DOCNUMBR  WHERE   RM30301.TRXSORCE = RM20101.TRXSORCE   AND   (RM30301.TRXSORCE LIKE ''RMSLS%''  OR  RM30301.TRXSORCE LIKE ''INVCE%''  OR  RM30301.TRXSORCE LIKE ''SLSTE%'')   AND   (RM30301.DISTTYPE = 3 OR RM30301.DISTTYPE = 5)   AND   RM20101.RMDTYPAL = 9   AND   RM30301.POSTEDDT BETWEEN ' + '''' + @iStartDate + '''' + ' AND ' + '''' + @iEndDate + '''' + '   AND   RM20101.VOIDSTTS = 1   AND   SOP10103.TRXSORCE LIKE ''SLSTE%''   GROUP BY   RM30301.POSTEDDT,   RM30301.CUSTNMBR,   RM30301.TRXSORCE,   RM20101.DOCNUMBR,   RM20101.ORTRXAMT,   RM20101.RMDTYPAL,   RM20101.VOIDSTTS ')   EXEC(  'INSERT INTO ' +  @iRMTempTable +  ' (POSTEDDT,  CUSTNMBR,  TRXSORCE,  DOCNUMBR,  STRVAL,  ACCTAMNT,  TRX_ID,  RMDTYPAL,  HISTRX,  VOIDSTTS)  SELECT  RM10101.POSTEDDT,  RM10101.CUSTNMBR,  RM10101.TRXSORCE,  ''Total Payments'',  '''',  -RM20101.CASHAMNT,  SUBSTRING(RM10101.TRXSORCE, 1, 5),  9,  0,  RM20101.VOIDSTTS  FROM  RM10101 JOIN RM20101   ON  RM10101.TRXSORCE = RM20101.TRXSORCE  AND  RM10101.DOCNUMBR = RM20101.DOCNUMBR   AND   RM10101.RMDTYPAL = RM20101.RMDTYPAL JOIN RM00101  ON  RM20101.CUSTNMBR = RM00101.CUSTNMBR  WHERE  RM00101.BALNCTYP = 1  AND  (RM10101.TRXSORCE LIKE ''RMSLS%''  OR  RM10101.TRXSORCE LIKE ''INVCE%''  OR  RM10101.TRXSORCE LIKE ''SLSTE%'')  AND  RM10101.PSTGSTUS = 1  AND  RM10101.DISTTYPE = 1  AND  (RM20101.RMDTYPAL = 1  OR  RM20101.RMDTYPAL = 3  OR  RM20101.RMDTYPAL = 4  OR  RM20101.RMDTYPAL = 5)  AND  RM10101.POSTEDDT BETWEEN ' + '''' + @iStartDate + '''' + ' AND ' + '''' + @iEndDate + '''' +  ' GROUP BY  RM10101.POSTEDDT,  RM10101.CUSTNMBR,  RM10101.TRXSORCE,  RM20101.CASHAMNT,  RM20101.RMDTYPAL,  RM20101.VOIDSTTS ')  EXEC(  'INSERT INTO ' +  @iRMTempTable +  ' (POSTEDDT,  CUSTNMBR,  TRXSORCE,  DOCNUMBR,   STRVAL,  ACCTAMNT,  TRX_ID,  RMDTYPAL,  HISTRX,  VOIDSTTS)  SELECT  RM30301.POSTEDDT,  RM30301.CUSTNMBR,  RM30301.TRXSORCE,  ''Total Payments'',  '''',  -RM30101.CASHAMNT,  SUBSTRING(RM30301.TRXSORCE, 1, 5),  9,  1,  RM30101.VOIDSTTS  FROM  RM30301 JOIN RM30101   ON  RM30301.TRXSORCE = RM30101.TRXSORCE  AND  RM30301.DOCNUMBR = RM30101.DOCNUMBR   AND   RM30301.RMDTYPAL = RM30101.RMDTYPAL JOIN RM00101  ON  RM30101.CUSTNMBR = RM00101.CUSTNMBR  WHERE  RM00101.BALNCTYP = 1  AND  (RM30301.TRXSORCE LIKE ''RMSLS%''  OR  RM30301.TRXSORCE LIKE ''INVCE%''  OR  RM30301.TRXSORCE LIKE ''SLSTE%'')  AND  RM30301.DISTTYPE = 1  AND  (RM30101.RMDTYPAL = 1  OR  RM30101.RMDTYPAL = 3  OR  RM30101.RMDTYPAL = 4  OR  RM30101.RMDTYPAL = 5)  AND  RM30301.POSTEDDT BETWEEN ' + '''' + @iStartDate + '''' + ' AND ' + '''' + @iEndDate + '''' +  ' GROUP BY  RM30301.POSTEDDT,  RM30301.CUSTNMBR,  RM30301.TRXSORCE,  RM30101.CASHAMNT,  RM30101.RMDTYPAL,  RM30101.VOIDSTTS ')  EXEC(  'INSERT INTO ' +  @iRMTempTable +  ' (POSTEDDT,  CUSTNMBR,  TRXSORCE,  DOCNUMBR,   STRVAL,  ACCTAMNT,  TRX_ID,  RMDTYPAL,  HISTRX,  VOIDSTTS)  SELECT  RM10101.POSTEDDT,  RM10101.CUSTNMBR,  RM10101.TRXSORCE,  RM20101.DOCNUMBR,  '''',  RM20101.CASHAMNT,  SUBSTRING(RM10101.TRXSORCE, 1, 5),  10,  0,  RM20101.VOIDSTTS  FROM  RM20101 JOIN RM10101   ON  RM20101.TRXSORCE = RM10101.TRXSORCE  AND  RM20101.DOCNUMBR = RM10101.DOCNUMBR  AND   RM20101.RMDTYPAL = RM10101.RMDTYPAL   WHERE  RM20101.RMDTYPAL = 8  AND  RM10101.PSTGSTUS = 1  AND  (RM10101.DISTTYPE = 3 OR RM10101.DISTTYPE = 5)  AND  RM20101.CASHAMNT <> 0  AND  RM10101.POSTEDDT BETWEEN ' + '''' + @iStartDate + '''' + ' AND ' + '''' + @iEndDate + '''' +  ' GROUP BY  RM10101.POSTEDDT,  RM10101.CUSTNMBR,  RM10101.TRXSORCE,  RM20101.DOCNUMBR,  RM20101.CASHAMNT,  RM20101.VOIDSTTS ')  EXEC(  'INSERT INTO ' +  @iRMTempTable +  ' (POSTEDDT,  CUSTNMBR,  TRXSORCE,  DOCNUMBR,   STRVAL,  ACCTAMNT,  TRX_ID,  RMDTYPAL,  HISTRX,  VOIDSTTS)  SELECT  RM30301.POSTEDDT,  RM30301.CUSTNMBR,  RM30301.TRXSORCE,  RM30101.DOCNUMBR,  '''',  RM30101.CASHAMNT,  SUBSTRING(RM30301.TRXSORCE, 1, 5),  10,  0,  RM30101.VOIDSTTS  FROM  RM30101 JOIN RM30301   ON  RM30101.TRXSORCE = RM30301.TRXSORCE  AND  RM30101.DOCNUMBR = RM30301.DOCNUMBR  AND   RM30101.RMDTYPAL = RM30301.RMDTYPAL  WHERE  RM30101.RMDTYPAL = 8  AND  (RM30301.DISTTYPE = 3 OR RM30301.DISTTYPE = 5)  AND  RM30101.CASHAMNT <> 0  AND  RM30301.POSTEDDT BETWEEN ' + '''' + @iStartDate + '''' + ' AND ' + '''' + @iEndDate + '''' +  ' GROUP BY  RM30301.POSTEDDT,  RM30301.CUSTNMBR,  RM30301.TRXSORCE,  RM30101.DOCNUMBR,  RM30101.CASHAMNT,  RM30101.VOIDSTTS ')  EXEC(  'INSERT INTO ' +  @iRMTempTable +  ' (POSTEDDT,  CUSTNMBR,  TRXSORCE,  DOCNUMBR,   STRVAL,  ACCTAMNT,  TRX_ID,  RMDTYPAL,  HISTRX,  VOIDSTTS)  SELECT  POSTEDDT,  CUSTNMBR,  TRXSORCE,  DOCNUMBR,  ''/Discount Taken'',  -SUM(DEBITAMT - CRDTAMNT),  SUBSTRING(TRXSORCE, 1, 5),  11,  0,  0  FROM  RM10101 A   WHERE  (TRXSORCE LIKE ''RMSLS%''  OR  TRXSORCE LIKE ''INVCE%''  OR  TRXSORCE LIKE ''SLSTE%'')  AND  PSTGSTUS = 1  AND  DISTTYPE = 2  AND  POSTEDDT BETWEEN ' + '''' + @iStartDate + '''' + ' AND ' + '''' + @iEndDate + '''' +  '   AND EXISTS  (  SELECT 1  FROM RM10101  WHERE   DISTTYPE =3   AND   DOCNUMBR = A.DOCNUMBR   AND   RMDTYPAL = A.RMDTYPAL  )   GROUP BY  POSTEDDT,  CUSTNMBR,  TRXSORCE,  DOCNUMBR,  RMDTYPAL ')  EXEC(  'INSERT INTO ' +  @iRMTempTable +  ' (POSTEDDT,  CUSTNMBR,  TRXSORCE,  DOCNUMBR,   STRVAL,  ACCTAMNT,  TRX_ID,  RMDTYPAL,  HISTRX,  VOIDSTTS)  SELECT  POSTEDDT,  CUSTNMBR,  TRXSORCE,  DOCNUMBR,  ''/Discount Taken'',  -SUM(DEBITAMT - CRDTAMNT),  SUBSTRING(TRXSORCE, 1, 5),  11,  0,  0  FROM  RM30301 A   WHERE  (TRXSORCE LIKE ''RMSLS%''  OR  TRXSORCE LIKE ''INVCE%''  OR  TRXSORCE LIKE ''SLSTE%'')  AND  DISTTYPE = 2  AND  POSTEDDT BETWEEN ' + '''' + @iStartDate + '''' + ' AND ' + '''' + @iEndDate + '''' +  '   AND EXISTS  (  SELECT 1  FROM RM30301  WHERE   DISTTYPE =3   AND   DOCNUMBR = A.DOCNUMBR   AND   RMDTYPAL = A.RMDTYPAL  )  GROUP BY  POSTEDDT,  CUSTNMBR,  TRXSORCE,  DOCNUMBR,  RMDTYPAL ')  EXEC(  'INSERT INTO ' +  @iRMTempTable +  ' (POSTEDDT,  CUSTNMBR,  TRXSORCE,  DOCNUMBR,  STRVAL,   ACCTAMNT,  TRX_ID,  RMDTYPAL,  HISTRX,  VOIDSTTS)  SELECT  POSTEDDT,  CUSTNMBR,  TRXSORCE,  DOCNUMBR,  '''',  (SUM(DEBITAMT) - SUM(CRDTAMNT)),  SUBSTRING(TRXSORCE, 1, 5),  1,  0,  0  FROM  RM10101   WHERE  (TRXSORCE LIKE ''RMAPY%'' OR TRXSORCE LIKE ''RMMSC%'')  AND  PSTGSTUS = 1  AND  (DISTTYPE = 3 OR DISTTYPE = 5)  AND  POSTEDDT BETWEEN ' + '''' + @iStartDate + '''' + ' AND ' + '''' + @iEndDate + '''' +  ' AND  not exists(select 1 from RM20101 where DOCNUMBR = RM10101.DOCNUMBR and RMDTYPAL = RM10101.RMDTYPAL and TRXDSCRN = ''NSF Charge'')  GROUP BY  POSTEDDT,  CUSTNMBR,  TRXSORCE,  DOCNUMBR ')  EXEC(  'INSERT INTO ' +  @iRMTempTable +  ' (POSTEDDT,  CUSTNMBR,  TRXSORCE,  DOCNUMBR,  STRVAL,  ACCTAMNT,  TRX_ID,  RMDTYPAL,  HISTRX,  VOIDSTTS)  SELECT  POSTEDDT,  CUSTNMBR,  TRXSORCE,  DOCNUMBR,  ''/'' + ''Revaluation'',  (SUM(DEBITAMT) - SUM(CRDTAMNT)),  SUBSTRING(TRXSORCE, 1, 5),  1,  0,  0  FROM  RM10101   WHERE  TRXSORCE LIKE ''RMRVL%''  AND  PSTGSTUS = 1  AND  (DISTTYPE = 3 OR DISTTYPE = 5)  AND  POSTEDDT BETWEEN ' + '''' + @iStartDate + '''' + ' AND ' + '''' + @iEndDate + '''' +  ' GROUP BY  POSTEDDT,  CUSTNMBR,  TRXSORCE,  DOCNUMBR ')   EXEC(  'INSERT INTO ' +  @iRMTempTable +  ' (POSTEDDT,  CUSTNMBR,  TRXSORCE,  DOCNUMBR,  STRVAL,  ACCTAMNT,  TRX_ID,  RMDTYPAL,  HISTRX,  VOIDSTTS)  SELECT  POSTEDDT,  CUSTNMBR,  TRXSORCE,  DOCNUMBR,  '''',  (SUM(DEBITAMT) - SUM(CRDTAMNT)),  SUBSTRING(TRXSORCE, 1, 5),  1,  1,  0  FROM  RM30301  WHERE  (TRXSORCE LIKE ''RMAPY%'' OR TRXSORCE LIKE ''RMMSC%'')  AND  (DISTTYPE = 3 OR DISTTYPE = 5)  AND  POSTEDDT BETWEEN ' + '''' + @iStartDate + '''' + ' AND ' + '''' + @iEndDate + '''' +  ' AND  not exists(select 1 from RM30101 where DOCNUMBR = RM30301.DOCNUMBR and RMDTYPAL = RM30301.RMDTYPAL and TRXDSCRN = ''NSF Charge'')  GROUP BY  POSTEDDT,  CUSTNMBR,  TRXSORCE,  DOCNUMBR ')  EXEC(  'INSERT INTO ' +  @iRMTempTable +  ' (POSTEDDT,  CUSTNMBR,  TRXSORCE,  DOCNUMBR,  STRVAL,  ACCTAMNT,  TRX_ID,  RMDTYPAL,  HISTRX,  VOIDSTTS)  SELECT  POSTEDDT,  CUSTNMBR,  TRXSORCE,  DOCNUMBR,  ''/'' + ''Revaluation'',  (SUM(DEBITAMT) - SUM(CRDTAMNT)),  SUBSTRING(TRXSORCE, 1, 5),  1,  1,  0  FROM  RM30301  WHERE  TRXSORCE LIKE ''RMRVL%''  AND  (DISTTYPE = 3 OR DISTTYPE = 5)  AND  POSTEDDT BETWEEN ' + '''' + @iStartDate + '''' + ' AND ' + '''' + @iEndDate + '''' +  ' GROUP BY  POSTEDDT,  CUSTNMBR,  TRXSORCE,  DOCNUMBR ')   DROP TABLE  ##AccountAmountOpen,  ##AccountAmountHistory  RETURN (@lSQLError)    
GO
GRANT EXECUTE ON  [dbo].[glGetRMTransactions] TO [DYNGRP]
GO
