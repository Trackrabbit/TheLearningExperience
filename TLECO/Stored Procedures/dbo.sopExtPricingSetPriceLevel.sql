SET QUOTED_IDENTIFIER OFF
GO
SET ANSI_NULLS ON
GO
 CREATE PROCEDURE [dbo].[sopExtPricingSetPriceLevel]   @iMCReg integer  AS  DECLARE @loSM_CompanyID SMALLINT,  @loIN_Next_Note_ID INTEGER,  @loST_ITEMNMBR CHAR(31),  @loST_PriceGroup CHAR(10),  @iMessageNumber INTEGER,  @cDBName CHAR(10),  @EXTPRCLVL CHAR(15),  @BASEBOOK CHAR(15),  @cMessageText CHAR(15),  @oErrorState INTEGER,  @iStatus INTEGER  SET NOCOUNT ON  SELECT @cDBName = db_name()  SELECT @loSM_CompanyID = CMPANYID FROM DYNAMICS..SY01500  WHERE INTERID = @cDBName  SELECT @iMessageNumber = 5005 exec @iStatus = DYNAMICS..smGetMsgString  @iMessageNumber,   @cDBName,   @EXTPRCLVL output,  @oErrorState output  SELECT @iMessageNumber = 5013 exec @iStatus = DYNAMICS..smGetMsgString  @iMessageNumber,   @cDBName,   @BASEBOOK output,  @oErrorState output  IF (SELECT COUNT(*) FROM IV40800 WHERE PRCLEVEL = @EXTPRCLVL) = 0  BEGIN  SELECT @iMessageNumber = 5053  exec @iStatus = DYNAMICS..smGetMsgString  @iMessageNumber,   @cDBName,   @cMessageText output,  @oErrorState output   UPDATE DYNAMICS..SY01500  SET @loIN_Next_Note_ID = NOTEINDX, NOTEINDX = NOTEINDX + 1  WHERE CMPANYID = @loSM_CompanyID  INSERT INTO IV40800  (PRCLEVEL, DSCRIPTN, NOTEINDX)  VALUES (@EXTPRCLVL, @cMessageText, @loIN_Next_Note_ID) END  IF (SELECT COUNT(*) FROM SOP10109 WHERE PRCBKID = @BASEBOOK) = 0 BEGIN     SELECT @iMessageNumber = 4959  exec @iStatus = DYNAMICS..smGetMsgString  @iMessageNumber,   @cDBName,   @cMessageText output,  @oErrorState output   UPDATE DYNAMICS..SY01500  SET @loIN_Next_Note_ID = NOTEINDX, NOTEINDX = NOTEINDX + 1  WHERE CMPANYID = @loSM_CompanyID  INSERT INTO SOP10109 VALUES(@BASEBOOK, @cMessageText, 1, @loIN_Next_Note_ID) END  DECLARE IV00101_CURS CURSOR FOR  SELECT ITEMNMBR FROM IV00101  ORDER BY ITEMNMBR  OPEN IV00101_CURS  FETCH IV00101_CURS INTO @loST_ITEMNMBR  WHILE @@FETCH_STATUS = 0 BEGIN  EXECUTE sopExtPricingPriceBookSetup @loST_ITEMNMBR, @loST_PriceGroup, @iMCReg   FETCH IV00101_CURS INTO @loST_ITEMNMBR END close IV00101_CURS deallocate IV00101_CURS  UPDATE IV00101   SET  PriceGroup = '',  PRCLEVEL = @EXTPRCLVL  UPDATE IV40400   SET PriceGroup = '' RETURN 0    
GO
GRANT EXECUTE ON  [dbo].[sopExtPricingSetPriceLevel] TO [DYNGRP]
GO
