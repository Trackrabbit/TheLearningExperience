SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO
 create procedure [dbo].[glInquiryNetChangeCalcTotals] @I_sOpenYear smallint   =  NULL, @I_iAccountIndex int     = NULL, @I_dFirstDayFiscalYear datetime   =  NULL, @I_UseReportingLedgers binary(4)   = NULL, @O_mBeginningBalance numeric(19,5)   = NULL output, @O_mDebitTotal numeric(19,5)  = NULL output, @O_mCreditTotal numeric(19,5)  = NULL output, @O_sTotalEntries smallint   =  NULL output, @O_iErrorState int     = NULL output  as  DECLARE @IncludeLedgerBase int,  @IncludeLedgerIFRS int,  @IncludeLedgerLocal int  if @I_sOpenYear is NULL or  @I_iAccountIndex is NULL or  @I_dFirstDayFiscalYear is NULL or  @I_UseReportingLedgers is NULL begin  select  @O_iErrorState = 20652  return end  select @O_mBeginningBalance = 0.0,  @O_mDebitTotal  = 0.0,  @O_mCreditTotal  = 0.0,  @O_sTotalEntries  = 0,  @O_iErrorState  = 0  select @IncludeLedgerBase = power(2,24),   @IncludeLedgerIFRS = power(2,25),   @IncludeLedgerLocal = power(2,26)   select @IncludeLedgerBase = @IncludeLedgerBase & @I_UseReportingLedgers select @IncludeLedgerIFRS = @IncludeLedgerIFRS & @I_UseReportingLedgers select @IncludeLedgerLocal = @IncludeLedgerLocal & @I_UseReportingLedgers  if @IncludeLedgerBase <> 0  begin  select @IncludeLedgerBase = 1  end if @IncludeLedgerIFRS <> 0  begin  select @IncludeLedgerIFRS = 2  end if @IncludeLedgerLocal <> 0  begin  select @IncludeLedgerLocal = 3  end   select  @O_mBeginningBalance = sum(DEBITAMT) - sum(CRDTAMNT) from  GL20000 where  ACTINDX = @I_iAccountIndex and TRXDATE < @I_dFirstDayFiscalYear and OPENYEAR = @I_sOpenYear and Ledger_ID in (@IncludeLedgerBase, @IncludeLedgerIFRS, @IncludeLedgerLocal)  if @O_mBeginningBalance is NULL  select @O_mBeginningBalance = 0.0  select  @O_mDebitTotal = sum(DEBITAMT),  @O_mCreditTotal = sum(CRDTAMNT) from  GL20000 where  ACTINDX = @I_iAccountIndex and TRXDATE >= @I_dFirstDayFiscalYear and OPENYEAR = @I_sOpenYear and Ledger_ID in (@IncludeLedgerBase, @IncludeLedgerIFRS, @IncludeLedgerLocal)  if @O_mDebitTotal is NULL  select @O_mDebitTotal = 0.0  if @O_mCreditTotal is NULL  select @O_mCreditTotal = 0.0  select  @O_sTotalEntries = count(ACTINDX) from  GL20000 where  ACTINDX = @I_iAccountIndex and OPENYEAR = @I_sOpenYear and Ledger_ID in (@IncludeLedgerBase, @IncludeLedgerIFRS, @IncludeLedgerLocal)  if @O_sTotalEntries is NULL  select @O_sTotalEntries = 0  return    
GO
GRANT EXECUTE ON  [dbo].[glInquiryNetChangeCalcTotals] TO [DYNGRP]
GO
