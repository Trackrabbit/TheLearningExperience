SET QUOTED_IDENTIFIER OFF
GO
SET ANSI_NULLS ON
GO
 create         procedure [dbo].[aagDelGLWorkAssign]  @iHdrID int,  @iDistID int,  @iAssignID int,  @oStatus int = null out as  declare @transaction tinyint,  @retCode int,  @dbName varchar(32),  @companyID smallint,  @companyStatus smallint,  @HdrID int,  @DistID int,  @AssignID int  select  @transaction = 0,  @retCode = 0,  @dbName = '',  @companyID = 0,  @companyStatus = 0,  @HdrID = 0,  @DistID = 0,  @AssignID = 0,  @oStatus = 0  if (@iHdrID is null) or (@iDistID is null)  begin select @oStatus = 35000 return end  if (@iHdrID = 0) or (@iDistID = 0)  begin select @oStatus = 35001 return end  select @dbName = db_name() exec @retCode = DYNAMICS.dbo.aagGetCompanyStatus @dbName, @companyID out, @companyStatus out, @oStatus out  if ((@retCode <> 0) or (@oStatus <> 0)) return @retCode  if (@iAssignID <> 0)  begin  select @HdrID = aaGLWorkHdrID, @DistID = aaGLWorkDistID, @AssignID = aaGLWorkAssignID from AAG10002   where aaGLWorkHdrID = @iHdrID and aaGLWorkDistID = @iDistID and aaGLWorkAssignID = @iAssignID   if (@@rowcount <> 1) return 0   if (@@trancount = 0) begin select @transaction = 1 begin transaction end   delete SY03900 from SY03900   join AAG10002 on SY03900.NOTEINDX = AAG10002.NOTEINDX  where  aaGLWorkHdrID = @HdrID and aaGLWorkDistID = @DistID and aaGLWorkAssignID = @AssignID   delete from AAG10003 where aaGLWorkHdrID = @HdrID and aaGLWorkDistID = @DistID and aaGLWorkAssignID = @AssignID  delete from AAG10002 where aaGLWorkHdrID = @HdrID and aaGLWorkDistID = @DistID and aaGLWorkAssignID = @AssignID   if (@transaction = 1) commit transaction   return 0 end  select @HdrID = aaGLWorkHdrID, @DistID = aaGLWorkDistID, @AssignID = aaGLWorkAssignID from AAG10002   where aaGLWorkHdrID = @iHdrID and aaGLWorkDistID = @iDistID   if (@@rowcount = 0) return 0  if (@@trancount = 0) begin select @transaction = 1 begin transaction end  delete from AAG10003 where aaGLWorkHdrID = @HdrID and aaGLWorkDistID = @DistID  delete from AAG10002 where aaGLWorkHdrID = @HdrID and aaGLWorkDistID = @DistID   if (@transaction = 1) commit transaction  return 0    
GO
GRANT EXECUTE ON  [dbo].[aagDelGLWorkAssign] TO [DYNGRP]
GO
