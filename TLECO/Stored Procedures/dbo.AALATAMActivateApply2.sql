SET QUOTED_IDENTIFIER OFF
GO
SET ANSI_NULLS OFF
GO
 CREATE PROCEDURE [dbo].[AALATAMActivateApply2]  @Doc_Type as int,   @Doc_numbr as char(20),  @HdrID as int,  @bFoundRec as int out,  @bDeleteRec as int out,  @oStatus as int out  AS  DECLARE  @Ingreso_Type as char(21),  @Ingreso_Num as char(21),   @aagGetHdrID as int,   @aagGetHdrID1 as int,  @APTVCHNM as char(21),  @SPCLDIST as smallint,  @DSTSQNUM as int,  @APTODCTY as smallint,  @CRDTAMNT as numeric(19,5),  @DEBITAMT as numeric(19,5),  @DSTINDX  as int,  @DISTTYPE as smallint,  @CURNCYID as char(15),  @ORCRDAMT as numeric(19,5),  @ORDBTAMT as numeric(19,5),  @CURRNIDX as int,   @PSTGDATE as datetime,  @TotRec as int,  @nCounter as int ,  @aaSubLedgerHdrID as int,  @aaSubLedgerDistID as int,  @INTERID as char(5),  @CorrespondingUnit as char(5),  @ACTINDX as int,  @DISTTYPE1 as int,  @ACCTTYPE as int,  @aaBrowseType as int,  @DECPLACS as int,  @DEBITAMT1 as numeric(19,5),  @CRDTAMNT1 as numeric(19,5),  @ORDBTAMT1 as numeric(19,5),  @ORCRDAMT1 as numeric(19,5),  @CURNCYID1 as char(15),  @CURRNIDX1 as int,  @RATETPID as char(15),  @EXGTBLID as char(15),  @XCHGRATE as numeric(19,7),  @EXCHDATE as datetime,  @TIME1 as datetime,  @RTCLCMTD as int,  @DENXRATE as numeric(19,7),  @MCTRXSTT as int,  @SEQNUMBR as int,  @GLPOSTDT as datetime,  @aaCustID as char(15),  @aaVendID as char(15),  @aaSiteID as char(11),  @aaItemID as char(31),  @aaCopyStatus as smallint,  @aaWinWasOpen as tinyint,  @POSTED as tinyint,  @HISTORY as tinyint,  @aaDistErrors as binary,  @APTVCHNM1 as char(21),  @APTODCTY1 as smallint,  @aaFutureDist as int,  @aaOffsetAcct as tinyint,  @ITEMNMBR as char(31),  @TRXLOCTN as char(11),  @BINNMBR as char(21),  @TRNSTLOC as char(11),  @TRXQTY as numeric(19,5),  @aaChangeDate as datetime,  @aaChangeTime as datetime,  @DEX_ROW_ID as int,  @MaxaaSubLedgerHdrID as int,  @aaMaxSubLedgerDistID as int,  @aaMinSubLedgerDistID as int,  @aaSubLedgerAssignID as int,  @aaTrxDimID as int,  @aaTrxCodeID as int,  @noteindx as numeric(19,5),  @IMPORTE  as numeric(19,5),  @nStatus as int,  @GLACCTTYPE as smallint,  @IN_ActClassID as int,  @IN_BrowseType as smallint,  @DECPLCUR as int,  @LastDistID as int   BEGIN  DECLARE AAGHdr1 CURSOR FOR  SELECT aaSubLedgerHdrID ,aaSubLedgerDistID,INTERID,CorrespondingUnit,ACTINDX,DISTTYPE,ACCTTYPE,aaBrowseType,  DECPLACS,CRDTAMNT,DEBITAMT,ORCRDAMT,ORDBTAMT,CURNCYID,CURRNIDX,RATETPID,EXGTBLID  ,XCHGRATE,EXCHDATE,TIME1,RTCLCMTD,DENXRATE,MCTRXSTT,SEQNUMBR,GLPOSTDT,aaCustID,aaVendID,aaSiteID,aaItemID,  aaCopyStatus,aaWinWasOpen,POSTED ,HISTORY,aaDistErrors,APTVCHNM,APTODCTY,aaFutureDist,aaOffsetAcct,  ITEMNMBR,TRXLOCTN,BINNMBR,TRNSTLOC,TRXQTY,aaChangeDate,aaChangeTime,DEX_ROW_ID   from AAG20001 where aaSubLedgerHdrID = @HdrID AND aaSubLedgerHdrID > 0 AND aaFutureDist = 0 AND POSTED = 0 AND aaBrowseType <> 0   AND aaBrowseType <> 3   OPEN AAGHdr1  FETCH NEXT FROM AAGHdr1 INTO @aaSubLedgerHdrID ,@aaSubLedgerDistID,@INTERID,@CorrespondingUnit,@ACTINDX,@DISTTYPE1,@ACCTTYPE,@aaBrowseType,  @DECPLACS,@CRDTAMNT1,@DEBITAMT1,@ORCRDAMT1,@ORDBTAMT1,@CURNCYID1,@CURRNIDX1,@RATETPID,@EXGTBLID  ,@XCHGRATE,@EXCHDATE,@TIME1,@RTCLCMTD,@DENXRATE,@MCTRXSTT,@SEQNUMBR,@GLPOSTDT,@aaCustID,@aaVendID,@aaSiteID,@aaItemID,  @aaCopyStatus,@aaWinWasOpen,@POSTED,@HISTORY,@aaDistErrors,@APTVCHNM1,@APTODCTY1,@aaFutureDist,@aaOffsetAcct,  @ITEMNMBR,@TRXLOCTN,@BINNMBR,@TRNSTLOC,@TRXQTY,@aaChangeDate,@aaChangeTime,@DEX_ROW_ID   set @bDeleteRec = 0  WHILE @@FETCH_STATUS = 0  BEGIN  set @LastDistID = @aaSubLedgerDistID  set @bFoundRec = 0  DECLARE PmDist CURSOR FOR   SELECT APTVCHNM,SPCLDIST,DSTSQNUM,APTODCTY,CRDTAMNT,DEBITAMT,DSTINDX,DISTTYPE,CURNCYID,  ORCRDAMT,ORDBTAMT,CURRNIDX,PSTGDATE FROM PM10100 where CNTRLTYP = @Doc_Type and VCHRNMBR = @Doc_numbr  OPEN PmDist   FETCH NEXT FROM PmDist INTO @APTVCHNM,@SPCLDIST,@DSTSQNUM,@APTODCTY,@CRDTAMNT,@DEBITAMT,@DSTINDX,@DISTTYPE,@CURNCYID,  @ORCRDAMT,@ORDBTAMT,@CURRNIDX,@PSTGDATE  WHILE @@FETCH_STATUS = 0  BEGIN  IF @SEQNUMBR=@DSTSQNUM  AND @APTVCHNM1 = @APTVCHNM  AND @APTODCTY1 = @APTODCTY   BEGIN  set @bFoundRec = 1  BREAK  END  FETCH NEXT FROM PmDist INTO @APTVCHNM,@SPCLDIST,@DSTSQNUM,@APTODCTY,@CRDTAMNT,@DEBITAMT,@DSTINDX,@DISTTYPE,@CURNCYID,  @ORCRDAMT,@ORDBTAMT,@CURRNIDX,@PSTGDATE  END   CLOSE PmDist   DEALLOCATE PmDist   IF @bFoundRec = 0  BEGIN  EXEC aagDelSubLedgerDist @HdrID,@LastDistID,@nStatus  set @oStatus = @nStatus  set @bDeleteRec = 1  END    FETCH NEXT FROM AAGHdr1 INTO @aaSubLedgerHdrID ,@aaSubLedgerDistID,@INTERID,@CorrespondingUnit,@ACTINDX,@DISTTYPE1,@ACCTTYPE,@aaBrowseType,  @DECPLACS,@CRDTAMNT1,@DEBITAMT1,@ORCRDAMT1,@ORDBTAMT1,@CURNCYID1,@CURRNIDX1,@RATETPID,@EXGTBLID  ,@XCHGRATE,@EXCHDATE,@TIME1,@RTCLCMTD,@DENXRATE,@MCTRXSTT,@SEQNUMBR,@GLPOSTDT,@aaCustID,@aaVendID,@aaSiteID,@aaItemID,  @aaCopyStatus,@aaWinWasOpen,@POSTED,@HISTORY,@aaDistErrors,@APTVCHNM1,@APTODCTY1,@aaFutureDist,@aaOffsetAcct,  @ITEMNMBR,@TRXLOCTN,@BINNMBR,@TRNSTLOC,@TRXQTY,@aaChangeDate,@aaChangeTime,@DEX_ROW_ID  END  CLOSE AAGHdr1   DEALLOCATE AAGHdr1   END    
GO
GRANT EXECUTE ON  [dbo].[AALATAMActivateApply2] TO [DYNGRP]
GO
