SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO
 CREATE procedure [dbo].[aagAlertForPartialAssignmentGLWorkDist] @I_nValidationLevel smallint =0,  @I_cTableAssign nvarchar(30) = null, @I_cTableCode nvarchar(30) = null, @I_cTableError nvarchar(30) = null, @I_nHdrID int = 0, @I_nDistID    int = 0, @I_nDistDebitAmt numeric(19,5) = 0, @I_nDistCreditAmt numeric(19,5) = 0, @I_nAcctClassID int = 0, @I_fDocVal tinyint = 1, @O_fSuccess tinyint = 1 output as begin  declare  @nAssignID    int,  @cTrxDim    char(15),  @cTrxDimCode   char(30),  @cRelTrxDim   char(15),  @cRelTrxDimCode  char(30),  @nErrorNum       int,  @nAssignDebitAmt  numeric(19,5),  @nAssignCreditAmt  numeric(19,5),  @nTotAssignDebitAmt numeric(19,5),  @nTotAssignCreditAmt numeric(19,5),  @fValidCodeSetting  tinyint,  @fValidCodeComb  tinyint,  @DisplayDistID int  set @nAssignDebitAmt = 0  set @nAssignCreditAmt = 0  set @nTotAssignDebitAmt = 0  set @nTotAssignCreditAmt = 0  set @O_fSuccess = 1  exec ('delete from ' + @I_cTableError + ' where aaGLWorkHdrID = ' + @I_nHdrID +  ' and aaGLWorkDistID =' + @I_nDistID)  exec ('declare aaGLWorkDist cursor fast_forward FOR select aaGLWorkAssignID,DEBITAMT,CRDTAMNT  from ' + @I_cTableAssign + ' where aaGLWorkHdrID = ' + @I_nHdrID +  ' and aaGLWorkDistID =' + @I_nDistID)  open aaGLWorkDist  fetch next from aaGLWorkDist into @nAssignID,@nAssignDebitAmt,@nAssignCreditAmt  WHILE @@fetch_status = 0  begin   set @nTotAssignDebitAmt = @nTotAssignDebitAmt + @nAssignDebitAmt  set @nTotAssignCreditAmt = @nTotAssignCreditAmt + @nAssignCreditAmt  fetch next from aaGLWorkDist into @nAssignID,@nAssignDebitAmt,@nAssignCreditAmt  end  close aaGLWorkDist  deallocate aaGLWorkDist   if(select aaIsOptionSet from AAG00700 where aaOption=6)=0   begin  if @I_nValidationLevel <> 1 and (@nTotAssignDebitAmt <> @I_nDistDebitAmt or @nTotAssignCreditAmt <> @I_nDistCreditAmt)  begin   if (select aaIsOptionSet from AAG00700 where aaOption=12)<>1   set @O_fSuccess = 0  end  end  return end    
GO
GRANT EXECUTE ON  [dbo].[aagAlertForPartialAssignmentGLWorkDist] TO [DYNGRP]
GO
