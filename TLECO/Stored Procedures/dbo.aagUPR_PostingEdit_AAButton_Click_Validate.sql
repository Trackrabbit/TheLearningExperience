SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO
 CREATE PROC [dbo].[aagUPR_PostingEdit_AAButton_Click_Validate] @I_USERID CHAR(15), @I_FRMEMPLCLAS CHAR(15), @I_TOEMPLCLAS CHAR(15), @I_FRMDEPRTMNT CHAR(7), @I_TODEPRTMNT CHAR(7), @I_FRMJOBTITLE CHAR(7), @I_TOJOBTITLE CHAR(7), @I_UPRACTYP SMALLINT, @I_FRMEMPLOYID CHAR(15), @I_TOEMPLOYID CHAR(15), @I_FILTERACTINDX INT, @I_FRMPAYROLCD CHAR(7), @I_TOPAYROLCD CHAR(7), @O_PYRLRTYP SMALLINT OUTPUT, @O_PYRNTYPE SMALLINT OUTPUT, @O_EMPLOYID CHAR(15) OUTPUT, @0_TRXNUMBER INT OUTPUT, @O_SEQNUMBR INT OUTPUT, @O_ACTINDX INT OUTPUT, @O_DEPARTMENT CHAR(7)  OUTPUT, @O_JOBTITLE CHAR(7)  OUTPUT, @O_PAYROLCD CHAR(7)  OUTPUT, @O_UPRACTYP SMALLINT OUTPUT, @O_ERRORVALID INT OUTPUT  AS BEGIN  DECLARE @STRFILTER VARCHAR(2000)   DECLARE @STRFILTER2 VARCHAR(50)  DECLARE @STRFILTER3 VARCHAR(50)  DECLARE @TESTINT INT   SET @STRFILTER = ''  SET @STRFILTER2 = ''  SET @O_ERRORVALID = 0   IF @I_FRMEMPLCLAS <> ''   BEGIN  IF @I_TOEMPLCLAS = ''   BEGIN  SET @I_TOEMPLCLAS = '˜˜˜˜˜˜˜˜˜˜˜˜˜'  END  SET @STRFILTER = ' AND (EMP.EMPLCLAS >= ''' + CONVERT(VARCHAR(21),@I_FRMEMPLCLAS) + ''' AND EMP.EMPLCLAS <= ''' + CONVERT(VARCHAR(21),@I_TOEMPLCLAS) + ''')'   END   IF @I_UPRACTYP <> 0   BEGIN   SET @STRFILTER = @STRFILTER + ' AND (PST.UPRACTYP = ' + CONVERT(VARCHAR(21),@I_UPRACTYP)+ ')'   END   IF @I_FRMDEPRTMNT <> ''   BEGIN  IF @I_TODEPRTMNT = ''   BEGIN  SET @I_TODEPRTMNT = '˜˜˜˜˜˜˜˜˜˜˜˜˜'  END  SET @STRFILTER = @STRFILTER + ' AND (PST.DEPRTMNT >= ''' + CONVERT(VARCHAR(21),@I_FRMDEPRTMNT) + ''' AND PST.DEPRTMNT <= ''' + CONVERT(VARCHAR(21),@I_TODEPRTMNT) + ''')'   END   IF @I_FRMJOBTITLE <> ''   BEGIN  IF @I_TOJOBTITLE = ''   BEGIN  SET @I_TOJOBTITLE = '˜˜˜˜˜˜˜˜˜˜˜˜˜'  END  SET @STRFILTER = @STRFILTER + ' AND (PST.JOBTITLE >= ''' + CONVERT(VARCHAR(21),@I_FRMJOBTITLE) + ''' AND PST.JOBTITLE <= ''' + CONVERT(VARCHAR(21),@I_TOJOBTITLE) + ''')'   END   IF @I_FRMEMPLOYID <> ''   BEGIN  IF @I_TOEMPLOYID = ''   BEGIN  SET @I_TOEMPLOYID = '˜˜˜˜˜˜˜˜˜˜˜˜˜'  END  SET @STRFILTER = @STRFILTER + ' AND (PST.EMPLOYID >= ''' + CONVERT(VARCHAR(21),@I_FRMEMPLOYID) + ''' AND PST.EMPLOYID <= ''' + CONVERT(VARCHAR(21),@I_TOEMPLOYID) + ''')'   END   IF @I_FILTERACTINDX <> 0   BEGIN  SET @STRFILTER2 = ' AND PST.ACTINDX = ' + CONVERT(VARCHAR(21),@I_FILTERACTINDX)   END   IF @O_ACTINDX <> 0 AND @O_SEQNUMBR <> 0  BEGIN  SET @STRFILTER3 = ' AND PST.ACTINDX = ' + CONVERT(VARCHAR(21),@O_ACTINDX) + ' AND PST.SEQNUMBR = ' + CONVERT(VARCHAR(21),@O_SEQNUMBR)   END  IF @I_FRMPAYROLCD <> ''  BEGIN  IF @I_TOPAYROLCD = ''   BEGIN  SET @I_TOPAYROLCD = '˜˜˜˜˜˜˜˜˜˜˜˜˜'  END  SET @STRFILTER = @STRFILTER + ' AND (PST.PAYROLCD >= ''' + CONVERT(VARCHAR(21),@I_FRMPAYROLCD) + ''' AND PST.PAYROLCD <= ''' + CONVERT(VARCHAR(21),@I_TOPAYROLCD) + ''')'  END  IF @O_PAYROLCD <> ''  BEGIN   SET @STRFILTER = @STRFILTER + ' AND (PST.PAYROLCD = ''' + CONVERT(VARCHAR(21),@O_PAYROLCD) + ''')'  END   IF @0_TRXNUMBER <> 0  BEGIN   SET @STRFILTER = @STRFILTER + ' AND (PST.TRXNUMBER = ' + CONVERT(VARCHAR(21),@0_TRXNUMBER) + ')'  END   SET @O_ACTINDX = 0   SET @TESTINT = 0   EXEC ('DECLARE CURAAPostingEdiVALIDATE_MAIN CURSOR FAST_FORWARD FOR SELECT TOP 1 1 FROM UPR10209 PST INNER JOIN UPR00100 EMP ON   PST.EMPLOYID = EMP.EMPLOYID INNER JOIN AAG00200 AA ON PST.ACTINDX = AA.ACTINDX  AND aaAcctClassID <> 0 WHERE PST.USERID = ''' + @I_USERID + ''' ' + @STRFILTER + ' ' + @STRFILTER2 + '')  OPEN CURAAPostingEdiVALIDATE_MAIN  FETCH NEXT FROM CURAAPostingEdiVALIDATE_MAIN INTO @TESTINT  WHILE @@FETCH_STATUS = 0   BEGIN  EXEC ('DECLARE CURAAPostingEdiVALIDATE CURSOR FAST_FORWARD FOR  SELECT  TOP 1 PYRNTYPE, PST.EMPLOYID, TRXNUMBER, SEQNUMBR, PST.ACTINDX, PYRLRTYP,  PST.DEPRTMNT, PST.JOBTITLE, PST.PAYROLCD, PST.UPRACTYP  FROM UPR10209 PST INNER JOIN UPR00100 EMP ON PST.EMPLOYID = EMP.EMPLOYID  INNER JOIN AAG00200 AA ON PST.ACTINDX = AA.ACTINDX  AND aaAcctClassID <> 0   WHERE PST.USERID = ''' + @I_USERID + ''' ' + @STRFILTER + '' + @STRFILTER2 + '' + @STRFILTER3 + '  ORDER BY PYRNTYPE,PYRLRTYP,TRXNUMBER,PST.SEQNUMBR')  OPEN CURAAPostingEdiVALIDATE  FETCH NEXT FROM CURAAPostingEdiVALIDATE INTO @O_PYRNTYPE, @O_EMPLOYID, @0_TRXNUMBER, @O_SEQNUMBR, @O_ACTINDX, @O_PYRLRTYP, @O_DEPARTMENT, @O_JOBTITLE, @O_PAYROLCD, @O_UPRACTYP  WHILE @@FETCH_STATUS = 0   BEGIN   IF @O_ACTINDX <> 0   BEGIN  FETCH NEXT FROM CURAAPostingEdiVALIDATE INTO @O_PYRNTYPE, @O_EMPLOYID, @0_TRXNUMBER, @O_SEQNUMBR, @O_ACTINDX, @O_PYRLRTYP, @O_DEPARTMENT, @O_JOBTITLE, @O_PAYROLCD, @O_UPRACTYP   END  END  CLOSE CURAAPostingEdiVALIDATE  DEALLOCATE CURAAPostingEdiVALIDATE    IF @O_ACTINDX <> 0  BEGIN  SET @O_ERRORVALID = 0  END  ELSE  BEGIN  SET @O_ERRORVALID = 2   END  IF @O_ACTINDX = 0   BEGIN  EXEC ('DECLARE CURAAPostingEdiVALIDATE_2 CURSOR FAST_FORWARD FOR  SELECT  TOP 1 PYRNTYPE, PST.EMPLOYID, TRXNUMBER, SEQNUMBR, PST.ACTINDX, PYRLRTYP,  PST.DEPRTMNT, PST.JOBTITLE, PST.PAYROLCD, PST.UPRACTYP  FROM UPR10209 PST INNER JOIN UPR00100 EMP ON PST.EMPLOYID = EMP.EMPLOYID  INNER JOIN AAG00200 AA ON PST.ACTINDX = AA.ACTINDX  AND aaAcctClassID <> 0   WHERE PST.USERID = ''' + @I_USERID + ''' ' + @STRFILTER + '' + @STRFILTER2 + '  ORDER BY PYRNTYPE,PYRLRTYP,TRXNUMBER,PST.SEQNUMBR')  OPEN CURAAPostingEdiVALIDATE_2  FETCH NEXT FROM CURAAPostingEdiVALIDATE_2 INTO @O_PYRNTYPE, @O_EMPLOYID, @0_TRXNUMBER, @O_SEQNUMBR, @O_ACTINDX, @O_PYRLRTYP, @O_DEPARTMENT, @O_JOBTITLE, @O_PAYROLCD, @O_UPRACTYP  WHILE @@FETCH_STATUS = 0   BEGIN   SET @O_ERRORVALID = 2  IF @O_ACTINDX <> 0   BEGIN  FETCH NEXT FROM CURAAPostingEdiVALIDATE_2 INTO @O_PYRNTYPE, @O_EMPLOYID, @0_TRXNUMBER, @O_SEQNUMBR, @O_ACTINDX, @O_PYRLRTYP, @O_DEPARTMENT, @O_JOBTITLE, @O_PAYROLCD, @O_UPRACTYP  END  END  CLOSE CURAAPostingEdiVALIDATE_2  DEALLOCATE CURAAPostingEdiVALIDATE_2   END   FETCH NEXT FROM CURAAPostingEdiVALIDATE_MAIN INTO @TESTINT  END  CLOSE CURAAPostingEdiVALIDATE_MAIN  DEALLOCATE CURAAPostingEdiVALIDATE_MAIN  IF @TESTINT = 0  BEGIN  SET @O_ERRORVALID = 1  END  END    
GO
GRANT EXECUTE ON  [dbo].[aagUPR_PostingEdit_AAButton_Click_Validate] TO [DYNGRP]
GO
