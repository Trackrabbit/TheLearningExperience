SET QUOTED_IDENTIFIER OFF
GO
SET ANSI_NULLS ON
GO
 create procedure [dbo].[svcLoadContractTrxListData]  @I_sTableName char(10) = NULL,  @I_nModule smallint = NULL,  @I_nCurrencyIndex   smallint = NULL,  @I_dtStart datetime = NULL,  @I_dtEnd datetime = NULL,  @I_fIncludeHistory tinyint  = NULL,  @I_nLanguageID smallint = 0,  @I_sRestriction char(255) = NULL,  @O_SQL_Error_State int   = NULL   output  as  declare @StartDate nvarchar(30), @EndDate nvarchar(30), @iStatus int, @iError int  select  @O_SQL_Error_State = 0,  @iStatus = 0,  @iError = 0  if (  @I_sTableName is NULL or  @I_dtStart is NULL or  @I_dtEnd is NULL or  @I_nModule is NULL or  @I_nCurrencyIndex is NULL or  @I_fIncludeHistory is NULL )  begin  select @O_SQL_Error_State = 26000  return end  select @StartDate = convert(nvarchar(30), @I_dtStart, 110) select @EndDate = convert(nvarchar(30), @I_dtEnd, 110)  if @I_nModule = 18  begin exec ('insert into ' + @I_sTableName + ' (' +  'HISTORY,SOURCE,DOCTYPE,DOCNUMBR,SVC_Contract_Version,DOCTYNAM,CNTTYPE,DSCRPTN1,DSCRPTN2,CUSTNMBR,CUSTNAME,ADRSCODE, ' +  'CURNCYID,CURRNIDX,CSTPONBR,ENTDTE,ENDDATE,PRICSHED,SLPRSNID,DOCAMNT,NXTBLDTE,BILSTAT,SVC_Evergreen_Contract,MKTOPROC,InfoValue) ' +  'select ' +   'HISTORY,SOURCE,DOCTYPE,DOCNUMBR, SVC_Contract_Version,' +  '(select DOCTYNAM = ' +  'case DOCTYPE ' +  'when 1 then (select SQL_MSG from DYNAMICS.dbo.MESSAGES where Language_ID = ' + @I_nLanguageID + ' and MSGNUM = 16688)' +  'when 2 then (select SQL_MSG from DYNAMICS.dbo.MESSAGES where Language_ID = ' + @I_nLanguageID + ' and MSGNUM = 5963)' +  'when 3 then (select SQL_MSG from DYNAMICS.dbo.MESSAGES where Language_ID = ' + @I_nLanguageID + ' and MSGNUM = 9773)' +  'when 4 then (select SQL_MSG from DYNAMICS.dbo.MESSAGES where Language_ID = ' + @I_nLanguageID + ' and MSGNUM = 12085)' +  'else ' + '''' + ' ' + '''' +  'end), ' +  'CNTTYPE, '+  '(select DSCRPTN1 = ' +  'case BILCYC ' +  'when 1 then (select SQL_MSG from DYNAMICS.dbo.MESSAGES where Language_ID = ' + @I_nLanguageID + ' and MSGNUM = 1418)' +  'when 2 then (select SQL_MSG from DYNAMICS.dbo.MESSAGES where Language_ID = ' + @I_nLanguageID + ' and MSGNUM = 1419)' +  'when 3 then (select SQL_MSG from DYNAMICS.dbo.MESSAGES where Language_ID = ' + @I_nLanguageID + ' and MSGNUM = 7935)' +  'when 4 then (select SQL_MSG from DYNAMICS.dbo.MESSAGES where Language_ID = ' + @I_nLanguageID + ' and MSGNUM = 12611)' +  'else ' + '''' + ' ' + '''' +  'end), ' +  '(select DSCRPTN2 = ' +  'case SVC_Liability_Type ' +  'when 1 then ' + '''Straight-Line''' +   'when 2 then ' + '''Block Time''' +   'when 3 then ' + '''Retainage''' +   'when 4 then ' + '''Based On Call''' +   'when 5 then ' + '''Metered''' +   'else ' + '''' + ' ' + '''' +  'end), ' +  'CUSTNMBR,CUSTNAME,ADRSCODE,CURNCYID,CURRNIDX,CSTPONBR, ' +  'ENTDTE,ENDDATE,PRICSHED,SLPRSNID,DOCAMNT,NXTBLDTE,BILSTAT,SVC_Evergreen_Contract,MKTOPROC,InfoValue ' +  'from [dbo].[svcContractTransactions] ' +  'where ENTDTE between ' + '''' + @StartDate + ''' and ''' + @EndDate + '''' +  ' and ' + @I_sRestriction  )   if @I_fIncludeHistory > 0  begin  exec ('insert into ' + @I_sTableName + ' (' +  'HISTORY,SOURCE,DOCTYPE,DOCNUMBR,SVC_Contract_Version,DOCTYNAM,CNTTYPE,DSCRPTN1,DSCRPTN2,CUSTNMBR,CUSTNAME,ADRSCODE, ' +  'CURNCYID,CURRNIDX,CSTPONBR,ENTDTE,ENDDATE,PRICSHED,SLPRSNID,DOCAMNT,NXTBLDTE,BILSTAT,SVC_Evergreen_Contract,MKTOPROC,InfoValue) ' +  'select ' +   'HISTORY,SOURCE,DOCTYPE,DOCNUMBR, SVC_Contract_Version,' +  '(select DOCTYNAM = ' +  'case DOCTYPE ' +  'when 1 then (select SQL_MSG from DYNAMICS.dbo.MESSAGES where Language_ID = ' + @I_nLanguageID + ' and MSGNUM = 16688)' +  'when 2 then (select SQL_MSG from DYNAMICS.dbo.MESSAGES where Language_ID = ' + @I_nLanguageID + ' and MSGNUM = 5963)' +  'when 3 then (select SQL_MSG from DYNAMICS.dbo.MESSAGES where Language_ID = ' + @I_nLanguageID + ' and MSGNUM = 9773)' +  'when 4 then (select SQL_MSG from DYNAMICS.dbo.MESSAGES where Language_ID = ' + @I_nLanguageID + ' and MSGNUM = 12085)' +  'else ' + '''' + ' ' + '''' +  'end), ' +  'CNTTYPE, '+  '(select DSCRPTN1 = ' +  'case BILCYC ' +  'when 1 then (select SQL_MSG from DYNAMICS.dbo.MESSAGES where Language_ID = ' + @I_nLanguageID + ' and MSGNUM = 1418)' +  'when 2 then (select SQL_MSG from DYNAMICS.dbo.MESSAGES where Language_ID = ' + @I_nLanguageID + ' and MSGNUM = 1419)' +  'when 3 then (select SQL_MSG from DYNAMICS.dbo.MESSAGES where Language_ID = ' + @I_nLanguageID + ' and MSGNUM = 7935)' +  'when 4 then (select SQL_MSG from DYNAMICS.dbo.MESSAGES where Language_ID = ' + @I_nLanguageID + ' and MSGNUM = 12611)' +  'else ' + '''' + ' ' + '''' +  'end), ' +  '(select DSCRPTN2 = ' +  'case SVC_Liability_Type ' +  'when 1 then ' + '''Straight-Line''' +   'when 2 then ' + '''Block Time''' +   'when 3 then ' + '''Retainage''' +   'when 4 then ' + '''Based On Call''' +   'when 5 then ' + '''Metered''' +   'else ' + '''' + ' ' + '''' +  'end), ' +  'CUSTNMBR,CUSTNAME,ADRSCODE,CURNCYID,CURRNIDX,CSTPONBR, ' +  'ENTDTE,ENDDATE,PRICSHED,SLPRSNID,DOCAMNT,NXTBLDTE,BILSTAT,SVC_Evergreen_Contract,MKTOPROC,InfoValue ' +  'from [dbo].[svcContractHistoryTransactions] ' +  'where ENTDTE between ' + '''' + @StartDate + ''' and ''' + @EndDate + '''' +  ' and ' + @I_sRestriction )  end end  select @iError = @@error  if @iStatus = 0 and @iError <> 0  Begin  select @iStatus = @iError  End  if ( (@iStatus <> 0) or (@O_SQL_Error_State <> 0) )  return (@iStatus)  return(@iStatus)    
GO
GRANT EXECUTE ON  [dbo].[svcLoadContractTrxListData] TO [DYNGRP]
GO
