SET QUOTED_IDENTIFIER OFF
GO
SET ANSI_NULLS ON
GO
 CREATE Procedure [dbo].[SVC_Check_RMA_Open_Document] (@RMANumber char(15),  @Line numeric(19,5),  @Status smallint OUTPUT,  @CMPNTSEQ int = 0 )  As declare @RMA_Status smallint declare @SOPorder char(20), @SOPcredit char(20) declare @RMAType char(10) select @Status = 0   if @Line = 0   begin  if exists(select * from SVC05210 where Return_Record_Type = 1 and RETDOCID = @RMANumber   and SVC_Process_Type > 1 and Return_Disposition_Statu = 1)  select @Status = 1  end else  begin  if exists(select * from SVC05210 where Return_Record_Type = 1 and RETDOCID = @RMANumber and LNSEQNBR = @Line and CMPNTSEQ= @CMPNTSEQ  and SVC_Process_Type > 1 and Return_Disposition_Statu = 1) and   exists(select * from SVC05200 where Return_Record_Type = 1 and RETDOCID = @RMANumber and LNSEQNBR = @Line and Received = 1)  select @Status = 1  end  if @Status > 0  begin  if @Line = 0  update SVC05000 set RMA_Status = 7 where Return_Record_Type = 1 and RETDOCID = @RMANumber  else  update SVC05200 set RMA_Status = 7 where Return_Record_Type = 1 and RETDOCID = @RMANumber and LNSEQNBR = @Line and svcRMAComponentSeq = @CMPNTSEQ  end else   begin   if @Line <> 0  begin  select @SOPorder = Replace_SOP_Number, @SOPcredit = Credit_SOP_Number, @RMAType = RETTYPE, @RMA_Status = RMA_Status  from SVC05200 where Return_Record_Type = 1 and RETDOCID = @RMANumber and LNSEQNBR = @Line and svcRMAComponentSeq = @CMPNTSEQ  if @RMA_Status = 10 return  if @SOPorder > '' or @SOPcredit > ''   select @RMA_Status = RETPATH from SVC05501 where RETTYPE = @RMAType  else  select @RMA_Status = 1   if exists(select * from SVC05210 where Return_Record_Type = 1 and RETDOCID = @RMANumber and  LNSEQNBR = @Line and SVC_Process_Type > 1 and Return_Disposition_Statu = 2)  select @RMA_Status = 8   if exists(select * from SVC05200 where RETDOCID = @RMANumber and LNSEQNBR = @Line and svcRMAComponentSeq = @CMPNTSEQ and SVC_Ready_To_Close = 1)  select @RMA_Status = 9   update SVC05200 set RMA_Status =  case  when Received = 0 then  0   else isnull(@RMA_Status,1)  end  where Return_Record_Type = 1 and RETDOCID = @RMANumber and LNSEQNBR = @Line and svcRMAComponentSeq = @CMPNTSEQ  end  end exec SVC_RMA_Set_HDR_Status @RMANumber return     
GO
GRANT EXECUTE ON  [dbo].[SVC_Check_RMA_Open_Document] TO [DYNGRP]
GO
