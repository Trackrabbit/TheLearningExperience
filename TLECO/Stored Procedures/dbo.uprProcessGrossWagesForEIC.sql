SET QUOTED_IDENTIFIER OFF
GO
SET ANSI_NULLS ON
GO
 CREATE  procedure [dbo].[uprProcessGrossWagesForEIC]  @IN_UserID char(15),  @IN_PayRunType smallint,  @IN_EmpID char(15),  @OUT_GrossWagesPayRun dec(19,5)  output,  @O_iErrorState   int output as  DECLARE  @TSAAMOUNT  dec(19,5),  @EIAMOUNT  dec(19,5),  @USERID char(15),  @PAYRUNTYPE smallint,  @EMPID char(15),  @TAXSHELTERED smallint,  @PAYPERIOD smallint,  @PAYFREQUENCY smallint,  @DEDFREQUENCY smallint  SELECT @OUT_GrossWagesPayRun = 0  DECLARE TableCursor CURSOR for   SELECT UPR10203.TOTALPAY,  USERID = @IN_UserID,  PYRNTYPE = @IN_PayRunType,   EMPLOYID = @IN_EmpID,  UPR10203.PAYPEROD   FROM UPR10203 left join UPR00400  ON UPR10203.EMPLOYID = UPR00400.EMPLOYID and   UPR10203.PAYRCORD = UPR00400.PAYRCORD  WHERE UPR10203.EMPLOYID = @IN_EmpID and   (UPR10203.PRCSSQNC <> 70 and UPR10203.PRCSSQNC <> 130 and  not (UPR10203.PRCSSQNC = 60 and UPR10203.RPTASWGS <> 1)  and (UPR00400.SBJTFDTX=1 or UPR00400.SBJTMCAR=1 or UPR00400.SBJTSSEC=1))   OPEN TableCursor FETCH NEXT FROM TableCursor INTO @EIAMOUNT,  @USERID,  @PAYRUNTYPE,  @EMPID,  @PAYFREQUENCY WHILE @@FETCH_STATUS = 0 BEGIN  SELECT @OUT_GrossWagesPayRun =   case @PAYFREQUENCY   when 1 then @OUT_GrossWagesPayRun + (@EIAMOUNT * 52)  when 2 then @OUT_GrossWagesPayRun + (@EIAMOUNT * 26)  when 3 then @OUT_GrossWagesPayRun + (@EIAMOUNT * 24)  when 4 then @OUT_GrossWagesPayRun + (@EIAMOUNT * 12)  when 5 then @OUT_GrossWagesPayRun + (@EIAMOUNT * 4)  when 6 then @OUT_GrossWagesPayRun + (@EIAMOUNT * 2)  when 7 then @OUT_GrossWagesPayRun + (@EIAMOUNT * 1)  when 8 then @OUT_GrossWagesPayRun + (@EIAMOUNT * 260)  end  FETCH NEXT FROM TableCursor INTO @EIAMOUNT,  @USERID,  @PAYRUNTYPE,  @EMPID,  @PAYFREQUENCY END  DEALLOCATE  TableCursor  DECLARE TableCursor CURSOR for   SELECT UPR10204.TTLDEDTN,  USERID = @IN_UserID,   PYRNTYPE = @IN_PayRunType,  EMPLOYID = @IN_EmpID,  TXSHANTY = 1,  UPR10204.DEDNFREQ   FROM UPR10204 left join UPR00500   ON UPR10204.EMPLOYID = UPR00500.EMPLOYID and   UPR10204.DEDUCTON = UPR00500.DEDUCTON  WHERE (UPR00500.SFRFEDTX = 1 or UPR00500.SHFRFICA = 1) and   UPR10204.EMPLOYID = @IN_EmpID   OPEN TableCursor FETCH NEXT FROM TableCursor INTO @TSAAMOUNT,  @USERID,  @PAYRUNTYPE,  @EMPID,  @TAXSHELTERED,  @DEDFREQUENCY  WHILE @@FETCH_STATUS = 0 BEGIN  SELECT @OUT_GrossWagesPayRun =   case @DEDFREQUENCY   when 1 then @OUT_GrossWagesPayRun - (@TSAAMOUNT * 52)  when 2 then @OUT_GrossWagesPayRun - (@TSAAMOUNT * 26)  when 3 then @OUT_GrossWagesPayRun - (@TSAAMOUNT * 24)  when 4 then @OUT_GrossWagesPayRun - (@TSAAMOUNT * 12)  when 5 then @OUT_GrossWagesPayRun - (@TSAAMOUNT * 4)  when 6 then @OUT_GrossWagesPayRun - (@TSAAMOUNT * 2)  when 7 then @OUT_GrossWagesPayRun - (@TSAAMOUNT * 1)  when 8 then @OUT_GrossWagesPayRun - (@TSAAMOUNT * 260)  end  FETCH NEXT FROM TableCursor INTO @TSAAMOUNT,  @USERID,  @PAYRUNTYPE,  @EMPID,  @TAXSHELTERED,  @DEDFREQUENCY END  DEALLOCATE  TableCursor  return(@@ERROR)   
GO
GRANT EXECUTE ON  [dbo].[uprProcessGrossWagesForEIC] TO [DYNGRP]
GO
