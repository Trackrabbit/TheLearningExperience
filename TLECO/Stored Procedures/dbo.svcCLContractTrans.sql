SET QUOTED_IDENTIFIER OFF
GO
SET ANSI_NULLS ON
GO
 create procedure [dbo].[svcCLContractTrans]   @I_cUserID char(15)    = NULL,  @I_cUserDate char(12)    = NULL,  @I_cFunctionalCurrency char(15)    = NULL,  @I_ContractLine  varchar(40) = NULL,  @I_LineOption varchar(40) = NULL,  @I_LineDist varchar(40) = NULL,  @I_ItemSchedule varchar(40) = NULL,  @I_ContractAudit varchar(40) = NULL,  @I_LineMeter varchar(40) = NULL,  @I_NonCoveredLine  varchar(40) = NULL,  @I_ContractSite  varchar(40) = NULL,  @I_ContractHDR  varchar(40) = NULL,  @O_iErrorState int  = NULL output as  declare  @iError int,   @iStatus int,   @cSearchString1 char(2),  @tLoop tinyint  select  @O_iErrorState = 0,  @iStatus  = 0,  @cSearchString1 = '%1'  while (@tLoop is NULL) begin  select @tLoop = 1   if   @I_cUserID is NULL  or @I_ContractLine is NULL  or @I_LineOption is NULL  or @I_LineDist is NULL  begin  select @O_iErrorState = 20846  break  end   create table #CNTRLNUMTEMP(  CNTRLNUM varchar(30) not null,  DOCTYPE smallint not null,  VENDORID varchar(40) not null )   delete from SVC00601 with (rowlock) where LNSEQNBR = 0   insert into  #CNTRLNUMTEMP(  CNTRLNUM,  DOCTYPE,  VENDORID )  select   CONTNBR + '-' + CAST(CAST(LNSEQNBR AS int) AS varchar(6)),  1,  CAST(CAST(LNSEQNBR AS int) AS varchar(6))  from   SVC00601   where not exists  (select   1  from   SVC00600  where   SVC00601.CONSTS = SVC00600.CONSTS and   SVC00601.CONTNBR =SVC00600.CONTNBR)   if @@rowcount <> 0  begin  delete  SVC00601  where not exists  (select   1  from   SVC00600  where   SVC00601.CONSTS = SVC00600.CONSTS and   SVC00601.CONTNBR =SVC00600.CONTNBR)   delete SVC00603 where not exists (select 1 from SVC00600   where SVC00603.CONSTS = SVC00600.CONSTS and SVC00603.CONTNBR =SVC00600.CONTNBR)   delete SVC00604 where not exists (select 1 from SVC00600   where SVC00604.CONSTS = SVC00600.CONSTS and SVC00604.CONTNBR =SVC00600.CONTNBR)   delete SVC00605 where not exists (select 1 from SVC00600   where SVC00605.CONSTS = SVC00600.CONSTS and SVC00605.CONTNBR =SVC00600.CONTNBR)   delete SVC00606 where not exists (select 1 from SVC00600   where SVC00606.CONSTS = SVC00600.CONSTS and SVC00606.CONTNBR =SVC00600.CONTNBR)   delete SVC00607 where not exists (select 1 from SVC00600   where SVC00607.CONSTS = SVC00600.CONSTS and SVC00607.CONTNBR =SVC00600.CONTNBR)   delete SVC00609 where not exists (select 1 from SVC00600   where SVC00609.CONSTS = SVC00600.CONSTS and SVC00609.CONTNBR =SVC00600.CONTNBR)   delete SVC00610 where not exists (select 1 from SVC00600   where SVC00610.CONSTS = SVC00600.CONSTS and SVC00610.CONTNBR =SVC00600.CONTNBR)   delete SVC00620 where not exists (select 1 from SVC00600   where SVC00620.CONSTS = SVC00600.CONSTS and SVC00620.CONTNBR =SVC00600.CONTNBR)   delete SVC00652 where not exists (select 1 from SVC00600   where SVC00652.CONSTS = SVC00600.CONSTS and SVC00652.CONTNBR =SVC00600.CONTNBR)   delete SVC00655 where not exists (select 1 from SVC00600   where SVC00655.CONSTS = SVC00600.CONSTS and SVC00655.CONTNBR =SVC00600.CONTNBR)    exec @iStatus = smCreateErrorLogRecord  @I_cUserID,  @I_ContractLine,  @cSearchString1,  11503,  @O_iErrorState output  update SY03400 set ERMSGTX2 = 'No Corresponding record was found in the SVC_Contract_HDR Table' where  FILENAME = @I_ContractLine and ERMSGTX2 = ''   select @iError = @@error   if @iStatus = 0 and @iError <> 0  select @iStatus = @iError  if @iStatus <> 0 or @O_iErrorState <> 0  break  end    insert into  #CNTRLNUMTEMP(  CNTRLNUM,  DOCTYPE,  VENDORID )  select   CONTNBR +'Option-'+ OPTTYPE,  2,  OPTTYPE  from   SVC00652   where not exists  (select   1  from   SVC00601  where   SVC00601.CONSTS = SVC00652.CONSTS and   SVC00601.CONTNBR =SVC00652.CONTNBR and   SVC00601.LNSEQNBR = SVC00652.LNSEQNBR) and  SVC00652.LNSEQNBR > 0  if @@rowcount <> 0  begin  delete  SVC00652   where not exists  (select   1  from   SVC00601  where   SVC00601.CONSTS = SVC00652.CONSTS and   SVC00601.CONTNBR =SVC00652.CONTNBR and   SVC00601.LNSEQNBR = SVC00652.LNSEQNBR) and  SVC00652.LNSEQNBR > 0   exec @iStatus = smCreateErrorLogRecord  @I_cUserID,  @I_LineOption,  @cSearchString1,  11503,  @O_iErrorState output   select @iError = @@error  update SY03400 set ERMSGTX2 = 'No Corresponding record was found in the SVC_Contract_Line Table' where  FILENAME = @I_LineOption and ERMSGTX2 = ''   if @iStatus = 0 and @iError <> 0  select @iStatus = @iError  if @iStatus <> 0 or @O_iErrorState <> 0  break  end    insert into  #CNTRLNUMTEMP(  CNTRLNUM,  DOCTYPE,  VENDORID )  select   SVC00603.CONTNBR + '-' + CAST(CAST(SVC00603.LNSEQNBR AS int) AS varchar(6)),  2,  'Invoices'  from   SVC00603   where not exists  (select   1  from   SVC00601  where   SVC00601.CONSTS = SVC00603.CONSTS and   SVC00601.CONTNBR =SVC00603.CONTNBR and   SVC00601.LNSEQNBR = SVC00603.LNSEQNBR) and  SVC00603.LNSEQNBR > 0 group by CONTNBR, LNSEQNBR  if @@rowcount <> 0  begin  delete  SVC00603   where not exists  (select   1  from   SVC00601  where   SVC00601.CONSTS = SVC00603.CONSTS and   SVC00601.CONTNBR =SVC00603.CONTNBR and   SVC00601.LNSEQNBR = SVC00603.LNSEQNBR) and  SVC00603.LNSEQNBR > 0   exec @iStatus = smCreateErrorLogRecord  @I_cUserID,  'SVC_Contract_Line_Invoice_Line',  @cSearchString1,  11503,  @O_iErrorState output   select @iError = @@error  update SY03400 set ERMSGTX2 = 'No Corresponding record was found in the SVC_Contract_Line Table' where  FILENAME = 'SVC_Contract_Line_Invoice_Line' and ERMSGTX2 = ''   if @iStatus = 0 and @iError <> 0  select @iStatus = @iError  if @iStatus <> 0 or @O_iErrorState <> 0  break  end    insert into  #CNTRLNUMTEMP(  CNTRLNUM,  DOCTYPE,  VENDORID )  select   CONTNBR + ' Act.Index- ' + CAST(ACTINDX AS varchar(5)),  3,  'Distribution'  from   SVC00609  where not exists  (select   1  from   SVC00601  where   SVC00601.CONSTS = SVC00609.CONSTS and   SVC00601.CONTNBR =SVC00609.CONTNBR and   SVC00601.LNSEQNBR = SVC00609.LNSEQNBR)  if @@rowcount <> 0  begin   delete  SVC00609  where not exists  (select   1  from   SVC00601  where   SVC00601.CONSTS = SVC00609.CONSTS and   SVC00601.CONTNBR =SVC00609.CONTNBR and   SVC00601.LNSEQNBR = SVC00609.LNSEQNBR)  exec @iStatus = smCreateErrorLogRecord  @I_cUserID,  @I_LineDist,  @cSearchString1,  11503,  @O_iErrorState output   select @iError = @@error  update SY03400 set ERMSGTX2 = 'No Corresponding record was found in the SVC_Contract_Line Table' where  FILENAME = @I_LineDist and ERMSGTX2 = ''   if @iStatus = 0 and @iError <> 0  select @iStatus = @iError  if @iStatus <> 0 or @O_iErrorState <> 0  break  end   insert into  #CNTRLNUMTEMP(  CNTRLNUM,  DOCTYPE,  VENDORID )  select   'Act.Index- ' + CAST(ACTINDX AS varchar(5)),  1,  CONTNBR + '-' + CAST(CAST(LNSEQNBR AS int) AS varchar(6))  from   SVC00609   where ACTINDX not in (select ACTINDX from GL00100)  and ACTINDX > 0   if @@rowcount <> 0  begin exec @iStatus = svcCreateErrorLogRecord  @I_cUserID,  @I_LineDist,  'Invalid Account Index field on Contract Line.',  @O_iErrorState output   select @iError = @@error  if @iStatus <> 0 or @O_iErrorState <> 0 or @iError <> 0  break  end    insert into  #CNTRLNUMTEMP(  CNTRLNUM,  DOCTYPE,  VENDORID )  select   CONTNBR +' Sche ID- '+ SCHEDID,  4,  SCHEDID  from   SVC00610  where not exists  (select   1  from   SVC00601  where   SVC00601.CONSTS = SVC00610.CONSTS and   SVC00601.CONTNBR =SVC00610.CONTNBR and   SVC00601.LNSEQNBR = SVC00610.LNSEQNBR)  if @@rowcount <> 0  begin   delete  SVC00610  where not exists  (select   1  from   SVC00601  where   SVC00601.CONSTS = SVC00610.CONSTS and   SVC00601.CONTNBR =SVC00610.CONTNBR and   SVC00601.LNSEQNBR = SVC00610.LNSEQNBR)  exec @iStatus = smCreateErrorLogRecord  @I_cUserID,  @I_ItemSchedule,  @cSearchString1,  11503,  @O_iErrorState output   select @iError = @@error  update SY03400 set ERMSGTX2 = 'No Corresponding record was found in the SVC_Contract_Line Table' where  FILENAME = @I_ItemSchedule and ERMSGTX2 = ''   if @iStatus = 0 and @iError <> 0  select @iStatus = @iError  if @iStatus <> 0 or @O_iErrorState <> 0  break  end   insert into  #CNTRLNUMTEMP(  CNTRLNUM,  DOCTYPE,  VENDORID )  select   CONTNBR +' Sche ID- '+ SCHEDID,  4,  SCHEDID  from   SVC00610  where not exists  (select   1  from   SVC8005  where   SVC8005.SCHEDID = SVC00610.SCHEDID and SCHEDID > '')  if @@rowcount <> 0  begin   delete  SVC00610  where not exists  (select   1  from   SVC8005  where   SVC8005.SCHEDID = SVC00610.SCHEDID and SCHEDID > '')  exec @iStatus = smCreateErrorLogRecord  @I_cUserID,  @I_ItemSchedule,  @cSearchString1,  11503,  @O_iErrorState output   select @iError = @@error  update SY03400 set ERMSGTX2 = 'No Corresponding record was found in the SVC_Maintenance_Schedule_HDR Table' where  FILENAME = @I_ItemSchedule and ERMSGTX2 = ''   if @iStatus = 0 and @iError <> 0  select @iStatus = @iError  if @iStatus <> 0 or @O_iErrorState <> 0  break  end    insert into  #CNTRLNUMTEMP(  CNTRLNUM,  DOCTYPE,  VENDORID )  select   'Contract- ' + CONTNBR,  5,  'Audit'  from   SVC00620  where not exists  (select   1  from   SVC00600  where   SVC00600.CONSTS = SVC00620.CONSTS and   SVC00600.CONTNBR =SVC00620.CONTNBR) group by CONTNBR  if @@rowcount <> 0  begin   delete  SVC00620  where not exists  (select   1  from   SVC00600  where   SVC00600.CONSTS = SVC00620.CONSTS and   SVC00600.CONTNBR =SVC00620.CONTNBR)    exec @iStatus = smCreateErrorLogRecord  @I_cUserID,  @I_ContractAudit,  @cSearchString1,  11503,  @O_iErrorState output   select @iError = @@error  update SY03400 set ERMSGTX2 = 'No Corresponding record was found in the SVC_Contract_HDR Table' where  FILENAME = @I_ContractAudit and ERMSGTX2 = ''   if @iStatus = 0 and @iError <> 0  select @iStatus = @iError  if @iStatus <> 0 or @O_iErrorState <> 0  break  end    insert into  #CNTRLNUMTEMP(  CNTRLNUM,  DOCTYPE,  VENDORID )  select   SVC00607.CONTNBR + '-' + CAST(CAST(SVC00607.LNSEQNBR AS int) AS varchar(6)),  6,  'Meter'  from   SVC00607  where not exists  (select   1  from   SVC00601  where   SVC00601.CONSTS = SVC00607.CONSTS and   SVC00601.CONTNBR =SVC00607.CONTNBR and   SVC00601.LNSEQNBR = SVC00607.LNSEQNBR)  if @@rowcount <> 0  begin   delete  SVC00607  where not exists  (select   1  from   SVC00601  where   SVC00601.CONSTS = SVC00607.CONSTS and   SVC00601.CONTNBR =SVC00607.CONTNBR and   SVC00601.LNSEQNBR = SVC00607.LNSEQNBR)  exec @iStatus = smCreateErrorLogRecord  @I_cUserID,  @I_LineMeter,  @cSearchString1,  11503,  @O_iErrorState output   select @iError = @@error  update SY03400 set ERMSGTX2 = 'No Corresponding record was found in the SVC_Contract_Line Table' where  FILENAME = @I_LineMeter and ERMSGTX2 = ''   if @iStatus = 0 and @iError <> 0  select @iStatus = @iError  if @iStatus <> 0 or @O_iErrorState <> 0  break  end    insert into  #CNTRLNUMTEMP(  CNTRLNUM,  DOCTYPE,  VENDORID )  select   CONTNBR +'-'+ rtrim(ITEMNMBR),  2,  'NonCovered'  from   SVC00606   where not exists  (select   1  from   SVC00600  where   SVC00600.CONSTS = SVC00606.CONSTS and   SVC00600.CONTNBR =SVC00606.CONTNBR ) and  SVC00606.LNSEQNBR > 0  if @@rowcount <> 0  begin  delete  SVC00606   where not exists  (select   1  from   SVC00600  where   SVC00600.CONSTS = SVC00606.CONSTS and   SVC00600.CONTNBR =SVC00606.CONTNBR ) and  SVC00606.LNSEQNBR > 0   exec @iStatus = smCreateErrorLogRecord  @I_cUserID,  @I_LineOption,  @cSearchString1,  11503,  @O_iErrorState output   select @iError = @@error  update SY03400 set ERMSGTX2 = 'No Corresponding record was found in the SVC_Contract_HDR Table' where  FILENAME = @I_LineOption and ERMSGTX2 = ''   if @iStatus = 0 and @iError <> 0  select @iStatus = @iError  if @iStatus <> 0 or @O_iErrorState <> 0  break  end    insert into  #CNTRLNUMTEMP(  CNTRLNUM,  DOCTYPE,  VENDORID )  select   CONTNBR + '/' + rtrim(ADRSCODE),  8,  CAST(CAST(LNSEQNBR AS int) AS varchar(6))  from   SVC00608   where not exists  (select   1  from   SVC00600  where   SVC00608.CONSTS = SVC00600.CONSTS and   SVC00608.CONTNBR =SVC00600.CONTNBR)   if @@rowcount <> 0  begin  delete  SVC00608  where not exists  (select   1  from   SVC00600  where   SVC00608.CONSTS = SVC00600.CONSTS and   SVC00608.CONTNBR =SVC00600.CONTNBR)    exec @iStatus = smCreateErrorLogRecord  @I_cUserID,  @I_ContractSite,  @cSearchString1,  11503,  @O_iErrorState output   select @iError = @@error  update SY03400 set ERMSGTX2 = 'No Corresponding record was found in the SVC_Contract_HDR Table' where  FILENAME = @I_ContractSite and ERMSGTX2 = ''   if @iStatus = 0 and @iError <> 0  select @iStatus = @iError  if @iStatus <> 0 or @O_iErrorState <> 0  break  end   insert into  #CNTRLNUMTEMP(  CNTRLNUM,  DOCTYPE,  VENDORID )  select   CONTNBR + '/' + ADRSCODE,  8,  'Contract Site HDR:'   from   SVC00608  where CNTTYPE='' or SRVTYPE =''   or Bill_To_Customer = '' or SVC_Bill_To_Address_Code =''   or CUSTNMBR='' or ADRSCODE=''   if @@rowcount <> 0  begin  exec @iStatus = svcCreateErrorLogRecord  @I_cUserID,  @I_ContractSite,  'Required Fields are missing.',  @O_iErrorState output   select @iError = @@error   if @iStatus = 0 and @iError <> 0  select @iStatus = @iError  if @iStatus <> 0 or @O_iErrorState <> 0  break  end    insert into  #CNTRLNUMTEMP(  CNTRLNUM,  DOCTYPE,  VENDORID )  select   CNTTYPE,  8,  CONTNBR+'/'+ADRSCODE  from   SVC00608   where CNTTYPE not in (select CNTTYPE from SVC00602)  and CNTTYPE > ''   if @@rowcount <> 0  begin  exec @iStatus = svcCreateErrorLogRecord  @I_cUserID,  @I_ContractSite,  'Contract Type does not exist.',  @O_iErrorState output   select @iError = @@error   if @iStatus = 0 and @iError <> 0  select @iStatus = @iError  if @iStatus <> 0 or @O_iErrorState <> 0  break  end    insert into  #CNTRLNUMTEMP(  CNTRLNUM,  DOCTYPE,  VENDORID )  select   SRVTYPE,  8,  CONTNBR+'/'+ADRSCODE  from   SVC00608   where SRVTYPE not in (select SRVTYPE from SVC00920)  and SRVTYPE > ''   if @@rowcount <> 0  begin  exec @iStatus = svcCreateErrorLogRecord  @I_cUserID,  @I_ContractSite,  'Service Type does not exist.',  @O_iErrorState output   select @iError = @@error   if @iStatus = 0 and @iError <> 0  select @iStatus = @iError  if @iStatus <> 0 or @O_iErrorState <> 0  break  end    insert into  #CNTRLNUMTEMP(  CNTRLNUM,  DOCTYPE,  VENDORID )  select   CUSTNMBR,  8,  CONTNBR+'/'+ADRSCODE  from   SVC00608   where CUSTNMBR not in (select CUSTNMBR from RM00101)   if @@rowcount <> 0  begin  exec @iStatus = svcCreateErrorLogRecord  @I_cUserID,  @I_ContractSite,  'Customer ID does not exist.',  @O_iErrorState output   select @iError = @@error   if @iStatus = 0 and @iError <> 0  select @iStatus = @iError  if @iStatus <> 0 or @O_iErrorState <> 0  break  end    insert into  #CNTRLNUMTEMP(  CNTRLNUM,  DOCTYPE,  VENDORID )  select   ADRSCODE,  8,  CONTNBR+'/'+ADRSCODE  from   SVC00608   where not exists  (select   1  from   RM00102  where   SVC00608.CUSTNMBR = RM00102.CUSTNMBR and   SVC00608.ADRSCODE =RM00102.ADRSCODE )    if @@rowcount <> 0  begin  exec @iStatus = svcCreateErrorLogRecord  @I_cUserID,  @I_ContractSite,  'Customer Address does not exist.',  @O_iErrorState output   select @iError = @@error   if @iStatus = 0 and @iError <> 0  select @iStatus = @iError  if @iStatus <> 0 or @O_iErrorState <> 0  break  end    insert into  #CNTRLNUMTEMP(  CNTRLNUM,  DOCTYPE,  VENDORID )  select   Bill_To_Customer,  8,  CONTNBR+'/'+ADRSCODE  from   SVC00608   where Bill_To_Customer > '' and Bill_To_Customer not in (select CUSTNMBR from RM00101)   if @@rowcount <> 0  begin  exec @iStatus = svcCreateErrorLogRecord  @I_cUserID,  @I_ContractSite,  'Bill To Customer ID does not exist.',  @O_iErrorState output   select @iError = @@error   if @iStatus = 0 and @iError <> 0  select @iStatus = @iError  if @iStatus <> 0 or @O_iErrorState <> 0  break  end    insert into  #CNTRLNUMTEMP(  CNTRLNUM,  DOCTYPE,  VENDORID )  select   SVC_Bill_To_Address_Code,  8,  CONTNBR+'/'+ADRSCODE  from   SVC00608   where not exists  (select   1  from   RM00102  where   SVC00608.Bill_To_Customer = RM00102.CUSTNMBR and   SVC00608.SVC_Bill_To_Address_Code =RM00102.ADRSCODE )   and Bill_To_Customer > '' and SVC_Bill_To_Address_Code > ''   if @@rowcount <> 0  begin  exec @iStatus = svcCreateErrorLogRecord  @I_cUserID,  @I_ContractSite,  'Bill To Customer Address does not exist.',  @O_iErrorState output   select @iError = @@error   if @iStatus = 0 and @iError <> 0  select @iStatus = @iError  if @iStatus <> 0 or @O_iErrorState <> 0  break  end    insert into  #CNTRLNUMTEMP(  CNTRLNUM,  DOCTYPE,  VENDORID )  select   CONTNBR,  8,  'Contract HDR:'  from   SVC00600  where CNTTYPE='' or SRVTYPE ='' or PRICSHED = ''  or Bill_To_Customer = '' or SVC_Bill_To_Address_Code =''   or CUSTNMBR='' or ADRSCODE=''   if @@rowcount <> 0  begin  exec @iStatus = svcCreateErrorLogRecord  @I_cUserID,  @I_ContractHDR,  'Required Fields are missing.',  @O_iErrorState output   select @iError = @@error   if @iStatus = 0 and @iError <> 0  select @iStatus = @iError  if @iStatus <> 0 or @O_iErrorState <> 0  break  end    insert into  #CNTRLNUMTEMP(  CNTRLNUM,  DOCTYPE,  VENDORID )  select   CNTTYPE,  8,  CONTNBR  from   SVC00600   where CNTTYPE not in (select CNTTYPE from SVC00602)  and CNTTYPE > ''   if @@rowcount <> 0  begin  exec @iStatus = svcCreateErrorLogRecord  @I_cUserID,  @I_ContractHDR,  'Contract Type does not exist.',  @O_iErrorState output   select @iError = @@error   if @iStatus = 0 and @iError <> 0  select @iStatus = @iError  if @iStatus <> 0 or @O_iErrorState <> 0  break  end    insert into  #CNTRLNUMTEMP(  CNTRLNUM,  DOCTYPE,  VENDORID )  select   SRVTYPE,  8,  CONTNBR  from   SVC00600   where SRVTYPE not in (select SRVTYPE from SVC00920)  and SRVTYPE > ''   if @@rowcount <> 0  begin  exec @iStatus = svcCreateErrorLogRecord  @I_cUserID,  @I_ContractHDR,  'Service Type does not exist.',  @O_iErrorState output   select @iError = @@error   if @iStatus = 0 and @iError <> 0  select @iStatus = @iError  if @iStatus <> 0 or @O_iErrorState <> 0  break  end    insert into  #CNTRLNUMTEMP(  CNTRLNUM,  DOCTYPE,  VENDORID )  select   CUSTNMBR,  8,  CONTNBR  from   SVC00600   where CUSTNMBR not in (select CUSTNMBR from RM00101)  and CUSTNMBR > ''   if @@rowcount <> 0  begin  exec @iStatus = svcCreateErrorLogRecord  @I_cUserID,  @I_ContractHDR,  'Customer ID does not exist.',  @O_iErrorState output   select @iError = @@error   if @iStatus = 0 and @iError <> 0  select @iStatus = @iError  if @iStatus <> 0 or @O_iErrorState <> 0  break  end    insert into  #CNTRLNUMTEMP(  CNTRLNUM,  DOCTYPE,  VENDORID )  select   ADRSCODE,  8,  CONTNBR  from   SVC00600   where not exists  (select   1  from   RM00102  where   SVC00600.CUSTNMBR = RM00102.CUSTNMBR and   SVC00600.ADRSCODE =RM00102.ADRSCODE ) and  CUSTNMBR > '' and ADRSCODE > ''   if @@rowcount <> 0  begin  exec @iStatus = svcCreateErrorLogRecord  @I_cUserID,  @I_ContractHDR,  'Customer Address does not exist.',  @O_iErrorState output   select @iError = @@error   if @iStatus = 0 and @iError <> 0  select @iStatus = @iError  if @iStatus <> 0 or @O_iErrorState <> 0  break  end    insert into  #CNTRLNUMTEMP(  CNTRLNUM,  DOCTYPE,  VENDORID )  select   Bill_To_Customer,  8,  CONTNBR  from   SVC00600   where Bill_To_Customer > '' and Bill_To_Customer not in (select CUSTNMBR from RM00101)   if @@rowcount <> 0  begin  exec @iStatus = svcCreateErrorLogRecord  @I_cUserID,  @I_ContractHDR,  'Bill To Customer ID does not exist.',  @O_iErrorState output   select @iError = @@error   if @iStatus = 0 and @iError <> 0  select @iStatus = @iError  if @iStatus <> 0 or @O_iErrorState <> 0  break  end    insert into  #CNTRLNUMTEMP(  CNTRLNUM,  DOCTYPE,  VENDORID )  select   SVC_Bill_To_Address_Code,  8,  CONTNBR  from   SVC00600   where not exists  (select   1  from   RM00102  where   SVC00600.Bill_To_Customer = RM00102.CUSTNMBR and   SVC00600.SVC_Bill_To_Address_Code =RM00102.ADRSCODE )   and Bill_To_Customer > '' and SVC_Bill_To_Address_Code > ''   if @@rowcount <> 0  begin  exec @iStatus = svcCreateErrorLogRecord  @I_cUserID,  @I_ContractHDR,  'Bill To Customer Address does not exist.',  @O_iErrorState output   select @iError = @@error   if @iStatus = 0 and @iError <> 0  select @iStatus = @iError  if @iStatus <> 0 or @O_iErrorState <> 0  break  end    insert into  #CNTRLNUMTEMP(  CNTRLNUM,  DOCTYPE,  VENDORID )  select   PRICSHED,  9,  'Price Book'  from   SVC00600   where not exists  (select   1  from   SVC00650  where SVC00600.PRICSHED = SVC00650.PRICSHED)group by PRICSHED  if @@rowcount <> 0  begin   insert into  SVC00650(  PRICSHED,  PRSCHDSC )  select   PRICSHED,  PRICSHED  from   SVC00600   where not exists  (select   1  from   SVC00650  where SVC00600.PRICSHED = SVC00650.PRICSHED) group by PRICSHED   exec @iStatus = smCreateErrorLogRecord  @I_cUserID,  'SVC_Contract_Price_Book',  @cSearchString1,  11504,  @O_iErrorState output   select @iError = @@error   if @iStatus = 0 and @iError <> 0  select @iStatus = @iError  if @iStatus <> 0 or @O_iErrorState <> 0  break  end   end   return(@iStatus)    
GO
GRANT EXECUTE ON  [dbo].[svcCLContractTrans] TO [DYNGRP]
GO
