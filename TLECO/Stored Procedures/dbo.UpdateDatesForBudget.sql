SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO
 CREATE PROCEDURE [dbo].[UpdateDatesForBudget]  @nBudgetID varchar(15),  @nNewBegBalDate datetime,   @nYear int,   @nUpdate int AS BEGIN  IF @nUpdate = 0  BEGIN  UPDATE GL00201  SET PERIODDT = @nNewBegBalDate,  YEAR1 =   (SELECT YEAR1   FROM SY40100   WHERE FORIGIN = 1 AND SY40100.PERIODDT = @nNewBegBalDate)  FROM GL00201  WHERE   BUDGETID = @nBudgetID and  PERIODID = 0  END  ELSE IF @nUpdate = 1  BEGIN  UPDATE A  SET A.PERIODDT = B.PERIODDT,   A.YEAR1 = @nYear  FROM GL00201 A, SY40100 B  WHERE  FORIGIN = 1 AND  B.YEAR1 = @nYear AND  A.PERIODID = B.PERIODID AND  BUDGETID = @nBudgetID  END  ELSE  BEGIN  UPDATE A  SET PERIODDT = B.PERIODDT  FROM GL00201 A, SY40100 B  WHERE  FORIGIN = 1 AND  A.YEAR1 = B.YEAR1 AND   A.PERIODID = B.PERIODID AND BUDGETID not like 'ENC##@@##%'   UPDATE A  SET A.PERIODID = (select MAX(PERIODID) from SY40100 where FORIGIN = 1 AND YEAR1 = A.YEAR1 AND PERIODDT <= A.PERIODDT )   FROM GL00201 A   WHERE BUDGETID like 'ENC##@@##%'    UPDATE A  SET From_Date = FSTFSCDY, TODATE = LSTFSCDY  FROM GL00200 A, SY40101 B  WHERE B.YEAR1 = A.YEAR1  END   RETURN @@ERROR END    
GO
GRANT EXECUTE ON  [dbo].[UpdateDatesForBudget] TO [DYNGRP]
GO
