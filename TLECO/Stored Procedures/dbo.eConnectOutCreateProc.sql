SET QUOTED_IDENTIFIER OFF
GO
SET ANSI_NULLS ON
GO
 create procedure [dbo].[eConnectOutCreateProc]   @I_vDOCTYPE varchar(50),   @I_vOUTPUTTYPE int = 0,   @I_vINDEX1TO varchar(75)='',   @I_vINDEX2TO varchar(75)='',   @I_vINDEX3TO varchar(75)='',   @I_vINDEX4TO varchar(75)='',   @I_vINDEX5TO varchar(75)='',   @I_vINDEX6TO varchar(75)='',  @I_vINDEX7TO varchar(75)='',   @I_vINDEX8TO varchar(75)='',   @I_vINDEX9TO varchar(75)='',   @I_vINDEX10TO varchar(75)='',   @I_vINDEX11TO varchar(75)='',   @I_vINDEX12TO varchar(75)='',  @I_vINDEX13TO varchar(75)='',   @I_vINDEX14TO varchar(75)='',   @I_vINDEX15TO varchar(75)='',   @I_vINDEX1FROM varchar(75)='',   @I_vINDEX2FROM varchar(75)='',   @I_vINDEX3FROM varchar(75)='',   @I_vINDEX4FROM varchar(75)='',   @I_vINDEX5FROM varchar(75)='',   @I_vINDEX6FROM varchar(75)='',   @I_vINDEX7FROM varchar(75)='',   @I_vINDEX8FROM varchar(75)='',   @I_vINDEX9FROM varchar(75)='',   @I_vINDEX10FROM varchar(75)='',  @I_vINDEX11FROM varchar(75)='',  @I_vINDEX12FROM varchar(75)='',  @I_vINDEX13FROM varchar(75)='',  @I_vINDEX14FROM varchar(75)='',  @I_vINDEX15FROM varchar(75)='',  @I_vFORLOAD int=0,   @I_vFORLIST int=0,         @I_vACTION  int=0,   @I_vROWCOUNT int=0,   @I_vREMOVE int=0,   @O_iErrorState int = NULL  output  with encryption as  set transaction isolation level read uncommitted  declare @statement01 varchar(400),  @XMLStatement varchar(8000),  @XMLIndex varchar(8000),  @XMLIndex2 varchar(8000),  @XMLData varchar(8000),  @SQLStatement varchar(8000),  @SQLStatement1 varchar(8000),  @SQLStatement2 varchar(8000),  @SQLStatement3 varchar(8000),  @SQLStatement4 varchar(8000),  @SQLStatement5 varchar(8000),  @SQLStatement6 varchar(8000),  @SQLStatement7 varchar(8000),  @SQLStatement8 varchar(8000),   @SQLStatement9 varchar(8000),   @SQLStatement10 varchar(8000),  @SQLStatement11 varchar(8000),  @SQLStatement12 varchar(8000),  @SQLStatement13 varchar(8000),  @InsertStatement varchar(8000),  @SQLFrom varchar(8000),  @SQLWhere varchar(8000),  @SQLJoin varchar(8000),  @SQLJoin1 varchar(8000),  @SQLOrder varchar(8000),  @XMLOutput varchar (8000),  @WhereStatement varchar(8000),  @ColumnName varchar(50),   @x int,   @iStatus int,  @O_oErrorState int,  @IndexName varchar(50),  @INDEXCNT int,   @DATACNT int,  @CUSTNMBR varchar(30),  @TABLENAME varchar(30),  @TagNumber int,  @TableCount int,  @Y int,  @ParentLevel int,  @Alias  varchar(50),  @ColumnCnt int,  @JoinTable varchar(50),  @JoinAlias varchar(50),  @fill char(1),  @fill2 char(2),  @loop int,  @OrderCnt int,  @LowParent int,  @OrderBy int,  @JoinCnt int,  @sqlproctext1 varchar(8000),  @sqlproctext2 varchar(8000),  @sqlproctext3 varchar(8000),  @sqlproctext3b varchar(8000),  @sqlproctext4 varchar(8000),  @sqlproctext5 varchar(8000),  @proc char(100),  @SQLOrder2 varchar(8000),  @PL as int,  @t as int,  @s as int,  @INDXCNT as int,  @Als as   varchar(50),  @TBLNAME as varchar(30),  @z as int,  @XMLHeaderData as varchar(8000),  @Jointble varchar(50),  @JoinAls varchar(50),  @SQLIndex  varchar(8000),  @xtype int,  @xtypeName varchar(40),  @XMLData2 varchar(8000),  @SQLStatement15 varchar(8000),  @SQLStatement16 varchar(8000),  @SQLStatement17 varchar(8000),  @SQLStatement18 varchar(8000),  @SQLStatement19 varchar(8000),  @SQLStatement20 varchar(8000),  @SQLStatement21 varchar(8000),  @SQLStatement22 varchar(8000),  @SQLStatement23 varchar(8000),  @SQLStatement24 varchar(8000),  @SQLStatement25 varchar(8000),  @SQLStatement26 varchar(8000),  @ColumnsUsed int  select @fill = char(39),  @fill2 = char(39)+char(39),  @statement01 ='',  @WhereStatement ='',  @InsertStatement = '',  @SQLOrder='',  @JoinCnt=0,  @sqlproctext1 = '',  @sqlproctext2 = '',  @sqlproctext3 = '',  @sqlproctext3b = '',  @sqlproctext4 = '',  @sqlproctext5 = '',  @SQLStatement6 = '',  @SQLStatement7 = '',  @SQLStatement8 = '',  @SQLStatement9 = '',  @SQLStatement10 = '',  @proc = '',  @SQLOrder2 = '',  @PL = 0,  @t = 0,  @s = 0,  @INDXCNT = 0,  @Als = '',  @TBLNAME = '',  @z = 0,  @XMLHeaderData = '',  @Jointble = '',  @JoinAls = '',  @SQLStatement11 = '',  @SQLStatement12 = '',  @SQLStatement13 = '',  @SQLIndex = '',  @xtype = 0,  @xtypeName = '',  @XMLData2 = '',  @SQLStatement15 = '',  @SQLStatement16 = '',  @SQLStatement17 = '',  @SQLStatement18 = '',  @SQLStatement19 = '',  @SQLStatement20 = '',  @SQLStatement21 = '',  @SQLStatement22 = '',  @SQLStatement23 = '',  @SQLStatement24 = '',  @SQLStatement25 = '',  @SQLStatement26 = '',  @ColumnsUsed = 1  set nocount on  create table #PL(PL int)  declare @StartPos int  select @O_iErrorState = 1,  @StartPos = 1  if (@I_vDOCTYPE like 'WS%GetList') begin  set @StartPos = CHARINDEX('GetList',@I_vDOCTYPE)  set @proc = 'dbo.taRequester' + rtrim(substring(@I_vDOCTYPE,1,@StartPos-1)) + ltrim(str(@I_vOUTPUTTYPE)) end else begin  set @proc = 'dbo.taRequester' + rtrim(@I_vDOCTYPE) + ltrim(str(@I_vOUTPUTTYPE))  end  select @sqlproctext1 = ''  select @sqlproctext2 =  'create procedure ' + rtrim(@proc) + ' @I_vDOCTYPE varchar(50),@I_vOUTPUTTYPE int = 0,@I_vINDEX1TO varchar(75)='''',@I_vINDEX2TO varchar(75)='''',@I_vINDEX3TO varchar(75)='''',@I_vINDEX4TO varchar(75)='''',@I_vINDEX5TO varchar(75)='''',@I_vINDEX6TO varchar(75)='''',@I_vINDEX7TO varchar(75)='''',@I_vINDEX8TO varchar(75)='''',@I_vINDEX9TO varchar(75)='''',@I_vINDEX10TO varchar(75)='''',@I_vINDEX11TO varchar(75)='''',@I_vINDEX12TO varchar(75)='''',@I_vINDEX13TO varchar(75)='''',@I_vINDEX14TO varchar(75)='''',@I_vINDEX15TO varchar(75)='''',@I_vINDEX1FROM varchar(75)='''',@I_vINDEX2FROM varchar(75)='''',@I_vINDEX3FROM varchar(75)='''',@I_vINDEX4FROM varchar(75)='''',@I_vINDEX5FROM varchar(75)='''',@I_vINDEX6FROM varchar(75)='''',@I_vINDEX7FROM varchar(75)='''',@I_vINDEX8FROM varchar(75)='''',@I_vINDEX9FROM varchar(75)='''',@I_vINDEX10FROM varchar(75)='''',@I_vINDEX11FROM varchar(75)='''',@I_vINDEX12FROM varchar(75)='''',@I_vINDEX13FROM varchar(75)='''',@I_vINDEX14FROM varchar(75)='''',@I_vINDEX15FROM varchar(75)='''',@I_vFORLOAD int=0,@I_vFORLIST int=0,@I_vACTION  int=0,@I_vROWCOUNT int=0,@I_vREMOVE int=0,@I_vWhereClause varchar(1000)=''''  with encryption AS  declare @WhereNotExistsStatement varchar(8000),@Orderbystatement varchar(8000),@statement01 varchar(4000),@WhereStatement varchar(8000),@InsertStatement varchar(8000),@InsertStatement2 varchar(8000),@ColumnName varchar(50), @x int, @IndexName varchar(50),@INDEXCNT int, @TABLENAME varchar(30),@TagNumber int,@TableCount int,@Y int,@fill char(1),@fill2 char(2),@delete varchar(1000),@dbname varchar(50)  select @fill = char(39),@fill2 = char(39)+char(39),@Orderbystatement='' order by '',@statement01 ='''',@WhereStatement ='''',@INDEXCNT = 0,@TABLENAME = '''',@InsertStatement = '''',@InsertStatement2 = '''',@dbname = ''''  set nocount on  select @dbname = db_name()  select * into #eConnect_Out from eConnect_Out (nolock) where DOCTYPE = ''BUILD'' create table #Column(ColumnName varchar(50))  if (@I_vFORLIST =1) begin  select @I_vFORLOAD=0,@I_vACTION=0,@I_vREMOVE=0 end  if (@I_vFORLOAD = 1) or (@I_vFORLIST =1) begin  select @INDEXCNT=INDEXCNT,@TABLENAME=TABLENAME from eConnect_Out_Setup (nolock) where DOCTYPE = @I_vDOCTYPE and MAIN = 1   if (@I_vFORLOAD = 1) select @statement01 = ''insert into eConnect_Out(DATE1,TABLENAME,DEX_ROW_ID,DOCTYPE,INDEX1,INDEX2,INDEX3,INDEX4,INDEX5,INDEX6,INDEX7,INDEX8,INDEX9,INDEX10,INDEX11,INDEX12,INDEX13,INDEX14,INDEX15,ACTION,REPLICATE,DBNAME) select '' + char(10)  if (@I_vFORLIST =1) select @statement01 = ''insert into #eConnect_Out(DATE1,TABLENAME,DEX_ROW_ID,DOCTYPE,INDEX1,INDEX2,INDEX3,INDEX4,INDEX5,INDEX6,INDEX7,INDEX8,INDEX9,INDEX10,INDEX11,INDEX12,INDEX13,INDEX14,INDEX15,ACTION,REPLICATE,DBNAME) select '' + char(10)  if (@I_vROWCOUNT > 0)   begin  select @statement01 = @statement01 + '' TOP '' + str(@I_vROWCOUNT) + '' ''  end   select @statement01 = @statement01 + @fill + @fill + '','' + @fill + @TABLENAME + @fill + '',DEX_ROW_ID,'' + @fill + @I_vDOCTYPE + @fill + '','' + char(10)  select @x = 1  while (@x <= 15)  begin  if (@x <= @INDEXCNT)  begin  exec(''insert into #Column select INDEX'' + @x + '' from eConnect_Out_Setup (nolock) where DOCTYPE = '''''' + @I_vDOCTYPE + '''''' and MAIN = 1'')  select @ColumnName = ColumnName from #Column  select @statement01 = @statement01 + rtrim(@ColumnName)  select @Orderbystatement = @Orderbystatement  + rtrim(@ColumnName)   truncate table #Column ' select @sqlproctext3 =  'if ((@x = 1) and ((@I_vINDEX1FROM <> '''') or (@I_vINDEX1TO <> '''')))  begin   select @WhereStatement = @WhereStatement + '' where '' + rtrim(@ColumnName) + '' between '''''' + replace(rtrim(@I_vINDEX1FROM),'''''''','''''''''''') + '''''' and '''''' + replace(rtrim(@I_vINDEX1TO),'''''''','''''''''''') + ''''''''   if (@I_vFORLIST <> 1)  begin  select @WhereNotExistsStatement = '' and not exists ( select 1 from eConnect_Out where INDEX1 = ''+ '''''''' + @I_vINDEX1FROM + ''''''''   end  end  else  begin  if (@I_vFORLIST <> 1)  begin  select @WhereNotExistsStatement = @WhereNotExistsStatement + '' and INDEX''+ltrim(rtrim(str(@x)))+'' = ''+   case  when @x = 2 then @I_vINDEX2FROM  when @x = 3 then @I_vINDEX3FROM  when @x = 4 then @I_vINDEX4FROM  when @x = 5 then @I_vINDEX5FROM  when @x = 6 then @I_vINDEX6FROM  when @x = 7 then @I_vINDEX7FROM  when @x = 8 then @I_vINDEX8FROM  when @x = 9 then @I_vINDEX9FROM  when @x = 10 then @I_vINDEX10FROM  when @x = 11 then @I_vINDEX11FROM  when @x = 12 then @I_vINDEX12FROM  when @x = 13 then @I_vINDEX13FROM  when @x = 14 then @I_vINDEX14FROM  when @x = 15 then @I_vINDEX15FROM  end   end  end ' select @sqlproctext3b =   'if ((@x = 2) and ((@I_vINDEX2FROM <> '''') or (@I_vINDEX2TO <> '''')))  begin  if len(@WhereStatement) = 0 select @WhereStatement =+ '' where ''  if len(@WhereStatement) > 20 select @WhereStatement = @WhereStatement + '' and ''  select @WhereStatement = @WhereStatement + rtrim(@ColumnName) + '' between '''''' + replace(rtrim(@I_vINDEX2FROM),'''''''','''''''''''') + '''''' and '''''' + replace(rtrim(@I_vINDEX2TO),'''''''','''''''''''') + ''''''''  end   if ((@x = 3) and ((@I_vINDEX3FROM <> '''') or (@I_vINDEX3TO <> '''')))   begin  if len(@WhereStatement) = 0 select @WhereStatement =+ '' where ''  if len(@WhereStatement) > 20 select @WhereStatement = @WhereStatement + '' and ''  select @WhereStatement = @WhereStatement + rtrim(@ColumnName) + '' between '''''' + replace(rtrim(@I_vINDEX3FROM),'''''''','''''''''''') + '''''' and '''''' + replace(rtrim(@I_vINDEX3TO),'''''''','''''''''''') + ''''''''  end   if ((@x = 4) and ((@I_vINDEX4FROM <> '''') or (@I_vINDEX4TO <> '''')))  begin  if len(@WhereStatement) = 0 select @WhereStatement =+ '' where ''  if len(@WhereStatement) > 20 select @WhereStatement = @WhereStatement + '' and ''  select @WhereStatement = @WhereStatement + rtrim(@ColumnName) + '' between '''''' + replace(rtrim(@I_vINDEX4FROM),'''''''','''''''''''') + '''''' and '''''' + replace(rtrim(@I_vINDEX4TO),'''''''','''''''''''') + ''''''''  end   if ((@x = 5) and ((@I_vINDEX5FROM <> '''') or (@I_vINDEX5TO <> '''')))  begin  if len(@WhereStatement) = 0 select @WhereStatement =+ '' where ''  if len(@WhereStatement) > 20 select @WhereStatement = @WhereStatement + '' and ''  select @WhereStatement = @WhereStatement + rtrim(@ColumnName) + '' between '''''' + replace(rtrim(@I_vINDEX5FROM),'''''''','''''''''''') + '''''' and '''''' + replace(rtrim(@I_vINDEX5TO),'''''''','''''''''''') + ''''''''  end   if ((@x = 6) and ((@I_vINDEX6FROM <> '''') or (@I_vINDEX6TO <> '''')))  begin  if len(@WhereStatement) = 0 select @WhereStatement =+ '' where ''  if len(@WhereStatement) > 20 select @WhereStatement = @WhereStatement + '' and ''  select @WhereStatement = @WhereStatement + rtrim(@ColumnName) + '' between '''''' + replace(rtrim(@I_vINDEX6FROM),'''''''','''''''''''') + '''''' and '''''' + replace(rtrim(@I_vINDEX6TO),'''''''','''''''''''') + ''''''''  end   if ((@x = 7) and ((@I_vINDEX7FROM <> '''') or (@I_vINDEX7TO <> '''')))  begin  if len(@WhereStatement) = 0 select @WhereStatement =+ '' where ''  if len(@WhereStatement) > 20 select @WhereStatement = @WhereStatement + '' and ''  select @WhereStatement = @WhereStatement + rtrim(@ColumnName) + '' between '''''' + replace(rtrim(@I_vINDEX7FROM),'''''''','''''''''''') + '''''' and '''''' + replace(rtrim(@I_vINDEX7TO),'''''''','''''''''''') + ''''''''  end   if ((@x = 8) and ((@I_vINDEX8FROM <> '''') or (@I_vINDEX8TO <> '''')))   begin  if len(@WhereStatement) = 0 select @WhereStatement =+ '' where ''  if len(@WhereStatement) > 20 select @WhereStatement = @WhereStatement + '' and ''  select @WhereStatement = @WhereStatement + rtrim(@ColumnName) + '' between '''''' + replace(rtrim(@I_vINDEX8FROM),'''''''','''''''''''') + '''''' and '''''' + replace(rtrim(@I_vINDEX8TO),'''''''','''''''''''') + ''''''''  end   if ((@x = 9) and ((@I_vINDEX9FROM <> '''') or (@I_vINDEX9TO <> '''')))  begin  if len(@WhereStatement) = 0 select @WhereStatement =+ '' where ''  if len(@WhereStatement) > 20 select @WhereStatement = @WhereStatement + '' and ''  select @WhereStatement = @WhereStatement + rtrim(@ColumnName) + '' between '''''' + replace(rtrim(@I_vINDEX9FROM),'''''''','''''''''''') + '''''' and '''''' + replace(rtrim(@I_vINDEX9TO),'''''''','''''''''''') + ''''''''  end   if ((@x = 10) and ((@I_vINDEX10FROM <> '''') or (@I_vINDEX10TO <> '''')))  begin  if len(@WhereStatement) = 0 select @WhereStatement =+ '' where ''  if len(@WhereStatement) > 20 select @WhereStatement = @WhereStatement + '' and ''  select @WhereStatement = @WhereStatement + rtrim(@ColumnName) + '' between '''''' + replace(rtrim(@I_vINDEX10FROM),'''''''','''''''''''') + '''''' and '''''' + replace(rtrim(@I_vINDEX10TO),'''''''','''''''''''') + ''''''''  end   if ((@x = 11) and ((@I_vINDEX11FROM <> '''') or (@I_vINDEX11TO <> '''')))  begin  if len(@WhereStatement) = 0 select @WhereStatement =+ '' where ''  if len(@WhereStatement) > 20 select @WhereStatement = @WhereStatement + '' and ''  select @WhereStatement = @WhereStatement + rtrim(@ColumnName) + '' between '''''' + replace(rtrim(@I_vINDEX11FROM),'''''''','''''''''''') + '''''' and '''''' + replace(rtrim(@I_vINDEX11TO),'''''''','''''''''''') + ''''''''  end   if ((@x = 12) and ((@I_vINDEX12FROM <> '''') or (@I_vINDEX12TO <> '''')))  begin  if len(@WhereStatement) = 0 select @WhereStatement =+ '' where ''  if len(@WhereStatement) > 20 select @WhereStatement = @WhereStatement + '' and ''  select @WhereStatement = @WhereStatement + rtrim(@ColumnName) + '' between '''''' + replace(rtrim(@I_vINDEX12FROM),'''''''','''''''''''') + '''''' and '''''' + replace(rtrim(@I_vINDEX12TO),'''''''','''''''''''') + ''''''''  end   if ((@x = 13) and ((@I_vINDEX13FROM <> '''') or (@I_vINDEX13TO <> '''')))  begin  if len(@WhereStatement) = 0 select @WhereStatement =+ '' where ''  if len(@WhereStatement) > 20 select @WhereStatement = @WhereStatement + '' and ''  select @WhereStatement = @WhereStatement + rtrim(@ColumnName) + '' between '''''' + replace(rtrim(@I_vINDEX13FROM),'''''''','''''''''''') + '''''' and '''''' + replace(rtrim(@I_vINDEX13TO),'''''''','''''''''''') + ''''''''  end   if ((@x = 14) and ((@I_vINDEX14FROM <> '''') or (@I_vINDEX14TO <> '''')))  begin  if len(@WhereStatement) = 0 select @WhereStatement =+ '' where ''  if len(@WhereStatement) > 20 select @WhereStatement = @WhereStatement + '' and ''  select @WhereStatement = @WhereStatement + rtrim(@ColumnName) + '' between '''''' + replace(rtrim(@I_vINDEX14FROM),'''''''','''''''''''') + '''''' and '''''' + replace(rtrim(@I_vINDEX14TO),'''''''','''''''''''') + ''''''''  end   if ((@x = 15) and ((@I_vINDEX15FROM <> '''') or (@I_vINDEX15TO <> '''')))  begin  if len(@WhereStatement) = 0 select @WhereStatement =+ '' where ''  if len(@WhereStatement) > 20 select @WhereStatement = @WhereStatement + '' and ''  select @WhereStatement = @WhereStatement + rtrim(@ColumnName) + '' between '''''' + replace(rtrim(@I_vINDEX15FROM),'''''''','''''''''''') + '''''' and '''''' + replace(rtrim(@I_vINDEX15TO),'''''''','''''''''''') + ''''''''  end  end   else  select @statement01 = @statement01 + @fill2   select @statement01 = @statement01 + '','' + CHAR(10)  if (@x < @INDEXCNT)  begin  select @Orderbystatement = @Orderbystatement + '',''  end  select @x = @x + 1  end   select @WhereNotExistsStatement = @WhereNotExistsStatement + '')''   if (@I_vWhereClause <> '''') and (@WhereStatement <> '''')   begin  select @I_vWhereClause = '' and '' + rtrim(@I_vWhereClause)  + CHAR(10)  end  else if (@I_vWhereClause <> '''') and (@WhereStatement = '''')   begin  select @I_vWhereClause = '' where '' + rtrim(@I_vWhereClause)  + CHAR(10)  end   if (@I_vFORLIST =1)  begin  select @statement01 = @statement01 + ''0,0,'' + @fill + @dbname + @fill + '' from '' + @TABLENAME + '' (nolock) ''  end  else  select @statement01 = @statement01 + ''1,0,'' + @fill + @dbname + @fill + '' from '' + @TABLENAME + '' (nolock) ''   exec (@statement01+@WhereStatement +@WhereNotExistsStatement+ @I_vWhereClause + @Orderbystatement) end else ' select @sqlproctext4 =  ' if (@I_vFORLIST <>1) begin   select @INDEXCNT=INDEXCNT,@TABLENAME=TABLENAME from eConnect_Out_Setup (nolock) where DOCTYPE = @I_vDOCTYPE and MAIN = ''1''   select @InsertStatement = ''insert into #eConnect_Out ( DATE1,TABLENAME,DEX_ROW_ID,DOCTYPE,'' + CHAR(10)   if (@I_vROWCOUNT > 0)   begin  select @InsertStatement2 = @InsertStatement2 + '' TOP '' + str(@I_vROWCOUNT) + '' ''  end   select @InsertStatement2 = @InsertStatement2 + '' DATE1,TABLENAME,DEX_ROW_ID,DOCTYPE,''   select @x = 1  while (@x <= 15)  begin  select @InsertStatement = @InsertStatement + ''INDEX'' + ltrim(str(@x))  select @InsertStatement = @InsertStatement + '','' + CHAR(10)   if (@x <= @INDEXCNT)  begin  select @InsertStatement2 = @InsertStatement2 + ''INDEX'' + ltrim(str(@x))  end  else  select @InsertStatement2 = @InsertStatement2 + ''''''''''''   select @InsertStatement2 = @InsertStatement2 + '','' + CHAR(10)   select @x = @x + 1  end   select @InsertStatement = @InsertStatement + ''ACTION,REPLICATE,DBNAME)'' + CHAR(10) + '' select ''  select @InsertStatement2 = @InsertStatement2 + ''ACTION,REPLICATE,DBNAME'' + CHAR(10)  select @InsertStatement2 = @InsertStatement2 + '' from eConnect_Out (nolock) where DOCTYPE = '''''' + @I_vDOCTYPE +  ''''''''   if (@I_vACTION > 0)   begin  if (@I_vACTION = 4) or (@I_vACTION = 5)  begin  select @InsertStatement2 = @InsertStatement2 +  '' and ACTION between 1 and 2 ''  end  else  begin  select @InsertStatement2 = @InsertStatement2 +  '' and ACTION = '' + ltrim(str(@I_vACTION))  end  end ' select @sqlproctext5 = 'select @x = 1  while ((@x <= @INDEXCNT) and (@I_vINDEX1FROM <> ''''))  begin  if ((@x = 1) and (@I_vINDEX1FROM <> ''''))   select @InsertStatement2 = @InsertStatement2 + '' and INDEX1 between '''''' + replace(rtrim(@I_vINDEX1FROM),'''''''','''''''''''') + '''''' and '''''' + replace(rtrim(@I_vINDEX1TO),'''''''','''''''''''') + ''''''''  if ((@x = 2) and (@I_vINDEX2FROM <> ''''))   select @InsertStatement2 = @InsertStatement2 + '' and INDEX2 between '''''' + replace(rtrim(@I_vINDEX2FROM),'''''''','''''''''''') + '''''' and '''''' + replace(rtrim(@I_vINDEX2TO),'''''''','''''''''''') + ''''''''  if ((@x = 3) and (@I_vINDEX3FROM <> ''''))   select @InsertStatement2 = @InsertStatement2 + '' and INDEX3 between '''''' + replace(rtrim(@I_vINDEX3FROM),'''''''','''''''''''') + '''''' and '''''' + replace(rtrim(@I_vINDEX3TO),'''''''','''''''''''') + ''''''''  if ((@x = 4) and (@I_vINDEX4FROM <> ''''))   select @InsertStatement2 = @InsertStatement2 + '' and INDEX4 between '''''' + replace(rtrim(@I_vINDEX4FROM),'''''''','''''''''''') + '''''' and '''''' + replace(rtrim(@I_vINDEX4TO),'''''''','''''''''''') + ''''''''  if ((@x = 5) and (@I_vINDEX5FROM <> ''''))   select @InsertStatement2 = @InsertStatement2 + '' and INDEX5 between '''''' + replace(rtrim(@I_vINDEX5FROM),'''''''','''''''''''') + '''''' and '''''' + replace(rtrim(@I_vINDEX5TO),'''''''','''''''''''') + ''''''''  if ((@x = 6) and (@I_vINDEX6FROM <> ''''))   select @InsertStatement2 = @InsertStatement2 + '' and INDEX6 between '''''' + replace(rtrim(@I_vINDEX6FROM),'''''''','''''''''''') + '''''' and '''''' + replace(rtrim(@I_vINDEX6TO),'''''''','''''''''''') + ''''''''  if ((@x = 7) and (@I_vINDEX7FROM <> ''''))   select @InsertStatement2 = @InsertStatement2 + '' and INDEX7 between '''''' + replace(rtrim(@I_vINDEX7FROM),'''''''','''''''''''') + '''''' and '''''' + replace(rtrim(@I_vINDEX7TO),'''''''','''''''''''') + ''''''''  if ((@x = 8) and (@I_vINDEX8FROM <> ''''))   select @InsertStatement2 = @InsertStatement2 + '' and INDEX8 between '''''' + replace(rtrim(@I_vINDEX8FROM),'''''''','''''''''''') + '''''' and '''''' + replace(rtrim(@I_vINDEX8TO),'''''''','''''''''''') + ''''''''  if ((@x = 9) and (@I_vINDEX9FROM <> ''''))   select @InsertStatement2 = @InsertStatement2 + '' and INDEX9 between '''''' + replace(rtrim(@I_vINDEX9FROM),'''''''','''''''''''') + '''''' and '''''' + replace(rtrim(@I_vINDEX9TO),'''''''','''''''''''') + ''''''''  if ((@x = 10) and (@I_vINDEX10FROM <> ''''))   select @InsertStatement2 = @InsertStatement2 + '' and INDEX10 between '''''' + replace(rtrim(@I_vINDEX10FROM),'''''''','''''''''''') + '''''' and '''''' + replace(rtrim(@I_vINDEX10TO),'''''''','''''''''''') + ''''''''  if ((@x = 11) and (@I_vINDEX11FROM <> ''''))   select @InsertStatement2 = @InsertStatement2 + '' and INDEX11 between '''''' + replace(rtrim(@I_vINDEX11FROM),'''''''','''''''''''') + '''''' and '''''' + replace(rtrim(@I_vINDEX11TO),'''''''','''''''''''') + ''''''''  if ((@x = 12) and (@I_vINDEX12FROM <> ''''))   select @InsertStatement2 = @InsertStatement2 + '' and INDEX12 between '''''' + replace(rtrim(@I_vINDEX12FROM),'''''''','''''''''''') + '''''' and '''''' + replace(rtrim(@I_vINDEX12TO),'''''''','''''''''''') + ''''''''  if ((@x = 13) and (@I_vINDEX13FROM <> ''''))   select @InsertStatement2 = @InsertStatement2 + '' and INDEX13 between '''''' + replace(rtrim(@I_vINDEX13FROM),'''''''','''''''''''') + '''''' and '''''' + replace(rtrim(@I_vINDEX13TO),'''''''','''''''''''') + ''''''''  if ((@x = 14) and (@I_vINDEX14FROM <> ''''))   select @InsertStatement2 = @InsertStatement2 + '' and INDEX14 between '''''' + replace(rtrim(@I_vINDEX14FROM),'''''''','''''''''''') + '''''' and '''''' + replace(rtrim(@I_vINDEX14TO),'''''''','''''''''''') + ''''''''  if ((@x = 15) and (@I_vINDEX15FROM <> ''''))   select @InsertStatement2 = @InsertStatement2 + '' and INDEX15 between '''''' + replace(rtrim(@I_vINDEX15FROM),'''''''','''''''''''') + '''''' and '''''' + replace(rtrim(@I_vINDEX15TO),'''''''','''''''''''') + ''''''''  select @x = @x + 1  end   exec (@InsertStatement+@InsertStatement2)   select @delete = ''delete a from #eConnect_Out a, tempdb.dbo.DEX_LOCK b (nolock) where a.DEX_ROW_ID = b.row_id and  b.table_path_name = '''''' + db_name() + ''.dbo.'' + @TABLENAME + ''''''''  exec (@delete) end  if (@I_vREMOVE = 1) and (@I_vFORLIST = 0) begin  delete a from eConnect_Out a (updlock), #eConnect_Out b  where a.DOCTYPE = b.DOCTYPE and  a.INDEX1 = b.INDEX1 and  a.INDEX2 = b.INDEX2 and  a.INDEX3 = b.INDEX3 and  a.INDEX4 = b.INDEX4 and  a.INDEX5 = b.INDEX5 and  a.INDEX6 = b.INDEX6 and  a.INDEX7 = b.INDEX7 and  a.INDEX8 = b.INDEX8 and  a.INDEX9 = b.INDEX9 and  a.INDEX10 = b.INDEX10 and  a.INDEX11 = b.INDEX11 and  a.INDEX12 = b.INDEX12 and  a.INDEX13 = b.INDEX13 and  a.INDEX14 = b.INDEX14 and  a.INDEX15 = b.INDEX15 and  a.ACTION = b.ACTION end' + char(10)  create table #Column(ColumnName varchar(50))  if (@I_vOUTPUTTYPE = 0) begin  select @TagNumber = 1  select @INDEXCNT=INDEXCNT,@DATACNT=DATACNT,@TABLENAME = TABLENAME from eConnect_Out_Setup (nolock) where DOCTYPE = @I_vDOCTYPE and MAIN = @TagNumber   select @SQLStatement = '',@SQLStatement2 = '',@SQLFrom=''  select @SQLStatement = ' Select ACTION = eConnect.ACTION,DOCTYPE = eConnect.DOCTYPE,' + char(10)  select @x = 1  exec('insert into #Column select INDEX' + @x + ' from eConnect_Out_Setup (nolock) where DOCTYPE = ''' + @I_vDOCTYPE + ''' and MAIN = ' + @TagNumber)  select @ColumnName = ColumnName from #Column  while (@x <= @INDEXCNT)  begin  select @SQLStatement = @SQLStatement + rtrim(@ColumnName) +  ' = eConnect.INDEX' + ltrim(str(@x))  select @SQLStatement =  case   when @x < @INDEXCNT then @SQLStatement + ',' + CHAR(10)  when @x = @INDEXCNT then @SQLStatement + CHAR(10)  end   select @x = @x + 1   truncate table #Column  exec('insert into #Column select INDEX' + @x + ' from eConnect_Out_Setup (nolock) where DOCTYPE = ''' + @I_vDOCTYPE + ''' and MAIN = ' + @TagNumber)  select @ColumnName = ColumnName from #Column   end   select @SQLStatement = @SQLStatement + ',DBNAME = eConnect.DBNAME,TABLENAME = eConnect.TABLENAME'   select @SQLFrom = ' FROM [#eConnect_Out] [eConnect] (nolock) FOR XML AUTO, ELEMENTS'  exec (@sqlproctext1 + @sqlproctext2 + @sqlproctext3 + @sqlproctext3b + @sqlproctext4 + @sqlproctext5+@SQLStatement + @SQLFrom) end else  if (@I_vOUTPUTTYPE = 2) or (@I_vOUTPUTTYPE = 1)  begin  if (@I_vOUTPUTTYPE = 1)  select @TableCount = 1  else  begin  select @TableCount = Count(TABLENAME) from eConnect_Out_Setup (nolock) where DOCTYPE = @I_vDOCTYPE  end   select @TagNumber = 2, @XMLData = '',@XMLIndex = '',@SQLFrom = '',@SQLStatement2 = '',@SQLWhere = '',@SQLJoin='',  @SQLStatement3='',@XMLIndex2='',@SQLStatement1='',@SQLOrder='',@SQLStatement4='',@SQLStatement5='',  @JoinAlias='',@SQLStatement6='',@SQLOrder2='',@XMLData2=''   select @SQLOrder = ' Order by '    select @INDEXCNT=INDEXCNT,@DATACNT=DATACNT,@TABLENAME=TABLENAME,@JoinTable=JOINTABLE,@Alias=ALIAS  from eConnect_Out_Setup (nolock) where DOCTYPE = @I_vDOCTYPE and MAIN = (@TagNumber-1)   select @LowParent = max(PARENTLEVEL) from eConnect_Out_Setup (nolock) where DOCTYPE = @I_vDOCTYPE   select @SQLFrom = ' FROM [#eConnect_Out] [eConnect] (nolock) ' + char(10)   select @SQLStatement =  'SELECT 1 as Tag,NULL as Parent,' + CHAR(10) +   'rtrim(eConnect.ACTION) as [eConnect!1!ACTION],rtrim(eConnect.DOCTYPE) as [eConnect!1!Requester_DOCTYPE],' + CHAR(10)   select @SQLStatement = @SQLStatement + 'rtrim(eConnect.DBNAME) as [eConnect!1!DBNAME],' + CHAR(10)  select @SQLStatement = @SQLStatement + 'rtrim(eConnect.TABLENAME) as [eConnect!1!TABLENAME],' + CHAR(10)  select @SQLStatement = @SQLStatement + 'eConnect.DATE1 as [eConnect!1!DATE1],' + CHAR(10)   select @XMLHeaderData = @XMLHeaderData + 'eConnect.DBNAME,' + char(10)  select @XMLHeaderData = @XMLHeaderData + 'eConnect.TABLENAME,' + char(10)  select @XMLHeaderData = @XMLHeaderData + 'eConnect.DATE1,' + char(10)   while (@TagNumber <= @TableCount + 1)  begin  select  @XMLIndex2 ='',  @XMLData='',  @SQLStatement5='',  @SQLJoin1='',  @SQLStatement12='',  @XMLData2=''   if @TagNumber=2  select @XMLIndex2 = 'eConnect.ACTION,eConnect.DOCTYPE,' + char(10)   select @TagNumber = ltrim(str(@TagNumber))   select  @INDEXCNT=INDEXCNT,  @DATACNT=DATACNT,  @TABLENAME = TABLENAME,  @ParentLevel = PARENTLEVEL+1,  @Alias=ALIAS,  @JoinTable=JOINTABLE,  @OrderBy = ORDERBY  from eConnect_Out_Setup (nolock) where DOCTYPE = @I_vDOCTYPE and MAIN = (@TagNumber - 1)   select @JoinAlias=ALIAS from eConnect_Out_Setup (nolock) where DOCTYPE = @I_vDOCTYPE and TABLENAME = @JoinTable   select @SQLStatement5 = @SQLStatement5 +   ' UNION ALL Select ' + ltrim(str(@TagNumber)) + ',' + ltrim(str(@ParentLevel)) + ','   select @x = 1  while (@x <= @INDEXCNT) and (@TagNumber=2)  begin   select @XMLHeaderData = @XMLHeaderData + 'eConnect.INDEX' + ltrim(str(@x)) + ',' + char(10)   exec('insert into #Column select INDEX' + @x + ' from eConnect_Out_Setup (nolock) where DOCTYPE = ''' + @I_vDOCTYPE + ''' and MAIN = 1')   select @ColumnName = ColumnName from #Column   if (@ColumnName <> '')   begin   select @xtypeName = c.name from sysobjects a(nolock), syscolumns b(nolock), systypes c(nolock) where a.name = @TABLENAME and a.id = b.id and b.xtype = c.xtype and b.name = @ColumnName   if (@xtypeName = '')  begin  select @SQLStatement = @SQLStatement + 'rtrim(eConnect.INDEX' + ltrim(str(@x)) + ') as [eConnect!1!' + ltrim(@ColumnName) + '],' + CHAR(10)  end  else  begin  if ((@xtypeName = 'char') or (@xtypeName = 'nchar') or (@xtypeName = 'varchar') or (@xtypeName = 'nvarchar'))  begin  select @SQLStatement = @SQLStatement + 'rtrim(cast(eConnect.INDEX' + ltrim(str(@x)) + ' as [' + @xtypeName + '])) as [eConnect!1!' + ltrim(@ColumnName) + '],' + CHAR(10)  end  else  begin  select @SQLStatement = @SQLStatement + 'cast(eConnect.INDEX' + ltrim(str(@x)) + ' as [' + @xtypeName + ']) as [eConnect!1!' + ltrim(@ColumnName) + '],' + CHAR(10)  end  end   select @SQLOrder = @SQLOrder + ' [eConnect!1!' + ltrim(@ColumnName) + '], '  end   select @x = @x + 1  end   if (@TagNumber=2)  begin  select @XMLHeaderData= @XMLIndex2 + @XMLHeaderData  select @SQLJoin = ' left outer join [' + @TABLENAME + '] [' + @Alias + '] (nolock) on '  select @x = 1, @ColumnsUsed = 1  exec('insert into #Column select INDEX' + @x + ' from eConnect_Out_Setup (nolock) where DOCTYPE = ''' + @I_vDOCTYPE + ''' and MAIN = 1')  select @ColumnName = ColumnName from #Column  while (@ColumnName <> '')  begin  if (@ColumnName <> 'TrxState')  begin  if (@ColumnsUsed > 1)  begin  select @SQLJoin = @SQLJoin + ' and '   end   select @ColumnsUsed = @ColumnsUsed + 1   select @SQLJoin = @SQLJoin + '['+@Alias + '].' + @ColumnName + ' = eConnect.INDEX' + ltrim(str(@x))  end   select @x = @x + 1  truncate table #Column  exec('insert into #Column select INDEX' + @x + ' from eConnect_Out_Setup (nolock) where DOCTYPE = ''' + @I_vDOCTYPE + ''' and MAIN = 1')  select @ColumnName = ColumnName from #Column  end  end   truncate table #PL  select @PL =(@TagNumber-1)  insert into #PL select @PL   while @PL > 1   begin  select @PL=PARENTLEVEL from eConnect_Out_Setup (nolock) where DOCTYPE = @I_vDOCTYPE and MAIN = @PL  insert into #PL select @PL  end   select @z = 1, @XMLData = @XMLHeaderData  while (@z <= @TableCount) and (@I_vOUTPUTTYPE = 2)  begin   if (exists(select 1 from #PL (nolock) where PL = @z))  begin  select @t=1,@INDXCNT=INDEXCNT,@TBLNAME=TABLENAME,@Als=ALIAS,@Jointble=JOINTABLE  FROM eConnect_Out_Setup (nolock) where DOCTYPE = @I_vDOCTYPE and MAIN = @z   select @JoinAls=ALIAS from eConnect_Out_Setup (nolock) where DOCTYPE = @I_vDOCTYPE and TABLENAME = @Jointble   if (@z < (@TagNumber-1))  begin  truncate table #Column  exec('insert into #Column select INDEX' + @t + ' from eConnect_Out_Setup (nolock) where DOCTYPE = ''' + @I_vDOCTYPE + ''' and MAIN = ' + @z )  select @ColumnName = ColumnName from #Column  while (@t <= @INDXCNT)  begin  select @XMLData = @XMLData + 'LTRIM(RTRIM(' + @Als + '.' + rtrim(@ColumnName) + ')),' + char(10)   select @t = @t + 1   truncate table #Column  exec('insert into #Column select INDEX' + @t + ' from eConnect_Out_Setup (nolock) where DOCTYPE = ''' + @I_vDOCTYPE + ''' and MAIN = ' + @z)  select @ColumnName = ColumnName from #Column  end  end   if (@z > 1)  begin  select @SQLJoin1 = @SQLJoin1 + ' left outer join [' + @TBLNAME + '] [' + @Als + '] (nolock) on '   select @s = 1, @ColumnsUsed = 1  exec('insert into #Column select JOIN' + @s + ' from eConnect_Out_Setup (nolock) where DOCTYPE = ''' + @I_vDOCTYPE + ''' and MAIN = ' + @z)  select @ColumnName = ColumnName from #Column  while (@ColumnName <> '')   begin  if (@ColumnName <> 'TrxState')  begin  if (@ColumnsUsed > 1)  begin  select @SQLJoin1 = @SQLJoin1 + ' and '   end   select @ColumnsUsed = @ColumnsUsed + 1   select @SQLJoin1 = @SQLJoin1 + @Als + '.' + @ColumnName + ' = '    exec('insert into #Column select JOINTO' + @s + ' from eConnect_Out_Setup (nolock) where DOCTYPE = ''' + @I_vDOCTYPE + ''' and MAIN = ' + @z)  select @ColumnName = ColumnName from #Column  select @SQLJoin1 = @SQLJoin1 + @JoinAls + '.' + @ColumnName   end   select @s = @s + 1  truncate table #Column  exec('insert into #Column select JOIN' + @s + ' from eConnect_Out_Setup (nolock) where DOCTYPE = ''' + @I_vDOCTYPE + ''' and MAIN = ' + @z)  select @ColumnName = ColumnName from #Column  end  end  if (@z < (@TagNumber-1))  begin  select @Y = 0  select @Y = DATACNT FROM eConnect_Out_Setup (nolock) where DOCTYPE = @I_vDOCTYPE and MAIN = @z   while (@Y > 0)   begin  if len(@XMLData) > 7500  begin  select @XMLData2 =@XMLData  select @XMLData = ''  end  select @XMLData = @XMLData + 'NULL,'   select @Y = @Y -1  end  end  end  else  begin  if ((@TagNumber > 2) and (@z < @TagNumber))  begin  select @Y = 0  select @Y = sum(INDEXCNT + DATACNT) FROM eConnect_Out_Setup (nolock) where DOCTYPE = @I_vDOCTYPE and MAIN = @z   while (@Y > 0)   begin  if len(@XMLData) > 7500  begin  select @XMLData2 =@XMLData  select @XMLData = ''  end  select @XMLData = @XMLData + 'NULL,'   select @Y = @Y -1  end  end  end  select @z = @z + 1  end   select @x = 1  exec('insert into #Column select INDEX' + @x + ' from eConnect_Out_Setup (nolock) where DOCTYPE = ''' + @I_vDOCTYPE + ''' and MAIN = ' + @TagNumber + ' - 1')  select @ColumnName = ColumnName from #Column  while (@x <= @INDEXCNT)  begin   select @SQLIndex = 'NULL as [' + @Alias + '!' + ltrim(str(@TagNumber)) + '!' + rtrim(@ColumnName) + '!element],' + CHAR(10)   if (len(@SQLStatement) + len(@SQLIndex) >= 8000) or (@SQLStatement2 <> '')  begin   if (len(@SQLStatement2) + len(@SQLIndex) >= 8000) or (@SQLStatement11 <> '')  begin  if (len(@SQLStatement11) + len(@SQLIndex) >= 8000) or (@SQLStatement13 <> '')  begin  select @SQLStatement13 = @SQLStatement13 + @SQLIndex  end  else  begin  select @SQLStatement11 = @SQLStatement11 + @SQLIndex  end  end  else  begin  select @SQLStatement2 = @SQLStatement2 + @SQLIndex  end  end  else  begin  select @SQLStatement = @SQLStatement + @SQLIndex  end   select @xtype = xtype from syscolumns (nolock) where name = rtrim(@ColumnName) and id in (select id from sysobjects (nolock) where name = @TABLENAME)   if len(@XMLData) > 7500  begin  select @XMLData2 =@XMLData  select @XMLData = ''  end   if @xtype = 173   begin  select @XMLData = @XMLData + '[' + @Alias + '].' + rtrim(@ColumnName) + ',' + char(10)  end  else if (@xtype = 99) or (@xtype = 35)    begin  select @XMLData = @XMLData + '[' + @Alias + '].' + rtrim(@ColumnName) + ',' + char(10)  end  else if (@xtype = 61)    begin  select @XMLData = @XMLData + '[' + @Alias + '].' + rtrim(@ColumnName) + ',' + char(10)  end  else  begin  select @XMLData = @XMLData + 'LTRIM(RTRIM([' + @Alias + '].' + rtrim(@ColumnName) + ')),' + char(10)  end  select @OrderCnt = count(*) from eConnect_Out_Setup (nolock) where DOCTYPE = @I_vDOCTYPE and MAIN > (@TagNumber-1) and ORDERBY = 1  select @JoinCnt = count(*) from eConnect_Out_Setup (nolock) where DOCTYPE = @I_vDOCTYPE and PARENTLEVEL = (@TagNumber-1)   if (@OrderBy = 1)   begin  SELECT @SQLOrder2 = @SQLOrder2 + ' [' + @Alias + '!' + ltrim(str(@TagNumber)) + '!' + rtrim(@ColumnName) + '!element],'   select @XMLIndex2 = @XMLIndex2 + 'rtrim([' + @Alias + '].' + rtrim(@ColumnName) + '),'  end  else  begin  select @XMLIndex2 = @XMLIndex2 + 'NULL,'  end  select @x = @x + 1  truncate table #Column  exec('insert into #Column select INDEX' + @x + ' from eConnect_Out_Setup (nolock) where DOCTYPE = ''' + @I_vDOCTYPE + ''' and MAIN = ' + @TagNumber + ' - 1')  select @ColumnName = ColumnName from #Column  end   if @DATACNT = 0  begin  select @XMLData = substring(@XMLData,1,LEN(@XMLData)-2)  select @SQLStatement = substring(@SQLStatement,1,LEN(@SQLStatement)-2)  end   select @x = 1  exec('insert into #Column select DATA' + @x + ' from eConnect_Out_Setup (nolock) where DOCTYPE = ''' + @I_vDOCTYPE + ''' and MAIN = ' + @TagNumber + ' - 1')  select @ColumnName = ColumnName from #Column  while (@x <= @DATACNT)  begin  select @SQLStatement12 = 'NULL as [' + @Alias + '!' + ltrim(str(@TagNumber)) + '!' + rtrim(@ColumnName) + '!element]'   if (len(@SQLStatement) + len(@SQLStatement12) >= 7998) or (@SQLStatement2 <> '')  begin  if (len(@SQLStatement2) + len(@SQLStatement12) >= 7998) or (@SQLStatement11 <> '')  begin  if (len(@SQLStatement11) + len(@SQLStatement12) >= 7998) or (@SQLStatement13 <> '')  begin  select @SQLStatement13 = @SQLStatement13 + @SQLStatement12  if (@x < @DATACNT) or (@TagNumber < (@TableCount+1))  begin  select @SQLStatement13 = @SQLStatement13 + ',' + CHAR(10)  end  end  else  begin  select @SQLStatement11 = @SQLStatement11 + @SQLStatement12  if (@x < @DATACNT) or (@TagNumber < (@TableCount+1))  begin  select @SQLStatement11 = @SQLStatement11 + ',' + CHAR(10)  end  end  end  else  begin  select @SQLStatement2 = @SQLStatement2 + @SQLStatement12  if (@x < @DATACNT) or (@TagNumber < (@TableCount+1))  begin  select @SQLStatement2 = @SQLStatement2 + ',' + CHAR(10)  end  end  end  else  begin  select @SQLStatement = @SQLStatement + @SQLStatement12  if (@x < @DATACNT) or (@TagNumber < (@TableCount+1))  begin  select @SQLStatement = @SQLStatement + ',' + CHAR(10)  end  end   select @xtype = xtype from syscolumns (nolock) where name = rtrim(@ColumnName) and id in (select id from sysobjects (nolock) where name = @TABLENAME)   if len(@XMLData) > 7500  begin  select @XMLData2 =@XMLData  select @XMLData = ''  end   if @xtype = 173   begin  select @XMLData = @XMLData + '[' + @Alias + '].' + rtrim(@ColumnName)  end  else if (@xtype = 99) or (@xtype = 35)    begin  select @XMLData = @XMLData + '[' + @Alias + '].' + rtrim(@ColumnName)  end  else if (@xtype = 61)    begin  select @XMLData = @XMLData + '[' + @Alias + '].' + rtrim(@ColumnName)  end  else  begin  select @XMLData = @XMLData + 'RTRIM(['+@Alias + '].' + rtrim(@ColumnName)  +')'  end   select @XMLIndex2 = @XMLIndex2 + 'NULL,'   if (@x < @DATACNT) or (@TagNumber < (@TableCount+1))  begin  select @XMLData = @XMLData + ','   end   select @x = @x + 1  truncate table #Column  exec('insert into #Column select DATA' + @x + ' from eConnect_Out_Setup (nolock) where DOCTYPE = ''' + @I_vDOCTYPE + ''' and MAIN = ' + @TagNumber + ' - 1')  select @ColumnName = ColumnName from #Column  end   if  (@I_vOUTPUTTYPE = 2)  begin  select @Y = 0  select @Y = sum(INDEXCNT + DATACNT) FROM eConnect_Out_Setup (nolock) where DOCTYPE = @I_vDOCTYPE and MAIN > (@TagNumber-1)   while (@Y > 0)   begin   if len(@XMLData) > 7500  begin  select @XMLData2 =@XMLData  select @XMLData = ''  end   select @XMLData = @XMLData + 'NULL'   select @Y = @Y -1  if @Y > 0  select @XMLData = @XMLData + ','  end  end  select @SQLStatement5 = @SQLStatement5 + @XMLIndex + @XMLData2 + @XMLData + @SQLFrom + @SQLJoin + @SQLJoin1 + @SQLWhere   select @TagNumber = @TagNumber + 1   if (len(@SQLStatement3) + len(@SQLStatement5)) < 8000 and (@SQLStatement4 = '')  begin  select @SQLStatement3 = @SQLStatement3 + @SQLStatement5  end  else  begin  if (len(@SQLStatement4) + len(@SQLStatement5)) < 8000 and (@SQLStatement6 = '')  begin  select @SQLStatement4 = @SQLStatement4 + @SQLStatement5  end  else  begin  if (len(@SQLStatement6) + len(@SQLStatement5)) < 8000 and (@SQLStatement7 = '')  begin  select @SQLStatement6 = @SQLStatement6 + @SQLStatement5  end  else  begin  if (len(@SQLStatement7) + len(@SQLStatement5)) < 8000 and (@SQLStatement8 = '')  begin  select @SQLStatement7 = @SQLStatement7 + @SQLStatement5  end  else  begin  if (len(@SQLStatement8) + len(@SQLStatement5)) < 8000 and (@SQLStatement9 = '')  begin  select @SQLStatement8 = @SQLStatement8 + @SQLStatement5  end  else  begin  if (len(@SQLStatement9) + len(@SQLStatement5)) < 8000 and (@SQLStatement10 = '')  begin  select @SQLStatement9 = @SQLStatement9 + @SQLStatement5  end  else  begin  if (len(@SQLStatement10) + len(@SQLStatement5)) < 8000 and (@SQLStatement1 = '')  begin  select @SQLStatement10 = @SQLStatement10 + @SQLStatement5  end  else  begin  if (len(@SQLStatement1) + len(@SQLStatement5)) < 8000 and (@SQLStatement15 = '')  begin  select @SQLStatement1 = @SQLStatement1 + @SQLStatement5  end  else  begin  if (len(@SQLStatement15) + len(@SQLStatement5)) < 8000 and (@SQLStatement16 = '')  begin  select @SQLStatement15 = @SQLStatement15 + @SQLStatement5  end  else  begin  if (len(@SQLStatement16) + len(@SQLStatement5)) < 8000 and (@SQLStatement17 = '')  begin  select @SQLStatement16 = @SQLStatement16 + @SQLStatement5  end  else  begin  if (len(@SQLStatement17) + len(@SQLStatement5)) < 8000 and (@SQLStatement18 = '')  begin  select @SQLStatement17 = @SQLStatement17 + @SQLStatement5  end  else  begin  if (len(@SQLStatement18) + len(@SQLStatement5)) < 8000 and (@SQLStatement19 = '')  begin  select @SQLStatement18 = @SQLStatement18 + @SQLStatement5  end  else  begin  if (len(@SQLStatement19) + len(@SQLStatement5)) < 8000 and (@SQLStatement20 = '')  begin  select @SQLStatement19 = @SQLStatement19 + @SQLStatement5  end  else  begin  if (len(@SQLStatement20) + len(@SQLStatement5)) < 8000 and (@SQLStatement21 = '')  begin  select @SQLStatement20 = @SQLStatement20 + @SQLStatement5  end  else  begin  if (len(@SQLStatement21) + len(@SQLStatement5)) < 8000 and (@SQLStatement22 = '')  begin  select @SQLStatement21 = @SQLStatement21 + @SQLStatement5  end  else  begin  if (len(@SQLStatement22) + len(@SQLStatement5)) < 8000 and (@SQLStatement23 = '')  begin  select @SQLStatement22 = @SQLStatement22 + @SQLStatement5  end  else  begin  if (len(@SQLStatement23) + len(@SQLStatement5)) < 8000 and (@SQLStatement24 = '')  begin  select @SQLStatement23 = @SQLStatement23 + @SQLStatement5  end  else  begin  if (len(@SQLStatement24) + len(@SQLStatement5)) < 8000 and (@SQLStatement25 = '')  begin  select @SQLStatement24 = @SQLStatement24 + @SQLStatement5  end  else  begin  if (len(@SQLStatement25) + len(@SQLStatement5)) < 8000 and (@SQLStatement26 = '')  begin  select @SQLStatement25 = @SQLStatement25 + @SQLStatement5  end  else  begin  select @SQLStatement26 = @SQLStatement26 + @SQLStatement5  end  end  end  end  end  end  end  end  end  end  end  end  end  end  end  end  end  end  end  end  select @SQLOrder = @SQLOrder + @SQLOrder2 + 'Tag,Parent'   exec (@sqlproctext1 + @sqlproctext2 + @sqlproctext3 + @sqlproctext3b + @sqlproctext4 + @sqlproctext5+  @SQLStatement+@SQLStatement2+ @SQLStatement11+@SQLStatement13+@SQLFrom+@SQLWhere+  @SQLStatement1+@SQLStatement3+ @SQLStatement4+ @SQLStatement6+ @SQLStatement7+ @SQLStatement8+ @SQLStatement9+@SQLStatement10+@SQLStatement15+  @SQLStatement16+@SQLStatement17+@SQLStatement18+@SQLStatement19+@SQLStatement20+@SQLStatement21+@SQLStatement22+@SQLStatement23+  @SQLStatement24+@SQLStatement25+@SQLStatement26+  @SQLOrder + ' FOR XML EXPLICIT, BINARY BASE64')   end  set ROWCOUNT 0  drop table #Column drop table #PL  select @O_iErrorState = 0 return    
GO
GRANT EXECUTE ON  [dbo].[eConnectOutCreateProc] TO [DYNGRP]
GO
