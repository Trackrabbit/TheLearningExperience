SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO
 create       procedure [dbo].[aagCreateVoidRecforAABM]  @aaSubLedgerHdrID int as begin  declare @aaSubLedgerDistIDL int,  @aaSubLedgerDistID int,  @SEQNUMBR int   select @aaSubLedgerDistIDL = 0,  @aaSubLedgerDistID = 0,  @SEQNUMBR  = 0   select @aaSubLedgerDistIDL = isnull(max(aaSubLedgerDistID),0)   from AAG20001  where aaSubLedgerHdrID = @aaSubLedgerHdrID   and POSTED = 1  select @SEQNUMBR = isnull(max(SEQNUMBR),0)   from AAG20001  where aaSubLedgerHdrID = @aaSubLedgerHdrID   and POSTED = 1   declare CVDIST cursor for  select aaSubLedgerDistID  from  AAG20001  where aaSubLedgerHdrID = @aaSubLedgerHdrID and  aaSubLedgerDistID < @aaSubLedgerDistIDL + 1  order by aaSubLedgerDistID  open CVDIST  fetch next from CVDIST into  @aaSubLedgerDistID  while @@fetch_status = 0  begin  select @aaSubLedgerDistIDL = @aaSubLedgerDistIDL + 1  select @SEQNUMBR = @SEQNUMBR + 16384   insert into AAG20001   (aaSubLedgerHdrID,aaSubLedgerDistID,INTERID,CorrespondingUnit,ACTINDX,DISTTYPE,   ACCTTYPE,aaBrowseType,DECPLACS,DEBITAMT,CRDTAMNT,ORDBTAMT,ORCRDAMT,CURNCYID,CURRNIDX,   RATETPID,EXGTBLID,XCHGRATE,EXCHDATE,TIME1,RTCLCMTD,DENXRATE,MCTRXSTT,SEQNUMBR,GLPOSTDT,   aaCustID,aaVendID,aaSiteID,aaItemID,aaCopyStatus,aaWinWasOpen,POSTED,HISTORY,aaDistErrors,   APTVCHNM,APTODCTY,aaFutureDist,aaOffsetAcct,ITEMNMBR,TRXLOCTN,BINNMBR,TRNSTLOC,TRXQTY  ,aaChangeDate,aaChangeTime)   select aaSubLedgerHdrID,@aaSubLedgerDistIDL,INTERID,CorrespondingUnit,ACTINDX,DISTTYPE,   ACCTTYPE,aaBrowseType,DECPLACS,CRDTAMNT,DEBITAMT,ORCRDAMT,ORDBTAMT,CURNCYID,CURRNIDX,   RATETPID,EXGTBLID,XCHGRATE,EXCHDATE,TIME1,RTCLCMTD,DENXRATE,MCTRXSTT,@SEQNUMBR,GLPOSTDT,   aaCustID,aaVendID,aaSiteID,aaItemID,aaCopyStatus,aaWinWasOpen,0,HISTORY,aaDistErrors,   APTVCHNM,APTODCTY,aaFutureDist,aaOffsetAcct,ITEMNMBR,TRXLOCTN,BINNMBR,TRNSTLOC,TRXQTY,  convert(char(12), getdate(), 102), convert(char(12), getdate(), 108)  from AAG20001 where aaSubLedgerHdrID = @aaSubLedgerHdrID and aaSubLedgerDistID = @aaSubLedgerDistID  insert into AAG20002   (aaSubLedgerHdrID,aaSubLedgerDistID,aaSubLedgerAssignID,DEBITAMT,CRDTAMNT,ORDBTAMT,ORCRDAMT,   aaAssignedPercent,DistRef,NOTEINDX,aaAssignErrors,aaAliasID)   select aaSubLedgerHdrID,@aaSubLedgerDistIDL,aaSubLedgerAssignID,CRDTAMNT,DEBITAMT,ORCRDAMT,ORDBTAMT,   aaAssignedPercent,DistRef,NOTEINDX,aaAssignErrors,aaAliasID from AAG20002   where aaSubLedgerHdrID = @aaSubLedgerHdrID and aaSubLedgerDistID = @aaSubLedgerDistID and  aaSubLedgerAssignID > 0   insert into AAG20003   (aaSubLedgerHdrID,aaSubLedgerDistID,aaSubLedgerAssignID,aaTrxDimID,aaTrxCodeID,aaCodeErrors)   select aaSubLedgerHdrID,@aaSubLedgerDistIDL,aaSubLedgerAssignID,aaTrxDimID,aaTrxCodeID,aaCodeErrors   from AAG20003 where aaSubLedgerHdrID = @aaSubLedgerHdrID and aaSubLedgerDistID = @aaSubLedgerDistID  and aaSubLedgerAssignID > 0 and aaTrxDimID > 0   fetch next from CVDIST into  @aaSubLedgerDistID  end  close CVDIST  deallocate CVDIST end    
GO
GRANT EXECUTE ON  [dbo].[aagCreateVoidRecforAABM] TO [DYNGRP]
GO
