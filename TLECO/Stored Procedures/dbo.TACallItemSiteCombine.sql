SET QUOTED_IDENTIFIER OFF
GO
SET ANSI_NULLS ON
GO
create procedure [dbo].[TACallItemSiteCombine] @I_charStartSite char(30),  @I_charEndSite char(30),  @O_iErrorState int = NULL output with encryption as set transaction isolation level read uncommitted set nocount on declare  @iStatus int, @iError int,  @tTransaction tinyint, @tLoop tinyint select @O_iErrorState = 0 if @@trancount = 0    begin select @tTransaction = 1 begin transaction end while ( @tLoop is NULL ) begin select @tLoop = 1 if exists (select * from sysobjects where id = object_id('dbo.mfg_update_location_update')) alter table IV00101 disable trigger mfg_update_location_update if @@error <> 0 begin select @O_iErrorState = 2	 break end if exists (select * from sysobjects where id = object_id('dbo.tr_SVC_Item_Site_Ext_U')) alter table IV00102 disable trigger tr_SVC_Item_Site_Ext_U if @@error <> 0 begin select @O_iErrorState = 3	 break end if exists (select * from sysobjects where id = object_id('dbo.tr_SVC_IV00102_D')) alter table IV00102 disable trigger tr_SVC_IV00102_D if @@error <> 0 begin select @O_iErrorState = 4	 break end if exists (select * from sysobjects where id = object_id('dbo.tr_SVC_IV00102_U')) alter table IV00102 disable trigger tr_SVC_IV00102_U if @@error <> 0 begin select @O_iErrorState = 5	 break end exec @iStatus = smSiteCombine1 @I_charStartSite, @I_charEndSite, @O_iErrorState output select @iError = @@error if @iStatus = 0 and @iError <> 0 select @iStatus = @iError if (@iStatus <> 0) or (@O_iErrorState <> 0) begin select @O_iErrorState = 65 break end end  if exists (select * from sysobjects where id = object_id('dbo.mfg_update_location_update')) alter table IV00101 enable trigger mfg_update_location_update if @@error <> 0 begin select @O_iErrorState = 61	 end if exists (select * from sysobjects where id = object_id('dbo.tr_SVC_Item_Site_Ext_U')) alter table IV00102 enable trigger tr_SVC_Item_Site_Ext_U if @@error <> 0 begin select @O_iErrorState = 62	 end if exists (select * from sysobjects where id = object_id('dbo.tr_SVC_IV00102_D')) alter table IV00102 enable trigger tr_SVC_IV00102_D if @@error <> 0 begin select @O_iErrorState = 63	 end if exists (select * from sysobjects where id = object_id('dbo.tr_SVC_IV00102_U')) alter table IV00102 enable trigger tr_SVC_IV00102_U if @@error <> 0 begin select @O_iErrorState = 64	 end if @O_iErrorState <> 0 begin if @tTransaction = 1 rollback transaction end else if @tTransaction = 1 begin commit transaction end return  
GO
GRANT EXECUTE ON  [dbo].[TACallItemSiteCombine] TO [DYNGRP]
GO
