SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO
 CREATE procedure [dbo].[ICglTotalDebitsAndCredits]  @I_CID  varchar(10),  @I_tOpenOrHistory integer  = NULL,  @I_sHistoryYearStart smallint = NULL,  @I_sHistoryYearEnd smallint =  NULL,  @I_iJournalEntry int  = NULL,  @O_mDebitTotal numeric(19,5) = NULL output,  @O_mCreditTotal numeric(19,5) = NULL output,  @I_sPOST_ACCT smallint = NULL,  @I_sPOST_ALLOC_ACCT smallint = NULL,  @I_iSQLSessionID int  = NULL,  @I_sViewMode smallint = NULL,  @I_sRateCalcMethod smallint = NULL,  @I_nExchangeRate numeric(15,7) =  NULL,  @I_sRptDecPlaces smallint = NULL,  @I_mStartRange numeric(19,5) = NULL output,  @I_mEndRange numeric(19,5) = NULL output,  @I_sTrxSrc VARCHAR(15) = NULL, @O_iErrorState int  = NULL output  as   Begin declare @TrxType tinyint, @ProcName varchar(50), @l_cmdNExec NVARCHAR(4000), @l_ParmDefinition NVARCHAR(500)  select  @I_mStartRange  = 0 ,  @I_mEndRange  = 0 , @TrxType = @I_tOpenOrHistory   if @I_sTrxSrc <> '' BEGIN  SELECT @l_cmdNExec = N''   if @TrxType = 1  BEGIN  SELECT @l_cmdNExec = N'SELECT @MaxRECTRX = ISNULL(RCTRXSEQ,0) FROM [' + RTRIM(@I_CID) + ']..GL20000 WHERE JRNENTRY =' + CAST(@I_iJournalEntry as VARCHAR(20)) + ' AND TRXSORCE =''' + @I_sTrxSrc +''''  END  else if @TrxType = 2  BEGIN  SELECT @l_cmdNExec = N'SELECT @MaxRECTRX = ISNULL(RCTRXSEQ,0) FROM [' + RTRIM(@I_CID) + ']..GL30000 WHERE JRNENTRY =' + CAST(@I_iJournalEntry as VARCHAR(20)) + ' AND TRXSORCE =''' + @I_sTrxSrc +''''  END  else if @TrxType = 3  BEGIN  SELECT @l_cmdNExec = N'SELECT @MaxRECTRX = ISNULL(RCTRXSEQ,0) FROM [' + RTRIM(@I_CID) + ']..GL10000 WHERE JRNENTRY =' + CAST(@I_iJournalEntry as VARCHAR(20)) + ' AND TRXSORCE =''' + @I_sTrxSrc +''''  END  set @l_ParmDefinition = N'@MaxRECTRX numeric(19,5) output'   execute sp_executesql @l_cmdNExec,  @l_ParmDefinition,  @MaxRECTRX = @I_mStartRange OUTPUT   SELECT @I_mEndRange = @I_mStartRange END  SELECT @ProcName = @I_CID + '..glTotalDebitsAndCredits' exec @ProcName @TrxType  ,  @I_sHistoryYearStart ,  @I_sHistoryYearEnd,  @I_iJournalEntry ,  @O_mDebitTotal  output,  @O_mCreditTotal  output,  @I_sPOST_ACCT ,  @I_sPOST_ALLOC_ACCT ,  @I_iSQLSessionID ,  @I_sViewMode ,  @I_sRateCalcMethod ,  @I_nExchangeRate ,  @I_sRptDecPlaces ,  @I_mStartRange output,  @I_mEndRange  output,  @O_iErrorState output  return  End   
GO
GRANT EXECUTE ON  [dbo].[ICglTotalDebitsAndCredits] TO [DYNGRP]
GO
