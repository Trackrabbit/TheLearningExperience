SET QUOTED_IDENTIFIER OFF
GO
SET ANSI_NULLS ON
GO
 create procedure [dbo].[taDeleteEmployee]  @I_vEMPLOYID char(15),    @I_vRequesterTrx smallint = 0,   @I_vUSRDEFND1 char(50) = '',       @I_vUSRDEFND2 char(50) = '',       @I_vUSRDEFND3 char(50) = '',       @I_vUSRDEFND4 varchar(8000) = '',  @I_vUSRDEFND5 varchar(8000) = '',  @O_iErrorState int output, @oErrString varchar(255) output  with encryption as  set transaction isolation level read uncommitted set nocount on  declare   @sCompanyID int,   @iStatus int,  @iAddCodeErrState int,  @iCustomState int,  @iError int,  @O_oErrorState int,  @iEmployeerString varchar(255)  select @O_iErrorState = 0,  @iStatus = 0,  @iCustomState = 0,  @iError = 0,  @O_oErrorState = 0,  @iEmployeerString = ''  if (@oErrString is NULL) begin  select @oErrString = '' end  exec @iStatus = taDeleteEmployeePre  @I_vEMPLOYID output,  @I_vRequesterTrx output,  @I_vUSRDEFND1 output,  @I_vUSRDEFND2 output,  @I_vUSRDEFND3 output,  @I_vUSRDEFND4 output,  @I_vUSRDEFND5 output,  @O_iErrorState  = @iCustomState output,  @oErrString = @iEmployeerString output  select @iError = @@error if ((@iStatus <> 0) or (@iCustomState <> 0) or (@iError <> 0)) begin  select @O_iErrorState = 9245    exec @iStatus = taUpdateString  @O_iErrorState,  @iEmployeerString,  @oErrString output,  @O_oErrorState output  return (@O_iErrorState) end  select @sCompanyID = CMPANYID from DYNAMICS..SY01500 where INTERID = db_name()  if ( @I_vEMPLOYID is NULL ) begin  select @O_iErrorState = 9246    exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @iAddCodeErrState output  return (@O_iErrorState) end  if ( @I_vEMPLOYID = '' ) begin  select @O_iErrorState = 9247    exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @iAddCodeErrState output  return (@O_iErrorState) end  select @I_vEMPLOYID = UPPER(@I_vEMPLOYID)  if (@I_vEMPLOYID <> '') begin  if not exists(select 1 from UPR00100 (nolock) where EMPLOYID = @I_vEMPLOYID)  begin   select @O_iErrorState = 9248    exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @iAddCodeErrState output  end end  if ( @I_vRequesterTrx < 0 or @I_vRequesterTrx > 1 ) begin  select @O_iErrorState = 9249     exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @iAddCodeErrState output end  if exists(select 1 from UPR10202 (nolock) where EMPLOYID = @I_vEMPLOYID) begin  select @O_iErrorState = 9250    exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @iAddCodeErrState output  return (@O_iErrorState) end  if exists(select 1 from UPR10302 (nolock) where EMPLOYID = @I_vEMPLOYID) begin  select @O_iErrorState = 9251    exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @iAddCodeErrState output  return (@O_iErrorState) end  if exists(select 1 from UPR10307 (nolock) where EMPLOYID = @I_vEMPLOYID) begin  select @O_iErrorState = 9252    exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @iAddCodeErrState output  return (@O_iErrorState) end  if exists(select 1 from UPR30300 (nolock) where EMPLOYID = @I_vEMPLOYID) begin  select @O_iErrorState = 9253    exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @iAddCodeErrState output  return (@O_iErrorState) end  update DYNAMICS..UPR41600 set Count1 = Count1 - 1 where CMPANYID = @sCompanyID  if (@I_vRequesterTrx=0) begin  exec @iStatus = eConnectOutVerify  @I_vDOCTYPE='Employee',  @I_vINDEX1=@I_vEMPLOYID,  @I_vINDEX2='',  @I_vINDEX3='',  @I_vINDEX4='',  @I_vINDEX5='',  @I_vINDEX6='',  @I_vINDEX7='',  @I_vINDEX8='',  @I_vINDEX9='',  @I_vINDEX10='',  @I_vINDEX11='',  @I_vINDEX12='',  @I_vINDEX13='',  @I_vINDEX14='',  @I_vINDEX15='',  @I_vDelete = 0,  @O_iErrorState = @iCustomState output  select @iError = @@error  if @iStatus = 0 and @iError <> 0  begin  select @iStatus = @iError  end  if (@iStatus <> 0) or (@iCustomState <> 0)  begin  select @O_iErrorState = 9254    exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output  return (@O_iErrorState)   end end  delete UPR00100 where EMPLOYID = @I_vEMPLOYID if @@error <> 0  begin  select @O_iErrorState = 9255    exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @iAddCodeErrState output  return (@O_iErrorState) end  delete UPR00102 where EMPLOYID = @I_vEMPLOYID if @@error <> 0  begin  select @O_iErrorState = 9256    exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @iAddCodeErrState output  return (@O_iErrorState) end  delete DD00100 where EMPLOYID = @I_vEMPLOYID if @@error <> 0  begin  select @O_iErrorState = 9257    exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @iAddCodeErrState output  return (@O_iErrorState) end  delete DD00200 where EMPLOYID = @I_vEMPLOYID if @@error <> 0  begin  select @O_iErrorState = 9258    exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @iAddCodeErrState output  return (@O_iErrorState) end  delete SY01200 where Master_ID = @I_vEMPLOYID and Master_Type = 'EMP' if @@error <> 0  begin  select @O_iErrorState = 9259    exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @iAddCodeErrState output  return (@O_iErrorState) end  delete UPR00111 where EMPLOYID = @I_vEMPLOYID if @@error <> 0  begin  select @O_iErrorState = 9260    exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @iAddCodeErrState output  return (@O_iErrorState) end  delete UPR00112 where EMPLOYID = @I_vEMPLOYID if @@error <> 0  begin  select @O_iErrorState = 9261    exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @iAddCodeErrState output  return (@O_iErrorState) end  delete UPR00113 where EMPLOYID = @I_vEMPLOYID if @@error <> 0  begin  select @O_iErrorState = 9262    exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @iAddCodeErrState output  return (@O_iErrorState) end  delete UPR00300 where EMPLOYID = @I_vEMPLOYID if @@error <> 0  begin  select @O_iErrorState = 9263    exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @iAddCodeErrState output  return (@O_iErrorState) end  delete UPR00400 where EMPLOYID = @I_vEMPLOYID if @@error <> 0  begin  select @O_iErrorState = 9264    exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @iAddCodeErrState output  return (@O_iErrorState) end  delete UPR00402 where EMPLOYID = @I_vEMPLOYID if @@error <> 0  begin  select @O_iErrorState = 9265    exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @iAddCodeErrState output  return (@O_iErrorState) end  delete UPR00500 where EMPLOYID = @I_vEMPLOYID if @@error <> 0  begin  select @O_iErrorState = 9266    exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @iAddCodeErrState output  return (@O_iErrorState) end  delete UPR00501 where EMPLOYID = @I_vEMPLOYID if @@error <> 0  begin  select @O_iErrorState = 9267    exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @iAddCodeErrState output  return (@O_iErrorState) end  delete UPR00600 where EMPLOYID = @I_vEMPLOYID if @@error <> 0  begin  select @O_iErrorState = 9268    exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @iAddCodeErrState output  return (@O_iErrorState) end  delete UPR00601 where EMPLOYID = @I_vEMPLOYID if @@error <> 0  begin  select @O_iErrorState = 9269    exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @iAddCodeErrState output  return (@O_iErrorState) end  delete UPR00700 where EMPLOYID = @I_vEMPLOYID if @@error <> 0  begin  select @O_iErrorState = 9270    exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @iAddCodeErrState output  return (@O_iErrorState) end  delete UPR00800 where EMPLOYID = @I_vEMPLOYID if @@error <> 0  begin  select @O_iErrorState = 9271    exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @iAddCodeErrState output  return (@O_iErrorState) end  delete UPR00900 where EMPLOYID = @I_vEMPLOYID if @@error <> 0  begin  select @O_iErrorState = 9272    exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @iAddCodeErrState output  return (@O_iErrorState) end  delete UPR00901 where EMPLOYID = @I_vEMPLOYID if @@error <> 0  begin  select @O_iErrorState = 9273    exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @iAddCodeErrState output  return (@O_iErrorState) end  exec @iStatus = taDeleteEmployeePost  @I_vEMPLOYID,  @I_vRequesterTrx,  @I_vUSRDEFND1,  @I_vUSRDEFND2,  @I_vUSRDEFND3,  @I_vUSRDEFND4,  @I_vUSRDEFND5,  @O_iErrorState  = @iCustomState output,  @oErrString = @iEmployeerString output  select @iError = @@error if ((@iStatus <> 0) or (@iCustomState <> 0) or (@iError <> 0)) begin  select @O_iErrorState = 9274    exec @iStatus = taUpdateString  @O_iErrorState,  @iEmployeerString,  @oErrString output,  @O_oErrorState output  return (@O_iErrorState) end  if (@I_vRequesterTrx=0) begin  exec @iStatus = eConnectOutVerify  @I_vDOCTYPE='Employee',  @I_vINDEX1=@I_vEMPLOYID,  @I_vINDEX2='',  @I_vINDEX3='',  @I_vINDEX4='',  @I_vINDEX5='',  @I_vINDEX6='',  @I_vINDEX7='',  @I_vINDEX8='',  @I_vINDEX9='',  @I_vINDEX10='',  @I_vINDEX11='',  @I_vINDEX12='',  @I_vINDEX13='',  @I_vINDEX14='',  @I_vINDEX15='',  @I_vDelete = 1,  @O_iErrorState = @iCustomState output  select @iError = @@error  if @iStatus = 0 and @iError <> 0  begin  select @iStatus = @iError  end  if (@iStatus <> 0) or (@iCustomState <> 0)  begin  select @O_iErrorState = 9275    exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output  return (@O_iErrorState)   end end  return (@O_iErrorState)   
GO
GRANT EXECUTE ON  [dbo].[taDeleteEmployee] TO [DYNGRP]
GO
