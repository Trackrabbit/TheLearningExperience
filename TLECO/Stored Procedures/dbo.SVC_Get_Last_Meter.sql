SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO
 CREATE PROCEDURE [dbo].[SVC_Get_Last_Meter]  (@Equipid integer,  @Meter integer,  @MeterReading integer OUTPUT,  @DailyUsage numeric(19,5) OUTPUT,  @LastPostDate datetime OUTPUT) AS declare @IDENT integer if @Meter = 1 BEGIN  select @IDENT = MAX(IsNull(DEX_ROW_ID,0)) from SVC00301 where EQUIPID = @Equipid and Meters_1 <> 0  select @DailyUsage = IsNull(Dailys_1,0), @MeterReading = IsNull(Meters_1,0),  @LastPostDate = LSTDTEDT from SVC00301 where DEX_ROW_ID = @IDENT  select @DailyUsage = IsNull(Dailys_1,0) from SVC00300 where EQUIPID = @Equipid END else if @Meter = 2 BEGIN select @IDENT = MAX(IsNull(DEX_ROW_ID,0)) from SVC00301 where EQUIPID =@Equipid and Meters_2 <> 0 select @DailyUsage = IsNull(Dailys_2,0), @MeterReading = IsNull(Meters_2,0),  @LastPostDate = LSTDTEDT from SVC00301 where DEX_ROW_ID = @IDENT  select @DailyUsage = IsNull(Dailys_2,0) from SVC00300 where EQUIPID = @Equipid END else if @Meter = 3 BEGIN select @IDENT = MAX(IsNull(DEX_ROW_ID,0)) from SVC00301 where EQUIPID = @Equipid and Meters_3 <> 0 select @DailyUsage = IsNull(Dailys_3,0), @MeterReading = IsNull(Meters_3,0),  @LastPostDate = LSTDTEDT from SVC00301 where DEX_ROW_ID = @IDENT  select @DailyUsage = IsNull(Dailys_3,0) from SVC00300 where EQUIPID = @Equipid END else if @Meter = 4 BEGIN select @IDENT = MAX(IsNull(DEX_ROW_ID,0)) from SVC00301 where EQUIPID = @Equipid and Meters_4 <> 0 select @DailyUsage = IsNull(Dailys_4,0), @MeterReading = IsNull(Meters_4,0),  @LastPostDate = LSTDTEDT from SVC00301 where DEX_ROW_ID = @IDENT  select @DailyUsage = IsNull(Dailys_4,0) from SVC00300 where EQUIPID = @Equipid END else if @Meter = 5 BEGIN select @IDENT = MAX(IsNull(DEX_ROW_ID,0)) from SVC00301 where EQUIPID = @Equipid and Meters_5 <> 0 select @DailyUsage = IsNull(Dailys_5,0), @MeterReading = IsNull(Meters_5,0),  @LastPostDate = LSTDTEDT from SVC00301 where DEX_ROW_ID = @IDENT  select @DailyUsage = IsNull(Dailys_5,0) from SVC00300 where EQUIPID = @Equipid END    
GO
GRANT EXECUTE ON  [dbo].[SVC_Get_Last_Meter] TO [DYNGRP]
GO
