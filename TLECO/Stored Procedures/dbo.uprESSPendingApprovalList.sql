SET QUOTED_IDENTIFIER OFF
GO
SET ANSI_NULLS ON
GO
create procedure [dbo].[uprESSPendingApprovalList]  @I_vTableName varchar(27) = NULL,  @O_iErrorState int = NULL output  as  declare @iStatus int,  @iError int,  @SqlStmt VARCHAR(2000)  select @iStatus = 0, @SqlStmt = ''  if exists (select * from dbo.sysobjects where id = object_id(N'[dbo].[HR30100]') and OBJECTPROPERTY(id, N'IsUserTable') = 1) BEGIN SET @SqlStmt = ' UNION ALL  SELECT UP1.EMPLOYID Master_ID, UP1.CREATDDT DOCDATE, UP1.EMPLOYID, UP.LASTNAME, UP.FRSTNAME, '''' SUPERVISORCODE_I, '''' Pay_Schedule, 0 YEAR1,0 PERIODID,UP1.CREATETIME, 0 SEQNUMBR ,0 MKTOPROC,0 InfoValue,  UP1.Workflow_Status,'''' Workflow_Name,'''' Workflow_Originator,'''' WorkflowInstanceID,'''' WorkflowStepInstanceID,'''' Workflow_Step_Type,''Employee Skills Approval'' Workflow_Type_Name,'''' Workflow_Step_Name,UP1.CREATDDT Workflow_Due_Date,'''' Workflow_Due_Time,'''' Workflow_Approver,0 Group_ID, '''' LVLLABEL, '''' Supervisor_Employee_ID FROM HR30100 UP1  INNER JOIN UPR00100 UP ON UP.EMPLOYID = UP1.EMPLOYID  AND UP1.Workflow_Status = 4 ' END  exec  ('insert '+ @I_vTableName + '   (  CMRECNUM,Master_ID,DOCDATE,EMPLOYID,LASTNAME,FRSTNAME,SUPERVISOR,Pay_Schedule,YEAR1,PERIODID,CREATETIME,SEQNUMBR,MKTOPROC,  InfoValue,Workflow_Status,Workflow_Name,Workflow_Originator,WorkflowInstanceID,WorkflowStepInstanceID,Workflow_Step_Type,  Workflow_Type_Name,Workflow_Step_Name,Workflow_Due_Date,Workflow_Due_Time,Workflow_Approver,Group_ID,LVLLABEL,Supervisor_Employee_ID  )  SELECT ROW_NUMBER() OVER(Partition by 1 order by a.Master_ID ) CMRECNUM,* FROM   (  SELECT UP1.EMPLOYID Master_ID, UP1.CREATDDT DOCDATE, UP1.EMPLOYID, UP2.LASTNAME, UP2.FRSTNAME, UP.SUPERVISORCODE_I,'''' Pay_Schedule,0 YEAR1,0 PERIODID,UP1.CREATETIME,0 SEQNUMBR,0 MKTOPROC,0 InfoValue,  UP1.Workflow_Status,'''' Workflow_Name,'''' Workflow_Originator,'''' WorkflowInstanceID,'''' WorkflowStepInstanceID,'''' Workflow_Step_Type,''Employee Profile Approval'' Workflow_Type_Name,'''' Workflow_Step_Name,UP1.CREATDDT Workflow_Due_Date,'''' Workflow_Due_Time,'''' Workflow_Approver, 0 Group_ID, '''' LVLLABEL,'''' Supervisor_Employee_ID FROM UPR30600 UP1  INNER JOIN UPR30601 UP2 ON UP1.EMPLOYID = UP2.EMPLOYID  INNER JOIN UPR00100 UP ON UP.EMPLOYID = UP1.EMPLOYID  AND UP1.Workflow_Status = 4   UNION ALL    SELECT ''Timecard'' Master_ID, UP1.STRTDATE DOCDATE, UP1.EMPLOYID, UP1.LASTNAME, UP1.FRSTNAME, UP1.SUPERVISORCODE_I,Pay_Schedule,YEAR1,PERIODID,'''' CREATETIME,0 SEQNUMBR,0 MKTOPROC,0 InfoValue,  UP1.Workflow_Status,'''' Workflow_Name,'''' Workflow_Originator,'''' WorkflowInstanceID,'''' WorkflowStepInstanceID,'''' Workflow_Step_Type,''Payroll Timecard Approval'' Workflow_Type_Name,'''' Workflow_Step_Name,UP1.STRTDATE Workflow_Due_Date,'''' Workflow_Due_Time,'''' Workflow_Approver,0 Group_ID, '''' LVLLABEL,'''' Supervisor_Employee_ID FROM [EmployeeTimecardPending] UP1    UNION ALL    SELECT ''W4'' Master_ID, UP1.CREATDDT DOCDATE, UP1.EMPLOYID, UP.LASTNAME, UP.FRSTNAME, '''' SUPERVISORCODE_I, '''' Pay_Schedule, 0 YEAR1,0 PERIODID,'''' CREATETIME, UP1.SEQNUMBR,0 MKTOPROC,0 InfoValue,  UP1.Workflow_Status,'''' Workflow_Name,'''' Workflow_Originator,'''' WorkflowInstanceID,'''' WorkflowStepInstanceID,'''' Workflow_Step_Type,''Payroll W4 Approval'' Workflow_Type_Name,'''' Workflow_Step_Name,UP1.CREATDDT Workflow_Due_Date,'''' Workflow_Due_Time,'''' Workflow_Approver,0 Group_ID, '''' LVLLABEL,'''' Supervisor_Employee_ID FROM UPR30604 UP1  INNER JOIN UPR00100 UP ON UP.EMPLOYID = UP1.EMPLOYID  AND UP1.Workflow_Status = 4   UNION ALL    SELECT ''Direct Deposit'' Master_ID, (select top 1 Workflow_Completion_Date from WF30100   where WorkflowInstanceID = (select top 1 WorkflowInstanceID from WFI10002 where Workflow_Type_Name=''Payroll Direct Deposit Approval'' and WfBusObjKey=UP1.EMPLOYID)   and Workflow_Action in (1,2) order by Workflow_Completion_Date desc) DOCDATE, UP1.EMPLOYID, UP.LASTNAME, UP.FRSTNAME, '''' SUPERVISORCODE_I, '''' Pay_Schedule, 0 YEAR1,0 PERIODID,'''' CREATETIME, 0 SEQNUMBR,0 MKTOPROC,0 InfoValue,  UP1.Workflow_Status,'''' Workflow_Name,'''' Workflow_Originator,'''' WorkflowInstanceID,'''' WorkflowStepInstanceID,'''' Workflow_Step_Type,''Payroll Direct Deposit Approval'' Workflow_Type_Name,'''' Workflow_Step_Name,''1900-01-01'' Workflow_Due_Date,'''' Workflow_Due_Time,'''' Workflow_Approver,0 Group_ID, '''' LVLLABEL,'''' Supervisor_Employee_ID FROM DD20100 UP1  INNER JOIN UPR00100 UP ON UP.EMPLOYID = UP1.EMPLOYID  AND UP1.Workflow_Status = 4   ' + @SqlStmt + '  ) a'   )   select @iError = @@error if @iError <> 0  return (@iError)  return(@iStatus)    
GO
GRANT EXECUTE ON  [dbo].[uprESSPendingApprovalList] TO [DYNGRP]
GO
