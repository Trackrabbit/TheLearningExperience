SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO
 CREATE PROCEDURE [dbo].[SVC_RMA_Get_Vendor_Reimburse]   (@VENDORID char(15),  @ITEM char(31),  @RTV_Type char(11),  @CALLNBR char(11),  @PARTAMOUNT numeric(19,2) OUTPUT,  @LABORAMOUNT numeric(19,2) OUTPUT,  @TRAVELAMOUNT numeric(19,2) OUTPUT,  @MISCAMOUNT numeric(19,2) OUTPUT) AS declare @ExpenseAMOUNT numeric(19,2) declare @PartAmount2 numeric(19,2) declare @LaborAmount2 numeric(19,2) declare @TravelAmount2 numeric(19,2) declare @ExpenseDOLLAR char(1) declare @PartDOLLAR char(1) declare @LaborDOLLAR char(1) declare @TravelDOLLAR char(1) declare @ExpenseNTEPRICE numeric(19,2) declare @PartNTEPRICE numeric(19,2) declare @LaborNTEPRICE numeric(19,2) declare @TravelNTEPRICE numeric(19,2) declare @TEMPCALLAMOUNT numeric(19,2)  if exists( select * from SVC05004 where  VENDORID = @VENDORID   and ITEMNMBR = @ITEM and RTV_Type = @RTV_Type)  begin  select   @ExpenseAMOUNT = Reimbursement_Amount_1,   @PartAmount2 = Reimbursement_Amount_2,   @LaborAmount2 = Reimbursement_Amount_3,   @TravelAmount2 = Reimbursement_Amount_4,   @ExpenseDOLLAR = Dollar_Or_Percent_Reimbu_1,      @PartDOLLAR = Dollar_Or_Percent_Reimbu_2,   @LaborDOLLAR = Dollar_Or_Percent_Reimbu_3,   @TravelDOLLAR = Dollar_Or_Percent_Reimbu_4,   @ExpenseNTEPRICE = Reimbursement_NTE_1,  @PartNTEPRICE = Reimbursement_NTE_2,  @LaborNTEPRICE = Reimbursement_NTE_3,  @TravelNTEPRICE = Reimbursement_NTE_4  from SVC05004  where  VENDORID = @VENDORID and  ITEMNMBR = @ITEM and  RTV_Type = @RTV_Type  end else if exists( select * from SVC05004 where  VENDORID = @VENDORID   and ITEMNMBR = @ITEM and RTV_Type = '')  begin  select   @ExpenseAMOUNT = Reimbursement_Amount_1,   @PartAmount2 = Reimbursement_Amount_2,   @LaborAmount2 = Reimbursement_Amount_3,   @TravelAmount2 = Reimbursement_Amount_4,   @ExpenseDOLLAR = Dollar_Or_Percent_Reimbu_1,   @PartDOLLAR = Dollar_Or_Percent_Reimbu_2,   @LaborDOLLAR = Dollar_Or_Percent_Reimbu_3,   @TravelDOLLAR = Dollar_Or_Percent_Reimbu_4,   @ExpenseNTEPRICE = Reimbursement_NTE_1,  @PartNTEPRICE = Reimbursement_NTE_2,  @LaborNTEPRICE = Reimbursement_NTE_3,  @TravelNTEPRICE = Reimbursement_NTE_4  from SVC05004  where  VENDORID = @VENDORID and  ITEMNMBR = @ITEM and  RTV_Type = ''  end else if exists( select * from SVC05004 where  VENDORID = @VENDORID   and ITEMNMBR = '' and RTV_Type = '')  begin  select   @ExpenseAMOUNT = Reimbursement_Amount_1,   @PartAmount2 = Reimbursement_Amount_2,   @LaborAmount2 = Reimbursement_Amount_3,   @TravelAmount2 = Reimbursement_Amount_4,   @ExpenseDOLLAR = Dollar_Or_Percent_Reimbu_1,   @PartDOLLAR = Dollar_Or_Percent_Reimbu_2,   @LaborDOLLAR = Dollar_Or_Percent_Reimbu_3,   @TravelDOLLAR = Dollar_Or_Percent_Reimbu_4,   @ExpenseNTEPRICE = Reimbursement_NTE_1,  @PartNTEPRICE = Reimbursement_NTE_2,  @LaborNTEPRICE = Reimbursement_NTE_3,  @TravelNTEPRICE = Reimbursement_NTE_4  from SVC05004  where  VENDORID = @VENDORID and  ITEMNMBR = '' and  RTV_Type = ''  end else  begin  select   @ExpenseAMOUNT = 0,   @PartAmount2 = 0,   @LaborAmount2 = 0,   @TravelAmount2 = 0,   @ExpenseDOLLAR = 'A',   @PartDOLLAR = 'A',   @LaborDOLLAR = 'A',   @TravelDOLLAR = 'A',   @ExpenseNTEPRICE = 0,  @PartNTEPRICE = 0,  @LaborNTEPRICE = 0,  @TravelNTEPRICE = 0  end if @@ERROR = 0  BEGIN  if @PartDOLLAR = 'P' and @CALLNBR <> ''  BEGIN  select @TEMPCALLAMOUNT = PARSTOTCST   from SVC00200   where SVC00200.SRVRECTYPE = 2 and CALLNBR = @CALLNBR  if @@ERROR = 0   BEGIN  select @PARTAMOUNT = isnull(@TEMPCALLAMOUNT * @PartAmount2 / 100,0)  if @PartNTEPRICE <> 0 and @PARTAMOUNT > @PartNTEPRICE   select @PARTAMOUNT = @PartNTEPRICE  END   ELSE  BEGIN  select @PARTAMOUNT = 0  END  END  ELSE if @PartDOLLAR = 'A'  BEGIN  select @PARTAMOUNT = @PartAmount2  if @PartNTEPRICE <> 0   if @PARTAMOUNT > @PartNTEPRICE   select @PARTAMOUNT = @PartNTEPRICE   END  ELSE  BEGIN  select @PARTAMOUNT = 0  END  END ELSE  BEGIN  select @PARTAMOUNT = 0  END if @@ERROR = 0  BEGIN  if @LaborDOLLAR = 'P' and @CALLNBR <> ''   BEGIN  select @TEMPCALLAMOUNT = SUM(EXTDCOST)   from SVC00203   where SRVRECTYPE = 2 and   CALLNBR = @CALLNBR and   LINITMTYP = 'L' and  ITEMUSETYPE <> 'T'  if @@ERROR = 0   BEGIN  select @LABORAMOUNT = isnull(@TEMPCALLAMOUNT * @LaborAmount2 / 100,0)  if @LaborNTEPRICE <> 0   if @LABORAMOUNT > @LaborNTEPRICE   select @LABORAMOUNT = @LaborNTEPRICE  END   ELSE  BEGIN  select @LABORAMOUNT = 0  END  END  ELSE if @LaborDOLLAR = 'A'  BEGIN  select @LABORAMOUNT = @LaborAmount2  if @LaborNTEPRICE <> 0   if @LABORAMOUNT > @LaborNTEPRICE   select @LABORAMOUNT = @LaborNTEPRICE   END  ELSE  BEGIN  select @LABORAMOUNT = 0  END  END ELSE   BEGIN  select @LABORAMOUNT = 0  END if @@ERROR = 0  BEGIN  if @TravelDOLLAR = 'P' and @CALLNBR <> ''   BEGIN  select @TEMPCALLAMOUNT = SUM(EXTDCOST)   from SVC00203   where SRVRECTYPE = 2 and   CALLNBR = @CALLNBR and   LINITMTYP = 'L' and  ITEMUSETYPE = 'T'  if @@ERROR = 0   BEGIN  select @TRAVELAMOUNT = isnull(@TEMPCALLAMOUNT * @TravelAmount2 / 100,0)  if @TravelNTEPRICE <> 0   if @TRAVELAMOUNT > @TravelNTEPRICE   select @TRAVELAMOUNT = @TravelNTEPRICE  END   ELSE  BEGIN  select @TRAVELAMOUNT = 0  END  END  ELSE if @TravelDOLLAR = 'A'  BEGIN  select @TRAVELAMOUNT = @TravelAmount2  if @TravelNTEPRICE <> 0   if @TRAVELAMOUNT > @TravelNTEPRICE   select @TRAVELAMOUNT = @TravelNTEPRICE   END  ELSE  BEGIN  select @TRAVELAMOUNT = 0  END  END ELSE   BEGIN  select @TRAVELAMOUNT = 0  END if @@ERROR = 0  BEGIN  if @ExpenseDOLLAR = 'P' and @CALLNBR <> ''  BEGIN  select @TEMPCALLAMOUNT = MSCSTOTPRC  from SVC00200 where SVC00200.SRVRECTYPE = 2 and CALLNBR = @CALLNBR   if @@ERROR = 0   BEGIN  select @MISCAMOUNT = isnull(@TEMPCALLAMOUNT * @ExpenseAMOUNT / 100,0)  if @ExpenseNTEPRICE <> 0   if @MISCAMOUNT > @ExpenseNTEPRICE   select @MISCAMOUNT = @ExpenseNTEPRICE  END   ELSE  BEGIN  select @MISCAMOUNT = 0  END  END  ELSE if @ExpenseDOLLAR = 'A'  BEGIN  select @MISCAMOUNT = @ExpenseAMOUNT  if @ExpenseNTEPRICE <> 0   if @MISCAMOUNT > @ExpenseNTEPRICE   select @MISCAMOUNT = @ExpenseNTEPRICE   END  ELSE  BEGIN  select @MISCAMOUNT = 0  END  END ELSE  BEGIN  select @MISCAMOUNT = 0  END    
GO
GRANT EXECUTE ON  [dbo].[SVC_RMA_Get_Vendor_Reimburse] TO [DYNGRP]
GO
