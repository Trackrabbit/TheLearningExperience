SET QUOTED_IDENTIFIER OFF
GO
SET ANSI_NULLS ON
GO
 create procedure [dbo].[glpPostToCurrentYearBackup]  @I_iSQLSessionID                int             = NULL,  @I_sTransactionType             smallint        = NULL,  @I_iJournalEntry                int             = NULL,  @I_cUserID                      char(15)        = NULL,  @I_iAccountIndex int             = NULL,  @I_sAccountType                 smallint        = NULL,  @I_mDebit                       numeric(19,5)   = NULL,  @I_mCredit                      numeric(19,5)   = NULL,  @I_tOffsetAccount               tinyint  = NULL,  @I_sQuickOffset                 smallint        = NULL,  @I_cAuditTrailCode              char(13)        = NULL,  @I_sYear                        smallint        = NULL,  @I_sPeriodID                    smallint        = NULL,  @I_nLedgerID int  = NULL,  @I_sPostedFrom                  smallint        = NULL,  @I_dClosingDate                 datetime        = NULL,  @I_cDescription                 char(30)        = NULL,  @I_mRecurringTRXSequence        numeric(19,5)   = NULL,  @I_mExchangeRate                numeric(15,7)   = NULL,  @I_cExchangeTableID             char(15)        = NULL,  @I_cFuncCurrencyID              char(15)        = NULL,   @I_sFuncCurrencyIndex           smallint        = NULL,  @I_tMCRegistered                tinyint  = NULL,  @I_sMCTransaction               smallint        = NULL,  @I_mOrigDebit                   numeric(19,5)   = NULL,  @I_mOrigCredit                  numeric(19,5)   = NULL,  @I_cOrigCurrencyID              char(15)        = NULL,  @I_sOrigCurrencyIndex           smallint        = NULL,   @I_sRateCalculationMethod       smallint        = NULL,  @I_cRateTypeID                  char(15)        = NULL,  @I_cOriginatingDocNumber char(21) = NULL,  @I_cOriginatingControlNumber char(21) = NULL,  @I_cOriginatingMasterID char(31) = NULL,  @I_cOriginatingMasterName char(65) = NULL,  @I_sOriginatingTrxType smallint = NULL,  @I_cOriginatingTRXDesc char(30) = NULL,  @I_sOrigDTASeries smallint = NULL,  @I_iOrigSequenceNumber int  = NULL,  @I_nSequenceLine numeric(19,5) = NULL,  @I_sDTAGLStatus smallint = NULL,  @I_nDTAIndex numeric(19,5) = NULL,  @I_nDenomExchangeRate numeric(15,7) = NULL,  @I_sMCTrxState smallint = NULL,  @I_dDocumentDate datetime = NULL,  @I_iPostingNumber int  = NULL,  @I_iPeriodPostingNumber int  = NULL,  @I_cCorrespondingUnit char(5)  = NULL,  @O_iErrorState                  int             = NULL  output as  declare  @TRUE tinyint,  @FALSE tinyint,  @POST_ACCT smallint,  @UNIT_ACCT                      smallint,  @UNIT_ALLOC_ACCT smallint,  @GL_TRANSACTION          smallint,  @MC_TRANSACTION smallint,  @MC_CLEARING_TRANSACTION        smallint,  @tTransaction                   tinyint,  @iError                         int,  @iStatus int,  @tLoop                          tinyint  select   @O_iErrorState = 0,  @iStatus                = 0  if @@trancount = 0 begin  select @tTransaction = 1  begin transaction end   while (@tLoop is NULL) begin  select @tLoop = 1   if      @I_iSQLSessionID                is NULL or  @I_sTransactionType             is NULL or  @I_iJournalEntry                is NULL or  @I_cUserID                      is NULL or  @I_iAccountIndex                is NULL or  @I_mDebit                       is NULL or  @I_mCredit                      is NULL or  @I_tOffsetAccount               is NULL or  @I_sQuickOffset          is NULL or  @I_cAuditTrailCode              is NULL or  @I_sYear                        is NULL or  @I_sPeriodID                    is NULL or  @I_nLedgerID is NULL or  @I_sPostedFrom                  is NULL or  @I_dClosingDate          is NULL or  @I_cDescription          is NULL or  @I_mRecurringTRXSequence        is NULL or  @I_mExchangeRate                is NULL or   @I_cExchangeTableID             is NULL or  @I_cFuncCurrencyID              is NULL or   @I_sFuncCurrencyIndex           is NULL or  @I_tMCRegistered                is NULL or  @I_sMCTransaction               is NULL or  @I_mOrigDebit                   is NULL or  @I_mOrigCredit                  is NULL or  @I_cOrigCurrencyID              is NULL or  @I_sOrigCurrencyIndex           is NULL or  @I_sRateCalculationMethod       is NULL or  @I_cRateTypeID                  is NULL or  @I_cOriginatingDocNumber is NULL or  @I_cOriginatingControlNumber is NULL or  @I_cOriginatingMasterID is NULL or  @I_cOriginatingMasterName is NULL or  @I_sOriginatingTrxType is NULL or  @I_cOriginatingTRXDesc is NULL or  @I_sOrigDTASeries is NULL or  @I_iOrigSequenceNumber is NULL or  @I_nSequenceLine is NULL or  @I_sDTAGLStatus is NULL or  @I_nDTAIndex is NULL or  @I_nDenomExchangeRate is NULL or  @I_sMCTrxState is NULL or  @I_dDocumentDate is NULL or  @I_iPostingNumber is NULL or  @I_iPeriodPostingNumber is NULL or  @I_cCorrespondingUnit is NULL   begin  select @O_iErrorState = 20030  break  end    select  @TRUE                           = 1,  @FALSE                          = 0,  @POST_ACCT                      = 1,  @UNIT_ACCT    = 2,  @UNIT_ALLOC_ACCT   = 4,  @GL_TRANSACTION          = 0,  @MC_TRANSACTION          = 1,  @MC_CLEARING_TRANSACTION        = 2   exec @iStatus = glpUpdateYearToDateOpen  @I_sTransactionType,  @I_iJournalEntry,  @I_cUserID,  @I_iAccountIndex,  @I_mDebit,  @I_mCredit,  @I_cAuditTrailCode,  @I_cDescription,  @I_sQuickOffset,  @I_sYear,  @I_sPostedFrom,  @I_dClosingDate,  @I_mRecurringTRXSequence,  @I_mExchangeRate,  @I_cExchangeTableID,  @I_cFuncCurrencyID,  @I_sFuncCurrencyIndex,  @I_tMCRegistered,  @I_sMCTransaction,  @I_mOrigDebit,  @I_mOrigCredit,  @I_cOrigCurrencyID,  @I_sOrigCurrencyIndex,  @I_sRateCalculationMethod,  @I_cRateTypeID,  @I_cOriginatingDocNumber,  @I_cOriginatingControlNumber,  @I_cOriginatingMasterID,  @I_cOriginatingMasterName,  @I_sOriginatingTrxType,  @I_cOriginatingTRXDesc,  @I_sOrigDTASeries,  @I_iOrigSequenceNumber,  @I_nSequenceLine,  @I_sDTAGLStatus,  @I_nDTAIndex,  @I_nDenomExchangeRate,  @I_sMCTrxState,  @I_dDocumentDate,  @I_iPostingNumber,  @I_iPeriodPostingNumber,  @I_cCorrespondingUnit,  @I_sPeriodID,  @O_iErrorState          output   select @iError = @@error  if @iStatus = 0 and @iError <> 0  select @iStatus = @iError   if @iStatus <> 0 or @O_iErrorState <> 0  break   exec @iStatus = glpUpdateAccountSummary  @I_iSQLSessionID,  @I_iAccountIndex,  @I_sAccountType,  @I_mDebit,  @I_mCredit,  @I_sPeriodID,  @I_nLedgerID,  @I_sYear,  @O_iErrorState          output   select @iError = @@error  if @iStatus = 0 and @iError <> 0  select @iStatus = @iError   if @iStatus <> 0 or @O_iErrorState <> 0  break   if (@I_sMCTransaction = @MC_TRANSACTION or   @I_sMCTransaction = @MC_CLEARING_TRANSACTION) and   @I_tMCRegistered  = @TRUE and  @I_sAccountType = @POST_ACCT  begin  exec @iStatus = glpmcUpdateAccountSummary  @I_iAccountIndex,  @I_mDebit,  @I_mCredit,  @I_mOrigDebit,  @I_mOrigCredit,  @I_cOrigCurrencyID,  @I_sOrigCurrencyIndex,  @I_sPeriodID,  @I_nLedgerID,  @I_iSQLSessionID,  @I_sYear,  @O_iErrorState  output   select @iError = @@error  if @iStatus = 0 and @iError <> 0  select @iStatus = @iError  if @iStatus <> 0 or @O_iErrorState <> 0  break   end  end   if @iStatus <> 0 or @O_iErrorState <> 0 begin  if @tTransaction = 1  rollback transaction end else if @tTransaction = 1  commit transaction  return (@iStatus)   
GO
GRANT EXECUTE ON  [dbo].[glpPostToCurrentYearBackup] TO [DYNGRP]
GO
