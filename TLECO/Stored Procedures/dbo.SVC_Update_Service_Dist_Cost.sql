SET QUOTED_IDENTIFIER OFF
GO
SET ANSI_NULLS ON
GO
 Create Procedure [dbo].[SVC_Update_Service_Dist_Cost] @srvrectype int ,  @callnbr varchar(11) ,  @EquipLine integer,  @Line integer,  @LineType char(3),  @Amount numeric (19,2),  @OrigAmount numeric (19,2),  @Qty numeric(19,2),  @CMPNTSEQ int = 0    AS declare @SEQNUMBR integer declare @AccountIndex1 integer declare @AccountIndex2 integer declare @CurrencyIndex smallint declare @DistType smallint declare  @CAmount numeric(19,2) declare  @OrigCAmount numeric (19,2) declare  @DAmount numeric(19,2) declare  @OrigDAmount numeric (19,2)  select @SEQNUMBR = MAX(SEQNUMBR)  from SVC00231 where SRVRECTYPE = @srvrectype and CALLNBR = @callnbr  and EQPLINE=@EquipLine and LNITMSEQ = @Line and LINITMTYP=@LineType  and SVC_Distribution_Type=4 and POSTED = 1 and CMPNTSEQ = @CMPNTSEQ select @DAmount = DEBITAMT, @CAmount = CRDTAMNT,@AccountIndex1=ACTINDX  from SVC00231 where SRVRECTYPE = @srvrectype and CALLNBR = @callnbr  and EQPLINE=@EquipLine and LNITMSEQ = @Line and LINITMTYP=@LineType and CMPNTSEQ = @CMPNTSEQ  and SEQNUMBR = @SEQNUMBR and SVC_Distribution_Type=4 and POSTED = 1  if @DAmount > 0 and @CAmount =0   select @DAmount = round(@Amount,2), @OrigDAmount = round(@OrigAmount,2),  @CAmount = 0, @OrigCAmount = 0 else  select @CAmount = round(@Amount,2), @OrigCAmount = round(@OrigAmount,2),  @DAmount = 0, @OrigDAmount = 0 update SVC00231 set DEBITAMT = @DAmount,ORDBTAMT=@OrigDAmount,  CRDTAMNT = @CAmount, ORCRDAMT = @OrigCAmount  where SRVRECTYPE = @srvrectype and CALLNBR = @callnbr  and EQPLINE=@EquipLine and LNITMSEQ = @Line and LINITMTYP=@LineType and CMPNTSEQ = @CMPNTSEQ  and SEQNUMBR = @SEQNUMBR and SVC_Distribution_Type=4 and POSTED = 1  select @AccountIndex2=ACTINDX from SVC00231  where SRVRECTYPE = @srvrectype and CALLNBR = @callnbr  and EQPLINE=@EquipLine and LNITMSEQ = @Line and LINITMTYP=@LineType and CMPNTSEQ = @CMPNTSEQ  and SEQNUMBR = @SEQNUMBR and SVC_Distribution_Type=5 and POSTED = 1  update SVC00231 set DEBITAMT = @CAmount,ORDBTAMT=@OrigCAmount,  CRDTAMNT = @DAmount, ORCRDAMT = @OrigDAmount  where SRVRECTYPE = @srvrectype and CALLNBR = @callnbr  and EQPLINE=@EquipLine and LNITMSEQ = @Line and LINITMTYP=@LineType and CMPNTSEQ = @CMPNTSEQ  and SEQNUMBR = @SEQNUMBR and SVC_Distribution_Type=5 and POSTED = 1 select @CAmount = sum(CRDTAMNT), @OrigCAmount = sum(ORCRDAMT),  @DAmount = sum(DEBITAMT), @OrigDAmount = sum(ORDBTAMT) from SVC00231  where SRVRECTYPE = @srvrectype and CALLNBR = @callnbr and ACTINDX = @AccountIndex1  and SVC_Distribution_Type = 4 and POSTED = 1  update SVC00230 set DEBITAMT = @DAmount,ORDBTAMT=@OrigDAmount,  CRDTAMNT = @CAmount, ORCRDAMT = @OrigCAmount  where SRVRECTYPE = @srvrectype and CALLNBR = @callnbr and ACTINDX = @AccountIndex1  and SVC_Distribution_Type=4 and POSTED = 1 select @CAmount = sum(CRDTAMNT), @OrigCAmount = sum(ORCRDAMT), @DAmount = sum(DEBITAMT), @OrigDAmount = sum(ORDBTAMT) from SVC00231  where SRVRECTYPE = @srvrectype and CALLNBR = @callnbr and ACTINDX = @AccountIndex2  and SVC_Distribution_Type = 5 and POSTED = 1 update SVC00230 set DEBITAMT = @DAmount,ORDBTAMT=@OrigDAmount,  CRDTAMNT = @CAmount, ORCRDAMT = @OrigCAmount  where SRVRECTYPE = @srvrectype and CALLNBR = @callnbr and ACTINDX = @AccountIndex2  and SVC_Distribution_Type=5 and POSTED = 1  return  return    
GO
GRANT EXECUTE ON  [dbo].[SVC_Update_Service_Dist_Cost] TO [DYNGRP]
GO
