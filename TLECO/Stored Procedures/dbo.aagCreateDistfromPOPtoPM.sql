SET QUOTED_IDENTIFIER OFF
GO
SET ANSI_NULLS ON
GO
 create         procedure [dbo].[aagCreateDistfromPOPtoPM] @HdrID int , @DOCNUMBR char(21), @CompanyID smallint as begin  declare @SERIES smallint,  @DOCTYPE smallint,  @aaSubLedgerHdrID  int,  @minSEQNUMBR int  select  @SERIES = 0,  @DOCTYPE = 0,  @aaSubLedgerHdrID = 0  Select @SERIES  = SERIES , @DOCTYPE = DOCTYPE from AAG20000  where aaSubLedgerHdrID = @HdrID  if @SERIES = 12   begin  exec DYNAMICS.dbo.aagGetNextID 20000, @CompanyID, @aaSubLedgerHdrID output  insert into AAG20000  (aaSubLedgerHdrID, SERIES, DOCTYPE, DOCNUMBR, Master_ID, aaHdrErrors)  Select @aaSubLedgerHdrID, 4 , 0, @DOCNUMBR, Master_ID, aaHdrErrors  from AAG20000  where aaSubLedgerHdrID = @HdrID  select @minSEQNUMBR=min(SEQNUMBR) from AAG20001 where aaSubLedgerHdrID = @HdrID   if (@minSEQNUMBR % 500)=0 and @minSEQNUMBR<>0  set @minSEQNUMBR=500  else  set @minSEQNUMBR=16384  insert into AAG20001  (aaSubLedgerHdrID, aaSubLedgerDistID, INTERID, CorrespondingUnit, ACTINDX,  DISTTYPE, ACCTTYPE, aaBrowseType, DECPLACS, DEBITAMT, CRDTAMNT,  ORDBTAMT, ORCRDAMT, CURNCYID, CURRNIDX, RATETPID, EXGTBLID,  XCHGRATE, EXCHDATE, TIME1, RTCLCMTD, DENXRATE, MCTRXSTT,  SEQNUMBR, GLPOSTDT, aaCustID, aaVendID, aaSiteID, aaItemID, aaCopyStatus,  aaWinWasOpen, POSTED, HISTORY, aaDistErrors, APTVCHNM, APTODCTY,  aaFutureDist, aaOffsetAcct, ITEMNMBR, TRXLOCTN, BINNMBR, TRNSTLOC,TRXQTY,  aaChangeDate,aaChangeTime)  Select @aaSubLedgerHdrID, aaSubLedgerDistID, INTERID, CorrespondingUnit, ACTINDX,  DISTTYPE, ACCTTYPE, aaBrowseType, DECPLACS, DEBITAMT, CRDTAMNT,  ORDBTAMT, ORCRDAMT, CURNCYID, CURRNIDX, RATETPID, EXGTBLID,  XCHGRATE, EXCHDATE, TIME1, RTCLCMTD, DENXRATE, MCTRXSTT,  @minSEQNUMBR*aaSubLedgerDistID, GLPOSTDT, aaCustID, aaVendID, aaSiteID, aaItemID, aaCopyStatus,  aaWinWasOpen, 1, HISTORY, aaDistErrors, APTVCHNM, APTODCTY,  aaFutureDist, aaOffsetAcct, ITEMNMBR, TRXLOCTN, BINNMBR, TRNSTLOC,TRXQTY,  convert(char(12), getdate(), 102),convert(char(12), getdate(), 108)   from AAG20001 where aaSubLedgerHdrID = @HdrID   order by DISTTYPE,ACTINDX  insert into AAG20002  (aaSubLedgerHdrID, aaSubLedgerDistID, aaSubLedgerAssignID, DEBITAMT,  CRDTAMNT, ORDBTAMT, ORCRDAMT, aaAssignedPercent, DistRef,  NOTEINDX, aaAssignErrors, aaAliasID)  Select  @aaSubLedgerHdrID, aaSubLedgerDistID, aaSubLedgerAssignID, DEBITAMT,  CRDTAMNT, ORDBTAMT, ORCRDAMT, aaAssignedPercent, DistRef,  NOTEINDX, aaAssignErrors, aaAliasID  from AAG20002 where aaSubLedgerHdrID = @HdrID   insert into AAG20003  (aaSubLedgerHdrID, aaSubLedgerDistID, aaSubLedgerAssignID, aaTrxDimID,  aaTrxCodeID, aaCodeErrors)  Select  @aaSubLedgerHdrID, aaSubLedgerDistID, aaSubLedgerAssignID, aaTrxDimID,  aaTrxCodeID, aaCodeErrors  from AAG20003  where  aaSubLedgerHdrID = @HdrID   end  end    
GO
GRANT EXECUTE ON  [dbo].[aagCreateDistfromPOPtoPM] TO [DYNGRP]
GO
