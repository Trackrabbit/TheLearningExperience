SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO
  create procedure [dbo].[glpVoidClearingTrx]  @iJournalEntry int   = NULL,  @iYear smallint  = NULL,  @iHistYear smallint  = NULL,  @iRecurTrxSeq numeric(19,5) = NULL,  @iFuncCurId char(15)  = NULL,  @iFuncCurIdx smallint  = NULL as  declare   @lTrxStarted tinyint,  @lControlLoop tinyint,  @lReturnStatus int,  @lSqlError int,  @lError int,  @lOrigin char(50)  if @@trancount = 0 begin  select @lTrxStarted = 1  begin transaction end  while (@lControlLoop is NULL) begin  select @lControlLoop = 1   if @iJournalEntry is NULL or  @iYear is NULL or  @iRecurTrxSeq is NULL or   @iFuncCurId is NULL or  @iFuncCurIdx is NULL or  @iHistYear is NULL  begin  select @lReturnStatus = 1  break  end   create table #Company (  IntercompanyID char(5)  not null,  CompanyName char(30)  not null,  CompanyID smallint  not null,  UserAccess tinyint not null,  FunctionalCurrency char(15) not null,  SourceDocument char(11) not null,  BatchNumber char(15) not null,  LineMessages2 binary(4) not null,  DatabaseName char(10) not null)   exec @lReturnStatus = DYNAMICS..smGetConstantString  'TRX_SOURCE_GL_GENERAL_ENTRY',  @lOrigin output,  @lError output   select @lSqlError = @@error  if @lSqlError <> 0   select @lReturnStatus = @lSqlError   if @lReturnStatus <> 0  break   exec @lReturnStatus = glpProcessClearingVoid  @iJournalEntry,  @iYear,  @iRecurTrxSeq,   @iFuncCurId,  @iFuncCurIdx,  @iHistYear    select @lSqlError = @@error  if @lSqlError <> 0   begin  select @lReturnStatus = @lSqlError  break  end   if @lReturnStatus <> 0  break   update  GL10000  set  VOIDED = 1  where  JRNENTRY = @iJournalEntry  select @lSqlError = @@error  if @lSqlError <> 0   begin  select @lReturnStatus = @lSqlError  break  end    delete  GL10002  where  JRNENTRY = @iJournalEntry   select @lSqlError = @@error  if @lSqlError <> 0   begin  select @lReturnStatus = @lSqlError  break  end   end    if @lReturnStatus <> 0 begin  if @lTrxStarted = 1  rollback transaction end else begin  if @lTrxStarted = 1  commit transaction end return (@lReturnStatus)    
GO
GRANT EXECUTE ON  [dbo].[glpVoidClearingTrx] TO [DYNGRP]
GO
