SET QUOTED_IDENTIFIER OFF
GO
SET ANSI_NULLS ON
GO
 CREATE PROCEDURE [dbo].[SVC_RMA_SOP_Remove_Link]  @SOPDocType smallint,  @SOPDocNumber char(15),  @VoidType int AS DECLARE @Return_Record_Type smallint,   @RETDOCID char(15),  @LNSEQNBR numeric(19,2),  @RMA_Status int,  @SVC_Ready_To_Close smallint,  @SOPTYPE smallint,   @Credit_SOP_Type smallint,   @Replace_SOP_Type smallint,   @SOPNUMBE char(16),   @Credit_SOP_Number char(16),   @Replace_SOP_Number char(16) begin  if @VoidType = 2   if not exists(select * from SOP10100 where SOPTYPE = @SOPDocType AND SOPNUMBE = @SOPDocNumber)  return (1001)   DECLARE RMA_Lines CURSOR FOR  SELECT Return_Record_Type, RETDOCID, LNSEQNBR, RMA_Status, SVC_Ready_To_Close, SOPTYPE, SOPNUMBE, Credit_SOP_Type, Credit_SOP_Number,   Replace_SOP_Type, Replace_SOP_Number  FROM SVC05200 WHERE ((SOPTYPE = @SOPDocType AND SOPNUMBE = @SOPDocNumber)  OR (Replace_SOP_Type = @SOPDocType AND Replace_SOP_Number = @SOPDocNumber)  OR (Credit_SOP_Type = @SOPDocType AND Credit_SOP_Number = @SOPDocNumber))  OPEN RMA_Lines  FETCH NEXT FROM RMA_Lines INTO @Return_Record_Type, @RETDOCID, @LNSEQNBR, @RMA_Status, @SVC_Ready_To_Close,  @SOPTYPE, @SOPNUMBE, @Credit_SOP_Type, @Credit_SOP_Number,   @Replace_SOP_Type, @Replace_SOP_Number  if @@FETCH_STATUS<>0  begin  close RMA_Lines  deallocate RMA_Lines  return (1002)  end  WHILE @@FETCH_STATUS=0  BEGIN  IF NOT EXISTS(SELECT * FROM SVC05015 WHERE RETDOCID = @RETDOCID and MKDTOPST = 1)  begin  IF @SOPTYPE = @SOPDocType AND @SOPNUMBE = @SOPDocNumber  begin  SET @SOPTYPE = 0  SET @SOPNUMBE = ''  end  IF @SOPDocType = 2 AND @Replace_SOP_Number = @SOPDocNumber  begin  SET @Replace_SOP_Type = 0  SET @Replace_SOP_Number = ''  end   IF @SOPDocType = 4 AND @Credit_SOP_Number = @SOPDocNumber  begin  SET @Credit_SOP_Type = 0  SET @Credit_SOP_Number = ''  end   UPDATE SVC05200 SET SOPTYPE = @SOPTYPE, SOPNUMBE = @SOPNUMBE,   Credit_SOP_Type = @Credit_SOP_Type, Credit_SOP_Number = @Credit_SOP_Number,   Replace_SOP_Type = @Replace_SOP_Type, Replace_SOP_Number = @Replace_SOP_Number  WHERE Return_Record_Type = @Return_Record_Type AND RETDOCID = @RETDOCID AND LNSEQNBR = @LNSEQNBR  end   FETCH NEXT FROM RMA_Lines INTO @Return_Record_Type, @RETDOCID, @LNSEQNBR, @RMA_Status, @SVC_Ready_To_Close,  @SOPTYPE, @SOPNUMBE, @Credit_SOP_Type, @Credit_SOP_Number,   @Replace_SOP_Type, @Replace_SOP_Number  END   close RMA_Lines  deallocate RMA_Lines   return 0 end    
GO
GRANT EXECUTE ON  [dbo].[SVC_RMA_SOP_Remove_Link] TO [DYNGRP]
GO
