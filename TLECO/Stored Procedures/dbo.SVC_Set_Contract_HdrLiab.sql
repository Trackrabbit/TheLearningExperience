SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO
 CREATE PROCEDURE [dbo].[SVC_Set_Contract_HdrLiab] (  @CONSTS smallint = NULL,  @CONTNBR char(11)= NULL,  @NEXTLIABDATE datetime = '01/01/1900 00:00:00',  @LIABAMT numeric(19,2) = 0,  @LIABMONTHAMT numeric(19,2) = 0,  @DLIABAMT numeric(19,2) = 0,  @DLIABMONTHAMT numeric(19,2) = 0,  @ORIGLIABAMT numeric(19,2) = 0,  @ORIGLIABMONTHAMT numeric(19,2) = 0,  @ORIGDLIABAMT numeric(19,2) = 0,  @ORIGDLIABMONTHAMT numeric(19,2) = 0,   @LIABMONTHS integer = 0,  @LIABILITY smallint = 0,  @LASTDATE datetime = '01/01/1900 00:00:00'  ) AS set nocount on  select @LIABILITY = MAX(Liabiltiy_Reduction),@NEXTLIABDATE= MIN(Next_Liability_Date) from SVC00601  WHERE SVC00601.CONSTS = @CONSTS AND   SVC00601.CONTNBR = @CONTNBR UPDATE SVC00600  SET   SVC00600.Liabiltiy_Reduction = IsNull(@LIABILITY,0),  SVC00600.Total_Liability_Amount = SVC00600.Total_Liability_Amount + Round(IsNull(@LIABAMT,0),2),  SVC00600.Liability_Amount = SVC00600.Liability_Amount + Round(IsNull(@LIABMONTHAMT,0),2),  SVC00600.SVC_Discount_Remaining = SVC00600.SVC_Discount_Remaining + Round(IsNull(@DLIABAMT,0),2),  SVC00600.SVC_Discount_Next = SVC00600.SVC_Discount_Next + Round(IsNull(@DLIABMONTHAMT,0),2),  SVC00600.OrigTotLiabilityAmount = SVC00600.OrigTotLiabilityAmount + Round(IsNull(@ORIGLIABAMT,0),2),  SVC00600.Orig_Liability_Amount = SVC00600.Orig_Liability_Amount + Round(IsNull(@ORIGLIABMONTHAMT,0),2),  SVC00600.OrigDiscountRemaining = SVC00600.OrigDiscountRemaining + Round(IsNull(@ORIGDLIABAMT,0),2),  SVC00600.OrigDiscountNext = SVC00600.OrigDiscountNext + Round(IsNull(@ORIGDLIABMONTHAMT,0),2),   SVC00600.Liability_Months = CASE   WHEN IsNull(@LIABMONTHS,0) > SVC00600.Liability_Months THEN IsNull(@LIABMONTHS,0)  ELSE  SVC00600.Liability_Months  END ,  SVC00600.Next_Liability_Date = CASE  WHEN CONVERT(varchar(10),SVC00600.Next_Liability_Date,102) = '01/01/1900' THEN IsNull(@NEXTLIABDATE,'01/01/1900 00:00:00')  WHEN @NEXTLIABDATE is null THEN SVC00600.Next_Liability_Date  WHEN DATEDIFF(dd,@NEXTLIABDATE,SVC00600.Next_Liability_Date) <> 0 THEN IsNull(@NEXTLIABDATE,'01/01/1900 00:00:00')  ELSE SVC00600.Next_Liability_Date  END,   SVC00600.Last_Liability_Date = CASE  WHEN @LASTDATE IS NULL THEN SVC00600.Last_Liability_Date  WHEN CONVERT(varchar(10),@LASTDATE,102) = '01/01/1900' THEN SVC00600.Last_Liability_Date   ELSE @LASTDATE  END  FROM SVC00600 WHERE SVC00600.CONSTS = @CONSTS AND   SVC00600.CONTNBR = @CONTNBR    
GO
GRANT EXECUTE ON  [dbo].[SVC_Set_Contract_HdrLiab] TO [DYNGRP]
GO
