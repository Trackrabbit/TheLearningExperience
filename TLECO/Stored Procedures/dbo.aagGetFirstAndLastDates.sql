SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO
 create procedure [dbo].[aagGetFirstAndLastDates]  @iYear smallint = null,  @oFirstFiscalDate datetime = null out,  @oLastFiscalDate datetime = null out,  @oFirstFiscalWeek smallint = null out,  @oLastFiscalWeek smallint = null out,  @oFirstFiscalPeriod smallint = null out,  @oLastFiscalPeriod smallint = null out,  @oFirstFiscalQuarter smallint = null out,  @oLastFiscalQuarter smallint = null out,  @oFirstFiscalHalfYear smallint = null out,  @oLastFiscalHalfYear smallint = null out,  @oFirstCalDate datetime = null out,  @oLastCalDate datetime = null out,  @oFirstCalWeek smallint = null out,  @oLastCalWeek smallint = null out,  @oFirstCalMonth smallint = null out,  @oLastCalMonth smallint = null out,  @oFirstCalQuarter smallint = null out,  @oLastCalQuarter smallint = null out,  @oFirstCalHalfYear smallint = null out,  @oLastCalHalfYear smallint = null out,  @oYearExists tinyint = null out,  @oStatus smallint = null out as declare @retCode int,  @dbName varchar(32),  @companyID smallint,  @companyStatus smallint  select  @retCode = 0,  @dbName = '',  @companyID = 0,  @companyStatus = 0,  @oFirstFiscalDate = 0,  @oLastFiscalDate = 0,  @oFirstFiscalWeek = 0,  @oLastFiscalWeek = 0,  @oFirstFiscalPeriod = 0,  @oLastFiscalPeriod = 0,  @oFirstFiscalQuarter = 0,  @oLastFiscalQuarter = 0,  @oFirstFiscalHalfYear = 0,  @oLastFiscalHalfYear = 0,  @oFirstCalDate = 0,  @oLastCalDate = 0,  @oFirstCalWeek = 0,  @oLastCalWeek = 0,  @oFirstCalMonth = 0,  @oLastCalMonth = 0,  @oFirstCalQuarter = 0,  @oLastCalQuarter = 0,  @oFirstCalHalfYear = 0,  @oLastCalHalfYear = 0,  @oYearExists = 0,  @oStatus = 0  if (@iYear is null) begin select @oStatus = 30000 return end  if (@iYear = 0)  begin select @oStatus = 30001 return end  select @dbName = db_name() exec @retCode = DYNAMICS.dbo.aagGetCompanyStatus @dbName, @companyID out, @companyStatus out, @oStatus out if ((@retCode <> 0) or (@oStatus <> 0)) return @retCode  if not exists(select top 1 aaFiscalYear from AAG00500 where aaFiscalYear = @iYear) begin select @oYearExists = 0 return 0 end  select @oYearExists = 1  select @oFirstFiscalDate = min(DATE1), @oLastFiscalDate = max(DATE1),  @oFirstFiscalWeek = min(aaFiscalWeek), @oLastFiscalWeek = max(aaFiscalWeek),  @oFirstFiscalPeriod = min(aaFiscalPeriod), @oLastFiscalPeriod = max(aaFiscalPeriod),  @oFirstFiscalQuarter = min(aaFiscalQuarter), @oLastFiscalQuarter = max(aaFiscalQuarter),  @oFirstFiscalHalfYear = min(aaFiscalHalfYear), @oLastFiscalHalfYear = max(aaFiscalHalfYear) from AAG00500 where aaFiscalYear = @iYear  select @oFirstCalDate = min(DATE1), @oLastCalDate = max(DATE1),  @oFirstCalWeek = min(aaCalWeek), @oLastCalWeek = max(aaCalWeek),  @oFirstCalMonth = min(aaCalMonth), @oLastCalMonth = max(aaCalMonth),  @oFirstCalQuarter = min(aaCalQuarter), @oLastCalQuarter = max(aaCalQuarter),  @oFirstCalHalfYear = min(aaCalHalfYear), @oLastCalHalfYear = max(aaCalHalfYear) from AAG00500 where aaCalYear = @iYear return 0    
GO
GRANT EXECUTE ON  [dbo].[aagGetFirstAndLastDates] TO [DYNGRP]
GO
