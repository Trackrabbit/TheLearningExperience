SET QUOTED_IDENTIFIER OFF
GO
SET ANSI_NULLS ON
GO
 CREATE PROCEDURE [dbo].[sp_Dynamics_PurchaseOrderStatus] @iLanguageID int  as  set nocount on   declare @sqldropstring varchar(400),  @sqldefaultstring varchar(8000),  @sqlstring1 varchar(8000),  @sqlstring2 varchar(8000),  @sqlstring3 varchar(8000),  @sqlstring4 varchar(8000),  @sqlstring5 varchar(8000),  @sqlstring6 varchar(8000),  @sqlstring7 varchar(8000),  @sqlstring8 varchar(8000),  @sqlstring9 varchar(8000),  @sqlstring10 varchar(8000),  @sqlstring11 varchar(8000),  @sqlstring12 varchar(8000),  @sqlstring13 varchar(8000),  @sqlstring14 varchar(8000),  @sqlstring15 varchar(8000),  @sqlstring16 varchar(8000),  @sqlstring17 varchar(8000),  @sqlstring18 varchar(8000),  @sqlstring19 varchar(8000),  @sqlstring20 varchar(8000),  @sqlstring21 varchar(8000),  @sqlstring22 varchar(8000),  @sqljoinstring varchar(8000),  @sqlaccessstring varchar(2000),  @tNumberSegments int,  @tSegment int,  @I_iDictID int,  @I_iLangID int,  @I_iMessageNumber int,  @I_iAliasMessageNumber int,  @I_iIntegerValue int,  @Status varchar(255), @TRX_Location varchar(255), @U_Of_M varchar(255), @PO_Line_Number varchar(255), @Item_Number varchar(255), @PO_Number varchar(255), @QTY_Type varchar(255), @Apply_Type varchar(255), @Job_Number varchar(255), @Vendor_ID varchar(255), @Cost_Code varchar(255), @Receipt_SEQ_Number varchar(255), @Product_Indicator varchar(255), @Date_Received varchar(255), @Receipt_Line_Number varchar(255), @POP_Receipt_Number varchar(255), @QTY_Rejected varchar(255), @QTY_Invoiced varchar(255), @QTY_Shipped varchar(255), @DrillBack_Base_Url varchar(255), @Vendor_ID_For_DrillBack varchar(255), @Item_Number_For_DrillBack varchar(255)  select @DrillBack_Base_Url = DYNAMICS.dbo.createBaseDrillBackUrlString(DB_NAME(),0)  select @I_iDictID = 414 select @I_iMessageNumber = 26122 select @I_iAliasMessageNumber = 0 exec DYNAMICS..smGetBIMsgString  @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @Status output   select @I_iDictID = 1493 select @I_iMessageNumber = 26509 select @I_iAliasMessageNumber = 0 exec DYNAMICS..smGetBIMsgString  @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @TRX_Location  output   select @I_iDictID = 1493 select @I_iMessageNumber = 24084 select @I_iAliasMessageNumber = 0 exec DYNAMICS..smGetBIMsgString  @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @U_Of_M  output   select @I_iDictID = 0 select @I_iMessageNumber = 22055 select @I_iAliasMessageNumber = 0 exec DYNAMICS..smGetBIMsgString  @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @PO_Line_Number  output   select @I_iDictID = 1493 select @I_iMessageNumber = 26502 select @I_iAliasMessageNumber = 0 exec DYNAMICS..smGetBIMsgString  @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @Item_Number  output   select @I_iDictID = 1493 select @I_iMessageNumber = 29552 select @I_iAliasMessageNumber = 0 exec DYNAMICS..smGetBIMsgString  @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @PO_Number  output   select @I_iDictID = 1493 select @I_iMessageNumber = 31105 select @I_iAliasMessageNumber = 0 exec DYNAMICS..smGetBIMsgString  @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @QTY_Type  output   select @I_iDictID = 0 select @I_iMessageNumber = 22056 select @I_iAliasMessageNumber = 0 exec DYNAMICS..smGetBIMsgString  @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @Apply_Type  output   select @I_iDictID = 1493 select @I_iMessageNumber = 26336 select @I_iAliasMessageNumber = 0 exec DYNAMICS..smGetBIMsgString  @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @Job_Number  output   select @I_iDictID = 1493 select @I_iMessageNumber = 24800 select @I_iAliasMessageNumber = 0 exec DYNAMICS..smGetBIMsgString  @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @Vendor_ID  output   select @I_iDictID = 1493 select @I_iMessageNumber = 29571 select @I_iAliasMessageNumber = 0 exec DYNAMICS..smGetBIMsgString  @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @Cost_Code  output   select @I_iDictID = 1493 select @I_iMessageNumber = 31111 select @I_iAliasMessageNumber = 0 exec DYNAMICS..smGetBIMsgString  @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @Receipt_SEQ_Number  output   select @I_iDictID = 1493 select @I_iMessageNumber = 29583 select @I_iAliasMessageNumber = 0 exec DYNAMICS..smGetBIMsgString  @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @Product_Indicator  output   select @I_iDictID = 1493 select @I_iMessageNumber = 31101 select @I_iAliasMessageNumber = 0 exec DYNAMICS..smGetBIMsgString  @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @Date_Received  output   select @I_iDictID = 1493 select @I_iMessageNumber = 29551 select @I_iAliasMessageNumber = 0 exec DYNAMICS..smGetBIMsgString  @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @Receipt_Line_Number  output   select @I_iDictID = 949 select @I_iMessageNumber = 30049 select @I_iAliasMessageNumber = 0 exec DYNAMICS..smGetBIMsgString  @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @POP_Receipt_Number  output   select @I_iDictID = 1493 select @I_iMessageNumber = 26394 select @I_iAliasMessageNumber = 0 exec DYNAMICS..smGetBIMsgString  @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @QTY_Rejected  output   select @I_iDictID = 1493 select @I_iMessageNumber = 26393 select @I_iAliasMessageNumber = 0 exec DYNAMICS..smGetBIMsgString  @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @QTY_Invoiced  output   select @I_iDictID = 1493 select @I_iMessageNumber = 26392 select @I_iAliasMessageNumber = 0 exec DYNAMICS..smGetBIMsgString  @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @QTY_Shipped  output   select @I_iDictID = 1493 select @I_iMessageNumber = 24800 select @I_iAliasMessageNumber = 22214 exec DYNAMICS..smGetBIMsgString  @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @Vendor_ID_For_DrillBack  output   select @I_iDictID = 1493 select @I_iMessageNumber = 26502 select @I_iAliasMessageNumber = 22214 exec DYNAMICS..smGetBIMsgString  @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @Item_Number_For_DrillBack  output   select @sqldropstring =   'if exists (select * from dbo.sysobjects where id = object_id(N''[dbo].[PurchaseOrderStatus]'') and OBJECTPROPERTY(id, N''IsView'') = 1) ' +  'drop view [dbo].[PurchaseOrderStatus] '  select @sqldefaultstring =   'CREATE VIEW PurchaseOrderStatus AS ' +   'select ' +   '[''Purchasing Receipt Line Quantities''].[Status] as ''' + @Status + ''', ' + 'rtrim([''Purchasing Receipt Line Quantities''].[TRXLOCTN]) as ''' + @TRX_Location + ''', '  + 'rtrim([''Purchasing Receipt Line Quantities''].[UOFM]) as ''' + @U_Of_M + ''', '  + '[''Purchasing Receipt Line Quantities''].[POLNENUM] as ''' + @PO_Line_Number + ''', '  + 'rtrim([''Purchasing Receipt Line Quantities''].[ITEMNMBR]) as ''' + @Item_Number + ''', '  + 'rtrim([''Purchasing Receipt Line Quantities''].[PONUMBER]) as ''' + @PO_Number + ''', '  + '''' + @QTY_Type + ''' = dbo.DYN_FUNC_QTY_Type([''Purchasing Receipt Line Quantities''].[QTYTYPE]), '  + '[''Purchasing Receipt Line Quantities''].[APPYTYPE] as ''' + @Apply_Type + ''', '  + 'rtrim([''Purchasing Receipt Line Quantities''].[JOBNUMBR]) as ''' + @Job_Number + ''', '  + 'rtrim([''Purchasing Receipt Line Quantities''].[VENDORID]) as ''' + @Vendor_ID + ''', '   + 'rtrim([''Purchasing Receipt Line Quantities''].[COSTCODE]) as ''' + @Cost_Code + ''', '  + '[''Purchasing Receipt Line Quantities''].[RCTSEQNM] as ''' + @Receipt_SEQ_Number + ''', '  + 'rtrim([''Purchasing Receipt Line Quantities''].[Product_Indicator]) as ''' + @Product_Indicator + ''', '  + '[''Purchasing Receipt Line Quantities''].[DATERECD] as ''' + @Date_Received + ''', '  + '[''Purchasing Receipt Line Quantities''].[RCPTLNNM] as ''' + @Receipt_Line_Number + ''', '  + 'rtrim([''Purchasing Receipt Line Quantities''].[POPRCTNM]) as ''' + @POP_Receipt_Number + ''', '  + '[''Purchasing Receipt Line Quantities''].[QTYREJ] as ''' + @QTY_Rejected + ''', '  + '[''Purchasing Receipt Line Quantities''].[QTYINVCD] as ''' + @QTY_Invoiced + ''', '  + '[''Purchasing Receipt Line Quantities''].[QTYSHPPD] as ''' + @QTY_Shipped + ''', '   select @sqlstring1 = '''' + @Item_Number_For_DrillBack + ''' = ''' + @DrillBack_Base_Url + ''' +dbo.dgppItemID(1,[''Purchasing Receipt Line Quantities''].[ITEMNMBR],'''' ), '+ '''' + @Vendor_ID_For_DrillBack + ''' = ''' + @DrillBack_Base_Url + ''' +dbo.dgppVendorID(1,[''Purchasing Receipt Line Quantities''].[VENDORID] ) '  select @sqlstring2=   'from [POP10500] as [''Purchasing Receipt Line Quantities''] with (NOLOCK) '  select @sqlaccessstring =   'GRANT SELECT ON [dbo].[PurchaseOrderStatus] TO [rpt_purchasing manager]' + 'GRANT SELECT ON [dbo].[PurchaseOrderStatus] TO [rpt_executive]' + 'GRANT SELECT ON [dbo].[PurchaseOrderStatus] TO [rpt_purchasing agent]'   exec (@sqldropstring)  exec (@sqldefaultstring+' '+@sqlstring1+' '+@sqlstring2+' '+@sqlstring3+' '+@sqlstring4+' '+@sqlstring5+' '+@sqlstring6+' '+@sqlstring7+' '+@sqlstring8+' '+@sqlstring9+' '+@sqlstring10+' '+@sqlstring11+' '+@sqlstring12+' '+@sqlstring13+' '+@sqlstring14+' '+@sqlstring15+' '+@sqlstring16+' '+@sqlstring17+' '+@sqlstring18+' '+@sqlstring19+' '+@sqlstring20+' '+@sqljoinstring)  exec (@sqlaccessstring)   set nocount off    
GO
GRANT EXECUTE ON  [dbo].[sp_Dynamics_PurchaseOrderStatus] TO [DYNGRP]
GO
