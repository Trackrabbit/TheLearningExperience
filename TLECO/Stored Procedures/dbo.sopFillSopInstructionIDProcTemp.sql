SET QUOTED_IDENTIFIER OFF
GO
SET ANSI_NULLS ON
GO
 CREATE PROCEDURE [dbo].[sopFillSopInstructionIDProcTemp]   @ProcessInd tinyint,  @InstructionID varchar (15),  @FromCustomerNumber varchar (15),  @ToCustomerNumber varchar (15),  @AddressAll tinyint,  @FromAddress varchar (15),  @ToAddress varchar (15),  @ItemNumberAll tinyint,  @FromItemNumber varchar (31),  @ToItemNumber varchar (31),  @DescriptionAll tinyint,  @FromDescription varchar (100),  @ToDescription varchar (100),  @ItemClassCodeAll tinyint,  @FromItemClassCode varchar (11),  @ToItemClassCode varchar (11),  @OSName varchar(31) AS  DECLARE @sql_statement as varchar(8000),  @sql_assign as varchar(8000),  @sql_remove as varchar(8000),  @Remove as tinyint,  @Assign as tinyint,  @AnyAddress as tinyint  set @Assign = 0 set @Remove = 1  select @sql_statement = '' select @sql_statement = @sql_statement + 'delete from ' +  @OSName exec (@sql_statement)  if @ProcessInd = 0    begin  set @sql_assign = ''  set @sql_assign = @sql_assign + 'insert into ' + @OSName + ' select ''' + @InstructionID + ''', a.CUSTNMBR, '   if (@FromCustomerNumber <> @ToCustomerNumber) and @FromCustomerNumber <> '' and @ToCustomerNumber <> ''   begin  set @sql_assign = @sql_assign + ''' ''' + ', c.ITEMNMBR, c.ITEMDESC, c.ITMGEDSC, c.ITMCLSCD, 1, 0 '  set @AnyAddress = 1   end  else  begin  set @sql_assign = @sql_assign + 'b.ADRSCODE, c.ITEMNMBR, c.ITEMDESC, c.ITMGEDSC, c.ITMCLSCD, 1, 0 '  set @AnyAddress = 0   end   if @AnyAddress = 0   set @sql_assign = @sql_assign + 'from RM00101 a, RM00102 b, IV00101 c where '  else  set @sql_assign = @sql_assign + 'from RM00101 a, IV00101 c  where '   if @FromCustomerNumber = '' and @ToCustomerNumber <> ''  set @sql_assign = @sql_assign + 'a.CUSTNMBR <= ''' +  @ToCustomerNumber + ''' '   if @FromCustomerNumber <> '' and @ToCustomerNumber = ''  set @sql_assign = @sql_assign + 'a.CUSTNMBR >= ''' +  @FromCustomerNumber + ''' '   if @FromCustomerNumber <> '' and @ToCustomerNumber <> ''  set @sql_assign = @sql_assign + 'a.CUSTNMBR >= ''' + @FromCustomerNumber + ''' and a.CUSTNMBR <= ''' + @ToCustomerNumber + ''' '    if @AnyAddress = 0   set @sql_assign = @sql_assign + 'and b.CUSTNMBR = a.CUSTNMBR '   if @AnyAddress = 0   begin  if @FromAddress = '' and @ToAddress <> ''  set @sql_assign = @sql_assign + 'and b.ADRSCODE <= ''' +  @ToAddress + ''' '    if @FromAddress <> '' and @ToAddress = ''  set @sql_assign = @sql_assign + 'and b.ADRSCODE >= ''' +  @FromAddress + ''' '    if @FromAddress <> '' and @ToAddress <> ''  set @sql_assign = @sql_assign + 'and b.ADRSCODE >= ''' + @FromAddress + ''' and b.ADRSCODE <= ''' + @ToAddress + ''' '   end   if @ItemNumberAll = 1   begin  if @FromItemNumber = '' and @ToItemNumber <> ''  set @sql_assign = @sql_assign + 'and c.ITEMNMBR <= ''' +  @ToItemNumber + ''' '    if @FromItemNumber <> '' and @ToItemNumber = ''  set @sql_assign = @sql_assign + 'and c.ITEMNMBR >= ''' +  @FromItemNumber + ''' '    if @FromItemNumber <> '' and @ToItemNumber <> ''  begin  set @sql_assign = @sql_assign + 'and c.ITEMNMBR >= ''' + @FromItemNumber + ''' and c.ITEMNMBR <= '   set @sql_assign = @sql_assign + '''' +  @ToItemNumber + ''' '  end  end   if @DescriptionAll = 1  begin  if @FromDescription = '' and @ToDescription <> ''  set @sql_assign = @sql_assign + 'and c.ITMGEDSC <= ''' +  @ToDescription + ''' '    if @FromDescription <> '' and @ToDescription = ''  set @sql_assign = @sql_assign + 'and c.ITMGEDSC >= ''' +  @FromDescription + ''' '   if @FromDescription <> '' and @ToDescription <> ''  begin  set @sql_assign = @sql_assign + 'and c.ITMGEDSC >= ''' + @FromDescription + ''' and c.ITMGEDSC <= '   set @sql_assign = @sql_assign + '''' + @ToDescription + ''' '  end  end    if @ItemClassCodeAll = 1  begin  if @FromItemClassCode = '' and @ToItemClassCode <> ''  set @sql_assign = @sql_assign + 'and c.ITMCLSCD <= ''' +  @ToItemClassCode + ''' '    if @FromItemClassCode <> '' and @ToItemClassCode = ''  set @sql_assign = @sql_assign + 'and c.ITMCLSCD >= ''' +  @FromItemClassCode + ''' '   if @FromItemClassCode <> '' and @ToItemClassCode <> ''  begin  set @sql_assign = @sql_assign + 'and c.ITMCLSCD >= ''' + @FromItemClassCode + ''' and c.ITMCLSCD <= '  set @sql_assign = @sql_assign + '''' + @ToItemClassCode + ''' '   end  end   if @AnyAddress = 1   set @sql_assign = @sql_assign + 'order by a.CUSTNMBR, c.ITEMNMBR, c.ITEMDESC, c.ITMGEDSC, c.ITMCLSCD'  else  set @sql_assign = @sql_assign + 'order by a.CUSTNMBR, b.ADRSCODE, c.ITEMNMBR, c.ITEMDESC, c.ITMGEDSC, c.ITMCLSCD'   exec (@sql_assign)   if @FromCustomerNumber = @ToCustomerNumber and @FromCustomerNumber <> '' and @ToCustomerNumber <> '' and @AddressAll = 0  begin  set @sql_statement = ''  set @sql_statement = @sql_statement + 'insert into ' + @OSName + ' select distinct INSTRUCTIONID, CUSTNMBR, '' '', '  set @sql_statement = @sql_statement + 'ITEMNMBR, ITEMDESC, ITMGEDSC, ITMCLSCD, Check_Mark_2, SEQNUMBR from ' + @OSName   exec (@sql_statement)  end   set @sql_statement = ''  set @sql_statement = @sql_statement + 'update ' + @OSName + ' set SEQNUMBR = b.SEQNUMBR from ' + @OSName   set @sql_statement = @sql_statement + ' a, SOP60200 b where a.CUSTNMBR = '  set @sql_statement = @sql_statement + 'b.CUSTNMBR and a.ADRSCODE = b.ADRSCODE and a.ITEMNMBR = b.ITEMNMBR'  exec (@sql_statement)  end else    begin   if @FromCustomerNumber <> @ToCustomerNumber and @FromCustomerNumber <> '' and @ToCustomerNumber <> ''  set @AnyAddress = 1   else  set @AnyAddress = 0    set @sql_assign = ''  set @sql_assign = @sql_assign + 'insert into ' + @OSName + ' select a.INSTRUCTIONID, a.CUSTNMBR, '  set @sql_assign = @sql_assign + 'a.ADRSCODE, a.ITEMNMBR, b.ITEMDESC, b.ITMGEDSC, b.ITMCLSCD, 0, a.SEQNUMBR '  set @sql_assign = @sql_assign + 'from SOP60200 a, IV00101 b where b.ITEMNMBR = a.ITEMNMBR and '  set @sql_assign = @sql_assign + 'a.INSTRUCTIONID = ''' + @InstructionID + ''' and '   if @FromCustomerNumber = '' and @ToCustomerNumber <> ''  set @sql_assign = @sql_assign + 'a.CUSTNMBR <= ''' +  @ToCustomerNumber + ''' '   if @FromCustomerNumber <> '' and @ToCustomerNumber = ''  set @sql_assign = @sql_assign + 'a.CUSTNMBR >= ''' +  @FromCustomerNumber + ''' '   if @FromCustomerNumber <> '' and @ToCustomerNumber <> ''  set @sql_assign = @sql_assign + 'a.CUSTNMBR >= ''' + @FromCustomerNumber + ''' and a.CUSTNMBR <= ''' + @ToCustomerNumber + ''' '    if @AnyAddress = 0   begin  if @FromAddress = '' and @ToAddress <> ''  set @sql_assign = @sql_assign + 'and a.ADRSCODE <= ''' +  @ToAddress + ''' '    if @FromAddress <> '' and @ToAddress = ''  set @sql_assign = @sql_assign + 'and a.ADRSCODE >= ''' +  @FromAddress + ''' '    if @FromAddress <> '' and @ToAddress <> ''  set @sql_assign = @sql_assign + 'and a.ADRSCODE >= ''' + @FromAddress + ''' and a.ADRSCODE <= ''' + @ToAddress + ''' '   end   if @ItemNumberAll = 1   begin  if @FromItemNumber = '' and @ToItemNumber <> ''  set @sql_assign = @sql_assign + 'and a.ITEMNMBR <= ''' +  @ToItemNumber + ''' '    if @FromItemNumber <> '' and @ToItemNumber = ''  set @sql_assign = @sql_assign + 'and a.ITEMNMBR >= ''' +  @FromItemNumber + ''' '    if @FromItemNumber <> '' and @ToItemNumber <> ''  begin  set @sql_assign = @sql_assign + 'and a.ITEMNMBR >= ''' + @FromItemNumber + ''' and a.ITEMNMBR <= '   set @sql_assign = @sql_assign + '''' +  @ToItemNumber + ''' '  end  end   if @DescriptionAll = 1  begin  if @FromDescription = '' and @ToDescription <> ''  set @sql_assign = @sql_assign + 'and b.ITMGEDSC <= ''' +  @ToDescription + ''' '    if @FromDescription <> '' and @ToDescription = ''  set @sql_assign = @sql_assign + 'and b.ITMGEDSC >= ''' +  @FromDescription + ''' '   if @FromDescription <> '' and @ToDescription <> ''  begin  set @sql_assign = @sql_assign + 'and b.ITMGEDSC >= ''' + @FromDescription + ''' and b.ITMGEDSC <= '   set @sql_assign = @sql_assign + '''' + @ToDescription + ''' '  end  end    if @ItemClassCodeAll = 1  begin  if @FromItemClassCode = '' and @ToItemClassCode <> ''  set @sql_assign = @sql_assign + 'and b.ITMCLSCD <= ''' +  @ToItemClassCode + ''' '    if @FromItemClassCode <> '' and @ToItemClassCode = ''  set @sql_assign = @sql_assign + 'and b.ITMCLSCD >= ''' +  @FromItemClassCode + ''' '   if @FromItemClassCode <> '' and @ToItemClassCode <> ''  begin  set @sql_assign = @sql_assign + 'and b.ITMCLSCD >= ''' + @FromItemClassCode + ''' and b.ITMCLSCD <= '  set @sql_assign = @sql_assign + '''' + @ToItemClassCode + ''' '   end  end  set @sql_assign = @sql_assign + 'order by a.CUSTNMBR, a.ADRSCODE, a.ITEMNMBR, b.ITEMDESC, b.ITMGEDSC, b.ITMCLSCD'  exec (@sql_assign)  end    
GO
GRANT EXECUTE ON  [dbo].[sopFillSopInstructionIDProcTemp] TO [DYNGRP]
GO
