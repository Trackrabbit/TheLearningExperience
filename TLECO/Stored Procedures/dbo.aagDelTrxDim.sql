SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO
 create procedure [dbo].[aagDelTrxDim]  @iTrxDim char(60) = null,  @oStatus smallint = null out as declare @transaction tinyint,  @retCode int,  @dbName varchar(32),  @companyID smallint,  @companyStatus smallint,  @trxDimID int,  @dataType smallint  select  @transaction = 0,  @retCode = 0,  @dbName = '',  @companyID = 0,  @companyStatus = 0,  @trxDimID = 0,  @dataType = 0,  @oStatus = 0  if (@iTrxDim is null) begin select @oStatus = 35000 return end  if (@iTrxDim = '') begin select @oStatus = 35001 return end  select @dbName = db_name() exec @retCode = DYNAMICS.dbo.aagGetCompanyStatus @dbName, @companyID out, @companyStatus out, @oStatus out if ((@retCode <> 0) or (@oStatus <> 0)) return @retCode  select @trxDimID = aaTrxDimID, @dataType = aaDataType from AAG00400 where aaTrxDim = @iTrxDim if (@@rowcount <> 1) return 0  if (@@trancount = 0) begin select @transaction = 1 begin transaction end  if @dataType = 1  delete SY03900  from   SY03900 join AAG00401 on SY03900.NOTEINDX = AAG00401.NOTEINDX  where  aaTrxDimID = @trxDimID  if      @dataType = 1 delete from AAG00401 where aaTrxDimID = @trxDimID else if @dataType = 2 delete from AAG00402 where aaTrxDimID = @trxDimID else if @dataType = 3 delete from AAG00403 where aaTrxDimID = @trxDimID else delete from AAG00404 where aaTrxDimID = @trxDimID  if @dataType = 1 begin   delete SY03900  from   SY03900 join AAG00601 on SY03900.NOTEINDX = AAG00601.NOTEINDX  join AAG00600 on AAG00601.aaTreeID = AAG00600.aaTreeID  where  AAG00600.aaLinkType = 9  and  AAG00600.aaDimID    = @trxDimID  delete AAG00601  from   AAG00601 join AAG00600 on AAG00601.aaTreeID = AAG00600.aaTreeID  where  AAG00600.aaLinkType = 9  and  AAG00600.aaDimID    = @trxDimID  delete SY03900  from   SY03900 join AAG00600 on SY03900.NOTEINDX = AAG00600.NOTEINDX  where  AAG00600.aaLinkType = 9  and  AAG00600.aaDimID    = @trxDimID   delete from AAG00600  where  aaLinkType = 9  and  aaDimID = @trxDimID end  delete from AAG00202 where aaTrxDimID = @trxDimID  delete from AAG00405 where (aaTrxDimID = @trxDimID) or (aaRelTrxDimID = @trxDimID)  delete from AAG20003 where aaTrxDimID = @trxDimID  delete from AAG02001 where aaTrxDimID = @trxDimID  delete from AAG00406 where aaTrxDimID = @trxDimID or (aaRelTrxDimID = @trxDimID)  delete from AAG00301 where aaColumn = (@trxDimID +16384)  delete from AAG00302 where aaColumn = (@trxDimID +16384)  delete from AAG00303 where aaColumn = (@trxDimID +16384)  delete SY03900 from   SY03900 join AAG00400 on SY03900.NOTEINDX = AAG00400.NOTEINDX where  aaTrxDim = @iTrxDim  delete AAG00400 where aaTrxDim = @iTrxDim if (@transaction = 1) commit transaction return 0    
GO
GRANT EXECUTE ON  [dbo].[aagDelTrxDim] TO [DYNGRP]
GO
