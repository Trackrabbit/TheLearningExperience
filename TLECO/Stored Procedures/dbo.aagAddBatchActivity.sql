SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO
 CREATE PROC [dbo].[aagAddBatchActivity]  @I_cBatchSource char(15) = NULL,  @I_sWindowType smallint = NULL,  @I_cUserID char(15) = NULL,  @I_cCompanyName char(64) = NULL AS BEGIN  DECLARE  @TRUE                           tinyint,  @BATCH_AVAILABLE                smallint,  @BATCH_POSTING                  smallint,  @BATCH_PRINTING                 smallint,  @BATCH_POSTED_WITH_ERROR        smallint,  @BATCH_POSTING_INCOMPLETE       smallint,  @BATCH_PRINTING_INCOMPLETE      smallint,  @BATCH_UPDATING_INCOMPLETE      smallint,  @BATCH_RECURRING_INCOMPLETE     smallint,  @BACHNUMB char(15),  @BCHSOURC char(15),  @nRecExists smallint,  @COUNT smallint   SELECT  @TRUE                           = 1,  @BATCH_AVAILABLE                = 0,  @BATCH_POSTING                  = 1,  @BATCH_PRINTING                 = 5,  @BATCH_POSTED_WITH_ERROR        = 11,  @BATCH_POSTING_INCOMPLETE       = 7,  @BATCH_PRINTING_INCOMPLETE      = 8,  @BATCH_UPDATING_INCOMPLETE      = 9,  @BATCH_RECURRING_INCOMPLETE     = 10  DECLARE BATCHCUR cursor fast_forward FOR  SELECT BCHSOURC, BACHNUMB FROM SY00500 WHERE   BCHSOURC        = @I_cBatchSource  and     MKDTOPST        = @TRUE  and     USERID          = @I_cUserID  and     (BCHSTTUS       = @BATCH_AVAILABLE  or      BCHSTTUS        = @BATCH_POSTING_INCOMPLETE  or BCHSTTUS  = @BATCH_PRINTING)  OPEN BATCHCUR  FETCH NEXT FROM BATCHCUR INTO @BCHSOURC, @BACHNUMB  while @@fetch_status = 0  BEGIN   SELECT @COUNT = COUNT(*) FROM DYNAMICS.dbo.SY00800 WHERE BCHSOURC = @BCHSOURC AND BACHNUMB = @BACHNUMB  AND USERID = @I_cUserID  IF @COUNT = 0  insert   into   DYNAMICS.dbo.SY00800 (   WINTYPE,  USERID,  CMPNYNAM,  BCHSOURC,  BACHNUMB,  POSTING )  values(  @I_sWindowType,  @I_cUserID,  @I_cCompanyName,  @BCHSOURC,  @BACHNUMB,  @TRUE)  FETCH NEXT FROM BATCHCUR INTO @BCHSOURC, @BACHNUMB  END CLOSE BATCHCUR DEALLOCATE BATCHCUR END    
GO
GRANT EXECUTE ON  [dbo].[aagAddBatchActivity] TO [DYNGRP]
GO
