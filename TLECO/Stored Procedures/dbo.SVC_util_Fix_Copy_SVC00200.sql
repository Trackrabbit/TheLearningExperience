SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO
 CREATE PROCEDURE [dbo].[SVC_util_Fix_Copy_SVC00200] as declare @RecType smallint,@OldType smallint declare @Call char(11),@OldCall char(11),  @RATETPID char(15),  @EXGTBLID char(15),  @XCHGRATE numeric(19, 7),  @EXCHDATE datetime ,  @DECPLACS smallint ,  @TIME1 datetime ,  @RATECALC smallint,  @VIEWMODE smallint ,  @ISMCTRX smallint ,  @EXPNDATE datetime,  @DENXRATE numeric(19, 7),  @MCTRXSTT smallint   begin transaction    declare Fix_Copy_Service_cursor cursor for select SRVRECTYPE, CALLNBR,MSTRRECTYPE,MSTRCALLNBR  from SVC00200 where MSTRRECTYPE > 0  and  MSTRCALLNBR > '' and DECPLACS = 0  open Fix_Copy_Service_cursor  FETCH NEXT FROM Fix_Copy_Service_cursor INTO @RecType,@Call,@OldType,@OldCall  while @@FETCH_STATUS = 0  BEGIN  if exists(select * from SVC00200 where CALLNBR=@OldCall and SRVRECTYPE = @OldType)   BEGIN  select  @RATETPID=RATETPID,  @EXGTBLID=EXGTBLID,  @XCHGRATE=XCHGRATE,  @EXCHDATE=EXCHDATE,  @DECPLACS=DECPLACS,  @TIME1=TIME1,  @RATECALC=RATECALC,  @VIEWMODE=VIEWMODE,  @ISMCTRX=ISMCTRX,  @EXPNDATE=EXPNDATE,  @DENXRATE=DENXRATE,  @MCTRXSTT=MCTRXSTT  from SVC00200 where CALLNBR=@OldCall and SRVRECTYPE = @OldType  update SVC00200 set   RATETPID=@RATETPID,  EXGTBLID=@EXGTBLID,  XCHGRATE=@XCHGRATE,  EXCHDATE=@EXCHDATE,  DECPLACS=@DECPLACS,  TIME1=@TIME1,  RATECALC=@RATECALC,  VIEWMODE=@VIEWMODE,  ISMCTRX=@ISMCTRX,  EXPNDATE=@EXPNDATE,  DENXRATE=@DENXRATE,  MCTRXSTT=@MCTRXSTT  where CALLNBR=@Call and SRVRECTYPE = @RecType  select @RecType,@Call  END  FETCH NEXT FROM Fix_Copy_Service_cursor INTO @RecType,@Call,@OldType,@OldCall  END  deallocate Fix_Copy_Service_cursor  COMMIT TRANSACTION return(0) baderror:  rollback transaction  return (99)    
GO
GRANT EXECUTE ON  [dbo].[SVC_util_Fix_Copy_SVC00200] TO [DYNGRP]
GO
