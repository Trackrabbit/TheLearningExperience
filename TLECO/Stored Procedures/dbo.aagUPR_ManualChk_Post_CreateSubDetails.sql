SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO
 CREATE PROC [dbo].[aagUPR_ManualChk_Post_CreateSubDetails] @I_cUserID varchar(20), @I_EMPLOYID char(15), @iCompanyID SMALLINT AS Begin  DECLARE @lPYADNMBR int  DECLARE @lPYRLRTYP smallint  DECLARE @lAUCTRLCD char(13)  DECLARE @lHdrID int  DECLARE @Status SMALLINT  SELECT @lPYADNMBR = PYADNMBR, @lPYRLRTYP = PYRLRTYP, @lAUCTRLCD = AUCTRLCD   FROM UPR10209 dist INNER JOIN UPR10200 hdr ON dist.USERID = hdr.USERID  WHERE dist.USERID = @I_cUserID AND   EMPLOYID = @I_EMPLOYID  GROUP BY PYADNMBR, PYRLRTYP, AUCTRLCD  if @lPYADNMBR <> 0   begin  if exists(SELECT 1 FROM AAG20000 WHERE SERIES = 6 AND   DOCTYPE = 4 AND   DOCNUMBR = CONVERT(VARCHAR(21),@lPYADNMBR) AND   Master_ID = @I_EMPLOYID AND  PYRNTYPE = @lPYRLRTYP)  BEGIN  SELECT @lHdrID = aaSubLedgerHdrID FROM AAG20000 WHERE SERIES = 6 AND   DOCTYPE = 4 AND   DOCNUMBR = CONVERT(VARCHAR(21),@lPYADNMBR) AND   Master_ID = @I_EMPLOYID AND  PYRNTYPE = @lPYRLRTYP  UPDATE AAG20000 SET DOCNUMBR = @lAUCTRLCD,   DOCTYPE = 5  WHERE aaSubLedgerHdrID = @lHdrID  END  ELSE  BEGIN  EXEC DYNAMICS..aagGetNextID 20000, @iCompanyID, @lHdrID OUT, @Status OUT  INSERT INTO AAG20000(aaSubLedgerHdrID, SERIES, DOCTYPE, DOCNUMBR, Master_ID, PYRNTYPE)  VALUES(@lHdrID, 6, 5, LTRIM(RTRIM(@lAUCTRLCD)), LTRIM(RTRIM(@I_EMPLOYID)), @lPYRLRTYP)  END   EXEC aagCreateSubLedgerDistUPR @lHdrID, @lAUCTRLCD, @I_EMPLOYID, 1  end End    
GO
GRANT EXECUTE ON  [dbo].[aagUPR_ManualChk_Post_CreateSubDetails] TO [DYNGRP]
GO
