SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO
 Create Procedure [dbo].[SVC_Merge_PO](  @OLD_PO_Number char(17),  @OLD_PO_Line numeric(19,5),  @NEW_PO_Number char(17),  @NEW_PO_Line numeric(19,5)  ) as declare @Service_Call_Number char(11),  @Service_Call_Record_Type int,  @Service_Call_Equip_Line int,  @Service_Call_LineItemType char(3),  @Service_Call_LineItemSeq int,  @Service_Call_Status char(3),  @RTV_Number char(15),  @WO_Number char(15),  @WO_Record_Type smallint,  @User_ID char(15),  @Description char(30) select @User_ID = SYSTEM_USER select @Description = 'PO ' + @OLD_PO_Number + ' Merged to ' + @NEW_PO_Number  if @OLD_PO_Number = @NEW_PO_Number and @OLD_PO_Line = @NEW_PO_Line   return  if @OLD_PO_Number = NULL OR @NEW_PO_Number = NULL  return  select @Service_Call_Record_Type = SRVRECTYPE,  @Service_Call_Number = CALLNBR,  @Service_Call_Equip_Line = EQPLINE,  @Service_Call_LineItemType = LINITMTYP,  @Service_Call_LineItemSeq = LNITMSEQ  from SVC00203   where PONMBRSTR = @OLD_PO_Number and POLNSEQ = @OLD_PO_Line if @Service_Call_Number is not NULL BEGIN  update  SVC00203  set   PONMBRSTR = @NEW_PO_Number,   POLNSEQ = @NEW_PO_Line  where SRVRECTYPE = @Service_Call_Record_Type and  CALLNBR = @Service_Call_Number and  EQPLINE = @Service_Call_Equip_Line and  LINITMTYP = @Service_Call_LineItemType and  LNITMSEQ = @Service_Call_LineItemSeq  select @Service_Call_Status = SRVSTAT   from SVC00200   where  SRVRECTYPE = @Service_Call_Record_Type and  CALLNBR = @Service_Call_Number  exec SVC_Create_Service_Audit @Service_Call_Number, @Service_Call_Record_Type,  @Service_Call_Status, @User_ID, @Description  return END  select @RTV_Number   from SVC05601  where PONMBRSTR = @OLD_PO_Number and POLNSEQ = @OLD_PO_Line if @RTV_Number is not NULL  BEGIN  update SVC05601  set  PONMBRSTR = @NEW_PO_Number,  POLNSEQ = @OLD_PO_Line  where RTV_Number = @RTV_Number  return END  select @WO_Number = WORKORDNUM,  @WO_Record_Type = WORECTYPE  from SVC06101  where PONMBRSTR = @OLD_PO_Number and POLNSEQ = @OLD_PO_Line if @WO_Number is not NULL BEGIN  update SVC06101  set  PONMBRSTR = @NEW_PO_Number,  POLNSEQ   = @NEW_PO_Line  where   WORECTYPE = @WO_Record_Type and  WORKORDNUM = @WO_Number  return END    
GO
GRANT EXECUTE ON  [dbo].[SVC_Merge_PO] TO [DYNGRP]
GO
