SET QUOTED_IDENTIFIER OFF
GO
SET ANSI_NULLS ON
GO
 create proc [dbo].[sopTrxDeleteHistory]  (@SopType smallint=NULL, @SopNumber char(21)=NULL,@TrxSource char(13)=NULL,   @KeepHistory smallint=NULL, @KeepDistributionHistory smallint=NULL, @iErrorState int=NULL output)  AS  declare @tTransaction tinyint BEGIN  SET nocount on  SELECT @iErrorState = 0 IF @SopType=NULL or @SopNumber=NULL or @TrxSource=NULL BEGIN  SELECT @iErrorState = 21036  RETURN END  IF @@trancount = 0 BEGIN  select @tTransaction = 1   begin transaction  END  if @KeepHistory = 0 begin   DELETE FROM SOP10101  WHERE SOP10101.SOPTYPE = @SopType AND SOP10101.SOPNUMBE = @SopNumber AND SOP10101.TRXSORCE = @TrxSource    DELETE FROM SOP10103  WHERE SOP10103.SOPTYPE = @SopType AND SOP10103.SOPNUMBE = @SopNumber AND SOP10103.TRXSORCE = @TrxSource    DELETE FROM SOP10104  WHERE SOP10104.SOPTYPE = @SopType AND SOP10104.SOPNUMBE = @SopNumber AND SOP10104.TRXSORCE = @TrxSource    DELETE FROM SOP10105  WHERE SOP10105.SOPTYPE = @SopType AND SOP10105.SOPNUMBE = @SopNumber AND SOP10105.TRXSORCE = @TrxSource    DELETE FROM SOP10106  WHERE SOP10106.SOPTYPE = @SopType AND SOP10106.SOPNUMBE = @SopNumber      DELETE FROM SOP10107  WHERE SOP10107.SOPTYPE = @SopType AND SOP10107.SOPNUMBE = @SopNumber      DELETE FROM SOP10201  WHERE SOP10201.SOPTYPE = @SopType AND SOP10201.SOPNUMBE = @SopNumber AND SOP10201.TRXSORCE = @TrxSource    DELETE FROM SOP10202  WHERE SOP10202.SOPTYPE = @SopType AND SOP10202.SOPNUMBE = @SopNumber AND SOP10202.TRXSORCE = @TrxSource    DELETE FROM SOP30300  WHERE SOP30300.SOPTYPE = @SopType AND SOP30300.SOPNUMBE = @SopNumber AND SOP30300.TRXSORCE = @TrxSource    DELETE FROM SY04910  WHERE SY04910.DOCNUMBR = @SopNumber AND SY04910.DOCTYPE = @SopType AND SY04910.DICTRYID = 0 and SY04910.MODULE1 = 11    DELETE FROM SY04915  WHERE SY04915.DOCNUMBR = @SopNumber AND SY04915.DOCTYPE = @SopType AND SY04915.DICTRYID = 0 and SY04915.MODULE1 = 11  end  if @KeepHistory = 0 and @KeepDistributionHistory = 0 begin  DELETE FROM SOP10102 WHERE SOP10102.SOPTYPE = @SopType AND SOP10102.SOPNUMBE = @SopNumber AND SOP10102.TRXSORCE = @TrxSource    DELETE FROM SOP30200 WHERE SOP30200.SOPTYPE = @SopType AND SOP30200.SOPNUMBE = @SopNumber AND SOP30200.TRXSORCE = @TrxSource  end  if @tTransaction = 1  begin  commit transaction  end  end   
GO
GRANT EXECUTE ON  [dbo].[sopTrxDeleteHistory] TO [DYNGRP]
GO
