SET QUOTED_IDENTIFIER OFF
GO
SET ANSI_NULLS ON
GO
 CREATE PROCEDURE [dbo].[seeDetailCategoryAccountTransactionsMonthly_Create] @iLanguageID int   as   set nocount on   declare @sqldropstring varchar(400),   @sqlstring1 varchar(8000),   @sqlstring2 varchar(8000),   @sqlstring3 varchar(8000),   @sqlstring4 varchar(8000),   @sqlstring5 varchar(8000),   @sqlstring6 varchar(8000),   @sqlstring7 varchar(8000),   @sqlstring8 varchar(8000),   @sqlstring9 varchar(8000),   @sqlstring10 varchar(8000),   @sqljoinstring varchar(8000),   @sqlaccessstring varchar(2000),   @tNumberSegments int,   @tSegment int,   @I_iDictID int,   @I_iLangID int,   @I_iMessageNumber int,   @I_iAliasMessageNumber int,   @I_iIntegerValue int,  @TRX_Date varchar(255), @Source_Document varchar(255), @Account_Category_Number varchar(255)  select @I_iDictID = 1493 select @I_iMessageNumber = 24445 select @I_iAliasMessageNumber = 0 exec DYNAMICS..smGetBIMsgStringForProcs  @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @Source_Document output   select @I_iDictID = 1493 select @I_iMessageNumber = 24447 select @I_iAliasMessageNumber = 0 exec DYNAMICS..smGetBIMsgStringForProcs  @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @TRX_Date output  select @I_iDictID = 1493 select @I_iMessageNumber = 22507 select @I_iAliasMessageNumber = 0 exec DYNAMICS..smGetBIMsgStringForProcs  @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @Account_Category_Number output    select @sqldropstring =   'IF EXISTS (SELECT * FROM   sys.objects WHERE  object_id = OBJECT_ID(N''[dbo].[seeDetailCategoryAccountTransactionsMonthly]'') AND type in ( N''P'', N''PC'' ))  ' +   '  DROP PROCEDURE [dbo].[seeDetailCategoryAccountTransactionsMonthly]  '   select @sqlstring1 =   'create procedure seeDetailCategoryAccountTransactionsMonthly '+   '@UserDate datetime = NULL, '+   '@I_iPeriodMonths int = NULL, '+   '@I_iAccountCategory int = NULL '+   'as  '+   'set nocount ON '+   'declare   '+   ' @dtStart datetime, '+   ' @dtStartCurrentMonth datetime, '+   ' @dtEnd datetime '+   'select @dtStartCurrentMonth = DATEADD(mm, DATEDIFF(mm,0,@UserDate), 0) '+   'select @dtStart = DATEADD(mm,-@I_iPeriodMonths+1,@dtStartCurrentMonth) '+   'select @dtEnd = DATEADD(ms,-3,DATEADD(mm, DATEDIFF(m,0,@UserDate)+1, 0)) '+   'select SOURCDOC,SDOCDSCR,* from AccountTransactions,SY00900 '+   'where '+   '['+@TRX_Date+'] >= @dtStart and ['+@TRX_Date+'] <= @dtEnd and '+   '['+@Account_Category_Number+'] = dbo.DYN_FUNC_Account_Category_Number(@I_iAccountCategory) and '+   '['+@Source_Document+'] = SOURCDOC '+   'order by ['+@TRX_Date+'] asc '+   'set nocount OFF '+   'RETURN '  select @sqlaccessstring =   'GRANT execute ON [dbo].[seeDetailCategoryAccountTransactionsMonthly] TO [rpt_accounting manager], [rpt_executive], [rpt_accounts payable coordinator], [rpt_accounts receivable coordinator], [rpt_collections manager], [rpt_order processor]'   exec (@sqldropstring)   exec (@sqlstring1+' '+@sqlstring2+' '+@sqlstring3+' '+@sqlstring4+' '+@sqlstring5+' '+@sqlstring6+' '+@sqlstring7+' '+@sqlstring8+' '+@sqlstring9+' '+@sqlstring10)   exec (@sqlaccessstring)   set nocount off    
GO
GRANT EXECUTE ON  [dbo].[seeDetailCategoryAccountTransactionsMonthly_Create] TO [DYNGRP]
GO
