SET QUOTED_IDENTIFIER OFF
GO
SET ANSI_NULLS ON
GO
 CREATE PROCEDURE [dbo].[sp_Dynamics_MultidimensionalAnalysis] @iLanguageID int  as  set nocount on   declare @sqldropstring varchar(400),  @sqldefaultstring varchar(8000),  @sqlstring1 varchar(8000),  @sqlstring2 varchar(8000),  @sqlstring3 varchar(8000),  @sqlstring4 varchar(8000),  @sqlstring5 varchar(8000),  @sqlstring6 varchar(8000),  @sqlstring7 varchar(8000),  @sqlstring8 varchar(8000),  @sqlstring9 varchar(8000),  @sqlstring10 varchar(8000),  @sqljoinstring varchar(8000),  @sqlaccessstring varchar(2000),  @tNumberSegments int,  @tSegment int,  @I_iDictID int,  @I_iLangID int,  @I_iMessageNumber int,  @I_iAliasMessageNumber int,  @I_iIntegerValue int,  @DTA_Series varchar(255), @DTA_Reference varchar(255), @Account_Index varchar(255), @Sequence_Number varchar(255), @DTA_Group_ID varchar(255), @DTA_GL_Reference varchar(255), @Document_Number varchar(255), @RM_Document_Type_All varchar(255), @DTA_Group_Amount varchar(255), @Journal_Entry varchar(255), @TRX_Date varchar(255), @Posting_Status varchar(255), @DTA_Code_ID varchar(255), @DTA_Posting_Descr varchar(255), @DTA_Quantity varchar(255), @DTA_Amount varchar(255), @Account_Number varchar(255), @DrillBack_Base_Url varchar(255), @Account_Number_For_DrillBack varchar(255), @Journal_Entry_For_DrillBack varchar(255)  select @DrillBack_Base_Url = DYNAMICS.dbo.createBaseDrillBackUrlString(DB_NAME(),0)  select @I_iDictID = 1493 select @I_iMessageNumber = 24600 select @I_iAliasMessageNumber = 0 exec DYNAMICS..smGetBIMsgString  @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @DTA_Series output  select @I_iDictID = 1493 select @I_iMessageNumber = 24601 select @I_iAliasMessageNumber = 0 exec DYNAMICS..smGetBIMsgString  @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @DTA_Reference output  select @I_iDictID = 1493 select @I_iMessageNumber = 24602 select @I_iAliasMessageNumber = 0 exec DYNAMICS..smGetBIMsgString  @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @Account_Index output  select @I_iDictID = 1493 select @I_iMessageNumber = 24603 select @I_iAliasMessageNumber = 0 exec DYNAMICS..smGetBIMsgString  @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @Sequence_Number output  select @I_iDictID = 1493 select @I_iMessageNumber = 24604 select @I_iAliasMessageNumber = 0 exec DYNAMICS..smGetBIMsgString  @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @DTA_Group_ID output  select @I_iDictID = 1493 select @I_iMessageNumber = 24605 select @I_iAliasMessageNumber = 0 exec DYNAMICS..smGetBIMsgString  @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @DTA_GL_Reference output  select @I_iDictID = 1493 select @I_iMessageNumber = 24606 select @I_iAliasMessageNumber = 0 exec DYNAMICS..smGetBIMsgString  @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @Document_Number output  select @I_iDictID = 1493 select @I_iMessageNumber = 24607 select @I_iAliasMessageNumber = 0 exec DYNAMICS..smGetBIMsgString  @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @RM_Document_Type_All output  select @I_iDictID = 1493 select @I_iMessageNumber = 24608 select @I_iAliasMessageNumber = 0 exec DYNAMICS..smGetBIMsgString  @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @DTA_Group_Amount output  select @I_iDictID = 1493 select @I_iMessageNumber = 24609 select @I_iAliasMessageNumber = 0 exec DYNAMICS..smGetBIMsgString  @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @Journal_Entry output  select @I_iDictID = 1493 select @I_iMessageNumber = 24610 select @I_iAliasMessageNumber = 0 exec DYNAMICS..smGetBIMsgString  @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @TRX_Date output  select @I_iDictID = 1493 select @I_iMessageNumber = 24611 select @I_iAliasMessageNumber = 0 exec DYNAMICS..smGetBIMsgString  @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @Posting_Status output  select @I_iDictID = 1493 select @I_iMessageNumber = 24612 select @I_iAliasMessageNumber = 0 exec DYNAMICS..smGetBIMsgString  @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @DTA_Code_ID output  select @I_iDictID = 1493 select @I_iMessageNumber = 24613 select @I_iAliasMessageNumber = 0 exec DYNAMICS..smGetBIMsgString  @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @DTA_Posting_Descr output  select @I_iDictID = 1493 select @I_iMessageNumber = 24614 select @I_iAliasMessageNumber = 0 exec DYNAMICS..smGetBIMsgString  @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @DTA_Quantity output  select @I_iDictID = 1493 select @I_iMessageNumber = 24615 select @I_iAliasMessageNumber = 0 exec DYNAMICS..smGetBIMsgString  @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @DTA_Amount output  select @I_iDictID = 1493 select @I_iMessageNumber = 24616 select @I_iAliasMessageNumber = 0 exec DYNAMICS..smGetBIMsgString  @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @Account_Number output   select @I_iDictID = 1493 select @I_iMessageNumber = 24616 select @I_iAliasMessageNumber = 22214 exec DYNAMICS..smGetBIMsgString  @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @Account_Number_For_DrillBack output   select @I_iDictID = 1493 select @I_iMessageNumber = 24609 select @I_iAliasMessageNumber = 22214 exec DYNAMICS..smGetBIMsgString  @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @Journal_Entry_For_DrillBack output   select @sqldropstring =   'if exists (select * from dbo.sysobjects where id = object_id(N''[dbo].[MultidimensionalAnalysis]'') and OBJECTPROPERTY(id, N''IsView'') = 1) ' +  'drop view [dbo].[MultidimensionalAnalysis] '  select @sqldefaultstring =   'CREATE VIEW MultidimensionalAnalysis AS ' +   'select ' +   'rtrim([''Transaction Analysis Codes''].[GROUPID]) as ''' + @DTA_Group_ID + ''', ' + 'rtrim([''Transaction Analysis Codes''].[DOCNUMBR]) as ''' + @Document_Number + ''', ' + '[''Transaction Analysis Groups''].[GROUPAMT] as ''' + @DTA_Group_Amount + ''', ' + '[''Transaction Analysis Groups''].[JRNENTRY] as ''' + @Journal_Entry + ''', ' + '[''Transaction Analysis Codes''].[TRXDATE] as ''' + @TRX_Date + ''', ' + 'rtrim([''Transaction Analysis Codes''].[CODEID]) as ''' + @DTA_Code_ID + ''', ' + '[''Transaction Analysis Codes''].[DTAQNTY] as ''' + @DTA_Quantity + ''', ' + '[''Transaction Analysis Codes''].[CODEAMT] as ''' + @DTA_Amount + ''', ' + '(select rtrim([ACTNUMST]) from [GL00105] as [''Account Index Master''] where [''Account Index Master''].[ACTINDX] = [''Transaction Analysis Codes''].[ACTINDX]) as ''' + @Account_Number + ''', '   select @sqlstring1 =   '[''Transaction Analysis Codes''].[ACTINDX] as ''' + @Account_Index + ''', ' +  'rtrim([''Transaction Analysis Groups''].[DTA_GL_Reference]) as ''' + @DTA_GL_Reference + ''', ' +  'rtrim([''Transaction Analysis Codes''].[POSTDESC]) as ''' + @DTA_Posting_Descr + ''', ' +  'rtrim([''Transaction Analysis Codes''].[DTAREF]) as ''' + @DTA_Reference + ''', ' +  '''' + @DTA_Series + ''' = dbo.DYN_FUNC_DTA_Series([''Transaction Analysis Codes''].[DTASERIES]), ' +  '''' + @Posting_Status + ''' = dbo.DYN_FUNC_Posting_Status_MDA([''Transaction Analysis Groups''].[PSTGSTUS]), ' +  '''' + @RM_Document_Type_All + ''' = dbo.DYN_FUNC_RM_Document_TypeAll([''Transaction Analysis Codes''].[RMDTYPAL]), ' +  '[''Transaction Analysis Codes''].[SEQNUMBR] as ''' + @Sequence_Number + ''', ' + '''' + @Account_Number_For_DrillBack + ''' = ''' + @DrillBack_Base_Url + ''' +dbo.dgppAccountIndex(1,[''Transaction Analysis Codes''].[ACTINDX] ), '+ '''' + @Journal_Entry_For_DrillBack + ''' = ''' + @DrillBack_Base_Url + ''' +dbo.dgppJournalEntry(1,[''Transaction Analysis Groups''].[JRNENTRY],0.0,[''Transaction Analysis Groups''].[PSTGSTUS],1  ) '  select @sqljoinstring =   'from [DTA10200] as [''Transaction Analysis Codes''] with (NOLOCK) '   + 'left outer join [DTA10100] as [''Transaction Analysis Groups''] with (NOLOCK) on '   + '[''Transaction Analysis Codes''].[DTASERIES] = [''Transaction Analysis Groups''].[DTASERIES] '   + ' and [''Transaction Analysis Codes''].[DTAREF] = [''Transaction Analysis Groups''].[DTAREF] '   + ' and [''Transaction Analysis Codes''].[ACTINDX] = [''Transaction Analysis Groups''].[ACTINDX] '   + ' and [''Transaction Analysis Codes''].[SEQNUMBR] = [''Transaction Analysis Groups''].[SEQNUMBR] '   + ' and [''Transaction Analysis Codes''].[GROUPID] = [''Transaction Analysis Groups''].[GROUPID] '   select @sqlaccessstring =   'GRANT SELECT ON [dbo].[MultidimensionalAnalysis] TO [rpt_bookkeeper]' + 'GRANT SELECT ON [dbo].[MultidimensionalAnalysis] TO [rpt_executive]' + 'GRANT SELECT ON [dbo].[MultidimensionalAnalysis] TO [rpt_certified accountant]'   exec (@sqldropstring)  exec (@sqldefaultstring+' '+@sqlstring1+' '+@sqlstring2+' '+@sqlstring3+' '+@sqlstring4+' '+@sqlstring5+' '+@sqlstring6+' '+@sqlstring7+' '+@sqlstring8+' '+@sqlstring9+' '+@sqlstring10+' '+@sqljoinstring)  exec (@sqlaccessstring)   set nocount off    
GO
GRANT EXECUTE ON  [dbo].[sp_Dynamics_MultidimensionalAnalysis] TO [DYNGRP]
GO
