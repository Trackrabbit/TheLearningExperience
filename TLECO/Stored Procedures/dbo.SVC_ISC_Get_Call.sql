SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO
 CREATE procedure [dbo].[SVC_ISC_Get_Call]  (@srvrectype int, @callnbr char(11))  as if exists (select * from SVC00200 where CALLNBR = @callnbr and SRVRECTYPE = @srvrectype) begin SELECT   SVC00200.CALLNBR,   SVC00200.ADRSCODE,  SVC00200.CUSTNMBR,  RM00101.CUSTNAME,   SVC00200.ADDRESS1,  SVC00200.ADDRESS2,  SVC00200.CITY,  SVC00200.STATE,  SVC00200.ZIP,  SVC00913.STSDESCR 'SRVSTAT',   SVC00200.SRVTYPE,  SVC00200.PHONE1,   SVC00200.SVCDESCR,   SVC00200.CNTCPRSN,  RTRIM(SVC00200.CITY) + ', ' + RTRIM(SVC00200.STATE) + '   ' + RTRIM(SVC00200.ZIP) 'FULLCITY',  CONVERT(varchar(10),SVC00200.ENTDTE,101) 'ENTDTE',  CONVERT(varchar(10),SVC00200.ENTTME,108) 'ENTTME',  CONVERT(char(10),SVC00200.ENTDTE,101) + ' ' + CONVERT(char(5),SVC00200.ENTTME,108) 'ENTERED',  CONVERT(char(10),SVC00200.COMPDTE,101) + ' ' + CONVERT(char(5), SVC00200.COMPTME,108) 'COMPLETE',  SVC00200.PORDNMBR,  SVC00202.EQUIPID,  SVC00202.ITEMNMBR,   IV00101.ITEMDESC,  SVC00300.SERLNMBR,  SVC00201.PROBCDE,  SVC00200.PRETAXTOT,  CONVERT(varchar(10),SVC00200.ETADTE,101) 'ETADTE',  CONVERT(varchar(10),SVC00200.ETATME,108) 'ETATME', SY03900.TXTFIELD,   SVC00200.LABSTOTPRC,   SVC00200.PARSTOTPRC,   SVC00200.MSCSTOTPRC,  SVC00907.DSCRIPTN 'ProblemDescription'   , CONVERT(char(10),SVC00200.ARRIVDTE,102) + ' ' + CONVERT(char(5),SVC00200.ARRIVTME,108) 'ARRIVED', CONVERT(varchar(10),SVC00200.ARRIVDTE,101) 'ARRIVDTE', CONVERT(varchar(10),SVC00200.ARRIVTME,108) 'ARRIVTME', CONVERT(varchar(10),SVC00200.COMPDTE,101) 'COMPDTE', CONVERT(varchar(10),SVC00200.COMPTME,108) 'COMPTME',  SVC00200.CONTNBR,  SVC00200.ADDRESS3, SVC00200.SVC_Contract_Line_SEQ FROM SVC00200 LEFT OUTER JOIN   RM00101 on (SVC00200.CUSTNMBR = RM00101.CUSTNMBR) LEFT OUTER JOIN  SY03900 ON (SVC00200.NOTEINDX = SY03900.NOTEINDX) LEFT OUTER JOIN  SVC00201 ON (SVC00200.SRVRECTYPE = SVC00201.SRVRECTYPE and SVC00200.CALLNBR = SVC00201.CALLNBR) LEFT OUTER JOIN  SVC00202 ON (SVC00200.SRVRECTYPE = SVC00202.SRVRECTYPE and SVC00200.CALLNBR = SVC00202.CALLNBR) LEFT OUTER JOIN  SVC00300 ON (SVC00202.EQUIPID = SVC00300.EQUIPID) LEFT OUTER JOIN  SVC00913 ON (SVC00200.SRVSTAT = SVC00913.SRVSTAT) LEFT OUTER JOIN  IV00101 ON (SVC00201.ITEMNMBR = IV00101.ITEMNMBR) LEFT OUTER JOIN  SVC00907 ON (SVC00201.PROBCDE = SVC00907.PROBCDE)  where  SVC00200.SRVRECTYPE = @srvrectype and  SVC00200.CALLNBR = @callnbr  end  else  if exists (select * from SVC30200 where CALLNBR = @callnbr and SRVRECTYPE = @srvrectype)  begin SELECT   SVC30200.CALLNBR,   SVC30200.ADRSCODE,  SVC30200.CUSTNMBR,  RM00101.CUSTNAME,   SVC30200.ADDRESS1,  SVC30200.ADDRESS2,  SVC30200.CITY,  SVC30200.STATE,  SVC30200.ZIP,  SVC00913.STSDESCR 'SRVSTAT',   SVC30200.SRVTYPE,  SVC30200.PHONE1,   SVC30200.SVCDESCR,   SVC30200.CNTCPRSN,  RTRIM(SVC30200.CITY) + ', ' + RTRIM(SVC30200.STATE) + '   ' + RTRIM(SVC30200.ZIP) 'FULLCITY',  CONVERT(varchar(10),SVC30200.ENTDTE,101) 'ENTDTE',  CONVERT(varchar(10),SVC30200.ENTTME,108) 'ENTTME',  CONVERT(char(10),SVC30200.ENTDTE,101) + ' ' + CONVERT(char(5),SVC30200.ENTTME,108) 'ENTERED',  CONVERT(char(10),SVC30200.COMPDTE,101) + ' ' + CONVERT(char(5), SVC30200.COMPTME,108) 'COMPLETE',  SVC30200.PORDNMBR,  SVC30202.EQUIPID,  SVC30202.ITEMNMBR,   IV00101.ITEMDESC,  SVC00300.SERLNMBR,  SVC30201.PROBCDE,  SVC30200.PRETAXTOT,  CONVERT(varchar(10),SVC30200.ETADTE,101) 'ETADTE',  CONVERT(varchar(10),SVC30200.ETATME,108) 'ETATME', SY03900.TXTFIELD,   SVC30200.LABSTOTPRC,   SVC30200.PARSTOTPRC,   SVC30200.MSCSTOTPRC,  SVC00907.DSCRIPTN 'ProblemDescription'   , CONVERT(char(10),SVC30200.ARRIVDTE,102) + ' ' + CONVERT(char(5),SVC30200.ARRIVTME,108) 'ARRIVED', CONVERT(varchar(10),SVC30200.ARRIVDTE,101) 'ARRIVDTE', CONVERT(varchar(10),SVC30200.ARRIVTME,108) 'ARRIVTME', CONVERT(varchar(10),SVC30200.COMPDTE,101) 'COMPDTE', CONVERT(varchar(10),SVC30200.COMPTME,108) 'COMPTME',  SVC30200.CONTNBR,  SVC30200.ADDRESS3, SVC30200.SVC_Contract_Line_SEQ FROM SVC30200 LEFT OUTER JOIN   RM00101 on (SVC30200.CUSTNMBR = RM00101.CUSTNMBR) LEFT OUTER JOIN  SY03900 ON (SVC30200.NOTEINDX = SY03900.NOTEINDX) LEFT OUTER JOIN  SVC30201 ON (SVC30200.SRVRECTYPE = SVC30201.SRVRECTYPE and SVC30200.CALLNBR = SVC30201.CALLNBR) LEFT OUTER JOIN  SVC30202 ON (SVC30200.SRVRECTYPE = SVC30202.SRVRECTYPE and SVC30200.CALLNBR = SVC30202.CALLNBR) LEFT OUTER JOIN  SVC00300 ON (SVC30202.EQUIPID = SVC00300.EQUIPID) LEFT OUTER JOIN  SVC00913 ON (SVC30200.SRVSTAT = SVC00913.SRVSTAT) LEFT OUTER JOIN  IV00101 ON (SVC30201.ITEMNMBR = IV00101.ITEMNMBR) LEFT OUTER JOIN  SVC00907 ON (SVC30201.PROBCDE = SVC00907.PROBCDE)  where  SVC30200.SRVRECTYPE = @srvrectype and  SVC30200.CALLNBR = @callnbr  end  return    
GO
GRANT EXECUTE ON  [dbo].[SVC_ISC_Get_Call] TO [DYNGRP]
GO
