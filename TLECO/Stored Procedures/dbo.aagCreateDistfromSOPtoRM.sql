SET QUOTED_IDENTIFIER OFF
GO
SET ANSI_NULLS ON
GO
 create        procedure [dbo].[aagCreateDistfromSOPtoRM] @HdrID int , @CompanyID smallint as begin  declare @SERIES smallint,  @DOCTYPE smallint,  @DOCNUMBR char(21),  @aaSubLedgerHdrID  int   select  @SERIES = 0,  @DOCTYPE = 0,  @DOCNUMBR = '',  @aaSubLedgerHdrID = 0   Select @SERIES  = SERIES , @DOCTYPE = DOCTYPE ,  @DOCNUMBR = DOCNUMBR  from AAG20000  where aaSubLedgerHdrID = @HdrID   if @SERIES = 11   begin  if @DOCTYPE = 3   set @DOCTYPE = 1  else if @DOCTYPE = 4   set @DOCTYPE = 8  exec DYNAMICS.dbo.aagGetNextID 20000, @CompanyID, @aaSubLedgerHdrID output   insert into AAG20000   (aaSubLedgerHdrID, SERIES, DOCTYPE, DOCNUMBR, Master_ID, aaHdrErrors)  Select @aaSubLedgerHdrID, 3 , @DOCTYPE, @DOCNUMBR, Master_ID, aaHdrErrors   from AAG20000  where aaSubLedgerHdrID = @HdrID   insert into AAG20001  (aaSubLedgerHdrID, aaSubLedgerDistID, INTERID, CorrespondingUnit, ACTINDX,  DISTTYPE, ACCTTYPE, aaBrowseType, DECPLACS, DEBITAMT, CRDTAMNT,  ORDBTAMT, ORCRDAMT, CURNCYID, CURRNIDX, RATETPID, EXGTBLID,  XCHGRATE, EXCHDATE, TIME1, RTCLCMTD, DENXRATE, MCTRXSTT,   SEQNUMBR, GLPOSTDT, aaCustID, aaVendID, aaSiteID, aaItemID, aaCopyStatus,  aaWinWasOpen, POSTED, HISTORY, aaDistErrors, APTVCHNM, APTODCTY,  aaFutureDist, aaOffsetAcct, ITEMNMBR, TRXLOCTN, BINNMBR, TRNSTLOC,TRXQTY,  aaChangeDate,aaChangeTime)  Select @aaSubLedgerHdrID, aaSubLedgerDistID, INTERID, CorrespondingUnit, ACTINDX,  DISTTYPE, ACCTTYPE, aaBrowseType, DECPLACS, DEBITAMT, CRDTAMNT,  ORDBTAMT, ORCRDAMT, CURNCYID, CURRNIDX, RATETPID, EXGTBLID,  XCHGRATE, EXCHDATE, TIME1, RTCLCMTD, DENXRATE, MCTRXSTT,   SEQNUMBR, GLPOSTDT, aaCustID, aaVendID, aaSiteID, aaItemID, aaCopyStatus,  aaWinWasOpen, POSTED, HISTORY, aaDistErrors, APTVCHNM, APTODCTY,  aaFutureDist, aaOffsetAcct, ITEMNMBR, TRXLOCTN, BINNMBR, TRNSTLOC,TRXQTY,  convert(char(12), getdate(), 102),convert(char(12), getdate(), 108)  from AAG20001 where aaSubLedgerHdrID = @HdrID and aaSubLedgerDistID >= 0   insert into AAG20002   (aaSubLedgerHdrID, aaSubLedgerDistID, aaSubLedgerAssignID, DEBITAMT,  CRDTAMNT, ORDBTAMT, ORCRDAMT, aaAssignedPercent, DistRef,   NOTEINDX, aaAssignErrors, aaAliasID)  Select   @aaSubLedgerHdrID, aaSubLedgerDistID, aaSubLedgerAssignID, DEBITAMT,  CRDTAMNT, ORDBTAMT, ORCRDAMT, aaAssignedPercent, DistRef,   NOTEINDX, aaAssignErrors, aaAliasID  from AAG20002 where aaSubLedgerHdrID = @HdrID and  aaSubLedgerDistID  >= 0 and  aaSubLedgerAssignID >= 0   insert into AAG20003  (aaSubLedgerHdrID, aaSubLedgerDistID, aaSubLedgerAssignID, aaTrxDimID,  aaTrxCodeID, aaCodeErrors)  Select   @aaSubLedgerHdrID, aaSubLedgerDistID, aaSubLedgerAssignID, aaTrxDimID,  aaTrxCodeID, aaCodeErrors  from AAG20003  where  aaSubLedgerHdrID = @HdrID and  aaSubLedgerDistID  >= 0 and  aaSubLedgerAssignID >= 0 and aaTrxDimID >=0    end  end     
GO
GRANT EXECUTE ON  [dbo].[aagCreateDistfromSOPtoRM] TO [DYNGRP]
GO
