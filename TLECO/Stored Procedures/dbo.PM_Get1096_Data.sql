SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO
CREATE PROCEDURE [dbo].[PM_Get1096_Data]  (  @VendorFrom VARCHAR(50),  @VendorTo VARCHAR(50),  @Year SMALLINT,  @Type1099 SMALLINT ) AS BEGIN  DECLARE @TotFrmCount INT,  @FedTaxWithHeld NUMERIC(19,5),  @TotFrmAmt NUMERIC(19,5)  IF @Type1099 =0   BEGIN  SELECT @TotFrmCount=COUNT(DISTINCT VENDORID) FROM PM00204 A WHERE A.VENDORID >=@VendorFrom AND  A.VENDORID <=@VendorTo AND A.YEAR1=@Year  AND A.TEN99TYPE=@Type1099 +2 AND A.TEN99AMNT >= (SELECT DOLRAMNT FROM PM40104 B WHERE B.TEN99TYPE = A.TEN99TYPE -1 AND B.TEN99BOXNUMBER = A.TEN99BOXNUMBER ) AND A.TEN99BOXNUMBER IN (1,3,7,8,11,12,13)  SELECT @FedTaxWithHeld=SUM(A.TEN99AMNT) FROM PM00204 A WHERE A.VENDORID >=@VendorFrom AND A.VENDORID <=@VendorTo AND A.YEAR1=@Year AND A.TEN99TYPE=@Type1099 +2  AND A.TEN99BOXNUMBER = 8 AND A.TEN99AMNT >= (SELECT DOLRAMNT FROM PM40104 B WHERE B.TEN99TYPE = A.TEN99TYPE -1 AND B.TEN99BOXNUMBER = A.TEN99BOXNUMBER )  SELECT @TotFrmAmt=SUM(A.TEN99AMNT) FROM PM00204 A WHERE A.VENDORID >=@VendorFrom AND A.VENDORID <=@VendorTo AND A.YEAR1=@Year AND A.TEN99TYPE=@Type1099 +2  AND A.TEN99BOXNUMBER IN (1,3,7,11,12,13) AND A.TEN99AMNT >= (SELECT DOLRAMNT FROM PM40104 B WHERE B.TEN99TYPE = A.TEN99TYPE -1 AND B.TEN99BOXNUMBER = A.TEN99BOXNUMBER )  END  IF @Type1099 =1   BEGIN  SELECT @TotFrmCount=COUNT(DISTINCT VENDORID) FROM PM00204 A WHERE A.VENDORID >=@VendorFrom AND  A.VENDORID <=@VendorTo AND A.YEAR1=@Year  AND A.TEN99TYPE=@Type1099 +2 AND A.TEN99AMNT >= (SELECT DOLRAMNT FROM PM40104 B WHERE B.TEN99TYPE = A.TEN99TYPE -1 AND B.TEN99BOXNUMBER = A.TEN99BOXNUMBER ) AND A.TEN99BOXNUMBER IN (1,3,4,7)  SELECT @FedTaxWithHeld=SUM(A.TEN99AMNT) FROM PM00204 A WHERE A.VENDORID >=@VendorFrom AND A.VENDORID <=@VendorTo AND A.YEAR1=@Year AND A.TEN99TYPE=@Type1099 +2  AND A.TEN99BOXNUMBER = 4 AND A.TEN99AMNT >= (SELECT DOLRAMNT FROM PM40104 B WHERE B.TEN99TYPE = A.TEN99TYPE -1 AND B.TEN99BOXNUMBER = A.TEN99BOXNUMBER )  SELECT @TotFrmAmt=SUM(A.TEN99AMNT) FROM PM00204 A WHERE A.VENDORID >=@VendorFrom AND A.VENDORID <=@VendorTo AND A.YEAR1=@Year AND A.TEN99TYPE=@Type1099 +2 AND A.TEN99BOXNUMBER IN (1,3,7) AND A.TEN99AMNT >= (SELECT DOLRAMNT FROM PM40104 B WHERE B.TEN99TYPE = A.TEN99TYPE -1 AND B.TEN99BOXNUMBER = A.TEN99BOXNUMBER )  END  IF @Type1099 =2   BEGIN  SELECT @TotFrmCount=COUNT(DISTINCT VENDORID) FROM PM00204 A WHERE A.VENDORID >=@VendorFrom AND  A.VENDORID <=@VendorTo AND A.YEAR1=@Year  AND A.TEN99TYPE=@Type1099 +2 AND A.TEN99AMNT >= (SELECT DOLRAMNT FROM PM40104 B WHERE B.TEN99TYPE = A.TEN99TYPE -1 AND B.TEN99BOXNUMBER = A.TEN99BOXNUMBER ) AND A.TEN99BOXNUMBER IN (1,2,3,4,5,6,7,8,9,10,11)  SELECT @FedTaxWithHeld=SUM(A.TEN99AMNT) FROM PM00204 A WHERE A.VENDORID >=@VendorFrom AND A.VENDORID <=@VendorTo AND A.YEAR1=@Year AND A.TEN99TYPE=@Type1099 +2  AND A.TEN99BOXNUMBER = 4 AND A.TEN99AMNT >= (SELECT DOLRAMNT FROM PM40104 B WHERE B.TEN99TYPE = A.TEN99TYPE -1 AND B.TEN99BOXNUMBER = A.TEN99BOXNUMBER )  SELECT @TotFrmAmt=SUM(A.TEN99AMNT) FROM PM00204 A WHERE A.VENDORID >=@VendorFrom AND A.VENDORID <=@VendorTo AND A.YEAR1=@Year AND A.TEN99TYPE=@Type1099 +2  AND A.TEN99BOXNUMBER IN (1,2,3,5,6,7,8,9,10,11) AND A.TEN99AMNT >= (SELECT DOLRAMNT FROM PM40104 B WHERE B.TEN99TYPE = A.TEN99TYPE -1 AND B.TEN99BOXNUMBER = A.TEN99BOXNUMBER )  END  SELECT @TotFrmCount as TotFrmCount ,@FedTaxWithHeld as FedTaxWithHeld,@TotFrmAmt as TotFrmAmt End   
GO
GRANT EXECUTE ON  [dbo].[PM_Get1096_Data] TO [DYNGRP]
GO
