SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO
 CREATE PROCEDURE [dbo].[SVC_Set_Contract_Amount_Totals]  @CONSTS smallint,  @CONTNBR char(11) AS declare @RETAINAGE numeric(19,2) declare @RETAINAGEBILLED numeric(19,2) declare @BLOCKTIME numeric(19,2) declare @TIMEVALUE numeric(19,2) declare @ACTUALCALLS numeric(19,2) declare @VALUECALLS numeric(19,2) declare @MAXCALLS numeric(19,2) declare @ORIGRETAINAGE numeric(19,2) declare @ORIGRETAINAGEBILLED numeric(19,2) declare @ORIGTIMEVALUE numeric(19,2) declare @ORIGVALUECALLS numeric(19,2) declare @ORIGUNITCOSTTOTAL numeric(19,2) declare @Unit_Cost_Total numeric(19,2) BEGIN TRANSACTION SELECT @RETAINAGE = ISNULL(SUM(SVC00601.RETNAGAM),0),  @RETAINAGEBILLED = ISNULL(SUM(SVC00601.RTNBILLD),0),  @ORIGRETAINAGE = ISNULL(SUM(SVC00601.ORIGRETNAGAM),0),  @ORIGRETAINAGEBILLED = ISNULL(SUM(SVC00601.ORIGRTNBILLD),0),  @BLOCKTIME = ISNULL(SUM(SVC00601.BLKTIM),0),  @TIMEVALUE = ISNULL(SUM(SVC00601.VALTIM),0),  @ORIGTIMEVALUE = ISNULL(SUM(SVC00601.ORIGVALTIM),0),   @ACTUALCALLS = ISNULL(SUM(SVC00601.ACTCAL),0),  @VALUECALLS = ISNULL(SUM(SVC00601.TOTVALCAL),0),  @ORIGVALUECALLS = ISNULL(SUM(SVC00601.ORIGTOTVALCAL),0),   @MAXCALLS = ISNULL(SUM(SVC00601.NBRCAL),0)  FROM SVC00601  WHERE (SVC00601.CONSTS = @CONSTS AND SVC00601.CONTNBR = @CONTNBR AND  SVC00601.Contract_Line_Status <> 'C') if @@error <> 0 goto baderror  select @Unit_Cost_Total = ISNULL(SUM(Unit_Cost_Total),0),  @ORIGUNITCOSTTOTAL = ISNULL(SUM(ORIGUNITCOSTTOTAL),0)  FROM SVC00601 WHERE SVC00601.CONSTS = @CONSTS AND SVC00601.CONTNBR = @CONTNBR   UPDATE SVC00600 with (rowlock) SET SVC00600.RETNAGAM = @RETAINAGE,  SVC00600.RTNBILLD = @RETAINAGEBILLED,  SVC00600.ORIGRETNAGAM = @ORIGRETAINAGE,  SVC00600.ORIGRTNBILLD = @ORIGRETAINAGEBILLED,   SVC00600.BLKTIM = @BLOCKTIME,   SVC00600.VALTIM = @TIMEVALUE,  SVC00600.ORIGVALTIM = @ORIGTIMEVALUE,   SVC00600.ACTCAL = @ACTUALCALLS,   SVC00600.TOTVALCAL = @VALUECALLS,  SVC00600.ORIGTOTVALCAL = @ORIGVALUECALLS,   SVC00600.NBRCAL = @MAXCALLS,  Originating_Total_Unit = @ORIGUNITCOSTTOTAL,  Total_Unit = @Unit_Cost_Total FROM SVC00600 WHERE SVC00600.CONSTS = @CONSTS AND   SVC00600.CONTNBR = @CONTNBR if @@error <> 0 goto baderror COMMIT TRANSACTION return baderror:  rollback transaction  return @@error    
GO
GRANT EXECUTE ON  [dbo].[SVC_Set_Contract_Amount_Totals] TO [DYNGRP]
GO
