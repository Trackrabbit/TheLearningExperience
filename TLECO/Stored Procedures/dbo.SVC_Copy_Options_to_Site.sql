SET QUOTED_IDENTIFIER OFF
GO
SET ANSI_NULLS ON
GO
 CREATE PROCEDURE [dbo].[SVC_Copy_Options_to_Site]  @CONSTS smallint,  @CONTNBR char(11),  @Seq numeric(19,5) as declare @OPTTYPE char(11),@ADRSCODE char(15) declare @LNSEQNBR numeric(19,5) if @Seq = 0 return -1  select @ADRSCODE = ADRSCODE from SVC00608  where CONSTS = @CONSTS and CONTNBR = @CONTNBR and LNSEQNBR = @Seq delete from SVC00655  where CONSTS = @CONSTS and  CONTNBR = @CONTNBR and  LNSEQNBR = @Seq  declare Cont_Hdr_Options cursor for select OPTTYPE   from SVC00652 where CONSTS = @CONSTS and CONTNBR = @CONTNBR and  LNSEQNBR = 0 order by DEX_ROW_ID   open Cont_Hdr_Options   fetch next from Cont_Hdr_Options into @OPTTYPE   while @@FETCH_STATUS = 0  BEGIN  exec SVC_Add_Option_To_Site @CONSTS, @CONTNBR, @ADRSCODE,@OPTTYPE   fetch next from Cont_Hdr_Options into @OPTTYPE   END  deallocate Cont_Hdr_Options   if exists(select * from SVC00681 where CONSTS = @CONSTS and CONTNBR = @CONTNBR) and  not exists(select * from SVC00682 where CONSTS = @CONSTS and CONTNBR = @CONTNBR and LNSEQNBR = @Seq)  begin  insert into SVC00682 with (rowlock) select   @CONSTS,  @CONTNBR,  @Seq,  svcCoveragePeriodStart2_1,  svcCoveragePeriodStart2_2,  svcCoveragePeriodStart2_3,  svcCoveragePeriodStart2_4,  svcCoveragePeriodStart2_5,  svcCoveragePeriodStart2_6,  svcCoveragePeriodStart2_7,  svcCoveragePeriodEnd2_1,  svcCoveragePeriodEnd2_2,  svcCoveragePeriodEnd2_3,  svcCoveragePeriodEnd2_4,  svcCoveragePeriodEnd2_5,  svcCoveragePeriodEnd2_6,  svcCoveragePeriodEnd2_7,  svcCoveragePeriodStart3_1,  svcCoveragePeriodStart3_2,  svcCoveragePeriodStart3_3,  svcCoveragePeriodStart3_4,  svcCoveragePeriodStart3_5,  svcCoveragePeriodStart3_6,  svcCoveragePeriodStart3_7,  svcCoveragePeriodEnd3_1,  svcCoveragePeriodEnd3_2,  svcCoveragePeriodEnd3_3,  svcCoveragePeriodEnd3_4,  svcCoveragePeriodEnd3_5,  svcCoveragePeriodEnd3_6,  svcCoveragePeriodEnd3_7,  svcCoveragePeriodStart4_1,  svcCoveragePeriodStart4_2,  svcCoveragePeriodStart4_3,  svcCoveragePeriodStart4_4,  svcCoveragePeriodStart4_5,  svcCoveragePeriodStart4_6,  svcCoveragePeriodStart4_7,  svcCoveragePeriodEnd4_1,  svcCoveragePeriodEnd4_2,  svcCoveragePeriodEnd4_3,  svcCoveragePeriodEnd4_4,  svcCoveragePeriodEnd4_5,  svcCoveragePeriodEnd4_6,  svcCoveragePeriodEnd4_7  from SVC00681 where CONSTS = @CONSTS and CONTNBR = @CONTNBR  end return (0)    
GO
GRANT EXECUTE ON  [dbo].[SVC_Copy_Options_to_Site] TO [DYNGRP]
GO
