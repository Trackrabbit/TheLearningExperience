SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO
 CREATE procedure [dbo].[aagAlertForPartialAssignmentSubLedHdr] @I_cTableAssign nvarchar(30) = null, @I_cTableCode nvarchar(30) = null, @I_cTableError nvarchar(30) = null, @I_nHdrID int, @O_fValidCode tinyint = 1 output as begin set nocount on  declare  @nDistID int,  @nDebitAmt numeric(19,5),  @nCreditAmt numeric(19,5),  @nActIndx int,  @nAcctClassID int,  @nErrorCount int,  @fValidCode tinyint,  @SERIES  int  set @fValidCode = 1  set @O_fValidCode = 1  set @SERIES = 0  select @SERIES  = SERIES from AAG20000 where aaSubLedgerHdrID = @I_nHdrID  if @SERIES = 2   begin  if exists(Select aaSubLedgerDistID from AAG20001 where aaSubLedgerHdrID = @I_nHdrID  and aaSubLedgerDistID = 1 and POSTED = 1)   begin  declare aaSubLedHdr cursor fast_forward FOR  select aaSubLedgerDistID,DEBITAMT,CRDTAMNT,ACTINDX from AAG20001  where aaSubLedgerHdrID = @I_nHdrID and POSTED = 0 and aaBrowseType <> 0  end  else  begin  declare aaSubLedHdr cursor fast_forward FOR  select aaSubLedgerDistID,DEBITAMT,CRDTAMNT,ACTINDX from AAG20001  where aaSubLedgerHdrID = @I_nHdrID and POSTED = 0  end  end  else  begin  declare aaSubLedHdr cursor fast_forward FOR  select aaSubLedgerDistID,DEBITAMT,CRDTAMNT,ACTINDX from AAG20001  where aaSubLedgerHdrID = @I_nHdrID and POSTED = 0  end  open aaSubLedHdr  fetch next from aaSubLedHdr into @nDistID,@nDebitAmt,@nCreditAmt,@nActIndx  while @@fetch_status = 0  Begin  Set @fValidCode = 1 set @nAcctClassID=0 select @nAcctClassID=aaAcctClassID from AAG00200 where ACTINDX = @nActIndx  If @fValidCode = 1   Begin  exec aagAlertForPartialAssignmentSubLedDist  2,  @I_cTableAssign,  @I_cTableCode,  @I_cTableError,  @I_nHdrID,  @nDistID,  @nDebitAmt,  @nCreditAmt,  @nAcctClassID,  1,  @fValidCode output  If @fValidCode = 0  set @O_fValidCode = 0  End  Fetch next from aaSubLedHdr into @nDistID,@nDebitAmt,@nCreditAmt, @nActIndx  End  close aaSubLedHdr  deallocate aaSubLedHdr  set nocount off  return end    
GO
GRANT EXECUTE ON  [dbo].[aagAlertForPartialAssignmentSubLedHdr] TO [DYNGRP]
GO
