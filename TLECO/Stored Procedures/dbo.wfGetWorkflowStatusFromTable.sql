SET QUOTED_IDENTIFIER OFF
GO
SET ANSI_NULLS ON
GO
 CREATE PROCEDURE [dbo].[wfGetWorkflowStatusFromTable]   @Workflow_Business_Object_Key char(201),  @Workflow_Type_Name char(51),  @WorkflowStatus smallint output,  @Workflow_Error int OUTPUT AS  BEGIN  set NOCOUNT ON   declare @pre_clause varchar(100)  declare @where_clause varchar(4000)  declare @final_clause nvarchar(4000), @Params nvarchar(50)  declare @main_table char(50)  select @Workflow_Error=0  if (select count(Workflow_Type_Name) from WF100002 where ACTIVE=1 and Workflow_Type_Name=@Workflow_Type_Name)=0  begin   select @WorkflowStatus=9   return  end   exec wfGenerateDocumentWhereClause   @Workflow_Business_Object_Key,@Workflow_Type_Name,0,   0,1,@main_table OUTPUT,@where_clause OUTPUT   if @Workflow_Type_Name = 'Smartlist Designer View Approval'   begin  select @pre_clause='select Workflow_Status from  DYNAMICS..'+RTRIM(@main_table)  end  else  select @pre_clause='select Workflow_Status from '+RTRIM(@main_table)   select @final_clause='select @workflow_status=(select isnull(('+RTRIM(@pre_clause)+RTRIM(@where_clause)+'),99))'   select @Params = '@workflow_status smallint OUTPUT'  exec sp_executesql @final_clause,@Params,@workflow_status=@WorkflowStatus OUTPUT  if @WorkflowStatus=99   begin  exec wfGenerateDocumentWhereClause   @Workflow_Business_Object_Key,@Workflow_Type_Name,1,   0,1,@main_table OUTPUT,@where_clause OUTPUT   if @Workflow_Type_Name = 'Smartlist Designer View Approval'   begin  select @pre_clause='select Workflow_Status from  DYNAMICS..'+RTRIM(@main_table)  end  else  select @pre_clause='select Workflow_Status from '+RTRIM(@main_table)  select @final_clause='select @workflow_status=(select isnull(('+RTRIM(@pre_clause)+RTRIM(@where_clause)+'),99))'   select @Params = '@workflow_status smallint OUTPUT'  exec sp_executesql @final_clause,@Params,@workflow_status=@WorkflowStatus OUTPUT  end  END   
GO
GRANT EXECUTE ON  [dbo].[wfGetWorkflowStatusFromTable] TO [DYNGRP]
GO
