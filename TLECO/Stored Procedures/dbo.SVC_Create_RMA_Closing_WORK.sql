SET QUOTED_IDENTIFIER OFF
GO
SET ANSI_NULLS ON
GO
 CREATE PROCEDURE [dbo].[SVC_Create_RMA_Closing_WORK]  (@USERID char(15),  @RMA char(15),  @Customer char(15),  @Item char(31),  @Office char(11),  @Tech char(11),  @Type smallint,  @Error integer OUTPUT)  AS declare  @RMANumber char(15),  @ReleaseNumber char(5),  @RTVNumber char(15),  @RTVType char(11),  @RTVStatus char(3),  @RTVCloseStatus char(3) delete from SVC05115 where USERID = @USERID  IF @Type = 0 BEGIN  insert into SVC05115   SELECT @USERID,SVC05200.RETDOCID, SVC05200.LNSEQNBR,   SVC05200.RETTYPE, isnull(SVC05200.OFFID,''),   '',   SVC05200.CUSTNMBR,SVC05200.ADRSCODE,  SVC05200.CUSTNAME,  isnull(SVC05200.Return_Item_Number ,''),  isnull(SVC05200.Return_QTY,0),  isnull(SVC05200.Repair_Cost,0.0),  CASE  when SVC05200.Repair_Price > 0.0 then SVC05200.Repair_Price  else isnull(SVC05200.Flat_Rate_Repair_Price,0.0)  END,  isnull(SVC05200.Originating_Repair_Cost,0.0),  CASE  when SVC05200.Originating_Repair_Price > 0.0 then SVC05200.Originating_Repair_Price  else isnull(SVC05200.Orig_Flat_RepairPrice,0.0)  END,  0,0,0,'','',0,SVC_Bill_To_Address_Code, CSTPONBR FROM SVC05200 WHERE SVC05200.RMA_Status = 9 and SVC05200.Return_Record_Type = 1 and svcRMAComponentSeq = 0 END ELSE IF @Type = 1 BEGIN  insert into SVC05115   SELECT @USERID,SVC05200.RETDOCID, SVC05200.LNSEQNBR,   SVC05200.RETTYPE, isnull(SVC05200.OFFID,''),   '',   SVC05200.CUSTNMBR, SVC05200.ADRSCODE,  SVC05200.CUSTNAME,  isnull(SVC05200.Return_Item_Number ,''),  isnull(SVC05200.Return_QTY,0),   isnull(SVC05200.Repair_Cost,0.0),  CASE  when SVC05200.Repair_Price > 0.0 then SVC05200.Repair_Price  else isnull(SVC05200.Flat_Rate_Repair_Price,0.0)  END,  isnull(SVC05200.Originating_Repair_Cost,0.0),  CASE  when SVC05200.Originating_Repair_Price > 0.0 then SVC05200.Originating_Repair_Price  else isnull(SVC05200.Orig_Flat_RepairPrice,0.0)  END,  0,0,0,'','',0,SVC_Bill_To_Address_Code, CSTPONBR FROM SVC05200 WHERE SVC05200.RMA_Status = 9 and SVC05200.Return_Record_Type = 1 and svcRMAComponentSeq = 0  and SVC05200.RETDOCID = @RMA  END ELSE IF @Type = 2 BEGIN  insert into SVC05115   SELECT @USERID,SVC05200.RETDOCID, SVC05200.LNSEQNBR,   SVC05200.RETTYPE, isnull(SVC05200.OFFID,''),   '',   SVC05200.CUSTNMBR,SVC05200.ADRSCODE,  SVC05200.CUSTNAME,  isnull(SVC05200.Return_Item_Number ,''),  isnull(SVC05200.Return_QTY,0),   isnull(SVC05200.Repair_Cost,0.0),  CASE  when SVC05200.Repair_Price > 0.0 then SVC05200.Repair_Price  else isnull(SVC05200.Flat_Rate_Repair_Price,0.0)  END,  isnull(SVC05200.Originating_Repair_Cost,0.0),  CASE  when SVC05200.Originating_Repair_Price > 0.0 then SVC05200.Originating_Repair_Price  else isnull(SVC05200.Orig_Flat_RepairPrice,0.0)  END,  0,0,0,'','',0,SVC_Bill_To_Address_Code, CSTPONBR FROM SVC05200 WHERE SVC05200.RMA_Status = 9 and SVC05200.Return_Record_Type = 1 and svcRMAComponentSeq = 0  and SVC05200.CUSTNMBR = @Customer  END ELSE IF @Type = 3 BEGIN   insert into SVC05115   SELECT @USERID,SVC05200.RETDOCID, SVC05200.LNSEQNBR,   SVC05200.RETTYPE, isnull(SVC05200.OFFID,''),   '',   SVC05200.CUSTNMBR, SVC05200.ADRSCODE,  SVC05200.CUSTNAME,  isnull(SVC05200.Return_Item_Number ,''),  isnull(SVC05200.Return_QTY,0),   isnull(SVC05200.Repair_Cost,0.0),  CASE  when SVC05200.Repair_Price > 0.0 then SVC05200.Repair_Price  else isnull(SVC05200.Flat_Rate_Repair_Price,0.0)  END,  isnull(SVC05200.Originating_Repair_Cost,0.0),  CASE  when SVC05200.Originating_Repair_Price > 0.0 then SVC05200.Originating_Repair_Price  else isnull(SVC05200.Orig_Flat_RepairPrice,0.0)  END,  0,0,0,'','',0,SVC_Bill_To_Address_Code, CSTPONBR  FROM SVC05200 WHERE SVC05200.RMA_Status = 9 and SVC05200.Return_Record_Type = 1 and svcRMAComponentSeq = 0  and SVC05200.Return_Item_Number = @Item END ELSE IF @Type = 4 BEGIN  insert into SVC05115   SELECT @USERID,SVC05200.RETDOCID, SVC05200.LNSEQNBR,   SVC05200.RETTYPE, isnull(SVC05200.OFFID,''),   '',   SVC05200.CUSTNMBR, SVC05200.ADRSCODE,  SVC05200.CUSTNAME,  isnull(SVC05200.Return_Item_Number ,''),  isnull(SVC05200.Return_QTY,0),   isnull(SVC05200.Repair_Cost,0.0),  CASE  when SVC05200.Repair_Price > 0.0 then SVC05200.Repair_Price  else isnull(SVC05200.Flat_Rate_Repair_Price,0.0)  END,  isnull(SVC05200.Originating_Repair_Cost,0.0),  CASE  when SVC05200.Originating_Repair_Price > 0.0 then SVC05200.Originating_Repair_Price  else isnull(SVC05200.Orig_Flat_RepairPrice,0.0)  END,  0,0,0,'','',0,SVC_Bill_To_Address_Code, CSTPONBR FROM SVC05200 WHERE SVC05200.RMA_Status = 9 and SVC05200.Return_Record_Type = 1 and svcRMAComponentSeq = 0  and SVC05200.OFFID = @Office  END ELSE IF @Type = 5 BEGIN  insert into SVC05115   SELECT @USERID,SVC05200.RETDOCID, SVC05200.LNSEQNBR,   SVC05200.RETTYPE, isnull(SVC05200.OFFID,''),   isnull(SVC00200.TECHID,''),   SVC05200.CUSTNMBR, SVC05200.ADRSCODE,  SVC05200.CUSTNAME,  isnull(SVC05200.Return_Item_Number ,''),  isnull(SVC05200.Return_QTY,0),   isnull(SVC05200.Repair_Cost,0.0),  CASE  when SVC05200.Repair_Price > 0.0 then SVC05200.Repair_Price  else isnull(SVC05200.Flat_Rate_Repair_Price,0.0)  END,  isnull(SVC05200.Originating_Repair_Cost,0.0),  CASE  when SVC05200.Originating_Repair_Price > 0.0 then SVC05200.Originating_Repair_Price  else isnull(SVC05200.Orig_Flat_RepairPrice,0.0)  END,  0,0,0,'','',0,SVC05200.SVC_Bill_To_Address_Code, SVC05200.CSTPONBR FROM SVC05200 LEFT JOIN  SVC00200 ON SVC05200.CALLNBR = SVC00200.CALLNBR and SVC05200.SRVRECTYPE = SVC00200.SRVRECTYPE  WHERE SVC05200.RMA_Status = 9 and SVC05200.Return_Record_Type = 1 and svcRMAComponentSeq = 0  and SVC00200.TECHID = @Tech  END  return    
GO
GRANT EXECUTE ON  [dbo].[SVC_Create_RMA_Closing_WORK] TO [DYNGRP]
GO
