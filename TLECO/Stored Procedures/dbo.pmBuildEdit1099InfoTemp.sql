SET QUOTED_IDENTIFIER OFF
GO
SET ANSI_NULLS ON
GO
 create procedure [dbo].[pmBuildEdit1099InfoTemp]  @I_vTableName varchar(27) = NULL,  @I_sVendorID char(15) = NULL,  @I_sStartVoucherNumber char(21) = NULL,  @I_sEndVoucherNumber char(21) = NULL,  @I_sStartDocumentNumber char(21) = NULL,  @I_sEndDocumentNumber char(21) = NULL,  @I_dStartDate datetime = NULL,  @I_dEndDate datetime = NULL,  @I_IncludeOption int   = NULL,  @I_FuncCurrencyIndex smallint = NULL,  @O_SQL_Error_State int  = NULL output  as  declare @iStatus int,  @iError int,  @StartDocType int,  @EndDocType int,  @1099Type int  select @O_SQL_Error_State = 0  if  @I_vTableName is NULL or  @I_sVendorID is NULL or  @I_sStartVoucherNumber is NULL or  @I_sEndVoucherNumber is NULL or  @I_sStartDocumentNumber is NULL or  @I_sEndDocumentNumber is NULL or  @I_dStartDate is NULL or  @I_dEndDate is NULL or  @I_IncludeOption is NULL or  @I_FuncCurrencyIndex is NULL   begin  select @O_SQL_Error_State = 20856  return  end   select @iStatus = 0,  @iError = 0  CREATE TABLE #pm1099Update  (  [VENDORID] [char] (15) NOT NULL ,  [VCHRNMBR] [char] (21) NOT NULL ,  [TEN99TYPE] [int] NOT NULL ,  [TEN99BOXNUMBER] [int] NOT NULL ,  [OLDTEN99TYPE] [int] NOT NULL ,  [OLDTEN99BOXNUMBER] [int] NOT NULL ,  [Status] [int] NOT NULL ,  [TEN99AMNT] [numeric](19, 5) NOT NULL ,  [OLD1099AMT] [numeric](19, 5) NOT NULL ,  [DOCNUMBR] [char] (21) NOT NULL ,  [DOCTYPE] [int] NOT NULL ,  [DOCDATE] [datetime] NOT NULL ,  [TABLETYPE] [smallint] NOT NULL,  [CURRNIDX] [smallint] NOT NULL ,  [DEX_ROW_ID] int identity NOT NULL   ) CREATE INDEX AK2#pm1099Update ON #pm1099Update (VENDORID, VCHRNMBR)   if @I_IncludeOption = 0  begin  exec @iStatus = DYNAMICS..smGetConstantInt 'PM_DOC_INVOICE', @StartDocType output, @O_SQL_Error_State output  exec @iStatus = DYNAMICS..smGetConstantInt 'PM_DOC_MISC_CHG', @EndDocType output, @O_SQL_Error_State output   exec @iStatus = DYNAMICS..smGetConstantInt 'TAXTYPE_1099_DIV', @1099Type output, @O_SQL_Error_State output   end  else if @I_IncludeOption = 1   begin  exec @iStatus = DYNAMICS..smGetConstantInt 'PM_DOC_INVOICE', @StartDocType output, @O_SQL_Error_State output  exec @iStatus = DYNAMICS..smGetConstantInt 'PM_DOC_MISC_CHG', @EndDocType output, @O_SQL_Error_State output   select @1099Type = 0   end  else if @I_IncludeOption = 2   begin  exec @iStatus = DYNAMICS..smGetConstantInt 'PM_DOC_RETURN', @StartDocType output, @O_SQL_Error_State output  exec @iStatus = DYNAMICS..smGetConstantInt 'PM_DOC_CR_MEMO', @EndDocType output, @O_SQL_Error_State output   select @1099Type = 0   end   insert into  #pm1099Update  (VENDORID,  VCHRNMBR,  TEN99TYPE,  TEN99BOXNUMBER,  OLDTEN99TYPE,  OLDTEN99BOXNUMBER,  Status,  TEN99AMNT,  OLD1099AMT,  DOCNUMBR,  DOCTYPE,  DOCDATE,  TABLETYPE,  CURRNIDX  )  select   VENDORID,   VCHRNMBR,   TEN99TYPE,   TEN99BOXNUMBER,  TEN99TYPE,   TEN99BOXNUMBER,   0,   TEN99AMNT,   TEN99AMNT,   DOCNUMBR,   DOCTYPE,   DOCDATE,  2,   @I_FuncCurrencyIndex   from PM20000   where VENDORID = @I_sVendorID and VOIDED = 0 and   (VCHRNMBR >= @I_sStartVoucherNumber and VCHRNMBR <= @I_sEndVoucherNumber)  and (DOCNUMBR >= @I_sStartDocumentNumber and DOCNUMBR <= @I_sEndDocumentNumber)  and (DOCDATE >= @I_dStartDate and DOCDATE <= @I_dEndDate)  and (DOCTYPE >= @StartDocType and DOCTYPE <= @EndDocType) and TEN99TYPE >= @1099Type   union  select   VENDORID,   VCHRNMBR,   TEN99TYPE,   TEN99BOXNUMBER,  TEN99TYPE,   TEN99BOXNUMBER,   0,   TEN99AMNT,   TEN99AMNT,   DOCNUMBR,   DOCTYPE,   DOCDATE,  3,   @I_FuncCurrencyIndex   from PM30200   where VENDORID = @I_sVendorID and VOIDED = 0 and  (VCHRNMBR >= @I_sStartVoucherNumber and VCHRNMBR <= @I_sEndVoucherNumber)  and (DOCNUMBR >= @I_sStartDocumentNumber and DOCNUMBR <= @I_sEndDocumentNumber)  and (DOCDATE >= @I_dStartDate and DOCDATE <= @I_dEndDate)  and (DOCTYPE >= @StartDocType and DOCTYPE <= @EndDocType) and TEN99TYPE >= @1099Type   update #pm1099Update set TEN99AMNT = MC.OR1099AM,  OLD1099AMT = MC.OR1099AM,  CURRNIDX = MC.CURRNIDX from MC020103 MC where MC.DOCTYPE = #pm1099Update.DOCTYPE and MC.VCHRNMBR = #pm1099Update.VCHRNMBR  exec  ('insert ' + @I_vTableName +  ' (VENDORID, VCHRNMBR, TEN99TYPE, TEN99BOXNUMBER, OLDTEN99TYPE, OLDTEN99BOXNUMBER, Status, TEN99AMNT, OLD1099AMT, DOCNUMBR, DOCTYPE, DOCDATE, TABLETYPE, CURRNIDX)'  + ' select VENDORID, VCHRNMBR, TEN99TYPE, TEN99BOXNUMBER, OLDTEN99TYPE, OLDTEN99BOXNUMBER, Status, TEN99AMNT, OLD1099AMT, DOCNUMBR, DOCTYPE, DOCDATE, TABLETYPE, CURRNIDX from #pm1099Update')  select @iError = @@error if @iError <> 0  return (@iError) drop table #pm1099Update   return (@iStatus)   
GO
GRANT EXECUTE ON  [dbo].[pmBuildEdit1099InfoTemp] TO [DYNGRP]
GO
