SET QUOTED_IDENTIFIER OFF
GO
SET ANSI_NULLS ON
GO
CREATE  procedure [dbo].[seeEmployeeStatusByDeptDetail] @UserDate       datetime = NULL,                                                        @Department     varchar(18) = '',                                                        @MaxDepartments int  as    if @MaxDepartments > 0       and @Department = ''      begin          select a.[Department],                 a.[HR Status],                 a.[Type of Employment],                 a.[Employee Class],                 a.[Division Code],                 a.[Location ID],                 a.[Supervisor Code],                 a.[Start Date],                 a.[Employee ID],                 a.[Last Name],                 a.[First Name],                 a.[Address 1],                 a.[Address 2],                 a.[City],                 a.[State],                 a.[Zip Code]          from   Employees a,                 (select top (select @MaxDepartments)                 COUNT([Employee ID]) as EmpCount,                 [Department]                  from   Employees                  group  by [Department]                  order  by EmpCount desc,                            [Department]) b          where  ( a.[Department] = b.[Department] )                 and ( a.[Start Date] <= @UserDate                       and a.[Inactive] = 'No' )      end    else      begin          if @Department = ''            select [Department],                   [HR Status],                   [Type of Employment],                   [Employee Class],                   [Division Code],                   [Location ID],                   [Supervisor Code],                   [Start Date],                   [Employee ID],                   [Last Name],                   [First Name],                   [Address 1],                   [Address 2],                   [City],                   [State],                   [Zip Code],                  [Employee ID For Drillback]            from   Employees            where  ( [Start Date] <= @UserDate                     and [Inactive] = 'No' )          else            select [Department],                   [HR Status],                   [Type of Employment],                   [Employee Class],                   [Division Code],                   [Location ID],                   [Supervisor Code],                   [Start Date],                   [Employee ID],                   [Last Name],                   [First Name],                   [Address 1],                   [Address 2],                   [City],                   [State],                   [Zip Code] ,                  [Employee ID For Drillback]           from   Employees            where  ( [Department] = @Department )                   and ( [Start Date] <= @UserDate                         and [Inactive] = 'No' )      end           
GO
GRANT EXECUTE ON  [dbo].[seeEmployeeStatusByDeptDetail] TO [DYNGRP]
GO
GRANT EXECUTE ON  [dbo].[seeEmployeeStatusByDeptDetail] TO [rpt_executive]
GO
GRANT EXECUTE ON  [dbo].[seeEmployeeStatusByDeptDetail] TO [rpt_human resource administrator]
GO
GRANT EXECUTE ON  [dbo].[seeEmployeeStatusByDeptDetail] TO [rpt_payroll]
GO
