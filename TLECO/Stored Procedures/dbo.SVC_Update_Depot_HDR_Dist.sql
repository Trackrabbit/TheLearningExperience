SET QUOTED_IDENTIFIER OFF
GO
SET ANSI_NULLS ON
GO
 CREATE Procedure [dbo].[SVC_Update_Depot_HDR_Dist]  @WONumber char(11),  @RecordType smallint,  @DistType smallint,  @AccountIndex integer,  @CurrencyIndex smallint,  @Posted tinyint  AS declare  @NextLine integer declare  @CAmount numeric(19,2) declare  @OrigCAmount numeric (19,2) declare  @DAmount numeric(19,2) declare  @OrigDAmount numeric (19,2) declare  @PostDate datetime  if @AccountIndex > 0  BEGIN  delete from SVC06130 where WORECTYPE = @RecordType and WORKORDNUM = @WONumber and SEQNUMBR > 500   and SVC_Distribution_Type=@DistType and ACTINDX = @AccountIndex and POSTED = @Posted  if exists (select * from SVC06131 where WORECTYPE = @RecordType and WORKORDNUM = @WONumber  and ACTINDX = @AccountIndex and SVC_Distribution_Type = @DistType and POSTED = @Posted)  BEGIN  select @CAmount = sum(CRDTAMNT), @OrigCAmount = sum(ORCRDAMT), @DAmount = sum(DEBITAMT), @OrigDAmount = sum(ORDBTAMT) from SVC06131  where WORECTYPE = @RecordType and WORKORDNUM = @WONumber and ACTINDX = @AccountIndex  and SVC_Distribution_Type = @DistType and POSTED =@Posted  if @Posted = 1  select @PostDate = CONVERT(varchar(10),GETDATE(),102) + ' 00:00:00'  else  select @PostDate =  'January 1, 1900'  exec SVC_Dist_Get_SEQ_Depot  @WONumber,  @RecordType,  0,'',  @DistType,  @NextLine output   insert SVC06130  select   @RecordType,  @WONumber,  @NextLine,  @DistType,   '',  @AccountIndex,  @DAmount,   @OrigDAmount,  @CAmount,   @OrigCAmount,  isnull(@CurrencyIndex,0),  '',  @Posted,  @PostDate   END   if @Posted = 1  BEGIN  select @Posted = 0  delete from SVC06130 where WORECTYPE = @RecordType and WORKORDNUM = @WONumber and SEQNUMBR > 500   and SVC_Distribution_Type=@DistType and ACTINDX = @AccountIndex and POSTED = @Posted   if exists (select * from SVC06131 where WORECTYPE = @RecordType and WORKORDNUM = @WONumber  and ACTINDX = @AccountIndex and SVC_Distribution_Type = @DistType and POSTED = @Posted)  BEGIN  select @CAmount = sum(CRDTAMNT), @OrigCAmount = sum(ORCRDAMT), @DAmount = sum(DEBITAMT), @OrigDAmount = sum(ORDBTAMT) from SVC06131  where WORECTYPE = @RecordType and WORKORDNUM = @WONumber and ACTINDX = @AccountIndex  and SVC_Distribution_Type = @DistType and POSTED =@Posted  select @PostDate =  'January 1, 1900'  exec SVC_Dist_Get_SEQ_Depot  @WONumber,  @RecordType,  0,'',  @DistType,  @NextLine output   insert SVC06130  select   @RecordType,  @WONumber,  @NextLine,  @DistType,   '',  @AccountIndex,  @DAmount,   @OrigDAmount,  @CAmount,   @OrigCAmount,  isnull(@CurrencyIndex,0),  '',  @Posted,  @PostDate  END  END END  return(0)    
GO
GRANT EXECUTE ON  [dbo].[SVC_Update_Depot_HDR_Dist] TO [DYNGRP]
GO
