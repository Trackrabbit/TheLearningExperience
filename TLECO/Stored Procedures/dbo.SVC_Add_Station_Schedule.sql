SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO
 CREATE PROCEDURE [dbo].[SVC_Add_Station_Schedule]   ( @STATIONID varchar(11) OUTPUT,  @STATIONGROUP char(11),  @WORKORDNUM varchar(11),  @WORECTYPE smallint,  @TECHID char(11),  @ACTSTRTDTE datetime OUTPUT,  @ACTSTRTTME datetime OUTPUT,  @ETADTE datetime OUTPUT,  @ETATME datetime OUTPUT,  @ETTR numeric(19,5),  @Status smallint,  @Priority numeric(19,5),  @NXTSTATID char(11),  @LSTSTAID char(11),  @Route_Sequence numeric(19,5),  @Ahhugah integer) AS declare @SEQUENCE1 numeric(19,5)  declare @ECOMPDT datetime  declare @EComp_Time datetime  declare @NXTSEQ numeric(19,5)  declare @Last_Sequence numeric(19,5)  declare @NEWSEQUENCE numeric(19,5)  declare @vCombinedDateTime datetime declare @vCombinedDateTimeInput datetime declare @vEndDateTime datetime declare @TEMPDATE datetime declare @TEMPTIME datetime declare @Queue_Status char(3) declare @msg varchar(255) declare @PRETIME numeric(19,5) declare @POSTTIME numeric(19,5) declare @STATIONFROMGROUP varchar(11) declare @CheckDateTime datetime declare @L_ETTR numeric(19,5) select @STATIONID = RTRIM(@STATIONID), @WORKORDNUM = RTRIM(@WORKORDNUM)  if @STATIONGROUP <> ''  begin  exec SVC_Get_Station_From_Group @STATIONFROMGROUP OUTPUT,  @STATIONGROUP,  @Status,   @Priority   select @STATIONID = IsNull(@STATIONFROMGROUP,@STATIONID) end  if @STATIONID = '' or @STATIONID is NULL return  select @PRETIME = Isnull(PRETIME,0),  @POSTTIME = IsNull(POSTTIME,0)   from SVC06001  where STATIONID = @STATIONID select @L_ETTR = @ETTR + isnull(@PRETIME,0) + isnull(@POSTTIME,0)  exec SVC_util_combine_date_time @ACTSTRTDTE,@ACTSTRTTME,@CheckDateTime output exec SVC_Fit_Item @STATIONID,  @CheckDateTime,  @L_ETTR,  @Ahhugah,  @vCombinedDateTime  output,  @vEndDateTime  output  exec SVC_util_split_datetime @vCombinedDateTime,   @ACTSTRTDTE OUTPUT,   @ACTSTRTTME OUTPUT exec SVC_util_split_datetime @vEndDateTime,   @ECOMPDT OUTPUT,   @EComp_Time OUTPUT select @SEQUENCE1 = MAX(SEQUENCE1) + 1  from SVC06300   where SVC06300.STATIONID = @STATIONID and   SVC06300.Status = @Status and   SVC06300.SVC_Depot_Priority = @Priority  if @SEQUENCE1 is null   select @SEQUENCE1 = 1 select @NXTSEQ = MAX(IsNull(SEQUENCE1,0)) + 1  from SVC06300   where STATIONID = @NXTSTATID and   Status = @Status and   SVC_Depot_Priority = @Priority if @NXTSEQ is null  select @NXTSEQ = 0 select @Last_Sequence = MAX(IsNull(SEQUENCE1,0)) + 1  from SVC06300  where STATIONID = @LSTSTAID and   WORECTYPE = @WORECTYPE and   WORKORDNUM = @WORKORDNUM  if @Last_Sequence is null  select @Last_Sequence = 0  if @WORECTYPE = 1  select @Queue_Status = '10' else  select @Queue_Status = '00' if @LSTSTAID is null  select @LSTSTAID = '' select @ACTSTRTDTE = isnull(@ACTSTRTDTE,'01/01/1900 00:00:00') select @ACTSTRTTME = isnull(@ACTSTRTTME,'01/01/1900 00:00:00') select @ECOMPDT = isnull(@ECOMPDT,'01/01/1900 00:00:00') select @EComp_Time = isnull(@EComp_Time,'01/01/1900 00:00:00') INSERT INTO SVC06300     VALUES   (@STATIONID,@SEQUENCE1,@Queue_Status,@WORECTYPE,@WORKORDNUM,  @Route_Sequence,@Priority,@Status,@TECHID,   @ETTR,@ACTSTRTDTE,@ACTSTRTTME,@ECOMPDT,@EComp_Time,  '01/01/1900 00:00:00','01/01/1900 00:00:00',  @LSTSTAID,@Last_Sequence,@NXTSTATID,@NXTSEQ)  select @ETADTE = @ACTSTRTDTE,  @ETATME = @ACTSTRTTME,  @ACTSTRTDTE = @ECOMPDT,  @ACTSTRTTME = @EComp_Time return    
GO
GRANT EXECUTE ON  [dbo].[SVC_Add_Station_Schedule] TO [DYNGRP]
GO
