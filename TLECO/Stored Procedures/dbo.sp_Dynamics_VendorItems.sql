SET QUOTED_IDENTIFIER OFF
GO
SET ANSI_NULLS ON
GO
 CREATE PROCEDURE [dbo].[sp_Dynamics_VendorItems] @iLanguageID int  as  set nocount on   declare @sqldropstring varchar(400),  @sqldefaultstring varchar(8000),  @sqlstring1 varchar(8000),  @sqlstring2 varchar(8000),  @sqlstring3 varchar(8000),  @sqlstring4 varchar(8000),  @sqlstring5 varchar(8000),  @sqlstring6 varchar(8000),  @sqlstring7 varchar(8000),  @sqlstring8 varchar(8000),  @sqlstring9 varchar(8000),  @sqlstring10 varchar(8000),  @sqljoinstring varchar(8000),  @sqlaccessstring varchar(2000),  @tNumberSegments int,  @tSegment int,  @I_iDictID int,  @I_iLangID int,  @I_iMessageNumber int,  @I_iAliasMessageNumber int,  @I_iIntegerValue int,  @Vendor_ID varchar(255), @Vendor_Item_Description varchar(255), @Vendor_Item_Number varchar(255), @Item_Number varchar(255), @Last_Currency_ID varchar(255), @Last_ORD_Date varchar(255), @Last_ORD_QTY varchar(255), @Last_Originating_Cost varchar(255), @Last_RCPT_Cost varchar(255), @Last_RCPT_QTY varchar(255), @Maximum_ORD_QTY varchar(255), @Minimum_ORD_QTY varchar(255), @Number_Of_RCPTS_For_Item varchar(255), @Planning_Lead_Time varchar(255), @QTY_Drop_Shipped varchar(255), @QTY_On_Order varchar(255), @QTY_Requisitioned varchar(255), @Last_RCPT_Date varchar(255), @Average_Lead_Time varchar(255), @Purchasing_U_Of_M varchar(255), @Currency_Index varchar(255), @Economic_ORD_QTY varchar(255), @Free_On_Board varchar(255), @Item_Vendor_Type varchar(255), @DrillBack_Base_Url varchar(255), @Vendor_ID_For_DrillBack varchar(255), @Item_Number_For_DrillBack varchar(255)  select @DrillBack_Base_Url = DYNAMICS.dbo.createBaseDrillBackUrlString(DB_NAME(),0)  select @I_iDictID = 1493 select @I_iMessageNumber = 24650 select @I_iAliasMessageNumber = 0 exec DYNAMICS..smGetBIMsgString  @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @Vendor_ID output  select @I_iDictID = 1493 select @I_iMessageNumber = 24651 select @I_iAliasMessageNumber = 0 exec DYNAMICS..smGetBIMsgString  @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @Vendor_Item_Description output  select @I_iDictID = 1493 select @I_iMessageNumber = 24652 select @I_iAliasMessageNumber = 0 exec DYNAMICS..smGetBIMsgString  @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @Vendor_Item_Number output  select @I_iDictID = 1493 select @I_iMessageNumber = 24653 select @I_iAliasMessageNumber = 0 exec DYNAMICS..smGetBIMsgString  @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @Item_Number output  select @I_iDictID = 1493 select @I_iMessageNumber = 24654 select @I_iAliasMessageNumber = 0 exec DYNAMICS..smGetBIMsgString  @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @Last_Currency_ID output  select @I_iDictID = 1493 select @I_iMessageNumber = 24655 select @I_iAliasMessageNumber = 0 exec DYNAMICS..smGetBIMsgString  @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @Last_ORD_Date output  select @I_iDictID = 1493 select @I_iMessageNumber = 24656 select @I_iAliasMessageNumber = 0 exec DYNAMICS..smGetBIMsgString  @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @Last_ORD_QTY output  select @I_iDictID = 1493 select @I_iMessageNumber = 24657 select @I_iAliasMessageNumber = 0 exec DYNAMICS..smGetBIMsgString  @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @Last_Originating_Cost output  select @I_iDictID = 1493 select @I_iMessageNumber = 24658 select @I_iAliasMessageNumber = 0 exec DYNAMICS..smGetBIMsgString  @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @Last_RCPT_Cost output  select @I_iDictID = 1493 select @I_iMessageNumber = 24659 select @I_iAliasMessageNumber = 0 exec DYNAMICS..smGetBIMsgString  @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @Last_RCPT_QTY output  select @I_iDictID = 1493 select @I_iMessageNumber = 24660 select @I_iAliasMessageNumber = 0 exec DYNAMICS..smGetBIMsgString  @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @Maximum_ORD_QTY output  select @I_iDictID = 1493 select @I_iMessageNumber = 24661 select @I_iAliasMessageNumber = 0 exec DYNAMICS..smGetBIMsgString  @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @Minimum_ORD_QTY output  select @I_iDictID = 1493 select @I_iMessageNumber = 24662 select @I_iAliasMessageNumber = 0 exec DYNAMICS..smGetBIMsgString  @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @Number_Of_RCPTS_For_Item output  select @I_iDictID = 1493 select @I_iMessageNumber = 24663 select @I_iAliasMessageNumber = 0 exec DYNAMICS..smGetBIMsgString  @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @Planning_Lead_Time output  select @I_iDictID = 1493 select @I_iMessageNumber = 24664 select @I_iAliasMessageNumber = 0 exec DYNAMICS..smGetBIMsgString  @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @QTY_Drop_Shipped output  select @I_iDictID = 1493 select @I_iMessageNumber = 24665 select @I_iAliasMessageNumber = 0 exec DYNAMICS..smGetBIMsgString  @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @QTY_On_Order output  select @I_iDictID = 1493 select @I_iMessageNumber = 24666 select @I_iAliasMessageNumber = 0 exec DYNAMICS..smGetBIMsgString  @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @QTY_Requisitioned output  select @I_iDictID = 1493 select @I_iMessageNumber = 24667 select @I_iAliasMessageNumber = 0 exec DYNAMICS..smGetBIMsgString  @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @Last_RCPT_Date output  select @I_iDictID = 1493 select @I_iMessageNumber = 24668 select @I_iAliasMessageNumber = 0 exec DYNAMICS..smGetBIMsgString  @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @Average_Lead_Time output  select @I_iDictID = 1493 select @I_iMessageNumber = 24669 select @I_iAliasMessageNumber = 0 exec DYNAMICS..smGetBIMsgString  @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @Purchasing_U_Of_M output  select @I_iDictID = 1493 select @I_iMessageNumber = 24670 select @I_iAliasMessageNumber = 0 exec DYNAMICS..smGetBIMsgString  @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @Currency_Index output  select @I_iDictID = 1493 select @I_iMessageNumber = 24671 select @I_iAliasMessageNumber = 0 exec DYNAMICS..smGetBIMsgString  @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @Economic_ORD_QTY output  select @I_iDictID = 1493 select @I_iMessageNumber = 24672 select @I_iAliasMessageNumber = 0 exec DYNAMICS..smGetBIMsgString  @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @Free_On_Board output  select @I_iDictID = 1493 select @I_iMessageNumber = 24673 select @I_iAliasMessageNumber = 0 exec DYNAMICS..smGetBIMsgString  @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @Item_Vendor_Type output   select @I_iDictID = 1493 select @I_iMessageNumber = 24650 select @I_iAliasMessageNumber = 22214 exec DYNAMICS..smGetBIMsgString  @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @Vendor_ID_For_DrillBack output   select @I_iDictID = 1493 select @I_iMessageNumber = 24653 select @I_iAliasMessageNumber = 22214 exec DYNAMICS..smGetBIMsgString  @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @Item_Number_For_DrillBack output   select @sqldropstring =   'if exists (select * from dbo.sysobjects where id = object_id(N''[dbo].[VendorItems]'') and OBJECTPROPERTY(id, N''IsView'') = 1) ' +  'drop view [dbo].[VendorItems] '  select @sqldefaultstring =   'CREATE VIEW VendorItems AS ' +   'select ' +   'rtrim([''Item Vendor Master''].[VENDORID]) as ''' + @Vendor_ID + ''', ' + 'rtrim([''Item Vendor Master''].[VNDITDSC]) as ''' + @Vendor_Item_Description + ''', ' + 'rtrim([''Item Vendor Master''].[VNDITNUM]) as ''' + @Vendor_Item_Number + ''', ' + 'rtrim([''Item Vendor Master''].[ITEMNMBR]) as ''' + @Item_Number + ''', '   select @sqlstring1 =   '[''Item Vendor Master''].[AVRGLDTM] as ''' + @Average_Lead_Time + ''', ' +  '[''Item Vendor Master''].[CURRNIDX] as ''' + @Currency_Index + ''', ' +  '[''Item Vendor Master''].[ECORDQTY] as ''' + @Economic_ORD_QTY + ''', ' +  '''' + @Free_On_Board + ''' = dbo.DYN_FUNC_Free_On_Board([''Item Vendor Master''].[FREEONBOARD]), ' +  '[''Item Vendor Master''].[ITMVNDTY] as ''' + @Item_Vendor_Type + ''', ' +  'rtrim([''Item Vendor Master''].[Last_Currency_ID]) as ''' + @Last_Currency_ID + ''', ' +  '[''Item Vendor Master''].[LSTORDDT] as ''' + @Last_ORD_Date + ''', ' +  '[''Item Vendor Master''].[LSORDQTY] as ''' + @Last_ORD_QTY + ''', ' +  '[''Item Vendor Master''].[Last_Originating_Cost] as ''' + @Last_Originating_Cost + ''', ' +  '[''Item Vendor Master''].[LRCPTCST] as ''' + @Last_RCPT_Cost + ''', ' +  '[''Item Vendor Master''].[LSRCPTDT] as ''' + @Last_RCPT_Date + ''', ' +  '[''Item Vendor Master''].[LRCPTQTY] as ''' + @Last_RCPT_QTY + ''', ' +  '[''Item Vendor Master''].[MAXORDQTY] as ''' + @Maximum_ORD_QTY + ''', ' +  '[''Item Vendor Master''].[MINORQTY] as ''' + @Minimum_ORD_QTY + ''', ' +  '[''Item Vendor Master''].[NORCTITM] as ''' + @Number_Of_RCPTS_For_Item + ''', ' +  '[''Item Vendor Master''].[PLANNINGLEADTIME] as ''' + @Planning_Lead_Time + ''', ' +  'rtrim([''Item Vendor Master''].[PRCHSUOM]) as ''' + @Purchasing_U_Of_M + ''', ' +  '[''Item Vendor Master''].[QTY_Drop_Shipped] as ''' + @QTY_Drop_Shipped + ''', ' +  '[''Item Vendor Master''].[QTYONORD] as ''' + @QTY_On_Order + ''', ' +  '[''Item Vendor Master''].[QTYRQSTN] as ''' + @QTY_Requisitioned + ''', ' + '''' + @Item_Number_For_DrillBack + ''' = ''' + @DrillBack_Base_Url + ''' +dbo.dgppItemID(1,[''Item Vendor Master''].[ITEMNMBR],'''' ), '+ '''' + @Vendor_ID_For_DrillBack + ''' = ''' + @DrillBack_Base_Url + ''' +dbo.dgppVendorID(1,[''Item Vendor Master''].[VENDORID] ) '  select @sqljoinstring =   'from [IV00103] as [''Item Vendor Master''] with (NOLOCK) '   select @sqlaccessstring =   'GRANT SELECT ON [dbo].[VendorItems] TO [rpt_warehouse manager]' + 'GRANT SELECT ON [dbo].[VendorItems] TO [rpt_materials manager]' + 'GRANT SELECT ON [dbo].[VendorItems] TO [rpt_operations manager]' + 'GRANT SELECT ON [dbo].[VendorItems] TO [rpt_production manager]' + 'GRANT SELECT ON [dbo].[VendorItems] TO [rpt_executive]' + 'GRANT SELECT ON [dbo].[VendorItems] TO [rpt_purchasing agent]'   exec (@sqldropstring)  exec (@sqldefaultstring+' '+@sqlstring1+' '+@sqlstring2+' '+@sqlstring3+' '+@sqlstring4+' '+@sqlstring5+' '+@sqlstring6+' '+@sqlstring7+' '+@sqlstring8+' '+@sqlstring9+' '+@sqlstring10+' '+@sqljoinstring)  exec (@sqlaccessstring)   set nocount off    
GO
GRANT EXECUTE ON  [dbo].[sp_Dynamics_VendorItems] TO [DYNGRP]
GO
