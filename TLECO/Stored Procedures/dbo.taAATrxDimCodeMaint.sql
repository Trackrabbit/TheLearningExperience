SET QUOTED_IDENTIFIER OFF
GO
SET ANSI_NULLS ON
GO
 create procedure [dbo].[taAATrxDimCodeMaint]  @I_vaaTrxDim char(30),    @I_vaaTrxDimCode char(30),   @I_vNOTETEXT varchar(8000) = null,  @I_vINACTIVE tinyint = null,   @I_vaaTrxDimCodeDescr char(50) = null,  @I_vaaTrxDimCodeDescr2 char(50) = null,  @I_vaaNode char(50) = null,    @I_vaaOwnedBy char(30) = null,   @I_vaaUDFText1 varchar(31) = null,   @I_vaaUDFText2 varchar(31) = null,  @I_vaaUDFText3 varchar(31) = null,   @I_vaaUDFText4 varchar(31) = null,   @I_vaaUDFText5 varchar(31) = null,   @I_vaaUDFDate1 datetime = null,   @I_vaaUDFDate2 datetime = null,   @I_vaaUDFDate3 datetime = null,   @I_vaaUDFDate4 datetime = null,   @I_vaaUDFDate5 datetime = null,   @I_vaaUDFNumeric1 numeric(12,5) = null,  @I_vaaUDFNumeric2 numeric(12,5) = null,  @I_vaaUDFNumeric3 numeric(12,5) = null,  @I_vaaUDFNumeric4 numeric(12,5) = null,  @I_vaaUDFNumeric5 numeric(12,5) = null,  @I_vaaUDFBoolean1 tinyint = null,   @I_vaaUDFBoolean2 tinyint = null,   @I_vaaUDFBoolean3 tinyint = null,   @I_vaaUDFBoolean4 tinyint = null,   @I_vaaUDFBoolean5 tinyint = null,   @I_vUpdateIfExists tinyint = 1,   @I_vRequesterTrx smallint = 0,   @I_vUSRDEFND1 char(50) = '',       @I_vUSRDEFND2 char(50) = '',       @I_vUSRDEFND3 char(50) = '',       @I_vUSRDEFND4 varchar(8000) = '',  @I_vUSRDEFND5 varchar(8000) = '',  @O_iErrorState int output,   @oErrString varchar(255) output  with encryption as  set transaction isolation level read uncommitted set nocount on  declare  @aaTrxDimID int,  @aaDataType smallint,  @iStatus int,  @iCustomState int,  @iCustomErrString varchar(255),  @O_oErrorState int,  @iError int,  @exists tinyint,  @CMPANYID smallint,  @aaAddCodesOnFly tinyint,  @aaTrxDimCodeID int,  @aaTreeID int,  @NOTEINDX numeric(19,5),  @iGetNextNoteIdxErrState int,  @iCursorError int,  @USERID char(15),  @aaNodeID int,  @aaAcctClassID int,  @ownerDimID int,  @ownerCodeID int,  @owned tinyint,  @ownerActive tinyint,  @existOwnerCodeID int  select  @aaTrxDimID = 0,  @aaDataType = 0,  @iStatus = 0,  @iCustomState = 0,  @iCustomErrString = '',  @O_oErrorState = 0,  @O_iErrorState = 0,  @iError = 0,  @exists = 0,  @CMPANYID = 0,  @aaAddCodesOnFly = 0,  @aaTrxDimCodeID = 0,  @aaTreeID = 0,  @NOTEINDX = 0,  @iGetNextNoteIdxErrState = 0,  @iCursorError = 0,  @USERID = '',  @aaNodeID = 0,  @aaAcctClassID = 0,  @ownerDimID = 0,  @ownerCodeID = 0,  @owned = 0,  @ownerActive = 0,  @existOwnerCodeID = 0  if (@oErrString is null) begin  select @oErrString = '' end  exec @iStatus = taAATrxDimCodeMaintPre  @I_vaaTrxDim output,  @I_vaaTrxDimCode output,  @I_vNOTETEXT output,  @I_vINACTIVE output,  @I_vaaTrxDimCodeDescr output,  @I_vaaTrxDimCodeDescr2 output,  @I_vaaNode output,  @I_vaaOwnedBy output,  @I_vaaUDFText1 output,  @I_vaaUDFText2 output,  @I_vaaUDFText3 output,  @I_vaaUDFText4 output,  @I_vaaUDFText5 output,  @I_vaaUDFDate1 output,  @I_vaaUDFDate2 output,  @I_vaaUDFDate3 output,  @I_vaaUDFDate4 output,  @I_vaaUDFDate5 output,  @I_vaaUDFNumeric1 output,  @I_vaaUDFNumeric2 output,  @I_vaaUDFNumeric3 output,  @I_vaaUDFNumeric4 output,  @I_vaaUDFNumeric5 output,  @I_vaaUDFBoolean1 output,  @I_vaaUDFBoolean2 output,  @I_vaaUDFBoolean3 output,  @I_vaaUDFBoolean4 output,  @I_vaaUDFBoolean5 output,  @I_vUpdateIfExists output,  @I_vRequesterTrx output,  @I_vUSRDEFND1 output,  @I_vUSRDEFND2 output,  @I_vUSRDEFND3 output,  @I_vUSRDEFND4 output,  @I_vUSRDEFND5 output,  @O_iErrorState = @iCustomState output,  @oErrString = @iCustomErrString output select @iError = @@error if ((@iStatus <> 0) or (@iCustomState <> 0) or (@iError <> 0)) begin  select @oErrString = rtrim(@oErrString) + ' ' + @iCustomErrString  select @O_iErrorState = 8600    exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output  return (@O_iErrorState) end  if (  @I_vaaTrxDim is null or  @I_vaaTrxDimCode is null) begin  select @O_iErrorState = 8601    exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output  return (@O_iErrorState) end  select  @I_vaaTrxDim = UPPER(@I_vaaTrxDim),  @I_vaaTrxDimCode = UPPER(@I_vaaTrxDimCode),  @I_vaaOwnedBy = UPPER(@I_vaaOwnedBy)  select @CMPANYID = CMPANYID from DYNAMICS..SY01500 (nolock) where INTERID = db_name()  select  @aaTrxDimID = aaTrxDimID,  @aaDataType = aaDataType,  @aaAddCodesOnFly = aaAddCodesOnFly  from AAG00400 (nolock) where aaTrxDim = @I_vaaTrxDim  if (@aaTrxDimID = 0) begin  select @O_iErrorState = 8602    exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output  return (@O_iErrorState) end  if ((@aaAddCodesOnFly <> 1) and (@I_vUpdateIfExists = 0)) begin  select @O_iErrorState = 8603     exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output  return (@O_iErrorState) end  if (@aaDataType <> 1) begin  select @O_iErrorState = 8604    exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output  return (@O_iErrorState) end  if ((@I_vINACTIVE not in (0,1)) and (@I_vINACTIVE is not null)) begin  select @O_iErrorState = 8605     exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output  return (@O_iErrorState) end  if (exists(select 1 from AAG00401 (nolock) where aaTrxDimID = @aaTrxDimID and aaTrxDimCode = @I_vaaTrxDimCode)) begin  select @exists = 1   if (@I_vUpdateIfExists = 0)  begin  select @O_iErrorState = 8606     exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output  return (@O_iErrorState)  end   if (@I_vUpdateIfExists = 2)  begin  return (@O_iErrorState)  end   if ((exists(select 1 from AAG00405 (nolock) where aaTrxDimID = @aaTrxDimID and aaTrxDimRelType = 4))  and (@I_vINACTIVE = 1))  begin  select @O_iErrorState = 8607     exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output  return (@O_iErrorState)  end   select @I_vINACTIVE =   case  when @I_vINACTIVE is null  then INACTIVE  else @I_vINACTIVE  end,  @I_vaaTrxDimCodeDescr =  case  when @I_vaaTrxDimCodeDescr is null  then aaTrxDimCodeDescr  else @I_vaaTrxDimCodeDescr  end,  @I_vaaTrxDimCodeDescr2 =   case  when @I_vaaTrxDimCodeDescr2 is null  then aaTrxDimCodeDescr2  else @I_vaaTrxDimCodeDescr2  end,  @aaTrxDimCodeID = aaTrxDimCodeID,  @NOTEINDX = NOTEINDX  from AAG00401 (nolock) where aaTrxDimID = @aaTrxDimID and aaTrxDimCode = @I_vaaTrxDimCode  end  if exists(select 1 from AAG00405 (nolock) where aaTrxDimID = @aaTrxDimID and aaTrxDimRelType = 3) begin  select @owned = 1  select @ownerDimID = aaTrxDimID from AAG00405 (nolock) where aaRelTrxDimID = @aaTrxDimID and aaTrxDimRelType = 4  select @ownerCodeID = aaTrxDimCodeID, @ownerActive = INACTIVE from AAG00401 (nolock) where aaTrxDimID = @ownerDimID and aaTrxDimCode = @I_vaaOwnedBy  if not exists(select 1 from AAG00401 (nolock) where aaTrxDimID = @ownerDimID and aaTrxDimCode = @I_vaaOwnedBy)   begin  select @O_iErrorState = 11523   exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output  return (@O_iErrorState)  end   if (((@I_vaaOwnedBy is null) and (@exists = 0)) or (@I_vaaOwnedBy = ''))  begin  select @O_iErrorState = 8608     exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output  return (@O_iErrorState)  end   if (@ownerDimID = 0)  begin  select @O_iErrorState = 8609     exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output  return (@O_iErrorState)  end   if (@ownerActive = 1)  begin  select @O_iErrorState = 8610     exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output  return (@O_iErrorState)  end end  if (@exists = 0) begin  if (@I_vUpdateIfExists = 2)  begin  select @I_vUpdateIfExists = 0  end   if ((@I_vaaTrxDimCodeDescr is null) or (@I_vaaTrxDimCodeDescr = ''))  begin  select @O_iErrorState = 8611     exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output  return (@O_iErrorState)  end   select @aaTreeID = aaTreeID from AAG00600 (nolock) where aaTree = 'MT_' + @I_vaaTrxDim   if ((@I_vaaNode is null) or (@I_vaaNode = ''))  begin  select @O_iErrorState = 8612     exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output  return (@O_iErrorState)  end   select @aaNodeID = aaNodeID from AAG00601 (nolock) where aaTreeID = @aaTreeID and aaNode = @I_vaaNode  if (@aaNodeID = 0)  begin  select @O_iErrorState = 8513     exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output  return (@O_iErrorState)  end   select @I_vINACTIVE =  case  when @I_vINACTIVE is null  then 0  else @I_vINACTIVE  end,  @I_vaaTrxDimCodeDescr2 =  case  when @I_vaaTrxDimCodeDescr2 is null  then ''  else @I_vaaTrxDimCodeDescr2  end,  @I_vaaUDFText1 =  case  when @I_vaaUDFText1 is null  then ''  else @I_vaaUDFText1  end,  @I_vaaUDFText2 =  case  when @I_vaaUDFText2 is null  then ''  else @I_vaaUDFText2  end,  @I_vaaUDFText3 =  case  when @I_vaaUDFText3 is null  then ''  else @I_vaaUDFText3  end,  @I_vaaUDFText4 =  case  when @I_vaaUDFText4 is null  then ''  else @I_vaaUDFText4  end,  @I_vaaUDFText5 =  case  when @I_vaaUDFText5 is null  then ''  else @I_vaaUDFText5  end,  @I_vaaUDFDate1 =  case  when @I_vaaUDFDate1 is null  then ''  else @I_vaaUDFDate1  end,  @I_vaaUDFDate2 =  case  when @I_vaaUDFDate2 is null  then ''  else @I_vaaUDFDate2  end,  @I_vaaUDFDate3 =  case  when @I_vaaUDFDate3 is null  then ''  else @I_vaaUDFDate3  end,  @I_vaaUDFDate4 =  case  when @I_vaaUDFDate4 is null  then ''  else @I_vaaUDFDate4  end,  @I_vaaUDFDate5 =  case  when @I_vaaUDFDate5 is null  then ''  else @I_vaaUDFDate5  end,  @I_vaaUDFNumeric1 =  case  when @I_vaaUDFNumeric1 is null  then 0  else @I_vaaUDFNumeric1  end,  @I_vaaUDFNumeric2 =  case  when @I_vaaUDFNumeric2 is null  then 0  else @I_vaaUDFNumeric2  end,  @I_vaaUDFNumeric3 =  case  when @I_vaaUDFNumeric3 is null  then 0  else @I_vaaUDFNumeric3  end,  @I_vaaUDFNumeric4 =  case  when @I_vaaUDFNumeric4 is null  then 0  else @I_vaaUDFNumeric4  end,  @I_vaaUDFNumeric5 =  case  when @I_vaaUDFNumeric5 is null  then 0  else @I_vaaUDFNumeric5  end,  @I_vaaUDFBoolean1 =  case  when @I_vaaUDFBoolean1 is null  then 0  else @I_vaaUDFBoolean1  end,  @I_vaaUDFBoolean2 =  case  when @I_vaaUDFBoolean2 is null  then 0  else @I_vaaUDFBoolean2  end,  @I_vaaUDFBoolean3 =  case  when @I_vaaUDFBoolean3 is null  then 0  else @I_vaaUDFBoolean3  end,  @I_vaaUDFBoolean4 =  case  when @I_vaaUDFBoolean4 is null  then 0  else @I_vaaUDFBoolean4  end,  @I_vaaUDFBoolean5 =  case  when @I_vaaUDFBoolean5 is null  then 0  else @I_vaaUDFBoolean5  end   if exists (select 1 from DYNAMICS..AAG00102 (nolock) where aaTableID = 401 and CMPANYID = @CMPANYID)  begin  update DYNAMICS..AAG00102  set @aaTrxDimCodeID = aaRowID + 1,  aaRowID = aaRowID + 1  where aaTableID = 401 and CMPANYID = @CMPANYID  end  else  begin   insert DYNAMICS..AAG00102  (  aaTableID,  CMPANYID,  aaRowID  )  select  401,  @CMPANYID,  1   end  if (@@error <> 0)  begin  select @O_iErrorState = 8614    exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output  return (@O_iErrorState)  end   exec @iStatus = DYNAMICS..tasmGetNextNoteIndex  @I_sCompanyID   = @CMPANYID,  @I_iSQLSessionID = 0,  @O_mNoteIndex   = @NOTEINDX output,  @O_iErrorState  = @iGetNextNoteIdxErrState output  select @iError = @@error  if ((@iStatus <> 0) or (@iGetNextNoteIdxErrState <> 0) or (@iError <> 0))  begin  if @iGetNextNoteIdxErrState <> 0 select @oErrString = rtrim(@oErrString) + ' ' + @iGetNextNoteIdxErrState  select @O_iErrorState = 8615   exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output  return (@O_iErrorState)  end end  if (@O_iErrorState <> 0) begin  return (@O_iErrorState) end  if (@exists = 0) begin  insert AAG00401  (  aaTrxDimID,  aaTrxDimCodeID,  aaTrxDimCode,  aaTrxDimCodeDescr,  aaTrxDimCodeDescr2,  NOTEINDX,  INACTIVE  )  select  @aaTrxDimID,    @aaTrxDimCodeID,   @I_vaaTrxDimCode,   @I_vaaTrxDimCodeDescr,   @I_vaaTrxDimCodeDescr2,   @NOTEINDX,    @I_vINACTIVE    if (@@error <> 0)  begin  select @O_iErrorState = 8616    exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output  return (@O_iErrorState)  end   if (@owned = 1)  begin  insert AAG00406  (  aaTrxDimID,  aaTrxDimCodeID,  aaRelTrxDimID,  aaRelTrxDimCodeID  )  select  @aaTrxDimID,    @aaTrxDimCodeID,   @ownerDimID,    @ownerCodeID    if (@@error <> 0)  begin  select @O_iErrorState = 8617    exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output  return (@O_iErrorState)  end   insert AAG00406  (  aaTrxDimID,  aaTrxDimCodeID,  aaRelTrxDimID,  aaRelTrxDimCodeID  )  select  @ownerDimID,    @ownerCodeID,    @aaTrxDimID,    @aaTrxDimCodeID    if (@@error <> 0)  begin  select @O_iErrorState = 8618    exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output  return (@O_iErrorState)  end  end   insert AAG01002  (  aaTrxDimID,  aaTrxDimCodeID,  aaUDFID,  aaUDFText,  aaUDFDate,  aaUDFNumeric,  aaUDFBoolean  )  select  @aaTrxDimID,    @aaTrxDimCodeID,   1,     @I_vaaUDFText1,    '',     0,     0     if (@@error <> 0)  begin  select @O_iErrorState = 8619    exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output  return (@O_iErrorState)  end   insert AAG01002  (  aaTrxDimID,  aaTrxDimCodeID,  aaUDFID,  aaUDFText,  aaUDFDate,  aaUDFNumeric,  aaUDFBoolean  )  select  @aaTrxDimID,    @aaTrxDimCodeID,   2,     @I_vaaUDFText2,    '',     0,     0     if (@@error <> 0)  begin  select @O_iErrorState = 8620    exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output  return (@O_iErrorState)  end   insert AAG01002  (  aaTrxDimID,  aaTrxDimCodeID,  aaUDFID,  aaUDFText,  aaUDFDate,  aaUDFNumeric,  aaUDFBoolean  )  select  @aaTrxDimID,    @aaTrxDimCodeID,   3,     @I_vaaUDFText3,    '',     0,     0     if (@@error <> 0)  begin  select @O_iErrorState = 8621    exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output  return (@O_iErrorState)  end   insert AAG01002  (  aaTrxDimID,  aaTrxDimCodeID,  aaUDFID,  aaUDFText,  aaUDFDate,  aaUDFNumeric,  aaUDFBoolean  )  select  @aaTrxDimID,    @aaTrxDimCodeID,   4,     @I_vaaUDFText4,    '',     0,     0     if (@@error <> 0)  begin  select @O_iErrorState = 8622    exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output  return (@O_iErrorState)  end   insert AAG01002  (  aaTrxDimID,  aaTrxDimCodeID,  aaUDFID,  aaUDFText,  aaUDFDate,  aaUDFNumeric,  aaUDFBoolean  )  select  @aaTrxDimID,    @aaTrxDimCodeID,   5,     @I_vaaUDFText5,    '',     0,     0     if (@@error <> 0)  begin  select @O_iErrorState = 8623    exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output  return (@O_iErrorState)  end   insert AAG01002  (  aaTrxDimID,  aaTrxDimCodeID,  aaUDFID,  aaUDFText,  aaUDFDate,  aaUDFNumeric,  aaUDFBoolean  )  select  @aaTrxDimID,    @aaTrxDimCodeID,   6,     '',     @I_vaaUDFDate1,    0,     0     if (@@error <> 0)  begin  select @O_iErrorState = 8624    exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output  return (@O_iErrorState)  end   insert AAG01002  (  aaTrxDimID,  aaTrxDimCodeID,  aaUDFID,  aaUDFText,  aaUDFDate,  aaUDFNumeric,  aaUDFBoolean  )  select  @aaTrxDimID,    @aaTrxDimCodeID,   7,     '',     @I_vaaUDFDate2,    0,     0     if (@@error <> 0)  begin  select @O_iErrorState = 8625    exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output  return (@O_iErrorState)  end   insert AAG01002  (  aaTrxDimID,  aaTrxDimCodeID,  aaUDFID,  aaUDFText,  aaUDFDate,  aaUDFNumeric,  aaUDFBoolean  )  select  @aaTrxDimID,    @aaTrxDimCodeID,   8,     '',     @I_vaaUDFDate3,    0,     0     if (@@error <> 0)  begin  select @O_iErrorState = 8626    exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output  return (@O_iErrorState)  end   insert AAG01002  (  aaTrxDimID,  aaTrxDimCodeID,  aaUDFID,  aaUDFText,  aaUDFDate,  aaUDFNumeric,  aaUDFBoolean  )  select  @aaTrxDimID,    @aaTrxDimCodeID,   9,     '',     @I_vaaUDFDate4,    0,     0     if (@@error <> 0)  begin  select @O_iErrorState = 8627    exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output  return (@O_iErrorState)  end   insert AAG01002  (  aaTrxDimID,  aaTrxDimCodeID,  aaUDFID,  aaUDFText,  aaUDFDate,  aaUDFNumeric,  aaUDFBoolean  )  select  @aaTrxDimID,    @aaTrxDimCodeID,   10,     '',     @I_vaaUDFDate5,    0,     0     if (@@error <> 0)  begin  select @O_iErrorState = 8628    exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output  return (@O_iErrorState)  end   insert AAG01002  (  aaTrxDimID,  aaTrxDimCodeID,  aaUDFID,  aaUDFText,  aaUDFDate,  aaUDFNumeric,  aaUDFBoolean  )  select  @aaTrxDimID,    @aaTrxDimCodeID,   11,     '',     '',     @I_vaaUDFNumeric1,   0     if (@@error <> 0)  begin  select @O_iErrorState = 8629    exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output  return (@O_iErrorState)  end   insert AAG01002  (  aaTrxDimID,  aaTrxDimCodeID,  aaUDFID,  aaUDFText,  aaUDFDate,  aaUDFNumeric,  aaUDFBoolean  )  select  @aaTrxDimID,    @aaTrxDimCodeID,   12,     '',     '',     @I_vaaUDFNumeric2,   0     if (@@error <> 0)  begin  select @O_iErrorState = 8630    exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output  return (@O_iErrorState)  end   insert AAG01002  (  aaTrxDimID,  aaTrxDimCodeID,  aaUDFID,  aaUDFText,  aaUDFDate,  aaUDFNumeric,  aaUDFBoolean  )  select  @aaTrxDimID,    @aaTrxDimCodeID,   13,     '',     '',     @I_vaaUDFNumeric3,   0     if (@@error <> 0)  begin  select @O_iErrorState = 8631    exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output  return (@O_iErrorState)  end   insert AAG01002  (  aaTrxDimID,  aaTrxDimCodeID,  aaUDFID,  aaUDFText,  aaUDFDate,  aaUDFNumeric,  aaUDFBoolean  )  select  @aaTrxDimID,    @aaTrxDimCodeID,   14,     '',     '',     @I_vaaUDFNumeric4,   0     if (@@error <> 0)  begin  select @O_iErrorState = 8632    exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output  return (@O_iErrorState)  end   insert AAG01002  (  aaTrxDimID,  aaTrxDimCodeID,  aaUDFID,  aaUDFText,  aaUDFDate,  aaUDFNumeric,  aaUDFBoolean  )  select  @aaTrxDimID,    @aaTrxDimCodeID,   15,     '',     '',     @I_vaaUDFNumeric5,   0     if (@@error <> 0)  begin  select @O_iErrorState = 8633    exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output  return (@O_iErrorState)  end   insert AAG01002  (  aaTrxDimID,  aaTrxDimCodeID,  aaUDFID,  aaUDFText,  aaUDFDate,  aaUDFNumeric,  aaUDFBoolean  )  select  @aaTrxDimID,    @aaTrxDimCodeID,   16,     '',     '',     0,     @I_vaaUDFBoolean1   if (@@error <> 0)  begin  select @O_iErrorState = 8634    exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output  return (@O_iErrorState)  end   insert AAG01002  (  aaTrxDimID,  aaTrxDimCodeID,  aaUDFID,  aaUDFText,  aaUDFDate,  aaUDFNumeric,  aaUDFBoolean  )  select  @aaTrxDimID,    @aaTrxDimCodeID,   17,     '',     '',     0,     @I_vaaUDFBoolean2   if (@@error <> 0)  begin  select @O_iErrorState = 8635    exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output  return (@O_iErrorState)  end   insert AAG01002  (  aaTrxDimID,  aaTrxDimCodeID,  aaUDFID,  aaUDFText,  aaUDFDate,  aaUDFNumeric,  aaUDFBoolean  )  select  @aaTrxDimID,    @aaTrxDimCodeID,   18,     '',     '',     0,     @I_vaaUDFBoolean3   if (@@error <> 0)  begin  select @O_iErrorState = 8636    exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output  return (@O_iErrorState)  end   insert AAG01002  (  aaTrxDimID,  aaTrxDimCodeID,  aaUDFID,  aaUDFText,  aaUDFDate,  aaUDFNumeric,  aaUDFBoolean  )  select  @aaTrxDimID,    @aaTrxDimCodeID,   19,     '',     '',     0,     @I_vaaUDFBoolean4   if (@@error <> 0)  begin  select @O_iErrorState = 8637    exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output  return (@O_iErrorState)  end   insert AAG01002  (  aaTrxDimID,  aaTrxDimCodeID,  aaUDFID,  aaUDFText,  aaUDFDate,  aaUDFNumeric,  aaUDFBoolean  )  select  @aaTrxDimID,    @aaTrxDimCodeID,   20,     '',     '',     0,     @I_vaaUDFBoolean5   if (@@error <> 0)  begin  select @O_iErrorState = 8638    exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output  return (@O_iErrorState)  end   declare Users INSENSITIVE cursor for select  USERID  from DYNAMICS..SY01400 (nolock)   open Users  select @iCursorError = @@cursor_rows   if (@iCursorError > 0)  begin  fetch next from Users into  @USERID  while (@@fetch_status <> -1)  begin  if (@@fetch_status = -2)  begin  select @O_iErrorState = 8639    break  end   insert AAG02000  (  USERID,  aaTrxDimID,  aaTrxDimCodeID,  aaView,  aaEdit,  aaDistribute,  aaAdjust,  aaBudgetView,  aaBudgetAssign   )  select  @USERID,    @aaTrxDimID,    @aaTrxDimCodeID,   0,     0,     0,      0,       0,     0     select @iError = @@error  if @iStatus = 0 and @iError <> 0  select @iStatus = @iError  if (@iStatus <> 0) or (@O_oErrorState <> 0)  begin  select @O_iErrorState = 8640    deallocate Users  return (@O_iErrorState)  end   fetch next from Users into  @USERID  end  end  deallocate Users end  if (@exists = 1) begin  update AAG00401 set  INACTIVE = @I_vINACTIVE,  aaTrxDimCodeDescr = @I_vaaTrxDimCodeDescr,  aaTrxDimCodeDescr2 = @I_vaaTrxDimCodeDescr2  where aaTrxDimID = @aaTrxDimID and aaTrxDimCodeID = @aaTrxDimCodeID  if (@@error <> 0)  begin  select @O_iErrorState = 8641    exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output  return (@O_iErrorState)  end   if (@I_vaaNode is not null)  begin  select @aaTreeID = aaTreeID from AAG00600 (nolock) where aaTree = 'MT_' + @I_vaaTrxDim  select @aaNodeID = aaNodeID from AAG00601 (nolock) where aaTreeID = @aaTreeID and aaNode = @I_vaaNode  if (@aaNodeID = 0)  begin  select @O_iErrorState = 8642     exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output  return (@O_iErrorState)  end   update AAG00602 set aaNodeID = @aaNodeID  where aaTreeID = @aaTreeID and aaMstrID = @aaTrxDimCodeID  if (@@error <> 0)  begin  select @O_iErrorState = 8643     exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output  return (@O_iErrorState)  end  end   if ((@I_vaaOwnedBy is not null) and (@owned = 1))  begin  select @existOwnerCodeID = aaRelTrxDimCodeID from AAG00406 (nolock)  where aaTrxDimID = @aaTrxDimID and aaTrxDimCodeID = @aaTrxDimCodeID and aaRelTrxDimID = @ownerDimID  if (@existOwnerCodeID <> @ownerCodeID)  begin  delete AAG00406  where aaTrxDimID = @aaTrxDimID and aaTrxDimCodeID = @aaTrxDimCodeID and  aaRelTrxDimID = @ownerDimID and aaRelTrxDimCodeID = @existOwnerCodeID  if (@@error <> 0)  begin  select @O_iErrorState = 8644    exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output  return (@O_iErrorState)  end   delete AAG00406  where aaTrxDimID = @ownerDimID and aaTrxDimCodeID = @existOwnerCodeID and  aaRelTrxDimID = @aaTrxDimID and aaRelTrxDimCodeID = @aaTrxDimCodeID  if (@@error <> 0)  begin  select @O_iErrorState = 8645    exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output  return (@O_iErrorState)  end   insert AAG00406  (  aaTrxDimID,  aaTrxDimCodeID,  aaRelTrxDimID,  aaRelTrxDimCodeID  )  select  @aaTrxDimID,    @aaTrxDimCodeID,   @ownerDimID,    @ownerCodeID    if (@@error <> 0)  begin  select @O_iErrorState = 8646    exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output  return (@O_iErrorState)  end   insert AAG00406  (  aaTrxDimID,  aaTrxDimCodeID,  aaRelTrxDimID,  aaRelTrxDimCodeID  )  select  @ownerDimID,    @ownerCodeID,    @aaTrxDimID,    @aaTrxDimCodeID    if (@@error <> 0)  begin  select @O_iErrorState = 8647    exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output  return (@O_iErrorState)  end  end  end   if (@I_vaaUDFText1 is not null)  begin  update AAG01002 set  aaUDFText = @I_vaaUDFText1  where aaTrxDimID = @aaTrxDimID and  aaTrxDimCodeID = @aaTrxDimCodeID and aaUDFID = 1  if (@@error <> 0)  begin  select @O_iErrorState = 8648     exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output  return (@O_iErrorState)  end  end   if (@I_vaaUDFText2 is not null)  begin  update AAG01002 set  aaUDFText = @I_vaaUDFText2  where aaTrxDimID = @aaTrxDimID and  aaTrxDimCodeID = @aaTrxDimCodeID and aaUDFID = 2  if (@@error <> 0)  begin  select @O_iErrorState = 8649     exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output  return (@O_iErrorState)  end  end   if (@I_vaaUDFText3 is not null)  begin  update AAG01002 set  aaUDFText = @I_vaaUDFText3  where aaTrxDimID = @aaTrxDimID and  aaTrxDimCodeID = @aaTrxDimCodeID and aaUDFID = 3  if (@@error <> 0)  begin  select @O_iErrorState = 8650     exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output  return (@O_iErrorState)  end  end   if (@I_vaaUDFText4 is not null)  begin  update AAG01002 set  aaUDFText = @I_vaaUDFText4  where aaTrxDimID = @aaTrxDimID and  aaTrxDimCodeID = @aaTrxDimCodeID and aaUDFID = 4  if (@@error <> 0)  begin  select @O_iErrorState = 8651     exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output  return (@O_iErrorState)  end  end   if (@I_vaaUDFText5 is not null)  begin  update AAG01002 set  aaUDFText = @I_vaaUDFText5  where aaTrxDimID = @aaTrxDimID and  aaTrxDimCodeID = @aaTrxDimCodeID and aaUDFID = 5  if (@@error <> 0)  begin  select @O_iErrorState = 8652     exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output  return (@O_iErrorState)  end  end   if (@I_vaaUDFDate1 is not null)  begin  update AAG01002 set  aaUDFDate = @I_vaaUDFDate1  where aaTrxDimID = @aaTrxDimID and  aaTrxDimCodeID = @aaTrxDimCodeID and aaUDFID = 6  if (@@error <> 0)  begin  select @O_iErrorState = 8653     exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output  return (@O_iErrorState)  end  end   if (@I_vaaUDFDate2 is not null)  begin  update AAG01002 set  aaUDFDate = @I_vaaUDFDate2  where aaTrxDimID = @aaTrxDimID and  aaTrxDimCodeID = @aaTrxDimCodeID and aaUDFID = 7  if (@@error <> 0)  begin  select @O_iErrorState = 8654     exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output  return (@O_iErrorState)  end  end   if (@I_vaaUDFDate3 is not null)  begin  update AAG01002 set  aaUDFDate = @I_vaaUDFDate3  where aaTrxDimID = @aaTrxDimID and  aaTrxDimCodeID = @aaTrxDimCodeID and aaUDFID = 8  if (@@error <> 0)  begin  select @O_iErrorState = 8655     exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output  return (@O_iErrorState)  end  select @I_vaaUDFDate3 = aaUDFDate from AAG01002 (nolock) where aaTrxDimID = @aaTrxDimID and  aaTrxDimCodeID = @aaTrxDimCodeID and aaUDFID = 8  end   if (@I_vaaUDFDate4 is not null)  begin  update AAG01002 set  aaUDFDate = @I_vaaUDFDate4  where aaTrxDimID = @aaTrxDimID and  aaTrxDimCodeID = @aaTrxDimCodeID and aaUDFID = 9  if (@@error <> 0)  begin  select @O_iErrorState = 8656     exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output  return (@O_iErrorState)  end  end   if (@I_vaaUDFDate5 is not null)  begin  update AAG01002 set  aaUDFDate = @I_vaaUDFDate5  where aaTrxDimID = @aaTrxDimID and  aaTrxDimCodeID = @aaTrxDimCodeID and aaUDFID = 10  if (@@error <> 0)  begin  select @O_iErrorState = 8657     exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output  return (@O_iErrorState)  end  end   if (@I_vaaUDFNumeric1 is not null)  begin  update AAG01002 set  aaUDFNumeric = @I_vaaUDFNumeric1  where aaTrxDimID = @aaTrxDimID and  aaTrxDimCodeID = @aaTrxDimCodeID and aaUDFID = 11  if (@@error <> 0)  begin  select @O_iErrorState = 8658     exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output  return (@O_iErrorState)  end  end   if (@I_vaaUDFNumeric2 is not null)  begin  update AAG01002 set  aaUDFNumeric = @I_vaaUDFNumeric2  where aaTrxDimID = @aaTrxDimID and  aaTrxDimCodeID = @aaTrxDimCodeID and aaUDFID = 12  if (@@error <> 0)  begin  select @O_iErrorState = 8659     exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output  return (@O_iErrorState)  end  end   if (@I_vaaUDFNumeric3 is not null)  begin  update AAG01002 set  aaUDFNumeric = @I_vaaUDFNumeric3  where aaTrxDimID = @aaTrxDimID and  aaTrxDimCodeID = @aaTrxDimCodeID and aaUDFID = 13  if (@@error <> 0)  begin  select @O_iErrorState = 8660     exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output  return (@O_iErrorState)  end  end   if (@I_vaaUDFNumeric4 is not null)  begin  update AAG01002 set  aaUDFNumeric = @I_vaaUDFNumeric4  where aaTrxDimID = @aaTrxDimID and  aaTrxDimCodeID = @aaTrxDimCodeID and aaUDFID = 14  if (@@error <> 0)  begin  select @O_iErrorState = 8661     exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output  return (@O_iErrorState)  end  end   if (@I_vaaUDFNumeric5 is not null)  begin  update AAG01002 set  aaUDFNumeric = @I_vaaUDFNumeric5  where aaTrxDimID = @aaTrxDimID and  aaTrxDimCodeID = @aaTrxDimCodeID and aaUDFID = 15  if (@@error <> 0)  begin  select @O_iErrorState = 8662     exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output  return (@O_iErrorState)  end  end   if (@I_vaaUDFBoolean1 is not null)  begin  update AAG01002 set  aaUDFBoolean = @I_vaaUDFBoolean1  where aaTrxDimID = @aaTrxDimID and  aaTrxDimCodeID = @aaTrxDimCodeID and aaUDFID = 16  if (@@error <> 0)  begin  select @O_iErrorState = 8663     exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output  return (@O_iErrorState)  end  end   if (@I_vaaUDFBoolean2 is not null)  begin  update AAG01002 set  aaUDFBoolean = @I_vaaUDFBoolean2  where aaTrxDimID = @aaTrxDimID and  aaTrxDimCodeID = @aaTrxDimCodeID and aaUDFID = 17  if (@@error <> 0)  begin  select @O_iErrorState = 8664     exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output  return (@O_iErrorState)  end  end   if (@I_vaaUDFBoolean3 is not null)  begin  update AAG01002 set  aaUDFBoolean = @I_vaaUDFBoolean3  where aaTrxDimID = @aaTrxDimID and  aaTrxDimCodeID = @aaTrxDimCodeID and aaUDFID = 18  if (@@error <> 0)  begin  select @O_iErrorState = 8665     exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output  return (@O_iErrorState)  end  end   if (@I_vaaUDFBoolean4 is not null)  begin  update AAG01002 set  aaUDFBoolean = @I_vaaUDFBoolean4  where aaTrxDimID = @aaTrxDimID and  aaTrxDimCodeID = @aaTrxDimCodeID and aaUDFID = 19  if (@@error <> 0)  begin  select @O_iErrorState = 8666     exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output  return (@O_iErrorState)  end  end   if (@I_vaaUDFBoolean5 is not null)  begin  update AAG01002 set  aaUDFBoolean = @I_vaaUDFBoolean5  where aaTrxDimID = @aaTrxDimID and  aaTrxDimCodeID = @aaTrxDimCodeID and aaUDFID = 20  if (@@error <> 0)  begin  select @O_iErrorState = 8667     exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output  return (@O_iErrorState)  end  end end  if (@I_vNOTETEXT is not null) begin  if (@I_vNOTETEXT <> '')  begin  if (not exists(select top 1 NOTEINDX from SY03900 (nolock) where NOTEINDX = @NOTEINDX))  begin  insert SY03900   (  NOTEINDX,   DATE1,   TIME1,   TXTFIELD  )   select   @NOTEINDX,  cast(convert(varchar(50),getdate(),102) as datetime),  cast(convert(varchar(50),getdate(),108) as datetime),  @I_vNOTETEXT  if (@@error <> 0)  begin  select @O_iErrorState = 8668    exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output  return (@O_iErrorState)  end  end  else  begin  update SY03900 set  DATE1 = cast(convert(varchar(50),getdate(),102) as datetime),  TIME1 = cast(convert(varchar(50),getdate(),108) as datetime),  TXTFIELD = @I_vNOTETEXT  where NOTEINDX = @NOTEINDX  if (@@error <> 0)  begin  select @O_iErrorState = 8669    exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output  return (@O_iErrorState)  end  end  end  else  begin  delete SY03900 where NOTEINDX = @NOTEINDX  if (@@error <> 0)  begin  select @O_iErrorState = 8670    exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output  return (@O_iErrorState)  end  end end  exec @iStatus = taAATrxDimCodeMaintPost  @I_vaaTrxDim,  @I_vaaTrxDimCode,  @I_vNOTETEXT,  @I_vINACTIVE,  @I_vaaTrxDimCodeDescr,  @I_vaaTrxDimCodeDescr2,  @I_vaaNode,  @I_vaaOwnedBy,  @I_vaaUDFText1,  @I_vaaUDFText2,  @I_vaaUDFText3,  @I_vaaUDFText4,  @I_vaaUDFText5,  @I_vaaUDFDate1,  @I_vaaUDFDate2,  @I_vaaUDFDate3,  @I_vaaUDFDate4,  @I_vaaUDFDate5,  @I_vaaUDFNumeric1,  @I_vaaUDFNumeric2,  @I_vaaUDFNumeric3,  @I_vaaUDFNumeric4,  @I_vaaUDFNumeric5,  @I_vaaUDFBoolean1,  @I_vaaUDFBoolean2,  @I_vaaUDFBoolean3,  @I_vaaUDFBoolean4,  @I_vaaUDFBoolean5,  @I_vUpdateIfExists,  @I_vRequesterTrx,  @I_vUSRDEFND1,  @I_vUSRDEFND2,  @I_vUSRDEFND3,  @I_vUSRDEFND4,  @I_vUSRDEFND5,  @O_iErrorState = @iCustomState output,  @oErrString = @iCustomErrString output select @iError = @@error if ((@iStatus <> 0) or (@iCustomState <> 0) or (@iError <> 0)) begin  select @oErrString = rtrim(@oErrString) + ' ' + @iCustomErrString  select @O_iErrorState = 8671    exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output  return (@O_iErrorState) end  return (@O_iErrorState)   
GO
GRANT EXECUTE ON  [dbo].[taAATrxDimCodeMaint] TO [DYNGRP]
GO
