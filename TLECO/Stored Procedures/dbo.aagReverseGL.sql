SET QUOTED_IDENTIFIER OFF
GO
SET ANSI_NULLS ON
GO
 CREATE            procedure [dbo].[aagReverseGL] @aaGLHdrID int, @JRNENTRY int, @CompayID smallint, @nYear int, @cTrxSource char(13), @caaAuditTrailCode char(13), @I_cUserID char(15), @RVRSNGDT datetime, @RCTRXSEQ numeric(19,5), @fHist    tinyint, @Ledger_ID smallint  as begin   declare @HdrID integer   select @HdrID  = 0   update AAG30000 set aaTRXType = 1 where aaGLHdrID = @aaGLHdrID   exec DYNAMICS.dbo.aagGetNextID 30000, @CompayID, @HdrID output    insert into AAG30000  (aaGLHdrID, JRNENTRY, RCTRXSEQ, YEAR1, aaTRXType, aaGLTRXSource,   aaTRXSource, GLPOSTDT,Ledger_ID)  values  (@HdrID, @JRNENTRY, @RCTRXSEQ ,@nYear,1, @cTrxSource,@caaAuditTrailCode,@RVRSNGDT,@Ledger_ID)  if @fHist=1   Begin   Insert into AAG30001   (aaGLHdrID, aaGLDistID,INTERID,CorrespondingUnit,ACTINDX,ACCTTYPE,aaBrowseType,   DECPLACS,DEBITAMT,CRDTAMNT,ORDBTAMT,ORCRDAMT,CURNCYID,CURRNIDX,   RATETPID,EXGTBLID,XCHGRATE,EXCHDATE,TIME1,RTCLCMTD,DENXRATE,MCTRXSTT,SEQNUMBR,   aaCustID,aaVendID,aaSiteID,aaItemID,EMPLOYID,aaCopyStatus,aaChangeDate, aaChangeTime)   Select @HdrID,  aaGLDistID,INTERID,CorrespondingUnit,ACTINDX,ACCTTYPE,aaBrowseType,   DECPLACS,CRDTAMNT,DEBITAMT, ORCRDAMT,ORDBTAMT,CURNCYID,CURRNIDX,   RATETPID,EXGTBLID,XCHGRATE,EXCHDATE,TIME1,RTCLCMTD,DENXRATE,MCTRXSTT,5000000 + SEQNUMBR,   aaCustID,aaVendID,aaSiteID,aaItemID,EMPLOYID,aaCopyStatus,convert(char(12), getdate(), 102), convert(char(12), getdate(), 108)   from AAG40001 where aaGLHdrID = @aaGLHdrID and aaGLDistID > 0   Insert into AAG30002   (aaGLHdrID, aaGLDistID, aaGLAssignID, DEBITAMT, CRDTAMNT, ORDBTAMT,   ORCRDAMT, aaAssignedPercent, DistRef, NOTEINDX)   Select @HdrID, aaGLDistID, aaGLAssignID, CRDTAMNT,DEBITAMT, ORCRDAMT,   ORDBTAMT, aaAssignedPercent,DistRef, NOTEINDX   from AAG40002 where aaGLHdrID = @aaGLHdrID and aaGLDistID > 0   and aaGLAssignID >0   Insert into AAG30003   (aaGLHdrID, aaGLDistID, aaGLAssignID, aaTrxDimID, aaTrxCodeID)   Select @HdrID, aaGLDistID, aaGLAssignID, aaTrxDimID, aaTrxCodeID   from AAG40003 where aaGLHdrID = @aaGLHdrID and aaGLDistID > 0   and aaGLAssignID >0 and aaTrxDimID >0   end   else  Begin   Insert into AAG30001   (aaGLHdrID, aaGLDistID,INTERID,CorrespondingUnit,ACTINDX,ACCTTYPE,aaBrowseType,  DECPLACS,DEBITAMT,CRDTAMNT,ORDBTAMT,ORCRDAMT,CURNCYID,CURRNIDX,  RATETPID,EXGTBLID,XCHGRATE,EXCHDATE,TIME1,RTCLCMTD,DENXRATE,MCTRXSTT,SEQNUMBR,  aaCustID,aaVendID,aaSiteID,aaItemID,EMPLOYID,aaCopyStatus,aaChangeDate, aaChangeTime)  Select @HdrID,  aaGLDistID,INTERID,CorrespondingUnit,ACTINDX,ACCTTYPE,aaBrowseType,  DECPLACS,CRDTAMNT,DEBITAMT, ORCRDAMT,ORDBTAMT,CURNCYID,CURRNIDX,  RATETPID,EXGTBLID,XCHGRATE,EXCHDATE,TIME1,RTCLCMTD,DENXRATE,MCTRXSTT,5000000 + SEQNUMBR,  aaCustID,aaVendID,aaSiteID,aaItemID,EMPLOYID,aaCopyStatus,convert(char(12), getdate(), 102), convert(char(12), getdate(), 108)  from AAG30001 where aaGLHdrID = @aaGLHdrID and aaGLDistID > 0   Insert into AAG30002  (aaGLHdrID, aaGLDistID, aaGLAssignID, DEBITAMT, CRDTAMNT, ORDBTAMT,  ORCRDAMT, aaAssignedPercent, DistRef, NOTEINDX)  Select @HdrID, aaGLDistID, aaGLAssignID, CRDTAMNT,DEBITAMT, ORCRDAMT,  ORDBTAMT, aaAssignedPercent,DistRef, NOTEINDX  from AAG30002 where aaGLHdrID = @aaGLHdrID and aaGLDistID > 0   and aaGLAssignID >0   Insert into AAG30003  (aaGLHdrID, aaGLDistID, aaGLAssignID, aaTrxDimID, aaTrxCodeID)  Select @HdrID, aaGLDistID, aaGLAssignID, aaTrxDimID, aaTrxCodeID  from AAG30003 where aaGLHdrID = @aaGLHdrID and aaGLDistID > 0   and aaGLAssignID >0 and aaTrxDimID >0   End  Insert INTO AAG70000 VALUES(@I_cUserID, 'GL_NORMAL', @HdrID, @JRNENTRY, 2, @RVRSNGDT, @cTrxSource,   @caaAuditTrailCode, 1, @nYear)  end     
GO
GRANT EXECUTE ON  [dbo].[aagReverseGL] TO [DYNGRP]
GO
