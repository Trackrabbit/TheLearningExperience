SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO
 create procedure [dbo].[glpmcUpdateAccountSummary]  @I_iAccountIndex                int             = NULL,  @I_mFuncDebit                   numeric(19,5)    = NULL,  @I_mFuncCredit                  numeric(19,5)    = NULL,  @I_mOrigDebit                   numeric(19,5)    = NULL,  @I_mOrigCredit                  numeric(19,5)    = NULL,  @I_cOrigCurrencyID              char(15)        = NULL,  @I_sOrigCurrencyIndex   smallint        = NULL,  @I_sPeriodID                    smallint        = NULL,  @I_nLedgerID int  = NULL,  @I_iSQLSessionID                int             = NULL,  @I_sYear                                smallint        = NULL,  @O_iErrorState                  int             = NULL  output as  declare  @tTransaction                           tinyint,  @tLoop                                  tinyint  select   @O_iErrorState = 0  if @@trancount = 0 begin  select @tTransaction = 1  begin transaction end   while (@tLoop is NULL) begin  select @tLoop = 1   if      @I_iAccountIndex                is NULL or  @I_mFuncDebit                   is NULL or   @I_mFuncCredit                  is NULL or   @I_mOrigDebit                   is NULL or   @I_mOrigCredit                  is NULL or   @I_cOrigCurrencyID              is NULL or  @I_sOrigCurrencyIndex   is NULL or  @I_sPeriodID                    is NULL or  @I_nLedgerID is NULL or  @I_iSQLSessionID                is NULL or  @I_sYear                                is NULL   begin  select @O_iErrorState = 20765  break  end    if exists (  select  1  from  MC00201  where  CURNCYID = @I_cOrigCurrencyID  and     ACTINDX = @I_iAccountIndex  and     OPENYEAR = @I_sYear  and     PERIODID = @I_sPeriodID  and  Ledger_ID = @I_nLedgerID )  begin  update  MC00201  set  FUNCTAMT = FUNCTAMT + (@I_mFuncDebit - @I_mFuncCredit),  ORIGAMT = ORIGAMT + (@I_mOrigDebit - @I_mOrigCredit)  where  CURNCYID = @I_cOrigCurrencyID  and     ACTINDX = @I_iAccountIndex  and     OPENYEAR = @I_sYear  and     PERIODID = @I_sPeriodID  and  Ledger_ID = @I_nLedgerID   if @@rowcount <> 1  begin  select @O_iErrorState = 20789  break  end   end   else  begin  insert   into  MC00201 (  CURNCYID,  CURRNIDX,  ACTINDX,  OPENYEAR,  PERIODID,  Ledger_ID,  FUNCTAMT,  ORIGAMT )  values (  @I_cOrigCurrencyID,  @I_sOrigCurrencyIndex,  @I_iAccountIndex,  @I_sYear,  @I_sPeriodID,  @I_nLedgerID,  (@I_mFuncDebit - @I_mFuncCredit),  (@I_mOrigDebit - @I_mOrigCredit) )  if @@rowcount <> 1  begin  select @O_iErrorState = 20766  break  end   end  end   if @O_iErrorState <> 0 begin  if @tTransaction = 1  rollback transaction end else if @tTransaction = 1  commit transaction   return    
GO
GRANT EXECUTE ON  [dbo].[glpmcUpdateAccountSummary] TO [DYNGRP]
GO
