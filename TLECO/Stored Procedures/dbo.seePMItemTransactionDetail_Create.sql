SET QUOTED_IDENTIFIER OFF
GO
SET ANSI_NULLS ON
GO
 CREATE PROCEDURE [dbo].[seePMItemTransactionDetail_Create] @iLanguageID int   as   set nocount on   declare @sqldropstring varchar(400),   @sqlstring1 varchar(8000),   @sqlstring2 varchar(8000),   @sqlstring3 varchar(8000),   @sqlstring4 varchar(8000),   @sqlstring5 varchar(8000),   @sqlstring6 varchar(8000),   @sqlstring7 varchar(8000),   @sqlstring8 varchar(8000),   @sqlstring9 varchar(8000),   @sqlstring10 varchar(8000),   @sqljoinstring varchar(8000),   @sqlaccessstring varchar(2000),   @tNumberSegments int,   @tSegment int,   @I_iDictID int,   @I_iLangID int,   @I_iMessageNumber int,   @I_iAliasMessageNumber int,   @I_iIntegerValue int,  @Item_Number varchar(255), @Document_Date varchar(255), @Buyer_ID varchar(255), @Vendor_ID varchar(255)  select @I_iDictID = 1493 select @I_iMessageNumber = 26305 select @I_iAliasMessageNumber = 0 exec DYNAMICS..smGetBIMsgStringForProcs  @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @Item_Number output   select @I_iDictID = 1493 select @I_iMessageNumber = 22806 select @I_iAliasMessageNumber = 0 exec DYNAMICS..smGetBIMsgStringForProcs  @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @Document_Date output   select @I_iDictID = 1493 select @I_iMessageNumber = 22878 select @I_iAliasMessageNumber = 0 exec DYNAMICS..smGetBIMsgStringForProcs  @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @Buyer_ID output   select @I_iDictID = 1493 select @I_iMessageNumber = 26307 select @I_iAliasMessageNumber = 0 exec DYNAMICS..smGetBIMsgStringForProcs  @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @Vendor_ID output    select @sqldropstring =   'IF EXISTS (SELECT * FROM   sys.objects WHERE  object_id = OBJECT_ID(N''[dbo].[seePMItemTransactionDetail]'') AND type in ( N''P'', N''PC'' ))  ' +   '  DROP PROCEDURE [dbo].[seePMItemTransactionDetail]  '   select @sqlstring1 =   'create procedure dbo.seePMItemTransactionDetail '+   ' @ItemNumber varchar(50) = null, '+   ' @TransactionDateFrom datetime = null, '+   ' @TransactionDateTo datetime = null, '+   ' @Buyer varchar(max), '+   ' @Vendor varchar(max) '+   'as '+   'if @Buyer = '''' and @Vendor = '''' '+   'begin '+   ' if @TransactionDateFrom is null or @TransactionDateTo is null '+   ' begin '+   '  select * from PurchaseLineItems where '+   '   (@ItemNumber is null or ['+@Item_Number+'] = @ItemNumber)  '+   ' end  '+   ' if @TransactionDateFrom is not null and @TransactionDateTo is not null '+   ' begin '+   '  select * from PurchaseLineItems where '+   '   (@ItemNumber is null or ['+@Item_Number+'] = @ItemNumber)  '+   '   and (['+@Document_Date+'] >= @TransactionDateFrom and ['+@Document_Date+'] <= @TransactionDateTo) '+   ' end  '+   'end '+   'else '+   'begin '+   ' if @Buyer != '''' '+   ' begin '+   '  if @TransactionDateFrom is null or @TransactionDateTo is null '+   '  begin '+   '   select * from PurchaseLineItems where '+   '    (@ItemNumber is null or ['+@Item_Number+'] = @ItemNumber)  '+   '    and ['+@Buyer_ID+'] in (select * from dbo.seeSplitString(@Buyer, '',''))  '+   '  end  '+   '  if @TransactionDateFrom is not null and @TransactionDateTo is not null '+   '  begin '+   '   select * from PurchaseLineItems where '+   '    (@ItemNumber is null or ['+@Item_Number+'] = @ItemNumber)  '+   '    and (['+@Document_Date+'] >= @TransactionDateFrom and ['+@Document_Date+'] <= @TransactionDateTo) '+   '    and ['+@Buyer_ID+'] in (select * from dbo.seeSplitString(@Buyer, '','')) '+   '  end  '+   ' end '+   ' else '+   ' begin '+   '  if @TransactionDateFrom is null or @TransactionDateTo is null '+   '  begin '+   '   select * from PurchaseLineItems where '+   '    (@ItemNumber is null or ['+@Item_Number+'] = @ItemNumber)  '+   '    and ['+@Vendor_ID+'] in (select * from dbo.seeSplitString(@Vendor, '',''))   '+   '  end '+   '  if @TransactionDateFrom is not null and @TransactionDateTo is not null '+   '  begin '+   '   select * from PurchaseLineItems where '+   '    (@ItemNumber is null or ['+@Item_Number+'] = @ItemNumber)  '+   '    and (['+@Document_Date+'] >= @TransactionDateFrom and ['+@Document_Date+'] <= @TransactionDateTo) '+   '    and ['+@Vendor_ID+'] in (select * from dbo.seeSplitString(@Vendor, '',''))  '+   '  end  '+   ' end '+   'end '   select @sqlaccessstring =   'GRANT execute ON [dbo].[seePMItemTransactionDetail] TO [rpt_materials manager],[rpt_operations manager],[rpt_shipping and receiving], '+  '[rpt_purchasing manager],[rpt_purchasing agent],[rpt_executive] '  exec (@sqldropstring)   exec (@sqlstring1+' '+@sqlstring2+' '+@sqlstring3+' '+@sqlstring4+' '+@sqlstring5+' '+@sqlstring6+' '+@sqlstring7+' '+@sqlstring8+' '+@sqlstring9+' '+@sqlstring10)   exec (@sqlaccessstring)   set nocount off    
GO
GRANT EXECUTE ON  [dbo].[seePMItemTransactionDetail_Create] TO [DYNGRP]
GO
