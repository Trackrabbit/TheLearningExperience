SET QUOTED_IDENTIFIER OFF
GO
SET ANSI_NULLS ON
GO
 create procedure [dbo].[rmCLAppliedOPEN]   @I_cUserID char(15) = NULL,  @I_cFileName1 varchar(40) = NULL,  @I_cSearchString1 char(2)  = NULL,  @O_iErrorState int  = NULL output as  declare  @iError int,   @iStatus int,   @tLoop tinyint,  @RMDOCCASH int,  @OPEN int,  @WORK int,  @HISTORY int,  @TRUE int,  @dMinDate datetime  select  @O_iErrorState = 0,  @iStatus  = 0,  @TRUE   = 1  exec @iStatus = smGetMinDate @dMinDate output  select @iError = @@error  if @iStatus = 0 and @iError <> 0  select @iStatus = @iError  if (@iStatus <> 0)  return (@iStatus)  while (@tLoop is NULL) begin  select @tLoop = 1   if @I_cUserID is NULL  or @I_cFileName1 is NULL  or  @I_cSearchString1 is NULL  begin  select @O_iErrorState = 20846  break  end   exec @iStatus = DYNAMICS.dbo.smGetConstantInt  'OPEN',   @OPEN output,   @O_iErrorState output   select @iError = @@error   if @iStatus = 0 and @iError <> 0  select @iStatus = @iError   if (@iStatus <> 0) or (@O_iErrorState <> 0)  break   exec @iStatus = DYNAMICS.dbo.smGetConstantInt  'WORK',   @WORK output,   @O_iErrorState output   select @iError = @@error   if @iStatus = 0 and @iError <> 0  select @iStatus = @iError   if (@iStatus <> 0) or (@O_iErrorState <> 0)  break   exec @iStatus = DYNAMICS.dbo.smGetConstantInt  'HIST',   @HISTORY output,   @O_iErrorState output   select @iError = @@error   if @iStatus = 0 and @iError <> 0  select @iStatus = @iError   if (@iStatus <> 0) or (@O_iErrorState <> 0)  break   exec @iStatus = DYNAMICS.dbo.smGetConstantInt  'RM_DOC_CASH',   @RMDOCCASH output,   @O_iErrorState output   select @iError = @@error   if @iStatus = 0 and @iError <> 0  select @iStatus = @iError   if (@iStatus <> 0) or (@O_iErrorState <> 0)  break   CREATE TABLE #appopenfrmissing (  CUSTNMBR        char(15) NOT NULL,  APTODCNM  char(21)  NOT NULL,  APTODCTY  smallint  NOT NULL,  APPTOAMT  numeric(19, 5)  NOT NULL,  APFRDCNM  char(21)  NOT NULL,  APFRDCTY  smallint  NOT NULL,  DISTKNAM  numeric(19, 5)  NOT NULL,  DISAVTKN  numeric(19, 5)  NOT NULL,  WROFAMNT  numeric(19, 5)  NOT NULL,  GSTDSAMT  numeric(19, 5)  NOT NULL,  PPSAMDED  numeric(19, 5)  NOT NULL,  MISSINHIST smallint NOT NULL)   CREATE TABLE #appopentomissing (  CUSTNMBR        char(15) NOT NULL,  APTODCNM  char(21)  NOT NULL,  APTODCTY  smallint  NOT NULL,  APPTOAMT  numeric(19, 5)  NOT NULL,  APFRDCNM  char(21)  NOT NULL,  APFRDCTY  smallint  NOT NULL,  DISTKNAM  numeric(19, 5)  NOT NULL,  DISAVTKN  numeric(19, 5)  NOT NULL,  WROFAMNT  numeric(19, 5)  NOT NULL,  GSTDSAMT  numeric(19, 5)  NOT NULL,  PPSAMDED  numeric(19, 5)  NOT NULL,  MISSINHIST smallint NOT NULL)   CREATE TABLE #appopenfrnotmissing (  CUSTNMBR        char(15) NOT NULL,  APTODCNM  char(21)  NOT NULL,  APTODCTY  smallint  NOT NULL,  APPTOAMT  numeric(19, 5)  NOT NULL,  APFRDCNM  char(21)  NOT NULL,  APFRDCTY  smallint  NOT NULL,  DISTKNAM  numeric(19, 5)  NOT NULL,  DISAVTKN  numeric(19, 5)  NOT NULL,  WROFAMNT  numeric(19, 5)  NOT NULL,  GSTDSAMT  numeric(19, 5)  NOT NULL,  PPSAMDED  numeric(19, 5)  NOT NULL)   CREATE TABLE #appopentonotmissing (  CUSTNMBR        char(15) NOT NULL,  APTODCNM  char(21)  NOT NULL,  APTODCTY  smallint  NOT NULL,  APPTOAMT  numeric(19, 5)  NOT NULL,  APFRDCNM  char(21)  NOT NULL,  APFRDCTY  smallint  NOT NULL,  DISTKNAM  numeric(19, 5)  NOT NULL,  DISAVTKN  numeric(19, 5)  NOT NULL,  WROFAMNT  numeric(19, 5)  NOT NULL,  GSTDSAMT  numeric(19, 5)  NOT NULL,  PPSAMDED  numeric(19, 5)  NOT NULL)   insert into #appopenfrmissing  select   CUSTNMBR,  APTODCNM,  APTODCTY,  APPTOAMT,  APFRDCNM,  APFRDCTY,  DISTKNAM,  DISAVTKN,  WROFAMNT,  GSTDSAMT,  PPSAMDED,  3  from   RM20201  where (not exists  (select 1  from RM00401  where RM00401.RMDTYPAL = RM20201.APFRDCTY   and RM00401.DOCNUMBR = RM20201.APFRDCNM)  and not exists  (select 1  from RM30101  where RM30101.RMDTYPAL = RM20201.APFRDCTY   and RM30101.DOCNUMBR = RM20201.APFRDCNM))  union   select   RM20201.CUSTNMBR,  APTODCNM,  APTODCTY,  APPTOAMT,  APFRDCNM,  APFRDCTY,  DISTKNAM,  DISAVTKN,  WROFAMNT,  GSTDSAMT,  PPSAMDED,  DCSTATUS  from   RM20201,  RM00401  where   RM00401.RMDTYPAL = RM20201.APFRDCTY   and RM00401.DOCNUMBR = RM20201.APFRDCNM  and (  (RM20201.APFRDCTY < @RMDOCCASH  and RM00401.DCSTATUS = @WORK  and (not exists  (select 1  from RM10301  where RM10301.RMDTYPAL = RM20201.APFRDCTY   and RM10301.RMDNUMWK = RM20201.APFRDCNM)))  or   (RM20201.APFRDCTY >= @RMDOCCASH  and RM00401.DCSTATUS = @WORK  and (not exists  (select 1  from RM10201  where RM10201.RMDTYPAL = RM20201.APFRDCTY   and RM10201.DOCNUMBR = RM20201.APFRDCNM)))  or  (RM00401.DCSTATUS = @OPEN  and (not exists  (select 1  from RM20101  where RM20101.RMDTYPAL = RM20201.APFRDCTY   and RM20101.DOCNUMBR = RM20201.APFRDCNM)))  or   (RM00401.DCSTATUS = @HISTORY  and (not exists  (select 1  from RM30101  where RM30101.RMDTYPAL = RM20201.APFRDCTY   and RM30101.DOCNUMBR = RM20201.APFRDCNM))))   update #appopenfrmissing  set MISSINHIST = @HISTORY   where exists  (select 1   from RM30301  where  RM30301.DOCNUMBR = #appopenfrmissing.APFRDCNM  and RM30301.RMDTYPAL = #appopenfrmissing.APFRDCTY  and #appopenfrmissing.MISSINHIST  = 0)   insert into #appopenfrnotmissing  select   RM20201.CUSTNMBR,  APTODCNM,  APTODCTY,  APPTOAMT,  APFRDCNM,  APFRDCTY,  DISTKNAM,  DISAVTKN,  WROFAMNT,  GSTDSAMT,  PPSAMDED  from   RM20201,  RM00401  where   RM00401.RMDTYPAL = RM20201.APFRDCTY   and RM00401.DOCNUMBR = RM20201.APFRDCNM  and (  (RM20201.APFRDCTY < @RMDOCCASH  and RM00401.DCSTATUS = @WORK  and (exists  (select 1  from RM10301  where RM10301.RMDTYPAL = RM20201.APFRDCTY   and RM10301.RMDNUMWK = RM20201.APFRDCNM)))  or   (RM20201.APFRDCTY >= @RMDOCCASH  and RM00401.DCSTATUS = @WORK  and (exists  (select 1  from RM10201  where RM10201.RMDTYPAL = RM20201.APFRDCTY   and RM10201.DOCNUMBR = RM20201.APFRDCNM)))  or  (RM00401.DCSTATUS = @OPEN  and (exists  (select 1  from RM20101  where RM20101.RMDTYPAL = RM20201.APFRDCTY   and RM20101.DOCNUMBR = RM20201.APFRDCNM)))  or   (RM00401.DCSTATUS = @HISTORY  and (exists  (select 1  from RM30101  where RM30101.RMDTYPAL = RM20201.APFRDCTY   and RM30101.DOCNUMBR = RM20201.APFRDCNM))))   insert into #appopentomissing  select   CUSTNMBR,  APTODCNM,  APTODCTY,  APPTOAMT,  APFRDCNM,  APFRDCTY,  DISTKNAM,  DISAVTKN,  WROFAMNT,  GSTDSAMT,  PPSAMDED,  3  from   RM20201  where (not exists  (select 1  from RM00401  where RM00401.RMDTYPAL = RM20201.APTODCTY   and RM00401.DOCNUMBR = RM20201.APTODCNM)  and not exists  (select 1  from RM30101  where RM30101.RMDTYPAL = RM20201.APTODCTY   and RM30101.DOCNUMBR = RM20201.APTODCNM))  union   select   RM20201.CUSTNMBR,  APTODCNM,  APTODCTY,  APPTOAMT,  APFRDCNM,  APFRDCTY,  DISTKNAM,  DISAVTKN,  WROFAMNT,  GSTDSAMT,  PPSAMDED,  DCSTATUS  from   RM20201,  RM00401  where   RM00401.RMDTYPAL = RM20201.APTODCTY   and RM00401.DOCNUMBR = RM20201.APTODCNM  and not exists  (select 1  from RM20101  where RM20101.RMDTYPAL = RM20201.APTODCTY   and RM20101.DOCNUMBR = RM20201.APTODCNM)   update #appopentomissing  set MISSINHIST = @HISTORY   where exists  (select 1   from RM30301  where  RM30301.DOCNUMBR = #appopentomissing.APTODCNM  and RM30301.RMDTYPAL = #appopentomissing.APTODCTY  and #appopentomissing.MISSINHIST  = 0)   update #appopentomissing  set MISSINHIST = @WORK   from  RM20201,  RM00401   where   RM20201.APTODCNM = #appopentomissing.APTODCNM  and RM20201.APTODCTY = #appopentomissing.APTODCTY  and RM20201.APFRDCNM = #appopentomissing.APFRDCNM  and RM20201.APFRDCTY = #appopentomissing.APFRDCTY  and RM00401.RMDTYPAL = RM20201.APFRDCTY   and RM00401.DOCNUMBR = RM20201.APFRDCNM  and RM00401.DCSTATUS = @WORK   insert into #appopentonotmissing  select   CUSTNMBR,  APTODCNM,  APTODCTY,  APPTOAMT,  APFRDCNM,  APFRDCTY,  DISTKNAM,  DISAVTKN,  WROFAMNT,  GSTDSAMT,  PPSAMDED  from  RM20201  where (not exists  (select 1  from RM20101  where RM20101.RMDTYPAL = RM20201.APTODCTY   and RM20101.DOCNUMBR = RM20201.APTODCNM)  and exists  (select 1  from RM30101  where RM30101.RMDTYPAL = RM20201.APTODCTY   and RM30101.DOCNUMBR = RM20201.APTODCNM))  or exists  (select 1  from RM20101  where RM20101.RMDTYPAL = RM20201.APTODCTY   and RM20101.DOCNUMBR = RM20201.APTODCNM)   update #appopentomissing  set MISSINHIST = @WORK   from  RM20201  where   RM20201.APTODCNM = #appopentomissing.APTODCNM  and RM20201.APTODCTY = #appopentomissing.APTODCTY  and RM20201.APFRDCNM = #appopentomissing.APFRDCNM  and RM20201.APFRDCTY = #appopentomissing.APFRDCTY  and #appopentomissing.MISSINHIST = 3   and exists  (select 1  from #appopenfrmissing  where #appopenfrmissing.APTODCNM = #appopentomissing.APTODCNM   and #appopenfrmissing.APTODCTY = #appopentomissing.APTODCTY  and #appopenfrmissing.APFRDCNM = #appopentomissing.APFRDCNM  and #appopenfrmissing.APFRDCTY = #appopentomissing.APFRDCTY)   update #appopenfrmissing  set MISSINHIST = @WORK   from  RM20201  where   RM20201.APTODCNM = #appopenfrmissing.APTODCNM  and RM20201.APTODCTY = #appopenfrmissing.APTODCTY  and RM20201.APFRDCNM = #appopenfrmissing.APFRDCNM  and RM20201.APFRDCTY = #appopenfrmissing.APFRDCTY  and #appopenfrmissing.MISSINHIST = 3   and exists  (select 1  from #appopentomissing  where #appopentomissing.APTODCNM = #appopenfrmissing.APTODCNM   and #appopentomissing.APTODCTY = #appopenfrmissing.APTODCTY  and #appopentomissing.APFRDCNM = #appopenfrmissing.APFRDCNM  and #appopentomissing.APFRDCTY = #appopenfrmissing.APFRDCTY)   update   RM20201  set   POSTED = @TRUE  from  RM20201,  RM00401  where  RM20201.APFRDCTY = RM00401.RMDTYPAL  and  RM20201.APFRDCNM = RM00401.DOCNUMBR  and     POSTED <> @TRUE  and  RM00401.DCSTATUS <> @WORK    update   RM20101  set   RM20101.CURTRXAM = RM20101.CURTRXAM +  (select sum(#appopentonotmissing.APPTOAMT) +   sum(#appopentonotmissing.DISTKNAM) +   sum(#appopentonotmissing.WROFAMNT)  from #appopentonotmissing  where  RM20101.RMDTYPAL = #appopentonotmissing.APTODCTY   and RM20101.DOCNUMBR = #appopentonotmissing.APTODCNM),  RM20101.DISTKNAM = RM20101.DISTKNAM -   (select sum(#appopentonotmissing.DISTKNAM)  from #appopentonotmissing  where  RM20101.RMDTYPAL = #appopentonotmissing.APTODCTY   and RM20101.DOCNUMBR = #appopentonotmissing.APTODCNM),  RM20101.DISAVTKN = RM20101.DISAVTKN -   (select sum(#appopentonotmissing.DISAVTKN)  from #appopentonotmissing  where  RM20101.RMDTYPAL = #appopentonotmissing.APTODCTY   and RM20101.DOCNUMBR = #appopentonotmissing.APTODCNM),  RM20101.WROFAMNT = RM20101.WROFAMNT -   (select sum(#appopentonotmissing.WROFAMNT)   from #appopentonotmissing  where  RM20101.RMDTYPAL = #appopentonotmissing.APTODCTY   and RM20101.DOCNUMBR = #appopentonotmissing.APTODCNM),  RM20101.GSTDSAMT = RM20101.GSTDSAMT -   (select sum(#appopentonotmissing.GSTDSAMT)  from #appopentonotmissing  where  RM20101.RMDTYPAL = #appopentonotmissing.APTODCTY   and RM20101.DOCNUMBR = #appopentonotmissing.APTODCNM),  RM20101.PPSAMDED = RM20101.PPSAMDED -   (select sum(#appopentonotmissing.PPSAMDED)  from #appopentonotmissing  where  RM20101.RMDTYPAL = #appopentonotmissing.APTODCTY   and RM20101.DOCNUMBR = #appopentonotmissing.APTODCNM)  from   RM20101,  #appopenfrmissing FM1,  #appopentonotmissing  where FM1.APFRDCTY = #appopentonotmissing.APFRDCTY  and FM1.APFRDCNM = #appopentonotmissing.APFRDCNM  and FM1.APTODCTY = #appopentonotmissing.APTODCTY  and FM1.APTODCNM = #appopentonotmissing.APTODCNM  and  RM20101.RMDTYPAL = FM1.APTODCTY   and RM20101.DOCNUMBR = FM1.APTODCNM  and not exists  (select 1  from #appopenfrmissing FM2   where FM1.APFRDCTY = FM2.APFRDCTY  and FM1.APFRDCNM = FM2.APFRDCNM  and FM1.APTODCTY = FM2.APTODCTY  and FM1.APTODCNM = FM2.APTODCNM  and FM2.MISSINHIST = 3)  and  not exists  (select 1  from #appopentomissing   where FM1.APFRDCTY = #appopentomissing.APFRDCTY  and FM1.APFRDCNM = #appopentomissing.APFRDCNM  and FM1.APTODCTY = #appopentomissing.APTODCTY  and FM1.APTODCNM = #appopentomissing.APTODCNM  and #appopentomissing.MISSINHIST = 3)   update   RM20101   set   DINVPDOF = convert(char(12),@dMinDate)  from   RM20101,  #appopenfrmissing FM1,  #appopentonotmissing   where  CURTRXAM > 0.0  and  FM1.APFRDCTY = #appopentonotmissing.APFRDCTY  and FM1.APFRDCNM = #appopentonotmissing.APFRDCNM  and FM1.APTODCTY = #appopentonotmissing.APTODCTY  and FM1.APTODCNM = #appopentonotmissing.APTODCNM  and  RM20101.RMDTYPAL = FM1.APTODCTY   and RM20101.DOCNUMBR = FM1.APTODCNM  and not exists  (select 1  from #appopenfrmissing FM2   where FM1.APFRDCTY = FM2.APFRDCTY  and FM1.APFRDCNM = FM2.APFRDCNM  and FM1.APTODCTY = FM2.APTODCTY  and FM1.APTODCNM = FM2.APTODCNM  and FM2.MISSINHIST = 3)  and  not exists  (select 1  from #appopentomissing   where FM1.APFRDCTY = #appopentomissing.APFRDCTY  and FM1.APFRDCNM = #appopentomissing.APFRDCNM  and FM1.APTODCTY = #appopentomissing.APTODCTY  and FM1.APTODCNM = #appopentomissing.APTODCNM  and #appopentomissing.MISSINHIST = 3)   update   RM10301  set   RM10301.ACCTAMNT = RM10301.ACCTAMNT +   (select sum(#appopenfrnotmissing.APPTOAMT)  from #appopenfrnotmissing  where #appopenfrnotmissing.APFRDCTY = RM00401.RMDTYPAL  and #appopenfrnotmissing.APFRDCNM = RM00401.DOCNUMBR),  RM10301.DISTKNAM = RM10301.DISTKNAM -   (select sum(#appopenfrnotmissing.DISTKNAM)  from #appopenfrnotmissing  where #appopenfrnotmissing.APFRDCTY = RM00401.RMDTYPAL  and #appopenfrnotmissing.APFRDCNM = RM00401.DOCNUMBR),  RM10301.DISAVTKN = RM10301.DISAVTKN -   (select sum(#appopenfrnotmissing.DISAVTKN)  from #appopenfrnotmissing  where #appopenfrnotmissing.APFRDCTY = RM00401.RMDTYPAL  and #appopenfrnotmissing.APFRDCNM = RM00401.DOCNUMBR),  RM10301.WROFAMNT = RM10301.WROFAMNT -   (select sum(#appopenfrnotmissing.WROFAMNT)  from #appopenfrnotmissing  where #appopenfrnotmissing.APFRDCTY = RM00401.RMDTYPAL  and #appopenfrnotmissing.APFRDCNM = RM00401.DOCNUMBR),  RM10301.GSTDSAMT = RM10301.GSTDSAMT -   (select sum(#appopenfrnotmissing.GSTDSAMT)  from #appopenfrnotmissing  where #appopenfrnotmissing.APFRDCTY = RM00401.RMDTYPAL  and #appopenfrnotmissing.APFRDCNM = RM00401.DOCNUMBR),  RM10301.PPSAMDED = RM10301.PPSAMDED -   (select sum(#appopenfrnotmissing.PPSAMDED)  from #appopenfrnotmissing  where #appopenfrnotmissing.APFRDCTY = RM00401.RMDTYPAL  and #appopenfrnotmissing.APFRDCNM = RM00401.DOCNUMBR)  from  RM00401,  #appopenfrnotmissing,  #appopentomissing  where #appopenfrnotmissing.APFRDCTY = RM00401.RMDTYPAL  and #appopenfrnotmissing.APFRDCNM = RM00401.DOCNUMBR  and     #appopentomissing.APTODCTY = #appopenfrnotmissing.APTODCTY  and #appopentomissing.APTODCNM = #appopenfrnotmissing.APTODCNM  and RM00401.DCSTATUS = @WORK  and #appopenfrnotmissing.APFRDCTY < @RMDOCCASH   update   RM10201  set   RM10201.CURTRXAM = RM10201.CURTRXAM +   (select sum(#appopenfrnotmissing.APPTOAMT)  from #appopenfrnotmissing  where  #appopenfrnotmissing.APFRDCTY = RM00401.RMDTYPAL  and #appopenfrnotmissing.APFRDCNM = RM00401.DOCNUMBR),  RM10201.DISTKNAM = RM10201.DISTKNAM -   (select sum(#appopenfrnotmissing.DISTKNAM)  from #appopenfrnotmissing  where  #appopenfrnotmissing.APFRDCTY = RM00401.RMDTYPAL  and #appopenfrnotmissing.APFRDCNM = RM00401.DOCNUMBR),  RM10201.DISAVTKN = RM10201.DISAVTKN -   (select sum(#appopenfrnotmissing.DISAVTKN)  from #appopenfrnotmissing  where  #appopenfrnotmissing.APFRDCTY = RM00401.RMDTYPAL  and #appopenfrnotmissing.APFRDCNM = RM00401.DOCNUMBR),  RM10201.WROFAMNT = RM10201.WROFAMNT -   (select sum(#appopenfrnotmissing.WROFAMNT)  from #appopenfrnotmissing  where  #appopenfrnotmissing.APFRDCTY = RM00401.RMDTYPAL  and #appopenfrnotmissing.APFRDCNM = RM00401.DOCNUMBR),  RM10201.GSTDSAMT = RM10201.GSTDSAMT -   (select sum(#appopenfrnotmissing.GSTDSAMT)  from #appopenfrnotmissing  where  #appopenfrnotmissing.APFRDCTY = RM00401.RMDTYPAL  and #appopenfrnotmissing.APFRDCNM = RM00401.DOCNUMBR),  RM10201.PPSAMDED = RM10201.PPSAMDED -   (select sum(#appopenfrnotmissing.PPSAMDED)  from #appopenfrnotmissing  where  #appopenfrnotmissing.APFRDCTY = RM00401.RMDTYPAL  and #appopenfrnotmissing.APFRDCNM = RM00401.DOCNUMBR)  from  RM00401,  #appopenfrnotmissing,  #appopentomissing  where #appopenfrnotmissing.APFRDCTY = RM00401.RMDTYPAL  and #appopenfrnotmissing.APFRDCNM = RM00401.DOCNUMBR  and     #appopentomissing.APTODCTY = #appopenfrnotmissing.APTODCTY  and #appopentomissing.APTODCNM = #appopenfrnotmissing.APTODCNM  and RM00401.DCSTATUS = @WORK  and #appopenfrnotmissing.APFRDCTY >= @RMDOCCASH   if  (select count(*) from #appopenfrmissing) > 0 or  (select count(*) from #appopentomissing) > 0   begin  insert into  #CNTRLNUMTEMP(  CNTRLNUM,  DOCTYPE,  VENDORID )  select   APFRDCNM,  APFRDCTY,  CUSTNMBR  from #appopenfrmissing  where MISSINHIST <> 3  union  select   APFRDCNM,  APFRDCTY,  CUSTNMBR  from #appopentomissing  where MISSINHIST <> 3   exec @iStatus = smCreateErrorLogRecord  @I_cUserID,  @I_cFileName1,  NULL,  10327,  @O_iErrorState output   select @iError = @@error   if @iStatus = 0 and @iError <> 0  select @iStatus = @iError  if @iStatus <> 0 or @O_iErrorState <> 0  break   delete   RM20201  from   RM20201,  #appopenfrmissing  where #appopenfrmissing.APFRDCTY = RM20201.APFRDCTY  and #appopenfrmissing.APFRDCNM = RM20201.APFRDCNM  and MISSINHIST <> 3   delete   RM20201  from   RM20201,  #appopentomissing  where #appopentomissing.APFRDCTY = RM20201.APFRDCTY  and #appopentomissing.APFRDCNM = RM20201.APFRDCNM  and MISSINHIST <> 3  end  end  drop table #appopenfrmissing drop table #appopentomissing  drop table #appopenfrnotmissing drop table #appopentonotmissing return(@iStatus)   
GO
GRANT EXECUTE ON  [dbo].[rmCLAppliedOPEN] TO [DYNGRP]
GO
