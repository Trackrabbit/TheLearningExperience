SET QUOTED_IDENTIFIER OFF
GO
SET ANSI_NULLS ON
GO
 CREATE PROCEDURE [dbo].[seeTopCustomerBalancesDetail_Create] @iLanguageID int   as   set nocount on   declare @sqldropstring varchar(400),   @sqlstring1 varchar(8000),   @sqlstring2 varchar(8000),   @sqlstring3 varchar(8000),   @sqlstring4 varchar(8000),   @sqlstring5 varchar(8000),   @sqlstring6 varchar(8000),   @sqlstring7 varchar(8000),   @sqlstring8 varchar(8000),   @sqlstring9 varchar(8000),   @sqlstring10 varchar(8000),   @sqljoinstring varchar(8000),   @sqlaccessstring varchar(2000),   @tNumberSegments int,   @tSegment int,   @I_iDictID int,   @I_iLangID int,   @I_iMessageNumber int,   @I_iAliasMessageNumber int,   @I_iIntegerValue int,  @Customer_Number varchar(255), @Customer_Name varchar(255), @Customer_Balance varchar(255), @Current varchar(255), @31_60_Days varchar(255), @61_90_Days varchar(255), @91_120_Days varchar(255), @121_150_Days varchar(255), @151_180_Days varchar(255), @181_and_Over varchar(255), @Address_1 varchar(255), @Address_2 varchar(255), @City varchar(255), @State varchar(255), @Zip varchar(255), @Phone_1 varchar(255)  select @I_iDictID = 1493 select @I_iMessageNumber = 22900 select @I_iAliasMessageNumber = 0 exec DYNAMICS..smGetBIMsgStringForProcs  @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @Customer_Number output   select @I_iDictID = 1493 select @I_iMessageNumber = 22901 select @I_iAliasMessageNumber = 0 exec DYNAMICS..smGetBIMsgStringForProcs  @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @Customer_Name output   select @I_iDictID = 1493 select @I_iMessageNumber = 23902 select @I_iAliasMessageNumber = 0 exec DYNAMICS..smGetBIMsgStringForProcs  @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @Customer_Balance output   select @I_iDictID = 1493 select @I_iMessageNumber = 23903 select @I_iAliasMessageNumber = 0 exec DYNAMICS..smGetBIMsgStringForProcs  @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @Current output   select @I_iDictID = 1493 select @I_iMessageNumber = 23904 select @I_iAliasMessageNumber = 0 exec DYNAMICS..smGetBIMsgStringForProcs  @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @31_60_Days output   select @I_iDictID = 1493 select @I_iMessageNumber = 23905 select @I_iAliasMessageNumber = 0 exec DYNAMICS..smGetBIMsgStringForProcs  @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @61_90_Days output   select @I_iDictID = 1493 select @I_iMessageNumber = 23906 select @I_iAliasMessageNumber = 0 exec DYNAMICS..smGetBIMsgStringForProcs  @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @91_120_Days output   select @I_iDictID = 1493 select @I_iMessageNumber = 23907 select @I_iAliasMessageNumber = 0 exec DYNAMICS..smGetBIMsgStringForProcs  @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @121_150_Days output   select @I_iDictID = 1493 select @I_iMessageNumber = 23908 select @I_iAliasMessageNumber = 0 exec DYNAMICS..smGetBIMsgStringForProcs  @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @151_180_Days output   select @I_iDictID = 1493 select @I_iMessageNumber = 23909 select @I_iAliasMessageNumber = 0 exec DYNAMICS..smGetBIMsgStringForProcs  @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @181_and_Over output   select @I_iDictID = 1493 select @I_iMessageNumber = 22911 select @I_iAliasMessageNumber = 0 exec DYNAMICS..smGetBIMsgStringForProcs  @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @Address_1 output   select @I_iDictID = 1493 select @I_iMessageNumber = 22912 select @I_iAliasMessageNumber = 0 exec DYNAMICS..smGetBIMsgStringForProcs  @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @Address_2 output   select @I_iDictID = 1493 select @I_iMessageNumber = 22915 select @I_iAliasMessageNumber = 0 exec DYNAMICS..smGetBIMsgStringForProcs  @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @City output   select @I_iDictID = 1493 select @I_iMessageNumber = 22916 select @I_iAliasMessageNumber = 0 exec DYNAMICS..smGetBIMsgStringForProcs  @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @State output   select @I_iDictID = 1493 select @I_iMessageNumber = 22917 select @I_iAliasMessageNumber = 0 exec DYNAMICS..smGetBIMsgStringForProcs  @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @Zip output   select @I_iDictID = 1493 select @I_iMessageNumber = 22918 select @I_iAliasMessageNumber = 0 exec DYNAMICS..smGetBIMsgStringForProcs  @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @Phone_1 output    select @sqldropstring =   'IF EXISTS (SELECT * FROM   sys.objects WHERE  object_id = OBJECT_ID(N''[dbo].[seeTopCustomerBalancesDetail]'') AND type in ( N''P'', N''PC'' ))  ' +   '  DROP PROCEDURE [dbo].[seeTopCustomerBalancesDetail]  '   select @sqlstring1 =   'create procedure dbo.seeTopCustomerBalancesDetail '+   '  @Customer char(15) = NULL, '+   '  @MaxCustomers int = NULL '+   'as '+   'if @Customer <> ''''   '+   ' select ['+@Customer_Number+'], ['+@Customer_Balance+'], ['+@Current+'],['+@31_60_Days+'],['+@61_90_Days+'],['+@91_120_Days+'], '+   '  ['+@121_150_Days+'], ['+@151_180_Days+'], ['+@181_and_Over+'], ['+@Customer_Name+'],['+@Address_1+'],['+@Address_2+'],['+@City+'], '+   '  ['+@State+'],['+@Zip+'],['+@Phone_1+'] '+   '  from Customers with (noLock) '+   '  where ['+@Customer_Number+'] = @Customer  '+   'else '+   ' if @MaxCustomers <> 0 '+   '  select top (select @MaxCustomers)  '+   '  ['+@Customer_Number+'], ['+@Customer_Balance+'], ['+@Current+'],['+@31_60_Days+'],['+@61_90_Days+'],['+@91_120_Days+'], '+   '  ['+@121_150_Days+'], ['+@151_180_Days+'], ['+@181_and_Over+'], ['+@Customer_Name+'],['+@Address_1+'],['+@Address_2+'],['+@City+'], '+   '  ['+@State+'],['+@Zip+'],['+@Phone_1+'] '+   '  from Customers with (noLock) '+   '  order by ['+@Customer_Balance+'] desc, ['+@Customer_Number+'] asc '+   ' else '+   '  select ['+@Customer_Number+'], ['+@Customer_Balance+'], ['+@Current+'],['+@31_60_Days+'],['+@61_90_Days+'],['+@91_120_Days+'], '+   '  ['+@121_150_Days+'], ['+@151_180_Days+'], ['+@181_and_Over+'], ['+@Customer_Name+'],['+@Address_1+'],['+@Address_2+'],['+@City+'], '+   '  ['+@State+'],['+@Zip+'],['+@Phone_1+'] '+   '  from Customers with (noLock) '+   '  order by ['+@Customer_Balance+'] desc, ['+@Customer_Number+'] asc '   select @sqlaccessstring =   'GRANT execute ON [dbo].[seeTopCustomerBalancesDetail] TO [rpt_executive], [rpt_accounts receivable coordinator], [rpt_collections manager], [rpt_order processor], [rpt_accounting manager] '   exec (@sqldropstring)   exec (@sqlstring1+' '+@sqlstring2+' '+@sqlstring3+' '+@sqlstring4+' '+@sqlstring5+' '+@sqlstring6+' '+@sqlstring7+' '+@sqlstring8+' '+@sqlstring9+' '+@sqlstring10)   exec (@sqlaccessstring)   set nocount off    
GO
GRANT EXECUTE ON  [dbo].[seeTopCustomerBalancesDetail_Create] TO [DYNGRP]
GO
