SET QUOTED_IDENTIFIER OFF
GO
SET ANSI_NULLS ON
GO
 CREATE PROCEDURE [dbo].[sp_Dynamics_PayrollCheckAndDistributionHistory] @iLanguageID int  as  set nocount on   declare @sqldropstring varchar(400),  @sqldefaultstring varchar(8000),  @sqlstring1 varchar(8000),  @sqlstring2 varchar(8000),  @sqlstring3 varchar(8000),  @sqlstring4 varchar(8000),  @sqlstring5 varchar(8000),  @sqlstring6 varchar(8000),  @sqlstring7 varchar(8000),  @sqlstring8 varchar(8000),  @sqlstring9 varchar(8000),  @sqlstring10 varchar(8000),  @sqljoinstring varchar(8000),  @sqlaccessstring varchar(2000),  @tNumberSegments int,  @tSegment int,  @I_iDictID int,  @I_iLangID int,  @I_iMessageNumber int,  @I_iAliasMessageNumber int,  @I_iIntegerValue int,  @Audit_Control_Code varchar(255), @Payment_Adjustment_Number varchar(255), @Uncollected_FICA_SS_Tax_Pay_Run varchar(255), @Employee_ID varchar(255), @Advance_EIC_Payment varchar(255), @Year varchar(255), @Gross_Wages_Pay_Run varchar(255), @Reason_Check_Voided varchar(255), @Total_Deductions varchar(255), @FICA_SS_Tax_on_Tips varchar(255), @Social_Security_Number varchar(255), @Uncollected_FICA_Med_Tax_Pay_Run varchar(255), @Check_Date varchar(255), @Checkbook_ID varchar(255), @Total_Taxes varchar(255), @Voided varchar(255), @Federal_Tax_on_Tips varchar(255), @Federal_Withholding_Pay_Run varchar(255), @Department varchar(255), @Net_Wages_Pay_Run varchar(255), @Check_Number varchar(255), @FICA_Medicare_Withholding_Pay_Run varchar(255), @FICA_Med_Tax_on_Tips varchar(255),  @Employee_Name varchar(255), @Voided_by_Void_Checks varchar(255), @FICA_Social_Security_Withholding_Pay_Run varchar(255), @Approval varchar(255), @Posted_Date varchar(255), @Total_Benefit varchar(255), @DrillBack_Base_Url varchar(255), @EmployeeID_For_DrillBack varchar(255), @CheckbookID_For_DrillBack varchar(255)  select @DrillBack_Base_Url = DYNAMICS.dbo.createBaseDrillBackUrlString(DB_NAME(),0)  select @I_iDictID = 1493 select @I_iMessageNumber = 24923 select @I_iAliasMessageNumber = 0 exec DYNAMICS..smGetBIMsgString  @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @Audit_Control_Code output   select @I_iDictID = 1493 select @I_iMessageNumber = 24926 select @I_iAliasMessageNumber = 0 exec DYNAMICS..smGetBIMsgString  @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @Payment_Adjustment_Number output   select @I_iDictID = 0 select @I_iMessageNumber = 22038 select @I_iAliasMessageNumber = 0 exec DYNAMICS..smGetBIMsgString  @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @Uncollected_FICA_SS_Tax_Pay_Run output   select @I_iDictID = 1493 select @I_iMessageNumber = 22400 select @I_iAliasMessageNumber = 0 exec DYNAMICS..smGetBIMsgString  @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @Employee_ID output   select @I_iDictID = 0 select @I_iMessageNumber = 22039 select @I_iAliasMessageNumber = 0 exec DYNAMICS..smGetBIMsgString  @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @Advance_EIC_Payment output   select @I_iDictID = 1493 select @I_iMessageNumber = 24958 select @I_iAliasMessageNumber = 0 exec DYNAMICS..smGetBIMsgString  @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @Year output   select @I_iDictID = 0 select @I_iMessageNumber = 22040 select @I_iAliasMessageNumber = 0 exec DYNAMICS..smGetBIMsgString  @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @Gross_Wages_Pay_Run output   select @I_iDictID = 0 select @I_iMessageNumber = 22041 select @I_iAliasMessageNumber = 0 exec DYNAMICS..smGetBIMsgString  @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @Reason_Check_Voided output   select @I_iDictID = 0 select @I_iMessageNumber = 22042 select @I_iAliasMessageNumber = 0 exec DYNAMICS..smGetBIMsgString  @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @Total_Deductions output   select @I_iDictID = 0 select @I_iMessageNumber = 22043 select @I_iAliasMessageNumber = 0 exec DYNAMICS..smGetBIMsgString  @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @FICA_SS_Tax_on_Tips output   select @I_iDictID = 1493 select @I_iMessageNumber = 22414 select @I_iAliasMessageNumber = 0 exec DYNAMICS..smGetBIMsgString  @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @Social_Security_Number output   select @I_iDictID = 0 select @I_iMessageNumber = 22044 select @I_iAliasMessageNumber = 0 exec DYNAMICS..smGetBIMsgString  @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @Uncollected_FICA_Med_Tax_Pay_Run output   select @I_iDictID = 1493 select @I_iMessageNumber = 23368 select @I_iAliasMessageNumber = 0 exec DYNAMICS..smGetBIMsgString  @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @Check_Date output   select @I_iDictID = 1493 select @I_iMessageNumber = 24887 select @I_iAliasMessageNumber = 0 exec DYNAMICS..smGetBIMsgString  @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @Checkbook_ID output   select @I_iDictID = 0 select @I_iMessageNumber = 22045 select @I_iAliasMessageNumber = 0 exec DYNAMICS..smGetBIMsgString  @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @Total_Taxes output   select @I_iDictID = 1493 select @I_iMessageNumber = 24490 select @I_iAliasMessageNumber = 0 exec DYNAMICS..smGetBIMsgString  @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @Voided output   select @I_iDictID = 0 select @I_iMessageNumber = 22046 select @I_iAliasMessageNumber = 0 exec DYNAMICS..smGetBIMsgString  @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @Federal_Tax_on_Tips output   select @I_iDictID = 0 select @I_iMessageNumber = 22047 select @I_iAliasMessageNumber = 0 exec DYNAMICS..smGetBIMsgString  @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @Federal_Withholding_Pay_Run output   select @I_iDictID = 1493 select @I_iMessageNumber = 22420 select @I_iAliasMessageNumber = 0 exec DYNAMICS..smGetBIMsgString  @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @Department output   select @I_iDictID = 0 select @I_iMessageNumber = 22048 select @I_iAliasMessageNumber = 0 exec DYNAMICS..smGetBIMsgString  @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @Net_Wages_Pay_Run output   select @I_iDictID = 1493 select @I_iMessageNumber = 23372 select @I_iAliasMessageNumber = 0 exec DYNAMICS..smGetBIMsgString  @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @Check_Number output   select @I_iDictID = 0 select @I_iMessageNumber = 22049 select @I_iAliasMessageNumber = 0 exec DYNAMICS..smGetBIMsgString  @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @FICA_Medicare_Withholding_Pay_Run output   select @I_iDictID = 0 select @I_iMessageNumber = 22050 select @I_iAliasMessageNumber = 0 exec DYNAMICS..smGetBIMsgString  @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @FICA_Med_Tax_on_Tips output   select @I_iDictID = 0 select @I_iMessageNumber = 22051 select @I_iAliasMessageNumber = 0 exec DYNAMICS..smGetBIMsgString  @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @Employee_Name output   select @I_iDictID = 0 select @I_iMessageNumber = 22052 select @I_iAliasMessageNumber = 0 exec DYNAMICS..smGetBIMsgString  @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @Voided_by_Void_Checks output   select @I_iDictID = 0 select @I_iMessageNumber = 22053 select @I_iAliasMessageNumber = 0 exec DYNAMICS..smGetBIMsgString  @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @FICA_Social_Security_Withholding_Pay_Run output   select @I_iDictID = 0 select @I_iMessageNumber = 22054 select @I_iAliasMessageNumber = 0 exec DYNAMICS..smGetBIMsgString  @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @Approval output   select @I_iDictID = 1493 select @I_iMessageNumber = 26527 select @I_iAliasMessageNumber = 0 exec DYNAMICS..smGetBIMsgString  @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @Posted_Date output   select @I_iDictID = 0 select @I_iMessageNumber = 22057 select @I_iAliasMessageNumber = 0 exec DYNAMICS..smGetBIMsgString  @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @Total_Benefit output  select @I_iDictID = 1493 select @I_iMessageNumber = 22400 select @I_iAliasMessageNumber = 22214 exec DYNAMICS..smGetBIMsgString  @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @EmployeeID_For_DrillBack output   select @I_iDictID = 1493 select @I_iMessageNumber = 24887 select @I_iAliasMessageNumber = 22214 exec DYNAMICS..smGetBIMsgString  @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @CheckbookID_For_DrillBack output   select @sqldropstring =   'if exists (select * from dbo.sysobjects where id = object_id(N''[dbo].[PayrollCheckAndDistributionHistory]'') and OBJECTPROPERTY(id, N''IsView'') = 1) ' +  'drop view [dbo].[PayrollCheckAndDistributionHistory] '  select @sqldefaultstring =   'CREATE VIEW PayrollCheckAndDistributionHistory AS ' +   'select ' +   'rtrim([''Payroll Check History''].[AUCTRLCD]) as ''' + @Audit_Control_Code + ''', ' + '[''Payroll Check History''].[PYADNMBR] as ''' + @Payment_Adjustment_Number + ''', ' + '[''Payroll Check History''].[Uncollected_FICASS_TaxP] as ''' + @Uncollected_FICA_SS_Tax_Pay_Run + ''', ' + 'rtrim([''Payroll Check History''].[EMPLOYID]) as ''' + @Employee_ID + ''', ' + '[''Payroll Check History''].[ADEICPMT] as ''' + @Advance_EIC_Payment + ''', ' + '[''Payroll Check History''].[YEAR1] as ''' + @Year + ''', ' + '[''Payroll Check History''].[GRWGPRN] as ''' + @Gross_Wages_Pay_Run + ''', ' + 'rtrim([''Payroll Check History''].[RSNCHKVD]) as ''' + @Reason_Check_Voided + ''', ' + '[''Payroll Check History''].[TTLDDTNS] as ''' + @Total_Deductions + ''', ' + '[''Payroll Check History''].[FICSTPTX] as ''' + @FICA_SS_Tax_on_Tips + ''', ' + 'rtrim([''Payroll Check History''].[SOCSCNUM]) as ''' + @Social_Security_Number + ''', ' + '[''Payroll Check History''].[Uncollected_FICAMed_TaxP] as ''' + @Uncollected_FICA_Med_Tax_Pay_Run + ''', ' + '[''Payroll Check History''].[CHEKDATE] as ''' + @Check_Date + ''', ' + 'rtrim([''Payroll Check History''].[CHEKBKID]) as ''' + @Checkbook_ID + ''', ' + '[''Payroll Check History''].[TOTLTAXS] as ''' + @Total_Taxes + ''', ' + '''' + @Voided + ''' = dbo.DYN_FUNC_Boolean_All([''Payroll Check History''].[VOIDED]), ' + '[''Payroll Check History''].[FDTXTIPS] as ''' + @Federal_Tax_on_Tips + ''', ' + '[''Payroll Check History''].[FDWDGPRN] as ''' + @Federal_Withholding_Pay_Run + ''', ' + 'rtrim([''Payroll Check History''].[DEPRTMNT]) as ''' + @Department + ''', ' + '[''Payroll Check History''].[NTWPYRN] as ''' + @Net_Wages_Pay_Run + ''', ' + 'rtrim([''Payroll Check History''].[CHEKNMBR]) as ''' + @Check_Number + ''', ' + '[''Payroll Check History''].[FICAMWPR] as ''' + @FICA_Medicare_Withholding_Pay_Run + ''', ' + '[''Payroll Check History''].[FICMTPTX] as ''' + @FICA_Med_Tax_on_Tips + ''', ' + 'rtrim([''Payroll Check History''].[EMPLNAME]) as ''' + @Employee_Name + ''', ' + '''' + @Voided_by_Void_Checks + ''' = dbo.DYN_FUNC_Boolean_All([''Payroll Check History''].[Voided_by_Void_Checks]), ' + '[''Payroll Check History''].[FCASWPR] as ''' + @FICA_Social_Security_Withholding_Pay_Run + ''', ' + '[''Payroll Check History''].[TTLBNFTS] as ''' + @Total_Benefit + ''', ' + '''' + @Approval + ''' = dbo.DYN_FUNC_Boolean_All([''Payroll Distribution History Header''].[APPROVL]), ' + '[''Payroll Distribution History Header''].[POSTEDDT] as ''' + @Posted_Date + ''', '  select @sqlstring1 =  '''' + @CheckbookID_For_DrillBack + ''' = ''' + @DrillBack_Base_Url + ''' +dbo.dgppCheckbookID(1,[''Payroll Check History''].[CHEKBKID] ), '+ '''' + @EmployeeID_For_DrillBack + ''' = ''' + @DrillBack_Base_Url + ''' +dbo.dgppEmployeeID(1,[''Payroll Check History''].[EMPLOYID] )'  select @sqljoinstring =   'from [UPR30100] as [''Payroll Check History''] with (NOLOCK) '   + 'left outer join [UPR30400] as [''Payroll Distribution History Header''] with (NOLOCK) on '   + '[''Payroll Check History''].[AUCTRLCD] = [''Payroll Distribution History Header''].[AUCTRLCD]  '   select @sqlaccessstring =  'GRANT SELECT ON [dbo].[PayrollCheckAndDistributionHistory] TO [rpt_executive]' + 'GRANT SELECT ON [dbo].[PayrollCheckAndDistributionHistory] TO [rpt_payroll]'   exec (@sqldropstring)  exec (@sqldefaultstring+' '+@sqlstring1+' '+@sqlstring2+' '+@sqlstring3+' '+@sqlstring4+' '+@sqlstring5+' '+@sqlstring6+' '+@sqlstring7+' '+@sqlstring8+' '+@sqlstring9+' '+@sqlstring10+' '+@sqljoinstring)  exec (@sqlaccessstring)   set nocount off    
GO
GRANT EXECUTE ON  [dbo].[sp_Dynamics_PayrollCheckAndDistributionHistory] TO [DYNGRP]
GO
