SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO
 create procedure [dbo].[glpCopyTaxToWork]  @iCopyJrnlEntry int   = NULL,  @iNewJrnlEntry int   = NULL,  @iRecurTrxSeq numeric(19,5) = NULL,  @history tinyint   = NULL,  @iDocDate datetime  = NULL as  declare  @lReturnStatus int   if @iCopyJrnlEntry is NULL or  @iNewJrnlEntry is NULL or  @iRecurTrxSeq is NULL or  @iDocDate is NULL  begin  select @lReturnStatus = 1  return  end  if (select count(*) from TX30000   where DOCNUMBR=convert(char(21),@iCopyJrnlEntry) and  RCTRXSEQ = @iRecurTrxSeq) = 0 begin  select @lReturnStatus = 0  return end   if exists (select * from dbo.sysobjects where id =   Object_id('dbo.#temp_table') and type in ('U','S')) begin  drop table dbo.#temp_table end  create table #temp_table(  SEQUENCE int IDENTITY (500,500) not null,  JRNENTRY int not null,  RCTRXSEQ numeric(19,5) not null,  SEQNUMBR int not null )  if @history > 0   insert into #temp_table select JRNENTRY,RCTRXSEQ,SEQNUMBR from GL30000 where JRNENTRY=@iCopyJrnlEntry order by SEQNUMBR else   insert into #temp_table select JRNENTRY,RCTRXSEQ,SEQNUMBR from GL20000 where JRNENTRY=@iCopyJrnlEntry order by SEQNUMBR  insert into GL10300   (JRNENTRY,  RCTRXSEQ,  SQNCLINE,  SQNCLINE2,  TAXDTLID,  DOCDATE,  Tax_Date,  TAXAMNT,  ORTAXAMT,  Taxable_Amount,  Originating_Taxable_Amt,  DOCAMNT,  ORDOCAMT,  TXDTLPCT,  TXDTLAMT,  TXDTLTYP,  ACTINDX,  CURRNIDX) select   @iNewJrnlEntry,  @iRecurTrxSeq,  b.SEQUENCE,  b.SEQUENCE,  a.TAXDTLID,  a.DOCDATE,  a.Tax_Date,  a.TAXAMNT,  a.ORTAXAMT,  -a.Taxable_Amount,  -a.Originating_Taxable_Amt,  -a.DOCAMNT,  -a.ORDOCAMT,  -a.TXDTLPCT,  -a.TXDTLAMT,  a.TXDTLTYP,  a.ACTINDX,  a.CURRNIDX from TX30000 a, #temp_table b where a.DOCNUMBR=convert(char(21),@iCopyJrnlEntry) and a.DOCNUMBR = convert(char(21),b.JRNENTRY) and a.RCTRXSEQ = @iRecurTrxSeq and a.SEQNUMBR = b.SEQNUMBR and a.TAXAMNT = 0.0  insert into GL10300   (JRNENTRY,  RCTRXSEQ,  SQNCLINE,  SQNCLINE2,  TAXDTLID,  DOCDATE,  Tax_Date,  TAXAMNT,  ORTAXAMT,  Taxable_Amount,  Originating_Taxable_Amt,  DOCAMNT,  ORDOCAMT,  TXDTLPCT,  TXDTLAMT,  TXDTLTYP,  ACTINDX,  CURRNIDX) select   @iNewJrnlEntry,  @iRecurTrxSeq,  b.SEQUENCE,  b.SEQUENCE - 500,  a.TAXDTLID,  a.DOCDATE,  a.Tax_Date,  -a.TAXAMNT,  -a.ORTAXAMT,  -a.Taxable_Amount,  -a.Originating_Taxable_Amt,  -a.DOCAMNT,  -a.ORDOCAMT,  -a.TXDTLPCT,  -a.TXDTLAMT,  a.TXDTLTYP,  a.ACTINDX,  a.CURRNIDX from TX30000 a, #temp_table b where a.DOCNUMBR=convert(char(21),@iCopyJrnlEntry) and a.DOCNUMBR = convert(char(21),b.JRNENTRY) and a.RCTRXSEQ = @iRecurTrxSeq and a.SEQNUMBR = b.SEQNUMBR and a.TAXAMNT <> 0.0  return (@lReturnStatus)   
GO
GRANT EXECUTE ON  [dbo].[glpCopyTaxToWork] TO [DYNGRP]
GO
