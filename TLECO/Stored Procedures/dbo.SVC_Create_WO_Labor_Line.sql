SET QUOTED_IDENTIFIER OFF
GO
SET ANSI_NULLS ON
GO
 CREATE Procedure [dbo].[SVC_Create_WO_Labor_Line]   (@WORECTYPE smallint,  @WORKORDNUM char(11),  @LINESEQUENCE integer OUTPUT,  @LineItemSeq integer,  @TECHID char(11),  @STATIONID char(11),  @STARTDATE datetime,  @STARTTIME datetime,  @ENDDATE datetime,   @ENDTIME datetime,  @NOTEINDX numeric(19,5),  @SEQUENCE1 numeric(19,5),  @ERROR integer OUTPUT,  @ERRORTYPE integer OUTPUT,  @CMPNTSEQ int = 0)  As declare @WOSTAT char(3) declare @LNITMSEQ integer declare @ITEMNMBR char(31) declare @ITEMDESC char(51) declare @LOCNCODE char(11) declare @TRANSTME numeric(19,5)declare @UNITCOST numeric(19,2) declare @UNITPRICE numeric(19,2) declare @EXTENDCOST numeric(19,2) declare @EXTENDPRICE numeric(19,2) declare @UOFM char(9) declare @UOMSCHEDULE char(11) declare @DAYS integer declare @HOURS numeric(19,5) declare @MINUTES numeric(19,2) declare @TIMESTRING varchar(20) declare @MinDate datetime  exec smGetMinDate @MinDate output  select @ERROR = 0,  @ERRORTYPE = 0 select   @LOCNCODE = LOCNCODE,  @ITEMNMBR = ITEMNMBR  from SVC06001 where STATIONID = @STATIONID if @ITEMNMBR is null begin  select @ERROR = 1,  @ERRORTYPE = 50  return end if @LOCNCODE is null  select @LOCNCODE = '' select   @ITEMDESC = ITEMDESC,  @UNITCOST = case when VCTNMTHD > 3 then  STNDCOST else CURRCOST end,  @UOMSCHEDULE = UOMSCHDL  from IV00101 where ITEMNMBR = @ITEMNMBR if @UOMSCHEDULE is null or @UOMSCHEDULE = ''  select @UOFM = 'Hour' else  select @UOFM = BASEUOFM   from IV40201   where UOMSCHDL = @UOMSCHEDULE if @UOFM is null or @UOFM = ''  select @UOFM = 'Hour' exec SVC_util_date_time_diff @STARTDATE,@STARTTIME,@ENDDATE,@ENDTIME, @DAYS OUTPUT,@HOURS OUTPUT if @DAYS <> 0   select @HOURS = @HOURS + (@DAYS * 24) select @TRANSTME = @HOURS,  @EXTENDCOST = @UNITCOST * @HOURS,  @UNITPRICE = @UNITCOST,  @EXTENDPRICE = @UNITCOST * @HOURS if @LineItemSeq is null select @LNITMSEQ = MAX(IsNull(LNITMSEQ,0)) + 1 from SVC06101 where WORECTYPE = @WORECTYPE and WORKORDNUM = @WORKORDNUM and LINITMTYP = 'L' else  select @LNITMSEQ = @LineItemSeq  select @WOSTAT = WOENTSTA from SVC00998 if @WOSTAT is null  select @WOSTAT = '' exec SVC_util_timeval_to_string @TRANSTME, @TIMESTRING OUTPUT insert into SVC06101  VALUES ( @WORECTYPE, @WORKORDNUM, @WOSTAT, 'L', @LNITMSEQ, isnull(@ITEMNMBR,''), '', isnull(@ITEMDESC,''), @STATIONID, isnull(@LOCNCODE,''), isnull(@UOFM,''), @TECHID, 0, 0, 0, isnull(@TRANSTME,''), isnull(@UNITCOST,0.0), isnull(@UNITPRICE,0.0), isnull(@EXTENDCOST,0.0), isnull(@EXTENDPRICE,0.0), @STARTDATE, @STARTTIME, @ENDDATE, @ENDTIME, @TIMESTRING, @TIMESTRING, @NOTEINDX, @SEQUENCE1, '', 0, '', 0,@MinDate, @CMPNTSEQ,0)  select @LINESEQUENCE = @LNITMSEQ  exec SVC_Set_Depot_Totals @WORECTYPE,@WORKORDNUM return (0)    
GO
GRANT EXECUTE ON  [dbo].[SVC_Create_WO_Labor_Line] TO [DYNGRP]
GO
