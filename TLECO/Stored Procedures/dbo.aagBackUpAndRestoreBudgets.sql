SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO
 CREATE    PROCEDURE [dbo].[aagBackUpAndRestoreBudgets] (  @aaBudgetTreeID INTEGER  ,  @BackupRestore INTEGER  ) AS  BEGIN declare   @TempTableAAG00904 VARCHAR(50),  @TempTableAAG00905 VARCHAR(50),  @TempTableAAG00904Query VARCHAR(8000),  @TempTableAAG00905Query VARCHAR(8000)   select @TempTableAAG00904 = '##Backup_AAG00904'  + REPLACE(system_user,'''','') + db_name()   select @TempTableAAG00905 = '##Backup_AAG00905'  + REPLACE(system_user,'''','') + db_name()  select @TempTableAAG00904Query = 'drop table ['+ @TempTableAAG00904 + ']'  select @TempTableAAG00905Query = 'drop table ['+ @TempTableAAG00905 + ']'   IF @BackupRestore = 0  BEGIN  IF EXISTS (SELECT name FROM tempdb.dbo.sysobjects WHERE name = @TempTableAAG00904)  EXEC(@TempTableAAG00904Query)   IF EXISTS (SELECT name FROM tempdb.dbo.sysobjects WHERE name = @TempTableAAG00905)  EXEC(@TempTableAAG00905Query)   EXEC('SELECT * INTO [' + @TempTableAAG00904 + '] FROM AAG00904 WHERE aaBudgetID IN (SELECT aaBudgetID FROM AAG00903 WHERE aaBudgetTreeID = ' + @aaBudgetTreeID + ')')  EXEC('SELECT * INTO [' + @TempTableAAG00905 + '] FROM AAG00905 WHERE aaBudgetID IN (SELECT aaBudgetID FROM AAG00903 WHERE aaBudgetTreeID = ' + @aaBudgetTreeID + ')')  END   ELSE  BEGIN  DELETE FROM AAG00904 WHERE aaBudgetID IN (SELECT aaBudgetID FROM AAG00903 WHERE aaBudgetTreeID = @aaBudgetTreeID)  DELETE FROM AAG00905 WHERE aaBudgetID IN (SELECT aaBudgetID FROM AAG00903 WHERE aaBudgetTreeID = @aaBudgetTreeID)  EXEC('INSERT INTO AAG00904 SELECT aaBudgetID, aaCodeSequence, PERIODDT, aaFiscalPeriod, aaActualPriliminary, Balance, QUANTITY, YEAR1, getutcdate() FROM [' + @TempTableAAG00904 + ']')  EXEC('INSERT INTO AAG00905 SELECT aaBudgetID, aaCodeSequence, ACTINDX, PERIODDT, aaFiscalPeriod, aaActualPriliminary, aaRange, Balance, YEAR1 FROM [' + @TempTableAAG00905 + ']')   EXEC (@TempTableAAG00904Query)  EXEC (@TempTableAAG00905Query)   END END    
GO
GRANT EXECUTE ON  [dbo].[aagBackUpAndRestoreBudgets] TO [DYNGRP]
GO
