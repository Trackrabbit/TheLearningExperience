SET QUOTED_IDENTIFIER OFF
GO
SET ANSI_NULLS ON
GO
 create procedure [dbo].[TABenefitChanger1]   @I_charStartBenefit  char(20),   @I_charEndBenefit   char(20),   @I_SystemDB char(200),  @O_iErrorState    int = NULL  output  with encryption as  declare   @CODE   char (255),  @tTransaction tinyint,  @tLoop tinyint,  @iStatus int,  @cStartBenefit char (17),  @cEndBenefit char (17),  @cmd nvarchar(2000),  @SystemTable char(300)  exec @iStatus = smFormatStringsForExecs  @I_vInputString  = @I_charStartBenefit,  @O_cOutputString = @cStartBenefit output,  @O_iErrorState  = @O_iErrorState output  if @iStatus <> 0 or @O_iErrorState <> 0 begin  set @O_iErrorState = 84  return end  exec @iStatus = smFormatStringsForExecs  @I_vInputString  = @I_charEndBenefit,  @O_cOutputString = @cEndBenefit output,  @O_iErrorState  = @O_iErrorState output  if @iStatus <> 0 or @O_iErrorState <> 0 begin  set @O_iErrorState = 85  return end  select  @O_iErrorState   = 0  if @@trancount = 0  begin  select @tTransaction = 1  begin transaction end  while ( @tLoop is NULL ) begin  select @tLoop = 1   if @I_charStartBenefit is NULL or  @I_charEndBenefit is NULL or  @cStartBenefit is NULL or  @cEndBenefit is NULL  begin  select @O_iErrorState = 86    break  end    declare T_cursor CURSOR for select 'update '+o.name+' set BENEFIT =' + rtrim(@cEndBenefit) +  ' where BENEFIT = ' + rtrim(@cStartBenefit)  from sysobjects o, syscolumns c  where o.id = c.id  and o.type = 'U'  and c.name = 'BENEFIT'   and o.name <> 'HRPBEN11'  and o.name <> 'HRPBEN12'  order by o.name   set nocount on  OPEN T_cursor  FETCH NEXT FROM T_cursor INTO @CODE  WHILE (@@FETCH_STATUS <> -1)  begin  exec (@CODE)  if @@error <> 0   begin  select @O_iErrorState = 87   break  end   FETCH NEXT FROM T_cursor INTO @CODE  end  DEALLOCATE T_cursor   if @O_iErrorState <> 0  break   update UPR10201 set PAYROLCD = @I_charEndBenefit where PAYROLCD = @I_charStartBenefit and PYRLRTYP = 3  if @@error <> 0  begin  select @O_iErrorState = 90   break  end  update UPR10211 set PAYROLCD = @I_charEndBenefit where PAYROLCD = @I_charStartBenefit and PYRLRTYP = 3  if @@error <> 0  begin  select @O_iErrorState = 91   break  end   update UPR10400 set PAYROLCD = @I_charEndBenefit where PAYROLCD = @I_charStartBenefit and UPRACTYP = 7  if @@error <> 0  begin  select @O_iErrorState = 92   break  end  update UPR10400 set PAYROLCD = @I_charEndBenefit where PAYROLCD = @I_charStartBenefit and UPRACTYP = 8  if @@error <> 0  begin  select @O_iErrorState = 93   break  end   update UPR19901 set PAYROLCD = @I_charEndBenefit where PAYROLCD = @I_charStartBenefit and UPRACTYP = 7  if @@error <> 0  begin  select @O_iErrorState = 94   break  end  update UPR19901 set PAYROLCD = @I_charEndBenefit where PAYROLCD = @I_charStartBenefit and UPRACTYP = 8  if @@error <> 0  begin  select @O_iErrorState = 95   break  end   update UPR30300 set PAYROLCD = @I_charEndBenefit where PAYROLCD = @I_charStartBenefit and PYRLRTYP = 3  if @@error <> 0  begin  select @O_iErrorState = 98   break  end   update UPR30301 set PAYROLCD = @I_charEndBenefit where PAYROLCD = @I_charStartBenefit and PYRLRTYP = 3  if @@error <> 0  begin  select @O_iErrorState = 99   break  end   update UPR40500 set PAYROLCD = @I_charEndBenefit where PAYROLCD = @I_charStartBenefit and UPRACTYP = 7  if @@error <> 0  begin  select @O_iErrorState = 100   break  end   update UPR40500 set PAYROLCD = @I_charEndBenefit where PAYROLCD = @I_charStartBenefit and UPRACTYP = 8  if @@error <> 0  begin  select @O_iErrorState = 101   break  end   update UPR41201 set PAYROLCD = @I_charEndBenefit where PAYROLCD = @I_charStartBenefit and PYRLRTYP = 3  if @@error <> 0  begin  select @O_iErrorState = 104   break  end   update UPR70500 set STTBFTCD = @I_charEndBenefit where STTBFTCD = @I_charStartBenefit  if @@error <> 0  begin  select @O_iErrorState = 105   break  end   update UPR70500 set ENBNFTCD = @I_charEndBenefit where ENBNFTCD = @I_charStartBenefit   if @@error <> 0  begin  select @O_iErrorState = 106   break  end   if exists (select * from sysobjects where id = object_id('dbo.HRPBEN11') and sysstat & 0xf = 3)  begin  update HRPBEN11 set BENEFIT = @I_charEndBenefit where BENEFIT = @I_charStartBenefit   if @@error <> 0  begin  select @O_iErrorState = 1233   break  end  end    if exists (select * from sysobjects where id = object_id('dbo.HRPBEN12') and sysstat & 0xf = 3)  begin  update HRPBEN12 set BENEFIT = @I_charEndBenefit where BENEFIT = @I_charStartBenefit   if @@error <> 0  begin  select @O_iErrorState = 1244   break  end  end    update UPR10302 set UPRTRXCD = @I_charEndBenefit where UPRTRXCD = @I_charStartBenefit and COMPTRTP = 3  if @@error <> 0  begin  select @O_iErrorState = 11   break  end   update UPR10303 set UPRTRXCD = @I_charEndBenefit where UPRTRXCD = @I_charStartBenefit and COMPTRTP = 3  if @@error <> 0  begin  select @O_iErrorState = 11   break  end   update UPR10308 set UPRTRXCD = @I_charEndBenefit where UPRTRXCD = @I_charStartBenefit and MLTRXTYP = 3  if @@error <> 0  begin  select @O_iErrorState = 11   break  end   set @SystemTable = '.dbo.AHR2OF01'  set @cmd = 'if exists (select * from ' + rtrim(@I_SystemDB) + '..sysobjects where id = object_id(''' + rtrim(@I_SystemDB) + rtrim(@SystemTable) + ''') and sysstat & 0xf = 3)  begin  declare @O_iErrorState    int = 0  select @O_iErrorState = 0  update ' + RTRIM(@I_SystemDB) + rtrim(@SystemTable) + ' set BENEFIT = ''' + @I_charEndBenefit + ''' where BENEFIT = ''' + @I_charStartBenefit + '''  if @@error <> 0  begin  select @O_iErrorState = 123   end  end '  exec (@cmd)   set @SystemTable = '.dbo.HR2OFF01'  set @cmd = 'if exists (select * from ' + rtrim(@I_SystemDB) + '..sysobjects where id = object_id(''' + rtrim(@I_SystemDB) + rtrim(@SystemTable) + ''') and sysstat & 0xf = 3)  begin  declare @O_iErrorState    int = 0  select @O_iErrorState = 0  update ' + RTRIM(@I_SystemDB) + rtrim(@SystemTable) + ' set BENEFIT = ''' + @I_charEndBenefit + ''' where BENEFIT = ''' + @I_charStartBenefit + '''  if @@error <> 0  begin  select @O_iErrorState = 124   end  end '  exec (@cmd)  set @SystemTable = '.dbo.BNUF0131'  set @cmd = 'if exists (select * from ' + rtrim(@I_SystemDB) + '..sysobjects where id = object_id(''' + rtrim(@I_SystemDB) + rtrim(@SystemTable) + ''') and sysstat & 0xf = 3)  begin  declare @O_iErrorState    int = 0  select @O_iErrorState = 0  update ' + RTRIM(@I_SystemDB) + rtrim(@SystemTable) + ' set STARTBENEFIT_I = ''' + @I_charEndBenefit + ''' where STARTBENEFIT_I = ''' + @I_charStartBenefit + '''  if @@error <> 0  begin  select @O_iErrorState = 125   end  end '  exec (@cmd)  set @SystemTable = '.dbo.BNUF0131'  set @cmd = 'if exists (select * from ' + rtrim(@I_SystemDB) + '..sysobjects where id = object_id(''' + rtrim(@I_SystemDB) + rtrim(@SystemTable) + ''') and sysstat & 0xf = 3)  begin  declare @O_iErrorState    int = 0  select @O_iErrorState = 0  update ' + RTRIM(@I_SystemDB) + rtrim(@SystemTable) + ' set ENDBENEFIT_I = ''' + @I_charEndBenefit + ''' where ENDBENEFIT_I = ''' + @I_charStartBenefit + '''  if @@error <> 0  begin  select @O_iErrorState = 125   end  end '  exec (@cmd) end  if @O_iErrorState <> 0 begin  if @tTransaction = 1  rollback transaction end else if @tTransaction = 1 begin  commit transaction end  return    
GO
GRANT EXECUTE ON  [dbo].[TABenefitChanger1] TO [DYNGRP]
GO
