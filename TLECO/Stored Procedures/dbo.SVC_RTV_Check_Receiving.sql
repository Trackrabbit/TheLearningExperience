SET QUOTED_IDENTIFIER OFF
GO
SET ANSI_NULLS ON
GO
 CREATE PROCEDURE [dbo].[SVC_RTV_Check_Receiving] (  @USERID char(15),  @RTV char(15),  @Line numeric(19,5),  @Error integer OUTPUT,  @ErrorMsg varchar(255) OUTPUT ) As declare @OtherUser char(15) declare @Transfer char(31) declare @numrows int declare @QtyToReceived numeric(19,5) declare @TRANSLINESEQ integer declare @BinQty numeric(19,5)  set nocount on select @Error = 0, @ErrorMsg = '' select @OtherUser = USERID from SVC05625 where RTV_Number = @RTV and RTV_Line = @Line and MKDTOPST = 1 and USERID <> @USERID if @OtherUser is null  begin  select @Transfer =Transfer_Reference, @TRANSLINESEQ = TRANSLINESEQ  from SVC05625 where RTV_Number = @RTV and RTV_Line = @Line and POSTED = 0  and USERID = @USERID  if (select STATUS from SVC00700 where ORDDOCID = @Transfer) = 99  begin  select @OtherUser = USERID  from SVC00700 where ORDDOCID = @Transfer  select @Error = 51, @ErrorMsg = ' is marked by ' + RTrim(@OtherUser) + ' for receiving'   end  else  Begin  select @QtyToReceived = QTY_To_Receive from SVC05601 where RTV_Number = @RTV and RTV_Line = @Line  if (select ITMTRKOP from SVC05601 where RTV_Number = @RTV and RTV_Line = @Line) >= 2   Begin  select @numrows = isnull(sum(SERLTQTY),0) from SVC05602 where RTV_Number = @RTV and RTV_Line = @Line and Shipped = 1 and  MARKED = 1 and  POSTED = 0  if @numrows <> @QtyToReceived  select @Error = 52, @ErrorMsg = ' The Qty To Receive <> Selected Serials '   else  return  End  else if (select ENABLEMULTIBIN from IV40100) = 1  Begin  select @BinQty = isnull(sum(QUANTITY),0) from SVC00712 where ORDDOCID = @Transfer and LNITMSEQ = @TRANSLINESEQ and POSTED = 0  if @BinQty <> @QtyToReceived  select @Error = 53, @ErrorMsg = ' The Qty To Receive <> Selected Bins '   else  return  End  else  return  End  end else  select @Error = 50, @ErrorMsg = ' is marked by ' + RTrim(@OtherUser) + ' for receiving'  set nocount off return    
GO
GRANT EXECUTE ON  [dbo].[SVC_RTV_Check_Receiving] TO [DYNGRP]
GO
