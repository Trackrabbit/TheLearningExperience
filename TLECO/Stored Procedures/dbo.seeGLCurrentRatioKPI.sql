SET QUOTED_IDENTIFIER OFF
GO
SET ANSI_NULLS ON
GO
 create procedure [dbo].[seeGLCurrentRatioKPI] @UserDate datetime = NULL,   @TimeUnit varchar(10) = 'Period'  as   declare @CurrentRatio          numeric(19, 5),   @PreviousCurrentRatio         numeric(19, 5),   @LastYearCurrentRatio         numeric(19, 5),   @CurrentBalanceAssets       numeric(19, 5),   @PreviousBalanceAssets      numeric(19, 5),   @LastYearBalanceAssets      numeric(19, 5),   @CurrentBalanceLiabilities  numeric(19, 5),   @PreviousBalanceLiabilities numeric(19, 5),   @LastYearBalanceLiabilities numeric(19, 5)    SELECT @CurrentBalanceAssets = sum(CurrentBalance),   @PreviousBalanceAssets = sum(PreviousBalance),   @LastYearBalanceAssets = sum(LastYearBalance)   FROM   (SELECT *   FROM   GetGLAcctCatBalanceKPI(ISNULL(@UserDate,GetDate()), @TimeUnit, 'YTD', 1)   UNION   SELECT *   FROM   GetGLAcctCatBalanceKPI(ISNULL(@UserDate,GetDate()), @TimeUnit, 'YTD', 2)   UNION   SELECT *   FROM   GetGLAcctCatBalanceKPI(ISNULL(@UserDate,GetDate()), @TimeUnit, 'YTD', 3)   UNION   SELECT *   FROM   GetGLAcctCatBalanceKPI(ISNULL(@UserDate,GetDate()), @TimeUnit, 'YTD', 4)  UNION   SELECT *   FROM   GetGLAcctCatBalanceKPI(ISNULL(@UserDate,GetDate()), @TimeUnit, 'YTD', 5)  UNION   SELECT *   FROM   GetGLAcctCatBalanceKPI(ISNULL(@UserDate,GetDate()), @TimeUnit, 'YTD', 6)  UNION   SELECT *   FROM   GetGLAcctCatBalanceKPI(ISNULL(@UserDate,GetDate()), @TimeUnit, 'YTD', 7)) s1    SELECT @CurrentBalanceLiabilities = sum(CurrentBalance),   @PreviousBalanceLiabilities = sum(PreviousBalance),   @LastYearBalanceLiabilities = sum(LastYearBalance)   FROM   (SELECT *   FROM   GetGLAcctCatBalanceKPI(ISNULL(@UserDate,GetDate()), @TimeUnit, 'YTD', 13)   UNION   SELECT *   FROM   GetGLAcctCatBalanceKPI(ISNULL(@UserDate,GetDate()), @TimeUnit, 'YTD', 14)   UNION   SELECT *   FROM   GetGLAcctCatBalanceKPI(ISNULL(@UserDate,GetDate()), @TimeUnit, 'YTD', 15)   UNION   SELECT *   FROM   GetGLAcctCatBalanceKPI(ISNULL(@UserDate,GetDate()), @TimeUnit, 'YTD', 16)   UNION   SELECT *   FROM   GetGLAcctCatBalanceKPI(ISNULL(@UserDate,GetDate()), @TimeUnit, 'YTD', 17)   UNION   SELECT *   FROM   GetGLAcctCatBalanceKPI(ISNULL(@UserDate,GetDate()), @TimeUnit, 'YTD', 18)   UNION   SELECT *   FROM   GetGLAcctCatBalanceKPI(ISNULL(@UserDate,GetDate()), @TimeUnit, 'YTD', 19)   UNION   SELECT *   FROM   GetGLAcctCatBalanceKPI(ISNULL(@UserDate,GetDate()), @TimeUnit, 'YTD', 20)   UNION   SELECT *   FROM   GetGLAcctCatBalanceKPI(ISNULL(@UserDate,GetDate()), @TimeUnit, 'YTD', 21)) s2    select @CurrentRatio = CASE   WHEN @CurrentBalanceLiabilities = 0 THEN 0   ELSE ROUND(   @CurrentBalanceAssets / @CurrentBalanceLiabilities, 2)   END    select @PreviousCurrentRatio = CASE   WHEN @PreviousBalanceLiabilities = 0 THEN 0   ELSE ROUND(   @PreviousBalanceAssets / @PreviousBalanceLiabilities, 2)   END    select @LastYearCurrentRatio = CASE   WHEN @LastYearBalanceLiabilities = 0 THEN 0   ELSE ROUND(   @LastYearBalanceAssets / @LastYearBalanceLiabilities, 2)   END    select @CurrentRatio                                             as   CurrentRatio,   @PreviousCurrentRatio                                            as   PreviousCurrentRatio,   @LastYearCurrentRatio                                            as   LastYearCurrentRatio,   dbo.CalcPercentChange(@PreviousCurrentRatio, @CurrentRatio) as   'CurrPrevPercChange',   dbo.CalcPercentChange(@LastYearCurrentRatio, @CurrentRatio) as   'CurrLYPercChange'    
GO
GRANT EXECUTE ON  [dbo].[seeGLCurrentRatioKPI] TO [DYNGRP]
GO
GRANT EXECUTE ON  [dbo].[seeGLCurrentRatioKPI] TO [rpt_accounting manager]
GO
GRANT EXECUTE ON  [dbo].[seeGLCurrentRatioKPI] TO [rpt_accounts receivable coordinator]
GO
GRANT EXECUTE ON  [dbo].[seeGLCurrentRatioKPI] TO [rpt_bookkeeper]
GO
GRANT EXECUTE ON  [dbo].[seeGLCurrentRatioKPI] TO [rpt_certified accountant]
GO
GRANT EXECUTE ON  [dbo].[seeGLCurrentRatioKPI] TO [rpt_executive]
GO
