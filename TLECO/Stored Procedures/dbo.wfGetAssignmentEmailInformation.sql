SET QUOTED_IDENTIFIER OFF
GO
SET ANSI_NULLS ON
GO
 CREATE PROCEDURE [dbo].[wfGetAssignmentEmailInformation]   @WorkflowInstanceID char(37),  @WorkflowStepInstanceID char(37),  @DocAttachBusObjKey char(200) OUTPUT,  @Document_ID char(50) OUTPUT,  @DocumentDrillDown varchar(255) OUTPUT,  @Originator_Comments varchar(500) OUTPUT,  @originatorCommentsDate datetime OUTPUT,  @originatorCommentsTime datetime OUTPUT,  @Workflow_Managers char(37) OUTPUT,  @Workflow_Name char(51) OUTPUT,  @Workflow_Originator char(238) OUTPUT,  @Workflow_Status smallint OUTPUT,   @Workflow_Step_Name char(51) OUTPUT,   @Workflow_Error int OUTPUT AS  BEGIN set NOCOUNT ON   declare @assigned_task_user char(85)  declare @WfBusObjKey char(201),  @tilde_position smallint,  @Workflow_Type_Name char(51)   select @WorkflowStepInstanceID=UPPER(@WorkflowStepInstanceID)  select @Workflow_Managers=UPPER(@Workflow_Managers)  select @WorkflowInstanceID=UPPER(@WorkflowInstanceID)   select @Workflow_Step_Name=@Workflow_Step_Name   from WFI10003   where WorkflowStepInstanceID=@WorkflowStepInstanceID  select @WfBusObjKey=WfBusObjKey,@Workflow_Type_Name=Workflow_Type_Name, @Workflow_Name=Workflow_Name,  @Workflow_Originator=Workflow_Originator, @Workflow_Status=Workflow_Status,   @DocumentDrillDown = Document_Drill_Down , @DocAttachBusObjKey = BusObjKey  from WFI10002   where WorkflowInstanceID=@WorkflowInstanceID  select @tilde_position=CHARINDEX('~',@WfBusObjKey)  if @tilde_position>0   begin  select @Document_ID=substring(@WfBusObjKey,1,@tilde_position-1)  end  else   begin  select @Document_ID=@WfBusObjKey  end  select top 1 @Workflow_Managers=Workflow_Managers from WF100001 where Workflow_Type_Name = @Workflow_Type_Name  select top 1 @Originator_Comments=isnull(Workflow_Comments, ''), @originatorCommentsDate = isnull(Workflow_Completion_Date, [dbo].glFuncGetMinDate()),  @originatorCommentsTime = isnull(Workflow_Completion_Time, [dbo].glFuncGetMinDate())  from WF30100   where WorkflowInstanceID = @WorkflowInstanceID and Workflow_History_User=@Workflow_Originator  and Workflow_Action in (1,2)    order by Workflow_Completion_Date desc,Workflow_Completion_Time desc, Milliseconds desc  END   
GO
GRANT EXECUTE ON  [dbo].[wfGetAssignmentEmailInformation] TO [DYNGRP]
GO
