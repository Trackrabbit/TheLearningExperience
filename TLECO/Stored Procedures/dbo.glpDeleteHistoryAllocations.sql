SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO
 create procedure [dbo].[glpDeleteHistoryAllocations]  @I_iSQLSessionID int  = NULL,  @I_cBatchSource char(15) = NULL,  @I_cBatchNumber char(15) = NULL,  @I_iJournalEntry int  = NULL,  @I_cUserID char(15) = NULL,  @I_bHeaderMessages binary(4) = NULL,   @I_bLineMessages binary(4) = NULL,  @O_iErrorState int  = NULL output as  declare  @DELETE_REPORT smallint,  @DISPLAY_REPORT smallint,  @DISPLAY_RECURRING_REPORT smallint,  @MS_ITEM_1 int,  @MS_ITEM_5 int,  @MS_ITEM_10 int,  @MS_ITEM_12 int,  @MS_ITEM_15 int,  @ALLOCATION_SEQ_LINE_CLOSING int,  @tTransaction tinyint,  @tLoop tinyint  select @O_iErrorState = 0  if @@trancount = 0 begin  select @tTransaction = 1  begin transaction end   while (@tLoop is NULL) begin  select @tLoop = 1   if @I_iSQLSessionID is NULL or  @I_cBatchSource is NULL or  @I_cBatchNumber is NULL or  @I_cUserID is NULL or  @I_bHeaderMessages is NULL or  @I_bLineMessages is NULL  begin  select @O_iErrorState = 20823  break  end    select  @DELETE_REPORT   = 1,  @DISPLAY_REPORT   = 0,  @DISPLAY_RECURRING_REPORT = -1,  @MS_ITEM_1   = power (2,24),  @MS_ITEM_5   = power (2,28),   @MS_ITEM_10   = power (2,17),  @MS_ITEM_12   = power (2,19),  @MS_ITEM_15   = power (2,22),  @ALLOCATION_SEQ_LINE_CLOSING = 10000000   if @I_bHeaderMessages & @MS_ITEM_1 = @MS_ITEM_1 or  @I_bHeaderMessages & @MS_ITEM_10 = @MS_ITEM_10 or  @I_bHeaderMessages & @MS_ITEM_12 = @MS_ITEM_12 or   @I_bHeaderMessages & @MS_ITEM_15 = @MS_ITEM_15 or  @I_bLineMessages & @MS_ITEM_5 = @MS_ITEM_5 or   @I_bLineMessages & @MS_ITEM_15 = @MS_ITEM_15  begin  update  PJOURNAL  set   REPORT = @DELETE_REPORT  where  USERID = @I_cUserID  and BCHSOURC = @I_cBatchSource  and BACHNUMB = @I_cBatchNumber  and JRNENTRY = @I_iJournalEntry  and (REPORT = @DISPLAY_REPORT   or REPORT = @DISPLAY_RECURRING_REPORT)  and SQNCLINE >= @ALLOCATION_SEQ_LINE_CLOSING  end  end   if @O_iErrorState <> 0 begin  if @tTransaction = 1  rollback transaction end else if @tTransaction = 1  commit transaction  return    
GO
GRANT EXECUTE ON  [dbo].[glpDeleteHistoryAllocations] TO [DYNGRP]
GO
