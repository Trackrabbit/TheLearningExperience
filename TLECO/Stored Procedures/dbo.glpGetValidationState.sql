SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO
 create procedure [dbo].[glpGetValidationState]   @I_cBatchSource         char(15)        = NULL,  @I_cBatchNumber char(15)        = NULL,  @IO_bValidationState    binary(4)       = NULL  output,  @O_iErrorState          int             = NULL  output  as  declare  @MS_ITEM_1              int,  @MS_ITEM_2              int,  @MS_ITEM_3              int,  @bValidationState       binary(4),  @iRowCount              int,  @tTransaction           tinyint,  @tLoop                  tinyint  select @O_iErrorState = 0  if @@trancount = 0 begin  select @tTransaction = 1  begin transaction end   while (@tLoop is NULL) begin  select @tLoop = 1   if      @I_cBatchSource         is NULL or  @I_cBatchNumber is NULL or  @IO_bValidationState    is NULL  begin  select @O_iErrorState = 20686  break  end    select   @MS_ITEM_1 = power(2, 24),  @MS_ITEM_2 = power(2, 25),  @MS_ITEM_3 = power(2, 26)   if not exists (  select  1  from   dbo.sysobjects   where   id = Object_id('dbo.glpAccountMasterDeleteTrigger')   and type = 'TR')  begin  select @IO_bValidationState = @IO_bValidationState | @MS_ITEM_1  break  end   if not exists (  select   1   from   dbo.sysobjects   where   id = Object_id('dbo.glpAccountMasterUpdateTrigger')   and type = 'TR')  begin  select @IO_bValidationState = @IO_bValidationState | @MS_ITEM_1  break  end   if not exists (  select   1   from   dbo.sysobjects   where   id = Object_id('dbo.glpBatchHeadersDeleteTrigger')   and type = 'TR')  begin  select @IO_bValidationState = @IO_bValidationState | @MS_ITEM_1  break  end   if not exists (  select  1  from   dbo.sysobjects   where   id = Object_id('dbo.glpPeriodHDRDeleteTrigger')   and type = 'TR')  begin  select @IO_bValidationState = @IO_bValidationState | @MS_ITEM_1  break  end   if not exists (  select  1  from   dbo.sysobjects   where   id = Object_id('dbo.glpPeriodHDRUpdateTrigger')   and type = 'TR')  begin  select @IO_bValidationState = @IO_bValidationState | @MS_ITEM_1  break  end   if not exists (  select  1  from   dbo.sysobjects   where   id = Object_id('dbo.glpPeriodSETPDeleteTrigger')   and type = 'TR')  begin  select @IO_bValidationState = @IO_bValidationState | @MS_ITEM_1   break  end   if not exists (  select  1  from   dbo.sysobjects   where id = Object_id('dbo.glpPeriodSETPUpdateTrigger')   and type = 'TR')  begin  select @IO_bValidationState = @IO_bValidationState | @MS_ITEM_1   break  end   select   @bValidationState = GLBCHVAL   from  wkPostingValidationState  where  BCHSOURC = @I_cBatchSource  and     BACHNUMB = @I_cBatchNumber   select @iRowCount = @@rowcount    if @iRowCount = 0  break  else if @iRowCount = 1  begin  if @bValidationState & @MS_ITEM_2 = @MS_ITEM_2  select @IO_bValidationState = @IO_bValidationState | @MS_ITEM_2   if @bValidationState & @MS_ITEM_3 = @MS_ITEM_3  select @IO_bValidationState = @IO_bValidationState | @MS_ITEM_3  end  else  select @O_iErrorState = 20688  end   if  @O_iErrorState <> 0 begin  if @tTransaction = 1  rollback transaction  end else if @tTransaction = 1  commit transaction  return     
GO
GRANT EXECUTE ON  [dbo].[glpGetValidationState] TO [DYNGRP]
GO
