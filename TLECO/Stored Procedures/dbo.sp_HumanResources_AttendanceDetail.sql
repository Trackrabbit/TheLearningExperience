SET QUOTED_IDENTIFIER OFF
GO
SET ANSI_NULLS ON
GO
 CREATE PROCEDURE [dbo].[sp_HumanResources_AttendanceDetail] @iLanguageID int  as  set nocount on   declare @sqldropstring varchar(400),  @sqldefaultstring varchar(8000),  @sqlstring1 varchar(8000),  @sqlstring2 varchar(8000),  @sqlstring3 varchar(8000),  @sqlstring4 varchar(8000),  @sqlstring5 varchar(8000),  @sqlstring6 varchar(8000),  @sqlstring7 varchar(8000),  @sqlstring8 varchar(8000),  @sqlstring9 varchar(8000),  @sqlstring10 varchar(8000),  @sqljoinstring varchar(8000),  @sqlaccessstring varchar(2000),  @tNumberSegments int,  @tSegment int,  @I_iDictID int,  @I_iLangID int,  @I_iMessageNumber int,  @I_iAliasMessageNumber int,  @I_iIntegerValue int,  @Company_Code varchar(255),  @Division varchar(255), @Pay_Record varchar(255), @Time_Type varchar(255), @Time_Code_Description varchar(255), @Hours varchar(255), @Time_Code varchar(255), @TRX varchar(255), @Computer_TRX_Number varchar(255), @Attendance_Type varchar(255), @Division_Code varchar(255), @Employee_ID varchar(255), @TRX_Date varchar(255), @Batch_Number varchar(255), @Department varchar(255), @Attendance_Reason varchar(255), @Attendance_TRX_Status varchar(255), @TRX_Ending_Date varchar(255), @Record_Number varchar(255), @Social_Security_Number varchar(255), @Employee_Class varchar(255), @Job_Title varchar(255), @Inactive varchar(255), @Location_ID varchar(255), @Supervisor_Code varchar(255), @First_Name varchar(255), @Last_Name varchar(255), @Middle_Name varchar(255), @Workers_Comp varchar(255), @Department_Description varchar(255), @Accrual_Flag varchar(255) select @I_iDictID = 414 select @I_iMessageNumber = 26117 select @I_iAliasMessageNumber = 0 exec DYNAMICS..smGetBIMsgString  @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @Company_Code output  select @I_iDictID = 0 select @I_iMessageNumber = 22060 select @I_iAliasMessageNumber = 0 exec DYNAMICS..smGetBIMsgString  @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @Division output select @I_iDictID = 414 select @I_iMessageNumber = 22669 select @I_iAliasMessageNumber = 0 exec DYNAMICS..smGetBIMsgString  @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @Pay_Record output select @I_iDictID = 0 select @I_iMessageNumber = 22061 select @I_iAliasMessageNumber = 0 exec DYNAMICS..smGetBIMsgString  @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @Time_Type output select @I_iDictID = 0 select @I_iMessageNumber = 22062 select @I_iAliasMessageNumber = 0 exec DYNAMICS..smGetBIMsgString  @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @Time_Code_Description output select @I_iDictID = 0 select @I_iMessageNumber = 22063 select @I_iAliasMessageNumber = 0 exec DYNAMICS..smGetBIMsgString  @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @Hours output select @I_iDictID = 0 select @I_iMessageNumber = 22064 select @I_iAliasMessageNumber = 0 exec DYNAMICS..smGetBIMsgString  @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @Time_Code output select @I_iDictID = 0 select @I_iMessageNumber = 22065 select @I_iAliasMessageNumber = 0 exec DYNAMICS..smGetBIMsgString  @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @TRX output select @I_iDictID = 1493 select @I_iMessageNumber = 23500 select @I_iAliasMessageNumber = 0 exec DYNAMICS..smGetBIMsgString  @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @Computer_TRX_Number output select @I_iDictID = 0 select @I_iMessageNumber = 22066 select @I_iAliasMessageNumber = 0 exec DYNAMICS..smGetBIMsgString  @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @Attendance_Type output select @I_iDictID = 1493 select @I_iMessageNumber = 24328 select @I_iAliasMessageNumber = 0 exec DYNAMICS..smGetBIMsgString  @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @Division_Code output select @I_iDictID = 1493 select @I_iMessageNumber = 22400 select @I_iAliasMessageNumber = 0 exec DYNAMICS..smGetBIMsgString  @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @Employee_ID output  select @I_iDictID = 1493 select @I_iMessageNumber = 24447 select @I_iAliasMessageNumber = 0 exec DYNAMICS..smGetBIMsgString  @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @TRX_Date output  select @I_iDictID = 1493 select @I_iMessageNumber = 23311 select @I_iAliasMessageNumber = 0 exec DYNAMICS..smGetBIMsgString  @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @Batch_Number output  select @I_iDictID = 1493 select @I_iMessageNumber = 24929 select @I_iAliasMessageNumber = 0 exec DYNAMICS..smGetBIMsgString  @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @Department output  select @I_iDictID = 0 select @I_iMessageNumber = 22067 select @I_iAliasMessageNumber = 0 exec DYNAMICS..smGetBIMsgString  @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @Attendance_Reason output  select @I_iDictID = 0 select @I_iMessageNumber = 22068 select @I_iAliasMessageNumber = 0 exec DYNAMICS..smGetBIMsgString  @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @Attendance_TRX_Status output  select @I_iDictID = 1493 select @I_iMessageNumber = 24934 select @I_iAliasMessageNumber = 0 exec DYNAMICS..smGetBIMsgString  @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @TRX_Ending_Date output  select @I_iDictID = 1493 select @I_iMessageNumber = 26700 select @I_iAliasMessageNumber = 0 exec DYNAMICS..smGetBIMsgString  @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @Record_Number output select @I_iDictID = 1493 select @I_iMessageNumber = 22414 select @I_iAliasMessageNumber = 0 exec DYNAMICS..smGetBIMsgString  @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @Social_Security_Number output  select @I_iDictID = 1493 select @I_iMessageNumber = 22401 select @I_iAliasMessageNumber = 0 exec DYNAMICS..smGetBIMsgString  @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @Employee_Class output  select @I_iDictID = 1493 select @I_iMessageNumber = 24930 select @I_iAliasMessageNumber = 0 exec DYNAMICS..smGetBIMsgString  @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @Job_Title output  select @I_iDictID = 1493 select @I_iMessageNumber = 24779 select @I_iAliasMessageNumber = 0 exec DYNAMICS..smGetBIMsgString  @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @Inactive output  select @I_iDictID = 1493 select @I_iMessageNumber = 24334 select @I_iAliasMessageNumber = 0 exec DYNAMICS..smGetBIMsgString  @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @Location_ID output  select @I_iDictID = 1493 select @I_iMessageNumber = 24343 select @I_iAliasMessageNumber = 0 exec DYNAMICS..smGetBIMsgString  @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @Supervisor_Code output  select @I_iDictID = 1493 select @I_iMessageNumber = 22404 select @I_iAliasMessageNumber = 0 exec DYNAMICS..smGetBIMsgString  @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @First_Name output  select @I_iDictID = 1493 select @I_iMessageNumber = 22403 select @I_iAliasMessageNumber = 0 exec DYNAMICS..smGetBIMsgString  @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @Last_Name output  select @I_iDictID = 1493 select @I_iMessageNumber = 22405 select @I_iAliasMessageNumber = 0 exec DYNAMICS..smGetBIMsgString  @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @Middle_Name output select @I_iDictID = 1493 select @I_iMessageNumber = 24943 select @I_iAliasMessageNumber = 0 exec DYNAMICS..smGetBIMsgString  @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @Workers_Comp output  select @I_iDictID = 0 select @I_iMessageNumber = 22069 select @I_iAliasMessageNumber = 0 exec DYNAMICS..smGetBIMsgString  @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @Department_Description output  select @I_iDictID = 0 select @I_iMessageNumber = 22076 select @I_iAliasMessageNumber = 0 exec DYNAMICS..smGetBIMsgString  @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @Accrual_Flag output  select @sqldropstring =   'if exists (select * from dbo.sysobjects where id = object_id(N''[dbo].[AttendanceDetail]'') and OBJECTPROPERTY(id, N''IsView'') = 1) ' +  'drop view [dbo].[AttendanceDetail] '  select @sqldefaultstring =   'CREATE VIEW AttendanceDetail AS ' +   'select ' +   'rtrim([''HR_Division2''].[COMPANYCODE_I]) as ''' + @Company_Code + ''', ' + 'rtrim(ISNULL([''HR_Division2''].[DIVISION_I],'''')) as ''' + @Division + ''', ' + 'rtrim([''TA_SETP_Types''].[PAYRCORD]) as ''' + @Pay_Record + ''', ' + '''' + @Time_Type + ''' = dbo.DYN_FUNC_Time_Type([''TA_SETP_Types''].[TIMETYPE_I]),  ' + 'rtrim([''TA_SETP_Types''].[DSCRIPTN]) as ''' + @Time_Code_Description + ''', ' + '[''TA_TRX_Detail''].[HOURS_I] as ''' + @Hours + ''', ' +  'rtrim([''TA_TRX_Detail''].[TIMECODE_I]) as ''' + @Time_Code + ''', ' + '[''TA_TRX_Detail''].[TRX_I] as ''' + @TRX + ''', ' +  '[''TA_TRX_Detail''].[COMPTRNM] as ''' + @Computer_TRX_Number + ''', ' +  'rtrim([''TA_TRX_Detail''].[ATTTYP]) as ''' + @Attendance_Type + ''', ' + 'rtrim([''TA_TRX_Detail''].[DIVISIONCODE_I]) as ''' + @Division_Code + ''', ' + 'rtrim([''TA_TRX_Detail''].[EMPID_I]) as ''' + @Employee_ID + ''', ' + '[''TA_TRX_Detail''].[TRXDATE] as ''' + @TRX_Date + ''', ' +  'rtrim([''TA_TRX_Detail''].[BACHNUMB]) as ''' + @Batch_Number + ''', ' + 'rtrim([''TA_TRX_Detail''].[DEPRTMNT]) as ''' + @Department + ''', ' + 'rtrim([''TA_TRX_Detail''].[ATTRSN]) as ''' + @Attendance_Reason + ''', ' + '''' + @Attendance_TRX_Status + ''' = dbo.DYN_FUNC_Attendance_TRX_Status([''TA_TRX_Detail''].[ATTTRXSTATUS]),  ' + '[''TA_TRX_Detail''].[TRXENDDT] as ''' + @TRX_Ending_Date + ''', ' +  '[''TA_TRX_Detail''].[CMRECNUM] as ''' + @Record_Number + ''', ' +  'rtrim([''Payroll Master''].[SOCSCNUM]) as ''' + @Social_Security_Number + ''', ' + 'rtrim([''Payroll Master''].[EMPLCLAS]) as ''' + @Employee_Class + ''', ' + 'rtrim([''Payroll Master''].[JOBTITLE]) as ''' + @Job_Title + ''', ' + '''' + @Inactive + ''' = dbo.DYN_FUNC_Boolean_All([''Payroll Master''].[INACTIVE]), ' +  'rtrim([''Payroll Master''].[LOCATNID]) as ''' + @Location_ID + ''', ' + 'rtrim([''Payroll Master''].[SUPERVISORCODE_I]) as ''' + @Supervisor_Code + ''', ' + 'rtrim([''Payroll Master''].[FRSTNAME]) as ''' + @First_Name + ''', ' + 'rtrim([''Payroll Master''].[LASTNAME]) as ''' + @Last_Name + ''', ' + 'rtrim([''Payroll Master''].[MIDLNAME]) as ''' + @Middle_Name + ''', ' + 'rtrim([''Payroll Master''].[WRKRCOMP]) as ''' + @Workers_Comp + ''', ' + 'rtrim([''Payroll Department Setup''].[DSCRIPTN]) as ''' + @Department_Description + ''', ' + '''' + @Accrual_Flag + ''' = dbo.DYN_FUNC_Boolean_All([''TA_TRX_Detail''].[ACCFLG]) '   select @sqljoinstring =   'from [TATX1030] as [''TA_TRX_Detail''] with (NOLOCK) '   + 'left outer join [TATM0130] as [''TA_SETP_Types''] with (NOLOCK) on '   + '[''TA_SETP_Types''].[TIMECODE_I] = [''TA_TRX_Detail''].[TIMECODE_I] '   + 'left outer join [UPR00100] as [''Payroll Master''] with (NOLOCK) on '   + '[''Payroll Master''].[EMPLOYID] = [''TA_TRX_Detail''].[EMPID_I] '   + 'left outer join [HR2DIV02] as [''HR_Division2''] with (NOLOCK) on '   + '[''HR_Division2''].[DIVISIONCODE_I] = [''Payroll Master''].[DIVISIONCODE_I] '   + 'left outer join [UPR40300] as [''Payroll Department Setup''] with (NOLOCK) on '   + '[''Payroll Department Setup''].[DEPRTMNT] = [''Payroll Master''].[DEPRTMNT] '  select @sqlaccessstring =   'GRANT SELECT ON [dbo].[AttendanceDetail] TO [rpt_executive]' + 'GRANT SELECT ON [dbo].[AttendanceDetail] TO [rpt_human resource administrator]'   exec (@sqldropstring)  exec (@sqldefaultstring+' '+@sqlstring1+' '+@sqlstring2+' '+@sqlstring3+' '+@sqlstring4+' '+@sqlstring5+' '+@sqlstring6+' '+@sqlstring7+' '+@sqlstring8+' '+@sqlstring9+' '+@sqlstring10+' '+@sqljoinstring)  exec (@sqlaccessstring)   set nocount off    
GO
GRANT EXECUTE ON  [dbo].[sp_HumanResources_AttendanceDetail] TO [DYNGRP]
GO
