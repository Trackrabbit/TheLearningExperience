SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO
 create procedure [dbo].[glpUpdateRetainedEarnings]  @I_iSQLSessionID                int             = NULL,  @I_iAccountIndex                int             = NULL,  @I_mDebit                      numeric(19,5)    = NULL,  @I_mCredit                      numeric(19,5)    = NULL,  @I_sFuncDecimalPlaces   smallint        = NULL,  @I_mOrigDebit                  numeric(19,5)    = NULL,  @I_mOrigCredit                  numeric(19,5)    = NULL,  @I_sOrigDecimalPlaces   smallint        = NULL,  @O_iErrorState                  int             = NULL  output as  declare  @HISTORY                        int,  @YEAR_END_CLOSE int,  @tTransaction           tinyint,  @iError                 int,  @iStatus                        int,  @tLoop                  tinyint  select   @O_iErrorState = 0,  @iStatus                = 0  if @@trancount = 0 begin  select @tTransaction = 1  begin transaction end   while (@tLoop is NULL) begin  select @tLoop = 1   if      @I_iSQLSessionID                is NULL or  @I_iAccountIndex                is NULL or  @I_mDebit                       is NULL or  @I_mCredit                      is NULL or  @I_sFuncDecimalPlaces   is NULL or  @I_mOrigDebit                  is NULL or  @I_mOrigCredit                  is NULL or  @I_sOrigDecimalPlaces   is NULL   begin  select @O_iErrorState = 20401  break  end    select   @HISTORY = 2,  @YEAR_END_CLOSE = 3   update   #Distributions   set   Debit = round(Percentage * @I_mDebit/100.00000,@I_sFuncDecimalPlaces),  Credit = round(Percentage * @I_mCredit/100.00000,@I_sFuncDecimalPlaces),  OriginatingDebit = round(Percentage * @I_mOrigDebit/100.00000,@I_sOrigDecimalPlaces),  OriginatingCredit = round(Percentage * @I_mOrigCredit/100.00000,@I_sOrigDecimalPlaces)  where   SQLSessionID = @I_iSQLSessionID   and     AllocationIndex = @I_iAccountIndex  and     (AllocationType = @HISTORY  or      AllocationType = @YEAR_END_CLOSE)   if @@rowcount = 0  begin  select @O_iErrorState = 20402  break  end   end   if @iStatus <> 0 or @O_iErrorState <> 0 begin  if @tTransaction = 1  rollback transaction end else if @tTransaction = 1  commit transaction  return (@iStatus)    
GO
GRANT EXECUTE ON  [dbo].[glpUpdateRetainedEarnings] TO [DYNGRP]
GO
