SET QUOTED_IDENTIFIER OFF
GO
SET ANSI_NULLS OFF
GO
 CREATE PROCEDURE [dbo].[AALATAMActivateApply]   @DSTSQNUMIn as int,  @APTVCHNMIn as char(21),  @APTODCTYIn as smallint,  @CRDTAMNTIn as numeric(19,5),  @DEBITAMTIn as numeric(19,5),  @SPCLDISTIn as smallint,  @DSTINDXIn as int,  @DISTTYPEIn as smallint,  @CURNCYIDIn as char(15),  @ORCRDAMTIn as numeric(19,5),  @ORDBTAMTIn as numeric(19,5),  @CURRNIDXIn as smallint,  @PSTGDATEIn as datetime,  @bFoundRec as int out,  @bDeleteRec as int out,  @LastDistID as int out,   @HdrID as int,  @InterCompId as char(15),  @VendID as char(15),  @RateTypeId as char(15),  @ExTabId as char(15),  @ExRate as numeric(19,7),  @ExDate as datetime,  @Time as datetime,  @RateCalcMethod as smallint,  @DenExRate as numeric(19,7),  @MCTrans as smallint,  @Range as int  AS  DECLARE  @Ingreso_Type as char(21),  @Ingreso_Num as char(21),   @aagGetHdrID as int,   @aagGetHdrID1 as int,  @APTVCHNM as char(21),  @SPCLDIST as smallint,  @DSTSQNUM as int,  @APTODCTY as smallint,  @CRDTAMNT as numeric(19,5),  @DEBITAMT as numeric(19,5),  @DSTINDX  as int,  @DISTTYPE as smallint,  @CURNCYID as char(15),  @ORCRDAMT as numeric(19,5),  @ORDBTAMT as numeric(19,5),  @CURRNIDX as int,   @PSTGDATE as datetime,  @TotRec as int,  @nCounter as int ,   @aaSubLedgerHdrID as int,  @aaSubLedgerDistID as int,  @INTERID as char(5),  @CorrespondingUnit as char(5),  @ACTINDX as int,  @DISTTYPE1 as int,  @ACCTTYPE as int,  @aaBrowseType as int,  @DECPLACS as int,  @DEBITAMT1 as numeric(19,5),  @CRDTAMNT1 as numeric(19,5),  @ORDBTAMT1 as numeric(19,5),  @ORCRDAMT1 as numeric(19,5),  @CURNCYID1 as char(15),  @CURRNIDX1 as int,  @RATETPID as char(15),  @EXGTBLID as char(15),  @XCHGRATE as numeric(19,7),  @EXCHDATE as datetime,  @TIME1 as datetime,  @RTCLCMTD as int,  @DENXRATE as numeric(19,7),  @MCTRXSTT as int,  @SEQNUMBR as int,  @GLPOSTDT as datetime,  @aaCustID as char(15),  @aaVendID as char(15),  @aaSiteID as char(11),  @aaItemID as char(31),  @aaCopyStatus as smallint,  @aaWinWasOpen as tinyint,  @POSTED as tinyint,  @HISTORY as tinyint,  @aaDistErrors as binary,  @APTVCHNM1 as char(21),  @APTODCTY1 as smallint,  @aaFutureDist as int,  @aaOffsetAcct as tinyint,  @ITEMNMBR as char(31),  @TRXLOCTN as char(11),  @BINNMBR as char(21),  @TRNSTLOC as char(11),  @TRXQTY as numeric(19,5),  @aaChangeDate as datetime,  @aaChangeTime as datetime,  @DEX_ROW_ID as int,  @MaxaaSubLedgerHdrID as int,  @aaMaxSubLedgerDistID as int,  @aaMinSubLedgerDistID as int,  @aaSubLedgerAssignID as int,  @aaTrxDimID as int,  @aaTrxCodeID as int,  @noteindx as numeric(19,5),  @IMPORTE  as numeric(19,5),  @nStatus as int,  @GLACCTTYPE as smallint,  @IN_ActClassID as int,  @IN_BrowseType as smallint,  @DECPLCUR as int  BEGIN  set @bFoundRec = 0  set  @bDeleteRec = 0  IF @Range = 1  BEGIN  DECLARE AAGHdr CURSOR FOR  SELECT aaSubLedgerHdrID ,aaSubLedgerDistID,INTERID,CorrespondingUnit,ACTINDX,DISTTYPE,ACCTTYPE,aaBrowseType,  DECPLACS,CRDTAMNT,DEBITAMT,ORCRDAMT,ORDBTAMT,CURNCYID,CURRNIDX,RATETPID,EXGTBLID  ,XCHGRATE,EXCHDATE,TIME1,RTCLCMTD,DENXRATE,MCTRXSTT,SEQNUMBR,GLPOSTDT,aaCustID,aaVendID,aaSiteID,aaItemID,  aaCopyStatus,aaWinWasOpen,POSTED ,HISTORY,aaDistErrors,APTVCHNM,APTODCTY,aaFutureDist,aaOffsetAcct,  ITEMNMBR,TRXLOCTN,BINNMBR,TRNSTLOC,TRXQTY,aaChangeDate,aaChangeTime,DEX_ROW_ID from AAG20001 where aaSubLedgerHdrID = @HdrID   OPEN AAGHdr   FETCH NEXT FROM AAGHdr INTO @aaSubLedgerHdrID ,@aaSubLedgerDistID,@INTERID,@CorrespondingUnit,@ACTINDX,@DISTTYPE1,@ACCTTYPE,@aaBrowseType,  @DECPLACS,@CRDTAMNT1,@DEBITAMT1,@ORCRDAMT1,@ORDBTAMT1,@CURNCYID1,@CURRNIDX1,@RATETPID,@EXGTBLID  ,@XCHGRATE,@EXCHDATE,@TIME1,@RTCLCMTD,@DENXRATE,@MCTRXSTT,@SEQNUMBR,@GLPOSTDT,@aaCustID,@aaVendID,@aaSiteID,@aaItemID,  @aaCopyStatus,@aaWinWasOpen,@POSTED,@HISTORY,@aaDistErrors,@APTVCHNM1,@APTODCTY1,@aaFutureDist,@aaOffsetAcct,  @ITEMNMBR,@TRXLOCTN,@BINNMBR,@TRNSTLOC,@TRXQTY,@aaChangeDate,@aaChangeTime,@DEX_ROW_ID  WHILE @@FETCH_STATUS = 0  BEGIN  set @LastDistID = @aaSubLedgerDistID   IF @DSTSQNUMIn = @SEQNUMBR AND @APTVCHNMIn = @APTVCHNM1 AND @APTODCTYIn = @APTODCTY1  BEGIN  IF @CRDTAMNTIn = @CRDTAMNT1 AND @DEBITAMTIn = @DEBITAMT1  set @bFoundRec = 1  ELSE  set @bDeleteRec = 1  BREAK  END   FETCH NEXT FROM AAGHdr INTO @aaSubLedgerHdrID ,@aaSubLedgerDistID,@INTERID,@CorrespondingUnit,@ACTINDX,@DISTTYPE1,@ACCTTYPE,@aaBrowseType,  @DECPLACS,@CRDTAMNT1,@DEBITAMT1,@ORCRDAMT1,@ORDBTAMT1,@CURNCYID1,@CURRNIDX1,@RATETPID,@EXGTBLID  ,@XCHGRATE,@EXCHDATE,@TIME1,@RTCLCMTD,@DENXRATE,@MCTRXSTT,@SEQNUMBR,@GLPOSTDT,@aaCustID,@aaVendID,@aaSiteID,@aaItemID,  @aaCopyStatus,@aaWinWasOpen,@POSTED,@HISTORY,@aaDistErrors,@APTVCHNM1,@APTODCTY1,@aaFutureDist,@aaOffsetAcct,  @ITEMNMBR,@TRXLOCTN,@BINNMBR,@TRNSTLOC,@TRXQTY,@aaChangeDate,@aaChangeTime,@DEX_ROW_ID  END  CLOSE AAGHdr   DEALLOCATE AAGHdr   END   IF @Range = 0  BEGIN  SELECT @GLACCTTYPE = ACCTTYPE FROM GL00100 where ACTINDX = @DSTINDXIn   EXEC aagGetClassIDBrowseType @DSTINDXIn,@IN_ActClassID,@IN_BrowseType   SELECT @DECPLCUR=DECPLCUR from DYNAMICS..MC40200 where CURNCYID=@CURNCYIDIn   INSERT INTO dbo.AAG20001(aaSubLedgerHdrID,aaSubLedgerDistID   ,INTERID ,CorrespondingUnit,ACTINDX ,DISTTYPE,ACCTTYPE ,aaBrowseType   ,DECPLACS,DEBITAMT,CRDTAMNT,ORDBTAMT,ORCRDAMT,CURNCYID   ,CURRNIDX,RATETPID,EXGTBLID,XCHGRATE,EXCHDATE,TIME1   ,RTCLCMTD,DENXRATE,MCTRXSTT,SEQNUMBR,GLPOSTDT,aaCustID   ,aaVendID,aaSiteID,aaItemID,aaCopyStatus,aaWinWasOpen,POSTED   ,HISTORY,aaDistErrors,APTVCHNM,APTODCTY,aaFutureDist,aaOffsetAcct   ,ITEMNMBR,TRXLOCTN ,BINNMBR,TRNSTLOC,TRXQTY   ,aaChangeDate   ,aaChangeTime)   VALUES   (@HdrID,@LastDistID,@InterCompId,'',@DSTINDXIn,@DISTTYPEIn,@GLACCTTYPE,2,   @DECPLCUR,@DEBITAMTIn,@CRDTAMNTIn,@ORDBTAMTIn,@ORCRDAMTIn,@CURNCYIDIn,@CURRNIDXIn,@RateTypeId,@ExTabId   ,@ExRate,@ExDate,@Time,@RateCalcMethod,@DenExRate,@MCTrans,@DSTSQNUMIn,   @PSTGDATEIn,'' ,@VendID ,''   ,'',8,0   ,0,0,0,@APTVCHNMIn,@APTODCTYIn,0,0,'','','','',0,'','')  END END    
GO
GRANT EXECUTE ON  [dbo].[AALATAMActivateApply] TO [DYNGRP]
GO
