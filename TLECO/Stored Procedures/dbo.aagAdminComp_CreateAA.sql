SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO
 CREATE PROCEDURE [dbo].[aagAdminComp_CreateAA]  @Batch_numbr as char(20), @User as char(30),  @cmpid int, @datee as datetime  AS  DECLARE @DocNumbr_memo as char(21),  @DocNumbr_memoold  as char(21), @Docnumbr as char(21),  @Accindx as int,  @aagGetHdrID as int,  @aagGetDistID as int,  @dbtamt as numeric(19,5),  @crtamt as numeric(19,5),  @ordbtamt as numeric(19,5),  @orcrtamt as numeric(19,5), @bachtotal as numeric(19,5),  @cuncyid as char(15), @Currncy as char(15),  @curnindx as int,  @distyp as int,  @seqno as int ,  @i as int,  @intrid as char(5),  @decplcs as smallint,  @xchgrate as numeric(19,7),  @ratcalc as smallint, @ratetypid  as char(15), @exgtablid  as char(15), @denxrate as numeric(19,7),  @mctrxstat as smallint,  @aacustid as char(15),  @aavenid as char(15),  @aasiteid as char(11),  @aaitemid as char(31),  @aacpystus as smallint,  @noteindx as numeric(19,5),  @rec as int,  @actindx as int,  @aatrxdimid as int,  @aatrxdimdflt as int, @flag  as int, @aaSubLedDistID as int, @aagGetGLWHdrID as int, @aagGetGLHdrID as int, @aagNextGLID as int, @aaGLWorkDistID as int, @aaSubLedgerAssignID as int, @aaGLHdrID  as int, @aaGLDistID as int, @V_HdrID as int, @V_TrimID as int, @year1 as int, @aatrxsrc as char(15), @aaGLTRXSource as char(13), @aaGLTRXSrc as char(13),  @GLPOSTDT as datetime, @NUMOFTRX as int, @Text as char(1000), @dat as char(20), @actdescr as char(51), @BCHTOTAL as numeric(9,5), @ACCTTYPE as int, @seq as int,  @SOURCDOC as char(11),  @actnumst as char(129), @aatrxdimcode as int, @aatrxdimid1 as int, @aatrxdimcode1 as int, @aaSubLedgerHdrID01 as int, @aaSubLedgerDistID01 as int, @DEBITAMT01 as numeric(19,5), @CREDITAMT01 as numeric(19,5), @ORDBTMAT as numeric(19,5), @ORCRTMAT as numeric(19,5), @PER as int, @asinID as int, @aaGLAssignID as int, @ACCTTYPE002 as int, @ACCTTYPE003 as int, @counter as int, @Exec_StrM as char(2000)  BEGIN  select @intrid=INTERID from DYNAMICS..SY01500 where CMPANYID=@cmpid set @i=0 set @seq=0 set @flag=0  set @asinID = 0 set @counter=0  Delete from AAG50000 Delete from AAG50001 Delete from AAG50002 Delete from GL50101  set @Exec_StrM='' set @Exec_StrM='DECLARE Docnm_Cursor CURSOR FOR  Select VCHRNMBR from nsaTW_PM10000 where BACHNUMB = ''' + @Batch_numbr +'''' + 'OPEN Docnm_Cursor' Exec (@Exec_StrM)  FETCH NEXT FROM Docnm_Cursor INTO @DocNumbr_memo  WHILE @@FETCH_STATUS = 0  BEGIN   EXEC DYNAMICS..aagGetNextID 30000,@cmpid,@aaGLHdrID output,0  EXEC DYNAMICS..aagGetNextID 20000,@cmpid,@aagGetHdrID output,0  set @Exec_StrM='' set @Exec_StrM='DECLARE Or_Docnm_Cursor CURSOR FOR  Select APFVCHNM from nsaWW_PM00100 where APTVCHNM = ''' + @DocNumbr_memo +'''' + 'OPEN Or_Docnm_Cursor' Exec (@Exec_StrM)  FETCH NEXT FROM Or_Docnm_Cursor INTO @Docnumbr   WHILE @@FETCH_STATUS = 0  BEGIN select @aagNextGLID = JRNENTRY from [dbo].GL10000 where DTAControlNum = @DocNumbr_memo  set @Exec_StrM='' set @Exec_StrM='DECLARE aaDist_Cursor CURSOR FOR  Select DSTINDX from PM10100 where VCHRNMBR = ''' + @DocNumbr_memo +'''' + 'OPEN aaDist_Cursor' Exec (@Exec_StrM)  FETCH NEXT FROM aaDist_Cursor INTO @Accindx  WHILE @@FETCH_STATUS = 0  BEGIN  SET @i = @i + 1  SET @seqno =@i*16384   select @aagGetDistID = isnull(max(aaSubLedgerDistID),0) + 1 from AAG20001   where aaSubLedgerHdrID = @aagGetHdrID select @aaGLDistID = isnull(max(aaGLDistID),0) + 1 from AAG30001   where aaGLHdrID = @aaGLHdrID   select @aavenid=VENDORID,@distyp=DISTTYPE,@dbtamt=DEBITAMT,@crtamt=CRDTAMNT,@cuncyid=CURNCYID,@curnindx=CURRNIDX,@orcrtamt=ORCRDAMT,@ordbtamt=ORDBTAMT from PM10100 where VCHRNMBR= @DocNumbr_memo and DSTINDX= @Accindx  IF (select AUTPSTGL from SY02300 where SERIES=4 and TRXSOURC in(select TRANSVAL from DYNAMICS..SY05300 where UNTRSVAL='Payables Trx Entry'))=1   select @intrid=INTERID,@decplcs=DECPLACS,@ratetypid=RATETPID,@exgtablid=EXGTBLID,@xchgrate=XCHGRATE,@ratcalc=RTCLCMTD,@denxrate=DENXRATE,@mctrxstat=MCTRXSTT,   @aacustid=aaCustID,@aavenid=aaVendID ,@aasiteid=aaSiteID,@aaitemid=aaItemID,@aacpystus=aaCopyStatus from AAG20001   where aaSubLedgerHdrID in(select aaSubLedgerHdrID from AAG20000 where  DOCNUMBR=@Docnumbr)  ELSE BEGIN  Select @cuncyid=CURNCYID,@curnindx=CURRNIDX,@exgtablid=EXGTBLID,@ratetypid=RATETPID,@xchgrate=XCHGRATE,@ratcalc=RTCLCMTD,@denxrate=DENXRATE,@mctrxstat=MCTRXSTT   from GL10000 where DTAControlNum=@Docnumbr  Select Top 1 @decplcs=DECPLACS,@aacpystus=aaCopyStatus from AAG10001 where aaGLWorkHdrID in (Select aaGLWorkHdrID from AAG10000 where JRNENTRY in(select JRNENTRY from GL10000 where DTAControlNum=@Docnumbr)             )  END  if (select count(*) from AAG20000 where aaSubLedgerHdrID=@aagGetHdrID or DOCNUMBR=@DocNumbr_memo)=0  BEGIN  Insert into [dbo].[AAG20000] values (@aagGetHdrID,4,0,@DocNumbr_memo,'',0,0)  if (SUBSTRING ( @DocNumbr_memo, 1, 5 ))='NCTAX' BEGIN UPDATE  AAG20000 set [DOCTYPE]=0 where aaSubLedgerHdrID=@aagGetHdrID and [DOCNUMBR]=@DocNumbr_memo END if (SUBSTRING ( @DocNumbr_memo, 1, 5 ))='NDTAX' BEGIN UPDATE  AAG20000 set [DOCTYPE]=0 where aaSubLedgerHdrID=@aagGetHdrID and [DOCNUMBR]=@DocNumbr_memo END END  if (Select Count(*) from [AAG50000] where [aaSubLedgerHdrID]=@aagGetHdrID and DOCNUMBR = @DocNumbr_memo)=0  INSERT INTO [AAG50000]   ([USERID],[TRXBTCHSRC],[aaSubLedgerHdrID]   ,[SERIES],[DOCTYPE],[DOCNUMBR] ,[PSTGDATE]   ,[aaOrder])  VALUES   (@User,@Batch_numbr,@aagGetHdrID,4   ,3,@DocNumbr_memo,@datee,1) if (SUBSTRING ( @DocNumbr_memo, 1, 5 ))='NCTAX'  BEGIN  UPDATE  AAG50000 set [DOCTYPE]=0 where aaSubLedgerHdrID=@aagGetHdrID and [DOCNUMBR]=@DocNumbr_memo  END if (SUBSTRING ( @DocNumbr_memo, 1, 5 ))='NDTAX'  BEGIN  UPDATE  AAG50000 set [DOCTYPE]=0 where aaSubLedgerHdrID=@aagGetHdrID and [DOCNUMBR]=@DocNumbr_memo  END if (Select Count(*) from [AAG50001] where [aaSubLedgerHdrID]=@aagGetHdrID and [aaSubLedgerDistID]=@aagGetDistID)=0 INSERT INTO [AAG50001]  ([USERID],[TRXBTCHSRC],[SERIES],[aaSubLedgerHdrID]  ,[aaSubLedgerDistID],[ACTINDX],[DEBITAMT]  ,[CRDTAMNT],[ORDBTAMT],[ORCRDAMT],[CURNCYID]  ,[CURRNIDX],[POSTED]) VALUES  (@User,@Batch_numbr,3,@aagGetHdrID  ,@aagGetDistID,@Accindx,@dbtamt,@crtamt  ,@ordbtamt,@orcrtamt,@cuncyid,@curnindx  ,1)  SELECT  @ACCTTYPE002 = ACCTTYPE FROM GL00100 WHERE ACTINDX=@Accindx INSERT INTO [dbo].[AAG20001]([aaSubLedgerHdrID],[aaSubLedgerDistID]   ,[INTERID] ,[CorrespondingUnit],[ACTINDX] ,[DISTTYPE],[ACCTTYPE] ,[aaBrowseType]   ,[DECPLACS],[DEBITAMT],[CRDTAMNT],[ORDBTAMT],[ORCRDAMT],[CURNCYID]   ,[CURRNIDX],[RATETPID],[EXGTBLID],[XCHGRATE],[EXCHDATE],[TIME1]   ,[RTCLCMTD],[DENXRATE],[MCTRXSTT],[SEQNUMBR],[GLPOSTDT],[aaCustID]   ,[aaVendID],[aaSiteID],[aaItemID],[aaCopyStatus],[aaWinWasOpen],[POSTED]   ,[HISTORY],[aaDistErrors],[APTVCHNM],[APTODCTY],[aaFutureDist],[aaOffsetAcct]   ,[ITEMNMBR],[TRXLOCTN] ,[BINNMBR],[TRNSTLOC],[TRXQTY]   ,[aaChangeDate]   ,[aaChangeTime])   VALUES   (@aagGetHdrID,@aagGetDistID,isnull(@intrid,''),'',@Accindx,@distyp   ,@ACCTTYPE002,1,isnull(@decplcs,1),@dbtamt,@crtamt,@ordbtamt,@orcrtamt,@cuncyid,@curnindx,isnull(@ratetypid,''),isnull(@exgtablid,'')   ,isnull(@xchgrate,0),'','',isnull(@ratcalc,0),isnull(@denxrate,0),isnull(@mctrxstat,0),@seqno   ,'',isnull(@aacustid,'') ,isnull(@aavenid,''),isnull(@aasiteid,'')   ,isnull(@aaitemid,''),isnull(@aacpystus,0),1   ,1,0,0,'',0,0,0,'','','','',0,''   ,'')   select @noteindx = isnull(max(NOTEINDX),0) + 1 from AAG20002  INSERT INTO [dbo].[AAG20002]([aaSubLedgerHdrID],[aaSubLedgerDistID],[aaSubLedgerAssignID]   ,[DEBITAMT],[CRDTAMNT],[ORDBTAMT],[ORCRDAMT]   ,[aaAssignedPercent],[DistRef],[NOTEINDX],[aaAssignErrors])   VALUES   (@aagGetHdrID,@aagGetDistID,1,@dbtamt,@crtamt,@ordbtamt,@orcrtamt   ,10000,'',@noteindx + 1 ,0) if (Select Count(*) from [AAG50002] where [aaSubLedgerHdrID]=@aagGetHdrID and [aaSubLedgerDistID]=@aagGetDistID)=0  INSERT INTO [AAG50002]  ([USERID],[TRXBTCHSRC],[aaSubLedgerHdrID],[aaSubLedgerDistID]  ,[aaSubLedgerAssignID],[SERIES],[DEBITAMT]  ,[CRDTAMNT],[ORDBTAMT],[ORCRDAMT]  ,[DistRef])  VALUES  (@User,@Batch_numbr,@aagGetHdrID,@aagGetDistID  ,1,3,@dbtamt,@crtamt,@ordbtamt,@orcrtamt  ,'')  if (Select count(*) from SY00500 where BACHNUMB=@Batch_numbr)=0 BEGIN  INSERT INTO [SY00500]  ([GLPOSTDT],[BCHSOURC],[BACHNUMB],[SERIES],[MKDTOPST],[NUMOFTRX]  ,[RECPSTGS],[DELBACH],[MSCBDINC],[BACHFREQ],[RCLPSTDT],[NOFPSTGS]  ,[BCHCOMNT],[BRKDNALL],[CHKSPRTD],[RVRSBACH],[USERID]  ,[CHEKBKID],[BCHTOTAL],[BCHEMSG1],[BCHEMSG2],[BACHDATE]  ,[BCHSTRG1],[BCHSTRG2],[POSTTOGL],[MODIFDT],[CREATDDT]  ,[NOTEINDX],[CURNCYID],[BCHSTTUS],[CNTRLTRX],[CNTRLTOT]  ,[PETRXCNT],[APPROVL],[APPRVLDT],[APRVLUSERID],[ORIGIN]  ,[ERRSTATE],[GLBCHVAL],[Computer_Check_Doc_Date],[Sort_Checks_By]  ,[SEPRMTNC],[REPRNTED],[CHKFRMTS],[TRXSORCE],[PmtMethod]  ,[EFTFileFormat] ,[Workflow_Approval_Status]  ,[Workflow_Priority] ,[TIME1]) VALUES  ('' ,'GL_Normal',@Batch_numbr,3,1,1  ,0,0,0,0,'',0,'',0,0,0,@User,'',0,0  ,0,@datee,'','',1,'','',@noteindx,@cuncyid,0  ,0,0,0,0,'','',0,0,0,'',0,0,0,0,'',0  ,0,0,0,'') select @BCHTOTAL=[BCHTOTAL] from [SY00500] where BACHNUMB=@Batch_numbr and SERIES=4 update [SY00500] set [BCHTOTAL]= @BCHTOTAL + @crtamt + @dbtamt where BACHNUMB=@Batch_numbr and SERIES=4  END  DECLARE outer_aaCode CURSOR FOR  SELECT ACTINDX,aaSubLedgerDistID from AAG20001 where aaSubLedgerHdrID=@aagGetHdrID  OPEN outer_aaCode  FETCH NEXT FROM outer_aaCode INTO @actindx,@aaSubLedDistID  WHILE @@FETCH_STATUS = 0  BEGIN  SELECT @rec=count(*) from AAG00202 where aaAcctClassID in (Select aaAcctClassID from AAG00200 where ACTINDX=@actindx)  IF @rec > 0  BEGIN  DECLARE aaCode CURSOR FOR  SELECT aaTrxDimID,aaTrxDimCodeIDDflt from AAG00202 where aaAcctClassID in (Select aaAcctClassID from AAG00200 where ACTINDX=@actindx)   OPEN aaCode  FETCH NEXT FROM aaCode INTO @aatrxdimid,@aatrxdimdflt  WHILE @@FETCH_STATUS = 0  BEGIN  IF (select count(*) from AAG20003 where aaSubLedgerHdrID=@aagGetHdrID and aaSubLedgerDistID=@aaSubLedDistID and aaSubLedgerAssignID=1 and aaTrxDimID=@aatrxdimid)=0  INSERT INTO [dbo].[AAG20003]  ([aaSubLedgerHdrID],[aaSubLedgerDistID],[aaSubLedgerAssignID]  ,[aaTrxDimID],[aaTrxCodeID],[aaCodeErrors])  VALUES  (@aagGetHdrID,@aaSubLedDistID,1,@aatrxdimid,@aatrxdimdflt,0)  FETCH NEXT FROM aaCode INTO @aatrxdimid,@aatrxdimdflt  END  CLOSE aaCode  DEALLOCATE aaCode  END  FETCH NEXT FROM outer_aaCode INTO @actindx,@aaSubLedDistID  END  CLOSE outer_aaCode  DEALLOCATE outer_aaCode  Select @aaGLTRXSource = ORTRXSRC from GL10000 where DTAControlNum= @DocNumbr_memo  IF (select AUTPSTGL from SY02300 where SERIES=4 and TRXSOURC in(select TRANSVAL from DYNAMICS..SY05300 where UNTRSVAL='Payables Trx Entry'))=2  BEGIN  if (select count(*) from AAG30000 where [JRNENTRY]=@aagNextGLID)=0  BEGIN  IF (select count(*) from AAG30000 where  aaGLHdrID=@aaGLHdrID )=0  BEGIN  INSERT INTO [AAG30000]  ([aaGLHdrID],[JRNENTRY],[RCTRXSEQ],[YEAR1]  ,[aaTRXType],[aaGLTRXSource],[aaTRXSource]  ,[GLPOSTDT]) VALUES  (@aaGLHdrID,@aagNextGLID,0,0,1,@aaGLTRXSource,''  ,'') END END  select @GLPOSTDT=[GLPOSTDT],@year1=[YEAR1],@aaGLTRXSrc=[aaGLTRXSource],@aatrxsrc=[aaTRXSource] from [dbo].[AAG30000] where aaGLHdrID= @aaGLHdrID and JRNENTRY=@aagNextGLID   if (select AUTPSTGL from SY02300 where SERIES=4 and TRXSOURC in(select TRANSVAL from DYNAMICS..SY05300 where UNTRSVAL='Payables Trx Entry'))=0  BEGIN  Select  @ACCTTYPE003 = ACCTTYPE from GL00100 where ACTINDX=@Accindx INSERT INTO [dbo].[AAG30001]  ([aaGLHdrID],[aaGLDistID],[INTERID],[CorrespondingUnit]  ,[ACTINDX],[ACCTTYPE],[aaBrowseType],[DECPLACS],[DEBITAMT]  ,[CRDTAMNT],[ORDBTAMT],[ORCRDAMT],[CURNCYID],[CURRNIDX]  ,[RATETPID],[EXGTBLID],[XCHGRATE],[EXCHDATE],[TIME1]  ,[RTCLCMTD],[DENXRATE],[MCTRXSTT],[SEQNUMBR]  ,[aaCustID],[aaVendID],[aaSiteID],[aaItemID],[aaCopyStatus]  ,[aaChangeDate],[aaChangeTime])  VALUES  (@aaGLHdrID,@aaGLDistID,isnull(@intrid,''),'',@Accindx,@ACCTTYPE003,1,isnull(@decplcs,2)  ,@dbtamt,@crtamt,@ordbtamt,@orcrtamt,@cuncyid,@curnindx,isnull(@ratetypid,'')  ,isnull(@exgtablid,''),isnull(@xchgrate,0),'' ,'',isnull(@ratcalc,0),isnull(@denxrate,0),isnull(@mctrxstat,0),@seqno,isnull(@aacustid,'')  ,isnull(@aavenid,'') ,isnull(@aasiteid,''),isnull(@aaitemid,''),isnull(@aacpystus,0),'','') END Select  @actnumst=ACTNUMST from GL00105 where ACTINDX=@Accindx Select  @actdescr=ACTDESCR ,@ACCTTYPE = ACCTTYPE from GL00100 where ACTINDX=@Accindx set @seq = @seq + 16384 INSERT INTO [GL50101]  (USERID,BCHSOURC,BACHNUMB,JRNENTRY,SQNCLINE,ACTINDX,OFFINDX,GLLINMSG,GLLINMS2  ,TRXDATE,ACCTTYPE,DSCRIPTN,CURNCYID,CURRNIDX,FUNCRIDX,INTERID,ACTNUMST  ,ACTDESCR,CRDTAMNT,DEBITAMT,ORCRDAMT,ORDBTAMT,ORCTRNUM,ORDOCNUM,ORMSTRID,ORMSTRNM  ,ORTRXTYP,MCTRXSTT,XCHGRATE,DENXRATE)  VALUES  (@User,'GL_Normal',@Batch_numbr,@aagNextGLID,@seq,@actindx,0,0,0,'',@ACCTTYPE,'',@cuncyid,@curnindx,@curnindx,  isnull(@intrid,''),@actnumst,@actdescr,@crtamt,@dbtamt,@orcrtamt,@ordbtamt,@DocNumbr_memo,@DocNumbr_memo,'',''  ,0,isnull(@mctrxstat,0),isnull(@xchgrate,0),isnull(@denxrate,0))  Select @Currncy=[CURNCYID] from [AAG30001] where [aaGLHdrID]=@aaGLHdrID  if (select AUTPSTGL from SY02300 where SERIES=4 and TRXSOURC in(select TRANSVAL from DYNAMICS..SY05300 where UNTRSVAL='Payables Trx Entry'))=0 BEGIN  if (Select Count(*) from AAG30002 where [aaGLHdrID]=@aaGLHdrID and [aaGLDistID]=@aaGLDistID)=0 BEGIN INSERT INTO [dbo].[AAG30002]  ([aaGLHdrID],[aaGLDistID],[aaGLAssignID],[DEBITAMT]  ,[CRDTAMNT],[ORDBTAMT],[ORCRDAMT],[aaAssignedPercent]  ,[DistRef],[NOTEINDX]) VALUES  (@aaGLHdrID ,@aaGLDistID,1,@dbtamt,@crtamt,@ordbtamt,@orcrtamt  ,10000,'',@noteindx) END  END   select @SOURCDOC=SOURCDOC from GL20000 where ORDOCNUM=@Docnumbr if (Select Count(*) from [GL10000] where [JRNENTRY]= @aagNextGLID)=0 BEGIN Select  @actnumst=ACTNUMST from GL00105 where ACTINDX=@Accindx Select  @actdescr=ACTDESCR ,@ACCTTYPE = ACCTTYPE from GL00100 where ACTINDX=@Accindx  INSERT INTO [GL50102]  ([JRNENTRY],[TRXSORCE],[USERID],[BACHNUMB]  ,[BCHSOURC],[RVTRXSRC]) VALUES  (@aagNextGLID,'',@User ,@Batch_numbr,'','') END  update  GL50101 set TRXDATE = getdate() where BACHNUMB=@Batch_numbr  DECLARE outer_aaCode30003 CURSOR FOR  SELECT ACTINDX,aaGLDistID from AAG30001 where aaGLHdrID =@aaGLHdrID OPEN outer_aaCode30003  FETCH NEXT FROM outer_aaCode30003 INTO @actindx,@aaGLDistID  WHILE @@FETCH_STATUS = 0  BEGIN  SELECT @rec=count(*) from AAG00202 where aaAcctClassID in (Select aaAcctClassID from AAG00200 where ACTINDX=@actindx)  IF @rec > 0  BEGIN  DECLARE aaCode30003 CURSOR FOR  SELECT aaTrxDimID,aaTrxDimCodeIDDflt from AAG00202 where aaAcctClassID in (Select aaAcctClassID from AAG00200 where ACTINDX=@actindx)   OPEN aaCode30003  FETCH NEXT FROM aaCode30003 INTO @aatrxdimid,@aatrxdimdflt  WHILE @@FETCH_STATUS = 0  BEGIN  IF (select count(*) from AAG30003 where aaGLHdrID=@aaGLHdrID and aaGLDistID=@aaGLDistID and aaGLAssignID=1 and aaTrxDimID=@aatrxdimid)=0   INSERT INTO [dbo].[AAG30003]  ([aaGLHdrID],[aaGLDistID],[aaGLAssignID],[aaTrxDimID]  ,[aaTrxCodeID])  VALUES  (@aaGLHdrID,@aaGLDistID,1,@aatrxdimid,@aatrxdimdflt)  FETCH NEXT FROM aaCode30003 INTO @aatrxdimid,@aatrxdimdflt  END  CLOSE aaCode30003  DEALLOCATE aaCode30003 END  FETCH NEXT FROM outer_aaCode30003 INTO @actindx,@aaGLDistID  END  CLOSE outer_aaCode30003  DEALLOCATE outer_aaCode30003 END  FETCH NEXT FROM aaDist_Cursor INTO @Accindx  END   CLOSE aaDist_Cursor  DEALLOCATE aaDist_Cursor  FETCH NEXT FROM Or_Docnm_Cursor INTO @Docnumbr  END  CLOSE Or_Docnm_Cursor  DEALLOCATE Or_Docnm_Cursor  FETCH NEXT FROM Docnm_Cursor INTO @DocNumbr_memo END  CLOSE Docnm_Cursor  DEALLOCATE Docnm_Cursor  set @Exec_StrM=''  set @Exec_StrM='Delete from nsaWW_PM70600 where nsaWW_Null=1' Exec (@Exec_StrM)  select @bachtotal=sum(CRDTAMNT) from GL50101 where BACHNUMB=@Batch_numbr  END    
GO
GRANT EXECUTE ON  [dbo].[aagAdminComp_CreateAA] TO [DYNGRP]
GO
