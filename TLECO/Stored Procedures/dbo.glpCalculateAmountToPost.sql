SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO
 create procedure [dbo].[glpCalculateAmountToPost]  @I_iAccountIndex          int              = NULL,  @I_sAccountType smallint  = NULL,   @I_sYear                  smallint         = NULL,  @I_sPeriodID              smallint         = NULL,  @I_nLedgerID              int           = NULL,  @I_sBalanceForCalc        smallint         = NULL,  @O_mAmount                numeric(19,5)    = NULL  output,  @O_iErrorState            int              = NULL  output as  declare  @POST_ACCT       smallint,  @UNIT_ACCT       smallint,  @tTransaction    tinyint,  @tLoop           tinyint  select   @O_mAmount      = 0.0,  @O_iErrorState  = 0  if @@trancount = 0 begin  select @tTransaction = 1  begin transaction end   while (@tLoop is NULL) begin   select @tLoop = 1   if   @I_iAccountIndex   is NULL or  @I_sAccountType    is NULL or  @I_sYear           is NULL or   @I_sPeriodID       is NULL or  @I_nLedgerID       is NULL or  @I_sBalanceForCalc is NULL   begin  select @O_iErrorState = 20016  break  end   select  @POST_ACCT      = 1,  @UNIT_ACCT = 2   if @I_sAccountType <> @POST_ACCT and  @I_sAccountType <> @UNIT_ACCT   begin  select @O_iErrorState = 20806  break  end    if @I_sBalanceForCalc = 0  begin  select  @O_mAmount = sum(PERDBLNC)  from  GL10110  where  ACTINDX = @I_iAccountIndex   and     YEAR1 = @I_sYear  and     PERIODID <= @I_sPeriodID  and     Ledger_ID = @I_nLedgerID   end  else  begin  select  @O_mAmount = sum(PERDBLNC)  from  GL10110  where  ACTINDX = @I_iAccountIndex   and     YEAR1 = @I_sYear  and     PERIODID = @I_sPeriodID  and     Ledger_ID = @I_nLedgerID   end   if  @O_mAmount is NULL  select  @O_mAmount = 0.0  end   if @O_iErrorState <> 0 begin  if @tTransaction = 1  rollback transaction end else if @tTransaction = 1  commit transaction  return    
GO
GRANT EXECUTE ON  [dbo].[glpCalculateAmountToPost] TO [DYNGRP]
GO
