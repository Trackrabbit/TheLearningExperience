SET QUOTED_IDENTIFIER OFF
GO
SET ANSI_NULLS ON
GO
 create procedure [dbo].[svcCLServiceTrans]   @I_cUserID char(15)    = NULL,  @I_cUserDate char(12)    = NULL,  @I_cFunctionalCurrency char(15)    = NULL,  @I_ServiceMSTR  varchar(40) = NULL,  @I_ServiceLine varchar(40) = NULL,  @I_ServiceInvoice varchar(40) = NULL,  @I_ServiceDist  varchar(40) = NULL,  @I_ServiceEquip  varchar(40) = NULL,  @I_ServiceCodes  varchar(40) = NULL,  @I_ServiceTechs  varchar(40) = NULL,  @I_ServiceLineDist varchar(40) = NULL,  @I_ServiceAudit varchar(40) = NULL,  @I_ServiceLineSerial varchar(40) = NULL,  @I_ServiceLineBin  varchar(40) = NULL,  @I_ServiceEscAudit  varchar(40) = NULL,  @I_ServiceTask  varchar(40) = NULL,  @O_iErrorState int  = NULL output as  declare  @iError int,   @iStatus int,   @cSearchString1 char(2),  @tLoop tinyint  select  @O_iErrorState = 0,  @iStatus  = 0,  @cSearchString1 = '%1'  while (@tLoop is NULL) begin  select @tLoop = 1   if   @I_cUserID is NULL OR  @I_ServiceMSTR is NULL OR  @I_ServiceLine  is NULL OR  @I_ServiceInvoice is NULL OR  @I_ServiceDist  is NULL OR  @I_ServiceEquip is NULL OR  @I_ServiceCodes is NULL OR  @I_ServiceTechs  is NULL OR  @I_ServiceLineDist is NULL OR  @I_ServiceAudit  is NULL OR  @I_ServiceLineSerial  is NULL OR  @I_ServiceLineBin is NULL OR  @I_ServiceEscAudit  is NULL OR  @I_ServiceTask is NULL   begin  select @O_iErrorState = 20846  break  end   create table #CNTRLNUMTEMP(  CNTRLNUM varchar(30) not null,  DOCTYPE smallint not null,  VENDORID varchar(40) not null )   delete from SVC00200 with (rowlock) where CALLNBR = ''   delete from SVC00203 with (rowlock) where LNITMSEQ = 0   insert into  #CNTRLNUMTEMP(  CNTRLNUM,  DOCTYPE,  VENDORID )  select   CALLNBR + '-' + rtrim(LINITMTYP) + '-' + CAST(CAST(LNITMSEQ AS int) AS varchar(6)),  1,  CAST(CAST(LNITMSEQ AS int) AS varchar(6))  from   SVC00203  where not exists  (select   1  from   SVC00200  where   SVC00203.SRVRECTYPE = SVC00200.SRVRECTYPE and   SVC00203.CALLNBR =SVC00200.CALLNBR) and SVC00203.SRVRECTYPE <> 0   if @@rowcount <> 0  begin  delete  SVC00203  where not exists  (select   1  from   SVC00200  where   SVC00203.SRVRECTYPE = SVC00200.SRVRECTYPE and   SVC00203.CALLNBR =SVC00200.CALLNBR)    exec @iStatus = smCreateErrorLogRecord  @I_cUserID,  @I_ServiceLine,  @cSearchString1,  11503,  @O_iErrorState output   select @iError = @@error   update SY03400 set ERMSGTX2 = 'No Corresponding record was found in the Service Call Master Table' where  FILENAME = @I_ServiceLine and ERMSGTX2 = ''  if @iStatus <> 0 or @O_iErrorState <> 0 or @iError <> 0  break  end    insert into  #CNTRLNUMTEMP(  CNTRLNUM, DOCTYPE, VENDORID)  select   CALLNBR + '-' + rtrim(ITEMNMBR),  1,  CAST(CAST(LNITMSEQ AS int) AS varchar(6))  from SVC00201 where not exists  (select 1 from SVC00200 where   SVC00201.SRVRECTYPE = SVC00200.SRVRECTYPE and   SVC00201.CALLNBR =SVC00200.CALLNBR)  if @@rowcount <> 0  begin  delete  SVC00201  where not exists  (select 1 from SVC00200 where   SVC00201.SRVRECTYPE = SVC00200.SRVRECTYPE and   SVC00201.CALLNBR =SVC00200.CALLNBR)    exec @iStatus = smCreateErrorLogRecord  @I_cUserID,  @I_ServiceCodes,  @cSearchString1,  11503,  @O_iErrorState output   select @iError = @@error   update SY03400 set ERMSGTX2 = 'No Corresponding record was found in the Service Call Master Table' where  FILENAME = @I_ServiceCodes and ERMSGTX2 = ''  if @iStatus <> 0 or @O_iErrorState <> 0 or @iError <> 0  break  end    insert into  #CNTRLNUMTEMP(  CNTRLNUM, DOCTYPE, VENDORID)  select   'Problem Code - ' + rtrim(PROBCDE),  1,  'Service Call: ' + CALLNBR  from SVC00201 where not exists  (select 1 from SVC00907 where   SVC00201.PROBCDE = SVC00907.PROBCDE) and PROBCDE > ''  if @@rowcount <> 0  begin   insert into  SVC00907(  PROBCDE, DSCRIPTN )  select   PROBCDE, PROBCDE  from SVC00201  where not exists  (select 1 from SVC00907  where SVC00201.PROBCDE = SVC00907.PROBCDE) and PROBCDE > '' group by PROBCDE   exec @iStatus = svcCreateErrorLogRecord  @I_cUserID,  @I_ServiceMSTR,  'Problem Code does not exist - record added.',  @O_iErrorState output   select @iError = @@error   if @iStatus <> 0 or @O_iErrorState <> 0 or @iError <> 0  break  end    insert into  #CNTRLNUMTEMP(  CNTRLNUM, DOCTYPE, VENDORID)  select   'Repair Code - ' + rtrim(RPRCODE),  1,  'Service Call: ' + CALLNBR  from SVC00201 where not exists  (select 1 from SVC00908 where   SVC00201.RPRCODE = SVC00908.RPRCODE) and RPRCODE > ''  if @@rowcount <> 0  begin   insert into  SVC00908(  RPRCODE, DSCRIPTN )  select   RPRCODE, RPRCODE  from SVC00201  where not exists  (select 1 from SVC00908  where SVC00201.RPRCODE = SVC00908.RPRCODE) and RPRCODE > '' group by RPRCODE   exec @iStatus = svcCreateErrorLogRecord  @I_cUserID,  @I_ServiceMSTR,  'Repair Code does not exist - record added.',  @O_iErrorState output   select @iError = @@error   if @iStatus <> 0 or @O_iErrorState <> 0 or @iError <> 0  break  end    insert into  #CNTRLNUMTEMP(  CNTRLNUM, DOCTYPE, VENDORID)  select   'Cause Code - ' + rtrim(CAUSECDE),  1,  'Service Call: ' + CALLNBR  from SVC00201 where not exists  (select 1 from SVC00901 where   SVC00201.CAUSECDE = SVC00901.CAUSECDE) and CAUSECDE > ''  if @@rowcount <> 0  begin   insert into  SVC00901(  CAUSECDE, DSCRIPTN )  select   CAUSECDE, CAUSECDE  from SVC00201  where not exists  (select 1 from SVC00901  where SVC00201.CAUSECDE = SVC00901.CAUSECDE) and CAUSECDE > '' group by CAUSECDE   exec @iStatus = svcCreateErrorLogRecord  @I_cUserID,  @I_ServiceMSTR,  'Cause Code does not exist - record added.',  @O_iErrorState output   select @iError = @@error   if @iStatus <> 0 or @O_iErrorState <> 0 or @iError <> 0  break  end    insert into  #CNTRLNUMTEMP(  CNTRLNUM,  DOCTYPE,  VENDORID )  select   CALLNBR + '-' + rtrim(ITEMNMBR),  1,  CAST(CAST(EQPLINE AS int) AS varchar(6))  from   SVC00202  where not exists  (select   1  from   SVC00200  where   SVC00202.SRVRECTYPE = SVC00200.SRVRECTYPE and   SVC00202.CALLNBR =SVC00200.CALLNBR)  if @@rowcount <> 0  begin  delete  SVC00202  where not exists  (select   1  from   SVC00200  where   SVC00202.SRVRECTYPE = SVC00200.SRVRECTYPE and   SVC00202.CALLNBR =SVC00200.CALLNBR)    exec @iStatus = smCreateErrorLogRecord  @I_cUserID,  @I_ServiceEquip,  @cSearchString1,  11503,  @O_iErrorState output   select @iError = @@error   update SY03400 set ERMSGTX2 = 'No Corresponding record was found in the Service Call Master Table' where  FILENAME = @I_ServiceEquip and ERMSGTX2 = ''  if @iStatus <> 0 or @O_iErrorState <> 0 or @iError <> 0  break  end    insert into  #CNTRLNUMTEMP(CNTRLNUM, DOCTYPE, VENDORID)  select   CALLNBR + '-' + TECHID,  1,  TECHID  from   SVC00207  where not exists  (select 1 from SVC00200 where   SVC00207.SRVRECTYPE = SVC00200.SRVRECTYPE and   SVC00207.CALLNBR =SVC00200.CALLNBR)  if @@rowcount <> 0  begin  delete  SVC00207  where not exists  (select 1 from SVC00200 where   SVC00207.SRVRECTYPE = SVC00200.SRVRECTYPE and   SVC00207.CALLNBR =SVC00200.CALLNBR)    exec @iStatus = smCreateErrorLogRecord  @I_cUserID,  @I_ServiceTechs,  @cSearchString1,  11503,  @O_iErrorState output   select @iError = @@error   update SY03400 set ERMSGTX2 = 'No Corresponding record was found in the Service Call Master Table' where  FILENAME = @I_ServiceTechs and ERMSGTX2 = ''  if @iStatus <> 0 or @O_iErrorState <> 0 or @iError <> 0  break  end    insert into  #CNTRLNUMTEMP(CNTRLNUM, DOCTYPE, VENDORID)  select   CALLNBR + '-' + TECHID,  1,  TECHID  from   SVC00207  where not exists  (select 1 from SVC00100 where   SVC00207.TECHID = SVC00100.TECHID)  if @@rowcount <> 0  begin  delete SVC00207  where not exists  (select 1 from SVC00100 where   SVC00207.TECHID = SVC00100.TECHID)   exec @iStatus = smCreateErrorLogRecord  @I_cUserID,  @I_ServiceTechs,  @cSearchString1,  11503,  @O_iErrorState output   select @iError = @@error   update SY03400 set ERMSGTX2 = 'No Corresponding record was found in the Technician Master Table' where  FILENAME = @I_ServiceTechs and ERMSGTX2 = ''  if @iStatus <> 0 or @O_iErrorState <> 0 or @iError <> 0  break  end    delete from SVC00210 where CALLNBR = ''  insert into  #CNTRLNUMTEMP(  CNTRLNUM,  DOCTYPE,  VENDORID )  select   CALLNBR +'-'+ rtrim(USERID)+ '-' + CAST(CAST(LNITMSEQ AS int) AS varchar(6)),  1,  CALLNBR  from   SVC00210  where not exists  (select   1  from   SVC00200  where   SVC00210.SRVRECTYPE = SVC00200.SRVRECTYPE and   SVC00210.CALLNBR =SVC00200.CALLNBR)   if @@rowcount <> 0  begin  delete  SVC00210  where not exists  (select   1  from   SVC00200  where   SVC00210.SRVRECTYPE = SVC00200.SRVRECTYPE and   SVC00210.CALLNBR =SVC00200.CALLNBR)    exec @iStatus = smCreateErrorLogRecord  @I_cUserID,  @I_ServiceAudit,  @cSearchString1,  11503,  @O_iErrorState output   select @iError = @@error   update SY03400 set ERMSGTX2 = 'No Corresponding record was found in the Service Call Master Table' where  FILENAME = @I_ServiceAudit and ERMSGTX2 = ''  if @iStatus <> 0 or @O_iErrorState <> 0 or @iError <> 0  break  end    insert into  #CNTRLNUMTEMP(  CNTRLNUM,  DOCTYPE,  VENDORID )  select   SVC_Task_Name,  1,  CALLNBR  from   SVC00211  where not exists  (select   1  from   SVC00200  where   SVC00211.SRVRECTYPE = SVC00200.SRVRECTYPE and   SVC00211.CALLNBR =SVC00200.CALLNBR)  if @@rowcount <> 0  begin  delete  SVC00211  where not exists  (select   1  from   SVC00200  where   SVC00211.SRVRECTYPE = SVC00200.SRVRECTYPE and   SVC00211.CALLNBR =SVC00200.CALLNBR)    exec @iStatus = smCreateErrorLogRecord  @I_cUserID,  @I_ServiceEscAudit,  @cSearchString1,  11503,  @O_iErrorState output   select @iError = @@error   update SY03400 set ERMSGTX2 = 'No Corresponding record was found in the Service Call Master Table' where  FILENAME = @I_ServiceEscAudit and ERMSGTX2 = ''  if @iStatus <> 0 or @O_iErrorState <> 0 or @iError <> 0  break  end    insert into  #CNTRLNUMTEMP(  CNTRLNUM,  DOCTYPE,  VENDORID )  select   CALLNBR + '-' + CAST(CAST(LNITMSEQ AS int) AS varchar(6))+ '-' + rtrim(BIN) ,  1,  CAST(CAST(LNITMSEQ AS int) AS varchar(6))  from   SVC00212  where not exists  (select   1  from   SVC00200  where   SVC00212.SRVRECTYPE = SVC00200.SRVRECTYPE and   SVC00212.CALLNBR =SVC00200.CALLNBR)  if @@rowcount <> 0  begin  delete  SVC00212  where not exists  (select   1  from   SVC00200  where   SVC00212.SRVRECTYPE = SVC00200.SRVRECTYPE and   SVC00212.CALLNBR =SVC00200.CALLNBR)    exec @iStatus = smCreateErrorLogRecord  @I_cUserID,  @I_ServiceLineBin,  @cSearchString1,  11503,  @O_iErrorState output   select @iError = @@error   update SY03400 set ERMSGTX2 = 'No Corresponding record was found in the Service Call Master Table' where  FILENAME = @I_ServiceLineBin and ERMSGTX2 = ''  if @iStatus <> 0 or @O_iErrorState <> 0 or @iError <> 0  break  end    insert into  #CNTRLNUMTEMP(  CNTRLNUM,  DOCTYPE,  VENDORID )  select   CALLNBR + '-' + SOPNUMBE,  1,  CALLNBR  from   SVC00220  where not exists  (select   1  from   SVC00200  where   SVC00220.SRVRECTYPE = SVC00200.SRVRECTYPE and   SVC00220.CALLNBR =SVC00200.CALLNBR)  if @@rowcount <> 0  begin  delete  SVC00220  where not exists  (select   1  from   SVC00200  where   SVC00220.SRVRECTYPE = SVC00200.SRVRECTYPE and   SVC00220.CALLNBR =SVC00200.CALLNBR)    exec @iStatus = smCreateErrorLogRecord  @I_cUserID,  @I_ServiceInvoice,  @cSearchString1,  11503,  @O_iErrorState output   select @iError = @@error   update SY03400 set ERMSGTX2 = 'No Corresponding record was found in the Service Call Master Table' where  FILENAME = @I_ServiceInvoice and ERMSGTX2 = ''  if @iStatus <> 0 or @O_iErrorState <> 0 or @iError <> 0  break  end    insert into  #CNTRLNUMTEMP(  CNTRLNUM,  DOCTYPE,  VENDORID )  select   CALLNBR + '- Act.Index:' + CAST(ACTINDX AS varchar(6)),  1,  CAST(SVC_Distribution_Type AS varchar(6))  from   SVC00230  where not exists  (select   1  from   SVC00200  where   SVC00230.SRVRECTYPE = SVC00200.SRVRECTYPE and   SVC00230.CALLNBR =SVC00200.CALLNBR)  if @@rowcount <> 0  begin  delete  SVC00230  where not exists  (select   1  from   SVC00200  where   SVC00230.SRVRECTYPE = SVC00200.SRVRECTYPE and   SVC00230.CALLNBR =SVC00200.CALLNBR)    exec @iStatus = smCreateErrorLogRecord  @I_cUserID,  @I_ServiceDist,  @cSearchString1,  11503,  @O_iErrorState output   select @iError = @@error   update SY03400 set ERMSGTX2 = 'No Corresponding record was found in the Service Call Master Table' where  FILENAME = @I_ServiceDist and ERMSGTX2 = ''  if @iStatus <> 0 or @O_iErrorState <> 0 or @iError <> 0  break  end    insert into  #CNTRLNUMTEMP(  CNTRLNUM,  DOCTYPE,  VENDORID )  select   CALLNBR + '- Act.Index:' + CAST(ACTINDX AS varchar(6)),  1,  CAST(SVC_Distribution_Type AS varchar(6))  from SVC00231 where not exists  (select 1 from SVC00200 where   SVC00231.SRVRECTYPE = SVC00200.SRVRECTYPE and   SVC00231.CALLNBR =SVC00200.CALLNBR)  if @@rowcount <> 0  begin  delete  SVC00231 where not exists  (select 1 from SVC00200 where   SVC00231.SRVRECTYPE = SVC00200.SRVRECTYPE and   SVC00231.CALLNBR =SVC00200.CALLNBR)    exec @iStatus = smCreateErrorLogRecord  @I_cUserID,  @I_ServiceLineDist,  @cSearchString1,  11503,  @O_iErrorState output   select @iError = @@error   update SY03400 set ERMSGTX2 = 'No Corresponding record was found in the Service Call Master Table' where  FILENAME = @I_ServiceLineDist and ERMSGTX2 = ''  if @iStatus <> 0 or @O_iErrorState <> 0 or @iError <> 0  break  end    insert into  #CNTRLNUMTEMP(  CNTRLNUM,  DOCTYPE,  VENDORID )  select   CALLNBR + '- Act.Index:' + CAST(ACTINDX AS varchar(6)),  1,  CAST(SVC_Distribution_Type AS varchar(6))  from SVC00231 where not exists  (select 1 from SVC00203 where   SVC00231.SRVRECTYPE = SVC00203.SRVRECTYPE and   SVC00231.CALLNBR =SVC00203.CALLNBR and  SVC00231.EQPLINE = SVC00203.EQPLINE and  SVC00231.LNITMSEQ = SVC00203.LNITMSEQ and  SVC00231.LINITMTYP = SVC00203.LINITMTYP)  if @@rowcount <> 0  begin  delete  SVC00231 where not exists  (select 1 from SVC00203 where   SVC00231.SRVRECTYPE = SVC00203.SRVRECTYPE and   SVC00231.CALLNBR =SVC00203.CALLNBR and  SVC00231.EQPLINE = SVC00203.EQPLINE and  SVC00231.LNITMSEQ = SVC00203.LNITMSEQ and  SVC00231.LINITMTYP = SVC00203.LINITMTYP)   exec @iStatus = smCreateErrorLogRecord  @I_cUserID,  @I_ServiceLineDist,  @cSearchString1,  11503,  @O_iErrorState output   select @iError = @@error   update SY03400 set ERMSGTX2 = 'No Corresponding record was found in the Service Call Line Detail Table' where  FILENAME = @I_ServiceLineDist and ERMSGTX2 = ''  if @iStatus <> 0 or @O_iErrorState <> 0 or @iError <> 0  break  end    insert into  #CNTRLNUMTEMP(  CNTRLNUM,  DOCTYPE,  VENDORID )  select   CALLNBR + '-' + rtrim(LINITMTYP) + '-' + CAST(CAST(LNITMSEQ AS int) AS varchar(6)),  1,  CAST(CAST(LNITMSEQ AS int) AS varchar(6))  from   SVC00250  where not exists  (select   1  from   SVC00200  where   SVC00250.SRVRECTYPE = SVC00200.SRVRECTYPE and   SVC00250.CALLNBR =SVC00200.CALLNBR)  if @@rowcount <> 0  begin  delete  SVC00250  where not exists  (select   1  from   SVC00200  where   SVC00250.SRVRECTYPE = SVC00200.SRVRECTYPE and   SVC00250.CALLNBR =SVC00200.CALLNBR)    exec @iStatus = smCreateErrorLogRecord  @I_cUserID,  @I_ServiceLineSerial,  @cSearchString1,  11503,  @O_iErrorState output   select @iError = @@error   update SY03400 set ERMSGTX2 = 'No Corresponding record was found in the Service Call Master Table' where  FILENAME = @I_ServiceLineSerial and ERMSGTX2 = ''  if @iStatus <> 0 or @O_iErrorState <> 0 or @iError <> 0  break  end   insert into  #CNTRLNUMTEMP(  CNTRLNUM,  DOCTYPE,  VENDORID )  select   CALLNBR + '-' + rtrim(SERLTNUM),  1,  CALLNBR  from SVC00250 where not exists  (select 1 from SVC00203 where   SVC00250.SRVRECTYPE = SVC00203.SRVRECTYPE and   SVC00250.CALLNBR =SVC00203.CALLNBR and  SVC00250.EQPLINE = SVC00203.EQPLINE and  SVC00250.LNITMSEQ = SVC00203.LNITMSEQ and  SVC00250.LINITMTYP = SVC00203.LINITMTYP)  if @@rowcount <> 0  begin  delete  SVC00250 where not exists  (select 1 from SVC00203 where   SVC00250.SRVRECTYPE = SVC00203.SRVRECTYPE and   SVC00250.CALLNBR =SVC00203.CALLNBR and  SVC00250.EQPLINE = SVC00203.EQPLINE and  SVC00250.LNITMSEQ = SVC00203.LNITMSEQ and  SVC00250.LINITMTYP = SVC00203.LINITMTYP)   exec @iStatus = smCreateErrorLogRecord  @I_cUserID,  @I_ServiceLineSerial,  @cSearchString1,  11503,  @O_iErrorState output   select @iError = @@error   update SY03400 set ERMSGTX2 = 'No Corresponding record was found in the Service Call Line Detail Table' where  FILENAME = @I_ServiceLineSerial and ERMSGTX2 = ''  if @iStatus <> 0 or @O_iErrorState <> 0 or @iError <> 0  break  end    insert into  #CNTRLNUMTEMP(  CNTRLNUM,  DOCTYPE,  VENDORID )  select   'Item - ' + rtrim(ITEMNMBR),  1,  'Service Call: '+ CALLNBR  from SVC00250 where not exists  (select 1 from IV00101 where   SVC00250.ITEMNMBR = IV00101.ITEMNMBR) and ITEMNMBR > ''  if @@rowcount <> 0  begin   exec @iStatus = svcCreateErrorLogRecord  @I_cUserID,  @I_ServiceLineSerial,  'Item Number on this Service Serial/Lot Work does not exist.',  @O_iErrorState output   select @iError = @@error  if @iStatus <> 0 or @O_iErrorState <> 0 or @iError <> 0  break  end    insert into  #CNTRLNUMTEMP(  CNTRLNUM,  DOCTYPE,  VENDORID )  select   CALLNBR + '-' + rtrim(SRVCCD) ,  1,  CALLNBR  from   SVC00240  where not exists  (select   1  from   SVC00200  where   SVC00240.SRVRECTYPE = SVC00200.SRVRECTYPE and   SVC00240.CALLNBR =SVC00200.CALLNBR)  if @@rowcount <> 0  begin  delete  SVC00240  where not exists  (select   1  from   SVC00200  where   SVC00240.SRVRECTYPE = SVC00200.SRVRECTYPE and   SVC00240.CALLNBR =SVC00200.CALLNBR)    exec @iStatus = smCreateErrorLogRecord  @I_cUserID,  @I_ServiceTask,  @cSearchString1,  11503,  @O_iErrorState output   select @iError = @@error   update SY03400 set ERMSGTX2 = 'No Corresponding record was found in the Service Call Master Table' where  FILENAME = @I_ServiceTask and ERMSGTX2 = ''  if @iStatus <> 0 or @O_iErrorState <> 0 or @iError <> 0  break  end    insert into  #CNTRLNUMTEMP(  CNTRLNUM,  DOCTYPE,  VENDORID )  select   'Service Entry',  5,  'Service Call: '+ CALLNBR  from   SVC00200  where SRVSTAT='' or SRVTYPE ='' or TAXSCHID = ''  or CUSTNMBR='' or ADRSCODE='' or TIMEZONE = '' or ENTDTE = ''   if @@rowcount <> 0  begin  exec @iStatus = svcCreateErrorLogRecord  @I_cUserID,  @I_ServiceMSTR,  'Required Fields are missing for this Service Call.',  @O_iErrorState output  update SY03400 set ERMSGTX2 = 'Please manually update the missing data on the call.' where  FILENAME = @I_ServiceMSTR and ERMSGTX2 = ''   select @iError = @@error   if @iStatus = 0 and @iError <> 0  select @iStatus = @iError  if @iStatus <> 0 or @O_iErrorState <> 0  break  end    insert into  #CNTRLNUMTEMP(  CNTRLNUM,  DOCTYPE,  VENDORID )  select   'Contract- '+ CONTNBR,  6,  'Service Call: '+ CALLNBR  from   SVC00200   where CONTNBR not in (select CONTNBR from SVC00600) and CONTNBR not in (select CONTNBR from SVC30600)  and CONTNBR > ''   if @@rowcount <> 0  begin  update SVC00200 set CONTNBR = ''  where CONTNBR not in (select CONTNBR from SVC00600) and CONTNBR not in (select CONTNBR from SVC30600)  and CONTNBR > ''   exec @iStatus = svcCreateErrorLogRecord  @I_cUserID,  @I_ServiceMSTR,  'Invalid Contrtact Number field has been cleared from the record.',  @O_iErrorState output  update SY03400 set ERMSGTX2 = 'Please manually update the percentages on the call.' where  FILENAME = @I_ServiceMSTR and ERMSGTX2 = ''  select @iError = @@error  if @iStatus <> 0 or @O_iErrorState <> 0 or @iError <> 0  break  end    insert into  #CNTRLNUMTEMP(  CNTRLNUM,  DOCTYPE,  VENDORID )  select   'Type- ' + SRVTYPE,  8,  'Service Call: '+ CALLNBR  from   SVC00200   where SRVTYPE not in (select SRVTYPE from SVC00920)  and SRVTYPE > ''   if @@rowcount <> 0  begin  exec @iStatus = svcCreateErrorLogRecord  @I_cUserID,  @I_ServiceMSTR,  'Service Type on this Service Call does not exist.',  @O_iErrorState output   select @iError = @@error   if @iStatus = 0 and @iError <> 0  select @iStatus = @iError  if @iStatus <> 0 or @O_iErrorState <> 0  break  end    insert into  #CNTRLNUMTEMP(  CNTRLNUM,  DOCTYPE,  VENDORID )  select   'Office ID- '+ OFFID,  8,  'Service Call: '+ CALLNBR  from   SVC00200   where OFFID not in (select OFFID from SVC00902)  and OFFID > ''   if @@rowcount <> 0  begin  exec @iStatus = svcCreateErrorLogRecord  @I_cUserID,  @I_ServiceMSTR,  'Office ID on this Service Call does not exist.',  @O_iErrorState output   select @iError = @@error  if @iStatus <> 0 or @O_iErrorState <> 0 or @iError <> 0  break  end    insert into  #CNTRLNUMTEMP(  CNTRLNUM,  DOCTYPE,  VENDORID )  select   'SRV Area- '+ SVCAREA,  8,  'Service Call: '+ CALLNBR  from   SVC00200   where SVCAREA not in (select SVCAREA from SVC00909)  and SVCAREA > ''   if @@rowcount <> 0  begin  exec @iStatus = svcCreateErrorLogRecord  @I_cUserID,  @I_ServiceMSTR,  'Service Area on this Service Call does not exist.',  @O_iErrorState output   select @iError = @@error   if @iStatus = 0 and @iError <> 0  select @iStatus = @iError  if @iStatus <> 0 or @O_iErrorState <> 0  break  end    insert into  #CNTRLNUMTEMP(  CNTRLNUM,  DOCTYPE,  VENDORID )  select   'CUST- '+CUSTNMBR,  8,  'Service Call: '+ CALLNBR  from   SVC00200   where CUSTNMBR not in (select CUSTNMBR from RM00101)  and CUSTNMBR > ''   if @@rowcount <> 0  begin  exec @iStatus = svcCreateErrorLogRecord  @I_cUserID,  @I_ServiceMSTR,  'Customer ID on this Service Call does not exist.',  @O_iErrorState output   select @iError = @@error   if @iStatus = 0 and @iError <> 0  select @iStatus = @iError  if @iStatus <> 0 or @O_iErrorState <> 0  break  end    insert into  #CNTRLNUMTEMP(  CNTRLNUM,  DOCTYPE,  VENDORID )  select   'Addr- '+ ADRSCODE,  8,  'Service Call: '+ CALLNBR  from   SVC00200   where not exists  (select   1  from   RM00102  where   SVC00200.CUSTNMBR = RM00102.CUSTNMBR and   SVC00200.ADRSCODE =RM00102.ADRSCODE ) and  CUSTNMBR > '' and ADRSCODE > ''   if @@rowcount <> 0  begin  exec @iStatus = svcCreateErrorLogRecord  @I_cUserID,  @I_ServiceMSTR,  'Customer Address on this Service Call does not exist.',  @O_iErrorState output   select @iError = @@error   if @iStatus = 0 and @iError <> 0  select @iStatus = @iError  if @iStatus <> 0 or @O_iErrorState <> 0  break  end    insert into  #CNTRLNUMTEMP(  CNTRLNUM,  DOCTYPE,  VENDORID )  select   'Call Status- '+ SRVSTAT,  8,  'Service Call: ' + CALLNBR  from   SVC00200   where SRVSTAT not in (select SRVSTAT from SVC00913) and SRVSTAT > ''   if @@rowcount <> 0  begin  exec @iStatus = svcCreateErrorLogRecord  @I_cUserID,  @I_ServiceMSTR,  'Service Call Status does not exist.',  @O_iErrorState output   select @iError = @@error   if @iStatus = 0 and @iError <> 0  select @iStatus = @iError  if @iStatus <> 0 or @O_iErrorState <> 0  break  end    insert into  #CNTRLNUMTEMP(  CNTRLNUM,  DOCTYPE,  VENDORID )  select   Rtrim(CUSTNMBR) + '/'+ ADRSCODE,  8,  'Service Call: '+ CALLNBR  from   SVC00200   where not exists  (select   1  from   SVC00950  where   SVC00200.CUSTNMBR = SVC00950.CUSTNMBR and   SVC00200.ADRSCODE =SVC00950.ADRSCODE ) and  exists  (select   1  from   RM00102  where   SVC00200.CUSTNMBR = RM00102.CUSTNMBR and   SVC00200.ADRSCODE =RM00102.ADRSCODE ) and CUSTNMBR > '' and ADRSCODE > ''    if @@rowcount <> 0  begin   exec @iStatus = svcCreateErrorLogRecord  @I_cUserID,  @I_ServiceMSTR,  'Customer Site Extension does not exist - record added.',  @O_iErrorState output   insert into  SVC00950(  CUSTNMBR,  ADRSCODE )  select   CUSTNMBR,  ADRSCODE  from   SVC00200   where not exists  (select   1  from   SVC00950  where   SVC00200.CUSTNMBR = SVC00950.CUSTNMBR and   SVC00200.ADRSCODE =SVC00950.ADRSCODE ) and exists  (select   1  from   RM00102  where   SVC00200.CUSTNMBR = RM00102.CUSTNMBR and   SVC00200.ADRSCODE =RM00102.ADRSCODE )  and CUSTNMBR > '' and ADRSCODE > '' group by CUSTNMBR, ADRSCODE   select @iError = @@error  if @iStatus <> 0 or @O_iErrorState <> 0 or @iError <> 0  break  end    insert into  #CNTRLNUMTEMP(  CNTRLNUM,  DOCTYPE,  VENDORID )  select   'Time Zone- '+ TIMEZONE,  9,  'Service Call: '+CALLNBR  from   SVC00200   where not exists  (select   1  from   SVC00900  where SVC00200.TIMEZONE = SVC00900.TIMEZONE) and TIMEZONE > ''   if @@rowcount <> 0  begin   insert into  SVC00900(  TIMEZONE,  DSCRIPTN )  select   TIMEZONE,  TIMEZONE  from   SVC00200   where not exists  (select   1  from   SVC00900  where SVC00200.TIMEZONE = SVC00900.TIMEZONE) and TIMEZONE > '' group by TIMEZONE   exec @iStatus = svcCreateErrorLogRecord  @I_cUserID,  @I_ServiceMSTR,  'Time Zone does not exist - record added.',  @O_iErrorState output   select @iError = @@error   if @iStatus <> 0 or @O_iErrorState <> 0 or @iError <> 0  break  end   end   return(@iStatus)    
GO
GRANT EXECUTE ON  [dbo].[svcCLServiceTrans] TO [DYNGRP]
GO
