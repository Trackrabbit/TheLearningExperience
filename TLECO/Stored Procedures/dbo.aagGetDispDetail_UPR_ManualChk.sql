SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO
 CREATE PROC [dbo].[aagGetDispDetail_UPR_ManualChk]  @iMLCHKTYP smallint,   @iPYADNMBR int,   @iDistID int,  @iaaSubLedgerHdrID int,  @oMLTRXNBR int output,   @oSEQNUMBR int output,  @oACTINDX int output,  @oIsDistIdExists smallint output,  @oUPRACTYP smallint output,  @oDEPRTMNT char(7) output,  @oJOBTITLE char(7) output,  @oUPRTRXCD char(7) output,  @oDistID int output,  @oDisplayID int output AS Begin  DECLARE @DistID int   SELECT MLCHKTYP,   PYADNMBR,   MLTRXNBR,   SEQNUMBR,  ACTINDX,  UPRACTYP,  DEPRTMNT,  JOBTITLE,  UPRTRXCD,  IDENTITY(int, 1,1) AS DistID, 0 as DisplayID  INTO #newtable1   FROM UPR10310  WHERE MLCHKTYP = @iMLCHKTYP and  PYADNMBR = @iPYADNMBR   ORDER BY SEQNUMBR   SELECT MLCHKTYP,   PYADNMBR,   MLTRXNBR,   SEQNUMBR,  TEMP.ACTINDX,  UPRACTYP,  DEPRTMNT,  JOBTITLE,  UPRTRXCD,  DistID,   IDENTITY(int, 1,1) as DisplayID  INTO #newtable2  FROM #newtable1 TEMP  INNER JOIN AAG00200 AA ON TEMP.ACTINDX = AA.ACTINDX  AND AA.aaAcctClassID> 0   DELETE FROM #newtable2 WHERE DisplayID = 0   IF @oDistID <> 0   BEGIN  SELECT @oMLTRXNBR = MLTRXNBR,   @oSEQNUMBR = SEQNUMBR,  @oACTINDX = ACTINDX,  @oUPRACTYP = UPRACTYP,  @oDEPRTMNT = DEPRTMNT,  @oJOBTITLE = JOBTITLE,  @oUPRTRXCD = UPRTRXCD,  @oDistID = DistID,  @oDisplayID = DisplayID  FROM #newtable2   WHERE DistID = @iDistID  END  ELSE   BEGIN  SELECT @oMLTRXNBR = MLTRXNBR,   @oSEQNUMBR = SEQNUMBR,  @oACTINDX = ACTINDX,  @oUPRACTYP = UPRACTYP,  @oDEPRTMNT = DEPRTMNT,  @oJOBTITLE = JOBTITLE,  @oUPRTRXCD = UPRTRXCD,  @oDistID = DistID,  @oDisplayID = DisplayID  FROM #newtable2   WHERE DisplayID = @iDistID  END   if exists(select aaSubLedgerDistID   from AAG20001   where aaSubLedgerHdrID = @iaaSubLedgerHdrID and  ACTINDX = @oACTINDX and   SEQNUMBR = @oSEQNUMBR)  begin  set @oIsDistIdExists = 1  end  else  begin  set @oIsDistIdExists = 0  end End    
GO
GRANT EXECUTE ON  [dbo].[aagGetDispDetail_UPR_ManualChk] TO [DYNGRP]
GO
