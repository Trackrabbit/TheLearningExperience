SET QUOTED_IDENTIFIER OFF
GO
SET ANSI_NULLS ON
GO
create procedure [dbo].[seeGLCashPostionDetail]   @UserDate datetime,   @Label varchar(30) = '',   @CurrPrevType smallint,   @Date datetime = '' as IF (@Label IS NULL OR @Label = '') BEGIN       SET @Label = (SELECT rtrim(PERNAME) AS PERNAME                            FROM (SELECT DISTINCT(PERNAME), PERIODID                                      FROM SY40100                                      WHERE PERNAME <> 'Beginning Balance'                                            and @Date between PERIODDT and PERDENDT) SY40100)  END IF (@UserDate IS NULL or @UserDate = '') BEGIN       SET @UserDate = @Date END DECLARE @IsHist int   DECLARE @CurrentYear int DECLARE @DATEMAX datetime DECLARE @StartDate datetime DECLARE @EndDate datetime  DECLARE @PERIODOD smallint DECLARE @BalanceForward numeric (19,5) DECLARE @DetailDates TABLE ( StartDate datetime,  EndDate datetime,  DateLabel varchar(30),  CurrPrevType int) INSERT INTO @DetailDates  SELECT   StartDate, EndDate, DateLabel, CurrPrevType  FROM   GetKPIDetailDates(@UserDate, 'Fiscal') SET @StartDate = (select StartDate from @DetailDates where DateLabel = @Label and CurrPrevType = @CurrPrevType) SET @EndDate = (select EndDate from @DetailDates where DateLabel = @Label and CurrPrevType = @CurrPrevType) SELECT @CurrentYear = YEAR1,   @IsHist = HISTORYR  FROM SY40101  WHERE @StartDate between FSTFSCDY and LSTFSCDY  SELECT @PERIODOD = PERIODID   FROM SY40100  WHERE @StartDate between PERIODDT and PERDENDT   AND PERIODID <> 0   AND  FORIGIN = 1   AND YEAR1 = @CurrentYear create table #Cash_Detail (ATYPE smallint,  ACTNUMST char (129),  ACTDESCR char (51),  JRNENTRY int,  TRXDATE datetime,  ACCATDSC char (51),  DEBITAMT numeric(19,5),  CRDTAMNT numeric(19,5),  [Journal Entry For Drillback] varchar(500),  [Account Index For Drillback] varchar(500) ) IF @IsHist = 1  BEGIN  INSERT INTO #Cash_Detail (ATYPE, ACTNUMST, ACTDESCR, JRNENTRY, TRXDATE, ACCATDSC, DEBITAMT, CRDTAMNT, [Journal Entry For Drillback], [Account Index For Drillback])    SELECT 0, ACTNUMST, GL00100.ACTDESCR, JRNENTRY, TRXDATE, GL00102.ACCATDSC, ISNULL(DEBITAMT,0.00) as DEBITAMT, ISNULL(CRDTAMNT,0.00) as CRDTAMNT, [Journal Entry For Drillback], [Account Index For Drillback]  FROM GL30000   join GL00100 on    GL30000.ACTINDX = GL00100.ACTINDX  join GL00105 on   GL30000.ACTINDX = GL00105.ACTINDX  join GL00102 on   GL00100.ACCATNUM = GL00102.ACCATNUM   join (SELECT DISTINCT [Journal Entry],  [Journal Entry For Drillback]    FROM [AccountTransactions]) AccountTransactions on   GL30000.JRNENTRY = AccountTransactions.[Journal Entry]  join (SELECT DISTINCT [Account Index], [Account Index For Drillback]    FROM [AccountTransactions]) AccountDrillback on   GL30000.ACTINDX = AccountDrillback.[Account Index]  WHERE   GL00100.ACCATNUM = 1   AND   TRXDATE >= @StartDate    AND   TRXDATE <= @EndDate  SELECT @BalanceForward = (SELECT ISNULL(SUM(ISNULL(PERDBLNC, 0.00)), 0.00)           FROM GL10111           WHERE ACCATNUM = 1          AND PERIODID >= 0          AND PERIODID <= (@PERIODOD - 1)          AND YEAR1 = @CurrentYear) END  ELSE  BEGIN     INSERT INTO #Cash_Detail (ATYPE, ACTNUMST, ACTDESCR, JRNENTRY, TRXDATE, ACCATDSC, DEBITAMT, CRDTAMNT, [Journal Entry For Drillback], [Account Index For Drillback])     SELECT 0, ACTNUMST, GL00100.ACTDESCR, JRNENTRY, TRXDATE, GL00102.ACCATDSC, ISNULL(DEBITAMT,0.00) as DEBITAMT, ISNULL(CRDTAMNT,0.00) as CRDTAMNT, [Journal Entry For Drillback], [Account Index For Drillback]  FROM GL20000   join GL00100 on    GL20000.ACTINDX = GL00100.ACTINDX   join GL00105 on   GL20000.ACTINDX = GL00105.ACTINDX  join GL00102 on   GL00100.ACCATNUM = GL00102.ACCATNUM  join (SELECT DISTINCT [Journal Entry],  [Journal Entry For Drillback]    FROM [AccountTransactions]) AccountTransactions on   GL20000.JRNENTRY = AccountTransactions.[Journal Entry]  join (SELECT DISTINCT [Account Index], [Account Index For Drillback]    FROM [AccountTransactions]) AccountDrillback on   GL20000.ACTINDX = AccountDrillback.[Account Index]    WHERE   GL00100.ACCATNUM = 1   AND   TRXDATE >= @StartDate    AND   TRXDATE <= @EndDate   SELECT @BalanceForward = (SELECT ISNULL(SUM(ISNULL(PERDBLNC, 0.00)), 0.00)         FROM GL10110         WHERE ACCATNUM = 1         AND PERIODID >= 0          AND PERIODID <= (@PERIODOD - 1)          AND YEAR1 = @CurrentYear) END SELECT @BalanceForward = @BalanceForward * dbo.GetTypicalBalanceMultiplier(1) SELECT @BalanceForward as BalanceForward, ATYPE, ACTNUMST, ACTDESCR, JRNENTRY, TRXDATE, ACCATDSC, DEBITAMT, CRDTAMNT, [Journal Entry For Drillback], [Account Index For Drillback] from #Cash_Detail ORDER BY ATYPE, ACTNUMST, TRXDATE           
GO
GRANT EXECUTE ON  [dbo].[seeGLCashPostionDetail] TO [DYNGRP]
GO
GRANT EXECUTE ON  [dbo].[seeGLCashPostionDetail] TO [rpt_accounting manager]
GO
GRANT EXECUTE ON  [dbo].[seeGLCashPostionDetail] TO [rpt_bookkeeper]
GO
GRANT EXECUTE ON  [dbo].[seeGLCashPostionDetail] TO [rpt_certified accountant]
GO
GRANT EXECUTE ON  [dbo].[seeGLCashPostionDetail] TO [rpt_executive]
GO
