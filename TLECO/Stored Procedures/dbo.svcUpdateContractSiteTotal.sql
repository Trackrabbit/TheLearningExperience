SET QUOTED_IDENTIFIER OFF
GO
SET ANSI_NULLS ON
GO
 CREATE PROCEDURE [dbo].[svcUpdateContractSiteTotal]  @CONSTS smallint,  @CONTNBR char(11),  @AddressCode char(15) AS declare @CTOTAL numeric(19,2) declare @CTOTALUNIT numeric(19,2) declare @CAMTTOINVOICE numeric(19,2) declare @CAMTTOINVOICEMETER numeric(19,2) declare @CINVAMT numeric(19,2) declare @CORIGTOTAL numeric(19,2) declare @CORIGTOTALUNIT numeric(19,2) declare @CORIGAMTTOINVOICE numeric(19,2) declare @CORIGAMTTOINVOICEMETER numeric(19,2) declare @CORIGINVAMT numeric(19,2) declare @CORIGDiscount numeric(19,2) declare @CNUMOFINV integer declare @NEXTBILLDATE datetime declare @MONTHS integer declare @msg varchar(20) declare @CDiscount numeric(19,2)  if @AddressCode is null or @AddressCode = ''  return(99) SELECT @CTOTAL = ISNULL(SUM(SVC00601.TOTAL),0),  @CTOTALUNIT = ISNULL(SUM(SVC00601.Unit_Cost_Total),0),  @CINVAMT = ISNULL(SUM(SVC00601.Invoiced_Amount),0),  @CNUMOFINV = ISNULL(MAX(SVC00601.NUMOFINV),0),  @CDiscount = ISNULL(SUM(SVC00601.DSCDLRAM),0),  @CORIGTOTAL = ISNULL(SUM(SVC00601.ORIGTOTAL),0),  @CORIGTOTALUNIT = ISNULL(SUM(SVC00601.ORIGUNITCOSTTOTAL),0),  @CORIGINVAMT = ISNULL(SUM(SVC00601.Orig_Invoiced_Amount),0),  @CORIGDiscount = ISNULL(SUM(SVC00601.ORDDLRAT),0) FROM SVC00601  WHERE CONSTS = @CONSTS AND CONTNBR = @CONTNBR AND ADRSCODE = @AddressCode  UPDATE SVC00608  with (ROWLOCK)  SET TOTAL = @CTOTAL,  Total_Unit = @CTOTALUNIT,  Amount_To_Invoice = IsNull(@CAMTTOINVOICE,0),  ORIGTOTAL = @CORIGTOTAL,  Originating_Total_Unit = @CORIGTOTALUNIT,   Orig_Amount_To_Invoice = IsNull(@CORIGAMTTOINVOICE,0),  NUMOFINV = @CNUMOFINV,  NXTBLDTE = IsNull(@NEXTBILLDATE,'January 1, 2900 00:00:00')  WHERE CONSTS = @CONSTS AND CONTNBR = @CONTNBR AND ADRSCODE = @AddressCode if @@error <> 0 goto baderror  return baderror:   return @@error    
GO
GRANT EXECUTE ON  [dbo].[svcUpdateContractSiteTotal] TO [DYNGRP]
GO
