SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO
 CREATE Procedure [dbo].[SVC_UpdateCallOrigPrice] (@CALLNBR char(11), @SRVRECTYPE smallint) as  declare @I_sRateCalcMethod  smallint ,           @I_sViewMode  smallint,            @I_nExchangeRate  numeric(15,7),       @I_nDenomExchangeRate numeric(15,7),       @I_sMCTrxState  smallint,            @I_sDecimalPlaces  smallint,            @O_iErrorState          int declare @OrigPrice numeric(19,5) declare @OrigCost numeric(19,5) declare @UnitCost numeric(19,5) declare @UnitPrice numeric(19,5) declare @ExtCost numeric(19,5) declare @ExtPrice numeric(19,5) declare @OrigExtCost numeric(19,5) declare @OrigExtPrice numeric(19,5) declare @Line int,@LineType char(3) select @I_sRateCalcMethod = RATECALC,   @I_nExchangeRate = XCHGRATE,   @I_nDenomExchangeRate = DENXRATE,   @I_sMCTrxState = MCTRXSTT,  @I_sViewMode = 3,    @I_sDecimalPlaces = DECPLACS  from  SVC00200 where CALLNBR = @CALLNBR and SRVRECTYPE = @SRVRECTYPE declare mc_call cursor for select LNITMSEQ,LINITMTYP,UNITCOST,UNITPRCE,EXTDCOST,XTNDPRCE  from SVC00203 where CALLNBR = @CALLNBR and SRVRECTYPE = @SRVRECTYPE OPEN mc_call FETCH NEXT FROM mc_call INTO @Line,@LineType, @UnitCost,@UnitPrice, @ExtCost,@ExtPrice WHILE (@@FETCH_STATUS <> -1) begin  exec SVC_Convert_Amount @I_sRateCalcMethod, @I_sViewMode,@I_nExchangeRate,  @I_nDenomExchangeRate,@I_sMCTrxState,@I_sDecimalPlaces,  @UnitCost,@OrigCost OUTPUT, @O_iErrorState OUTPUT  exec SVC_Convert_Amount @I_sRateCalcMethod, @I_sViewMode,@I_nExchangeRate,  @I_nDenomExchangeRate,@I_sMCTrxState,@I_sDecimalPlaces,  @UnitPrice,@OrigPrice OUTPUT, @O_iErrorState OUTPUT  exec SVC_Convert_Amount @I_sRateCalcMethod, @I_sViewMode,@I_nExchangeRate,  @I_nDenomExchangeRate,@I_sMCTrxState,@I_sDecimalPlaces,  @ExtCost,@OrigExtCost OUTPUT, @O_iErrorState OUTPUT  exec SVC_Convert_Amount @I_sRateCalcMethod, @I_sViewMode,@I_nExchangeRate,  @I_nDenomExchangeRate,@I_sMCTrxState,@I_sDecimalPlaces,  @ExtPrice,@OrigExtPrice OUTPUT, @O_iErrorState OUTPUT  update SVC00203 set ORUNTCST=@OrigCost, ORUNTPRC =@OrigPrice, OREXTCST=@OrigExtCost,OXTNDPRC=@OrigExtPrice  where CALLNBR = @CALLNBR and SRVRECTYPE = @SRVRECTYPE and LNITMSEQ = @Line and LINITMTYP=@LineType  FETCH NEXT FROM mc_call INTO @Line,@LineType, @UnitCost,@UnitPrice, @ExtCost,@ExtPrice end DEALLOCATE mc_call    
GO
GRANT EXECUTE ON  [dbo].[SVC_UpdateCallOrigPrice] TO [DYNGRP]
GO
