SET QUOTED_IDENTIFIER OFF
GO
SET ANSI_NULLS ON
GO
create procedure [dbo].[ItemSiteCombinerMfg]  @I_charStartSite char(30), @I_charEndSite char(30), @cStartSite char(50), @cEndSite char(50), @O_iErrorState int = NULL output with encryption as set transaction isolation level read uncommitted set nocount on select @O_iErrorState = 0 insert TASCMFG (TAMFGORDER) select MANUFACTUREORDER_I from WR010130 where WCID_I in (@I_charStartSite, @I_charEndSite) if @@error <> 0 begin select @O_iErrorState = 2  return end update MOP1400 set LOCNCODE = @I_charEndSite where LOCNCODE = @I_charStartSite and MANUFACTUREORDER_I+cast(PICKLISTSEQ as varchar) not in (select MANUFACTUREORDER_I+cast(PICKLISTSEQ as varchar) from MOP1400 where LOCNCODE = @I_charEndSite) if @@error <> 0 begin select @O_iErrorState = 1  return end update b set	b.QTY_ISSUED_I = a.QTY_ISSUED_I+b.QTY_ISSUED_I, b.ATYALLOC = a.ATYALLOC+b.ATYALLOC, b.NUMBERSCRAPPED_I = a.NUMBERSCRAPPED_I+b.NUMBERSCRAPPED_I, b.PENDING_ISSUE_QTY_I = a.PENDING_ISSUE_QTY_I+b.PENDING_ISSUE_QTY_I, b.PENDING_REV_ISS_QTY_I = a.PENDING_REV_ISS_QTY_I+b.PENDING_REV_ISS_QTY_I, b.PENDING_SCRAP_QTY_I = a.PENDING_SCRAP_QTY_I+b.PENDING_SCRAP_QTY_I, b.PENDING_REV_SCRAP_QTY_I = a.PENDING_REV_SCRAP_QTY_I+b.PENDING_REV_SCRAP_QTY_I from MOP1400 a, MOP1400 b where 	a.LOCNCODE = @I_charStartSite and b.LOCNCODE = @I_charEndSite and a.MANUFACTUREORDER_I = b.MANUFACTUREORDER_I and a.PICKLISTSEQ = b.PICKLISTSEQ if @@error <> 0 begin select @O_iErrorState = 2  return end delete MOP1400 where LOCNCODE = @I_charStartSite if @@error <> 0 begin select @O_iErrorState = 3  return end update MOP1410 set LOCNCODE = @I_charEndSite where LOCNCODE = @I_charStartSite and MANUFACTUREORDER_I+cast(PICKLISTSEQ as varchar)+BIN not in (select MANUFACTUREORDER_I+cast(PICKLISTSEQ as varchar)+BIN from MOP1410 where LOCNCODE = @I_charEndSite) if @@error <> 0 begin select @O_iErrorState = 4  return end update b set b.ATYALLOC = a.ATYALLOC+b.ATYALLOC from MOP1410 a, MOP1410 b where 	a.LOCNCODE = @I_charStartSite and b.LOCNCODE = @I_charEndSite and a.MANUFACTUREORDER_I = b.MANUFACTUREORDER_I and a.PICKLISTSEQ = b.PICKLISTSEQ and a.BIN = b.BIN if @@error <> 0 begin select @O_iErrorState = 5  return end delete MOP1410 where LOCNCODE = @I_charStartSite if @@error <> 0 begin select @O_iErrorState = 6  return end update WC010931 set WCID_I = @I_charEndSite where WCID_I = @I_charStartSite and not exists(select WCID_I from WC010931 where WCID_I = @I_charEndSite) if @@error <> 0 begin select @O_iErrorState = 7  return end delete WC010931 where WCID_I = @I_charStartSite if @@error <> 0 begin select @O_iErrorState = 8  return end update WC010015 set WCID_I = @I_charEndSite where WCID_I = @I_charStartSite and EFFECTIVEDATE_I not in(select EFFECTIVEDATE_I from WC010015 where WCID_I = @I_charEndSite) if @@error <> 0 begin select @O_iErrorState = 9  return end delete WC010015 where WCID_I = @I_charStartSite if @@error <> 0 begin select @O_iErrorState = 10  return end update CP010030 set WCID_I = @I_charEndSite where WCID_I = @I_charStartSite and EFFECTIVEDATE_I not in(select EFFECTIVEDATE_I from CP010030 where WCID_I = @I_charEndSite) if @@error <> 0 begin select @O_iErrorState = 11  return end delete CP010030 where WCID_I = @I_charStartSite if @@error <> 0 begin select @O_iErrorState = 12  return end update CP010230 set WCID_I = @I_charEndSite where WCID_I = @I_charStartSite and EFFECTIVEDATE_I not in(select EFFECTIVEDATE_I from CP010230 where WCID_I = @I_charEndSite) if @@error <> 0 begin select @O_iErrorState = 13  return end delete CP010230 where WCID_I = @I_charStartSite if @@error <> 0 begin select @O_iErrorState = 14  return end update CP010330 set WCID_I = @I_charEndSite where WCID_I = @I_charStartSite and EFFECTIVEDATE_I not in(select EFFECTIVEDATE_I from CP010330 where WCID_I = @I_charEndSite) if @@error <> 0 begin select @O_iErrorState = 15  return end delete CP010330 where WCID_I = @I_charStartSite if @@error <> 0 begin select @O_iErrorState = 16  return end update CP010400 set WCID_I = @I_charEndSite where WCID_I = @I_charStartSite and EFFECTIVEDATE_I not in(select EFFECTIVEDATE_I from CP010400 where WCID_I = @I_charEndSite) if @@error <> 0 begin select @O_iErrorState = 17  return end delete CP010400 where WCID_I = @I_charStartSite if @@error <> 0 begin select @O_iErrorState = 18  return end update WC010400 set WCID_I = @I_charEndSite where WCID_I = @I_charStartSite and not exists (select WCID_I from WC010400 where WCID_I = @I_charEndSite) if @@error <> 0 begin select @O_iErrorState = 19  return end delete WC010400 where WCID_I = @I_charStartSite if @@error <> 0 begin select @O_iErrorState = 20  return end update WC010500 set WCID_I = @I_charEndSite where WCID_I = @I_charStartSite and DOWNDAYS_I not in(select DOWNDAYS_I from WC010500 where WCID_I = @I_charEndSite) if @@error <> 0 begin select @O_iErrorState = 21  return end delete WC010500 where WCID_I = @I_charStartSite if @@error <> 0 begin select @O_iErrorState = 22  return end update WC010600 set WCID_I = @I_charEndSite where WCID_I = @I_charStartSite and cast(EFFECTIVEDATE_I as varchar) + cast(WCALTERNATEPREFS_I as varchar) not in(select cast(EFFECTIVEDATE_I as varchar) + cast(WCALTERNATEPREFS_I as varchar) from WC010600 where WCID_I = @I_charEndSite) if @@error <> 0 begin select @O_iErrorState = 23  return end delete WC010600 where WCID_I = @I_charStartSite if @@error <> 0 begin select @O_iErrorState = 24  return end update WC010800 set WCID_I = @I_charEndSite where WCID_I = @I_charStartSite and UPDAYS_I not in(select UPDAYS_I from WC010800 where WCID_I = @I_charEndSite) if @@error <> 0 begin select @O_iErrorState = 25  return end delete WC010800 where WCID_I = @I_charStartSite if @@error <> 0 begin select @O_iErrorState = 26  return end update WC01100 set WCID_I = @I_charEndSite where WCID_I = @I_charStartSite and SKILLSETNUMBER_I not in(select SKILLSETNUMBER_I from WC01100 where WCID_I = @I_charEndSite) if @@error <> 0 begin select @O_iErrorState = 27  return end delete WC01100 where WCID_I = @I_charStartSite if @@error <> 0 begin select @O_iErrorState = 28  return end update WC010100 set WCID_I = @I_charEndSite where WCID_I = @I_charStartSite and cast(EFFECTIVEDATE_I as varchar) + EMPLOYID not in(select cast(EFFECTIVEDATE_I as varchar) + EMPLOYID from WC010100 where WCID_I = @I_charEndSite) if @@error <> 0 begin select @O_iErrorState = 29  return end delete WC010100 where WCID_I = @I_charStartSite if @@error <> 0 begin select @O_iErrorState = 30  return end update WC010200 set WCID_I = @I_charEndSite where WCID_I = @I_charStartSite and cast(EFFECTIVEDATE_I as varchar) + MACHINEID_I not in(select cast(EFFECTIVEDATE_I as varchar) + MACHINEID_I from WC010200 where WCID_I = @I_charEndSite) if @@error <> 0 begin select @O_iErrorState = 31  return end delete WC010200 where WCID_I = @I_charStartSite if @@error <> 0 begin select @O_iErrorState = 32  return end update WC010714 set WCID_I = @I_charEndSite where WCID_I = @I_charStartSite and OPCODE_I not in(select OPCODE_I from WC010714 where WCID_I = @I_charEndSite) if @@error <> 0 begin select @O_iErrorState = 33  return end delete WC010714 where WCID_I = @I_charStartSite if @@error <> 0 begin select @O_iErrorState = 34  return end update CP010100 set WCID_I = @I_charEndSite where WCID_I = @I_charStartSite and cast(EFFECTIVEDATE_I as varchar) + MANUFACTUREORDER_I + RTSEQNUM_I + cast(MRPISSUETIME_I as varchar) not in(select cast(EFFECTIVEDATE_I as varchar) + MANUFACTUREORDER_I + RTSEQNUM_I + cast(MRPISSUETIME_I as varchar) from CP010100 where WCID_I = @I_charEndSite) if @@error <> 0 begin select @O_iErrorState = 35  return end delete CP010100 where WCID_I = @I_charStartSite if @@error <> 0 begin select @O_iErrorState = 36  return end update RT010130 set WCID_I = @I_charEndSite where WCID_I = @I_charStartSite and ITEMNMBR + ROUTINGNAME_I + RTSEQNUM_I not in(select ITEMNMBR + ROUTINGNAME_I + RTSEQNUM_I from RT010130 where WCID_I = @I_charEndSite) if @@error <> 0 begin select @O_iErrorState = 37  return end delete RT010130 where WCID_I = @I_charStartSite if @@error <> 0 begin select @O_iErrorState = 38  return end update WR010130 set WCID_I = @I_charEndSite where WCID_I = @I_charStartSite and cast(DONECB_I as varchar) + cast(SCHEDULESTARTDATE_I as varchar) + cast(SCHEDULESTARTTIME_I as varchar) + MANUFACTUREORDER_I + RTSEQNUM_I not in(select cast(DONECB_I as varchar) + cast(SCHEDULESTARTDATE_I as varchar) + cast(SCHEDULESTARTTIME_I as varchar) + MANUFACTUREORDER_I + RTSEQNUM_I from WR010130 where WCID_I = @I_charEndSite) if @@error <> 0 begin select @O_iErrorState = 39  return end delete WR010130 where WCID_I = @I_charStartSite if @@error <> 0 begin select @O_iErrorState = 40  return end update WC010015 set WCID_I = @I_charEndSite where WCID_I = @I_charStartSite and EFFECTIVEDATE_I not in(select EFFECTIVEDATE_I from WC010015 where WCID_I = @I_charEndSite) if @@error <> 0 begin select @O_iErrorState = 41  return end delete WC010015 where WCID_I = @I_charStartSite if @@error <> 0 begin select @O_iErrorState = 42  return end update MOP1000 set TO_SITE_I = @I_charEndSite where TO_SITE_I = @I_charStartSite and MANUFACTUREORDER_I+ITEMNMBR+cast(DATERECD as varchar)+cast(WIPSEQNMBR as varchar) not in(select MANUFACTUREORDER_I+ITEMNMBR+cast(DATERECD as varchar)+cast(WIPSEQNMBR as varchar) from MOP1000 where TO_SITE_I = @I_charEndSite) if @@error <> 0 begin select @O_iErrorState = 43  return end update b set	b.QTYRECVD = a.QTYRECVD+b.QTYRECVD, b.QTYSOLD = a.QTYSOLD+b.QTYSOLD, b.ITEM_COSTS_ARRAY_I_1 = a.ITEM_COSTS_ARRAY_I_1+b.ITEM_COSTS_ARRAY_I_1, b.ITEM_COSTS_ARRAY_I_2 = a.ITEM_COSTS_ARRAY_I_2+b.ITEM_COSTS_ARRAY_I_2, b.ITEM_COSTS_ARRAY_I_3 = a.ITEM_COSTS_ARRAY_I_3+b.ITEM_COSTS_ARRAY_I_3, b.ITEM_COSTS_ARRAY_I_4 = a.ITEM_COSTS_ARRAY_I_4+b.ITEM_COSTS_ARRAY_I_4, b.ITEM_COSTS_ARRAY_I_5 = a.ITEM_COSTS_ARRAY_I_5+b.ITEM_COSTS_ARRAY_I_5, b.ITEM_COSTS_ARRAY_I_6 = a.ITEM_COSTS_ARRAY_I_6+b.ITEM_COSTS_ARRAY_I_6, b.ITEM_COSTS_ARRAY_I_7 = a.ITEM_COSTS_ARRAY_I_7+b.ITEM_COSTS_ARRAY_I_7, b.ITEM_COSTS_ARRAY_I_8 = a.ITEM_COSTS_ARRAY_I_8+b.ITEM_COSTS_ARRAY_I_8, b.ITEM_COSTS_ARRAY_I_9 = a.ITEM_COSTS_ARRAY_I_9+b.ITEM_COSTS_ARRAY_I_9, b.ITEM_COSTS_ARRAY_I_10 = a.ITEM_COSTS_ARRAY_I_10+b.ITEM_COSTS_ARRAY_I_10, b.NUMBERSCRAPPED_I = a.NUMBERSCRAPPED_I+b.NUMBERSCRAPPED_I from MOP1000 a, MOP1000 b where 	a.TO_SITE_I = @I_charStartSite and b.TO_SITE_I = @I_charEndSite and a.MANUFACTUREORDER_I = b.MANUFACTUREORDER_I and a.ITEMNMBR = b.ITEMNMBR and a.DATERECD = b.DATERECD and a.WIPSEQNMBR = b.WIPSEQNMBR if @@error <> 0 begin select @O_iErrorState = 44  return end delete MOP1000 where TO_SITE_I = @I_charStartSite if @@error <> 0 begin select @O_iErrorState = 45  return end update b set	b.QUANTITY = a.QUANTITY+b.QUANTITY, b.QTYCONSUMED = a.QTYCONSUMED+b.QTYCONSUMED, b.QTYPENDING = a.QTYPENDING+b.QTYPENDING, b.NUMBERSCRAPPED_I = a.NUMBERSCRAPPED_I+b.NUMBERSCRAPPED_I, b.ATYALLOC = a.ATYALLOC+b.ATYALLOC, b.QTY_BACKFLUSHED_I = a.QTY_BACKFLUSHED_I+b.QTY_BACKFLUSHED_I, b.SCRAPBACKFLUSHED = a.SCRAPBACKFLUSHED+b.SCRAPBACKFLUSHED, b.SCRAPCONSUMED = a.SCRAPCONSUMED+b.SCRAPCONSUMED from MOP1027 a, MOP1027 b where 	a.TO_SITE_I = @I_charStartSite and b.TO_SITE_I = @I_charEndSite and a.MANUFACTUREORDER_I = b.MANUFACTUREORDER_I and a.ITEMNMBR = b.ITEMNMBR and a.DATERECD = b.DATERECD and a.SEQNUMBR = b.SEQNUMBR if @@error <> 0 begin select @O_iErrorState = 46  return end delete a from MOP1027 a, MOP1027 b where	a.TO_SITE_I = @I_charStartSite and b.TO_SITE_I = @I_charEndSite and a.MANUFACTUREORDER_I = b.MANUFACTUREORDER_I and a.ITEMNMBR = b.ITEMNMBR and a.DATERECD = b.DATERECD and a.SEQNUMBR = b.SEQNUMBR if @@error <> 0 begin select @O_iErrorState = 47  return end update MOP1027 set TO_SITE_I = @I_charEndSite where TO_SITE_I = @I_charStartSite if @@error <> 0 begin select @O_iErrorState = 48  return end update WO01050 set TO_SITE_I = @I_charEndSite where TO_SITE_I = @I_charStartSite and MANUFACTUREORDER_I+ITEMNMBR+cast(DATERECD as varchar)+cast(WIPSEQNMBR as varchar) not in(select MANUFACTUREORDER_I+ITEMNMBR+cast(DATERECD as varchar)+cast(WIPSEQNMBR as varchar) from WO01050 where TO_SITE_I = @I_charEndSite) if @@error <> 0 begin select @O_iErrorState = 49  return end update b set	b.QTYRECVD = a.QTYRECVD+b.QTYRECVD, b.QTYSOLD = a.QTYSOLD+b.QTYSOLD, b.ITEM_COSTS_ARRAY_I_1 = a.ITEM_COSTS_ARRAY_I_1+b.ITEM_COSTS_ARRAY_I_1, b.ITEM_COSTS_ARRAY_I_2 = a.ITEM_COSTS_ARRAY_I_2+b.ITEM_COSTS_ARRAY_I_2, b.ITEM_COSTS_ARRAY_I_3 = a.ITEM_COSTS_ARRAY_I_3+b.ITEM_COSTS_ARRAY_I_3, b.ITEM_COSTS_ARRAY_I_4 = a.ITEM_COSTS_ARRAY_I_4+b.ITEM_COSTS_ARRAY_I_4, b.ITEM_COSTS_ARRAY_I_5 = a.ITEM_COSTS_ARRAY_I_5+b.ITEM_COSTS_ARRAY_I_5, b.ITEM_COSTS_ARRAY_I_6 = a.ITEM_COSTS_ARRAY_I_6+b.ITEM_COSTS_ARRAY_I_6, b.ITEM_COSTS_ARRAY_I_7 = a.ITEM_COSTS_ARRAY_I_7+b.ITEM_COSTS_ARRAY_I_7, b.ITEM_COSTS_ARRAY_I_8 = a.ITEM_COSTS_ARRAY_I_8+b.ITEM_COSTS_ARRAY_I_8, b.ITEM_COSTS_ARRAY_I_9 = a.ITEM_COSTS_ARRAY_I_9+b.ITEM_COSTS_ARRAY_I_9, b.ITEM_COSTS_ARRAY_I_10 = a.ITEM_COSTS_ARRAY_I_10+b.ITEM_COSTS_ARRAY_I_10, b.NUMBERSCRAPPED_I = a.NUMBERSCRAPPED_I+b.NUMBERSCRAPPED_I from WO01050 a, WO01050 b where 	a.TO_SITE_I = @I_charStartSite and b.TO_SITE_I = @I_charEndSite and a.MANUFACTUREORDER_I = b.MANUFACTUREORDER_I and a.ITEMNMBR = b.ITEMNMBR and a.DATERECD = b.DATERECD and a.WIPSEQNMBR = b.WIPSEQNMBR if @@error <> 0 begin select @O_iErrorState = 50  return end delete WO01050 where TO_SITE_I = @I_charStartSite if @@error <> 0 begin select @O_iErrorState = 51  return end 
GO
GRANT EXECUTE ON  [dbo].[ItemSiteCombinerMfg] TO [DYNGRP]
GO
