SET QUOTED_IDENTIFIER OFF
GO
SET ANSI_NULLS ON
GO
 create procedure [dbo].[pmCLMCTransactions]  @I_cUserID char(15) = NULL,  @I_cMCPMTransactions varchar(40) = NULL,  @O_iErrorState int   = NULL output as  declare  @iStatus int,  @WORK int,  @OPEN int,  @iError int  if @I_cUserID is NULL or  @I_cMCPMTransactions is NULL  begin  select @O_iErrorState = 20899  return(@iStatus) end  select  @O_iErrorState = 0,  @iStatus  = 0  exec @iStatus = DYNAMICS.dbo.smGetConstantInt   'WORK',  @WORK output,   @O_iErrorState output  select @iError = @@error if @iStatus = 0 and @iError <> 0  select @iStatus = @iError  if ( (@iStatus <> 0) or (@O_iErrorState <> 0) )  return (@iStatus)  exec @iStatus = DYNAMICS.dbo.smGetConstantInt   'OPEN',  @OPEN output,   @O_iErrorState output  select @iError = @@error if @iStatus = 0 and @iError <> 0   select @iStatus = @iError  if ( (@iStatus <> 0) or (@O_iErrorState <> 0) )  return (@iStatus)  insert into   #CNTRLNUMTEMP  (CNTRLNUM,  DOCTYPE,  VENDORID) select  VCHRNMBR,  MC020103.DOCTYPE,  case DCSTATUS  when @OPEN then 'OPEN '  when @WORK then 'WORK '  end  +   DOCABREV from  MC020103,  PM40102 where  MC020103.DOCTYPE = PM40102.DOCTYPE and   (MC020103.DCSTATUS  = @OPEN  and convert(char(1),MC020103.DOCTYPE)+VCHRNMBR not in   ( select   convert(char(1),DOCTYPE)+VCHRNMBR   from   PM20000)) or   ((MC020103.DCSTATUS = @WORK  and MC020103.DOCTYPE < 6  and VCHRNMBR not in   ( select   VCHNUMWK  from   PM10000)) and   (MC020103.DCSTATUS  = @WORK  and MC020103.DOCTYPE = 6  and MC020103.VCHRNMBR not in   ( select   PMNTNMBR   from   PM10300)) and   (MC020103.DCSTATUS  = @WORK  and MC020103.DOCTYPE = 6  and MC020103.VCHRNMBR not in   ( select   PMNTNMBR   from   PM10400)))  if @@rowcount <> 0  begin  delete  MC020103  from  #CNTRLNUMTEMP  where  MC020103.VCHRNMBR  =  #CNTRLNUMTEMP.CNTRLNUM  and MC020103.DOCTYPE =  #CNTRLNUMTEMP.DOCTYPE   exec @iStatus = smCreateErrorLogRecord  @I_cUserID,  @I_cMCPMTransactions,  NULL,  17638,  @O_iErrorState output   select @iError = @@error  if @iStatus = 0 and @iError <> 0  select @iStatus = @iError  if @iStatus <> 0 or @O_iErrorState <> 0  return (@iStatus) end  return(@iStatus)   
GO
GRANT EXECUTE ON  [dbo].[pmCLMCTransactions] TO [DYNGRP]
GO
