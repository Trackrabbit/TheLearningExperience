SET QUOTED_IDENTIFIER OFF
GO
SET ANSI_NULLS ON
GO
 create procedure [dbo].[taUpdateCreateCustomerRcd]  @I_vCUSTNMBR char(15),    @I_vHOLD tinyint = null,   @I_vINACTIVE tinyint = null,   @I_vCUSTNAME char(64) = null,   @I_vSHRTNAME char(15) = null,   @I_vSTMTNAME char(64) = null,   @I_vCUSTCLAS char(15) = null,   @I_vCUSTPRIORITY smallint = null,  @I_vADRSCODE char(15) = null,   @I_vCNTCPRSN char(60) = null,   @I_vADDRESS1 char(60) = null,   @I_vADDRESS2 char(60) = null,     @I_vADDRESS3 char(60) = null,     @I_vCITY char(35) = null,   @I_vSTATE char(29) = null,   @I_vZIPCODE char(10) = null,    @I_vCCode char(6) = null,   @I_vCOUNTRY char(60) = null,   @I_vPHNUMBR1 char(21) = null,   @I_vPHNUMBR2 char(21) = null,   @I_vPHNUMBR3 char(21) = null,   @I_vFAX char(21) = null,   @I_vUPSZONE char(3) = null,   @I_vSHIPMTHD char(15) = null,   @I_vTAXSCHID char(15) = null,   @I_vSHIPCOMPLETE tinyint = null,  @I_vPRSTADCD char(15) = null,   @I_vPRBTADCD char(15) = null,   @I_vSTADDRCD char(15) = null,   @I_vSLPRSNID char(15) = null,   @I_vSALSTERR char(15) = null,   @I_vUSERDEF1 char(20) = null,   @I_vUSERDEF2 char(20) = null,    @I_vCOMMENT1 char(30) = null,    @I_vCOMMENT2 char(30) = null,    @I_vCUSTDISC numeric(19,2) = null,  @I_vPYMTRMID char(20) = null,   @I_vDISGRPER smallint = null,    @I_vDUEGRPER smallint = null,   @I_vPRCLEVEL char(10) = null,   @I_vNOTETEXT varchar(8000) = null,  @I_vBALNCTYP tinyint = null,   @I_vFNCHATYP smallint = null,   @I_vFNCHPCNT numeric(19,2) = null,  @I_vFINCHDLR numeric(19,5) = null,  @I_vMINPYTYP smallint = null,   @I_vMINPYPCT numeric(19,2) = null,  @I_vMINPYDLR numeric(19,5) = null,  @I_vCRLMTTYP smallint = null,   @I_vCRLMTAMT numeric(19,5) = null,  @I_vCRLMTPER smallint = null,   @I_vCRLMTPAM numeric(19,5) = null,  @I_vMXWOFTYP smallint = null,   @I_vMXWROFAM numeric(19,5) = null,  @I_vRevalue_Customer tinyint = null,  @I_vPost_Results_To smallint = null,  @I_vORDERFULFILLDEFAULT tinyint = null,  @I_vINCLUDEINDP tinyint = null,   @I_vCRCARDID char(15) = null,   @I_vCRCRDNUM char(20) = null,   @I_vCCRDXPDT datetime = null,   @I_vBANKNAME char(30) = null,   @I_vBNKBRNCH char(20) = null,   @I_vUSERLANG smallint = null,   @I_vTAXEXMT1 char(25) = null,   @I_vTAXEXMT2 char(25) = null,   @I_vTXRGNNUM char(25) = null,   @I_vCURNCYID char(15) = null,   @I_vRATETPID char(15) = null,   @I_vSTMTCYCL smallint = null,   @I_vKPCALHST tinyint = null,   @I_vKPERHIST tinyint = null,   @I_vKPTRXHST tinyint = null,   @I_vKPDSTHST tinyint = null,   @I_vSend_Email_Statements tinyint = null, @I_vToEmail_Recipient char(80) = null,   @I_vCcEmail_Recipient char(80) = null,   @I_vBccEmail_Recipient char(80) = null,   @I_vCHEKBKID char(15) = null,   @I_vDEFCACTY smallint = null,   @I_vRMCSHACTNUMST varchar(75) = null,  @I_vRMARACTNUMST varchar(75) = null,  @I_vRMSLSACTNUMST varchar(75) = null,  @I_vRMCOSACTNUMST varchar(75) = null,  @I_vRMIVACTNUMST varchar(75) = null,  @I_vRMTAKACTNUMST varchar(75) = null,  @I_vRMAVACTNUMST varchar(75) = null,  @I_vRMFCGACTNUMST varchar(75) = null,  @I_vRMWRACTNUMST varchar(75) = null,  @I_vRMSORACTNUMST varchar(75) = null,  @I_vRMOvrpymtWrtoffACTNUMST varchar(75) = null, @I_vGPSFOINTEGRATIONID char(30) = '',  @I_vINTEGRATIONSOURCE smallint = 0,  @I_vINTEGRATIONID char(30) = '',  @I_vUseCustomerClass tinyint = 0,  @I_vCreateAddress tinyint = 1,   @I_vUpdateIfExists tinyint = 1,   @I_vRequesterTrx smallint = 0,   @I_vUSRDEFND1 char(50) = null,       @I_vUSRDEFND2 char(50) = null,       @I_vUSRDEFND3 char(50) = null,       @I_vUSRDEFND4 varchar(8000) = null,  @I_vUSRDEFND5 varchar(8000) = null,  @O_iErrorState int output, @oErrString varchar(255) output  with encryption as  set transaction isolation level read uncommitted set nocount on  declare @iStatus int,  @iAddShippingErrState int,  @iAddShippingErrString varchar(255),  @iAddAddressErrState int,  @iAddAddressErrString varchar(255),  @iCustomState int,  @iCustomErrString varchar(255),  @O_oErrorState int,  @iError int,  @exists tinyint,  @sCompanyID smallint,  @nNextNoteIndex numeric(19,5),  @iGetNextNoteIdxErrState int,  @ActualDate datetime,  @ActualTime datetime,  @UseRolldown tinyint,  @RMCSHACC int,  @RMARACC int,  @RMSLSACC int,  @RMCOSACC int,  @RMIVACC int,  @RMTAKACC int,  @RMAVACC int,  @RMFCGACC int,  @RMWRACC int,  @RMSORACC int,  @RMOvrpymtWrtoffAcctIdx int,  @CheckStatus tinyint,  @INACTIVE tinyint,  @CPRCSTNM char(15),  @ACTIVE tinyint,  @ACCTTYPE smallint,  @FNCHATYP smallint,  @MINPYTYP smallint,  @CRLMTTYP smallint,  @MXWOFTYP smallint,  @FUNLCURR char(15),  @DECPLCUR smallint,  @BALNCTYP tinyint,  @Transactions tinyint,  @ChangeToEmail_Recipient tinyint,  @ChangeCcEmail_Recipient tinyint,  @ChangeBccEmail_Recipient tinyint,  @Position1 int,  @Position2 int,  @Length int,  @DEFCACTY smallint,  @lock char(30),  @ADRSCODE char(15),  @USERDEF1 char(20),  @USERDEF2 char(20),  @LOCNCODE char(10)  select @O_iErrorState = 0,  @iStatus = 0,  @iAddShippingErrState = 0,  @iAddShippingErrString = '',  @iAddAddressErrState = 0,  @iAddAddressErrString = '',  @iCustomState = 0,  @iCustomErrString = '',  @O_oErrorState = 0,  @iError = 0,  @exists = 0,  @sCompanyID = 0,  @nNextNoteIndex = 0,  @iGetNextNoteIdxErrState = 0,  @ActualDate = '',  @ActualTime = '',  @UseRolldown = 0,  @RMCSHACC = 0,  @RMARACC = 0,  @RMSLSACC = 0,  @RMCOSACC = 0,  @RMIVACC = 0,  @RMTAKACC = 0,  @RMAVACC = 0,  @RMFCGACC = 0,  @RMWRACC = 0,  @RMSORACC = 0,  @RMOvrpymtWrtoffAcctIdx = 0,  @CheckStatus = 0,  @INACTIVE = 0,  @CPRCSTNM = '',  @ACTIVE = 0,  @ACCTTYPE = 0,  @FNCHATYP = 0,  @MINPYTYP = 0,  @CRLMTTYP = 0,  @MXWOFTYP = 0,  @FUNLCURR = '',  @DECPLCUR = 0,  @BALNCTYP = '',  @Transactions = 0,  @ChangeToEmail_Recipient = 0,  @ChangeCcEmail_Recipient = 0,  @ChangeBccEmail_Recipient = 0,  @Position1 = 1,  @Position2 = 0,  @Length = 0,  @DEFCACTY = 0,  @lock = '',  @ADRSCODE = '',  @USERDEF1 = '',  @USERDEF2 = '',  @LOCNCODE = ''  if (@oErrString is null) begin  select @oErrString = '' end  exec @iStatus = taUpdateCreateCustomerRcdPre  @I_vCUSTNMBR output,  @I_vHOLD output,  @I_vINACTIVE output,  @I_vCUSTNAME output,  @I_vSHRTNAME output,  @I_vSTMTNAME output,  @I_vCUSTCLAS output,  @I_vCUSTPRIORITY output,  @I_vADRSCODE output,  @I_vCNTCPRSN output,  @I_vADDRESS1 output,  @I_vADDRESS2 output,  @I_vADDRESS3 output,  @I_vCITY output,  @I_vSTATE output,  @I_vZIPCODE output,  @I_vCCode output,  @I_vCOUNTRY output,  @I_vPHNUMBR1 output,  @I_vPHNUMBR2 output,  @I_vPHNUMBR3 output,  @I_vFAX output,  @I_vUPSZONE output,  @I_vSHIPMTHD output,  @I_vTAXSCHID output,  @I_vSHIPCOMPLETE output,  @I_vPRSTADCD output,  @I_vPRBTADCD output,  @I_vSTADDRCD output,  @I_vSLPRSNID output,  @I_vSALSTERR output,  @I_vUSERDEF1 output,  @I_vUSERDEF2 output,  @I_vCOMMENT1 output,  @I_vCOMMENT2 output,  @I_vCUSTDISC output,  @I_vPYMTRMID output,  @I_vDISGRPER output,  @I_vDUEGRPER output,  @I_vPRCLEVEL output,  @I_vNOTETEXT output,  @I_vBALNCTYP output,  @I_vFNCHATYP output,  @I_vFNCHPCNT output,  @I_vFINCHDLR output,  @I_vMINPYTYP output,  @I_vMINPYPCT output,  @I_vMINPYDLR output,  @I_vCRLMTTYP output,  @I_vCRLMTAMT output,  @I_vCRLMTPER output,  @I_vCRLMTPAM output,  @I_vMXWOFTYP output,  @I_vMXWROFAM output,  @I_vRevalue_Customer output,  @I_vPost_Results_To output,  @I_vORDERFULFILLDEFAULT output,  @I_vINCLUDEINDP output,  @I_vCRCARDID output,  @I_vCRCRDNUM output,  @I_vCCRDXPDT output,  @I_vBANKNAME output,  @I_vBNKBRNCH output,  @I_vUSERLANG output,  @I_vTAXEXMT1 output,  @I_vTAXEXMT2 output,  @I_vTXRGNNUM output,  @I_vCURNCYID output,  @I_vRATETPID output,  @I_vSTMTCYCL output,  @I_vKPCALHST output,  @I_vKPERHIST output,  @I_vKPTRXHST output,  @I_vKPDSTHST output,  @I_vSend_Email_Statements output,  @I_vToEmail_Recipient output,  @I_vCcEmail_Recipient output,  @I_vBccEmail_Recipient output,  @I_vCHEKBKID output,  @I_vDEFCACTY output,  @I_vRMCSHACTNUMST output,  @I_vRMARACTNUMST output,  @I_vRMSLSACTNUMST output,  @I_vRMCOSACTNUMST output,  @I_vRMIVACTNUMST output,  @I_vRMTAKACTNUMST output,  @I_vRMAVACTNUMST output,  @I_vRMFCGACTNUMST output,  @I_vRMWRACTNUMST output,  @I_vRMSORACTNUMST output,  @I_vRMOvrpymtWrtoffACTNUMST output,  @I_vGPSFOINTEGRATIONID output,  @I_vINTEGRATIONSOURCE output,  @I_vINTEGRATIONID output,  @I_vUseCustomerClass output,  @I_vCreateAddress output,  @I_vUpdateIfExists output,  @I_vRequesterTrx output,  @I_vUSRDEFND1 output,  @I_vUSRDEFND2 output,  @I_vUSRDEFND3 output,  @I_vUSRDEFND4 output,  @I_vUSRDEFND5 output,  @O_iErrorState = @iCustomState output,  @oErrString = @iCustomErrString output select @iError = @@error if ((@iStatus <> 0) or (@iCustomState <> 0) or (@iError <> 0)) begin  select @oErrString = rtrim(@oErrString) + ' ' + @iCustomErrString  select @O_iErrorState = 167    exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output  return (@O_iErrorState) end  if (  @I_vCUSTNMBR is null or  @I_vGPSFOINTEGRATIONID is null or  @I_vINTEGRATIONSOURCE is null or  @I_vINTEGRATIONID is null or  @I_vUseCustomerClass is null or  @I_vCreateAddress is null or  @I_vUpdateIfExists is null or  @I_vRequesterTrx is null  ) begin  select @O_iErrorState = 32     exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output  return (@O_iErrorState) end  if (  (@I_vCUSTDISC < 0) or  (@I_vFNCHPCNT < 0) or  (@I_vFINCHDLR < 0) or  (@I_vMINPYPCT < 0) or  (@I_vMINPYDLR < 0) or  (@I_vCRLMTAMT < 0) or  (@I_vCRLMTPAM < 0) or  (@I_vMXWROFAM < 0)  ) begin  select @O_iErrorState = 5403     exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output  return (@O_iErrorState) end  select  @I_vCUSTNMBR = UPPER(@I_vCUSTNMBR),  @I_vCUSTCLAS = UPPER(@I_vCUSTCLAS),  @I_vADRSCODE = UPPER(@I_vADRSCODE),  @I_vCCode = UPPER(@I_vCCode),  @I_vSHIPMTHD = UPPER(@I_vSHIPMTHD),  @I_vTAXSCHID = UPPER(@I_vTAXSCHID),  @I_vPRSTADCD = UPPER(@I_vPRSTADCD),  @I_vPRBTADCD = UPPER(@I_vPRBTADCD),  @I_vSTADDRCD = UPPER(@I_vSTADDRCD),  @I_vSLPRSNID = UPPER(@I_vSLPRSNID),  @I_vSALSTERR = UPPER(@I_vSALSTERR),  @I_vPRCLEVEL = UPPER(@I_vPRCLEVEL),  @I_vCURNCYID = UPPER(@I_vCURNCYID),  @I_vRATETPID = UPPER(@I_vRATETPID),  @I_vCHEKBKID = UPPER(@I_vCHEKBKID)  if (@I_vCUSTNMBR = '') begin  select @O_iErrorState = 33    exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output  return (@O_iErrorState) end  if (exists(select top 1 CUSTNMBR from RM00101 (nolock) where CUSTNMBR = @I_vCUSTNMBR)) begin  select @exists = 1   if (exists(select 1 CUSTNMBR from RM00401 (nolock) where CUSTNMBR = @I_vCUSTNMBR and (DCSTATUS = 1 or DCSTATUS = 2)))  begin  select @CheckStatus = 1  end   select @INACTIVE = INACTIVE,  @CPRCSTNM = CPRCSTNM  from RM00101 (nolock) where CUSTNMBR = @I_vCUSTNMBR end  select @sCompanyID = CMPANYID from DYNAMICS..SY01500 (nolock) where INTERID = db_name()  select @ActualDate = convert(varchar(12),getdate()) select @ActualTime = ltrim(substring(convert(varchar(25),getdate()),12,12))  if (@exists = 1) begin  select @nNextNoteIndex = NOTEINDX from RM00101 (nolock) where CUSTNMBR = @I_vCUSTNMBR end  if (@exists = 1) begin  if (@I_vUpdateIfExists = 0)  begin  select @O_iErrorState = 251     exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output  return (@O_iErrorState)  end  else  begin  if (@I_vUpdateIfExists = 2)  begin  return (@O_iErrorState)  end  end end else begin  if (@I_vUpdateIfExists = 2)  begin  select @I_vUpdateIfExists = 0  end end  if (@exists = 1) begin  if (@I_vUseCustomerClass = 1)  begin  if (@I_vCUSTCLAS is null)  begin  select @UseRolldown = 0  end  else  begin  select @UseRolldown = 1  end  end  else  begin  select @UseRolldown = 0  end   select @FNCHATYP = FNCHATYP,  @MINPYTYP = MINPYTYP,  @CRLMTTYP = CRLMTTYP,  @MXWOFTYP = MXWOFTYP,  @BALNCTYP = BALNCTYP,  @DEFCACTY = DEFCACTY,  @ADRSCODE = ADRSCODE  from RM00101 where CUSTNMBR = @I_vCUSTNMBR   if (@FNCHATYP <> @I_vFNCHATYP)  begin  if (@I_vFNCHPCNT is null)  begin  select @I_vFNCHPCNT = 0  end   if (@I_vFINCHDLR is null)  begin  select @I_vFINCHDLR = 0  end  end   if (@MINPYTYP <> @I_vMINPYTYP)  begin  if (@I_vMINPYPCT is null)  begin  select @I_vMINPYPCT = 0  end   if (@I_vMINPYDLR is null)  begin  select @I_vMINPYDLR = 0  end  end   if (@CRLMTTYP <> @I_vCRLMTTYP)  begin  if (@I_vCRLMTAMT is null)  begin  select @I_vCRLMTAMT = 0  end   if (@I_vCRLMTPER is null)  begin  select @I_vCRLMTPER = 0  end   if (@I_vCRLMTPAM is null)  begin  select @I_vCRLMTPAM = 0  end  end   if (@MXWOFTYP <> @I_vMXWOFTYP)  begin  if (@I_vMXWROFAM is null)  begin  select @I_vMXWROFAM = 0  end  end   if (@DEFCACTY <> @I_vDEFCACTY)  begin  if (@I_vRMCSHACTNUMST is null)  begin  select @I_vRMCSHACTNUMST = ''  end  end   if (@ADRSCODE <> @I_vADRSCODE)  begin  if (exists(select 1 from RM00102 (nolock) where CUSTNMBR = @I_vCUSTNMBR and ADRSCODE = @I_vADRSCODE))  begin  if ((@I_vCNTCPRSN is null) and  (@I_vADDRESS1 is null) and  (@I_vADDRESS2 is null) and  (@I_vADDRESS3 is null) and  (@I_vCITY is null) and  (@I_vSTATE is null) and  (@I_vZIPCODE is null) and  (@I_vCOUNTRY is null) and  (@I_vPHNUMBR1 is null) and  (@I_vPHNUMBR2 is null) and  (@I_vPHNUMBR3 is null) and  (@I_vFAX is null) and  (@I_vUPSZONE is null) and  (@I_vSHIPMTHD is null) and  (@I_vTAXSCHID is null) and  (@I_vSLPRSNID is null) and  (@I_vSALSTERR is null))  begin  select @I_vCNTCPRSN = CNTCPRSN,  @I_vADDRESS1 = ADDRESS1,  @I_vADDRESS2 = ADDRESS2,  @I_vADDRESS3 = ADDRESS3,  @I_vCITY = CITY,  @I_vSTATE = STATE,  @I_vZIPCODE = ZIP,  @I_vCOUNTRY = COUNTRY,  @I_vPHNUMBR1 = PHONE1,  @I_vPHNUMBR2 = PHONE2,  @I_vPHNUMBR3 = PHONE3,  @I_vFAX = FAX,  @I_vUPSZONE = UPSZONE,  @I_vSHIPMTHD = SHIPMTHD,  @I_vTAXSCHID = TAXSCHID,  @I_vSLPRSNID = SLPRSNID,  @I_vSALSTERR = SALSTERR  from RM00102 (nolock) where CUSTNMBR = @I_vCUSTNMBR and ADRSCODE = @I_vADRSCODE  end  else  begin  select @I_vCNTCPRSN =  case  when @I_vCNTCPRSN is null  then ''  else @I_vCNTCPRSN  end,  @I_vADDRESS1 =  case  when @I_vADDRESS1 is null  then ''  else @I_vADDRESS1  end,  @I_vADDRESS2 =  case  when @I_vADDRESS2 is null  then ''  else @I_vADDRESS2  end,  @I_vADDRESS3 =  case  when @I_vADDRESS3 is null  then ''  else @I_vADDRESS3  end,  @I_vCITY =  case  when @I_vCITY is null  then ''  else @I_vCITY  end,  @I_vSTATE =  case  when @I_vSTATE is null  then ''  else @I_vSTATE  end,  @I_vZIPCODE =  case  when @I_vZIPCODE is null  then ''  else @I_vZIPCODE  end,  @I_vCOUNTRY =  case  when @I_vCOUNTRY is null  then ''  else @I_vCOUNTRY  end,  @I_vPHNUMBR1 =  case  when @I_vPHNUMBR1 is null  then ''  else @I_vPHNUMBR1  end,  @I_vPHNUMBR2 =  case  when @I_vPHNUMBR2 is null  then ''  else @I_vPHNUMBR2  end,  @I_vPHNUMBR3 =  case  when @I_vPHNUMBR3 is null  then ''  else @I_vPHNUMBR3  end,  @I_vFAX =  case  when @I_vFAX is null  then ''  else @I_vFAX  end,  @I_vUPSZONE =  case  when @I_vUPSZONE is null  then ''  else @I_vUPSZONE  end,  @I_vSHIPMTHD =  case  when @I_vSHIPMTHD is null  then ''  else @I_vSHIPMTHD  end,  @I_vTAXSCHID =  case  when @I_vTAXSCHID is null  then ''  else @I_vTAXSCHID  end,  @I_vSLPRSNID =  case  when @I_vSLPRSNID is null  then ''  else @I_vSLPRSNID  end,  @I_vSALSTERR =  case  when @I_vSALSTERR is null  then ''  else @I_vSALSTERR  end  end  end  else  begin  select @I_vCNTCPRSN =  case  when @I_vCNTCPRSN is null  then ''  else @I_vCNTCPRSN  end,  @I_vADDRESS1 =  case  when @I_vADDRESS1 is null  then ''  else @I_vADDRESS1  end,  @I_vADDRESS2 =  case  when @I_vADDRESS2 is null  then ''  else @I_vADDRESS2  end,  @I_vADDRESS3 =  case  when @I_vADDRESS3 is null  then ''  else @I_vADDRESS3  end,  @I_vCITY =  case  when @I_vCITY is null  then ''  else @I_vCITY  end,  @I_vSTATE =  case  when @I_vSTATE is null  then ''  else @I_vSTATE  end,  @I_vZIPCODE =  case  when @I_vZIPCODE is null  then ''  else @I_vZIPCODE  end,  @I_vCOUNTRY =  case  when @I_vCOUNTRY is null  then ''  else @I_vCOUNTRY  end,  @I_vPHNUMBR1 =  case  when @I_vPHNUMBR1 is null  then ''  else @I_vPHNUMBR1  end,  @I_vPHNUMBR2 =  case  when @I_vPHNUMBR2 is null  then ''  else @I_vPHNUMBR2  end,  @I_vPHNUMBR3 =  case  when @I_vPHNUMBR3 is null  then ''  else @I_vPHNUMBR3  end,  @I_vFAX =  case  when @I_vFAX is null  then ''  else @I_vFAX  end,  @I_vUPSZONE =  case  when @I_vUPSZONE is null  then ''  else @I_vUPSZONE  end,  @I_vSHIPMTHD =  case  when @I_vSHIPMTHD is null  then ''  else @I_vSHIPMTHD  end,  @I_vTAXSCHID =  case  when @I_vTAXSCHID is null  then ''  else @I_vTAXSCHID  end,  @I_vSLPRSNID =  case  when @I_vSLPRSNID is null  then ''  else @I_vSLPRSNID  end,  @I_vSALSTERR =  case  when @I_vSALSTERR is null  then ''  else @I_vSALSTERR  end  end  end end  if (@exists = 0) begin  if ((@I_vCRLMTTYP in(0,1)) and (@I_vCRLMTAMT is null))  begin  select @I_vCRLMTAMT = 0,  @I_vCRLMTPAM = 0  end   if ((@I_vMXWOFTYP in(0,1)) and (@I_vMXWROFAM is null))  begin  select @I_vMXWROFAM = 0  end   if (@I_vFNCHATYP = 0)  begin  if (@I_vFNCHPCNT is null)  begin  select @I_vFNCHPCNT = 0  end   if (@I_vFINCHDLR is null)  begin  select @I_vFINCHDLR = 0  end  end   if ((@I_vFNCHATYP in(0,1)) and (@I_vFINCHDLR is null))  begin  select @I_vFINCHDLR = 0  end   if ((@I_vFNCHATYP in(0,2)) and (@I_vFNCHPCNT is null))  begin  select @I_vFNCHPCNT = 0  end   if (@I_vMINPYTYP = 0)  begin  if (@I_vMINPYPCT is null)  begin  select @I_vMINPYPCT = 0  end   if (@I_vMINPYDLR is null)  begin  select @I_vMINPYDLR = 0  end  end   if ((@I_vMINPYTYP in(0,1)) and (@I_vMINPYDLR is null))  begin  select @I_vMINPYDLR = 0  end   if ((@I_vMINPYTYP in(0,2)) and (@I_vMINPYPCT is null))  begin  select @I_vMINPYPCT = 0  end end  if ((@I_vCOUNTRY is null) and (@I_vCCode <> '')) begin  select @I_vCOUNTRY = CCodeDesc from VAT10001 (nolock) where CCode = @I_vCCode end   if (@exists = 0) begin  if (@I_vUseCustomerClass = 0)  begin  select  @I_vHOLD =  case  when @I_vHOLD is null  then 0  else @I_vHOLD  end,  @I_vINACTIVE =  case  when @I_vINACTIVE is null  then 0  else @I_vINACTIVE  end,  @I_vCUSTNAME =  case  when @I_vCUSTNAME is null  then ''  else @I_vCUSTNAME  end,  @I_vSHRTNAME =  case  when @I_vSHRTNAME is null and @I_vCUSTNAME is not null  then @I_vCUSTNAME  when @I_vSHRTNAME is null and @I_vCUSTNAME is null  then ''  else @I_vSHRTNAME  end,  @I_vSTMTNAME =  case  when @I_vSTMTNAME is null and @I_vCUSTNAME is not null  then @I_vCUSTNAME  when @I_vSTMTNAME is null and @I_vCUSTNAME is null  then ''  else @I_vSTMTNAME  end,  @I_vCUSTCLAS =  case  when @I_vCUSTCLAS is null  then ''  else @I_vCUSTCLAS  end,  @I_vCUSTPRIORITY =  case  when @I_vCUSTPRIORITY is null  then 1  else @I_vCUSTPRIORITY  end,  @I_vADRSCODE =  case  when @I_vADRSCODE is null  then ''  else @I_vADRSCODE  end,  @I_vCNTCPRSN =  case  when @I_vCNTCPRSN is null  then ''  else @I_vCNTCPRSN  end,  @I_vADDRESS1 =  case  when @I_vADDRESS1 is null  then ''  else @I_vADDRESS1  end,  @I_vADDRESS2 =  case  when @I_vADDRESS2 is null  then ''  else @I_vADDRESS2  end,  @I_vADDRESS3 =  case  when @I_vADDRESS3 is null  then ''  else @I_vADDRESS3  end,  @I_vCITY =  case  when @I_vCITY is null  then ''  else @I_vCITY  end,  @I_vSTATE =  case  when @I_vSTATE is null  then ''  else @I_vSTATE  end,  @I_vZIPCODE =  case  when @I_vZIPCODE is null  then ''  else @I_vZIPCODE  end,  @I_vCCode =  case  when @I_vCCode is null  then ''  else @I_vCCode  end,  @I_vCOUNTRY =  case  when @I_vCOUNTRY is null  then ''  else @I_vCOUNTRY  end,  @I_vPHNUMBR1 =  case  when @I_vPHNUMBR1 is null  then ''  else @I_vPHNUMBR1  end,  @I_vPHNUMBR2 =  case  when @I_vPHNUMBR2 is null  then ''  else @I_vPHNUMBR2  end,  @I_vPHNUMBR3 =  case  when @I_vPHNUMBR3 is null  then ''  else @I_vPHNUMBR3  end,  @I_vFAX =  case  when @I_vFAX is null  then ''  else @I_vFAX  end,  @I_vUPSZONE =  case  when @I_vUPSZONE is null  then ''  else @I_vUPSZONE  end,  @I_vSHIPMTHD =  case  when @I_vSHIPMTHD is null  then ''  else @I_vSHIPMTHD  end,  @I_vTAXSCHID =  case  when @I_vTAXSCHID is null  then ''  else @I_vTAXSCHID  end,  @I_vSHIPCOMPLETE =  case  when @I_vSHIPCOMPLETE is null  then 0  else @I_vSHIPCOMPLETE  end,  @I_vPRSTADCD =  case  when @I_vPRSTADCD is null  then @I_vADRSCODE  else @I_vPRSTADCD  end,  @I_vPRBTADCD =  case  when @I_vPRBTADCD is null  then @I_vADRSCODE  else @I_vPRBTADCD  end,  @I_vSTADDRCD =  case  when @I_vSTADDRCD is null  then @I_vADRSCODE  else @I_vSTADDRCD  end,  @I_vSLPRSNID =  case  when @I_vSLPRSNID is null  then ''  else @I_vSLPRSNID  end,  @I_vSALSTERR =  case  when @I_vSALSTERR is null  then ''  else @I_vSALSTERR  end,  @I_vUSERDEF1 =  case  when @I_vUSERDEF1 is null  then ''  else @I_vUSERDEF1  end,  @I_vUSERDEF2 =  case  when @I_vUSERDEF2 is null  then ''  else @I_vUSERDEF2  end,  @I_vCOMMENT1 =  case  when @I_vCOMMENT1 is null  then ''  else @I_vCOMMENT1  end,  @I_vCOMMENT2 =  case  when @I_vCOMMENT2 is null  then ''  else @I_vCOMMENT2  end,  @I_vCUSTDISC =  case  when @I_vCUSTDISC is null  then 0  else @I_vCUSTDISC  end,  @I_vPYMTRMID =  case  when @I_vPYMTRMID is null  then ''  else @I_vPYMTRMID  end,  @I_vDISGRPER =  case  when @I_vDISGRPER is null  then 0  else @I_vDISGRPER  end,  @I_vDUEGRPER =  case  when @I_vDUEGRPER is null  then 0  else @I_vDUEGRPER  end,  @I_vPRCLEVEL =  case  when @I_vPRCLEVEL is null  then ''  else @I_vPRCLEVEL  end,  @I_vNOTETEXT =  case  when @I_vNOTETEXT is null  then ''  else @I_vNOTETEXT  end,  @I_vBALNCTYP =  case  when @I_vBALNCTYP is null  then 0  else @I_vBALNCTYP  end,  @I_vFNCHATYP =  case  when @I_vFNCHATYP is null  then 0  else @I_vFNCHATYP  end,  @I_vFNCHPCNT =  case  when @I_vFNCHPCNT is null  then 0.00  else @I_vFNCHPCNT  end,  @I_vFINCHDLR =  case  when @I_vFINCHDLR is null  then 0  else @I_vFINCHDLR  end,  @I_vMINPYTYP =  case  when @I_vMINPYTYP is null  then 0  else @I_vMINPYTYP  end,  @I_vMINPYPCT =  case  when @I_vMINPYPCT is null  then 0.00  else @I_vMINPYPCT  end,  @I_vMINPYDLR =  case  when @I_vMINPYDLR is null  then 0  else @I_vMINPYDLR  end,  @I_vCRLMTTYP =  case  when @I_vCRLMTTYP is null  then 0  else @I_vCRLMTTYP  end,  @I_vCRLMTAMT =  case  when @I_vCRLMTAMT is null  then 0  else @I_vCRLMTAMT  end,  @I_vCRLMTPER =  case  when @I_vCRLMTPER is null  then 0  else @I_vCRLMTPER  end,  @I_vCRLMTPAM =  case  when @I_vCRLMTPAM is null  then 0  else @I_vCRLMTPAM  end,  @I_vMXWOFTYP =  case  when @I_vMXWOFTYP is null  then 0  else @I_vMXWOFTYP  end,  @I_vMXWROFAM =  case  when @I_vMXWROFAM is null  then 0  else @I_vMXWROFAM  end,  @I_vRevalue_Customer =  case  when @I_vRevalue_Customer is null  then 1  else @I_vRevalue_Customer  end,  @I_vPost_Results_To =  case  when @I_vPost_Results_To is null  then 0  else @I_vPost_Results_To  end,  @I_vORDERFULFILLDEFAULT =  case  when @I_vORDERFULFILLDEFAULT is null  then 1  else @I_vORDERFULFILLDEFAULT  end,  @I_vINCLUDEINDP =  case  when @I_vINCLUDEINDP is null  then 0  else @I_vINCLUDEINDP  end,  @I_vCRCARDID =  case  when @I_vCRCARDID is null  then ''  else @I_vCRCARDID  end,  @I_vCRCRDNUM =  case  when @I_vCRCRDNUM is null  then ''  else @I_vCRCRDNUM  end,  @I_vCCRDXPDT =  case  when @I_vCCRDXPDT is null  then ''  else @I_vCCRDXPDT  end,  @I_vBANKNAME =  case  when @I_vBANKNAME is null  then ''  else @I_vBANKNAME  end,  @I_vBNKBRNCH =  case  when @I_vBNKBRNCH is null  then ''  else @I_vBNKBRNCH  end,  @I_vUSERLANG =  case  when @I_vUSERLANG is null  then 0  else @I_vUSERLANG  end,  @I_vTAXEXMT1 =  case  when @I_vTAXEXMT1 is null  then ''  else @I_vTAXEXMT1  end,  @I_vTAXEXMT2 =  case  when @I_vTAXEXMT2 is null  then ''  else @I_vTAXEXMT2  end,  @I_vTXRGNNUM =  case  when @I_vTXRGNNUM is null  then ''  else @I_vTXRGNNUM  end,  @I_vCURNCYID =  case  when @I_vCURNCYID is null  then ''  else @I_vCURNCYID  end,  @I_vRATETPID =  case  when @I_vRATETPID is null  then ''  else @I_vRATETPID  end,  @I_vSTMTCYCL =  case  when @I_vSTMTCYCL is null  then 5  else @I_vSTMTCYCL  end,  @I_vKPCALHST =  case  when @I_vKPCALHST is null  then 1  else @I_vKPCALHST  end,  @I_vKPERHIST =  case  when @I_vKPERHIST is null  then 1  else @I_vKPERHIST  end,  @I_vKPTRXHST =  case  when @I_vKPTRXHST is null  then 1  else @I_vKPTRXHST  end,  @I_vKPDSTHST =  case  when @I_vKPDSTHST is null  then 1  else @I_vKPDSTHST  end,  @I_vSend_Email_Statements =  case  when @I_vSend_Email_Statements is null  then 0  else @I_vSend_Email_Statements  end,  @I_vCHEKBKID =  case  when @I_vCHEKBKID is null  then ''  else @I_vCHEKBKID  end,  @I_vDEFCACTY =  case  when @I_vDEFCACTY is null  then 0  else @I_vDEFCACTY  end,  @I_vRMCSHACTNUMST =  case  when @I_vRMCSHACTNUMST is null  then ''  else @I_vRMCSHACTNUMST  end,  @I_vRMARACTNUMST =  case  when @I_vRMARACTNUMST is null  then ''  else @I_vRMARACTNUMST  end,  @I_vRMSLSACTNUMST =  case  when @I_vRMSLSACTNUMST is null  then ''  else @I_vRMSLSACTNUMST  end,  @I_vRMCOSACTNUMST =  case  when @I_vRMCOSACTNUMST is null  then ''  else @I_vRMCOSACTNUMST  end,  @I_vRMIVACTNUMST =  case  when @I_vRMIVACTNUMST is null  then ''  else @I_vRMIVACTNUMST  end,  @I_vRMTAKACTNUMST =  case  when @I_vRMTAKACTNUMST is null  then ''  else @I_vRMTAKACTNUMST  end,  @I_vRMAVACTNUMST =  case  when @I_vRMAVACTNUMST is null  then ''  else @I_vRMAVACTNUMST  end,  @I_vRMFCGACTNUMST =  case  when @I_vRMFCGACTNUMST is null  then ''  else @I_vRMFCGACTNUMST  end,  @I_vRMWRACTNUMST =  case  when @I_vRMWRACTNUMST is null  then ''  else @I_vRMWRACTNUMST  end,  @I_vRMSORACTNUMST =  case  when @I_vRMSORACTNUMST is null  then ''  else @I_vRMSORACTNUMST  end,  @I_vRMOvrpymtWrtoffACTNUMST =  case  when @I_vRMOvrpymtWrtoffACTNUMST is null  then ''  else @I_vRMOvrpymtWrtoffACTNUMST  end  end   if (@I_vUseCustomerClass = 1)  begin  if ((@I_vUseCustomerClass = 1) and ((@I_vCUSTCLAS = '') or (@I_vCUSTCLAS is null)))  begin  select @O_iErrorState = 1409     exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output  return (@O_iErrorState)  end   select  @I_vHOLD =  case  when @I_vHOLD is null  then 0  else @I_vHOLD  end,  @I_vINACTIVE =  case  when @I_vINACTIVE is null  then 0  else @I_vINACTIVE  end,  @I_vCUSTNAME =  case  when @I_vCUSTNAME is null  then ''  else @I_vCUSTNAME  end,  @I_vSHRTNAME =  case  when @I_vSHRTNAME is null and @I_vCUSTNAME is not null  then @I_vCUSTNAME  when @I_vSHRTNAME is null and @I_vCUSTNAME is null  then ''  else @I_vSHRTNAME  end,  @I_vSTMTNAME =  case  when @I_vSTMTNAME is null and @I_vCUSTNAME is not null  then @I_vCUSTNAME  when @I_vSTMTNAME is null and @I_vCUSTNAME is null  then ''  else @I_vSTMTNAME  end,  @I_vCUSTPRIORITY =  case  when @I_vCUSTPRIORITY is null  then CUSTPRIORITY  else @I_vCUSTPRIORITY  end,  @I_vADRSCODE =  case  when @I_vADRSCODE is null  then ''  else @I_vADRSCODE  end,  @I_vCNTCPRSN =  case  when @I_vCNTCPRSN is null  then ''  else @I_vCNTCPRSN  end,  @I_vADDRESS1 =  case  when @I_vADDRESS1 is null  then ''  else @I_vADDRESS1  end,  @I_vADDRESS2 =  case  when @I_vADDRESS2 is null  then ''  else @I_vADDRESS2  end,  @I_vADDRESS3 =  case  when @I_vADDRESS3 is null  then ''  else @I_vADDRESS3  end,  @I_vCITY =  case  when @I_vCITY is null  then ''  else @I_vCITY  end,  @I_vSTATE =  case  when @I_vSTATE is null  then ''  else @I_vSTATE  end,  @I_vZIPCODE =  case  when @I_vZIPCODE is null  then ''  else @I_vZIPCODE  end,  @I_vCCode =  case  when @I_vCCode is null  then ''  else @I_vCCode  end,  @I_vCOUNTRY =  case  when @I_vCOUNTRY is null  then ''  else @I_vCOUNTRY  end,  @I_vPHNUMBR1 =  case  when @I_vPHNUMBR1 is null  then ''  else @I_vPHNUMBR1  end,  @I_vPHNUMBR2 =  case  when @I_vPHNUMBR2 is null  then ''  else @I_vPHNUMBR2  end,  @I_vPHNUMBR3 =  case  when @I_vPHNUMBR3 is null  then ''  else @I_vPHNUMBR3  end,  @I_vFAX =  case  when @I_vFAX is null  then ''  else @I_vFAX  end,  @I_vUPSZONE =  case  when @I_vUPSZONE is null  then ''  else @I_vUPSZONE  end,  @I_vSHIPMTHD =  case  when @I_vSHIPMTHD is null  then SHIPMTHD  else @I_vSHIPMTHD  end,  @I_vTAXSCHID =  case  when @I_vTAXSCHID is null  then TAXSCHID  else @I_vTAXSCHID  end,  @I_vSHIPCOMPLETE =  case  when @I_vSHIPCOMPLETE is null  then 0  else @I_vSHIPCOMPLETE  end,  @I_vPRSTADCD =  case  when @I_vPRSTADCD is null  then @I_vADRSCODE  else @I_vPRSTADCD  end,  @I_vPRBTADCD =  case  when @I_vPRBTADCD is null  then @I_vADRSCODE  else @I_vPRBTADCD  end,  @I_vSTADDRCD =  case  when @I_vSTADDRCD is null  then @I_vADRSCODE  else @I_vSTADDRCD  end,  @I_vSLPRSNID =  case  when @I_vSLPRSNID is null  then SLPRSNID  else @I_vSLPRSNID  end,  @I_vSALSTERR =  case  when @I_vSALSTERR is null  then SALSTERR  else @I_vSALSTERR  end,  @I_vUSERDEF1 =  case  when @I_vUSERDEF1 is null  then ''  else @I_vUSERDEF1  end,  @I_vUSERDEF2 =  case  when @I_vUSERDEF2 is null  then ''  else @I_vUSERDEF2  end,  @I_vCOMMENT1 =  case  when @I_vCOMMENT1 is null  then ''  else @I_vCOMMENT1  end,  @I_vCOMMENT2 =  case  when @I_vCOMMENT2 is null  then ''  else @I_vCOMMENT2  end,  @I_vCUSTDISC =  case  when @I_vCUSTDISC is null  then CUSTDISC * .01  else @I_vCUSTDISC  end,  @I_vPYMTRMID =  case  when @I_vPYMTRMID is null  then PYMTRMID  else @I_vPYMTRMID  end,  @I_vDISGRPER =  case  when @I_vDISGRPER is null  then DISGRPER  else @I_vDISGRPER  end,  @I_vDUEGRPER =  case  when @I_vDUEGRPER is null  then DUEGRPER  else @I_vDUEGRPER  end,  @I_vPRCLEVEL =  case  when @I_vPRCLEVEL is null  then PRCLEVEL  else @I_vPRCLEVEL  end,  @I_vNOTETEXT =  case  when @I_vNOTETEXT is null  then ''  else @I_vNOTETEXT  end,  @I_vBALNCTYP =  case  when @I_vBALNCTYP is null  then BALNCTYP  else @I_vBALNCTYP  end,  @I_vFNCHATYP =  case  when @I_vFNCHATYP is null  then FNCHATYP  else @I_vFNCHATYP  end,  @I_vFNCHPCNT =  case  when @I_vFNCHPCNT is null  then FNCHPCNT * .01  else @I_vFNCHPCNT  end,  @I_vFINCHDLR =  case  when @I_vFINCHDLR is null  then FINCHDLR  else @I_vFINCHDLR  end,  @I_vMINPYTYP =  case  when @I_vMINPYTYP is null  then MINPYTYP  else @I_vMINPYTYP  end,  @I_vMINPYPCT =  case  when @I_vMINPYPCT is null  then MINPYPCT * .01  else @I_vMINPYPCT  end,  @I_vMINPYDLR =  case  when @I_vMINPYDLR is null  then MINPYDLR  else @I_vMINPYDLR  end,  @I_vCRLMTTYP =  case  when @I_vCRLMTTYP is null  then CRLMTTYP  else @I_vCRLMTTYP  end,  @I_vCRLMTAMT =  case  when @I_vCRLMTAMT is null  then CRLMTAMT  else @I_vCRLMTAMT  end,  @I_vCRLMTPER =  case  when @I_vCRLMTPER is null  then CRLMTPER  else @I_vCRLMTPER  end,  @I_vCRLMTPAM =  case  when @I_vCRLMTPAM is null  then CRLMTPAM  else @I_vCRLMTPAM  end,  @I_vMXWOFTYP =  case  when @I_vMXWOFTYP is null  then MXWOFTYP  else @I_vMXWOFTYP  end,  @I_vMXWROFAM =  case  when @I_vMXWROFAM is null  then MXWROFAM  else @I_vMXWROFAM  end,  @I_vRevalue_Customer =  case  when @I_vRevalue_Customer is null  then Revalue_Customer  else @I_vRevalue_Customer  end,  @I_vPost_Results_To =  case  when @I_vPost_Results_To is null  then Post_Results_To  else @I_vPost_Results_To  end,  @I_vORDERFULFILLDEFAULT =  case  when @I_vORDERFULFILLDEFAULT is null  then ORDERFULFILLDEFAULT  else @I_vORDERFULFILLDEFAULT  end,  @I_vINCLUDEINDP =  case  when @I_vINCLUDEINDP is null  then INCLUDEINDP  else @I_vINCLUDEINDP  end,  @I_vCRCARDID =  case  when @I_vCRCARDID is null  then ''  else @I_vCRCARDID  end,  @I_vCRCRDNUM =  case  when @I_vCRCRDNUM is null  then ''  else @I_vCRCRDNUM  end,  @I_vCCRDXPDT =  case  when @I_vCCRDXPDT is null  then ''  else @I_vCCRDXPDT  end,  @I_vBANKNAME =  case  when @I_vBANKNAME is null  then ''  else @I_vBANKNAME  end,  @I_vBNKBRNCH =  case  when @I_vBNKBRNCH is null  then ''  else @I_vBNKBRNCH  end,  @I_vUSERLANG =  case  when @I_vUSERLANG is null  then 0  else @I_vUSERLANG  end,  @I_vTAXEXMT1 =  case  when @I_vTAXEXMT1 is null  then ''  else @I_vTAXEXMT1  end,  @I_vTAXEXMT2 =  case  when @I_vTAXEXMT2 is null  then ''  else @I_vTAXEXMT2  end,  @I_vTXRGNNUM =  case  when @I_vTXRGNNUM is null  then ''  else @I_vTXRGNNUM  end,  @I_vCURNCYID =  case  when @I_vCURNCYID is null  then CURNCYID  else @I_vCURNCYID  end,  @I_vRATETPID =  case  when @I_vRATETPID is null  then RATETPID  else @I_vRATETPID  end,  @I_vSTMTCYCL =  case  when @I_vSTMTCYCL is null  then STMTCYCL  else @I_vSTMTCYCL  end,  @I_vKPCALHST =  case  when @I_vKPCALHST is null  then KPCALHST  else @I_vKPCALHST  end,  @I_vKPERHIST =  case  when @I_vKPERHIST is null  then KPERHIST  else @I_vKPERHIST  end,  @I_vKPTRXHST =  case  when @I_vKPTRXHST is null  then KPTRXHST  else @I_vKPTRXHST  end,  @I_vKPDSTHST =  case  when @I_vKPDSTHST is null  then KPDSTHST  else @I_vKPDSTHST  end,  @I_vSend_Email_Statements =  case  when @I_vSend_Email_Statements is null  then 0  else @I_vSend_Email_Statements  end,  @I_vCHEKBKID =  case  when @I_vCHEKBKID is null  then CHEKBKID  else @I_vCHEKBKID  end,  @I_vDEFCACTY =  case  when @I_vDEFCACTY is null  then DEFCACTY  else @I_vDEFCACTY  end,  @I_vRMCSHACTNUMST =  case  when @I_vRMCSHACTNUMST is null  then isnull(b.ACTNUMST, '')  else @I_vRMCSHACTNUMST  end,  @I_vRMARACTNUMST =  case  when @I_vRMARACTNUMST is null  then isnull(c.ACTNUMST, '')  else @I_vRMARACTNUMST  end,  @I_vRMSLSACTNUMST =  case  when @I_vRMSLSACTNUMST is null  then isnull(d.ACTNUMST, '')  else @I_vRMSLSACTNUMST  end,  @I_vRMCOSACTNUMST =  case  when @I_vRMCOSACTNUMST is null  then isnull(e.ACTNUMST, '')  else @I_vRMCOSACTNUMST  end,  @I_vRMIVACTNUMST =  case  when @I_vRMIVACTNUMST is null  then isnull(f.ACTNUMST, '')  else @I_vRMIVACTNUMST  end,  @I_vRMTAKACTNUMST =  case  when @I_vRMTAKACTNUMST is null  then isnull(g.ACTNUMST, '')  else @I_vRMTAKACTNUMST  end,  @I_vRMAVACTNUMST =  case  when @I_vRMAVACTNUMST is null  then isnull(h.ACTNUMST, '')  else @I_vRMAVACTNUMST  end,  @I_vRMFCGACTNUMST =  case  when @I_vRMFCGACTNUMST is null  then isnull(i.ACTNUMST, '')  else @I_vRMFCGACTNUMST  end,  @I_vRMWRACTNUMST =  case  when @I_vRMWRACTNUMST is null  then isnull(j.ACTNUMST, '')  else @I_vRMWRACTNUMST  end,  @I_vRMSORACTNUMST =  case  when @I_vRMSORACTNUMST is null  then isnull(k.ACTNUMST, '')  else @I_vRMSORACTNUMST  end,  @I_vRMOvrpymtWrtoffACTNUMST =  case  when @I_vRMOvrpymtWrtoffACTNUMST is null  then isnull(l.ACTNUMST, '')  else @I_vRMOvrpymtWrtoffACTNUMST  end  from RM00201 a (nolock)  left outer join GL00105 b (nolock) on  a.RMCSHACC = b.ACTINDX  left outer join GL00105 c (nolock) on  a.RMARACC = c.ACTINDX  left outer join GL00105 d (nolock) on  a.RMSLSACC = d.ACTINDX  left outer join GL00105 e (nolock) on  a.RMCOSACC = e.ACTINDX  left outer join GL00105 f (nolock) on  a.RMIVACC = f.ACTINDX  left outer join GL00105 g (nolock) on  a.RMTAKACC = g.ACTINDX  left outer join GL00105 h (nolock) on  a.RMAVACC = h.ACTINDX  left outer join GL00105 i (nolock) on  a.RMFCGACC = i.ACTINDX  left outer join GL00105 j (nolock) on  a.RMWRACC = j.ACTINDX  left outer join GL00105 k (nolock) on  a.RMSORACC = k.ACTINDX  left outer join GL00105 l (nolock) on  a.RMOvrpymtWrtoffAcctIdx = l.ACTINDX  where a.CLASSID = @I_vCUSTCLAS  end end  if (@exists = 1) begin  if (exists(select top 1 CUSTNMBR from RM00401 (nolock) where CUSTNMBR = @I_vCUSTNMBR))  begin  select @Transactions = 1  end   if (@Transactions = 1)  begin  if (@I_vBALNCTYP is not null)  begin  if (@I_vBALNCTYP <> @BALNCTYP)  begin  select @O_iErrorState = 8074     exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output  end  end  else  begin  select @I_vBALNCTYP = @BALNCTYP  end  end    if ((@I_vUseCustomerClass = 0) or (@UseRolldown = 0))  begin  select  @I_vHOLD =  case  when @I_vHOLD is null  then a.HOLD  else @I_vHOLD  end,  @I_vINACTIVE =  case  when @I_vINACTIVE is null  then a.INACTIVE  else @I_vINACTIVE  end,  @I_vCUSTNAME =  case  when @I_vCUSTNAME is null  then a.CUSTNAME  else @I_vCUSTNAME  end,  @I_vSHRTNAME =  case  when @I_vSHRTNAME is null  then a.SHRTNAME  else @I_vSHRTNAME  end,  @I_vSTMTNAME =  case  when @I_vSTMTNAME is null  then a.STMTNAME  else @I_vSTMTNAME  end,  @I_vCUSTCLAS =  case  when @I_vCUSTCLAS is null  then a.CUSTCLAS  else @I_vCUSTCLAS  end,  @I_vCUSTPRIORITY =  case  when @I_vCUSTPRIORITY is null  then a.CUSTPRIORITY  else @I_vCUSTPRIORITY  end,  @I_vADRSCODE =  case  when @I_vADRSCODE is null  then a.ADRSCODE  else @I_vADRSCODE  end,  @I_vCNTCPRSN =  case  when @I_vCNTCPRSN is null  then a.CNTCPRSN  else @I_vCNTCPRSN  end,  @I_vADDRESS1 =  case  when @I_vADDRESS1 is null  then a.ADDRESS1  else @I_vADDRESS1  end,  @I_vADDRESS2 =  case  when @I_vADDRESS2 is null  then a.ADDRESS2  else @I_vADDRESS2  end,  @I_vADDRESS3 =  case  when @I_vADDRESS3 is null  then a.ADDRESS3  else @I_vADDRESS3  end,  @I_vCITY =  case  when @I_vCITY is null  then a.CITY  else @I_vCITY  end,  @I_vSTATE =  case  when @I_vSTATE is null  then a.STATE  else @I_vSTATE  end,  @I_vZIPCODE =  case  when @I_vZIPCODE is null  then a.ZIP  else @I_vZIPCODE  end,  @I_vCCode =  case  when @I_vCCode is null  then a.CCode  else @I_vCCode  end,  @I_vCOUNTRY =  case  when @I_vCOUNTRY is null  then a.COUNTRY  else @I_vCOUNTRY  end,  @I_vPHNUMBR1 =  case  when @I_vPHNUMBR1 is null  then a.PHONE1  else @I_vPHNUMBR1  end,  @I_vPHNUMBR2 =  case  when @I_vPHNUMBR2 is null  then a.PHONE2  else @I_vPHNUMBR2  end,  @I_vPHNUMBR3 =  case  when @I_vPHNUMBR3 is null  then a.PHONE3  else @I_vPHNUMBR3  end,  @I_vFAX =  case  when @I_vFAX is null  then a.FAX  else @I_vFAX  end,  @I_vUPSZONE =  case  when @I_vUPSZONE is null  then a.UPSZONE  else @I_vUPSZONE  end,  @I_vSHIPMTHD =  case  when @I_vSHIPMTHD is null  then a.SHIPMTHD  else @I_vSHIPMTHD  end,  @I_vTAXSCHID =  case  when @I_vTAXSCHID is null  then a.TAXSCHID  else @I_vTAXSCHID  end,  @I_vSHIPCOMPLETE =  case  when @I_vSHIPCOMPLETE is null  then a.SHIPCOMPLETE  else @I_vSHIPCOMPLETE  end,  @I_vPRSTADCD =  case  when @I_vPRSTADCD is null  then a.PRSTADCD  else @I_vPRSTADCD  end,  @I_vPRBTADCD =  case  when @I_vPRBTADCD is null  then a.PRBTADCD  else @I_vPRBTADCD  end,  @I_vSTADDRCD =  case  when @I_vSTADDRCD is null  then a.STADDRCD  else @I_vSTADDRCD  end,  @I_vSLPRSNID =  case  when @I_vSLPRSNID is null  then a.SLPRSNID  else @I_vSLPRSNID  end,  @I_vSALSTERR =  case  when @I_vSALSTERR is null  then a.SALSTERR  else @I_vSALSTERR  end,  @I_vUSERDEF1 =  case  when @I_vUSERDEF1 is null  then a.USERDEF1  else @I_vUSERDEF1  end,  @I_vUSERDEF2 =  case  when @I_vUSERDEF2 is null  then a.USERDEF2  else @I_vUSERDEF2  end,  @I_vCOMMENT1 =  case  when @I_vCOMMENT1 is null  then a.COMMENT1  else @I_vCOMMENT1  end,  @I_vCOMMENT2 =  case  when @I_vCOMMENT2 is null  then a.COMMENT2  else @I_vCOMMENT2  end,  @I_vCUSTDISC =  case  when @I_vCUSTDISC is null  then a.CUSTDISC * .01  else @I_vCUSTDISC  end,  @I_vPYMTRMID =  case  when @I_vPYMTRMID is null  then a.PYMTRMID  else @I_vPYMTRMID  end,  @I_vDISGRPER =  case  when @I_vDISGRPER is null  then a.DISGRPER  else @I_vDISGRPER  end,  @I_vDUEGRPER =  case  when @I_vDUEGRPER is null  then a.DUEGRPER  else @I_vDUEGRPER  end,  @I_vPRCLEVEL =  case  when @I_vPRCLEVEL is null  then a.PRCLEVEL  else @I_vPRCLEVEL  end,  @I_vBALNCTYP =  case  when @I_vBALNCTYP is null  then a.BALNCTYP  else @I_vBALNCTYP  end,  @I_vFNCHATYP =  case  when @I_vFNCHATYP is null  then a.FNCHATYP  else @I_vFNCHATYP  end,  @I_vFNCHPCNT =  case  when @I_vFNCHPCNT is null  then a.FNCHPCNT * .01  else @I_vFNCHPCNT  end,  @I_vFINCHDLR =  case  when @I_vFINCHDLR is null  then a.FINCHDLR  else @I_vFINCHDLR  end,  @I_vMINPYTYP =  case  when @I_vMINPYTYP is null  then a.MINPYTYP  else @I_vMINPYTYP  end,  @I_vMINPYPCT =  case  when @I_vMINPYPCT is null  then a.MINPYPCT * .01  else @I_vMINPYPCT  end,  @I_vMINPYDLR =  case  when @I_vMINPYDLR is null  then a.MINPYDLR  else @I_vMINPYDLR  end,  @I_vCRLMTTYP =  case  when @I_vCRLMTTYP is null  then a.CRLMTTYP  else @I_vCRLMTTYP  end,  @I_vCRLMTAMT =  case  when @I_vCRLMTAMT is null  then a.CRLMTAMT  else @I_vCRLMTAMT  end,  @I_vCRLMTPER =  case  when @I_vCRLMTPER is null  then a.CRLMTPER  else @I_vCRLMTPER  end,  @I_vCRLMTPAM =  case  when @I_vCRLMTPAM is null  then a.CRLMTPAM  else @I_vCRLMTPAM  end,  @I_vMXWOFTYP =  case  when @I_vMXWOFTYP is null  then a.MXWOFTYP  else @I_vMXWOFTYP  end,  @I_vMXWROFAM =  case  when @I_vMXWROFAM is null  then a.MXWROFAM  else @I_vMXWROFAM  end,  @I_vRevalue_Customer =  case  when @I_vRevalue_Customer is null  then a.Revalue_Customer  else @I_vRevalue_Customer  end,  @I_vPost_Results_To =  case  when @I_vPost_Results_To is null  then a.Post_Results_To  else @I_vPost_Results_To  end,  @I_vORDERFULFILLDEFAULT =  case  when @I_vORDERFULFILLDEFAULT is null  then a.ORDERFULFILLDEFAULT  else @I_vORDERFULFILLDEFAULT  end,  @I_vINCLUDEINDP =  case  when @I_vINCLUDEINDP is null  then a.INCLUDEINDP  else @I_vINCLUDEINDP  end,  @I_vCRCARDID =  case  when @I_vCRCARDID is null  then a.CRCARDID  else @I_vCRCARDID  end,  @I_vCRCRDNUM =  case  when @I_vCRCRDNUM is null  then a.CRCRDNUM  else @I_vCRCRDNUM  end,  @I_vCCRDXPDT =  case  when @I_vCCRDXPDT is null  then a.CCRDXPDT  else @I_vCCRDXPDT  end,  @I_vBANKNAME =  case  when @I_vBANKNAME is null  then a.BANKNAME  else @I_vBANKNAME  end,  @I_vBNKBRNCH =  case  when @I_vBNKBRNCH is null  then a.BNKBRNCH  else @I_vBNKBRNCH  end,  @I_vUSERLANG =  case  when @I_vUSERLANG is null  then a.USERLANG  else @I_vUSERLANG  end,  @I_vTAXEXMT1 =  case  when @I_vTAXEXMT1 is null  then a.TAXEXMT1  else @I_vTAXEXMT1  end,  @I_vTAXEXMT2 =  case  when @I_vTAXEXMT2 is null  then a.TAXEXMT2  else @I_vTAXEXMT2  end,  @I_vTXRGNNUM =  case  when @I_vTXRGNNUM is null  then a.TXRGNNUM  else @I_vTXRGNNUM  end,  @I_vCURNCYID =  case  when @I_vCURNCYID is null  then a.CURNCYID  else @I_vCURNCYID  end,  @I_vRATETPID =  case  when @I_vRATETPID is null  then a.RATETPID  else @I_vRATETPID  end,  @I_vSTMTCYCL =  case  when @I_vSTMTCYCL is null  then a.STMTCYCL  else @I_vSTMTCYCL  end,  @I_vKPCALHST =  case  when @I_vKPCALHST is null  then a.KPCALHST  else @I_vKPCALHST  end,  @I_vKPERHIST =  case  when @I_vKPERHIST is null  then a.KPERHIST  else @I_vKPERHIST  end,  @I_vKPTRXHST =  case  when @I_vKPTRXHST is null  then a.KPTRXHST  else @I_vKPTRXHST  end,  @I_vKPDSTHST =  case  when @I_vKPDSTHST is null  then a.KPDSTHST  else @I_vKPDSTHST  end,  @I_vSend_Email_Statements =  case  when @I_vSend_Email_Statements is null  then a.Send_Email_Statements  else @I_vSend_Email_Statements  end,  @I_vCHEKBKID =  case  when @I_vCHEKBKID is null  then a.CHEKBKID  else @I_vCHEKBKID  end,  @I_vDEFCACTY =  case  when @I_vDEFCACTY is null  then a.DEFCACTY  else @I_vDEFCACTY  end,  @I_vRMCSHACTNUMST =  case  when @I_vRMCSHACTNUMST is null  then isnull(b.ACTNUMST, '')  else @I_vRMCSHACTNUMST  end,  @I_vRMARACTNUMST =  case  when @I_vRMARACTNUMST is null  then isnull(c.ACTNUMST, '')  else @I_vRMARACTNUMST  end,  @I_vRMSLSACTNUMST =  case  when @I_vRMSLSACTNUMST is null  then isnull(d.ACTNUMST, '')  else @I_vRMSLSACTNUMST  end,  @I_vRMCOSACTNUMST =  case  when @I_vRMCOSACTNUMST is null  then isnull(e.ACTNUMST, '')  else @I_vRMCOSACTNUMST  end,  @I_vRMIVACTNUMST =  case  when @I_vRMIVACTNUMST is null  then isnull(f.ACTNUMST, '')  else @I_vRMIVACTNUMST  end,  @I_vRMTAKACTNUMST =  case  when @I_vRMTAKACTNUMST is null  then isnull(g.ACTNUMST, '')  else @I_vRMTAKACTNUMST  end,  @I_vRMAVACTNUMST =  case  when @I_vRMAVACTNUMST is null  then isnull(h.ACTNUMST, '')  else @I_vRMAVACTNUMST  end,  @I_vRMFCGACTNUMST =  case  when @I_vRMFCGACTNUMST is null  then isnull(i.ACTNUMST, '')  else @I_vRMFCGACTNUMST  end,  @I_vRMWRACTNUMST =  case  when @I_vRMWRACTNUMST is null  then isnull(j.ACTNUMST, '')  else @I_vRMWRACTNUMST  end,  @I_vRMSORACTNUMST =  case  when @I_vRMSORACTNUMST is null  then isnull(k.ACTNUMST, '')  else @I_vRMSORACTNUMST  end,  @I_vRMOvrpymtWrtoffACTNUMST =  case  when @I_vRMOvrpymtWrtoffACTNUMST is null  then isnull(l.ACTNUMST, '')  else @I_vRMOvrpymtWrtoffACTNUMST  end  from RM00101 a (nolock)  left outer join GL00105 b (nolock) on  a.RMCSHACC = b.ACTINDX  left outer join GL00105 c (nolock) on  a.RMARACC = c.ACTINDX  left outer join GL00105 d (nolock) on  a.RMSLSACC = d.ACTINDX  left outer join GL00105 e (nolock) on  a.RMCOSACC = e.ACTINDX  left outer join GL00105 f (nolock) on  a.RMIVACC = f.ACTINDX  left outer join GL00105 g (nolock) on  a.RMTAKACC = g.ACTINDX  left outer join GL00105 h (nolock) on  a.RMAVACC = h.ACTINDX  left outer join GL00105 i (nolock) on  a.RMFCGACC = i.ACTINDX  left outer join GL00105 j (nolock) on  a.RMWRACC = j.ACTINDX  left outer join GL00105 k (nolock) on  a.RMSORACC = k.ACTINDX  left outer join GL00105 l (nolock) on  a.RMOvrpymtWrtoffAcctIdx = l.ACTINDX  where a.CUSTNMBR = @I_vCUSTNMBR  end   if (@UseRolldown = 1)  begin  if (@I_vCUSTCLAS = '')  begin  select @O_iErrorState = 972     exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output  return (@O_iErrorState)  end   select  @I_vHOLD =  case  when @I_vHOLD is null  then a.HOLD  else @I_vHOLD  end,  @I_vINACTIVE =  case  when @I_vINACTIVE is null  then a.INACTIVE  else @I_vINACTIVE  end,  @I_vCUSTNAME =  case  when @I_vCUSTNAME is null  then a.CUSTNAME  else @I_vCUSTNAME  end,  @I_vSHRTNAME =  case  when @I_vSHRTNAME is null  then a.SHRTNAME  else @I_vSHRTNAME  end,  @I_vSTMTNAME =  case  when @I_vSTMTNAME is null  then a.STMTNAME  else @I_vSTMTNAME  end,  @I_vCUSTPRIORITY =  case  when @I_vCUSTPRIORITY is null  then b.CUSTPRIORITY  else @I_vCUSTPRIORITY  end,  @I_vADRSCODE =  case  when @I_vADRSCODE is null  then a.ADRSCODE  else @I_vADRSCODE  end,  @I_vCNTCPRSN =  case  when @I_vCNTCPRSN is null  then a.CNTCPRSN  else @I_vCNTCPRSN  end,  @I_vADDRESS1 =  case  when @I_vADDRESS1 is null  then a.ADDRESS1  else @I_vADDRESS1  end,  @I_vADDRESS2 =  case  when @I_vADDRESS2 is null  then a.ADDRESS2  else @I_vADDRESS2  end,  @I_vADDRESS3 =  case  when @I_vADDRESS3 is null  then a.ADDRESS3  else @I_vADDRESS3  end,  @I_vCITY =  case  when @I_vCITY is null  then a.CITY  else @I_vCITY  end,  @I_vSTATE =  case  when @I_vSTATE is null  then a.STATE  else @I_vSTATE  end,  @I_vZIPCODE =  case  when @I_vZIPCODE is null  then a.ZIP  else @I_vZIPCODE  end,  @I_vCCode =  case  when @I_vCCode is null  then a.CCode  else @I_vCCode  end,  @I_vCOUNTRY =  case  when @I_vCOUNTRY is null  then a.COUNTRY  else @I_vCOUNTRY  end,  @I_vPHNUMBR1 =  case  when @I_vPHNUMBR1 is null  then a.PHONE1  else @I_vPHNUMBR1  end,  @I_vPHNUMBR2 =  case  when @I_vPHNUMBR2 is null  then a.PHONE2  else @I_vPHNUMBR2  end,  @I_vPHNUMBR3 =  case  when @I_vPHNUMBR3 is null  then a.PHONE3  else @I_vPHNUMBR3  end,  @I_vFAX =  case  when @I_vFAX is null  then a.FAX  else @I_vFAX  end,  @I_vUPSZONE =  case  when @I_vUPSZONE is null  then a.UPSZONE  else @I_vUPSZONE  end,  @I_vSHIPMTHD =  case  when @I_vSHIPMTHD is null  then b.SHIPMTHD  else @I_vSHIPMTHD  end,  @I_vTAXSCHID =  case  when @I_vTAXSCHID is null  then b.TAXSCHID  else @I_vTAXSCHID  end,  @I_vSHIPCOMPLETE =  case  when @I_vSHIPCOMPLETE is null  then a.SHIPCOMPLETE  else @I_vSHIPCOMPLETE  end,  @I_vPRSTADCD =  case  when @I_vPRSTADCD is null  then a.PRSTADCD  else @I_vPRSTADCD  end,  @I_vPRBTADCD =  case  when @I_vPRBTADCD is null  then a.PRBTADCD  else @I_vPRBTADCD  end,  @I_vSTADDRCD =  case  when @I_vSTADDRCD is null  then a.STADDRCD  else @I_vSTADDRCD  end,  @I_vSLPRSNID =  case  when @I_vSLPRSNID is null  then b.SLPRSNID  else @I_vSLPRSNID  end,  @I_vSALSTERR =  case  when @I_vSALSTERR is null  then b.SALSTERR  else @I_vSALSTERR  end,  @I_vUSERDEF1 =  case  when @I_vUSERDEF1 is null  then a.USERDEF1  else @I_vUSERDEF1  end,  @I_vUSERDEF2 =  case  when @I_vUSERDEF2 is null  then a.USERDEF2  else @I_vUSERDEF2  end,  @I_vCOMMENT1 =  case  when @I_vCOMMENT1 is null  then a.COMMENT1  else @I_vCOMMENT1  end,  @I_vCOMMENT2 =  case  when @I_vCOMMENT2 is null  then a.COMMENT2  else @I_vCOMMENT2  end,  @I_vCUSTDISC =  case  when @I_vCUSTDISC is null  then b.CUSTDISC * .01  else @I_vCUSTDISC  end,  @I_vPYMTRMID =  case  when @I_vPYMTRMID is null  then b.PYMTRMID  else @I_vPYMTRMID  end,  @I_vDISGRPER =  case  when @I_vDISGRPER is null  then b.DISGRPER  else @I_vDISGRPER  end,  @I_vDUEGRPER =  case  when @I_vDUEGRPER is null  then b.DUEGRPER  else @I_vDUEGRPER  end,  @I_vPRCLEVEL =  case  when @I_vPRCLEVEL is null  then b.PRCLEVEL  else @I_vPRCLEVEL  end,  @I_vBALNCTYP =  case  when @I_vBALNCTYP is null  then b.BALNCTYP  else @I_vBALNCTYP  end,  @I_vFNCHATYP =  case  when @I_vFNCHATYP is null  then b.FNCHATYP  else @I_vFNCHATYP  end,  @I_vFNCHPCNT =  case  when @I_vFNCHPCNT is null  then b.FNCHPCNT * .01  else @I_vFNCHPCNT  end,  @I_vFINCHDLR =  case  when @I_vFINCHDLR is null  then b.FINCHDLR  else @I_vFINCHDLR  end,  @I_vMINPYTYP =  case  when @I_vMINPYTYP is null  then b.MINPYTYP  else @I_vMINPYTYP  end,  @I_vMINPYPCT =  case  when @I_vMINPYPCT is null  then b.MINPYPCT * .01  else @I_vMINPYPCT  end,  @I_vMINPYDLR =  case  when @I_vMINPYDLR is null  then b.MINPYDLR  else @I_vMINPYDLR  end,  @I_vCRLMTTYP =  case  when @I_vCRLMTTYP is null  then b.CRLMTTYP  else @I_vCRLMTTYP  end,  @I_vCRLMTAMT =  case  when @I_vCRLMTAMT is null  then b.CRLMTAMT  else @I_vCRLMTAMT  end,  @I_vCRLMTPER =  case  when @I_vCRLMTPER is null  then b.CRLMTPER  else @I_vCRLMTPER  end,  @I_vCRLMTPAM =  case  when @I_vCRLMTPAM is null  then b.CRLMTPAM  else @I_vCRLMTPAM  end,  @I_vMXWOFTYP =  case  when @I_vMXWOFTYP is null  then b.MXWOFTYP  else @I_vMXWOFTYP  end,  @I_vMXWROFAM =  case  when @I_vMXWROFAM is null  then b.MXWROFAM  else @I_vMXWROFAM  end,  @I_vRevalue_Customer =  case  when @I_vRevalue_Customer is null  then b.Revalue_Customer  else @I_vRevalue_Customer  end,  @I_vPost_Results_To =  case  when @I_vPost_Results_To is null  then b.Post_Results_To  else @I_vPost_Results_To  end,  @I_vORDERFULFILLDEFAULT =  case  when @I_vORDERFULFILLDEFAULT is null  then b.ORDERFULFILLDEFAULT  else @I_vORDERFULFILLDEFAULT  end,  @I_vINCLUDEINDP =  case  when @I_vINCLUDEINDP is null  then b.INCLUDEINDP  else @I_vINCLUDEINDP  end,  @I_vCRCARDID =  case  when @I_vCRCARDID is null  then a.CRCARDID  else @I_vCRCARDID  end,  @I_vCRCRDNUM =  case  when @I_vCRCRDNUM is null  then a.CRCRDNUM       else @I_vCRCRDNUM  end,  @I_vCCRDXPDT =  case  when @I_vCCRDXPDT is null  then a.CCRDXPDT       else @I_vCCRDXPDT  end,  @I_vBANKNAME =  case  when @I_vBANKNAME is null  then a.BANKNAME       else @I_vBANKNAME  end,  @I_vBNKBRNCH =  case  when @I_vBNKBRNCH is null  then a.BNKBRNCH       else @I_vBNKBRNCH  end,  @I_vUSERLANG =  case  when @I_vUSERLANG is null  then a.USERLANG  else @I_vUSERLANG  end,  @I_vTAXEXMT1 =  case  when @I_vTAXEXMT1 is null  then a.TAXEXMT1  else @I_vTAXEXMT1  end,  @I_vTAXEXMT2 =  case  when @I_vTAXEXMT2 is null  then a.TAXEXMT2  else @I_vTAXEXMT2  end,  @I_vTXRGNNUM =  case  when @I_vTXRGNNUM is null  then a.TXRGNNUM  else @I_vTXRGNNUM  end,  @I_vCURNCYID =  case  when @I_vCURNCYID is null  then b.CURNCYID  else @I_vCURNCYID  end,  @I_vRATETPID =  case  when @I_vRATETPID is null  then b.RATETPID  else @I_vRATETPID  end,  @I_vSTMTCYCL =  case  when @I_vSTMTCYCL is null  then b.STMTCYCL  else @I_vSTMTCYCL  end,  @I_vKPCALHST =  case  when @I_vKPCALHST is null  then b.KPCALHST  else @I_vKPCALHST  end,  @I_vKPERHIST =  case  when @I_vKPERHIST is null  then b.KPERHIST  else @I_vKPERHIST  end,  @I_vKPTRXHST =  case  when @I_vKPTRXHST is null  then b.KPTRXHST  else @I_vKPTRXHST  end,  @I_vKPDSTHST =  case  when @I_vKPDSTHST is null  then b.KPDSTHST  else @I_vKPDSTHST  end,  @I_vSend_Email_Statements =  case  when @I_vSend_Email_Statements is null  then a.Send_Email_Statements  else @I_vSend_Email_Statements  end,  @I_vCHEKBKID =  case  when @I_vCHEKBKID is null  then b.CHEKBKID  else @I_vCHEKBKID  end,  @I_vDEFCACTY =  case  when @I_vDEFCACTY is null  then b.DEFCACTY  else @I_vDEFCACTY  end,  @I_vRMCSHACTNUMST =  case  when @I_vRMCSHACTNUMST is null  then isnull(c.ACTNUMST, '')  else @I_vRMCSHACTNUMST  end,  @I_vRMARACTNUMST =  case  when @I_vRMARACTNUMST is null  then isnull(d.ACTNUMST, '')  else @I_vRMARACTNUMST  end,  @I_vRMSLSACTNUMST =  case  when @I_vRMSLSACTNUMST is null  then isnull(e.ACTNUMST, '')  else @I_vRMSLSACTNUMST  end,  @I_vRMCOSACTNUMST =  case  when @I_vRMCOSACTNUMST is null  then isnull(f.ACTNUMST, '')  else @I_vRMCOSACTNUMST  end,  @I_vRMIVACTNUMST =  case  when @I_vRMIVACTNUMST is null  then isnull(g.ACTNUMST, '')  else @I_vRMIVACTNUMST  end,  @I_vRMTAKACTNUMST =  case  when @I_vRMTAKACTNUMST is null  then isnull(h.ACTNUMST, '')  else @I_vRMTAKACTNUMST  end,  @I_vRMAVACTNUMST =  case  when @I_vRMAVACTNUMST is null  then isnull(i.ACTNUMST, '')  else @I_vRMAVACTNUMST  end,  @I_vRMFCGACTNUMST =  case  when @I_vRMFCGACTNUMST is null  then isnull(j.ACTNUMST, '')  else @I_vRMFCGACTNUMST  end,  @I_vRMWRACTNUMST =  case  when @I_vRMWRACTNUMST is null  then isnull(k.ACTNUMST, '')  else @I_vRMWRACTNUMST  end,  @I_vRMSORACTNUMST =  case  when @I_vRMSORACTNUMST is null  then isnull(l.ACTNUMST, '')  else @I_vRMSORACTNUMST  end,  @I_vRMOvrpymtWrtoffACTNUMST =  case  when @I_vRMOvrpymtWrtoffACTNUMST is null  then isnull(m.ACTNUMST, '')  else @I_vRMOvrpymtWrtoffACTNUMST  end  from RM00101 a (nolock)  inner join RM00201 b (nolock) on b.CLASSID = @I_vCUSTCLAS  left outer join GL00105 c (nolock) on  b.RMCSHACC = c.ACTINDX  left outer join GL00105 d (nolock) on  b.RMARACC = d.ACTINDX  left outer join GL00105 e (nolock) on  b.RMSLSACC = e.ACTINDX  left outer join GL00105 f (nolock) on  b.RMCOSACC = f.ACTINDX  left outer join GL00105 g (nolock) on  b.RMIVACC = g.ACTINDX  left outer join GL00105 h (nolock) on  b.RMTAKACC = h.ACTINDX  left outer join GL00105 i (nolock) on  b.RMAVACC = i.ACTINDX  left outer join GL00105 j (nolock) on  b.RMFCGACC = j.ACTINDX  left outer join GL00105 k (nolock) on  b.RMWRACC = k.ACTINDX  left outer join GL00105 l (nolock) on  b.RMSORACC = l.ACTINDX  left outer join GL00105 m (nolock) on  b.RMOvrpymtWrtoffAcctIdx = m.ACTINDX  where a.CUSTNMBR = @I_vCUSTNMBR  end   if (@I_vNOTETEXT is null)  begin  select @I_vNOTETEXT = TXTFIELD from SY03900 (nolock) where NOTEINDX = @nNextNoteIndex  end end  if (@I_vToEmail_Recipient is not null) begin  select @ChangeToEmail_Recipient = 1 end else begin  select @I_vToEmail_Recipient = '' end  if (@I_vCcEmail_Recipient is not null) begin  select @ChangeCcEmail_Recipient = 1 end else begin  select @I_vCcEmail_Recipient = '' end  if (@I_vBccEmail_Recipient is not null) begin  select @ChangeBccEmail_Recipient = 1 end else begin  select @I_vBccEmail_Recipient = '' end  if (@I_vHOLD not in(0,1)) begin  select @O_iErrorState = 1621     exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output end  if (@I_vINACTIVE not in(0,1)) begin  select @O_iErrorState = 1620     exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output end  if (@I_vINACTIVE = 1) begin  if ((@INACTIVE = 0) and (@exists = 1) and (@CheckStatus = 1))  begin  select @O_iErrorState = 1410     exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output  end end  if (@I_vCUSTCLAS <> '') begin  if (not exists(select top 1 CLASSID from RM00201 (nolock) where CLASSID = @I_vCUSTCLAS))  begin  select @O_iErrorState = 495     exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output  end end  if ((@I_vCUSTPRIORITY < 1) or (@I_vCUSTPRIORITY > 100)) begin  select @O_iErrorState = 6328     exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output end  if (@I_vCCode <> '') begin  if (not exists(select 1 from VAT10001 (nolock) where CCode = @I_vCCode))  begin   select @O_iErrorState = 6329     exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output  end end  if (@I_vTAXSCHID <> '') begin  if (not exists(select 1 from TX00101 (nolock) where TAXSCHID = @I_vTAXSCHID))  begin   select @O_iErrorState = 250     exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output  end end  if (@I_vSHIPCOMPLETE not in (0,1)) begin  select @O_iErrorState = 6330     exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output end  if (@I_vSLPRSNID <> '') begin  if (not exists(select top 1 SLPRSNID from RM00301 (nolock) where SLPRSNID = @I_vSLPRSNID))  begin   select @O_iErrorState = 249     exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output  end end  if (@I_vSALSTERR <> '') begin  if (not exists(select top 1 SALSTERR from RM00303 (nolock) where SALSTERR = @I_vSALSTERR))  begin  select @O_iErrorState = 5458     exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output  end end  if (@I_vCUSTDISC > 100.00) begin  select @O_iErrorState = 5897     exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output end  if (@I_vPYMTRMID <> '') begin  if (not exists(select top 1 PYMTRMID from SY03300 (nolock) where PYMTRMID = @I_vPYMTRMID ))  begin  select @O_iErrorState = 5421     exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output  end end  if (@I_vDISGRPER < 0 or @I_vDISGRPER > 99)  begin  select @O_iErrorState = 4618     exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output end  if (@I_vDUEGRPER < 0 or @I_vDUEGRPER > 99)  begin  select @O_iErrorState = 4619     exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output end  if (@I_vPRCLEVEL <> '')  begin  if (not exists(select top 1 PRCLEVEL from IV40800 (nolock) where PRCLEVEL = @I_vPRCLEVEL ))  begin  select @O_iErrorState = 6231     exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output  end end  if (@I_vBALNCTYP not in(0,1)) begin  select @O_iErrorState = 1624     exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output end  if (@I_vFNCHATYP not in(0,1,2)) begin  select @O_iErrorState = 5893     exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output end  if (@I_vFNCHPCNT > 100.00) begin  select @O_iErrorState = 5894     exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output end  if ((@I_vFNCHPCNT > 0) and (@I_vFNCHATYP <> 1) and (@I_vUpdateIfExists = 0)) begin  select @O_iErrorState = 7899     exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output end  if ((@I_vFINCHDLR > 0) and (@I_vFNCHATYP <> 2) and (@I_vUpdateIfExists = 0)) begin  select @O_iErrorState = 5895     exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output end  if (@I_vMINPYTYP not in(0,1,2)) begin  select @O_iErrorState = 5896     exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output end  if (@I_vMINPYPCT > 100.00) begin  select @O_iErrorState = 8017     exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output end  if ((@I_vMINPYPCT > 0) and (@I_vMINPYTYP <> 1) and (@I_vUpdateIfExists = 0)) begin  select @O_iErrorState = 5898     exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output end  if ((@I_vMINPYDLR > 0) and (@I_vMINPYTYP <> 2) and (@I_vUpdateIfExists = 0)) begin  select @O_iErrorState = 7854     exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output end  if (@I_vCRLMTTYP not in(0,1,2)) begin  select @O_iErrorState = 4617     exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output end  if ((@I_vCRLMTAMT > 0) and (@I_vCRLMTTYP <> 2)) begin  select @O_iErrorState = 7128     exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output end  if (@I_vCRLMTPER > 0) begin  if (@I_vCRLMTPER not in(select top 1 INDEX1 from RM40201 (nolock) where INDEX1 = @I_vCRLMTPER))  begin  select @O_iErrorState = 7129     exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output  end   if (@I_vCRLMTTYP <> 2)  begin  select @O_iErrorState = 7127     exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output  end end  if ((@I_vCRLMTPAM > 0) and (@I_vCRLMTTYP <> 2)) begin  select @O_iErrorState = 7137     exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output end  if (@I_vMXWOFTYP not in(0,1,2)) begin  select @O_iErrorState = 7855     exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output end  if ((@I_vMXWROFAM > 0) and (@I_vMXWOFTYP <> 2)) begin  select @O_iErrorState = 7856     exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output end  if (@I_vRevalue_Customer not in(0,1)) begin  select @O_iErrorState = 5422     exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output end  if (@I_vRevalue_Customer = 0) begin  select @I_vPost_Results_To = 0   end  if (@I_vPost_Results_To not in(0,1)) begin  select @O_iErrorState = 5423     exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output end  if (@I_vORDERFULFILLDEFAULT not in(1,2,3)) begin  select @O_iErrorState = 6327     exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output end  if (@I_vINCLUDEINDP not in(0,1)) begin  select @O_iErrorState = 7857     exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output end  if (@I_vCRCARDID <> '') begin  if (not exists(select top 1 CARDNAME from SY03100 (nolock) where CARDNAME = @I_vCRCARDID and CBRCVBLE = 1))  begin  select @O_iErrorState = 94     exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output  end end  if (@I_vUSERLANG <> 0) begin  if (not exists(select top 1 USERLANG from DYNAMICS..SY05400 (nolock) where USERLANG = @I_vUSERLANG))  begin  select @O_iErrorState = 7858     exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output  end end  if (@I_vCURNCYID <> '') begin  if (not exists(select top 1 CURNCYID from DYNAMICS..MC40200 (nolock) where CURNCYID = @I_vCURNCYID))  begin  select @O_iErrorState = 1327     exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output  end   if (not exists(select top 1 CURNCYID from DYNAMICS..MC60100 (nolock) where CURNCYID = @I_vCURNCYID and CMPANYID = @sCompanyID ))  begin  select @O_iErrorState = 1305    exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output  end end  if (@I_vRATETPID <> '') begin  if (not exists(select 1 from MC40100 (nolock) where RATETPID = @I_vRATETPID))  begin  select @O_iErrorState = 7859     exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output  end end  if ((@I_vSTMTCYCL < 1) or (@I_vSTMTCYCL > 7)) begin  select @O_iErrorState = 7898     exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output end  if (@I_vKPCALHST not in(0,1)) begin  select @O_iErrorState = 7860     exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output end  if (@I_vKPERHIST not in(0,1)) begin  select @O_iErrorState = 7897     exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output end  if (@I_vKPTRXHST not in(0,1)) begin  select @O_iErrorState = 7861     exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output end  if (@I_vKPDSTHST not in(0,1)) begin  select @O_iErrorState = 7895     exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output end  if (@I_vSend_Email_Statements not in(0,1)) begin  select @O_iErrorState = 7896     exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output end  if (@I_vCHEKBKID <> '') begin  if (not exists(select top 1 CHEKBKID from CM00100 (nolock) where CHEKBKID = @I_vCHEKBKID ))  begin  select @O_iErrorState = 5420     exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output  end end  if (@I_vDEFCACTY not in(0,1)) begin  select @O_iErrorState = 7863     exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output end  if (@I_vRMCSHACTNUMST <> '') begin  select @RMCSHACC = ACTINDX from GL00105 (nolock) where ACTNUMST = @I_vRMCSHACTNUMST   if (@RMCSHACC <> 0)  begin  select @ACTIVE = ACTIVE,  @ACCTTYPE = ACCTTYPE  from GL00100 (nolock) where ACTINDX = @RMCSHACC   if (@ACTIVE = 0)  begin  select @O_iErrorState = 8018     exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output  end   if (@ACCTTYPE not in(1,3))  begin  select @O_iErrorState = 7943     exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output  end   select @ACTIVE = 0, @ACCTTYPE = 0  end  else  begin  select @O_iErrorState = 7864     exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output  end end  if ((@I_vDEFCACTY <> 1) and (@I_vRMCSHACTNUMST <> '')) begin  select @O_iErrorState = 7894     exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output end  if (@I_vRMARACTNUMST <> '') begin  select @RMARACC = ACTINDX from GL00105 (nolock) where ACTNUMST = @I_vRMARACTNUMST   if (@RMARACC <> 0)  begin  select @ACTIVE = ACTIVE,  @ACCTTYPE = ACCTTYPE  from GL00100 (nolock) where ACTINDX = @RMARACC   if (@ACTIVE = 0)  begin  select @O_iErrorState = 8019     exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output  end   if (@ACCTTYPE not in(1,3))  begin  select @O_iErrorState = 7944     exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output  end   select @ACTIVE = 0, @ACCTTYPE = 0  end  else  begin  select @O_iErrorState = 7865     exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output  end end  if (@I_vRMSLSACTNUMST <> '') begin  select @RMSLSACC = ACTINDX from GL00105 (nolock) where ACTNUMST = @I_vRMSLSACTNUMST   if (@RMSLSACC <> 0)  begin  select @ACTIVE = ACTIVE,  @ACCTTYPE = ACCTTYPE  from GL00100 (nolock) where ACTINDX = @RMSLSACC   if (@ACTIVE = 0)  begin  select @O_iErrorState = 7945     exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output  end   if (@ACCTTYPE not in(1,3))  begin  select @O_iErrorState = 7946     exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output  end   select @ACTIVE = 0, @ACCTTYPE = 0  end  else  begin  select @O_iErrorState = 7866     exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output  end end  if (@I_vRMCOSACTNUMST <> '') begin  select @RMCOSACC = ACTINDX from GL00105 (nolock) where ACTNUMST = @I_vRMCOSACTNUMST   if (@RMCOSACC <> 0)  begin  select @ACTIVE = ACTIVE,  @ACCTTYPE = ACCTTYPE  from GL00100 (nolock) where ACTINDX = @RMCOSACC   if (@ACTIVE = 0)  begin  select @O_iErrorState = 7947     exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output  end   if (@ACCTTYPE not in(1,3))  begin  select @O_iErrorState = 7948     exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output  end   select @ACTIVE = 0, @ACCTTYPE = 0  end  else  begin  select @O_iErrorState = 7867     exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output  end end  if (@I_vRMIVACTNUMST <> '') begin  select @RMIVACC = ACTINDX from GL00105 (nolock) where ACTNUMST = @I_vRMIVACTNUMST   if (@RMIVACC <> 0)  begin  select @ACTIVE = ACTIVE,  @ACCTTYPE = ACCTTYPE  from GL00100 (nolock) where ACTINDX = @RMIVACC   if (@ACTIVE = 0)  begin  select @O_iErrorState = 7949     exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output  end   if (@ACCTTYPE not in(1,3))  begin  select @O_iErrorState = 7950     exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output  end   select @ACTIVE = 0, @ACCTTYPE = 0  end  else  begin  select @O_iErrorState = 7868     exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output  end end  if (@I_vRMTAKACTNUMST <> '') begin  select @RMTAKACC = ACTINDX from GL00105 (nolock) where ACTNUMST = @I_vRMTAKACTNUMST   if (@RMTAKACC <> 0)  begin  select @ACTIVE = ACTIVE,  @ACCTTYPE = ACCTTYPE  from GL00100 (nolock) where ACTINDX = @RMTAKACC   if (@ACTIVE = 0)  begin  select @O_iErrorState = 7951     exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output  end   if (@ACCTTYPE not in(1,3))  begin  select @O_iErrorState = 7952     exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output  end   select @ACTIVE = 0, @ACCTTYPE = 0  end  else  begin  select @O_iErrorState = 7869     exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output  end end  if (@I_vRMAVACTNUMST <> '') begin  select @RMAVACC = ACTINDX from GL00105 (nolock) where ACTNUMST = @I_vRMAVACTNUMST   if (@RMAVACC <> 0)  begin  select @ACTIVE = ACTIVE,  @ACCTTYPE = ACCTTYPE  from GL00100 (nolock) where ACTINDX = @RMAVACC   if (@ACTIVE = 0)  begin  select @O_iErrorState = 7953     exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output  end   if (@ACCTTYPE not in(1,3))  begin  select @O_iErrorState = 7954     exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output  end   select @ACTIVE = 0, @ACCTTYPE = 0  end  else  begin  select @O_iErrorState = 7870     exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output  end end  if (@I_vRMFCGACTNUMST <> '') begin  select @RMFCGACC = ACTINDX from GL00105 (nolock) where ACTNUMST = @I_vRMFCGACTNUMST   if (@RMFCGACC <> 0)  begin  select @ACTIVE = ACTIVE,  @ACCTTYPE = ACCTTYPE  from GL00100 (nolock) where ACTINDX = @RMFCGACC   if (@ACTIVE = 0)  begin  select @O_iErrorState = 7955     exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output  end   if (@ACCTTYPE not in(1,3))  begin  select @O_iErrorState = 7956     exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output  end   select @ACTIVE = 0, @ACCTTYPE = 0  end  else  begin  select @O_iErrorState = 7871     exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output  end end  if (@I_vRMWRACTNUMST <> '') begin  select @RMWRACC = ACTINDX from GL00105 (nolock) where ACTNUMST = @I_vRMWRACTNUMST   if (@RMWRACC <> 0)  begin  select @ACTIVE = ACTIVE,  @ACCTTYPE = ACCTTYPE  from GL00100 (nolock) where ACTINDX = @RMWRACC   if (@ACTIVE = 0)  begin  select @O_iErrorState = 7957     exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output  end   if (@ACCTTYPE not in(1,3))  begin  select @O_iErrorState = 7958     exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output  end   select @ACTIVE = 0, @ACCTTYPE = 0  end  else  begin  select @O_iErrorState = 7872     exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output  end end  if (@I_vRMOvrpymtWrtoffACTNUMST <> '') begin  select @RMOvrpymtWrtoffAcctIdx = ACTINDX from GL00105 (nolock) where ACTNUMST = @I_vRMOvrpymtWrtoffACTNUMST   if (@RMOvrpymtWrtoffAcctIdx <> 0)  begin  select @ACTIVE = ACTIVE,  @ACCTTYPE = ACCTTYPE  from GL00100 (nolock) where ACTINDX = @RMOvrpymtWrtoffAcctIdx   if (@ACTIVE = 0)  begin  select @O_iErrorState = 7961     exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output  end   if (@ACCTTYPE not in(1,3))  begin  select @O_iErrorState = 7962     exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output  end   select @ACTIVE = 0, @ACCTTYPE = 0  end  else  begin  select @O_iErrorState = 7874     exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output  end end  if (@I_vRMSORACTNUMST <> '') begin  select @RMSORACC = ACTINDX from GL00105 (nolock) where ACTNUMST = @I_vRMSORACTNUMST   if (@RMSORACC <> 0)  begin  select @ACTIVE = ACTIVE,  @ACCTTYPE = ACCTTYPE  from GL00100 (nolock) where ACTINDX = @RMSORACC   if (@ACTIVE = 0)  begin  select @O_iErrorState = 7959     exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output  end   if (@ACCTTYPE not in(1,3))  begin  select @O_iErrorState = 7960     exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output  end   select @ACTIVE = 0, @ACCTTYPE = 0  end  else  begin  select @O_iErrorState = 7873     exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output  end end  if (@I_vUseCustomerClass not in(0,1)) begin  select @O_iErrorState = 7862     exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output end  if (@I_vCreateAddress not in(0,1)) begin  select @O_iErrorState = 1623     exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output end  if (@I_vUpdateIfExists not in(0,1)) begin  select @O_iErrorState = 1622     exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output end  if (@I_vRequesterTrx not in(0,1)) begin  select @O_iErrorState = 3715     exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output end  if (@I_vADRSCODE = '') begin  if (  (@I_vCNTCPRSN <> '') or  (@I_vADDRESS1 <> '') or  (@I_vADDRESS2 <> '') or  (@I_vADDRESS3 <> '') or  (@I_vCITY <> '') or  (@I_vSTATE <> '') or  (@I_vZIPCODE <> '') or  (@I_vCCode <> '') or  (@I_vCOUNTRY <> '') or  ((@I_vPHNUMBR1 <> '') and (@I_vPHNUMBR1 > '0')) or  ((@I_vPHNUMBR2 <> '') and (@I_vPHNUMBR2 > '0')) or  ((@I_vPHNUMBR3 <> '') and (@I_vPHNUMBR3 > '0')) or  ((@I_vFAX <> '') and (@I_vFAX > 0)) or  (@I_vUPSZONE <> '') or  (@I_vSHIPMTHD <> '') or  (@I_vTAXSCHID <> '')  )  begin  select @O_iErrorState = 5518     exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output  end end  select @FUNLCURR = isnull(FUNLCURR,'') from MC40000 (nolock)  if (@FUNLCURR = '') begin  select @O_iErrorState = 8005    exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output end  select @DECPLCUR = DECPLCUR - 1 from DYNAMICS..MC40200 (nolock) where CURNCYID = @FUNLCURR  if ( (@I_vFINCHDLR <> round(@I_vFINCHDLR,@DECPLCUR)) or  (@I_vMINPYDLR <> round(@I_vMINPYDLR,@DECPLCUR)) or  (@I_vCRLMTAMT <> round(@I_vCRLMTAMT,@DECPLCUR)) or  (@I_vCRLMTPAM <> round(@I_vCRLMTPAM,@DECPLCUR)) or  (@I_vMXWROFAM <> round(@I_vMXWROFAM,@DECPLCUR))) begin  select @O_iErrorState = 8006     exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output end  if (@O_iErrorState <> 0) begin  return (@O_iErrorState) end  if (@I_vRequesterTrx = 0) begin  exec @iStatus = eConnectOutVerify  @I_vDOCTYPE = 'Customer',  @I_vINDEX1 = @I_vCUSTNMBR,  @I_vINDEX2 = '',  @I_vINDEX3 = '',  @I_vINDEX4 = '',  @I_vINDEX5 = '',  @I_vINDEX6 = '',  @I_vINDEX7 = '',  @I_vINDEX8 = '',  @I_vINDEX9 = '',  @I_vINDEX10 = '',  @I_vINDEX11 = '',  @I_vINDEX12 = '',  @I_vINDEX13 = '',  @I_vINDEX14 = '',  @I_vINDEX15 = '',  @I_vDelete = 0,  @O_iErrorState = @iCustomState output  select @iError = @@error  if ((@iStatus <> 0) or (@iCustomState <> 0) or (@iError <> 0))  begin  select @oErrString = rtrim(@oErrString) + ' ' + @iCustomState  select @O_iErrorState = 2027    exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output  return (@O_iErrorState)  end end  if (@I_vSHIPMTHD <> '') begin  if (not exists (select 1 from SY03000 (nolock) where SHIPMTHD = @I_vSHIPMTHD))  begin  exec @iStatus = taCreateShippingMethod  @I_vSHIPMTHD = @I_vSHIPMTHD,  @I_vUpdateIfExists = 0,  @O_iErrorState = @iAddShippingErrState output,  @oErrString = @iAddShippingErrString output  select @iError = @@error  if ((@iStatus <> 0) or (@iAddShippingErrState <> 0) or (@iError <> 0))  begin  select @oErrString = rtrim(@oErrString) + ' ' + @iAddShippingErrString  select @O_iErrorState = 175     exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output  return (@O_iErrorState)  end  end end  if (@exists = 0) begin  exec @iStatus = DYNAMICS..tasmGetNextNoteIndex  @I_sCompanyID = @sCompanyID,  @I_iSQLSessionID = 0,  @I_noteincrement = 1,  @O_mNoteIndex = @nNextNoteIndex output,  @O_iErrorState = @iGetNextNoteIdxErrState output  select @iError = @@error  if ((@iStatus <> 0) or (@iGetNextNoteIdxErrState <> 0) or (@iError <> 0))  begin  select @oErrString = rtrim(@oErrString) + ' ' + @iGetNextNoteIdxErrState  select @O_iErrorState = 6541    exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output  return (@O_iErrorState)  end end  select @I_vFNCHPCNT = @I_vFNCHPCNT * 100,  @I_vMINPYPCT = @I_vMINPYPCT * 100,  @I_vCUSTDISC = @I_vCUSTDISC * 100  if (@exists = 0) begin  insert RM00101  (  CUSTNMBR,  CUSTNAME,  CUSTCLAS,  CPRCSTNM,  CNTCPRSN,  STMTNAME,  SHRTNAME,  ADRSCODE,  UPSZONE,  SHIPMTHD,  TAXSCHID,  ADDRESS1,  ADDRESS2,  ADDRESS3,  COUNTRY,  CITY,  STATE,  ZIP,  PHONE1,  PHONE2,  PHONE3,  FAX,  PRBTADCD,  PRSTADCD,  STADDRCD,  SLPRSNID,  CHEKBKID,  PYMTRMID,  CRLMTTYP,  CRLMTAMT,  CRLMTPER,  CRLMTPAM,  CURNCYID,  RATETPID,  CUSTDISC,  PRCLEVEL,  MINPYTYP,  MINPYDLR,  MINPYPCT,  FNCHATYP,  FNCHPCNT,  FINCHDLR,  MXWOFTYP,  MXWROFAM,  COMMENT1,  COMMENT2,  USERDEF1,  USERDEF2,  TAXEXMT1,  TAXEXMT2,  TXRGNNUM,  BALNCTYP,  STMTCYCL,  BANKNAME,  BNKBRNCH,  SALSTERR,  DEFCACTY,  RMCSHACC,  RMARACC,  RMSLSACC,  RMIVACC,  RMCOSACC,  RMTAKACC,  RMAVACC,  RMFCGACC,  RMWRACC,  RMSORACC,  FRSTINDT,  INACTIVE,  HOLD,  CRCARDID,  CRCRDNUM,  CCRDXPDT,  KPDSTHST,  KPCALHST,  KPERHIST,  KPTRXHST,  NOTEINDX,  CREATDDT,  MODIFDT,  Revalue_Customer,  Post_Results_To,  FINCHID,  GOVCRPID,  GOVINDID,  DISGRPER,  DUEGRPER,  DOCFMTID,  Send_Email_Statements,  USERLANG,  GPSFOINTEGRATIONID,  INTEGRATIONSOURCE,  INTEGRATIONID,  ORDERFULFILLDEFAULT,  CUSTPRIORITY,  CCode,  DECLID,  RMOvrpymtWrtoffAcctIdx,  SHIPCOMPLETE,  CBVAT,  INCLUDEINDP  )  select  @I_vCUSTNMBR,     @I_vCUSTNAME,     @I_vCUSTCLAS,     '',      @I_vCNTCPRSN,     @I_vSTMTNAME,     @I_vSHRTNAME,     @I_vADRSCODE,     @I_vUPSZONE,     @I_vSHIPMTHD,     @I_vTAXSCHID,     @I_vADDRESS1,     @I_vADDRESS2,     @I_vADDRESS3,     @I_vCOUNTRY,     @I_vCITY,     @I_vSTATE,     @I_vZIPCODE,     @I_vPHNUMBR1,     @I_vPHNUMBR2,     @I_vPHNUMBR3,     @I_vFAX,     @I_vPRBTADCD,     @I_vPRSTADCD,     @I_vSTADDRCD,     @I_vSLPRSNID,     @I_vCHEKBKID,     @I_vPYMTRMID,     @I_vCRLMTTYP,     @I_vCRLMTAMT,     @I_vCRLMTPER,     @I_vCRLMTPAM,     @I_vCURNCYID,     @I_vRATETPID,     @I_vCUSTDISC,     @I_vPRCLEVEL,     @I_vMINPYTYP,     @I_vMINPYDLR,     @I_vMINPYPCT,     @I_vFNCHATYP,     @I_vFNCHPCNT,     @I_vFINCHDLR,     @I_vMXWOFTYP,     @I_vMXWROFAM,     @I_vCOMMENT1,     @I_vCOMMENT2,     @I_vUSERDEF1,     @I_vUSERDEF2,     @I_vTAXEXMT1,     @I_vTAXEXMT2,     @I_vTXRGNNUM,     @I_vBALNCTYP,     @I_vSTMTCYCL,     @I_vBANKNAME,     @I_vBNKBRNCH,     @I_vSALSTERR,     @I_vDEFCACTY,     @RMCSHACC,     @RMARACC,     @RMSLSACC,     @RMIVACC,     @RMCOSACC,     @RMTAKACC,     @RMAVACC,     @RMFCGACC,     @RMWRACC,     @RMSORACC,     '',      @I_vINACTIVE,     @I_vHOLD,     @I_vCRCARDID,     @I_vCRCRDNUM,     @I_vCCRDXPDT,     @I_vKPDSTHST,     @I_vKPCALHST,     @I_vKPERHIST,     @I_vKPTRXHST,     @nNextNoteIndex,    @ActualDate,     @ActualDate,     @I_vRevalue_Customer,    @I_vPost_Results_To,    '',      '',      '',      @I_vDISGRPER,     @I_vDUEGRPER,     '',      @I_vSend_Email_Statements,   @I_vUSERLANG,     @I_vGPSFOINTEGRATIONID,    @I_vINTEGRATIONSOURCE,    @I_vINTEGRATIONID,    @I_vORDERFULFILLDEFAULT,   @I_vCUSTPRIORITY,    @I_vCCode,     '',      @RMOvrpymtWrtoffAcctIdx,   @I_vSHIPCOMPLETE,    0,      @I_vINCLUDEINDP     if @@error <> 0  begin  select @O_iErrorState = 479    exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output  return (@O_iErrorState)  end   if (@exists = 0)  begin  insert RM00103  (CUSTNMBR)  select @I_vCUSTNMBR  if @@error <> 0  begin  select @O_iErrorState = 435    exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output  return (@O_iErrorState)  end  end end else begin  select @lock = CUSTNMBR from RM00101 with (updlock index(PKRM00101)) where CUSTNMBR = @I_vCUSTNMBR   update RM00101 set  CUSTNAME = @I_vCUSTNAME,  CUSTCLAS = @I_vCUSTCLAS,  CNTCPRSN = @I_vCNTCPRSN,  CPRCSTNM = @CPRCSTNM,  STMTNAME = @I_vSTMTNAME,  SHRTNAME = @I_vSHRTNAME,  ADRSCODE = @I_vADRSCODE,  UPSZONE = @I_vUPSZONE,  SHIPMTHD = @I_vSHIPMTHD,  TAXSCHID = @I_vTAXSCHID,  ADDRESS1 = @I_vADDRESS1,  ADDRESS2 = @I_vADDRESS2,  ADDRESS3 = @I_vADDRESS3,  COUNTRY = @I_vCOUNTRY,  CITY = @I_vCITY,  STATE = @I_vSTATE,  ZIP = @I_vZIPCODE,  PHONE1 = @I_vPHNUMBR1,  PHONE2 = @I_vPHNUMBR2,  PHONE3 = @I_vPHNUMBR3,  FAX = @I_vFAX,  PRBTADCD = @I_vPRBTADCD,  PRSTADCD = @I_vPRSTADCD,  STADDRCD = @I_vSTADDRCD,  SLPRSNID = @I_vSLPRSNID,  CHEKBKID = @I_vCHEKBKID,  PYMTRMID = @I_vPYMTRMID,  CRLMTTYP = @I_vCRLMTTYP,  CRLMTAMT = @I_vCRLMTAMT,  CRLMTPER = @I_vCRLMTPER,  CRLMTPAM = @I_vCRLMTPAM,  CURNCYID = @I_vCURNCYID,  RATETPID = @I_vRATETPID,  CUSTDISC = @I_vCUSTDISC,  PRCLEVEL = @I_vPRCLEVEL,  MINPYTYP = @I_vMINPYTYP,  MINPYDLR = @I_vMINPYDLR,  MINPYPCT = @I_vMINPYPCT,  FNCHATYP = @I_vFNCHATYP,  FNCHPCNT = @I_vFNCHPCNT,  FINCHDLR = @I_vFINCHDLR,  MXWOFTYP = @I_vMXWOFTYP,  MXWROFAM = @I_vMXWROFAM,  COMMENT1 = @I_vCOMMENT1,  COMMENT2 = @I_vCOMMENT2,  USERDEF1 = @I_vUSERDEF1,  USERDEF2 = @I_vUSERDEF2,  TAXEXMT1 = @I_vTAXEXMT1,  TAXEXMT2 = @I_vTAXEXMT2,  TXRGNNUM = @I_vTXRGNNUM,  BALNCTYP = @I_vBALNCTYP,  STMTCYCL = @I_vSTMTCYCL,  BANKNAME = @I_vBANKNAME,  BNKBRNCH = @I_vBNKBRNCH,  SALSTERR = @I_vSALSTERR,  DEFCACTY = @I_vDEFCACTY,  RMCSHACC = @RMCSHACC,  RMARACC = @RMARACC,  RMSLSACC = @RMSLSACC,  RMIVACC = @RMIVACC,  RMCOSACC = @RMCOSACC,  RMTAKACC = @RMTAKACC,  RMAVACC = @RMAVACC,  RMFCGACC = @RMFCGACC,  RMWRACC = @RMWRACC,  RMSORACC = @RMSORACC,  INACTIVE = @I_vINACTIVE,  HOLD = @I_vHOLD,  CRCARDID = @I_vCRCARDID,  CRCRDNUM = @I_vCRCRDNUM,  CCRDXPDT = @I_vCCRDXPDT,  KPDSTHST = @I_vKPDSTHST,  KPCALHST = @I_vKPCALHST,  KPERHIST = @I_vKPERHIST,  KPTRXHST = @I_vKPTRXHST,  NOTEINDX = @nNextNoteIndex,  MODIFDT = @ActualDate,  Revalue_Customer = @I_vRevalue_Customer,  Post_Results_To = @I_vPost_Results_To,  DISGRPER = @I_vDISGRPER,  DUEGRPER = @I_vDUEGRPER,  Send_Email_Statements = @I_vSend_Email_Statements,  USERLANG = @I_vUSERLANG,  GPSFOINTEGRATIONID = @I_vGPSFOINTEGRATIONID,  INTEGRATIONSOURCE = @I_vINTEGRATIONSOURCE,  INTEGRATIONID = @I_vINTEGRATIONID,  ORDERFULFILLDEFAULT = @I_vORDERFULFILLDEFAULT,  CUSTPRIORITY = @I_vCUSTPRIORITY,  CCode = @I_vCCode,  RMOvrpymtWrtoffAcctIdx = @RMOvrpymtWrtoffAcctIdx,  SHIPCOMPLETE = @I_vSHIPCOMPLETE,  INCLUDEINDP = @I_vINCLUDEINDP  where CUSTNMBR = @I_vCUSTNMBR  if (@@error <> 0)  begin  select @O_iErrorState = 93    exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output  return (@O_iErrorState)  end end  if ((@ChangeToEmail_Recipient = 1) or (@ChangeCcEmail_Recipient = 1) or (@ChangeBccEmail_Recipient = 1)) begin  create table #RM00106 (Email_Type smallint, Email_Recipient varchar(80), DEX_ROW_ID int IDENTITY (1,1)) end  if (@ChangeToEmail_Recipient = 1) begin  select @Length = len(@I_vToEmail_Recipient),  @Position2 = patindex('%'+';'+'%',substring(@I_vToEmail_Recipient, @Position1, 80))   while ((@Position2 <> 0) or (@Position2 < @Length))  begin  if (@Position2 = 0)  begin  insert #RM00106  (Email_Type, Email_Recipient)  select  1, ltrim(substring(@I_vToEmail_Recipient, @Position1, @Length))  break  end  else  begin  insert #RM00106  (Email_Type, Email_Recipient)  select  1, ltrim(substring(@I_vToEmail_Recipient, @Position1,@Position2 - 1))  end   select @Position1 = @Position1 + @Position2,  @Position2 = patindex('%'+';'+'%',substring(@I_vToEmail_Recipient, @Position1, 80))   if ((@Position2 = 0) and (@Position2 < @Length))  begin  insert #RM00106  (Email_Type, Email_Recipient)  select  1, ltrim(substring(@I_vToEmail_Recipient, @Position1, @Length))  break  end  end   delete RM00106 where CUSTNMBR = @I_vCUSTNMBR and Email_Type = 1 and CUSTNMBR+cast(Email_Type as varchar)+Email_Recipient  not in(select CUSTNMBR+cast(Email_Type as varchar)+Email_Recipient from #RM00106 where CUSTNMBR = @I_vCUSTNMBR and Email_Type = 1)  if (@@error <> 0)  begin  select @O_iErrorState = 5888    exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output  return (@O_iErrorState)  end   insert RM00106   (  CUSTNMBR,  Email_Type,  Email_Recipient  )  select  @I_vCUSTNMBR,  Email_Type,  Email_Recipient  from #RM00106  where cast(Email_Type as varchar)+Email_Recipient  not in(select cast(Email_Type as varchar)+Email_Recipient from RM00106 where CUSTNMBR = @I_vCUSTNMBR and Email_Type = 1)  if (@@error <> 0)  begin  select @O_iErrorState = 5890    exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output  return (@O_iErrorState)  end   truncate table #RM00106 end  if (@ChangeCcEmail_Recipient = 1) begin  select @Position1 = 1,  @Length = len(@I_vCcEmail_Recipient),  @Position2 = patindex('%'+';'+'%',substring(@I_vCcEmail_Recipient, @Position1, 80))   while ((@Position2 <> 0) or (@Position2 < @Length))  begin  if (@Position2 = 0)  begin  insert #RM00106  (Email_Type, Email_Recipient)  select  2, ltrim(substring(@I_vCcEmail_Recipient, @Position1, @Length))  break  end  else  begin  insert #RM00106  (Email_Type, Email_Recipient)  select  2, ltrim(substring(@I_vCcEmail_Recipient, @Position1, @Position2 - 1))  end   select @Position1 = @Position1 + @Position2,  @Position2 = patindex('%'+';'+'%',substring(@I_vCcEmail_Recipient, @Position1, 80))   if ((@Position2 = 0) and (@Position2 < @Length))  begin  insert #RM00106  (Email_Type, Email_Recipient)  select  2, ltrim(substring(@I_vCcEmail_Recipient, @Position1, @Length))  break  end  end   delete RM00106 where CUSTNMBR = @I_vCUSTNMBR and Email_Type = 2 and CUSTNMBR+cast(Email_Type as varchar)+Email_Recipient  not in(select CUSTNMBR+cast(Email_Type as varchar)+Email_Recipient from #RM00106 where CUSTNMBR = @I_vCUSTNMBR and Email_Type = 2)  if (@@error <> 0)  begin  select @O_iErrorState = 5892    exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output  return (@O_iErrorState)  end   insert RM00106   (  CUSTNMBR,  Email_Type,  Email_Recipient  )  select  @I_vCUSTNMBR,  Email_Type,  Email_Recipient  from #RM00106  where cast(Email_Type as varchar)+Email_Recipient  not in(select cast(Email_Type as varchar)+Email_Recipient from RM00106 where CUSTNMBR = @I_vCUSTNMBR and Email_Type = 2)  if (@@error <> 0)  begin  select @O_iErrorState = 5891    exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output  return (@O_iErrorState)  end   truncate table #RM00106 end  if (@ChangeBccEmail_Recipient = 1) begin  select @Position1 = 1,  @Length = len(@I_vBccEmail_Recipient),  @Position2 = patindex('%'+';'+'%',substring(@I_vBccEmail_Recipient, @Position1, 80))   while ((@Position2 <> 0) or (@Position2 < @Length))  begin  if (@Position2 = 0)  begin  insert #RM00106  (Email_Type, Email_Recipient)  select  3, ltrim(substring(@I_vBccEmail_Recipient, @Position1, @Length))  break  end  else  begin  insert #RM00106  (Email_Type, Email_Recipient)  select  3, ltrim(substring(@I_vBccEmail_Recipient, @Position1, @Position2 - 1))  end   select @Position1 = @Position1 + @Position2,  @Position2 = patindex('%'+';'+'%',substring(@I_vBccEmail_Recipient, @Position1, 80))   if ((@Position2 = 0) and (@Position2 < @Length))  begin  insert #RM00106  (Email_Type, Email_Recipient)  select  3, ltrim(substring(@I_vBccEmail_Recipient, @Position1, @Length))  break  end  end   delete RM00106 where CUSTNMBR = @I_vCUSTNMBR and Email_Type = 3 and CUSTNMBR+cast(Email_Type as varchar)+Email_Recipient  not in(select CUSTNMBR+cast(Email_Type as varchar)+Email_Recipient from #RM00106 where CUSTNMBR = @I_vCUSTNMBR and Email_Type = 3)  if (@@error <> 0)  begin  select @O_iErrorState = 5887    exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output  return (@O_iErrorState)  end   insert RM00106   (  CUSTNMBR,  Email_Type,  Email_Recipient  )  select  @I_vCUSTNMBR,  Email_Type,  Email_Recipient  from #RM00106  where cast(Email_Type as varchar)+Email_Recipient  not in(select cast(Email_Type as varchar)+Email_Recipient from RM00106 where CUSTNMBR = @I_vCUSTNMBR and Email_Type = 3)  if (@@error <> 0)  begin  select @O_iErrorState = 5886    exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output  return (@O_iErrorState)  end   truncate table #RM00106 end  if (@I_vSend_Email_Statements = 1) begin  if (not exists(select top 1 1 from RM00106 where CUSTNMBR = @I_vCUSTNMBR))  begin  select @O_iErrorState = 8159     exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output  end end  if (@I_vNOTETEXT <> '') begin  if (not exists(select top 1 NOTEINDX from SY03900 (nolock) where NOTEINDX = @nNextNoteIndex))  begin  insert SY03900   (  NOTEINDX,   DATE1,   TIME1,   TXTFIELD  )   select   @nNextNoteIndex,  @ActualDate,  @ActualTime,  @I_vNOTETEXT  if (@@error <> 0)  begin  select @O_iErrorState = 119    exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output  return (@O_iErrorState)  end  end  else  begin  update SY03900 set  DATE1 = @ActualDate,  TIME1 = @ActualTime,  TXTFIELD = @I_vNOTETEXT  where NOTEINDX = @nNextNoteIndex  if (@@error <> 0)  begin  select @O_iErrorState = 971    exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output  return (@O_iErrorState)  end  end end else begin  delete SY03900 where NOTEINDX = @nNextNoteIndex  if (@@error <> 0)  begin  select @O_iErrorState = 7890    exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output  return (@O_iErrorState)  end end  if (@I_vADRSCODE <> '') begin  if (not exists(select 1 from RM00102 (nolock) where CUSTNMBR = @I_vCUSTNMBR and ADRSCODE = @I_vADRSCODE))  begin  if (@I_vCreateAddress = 0)  begin  select @O_iErrorState = 1406     exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output  return (@O_iErrorState)  end  else  begin  exec @iStatus = taCreateCustomerAddress  @I_vCUSTNMBR = @I_vCUSTNMBR,   @I_vADRSCODE = @I_vADRSCODE,  @I_vCNTCPRSN = @I_vCNTCPRSN,  @I_vSHIPMTHD = @I_vSHIPMTHD,     @I_vSLPRSNID = @I_vSLPRSNID,     @I_vADDRESS1 = @I_vADDRESS1,  @I_vADDRESS2 = @I_vADDRESS2,  @I_vADDRESS3 = @I_vADDRESS3,  @I_vCITY = @I_vCITY,  @I_vSTATE = @I_vSTATE,  @I_vZIPCODE = @I_vZIPCODE,  @I_vCOUNTRY = @I_vCOUNTRY,  @I_vUPSZONE = @I_vUPSZONE,  @I_vPHNUMBR1 = @I_vPHNUMBR1,  @I_vPHNUMBR2 = @I_vPHNUMBR2,  @I_vPHNUMBR3 = @I_vPHNUMBR3,     @I_vFAX = @I_vFAX,  @I_vTAXSCHID = @I_vTAXSCHID,  @I_vCCode = @I_vCCode,  @I_vSALSTERR = @I_vSALSTERR,  @I_vRequesterTrx = 1,  @O_iErrorState = @iAddAddressErrState output,  @oErrString = @iAddAddressErrString output  select @iError = @@error  if ((@iStatus <> 0) or (@iAddAddressErrState <> 0) or (@iError <> 0))  begin  select @oErrString = rtrim(@oErrString) + ' ' + @iAddAddressErrString  select @O_iErrorState = 142     exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output  return (@O_iErrorState)  end  end  end  else  begin  if (@I_vUpdateIfExists = 1)  begin  select @USERDEF1 = USERDEF1,    @USERDEF2 = USERDEF2,    @LOCNCODE = LOCNCODE    from RM00102 where CUSTNMBR = @I_vCUSTNMBR and ADRSCODE = @I_vADRSCODE   exec @iStatus = taCreateCustomerAddress  @I_vCUSTNMBR = @I_vCUSTNMBR,   @I_vADRSCODE = @I_vADRSCODE,  @I_vCNTCPRSN = @I_vCNTCPRSN,  @I_vSHIPMTHD = @I_vSHIPMTHD,     @I_vSLPRSNID = @I_vSLPRSNID,     @I_vADDRESS1 = @I_vADDRESS1,  @I_vADDRESS2 = @I_vADDRESS2,  @I_vADDRESS3 = @I_vADDRESS3,  @I_vCITY = @I_vCITY,  @I_vSTATE = @I_vSTATE,  @I_vZIPCODE = @I_vZIPCODE,  @I_vCOUNTRY = @I_vCOUNTRY,  @I_vUPSZONE = @I_vUPSZONE,  @I_vPHNUMBR1 = @I_vPHNUMBR1,  @I_vPHNUMBR2 = @I_vPHNUMBR2,  @I_vPHNUMBR3 = @I_vPHNUMBR3,  @I_vFAX = @I_vFAX,  @I_vTAXSCHID = @I_vTAXSCHID,  @I_vCCode = @I_vCCode,  @I_vSALSTERR = @I_vSALSTERR,  @I_vRequesterTrx = 1,  @I_vUSERDEF1 = @USERDEF1,  @I_vUSERDEF2 = @USERDEF2,  @I_vLOCNCODE = @LOCNCODE,  @O_iErrorState = @iAddAddressErrState output,  @oErrString = @iAddAddressErrString output  select @iError = @@error  if ((@iStatus <> 0) or (@iAddAddressErrState <> 0) or (@iError <> 0))  begin  select @oErrString = rtrim(@oErrString) + ' ' + @iAddAddressErrString  select @O_iErrorState = 3692     exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output  return (@O_iErrorState)  end  end  end end  if (@I_vPRSTADCD <> '') begin  if (not exists(select 1 from RM00102 (nolock) where CUSTNMBR = @I_vCUSTNMBR and ADRSCODE = @I_vPRSTADCD))  begin  if (@I_vCreateAddress = 0)  begin  select @O_iErrorState = 1408     exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output  return (@O_iErrorState)  end  else  begin  exec @iStatus = taCreateCustomerAddress  @I_vCUSTNMBR = @I_vCUSTNMBR,   @I_vADRSCODE = @I_vPRSTADCD,  @I_vRequesterTrx = 1,  @O_iErrorState = @iAddAddressErrState output,  @oErrString = @iAddAddressErrString output  select @iError = @@error  if ((@iStatus <> 0) or (@iAddAddressErrState <> 0) or (@iError <> 0))  begin  select @oErrString = rtrim(@oErrString) + ' ' + @iAddAddressErrString  select @O_iErrorState = 145     exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output  return (@O_iErrorState)  end  end  end end  if (@I_vPRBTADCD <> '') begin  if (not exists(select 1 from RM00102 (nolock) where CUSTNMBR = @I_vCUSTNMBR and ADRSCODE = @I_vPRBTADCD))  begin  if (@I_vCreateAddress = 0)  begin  select @O_iErrorState = 1407     exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output  return (@O_iErrorState)  end  else  begin  exec @iStatus = taCreateCustomerAddress  @I_vCUSTNMBR = @I_vCUSTNMBR,   @I_vADRSCODE = @I_vPRBTADCD,  @I_vRequesterTrx = 1,  @O_iErrorState = @iAddAddressErrState output,  @oErrString = @iAddAddressErrString output  select @iError = @@error  if ((@iStatus <> 0) or (@iAddAddressErrState <> 0) or (@iError <> 0))  begin  select @oErrString = rtrim(@oErrString) + ' ' + @iAddAddressErrString  select @O_iErrorState = 144     exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output  return (@O_iErrorState)  end  end  end end  if (@I_vSTADDRCD <> '') begin  if (not exists(select 1 from RM00102 (nolock) where CUSTNMBR = @I_vCUSTNMBR and ADRSCODE = @I_vSTADDRCD))  begin  if (@I_vCreateAddress = 0)  begin  select @O_iErrorState = 1405     exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output  return (@O_iErrorState)  end  else  begin  exec @iStatus = taCreateCustomerAddress  @I_vCUSTNMBR = @I_vCUSTNMBR,   @I_vADRSCODE = @I_vSTADDRCD,  @I_vRequesterTrx = 1,  @O_iErrorState = @iAddAddressErrState output,  @oErrString = @iAddAddressErrString output  select @iError = @@error  if ((@iStatus <> 0) or (@iAddAddressErrState <> 0) or (@iError <> 0))  begin  select @oErrString = rtrim(@oErrString) + ' ' + @iAddAddressErrString  select @O_iErrorState = 143     exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output  return (@O_iErrorState)  end  end  end end  if @O_iErrorState <> 0 begin  return (@O_iErrorState) end  exec @iStatus = taUpdateCreateCustomerRcdPost  @I_vCUSTNMBR,  @I_vHOLD,  @I_vINACTIVE,  @I_vCUSTNAME,  @I_vSHRTNAME,  @I_vSTMTNAME,  @I_vCUSTCLAS,  @I_vCUSTPRIORITY,  @I_vADRSCODE,  @I_vCNTCPRSN,  @I_vADDRESS1,  @I_vADDRESS2,  @I_vADDRESS3,  @I_vCITY,  @I_vSTATE,  @I_vZIPCODE,  @I_vCCode,  @I_vCOUNTRY,  @I_vPHNUMBR1,  @I_vPHNUMBR2,  @I_vPHNUMBR3,  @I_vFAX,  @I_vUPSZONE,  @I_vSHIPMTHD,  @I_vTAXSCHID,  @I_vSHIPCOMPLETE,  @I_vPRSTADCD,  @I_vPRBTADCD,  @I_vSTADDRCD,  @I_vSLPRSNID,  @I_vSALSTERR,  @I_vUSERDEF1,  @I_vUSERDEF2,  @I_vCOMMENT1,  @I_vCOMMENT2,  @I_vCUSTDISC,  @I_vPYMTRMID,  @I_vDISGRPER,  @I_vDUEGRPER,  @I_vPRCLEVEL,  @I_vNOTETEXT,  @I_vBALNCTYP,  @I_vFNCHATYP,  @I_vFNCHPCNT,  @I_vFINCHDLR,  @I_vMINPYTYP,  @I_vMINPYPCT,  @I_vMINPYDLR,  @I_vCRLMTTYP,  @I_vCRLMTAMT,  @I_vCRLMTPER,  @I_vCRLMTPAM,  @I_vMXWOFTYP,  @I_vMXWROFAM,  @I_vRevalue_Customer,  @I_vPost_Results_To,  @I_vORDERFULFILLDEFAULT,  @I_vINCLUDEINDP,  @I_vCRCARDID,  @I_vCRCRDNUM,  @I_vCCRDXPDT,  @I_vBANKNAME,  @I_vBNKBRNCH,  @I_vUSERLANG,  @I_vTAXEXMT1,  @I_vTAXEXMT2,  @I_vTXRGNNUM,  @I_vCURNCYID,  @I_vRATETPID,  @I_vSTMTCYCL,  @I_vKPCALHST,  @I_vKPERHIST,  @I_vKPTRXHST,  @I_vKPDSTHST,  @I_vSend_Email_Statements,  @I_vToEmail_Recipient,  @I_vCcEmail_Recipient,  @I_vBccEmail_Recipient,  @I_vCHEKBKID,  @I_vDEFCACTY,  @I_vRMCSHACTNUMST,  @I_vRMARACTNUMST,  @I_vRMSLSACTNUMST,  @I_vRMCOSACTNUMST,  @I_vRMIVACTNUMST,  @I_vRMTAKACTNUMST,  @I_vRMAVACTNUMST,  @I_vRMFCGACTNUMST,  @I_vRMWRACTNUMST,  @I_vRMSORACTNUMST,  @I_vRMOvrpymtWrtoffACTNUMST,  @I_vGPSFOINTEGRATIONID,  @I_vINTEGRATIONSOURCE,  @I_vINTEGRATIONID,  @I_vUseCustomerClass,  @I_vCreateAddress,  @I_vUpdateIfExists,  @I_vRequesterTrx,  @I_vUSRDEFND1,  @I_vUSRDEFND2,  @I_vUSRDEFND3,  @I_vUSRDEFND4,  @I_vUSRDEFND5,  @O_iErrorState = @iCustomState output,  @oErrString = @iCustomErrString output select @iError = @@error if ((@iStatus <> 0) or (@iCustomState <> 0) or (@iError <> 0)) begin  select @oErrString = rtrim(@oErrString) + ' ' + @iCustomErrString  select @O_iErrorState = 28    exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output  return (@O_iErrorState) end  if (@I_vRequesterTrx =0) begin  exec @iStatus = eConnectOutVerify  @I_vDOCTYPE = 'Customer',  @I_vINDEX1 = @I_vCUSTNMBR,  @I_vINDEX2 = '',  @I_vINDEX3 = '',  @I_vINDEX4 = '',  @I_vINDEX5 = '',  @I_vINDEX6 = '',  @I_vINDEX7 = '',  @I_vINDEX8 = '',  @I_vINDEX9 = '',  @I_vINDEX10 = '',  @I_vINDEX11 = '',  @I_vINDEX12 = '',  @I_vINDEX13 = '',  @I_vINDEX14 = '',  @I_vINDEX15 = '',  @I_vDelete = 1,  @O_iErrorState = @iCustomState output  select @iError = @@error  if ((@iStatus <> 0) or (@iCustomState <> 0) or (@iError <> 0))  begin  select @oErrString = rtrim(@oErrString) + ' ' + @iCustomState  select @O_iErrorState = 2028    exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output  return (@O_iErrorState)  end end  return (@O_iErrorState)   
GO
GRANT EXECUTE ON  [dbo].[taUpdateCreateCustomerRcd] TO [DYNGRP]
GO
