SET QUOTED_IDENTIFIER OFF
GO
SET ANSI_NULLS ON
GO
 CREATE Procedure [dbo].[SVC_Transfer_ContractToHistory]  (@CONSTS smallint,  @CONTNBR char(11),  @Version smallint OUTPUT,  @FromRoutine tinyint,  @AutoRenew tinyint)  AS  declare @MoveDist tinyint declare @Line numeric (19,5) declare @InvoiceLine int declare @Year smallint declare @Period smallint declare @LineSeq int declare @SopType smallint declare @SopNumber char(21) declare @DistType smallint declare @Schedule char(9) declare @OPTTYPE char(11) declare @UserID char(21) declare @TransferStatus int  if (exists(select * from SVC00600 where CONSTS = @CONSTS and CONTNBR = @CONTNBR)) BEGIN  select @MoveDist = SVC_DistHistory_Contract from SVC00998   select @Version = Max(SVC_Contract_Version)+1 from SVC30600 where CONSTS = @CONSTS and CONTNBR = @CONTNBR  if @Version is null select @Version = 1   if @AutoRenew = 1 select @TransferStatus = 3 else select @TransferStatus = null   INSERT INTO SVC30600 with (rowlock) select  CONSTS, CONTNBR, isnull(@TransferStatus, Contract_Transfer_Status), Contract_Transfer_Date, TAXSCHID, priorityLevel,  ADRSCODE, NOTEINDX, TIMEZONE, CONTPRC, RENCNTTYP, RENPRCSCHD, PCTCRYFWD, FRZEND, FRXSTRT,  MXINCPCT, BLKTIM, VALTIM, DSCPCTAM, COMDLRAM, COUNTRY, PRCSTAT, PORDNMBR, DSCRIPTN, PARTPCT,  LABPCT, MISCPCT, PMMSCPCT, PMPRTPCT, PMLABPCT, VENDORID, RETNAGAM, RTNBILLD, SLPRSNID,  COMMCODE, COMPRCNT, BILSTRT, BILEND, BILLNGTH, BILPRD, TOTAL, FRSTBLDTE, Last_Amount_Billed,  LSTBLDTE, NBRCAL, ACTCAL, TOTVALCAL, CONTACT, CURNCYID, NXTBLDTE, CNTTYPE, PRICSHED, CUSTNMBR,  ENTDTE, MINBIL, MAXBIL, MAXBILL, AUTOREN, MSTCNTRCT, SRVTYPE, BILFRRET, TOTBIL, PREPAID,  BILONDY, BILCYC, UOFM, BILSTAT, ENTTME, STRTDATE, ENDDATE, CNTCOVPD_1, CNTCOVPD_2, CNTCOVPD_3,  CNTCOVPD_4, CNTCOVPD_5, CNTCOVPD_6, CNTCOVPD_7, Contract_Coverage_Period_1, Contract_Coverage_Period_2,  Contract_Coverage_Period_3, Contract_Coverage_Period_4, Contract_Coverage_Period_5, Contract_Coverage_Period_6,  Contract_Coverage_Period_7, USECVPD_1, USECVPD_2, USECVPD_3, USECVPD_4, USECVPD_5, USECVPD_6, USECVPD_7,  Contract_Length, Contract_Period, Invoiced_Amount, Liabiltiy_Reduction, Amount_To_Invoice, Liability_Amount,  Total_Liability_Amount, NUMOFINV, Quote_Status, QUOEXPDA, Credit_Hold, TAXEXMT1, TAXEXMT2, New_PO_Required,  Contract_Renewal_Contact, Source_Contract_Number, Source_Contract_Type, Contract_Response_Time, Liability_Months,  Next_Liability_Date, Last_Liability_Date, Total_Liability_Billed, Total_Unit, Created_User_ID, Source_User_ID,  SVC_Contract_Signed, SVC_Liability_Type, RETTYPE, Location_Segment, Bill_To_Customer, SVC_Invoice_Detail,  USERDEF1, USERDEF2, USRDEF03, USRDEF04, USRDEF05, SVC_Bill_To_Address_Code, DSCDLRAM, SVC_Paid_Contract,  SVC_Discount_Recognized, SVC_Discount_Remaining, SVC_Discount_Next,  CURRNIDX,  RATETPID,EXGTBLID,XCHGRATE, EXCHDATE,DECPLACS,TIME1,RATECALC, VIEWMODE, ISMCTRX,  EXPNDATE,DENXRATE,MCTRXSTT,ORIGVALTIM,ORCOMAMT,ORIGRETNAGAM,ORIGRTNBILLD,ORIGTOTAL,  ORIGLASTAmountBilled,ORIGTOTVALCAL,ORIGMINBIL,ORIGMAXBIL,Originating_Max_Billable,  ORIGTOTBIL,Orig_Invoiced_Amount,Orig_Amount_To_Invoice,  Orig_Liability_Amount,OrigTotLiabilityAmount,OrigTotLiabBilled,Originating_Total_Unit,  ORDDLRAT,OrigDiscountReceived,OrigDiscountRemaining,OrigDiscountNext,  SmoothInvoiceCalc,SmoothRevenueCalc,SVC_Use_Same_Number,SVC_FO_ID,SVC_Invoiced_Cost,Orig_SVC_Invoiced_Cost, @Version,  SVC_Evergreen_Contract, SVC_Evergreen_RenewLimit, SVC_Evergreen_Renewals, SVC_New_Contract_Number, SVC_New_PO_Number,  Workflow_Approval_Status, Workflow_Priority, svcBillingFrequency, svcFrequencyQty  FROM SVC00600 where CONSTS = @CONSTS and CONTNBR = @CONTNBR  if @@error <> 0 goto baderror  declare cursor_601 cursor for select LNSEQNBR from SVC00601 where CONSTS = @CONSTS and CONTNBR = @CONTNBR open cursor_601  FETCH NEXT FROM cursor_601 INTO @Line  while @@FETCH_STATUS = 0  BEGIN  INSERT INTO SVC30601 with (rowlock)  select  CONSTS, CONTNBR, LNSEQNBR, Contract_Transfer_Status, Contract_Transfer_Date, CNTPRCOVR,  NOTEINDX, ADRSCODE, QUANTITY, ITEMNMBR, CONFGREF, EQUIPID, SERLNMBR, FRZEND, FRXSTRT,  BLKTIM, VALTIM, DSCPCTAM, COMDLRAM, COUNTRY, PRCSTAT, PORDNMBR, DSCRIPTN, PARTPCT, LABPCT,  MISCPCT, PMMSCPCT, PMPRTPCT, PMLABPCT, VENDORID, RETNAGAM, RTNBILLD, SLPRSNID, COMMCODE,  COMPRCNT, BILSTRT, BILEND, BILLNGTH, BILPRD, FRSTBLDTE, Last_Amount_Billed, LSTBLDTE,  NBRCAL, TOTAL, ACTCAL, TOTVALCAL, CONTACT, CURNCYID, NXTBLDTE, CNTTYPE, PRICSHED, CUSTNMBR,  ENTDTE, MINBIL, MAXBIL, MAXBILL, AUTOREN, priorityLevel, MSTCNTRCT, SRVTYPE, BILFRRET,  TOTBIL, PREPAID, BILONDY, BILCYC, UOFM, BILSTAT, ENTTME, STRTDATE, ENDDATE, CNTCOVPD_1,  CNTCOVPD_2, CNTCOVPD_3, CNTCOVPD_4, CNTCOVPD_5, CNTCOVPD_6, CNTCOVPD_7, Contract_Coverage_Period_1,  Contract_Coverage_Period_2, Contract_Coverage_Period_3, Contract_Coverage_Period_4,  Contract_Coverage_Period_5, Contract_Coverage_Period_6, Contract_Coverage_Period_7,  USECVPD_1, USECVPD_2, USECVPD_3, USECVPD_4, USECVPD_5, USECVPD_6, USECVPD_7, TAXSCHID, CNFGLVL,  CNFGSEQ, Contract_Length, Contract_Period, Invoiced_Amount, Amount_To_Invoice, Liabiltiy_Reduction,  Liability_Amount, Total_Liability_Amount, NUMOFINV, New_Invoice_Amount, Contract_Line_Status,  Contract_Renewal_Contact, Contract_Response_Time, Liability_Months, Next_Liability_Date,  Last_Liability_Date, Total_Liability_Billed, TAXEXMT1, TAXEXMT2, Total_Unit, UNITCOST,  Unit_Cost_Total, SVC_Liability_Type, SVC_Contract_Signed, RETTYPE, SVC_Monthly_Price,  Location_Segment, Bill_To_Customer, SVC_Bill_To_Address_Code, DSCDLRAM, SVC_Invoiced_Discount,  SVC_Discount_Recognized, SVC_Discount_Remaining, SVC_Discount_Next, SVC_PM_Date, SVC_PM_Day,CURRNIDX,  RATETPID, EXGTBLID, XCHGRATE, EXCHDATE, DECPLACS, TIME1, RATECALC, VIEWMODE, ISMCTRX, EXPNDATE,  DENXRATE, MCTRXSTT, ORIGVALTIM, ORCOMAMT, ORIGRETNAGAM, ORIGRTNBILLD, ORIGLASTAmountBilled,  ORIGTOTAL, ORIGTOTVALCAL, ORIGMINBIL, ORIGMAXBIL, Originating_Max_Billable, ORIGTOTBIL,  Orig_Invoiced_Amount, Orig_Amount_To_Invoice, Orig_Liability_Amount, OrigTotLiabilityAmount,  OrigTotLiabBilled, Originating_Total_Unit, ORUNTCST, ORDDLRAT, OrigDiscountReceived,  OrigDiscountRemaining, OrigDiscountNext, ORIGUNITCOSTTOTAL, ORIGMONTHPRICE, ORIGINVOICEDDISC,  OrigNewInvoiceAmount,TAXAMNT,ORTAXAMT,SVC_FO_ID, @Version,  MovedRevenue, OriginalTotal, OrigMovedRevenue, OrigOriginalTotal, Credit_Hold, ITEMDESC  from SVC00601 where CONSTS = @CONSTS and CONTNBR = @CONTNBR and LNSEQNBR = @Line  if @@error <> 0 goto baderror  FETCH NEXT FROM cursor_601 INTO @Line  END deallocate cursor_601  declare cursor_603 cursor for select LNSEQNBR,SVC_Invoice_SEQ_Number from SVC00603 where CONSTS = @CONSTS and CONTNBR = @CONTNBR open cursor_603  FETCH NEXT FROM cursor_603 INTO @Line,@InvoiceLine  while @@FETCH_STATUS = 0  BEGIN  INSERT INTO SVC30603 with (rowlock)  select  CONSTS, CONTNBR, LNSEQNBR,SVC_Invoice_SEQ_Number, INVODATE,DOCAMNT,  SVC_Coverage_Start_Date,SVC_Coverage_End_Date,POSTED,POSTEDDT,PSTDAMNT,  SVC_Invoice_Credit_Amoun, SVC_Daily_Rate,DSCDLRAM,ORDOCAMT,ORIGPSTDAMNT,  OrigInvCreditAmt, ORDDLRAT, @Version, SOPTYPE, SOPNUMBE, svcReverseType  from SVC00603 where CONSTS = @CONSTS and CONTNBR = @CONTNBR and LNSEQNBR = @Line  and SVC_Invoice_SEQ_Number = @InvoiceLine  if @@error <> 0 goto baderror  FETCH NEXT FROM cursor_603 INTO @Line,@InvoiceLine  END deallocate cursor_603  declare cursor_604 cursor for select LNSEQNBR,YEAR1,PERIODID,LNITMSEQ  from SVC00604 where CONSTS = @CONSTS and CONTNBR = @CONTNBR open cursor_604  FETCH NEXT FROM cursor_604 INTO @Line,@Year,@Period,@LineSeq  while @@FETCH_STATUS = 0  BEGIN  INSERT INTO SVC30604 with (rowlock)  select  CONSTS, CONTNBR, LNSEQNBR,YEAR1,PERIODID,LNITMSEQ, Status, POSTEDDT,  Transaction_Date,USERID,PSTDAMNT,Originating_PostedAmount, Source_Trx_Document_Type,  SourceTrxDocumentNumber,Transaction_Amount, OrigTransactionAmount, SVC_Coverage_Start_Date,  SVC_Coverage_End_Date,SVC_Invoice_Credit_Amoun, OrigInvCreditAmt,DSCDLRAM,ORDDLRAT,  Net_Transaction_Amount, OrigNetTransactionAmount, @Version  from SVC00604 where CONSTS = @CONSTS and CONTNBR = @CONTNBR and LNSEQNBR = @Line  and YEAR1=@Year and PERIODID = @Period and LNITMSEQ = @LineSeq  if @@error <> 0 goto baderror  FETCH NEXT FROM cursor_604 INTO @Line,@Year,@Period,@LineSeq  END deallocate cursor_604  declare cursor_605 cursor for select SOPNUMBE,SOPTYPE from SVC00605 where CONSTS = @CONSTS and CONTNBR = @CONTNBR open cursor_605  FETCH NEXT FROM cursor_605 INTO @SopNumber,@SopType  while @@FETCH_STATUS = 0  BEGIN  INSERT INTO SVC30605 with (rowlock)  select  CONSTS, CONTNBR, SOPNUMBE,SOPTYPE, INVODATE,Invoiced_Amount,  Amount_To_Invoice, Orig_Invoiced_Amount, Orig_Amount_To_Invoice, @Version,   svcReverseFlag  from SVC00605 where CONSTS = @CONSTS and CONTNBR = @CONTNBR  and SOPNUMBE =@SopNumber and SOPTYPE = @SopType  if @@error <> 0 goto baderror  FETCH NEXT FROM cursor_605 INTO @SopNumber,@SopType  END deallocate cursor_605  declare cursor_606 cursor for select LNSEQNBR from SVC00606 where CONSTS = @CONSTS and CONTNBR = @CONTNBR open cursor_606  FETCH NEXT FROM cursor_606 INTO @Line  while @@FETCH_STATUS = 0  BEGIN  INSERT INTO SVC30606 with (rowlock)  select  CONSTS, CONTNBR, LNSEQNBR,ITEMNMBR, @Version  from SVC00606 where CONSTS = @CONSTS and CONTNBR = @CONTNBR and LNSEQNBR = @Line  if @@error <> 0 goto baderror  FETCH NEXT FROM cursor_606 INTO @Line  END deallocate cursor_606  declare cursor_607 cursor for select LNSEQNBR from SVC00607 where CONSTS = @CONSTS and CONTNBR = @CONTNBR open cursor_607  FETCH NEXT FROM cursor_607 INTO @Line  while @@FETCH_STATUS = 0  BEGIN  INSERT INTO SVC30607 with (rowlock)  select  CONSTS, CONTNBR, LNSEQNBR,  Meter_Bases_1,Meter_Bases_2,Meter_Bases_3,Meter_Bases_4,Meter_Bases_5,  Meter_Overages_1,Meter_Overages_2,Meter_Overages_3,Meter_Overages_4,Meter_Overages_5,  Meter_Overages_6,Meter_Overages_7,Meter_Overages_8,Meter_Overages_9,Meter_Overages_10,  Meter_Overages_11,Meter_Overages_12,Meter_Overages_13,Meter_Overages_14,Meter_Overages_15,  Meter_Overages_16,Meter_Overages_17,Meter_Overages_18,Meter_Overages_19,Meter_Overages_20,  Meter_Charges_1,Meter_Charges_2,Meter_Charges_3,Meter_Charges_4,Meter_Charges_5,  Meter_Charges_6,Meter_Charges_7,Meter_Charges_8,Meter_Charges_9,Meter_Charges_10,  Meter_Charges_11,Meter_Charges_12,Meter_Charges_13,Meter_Charges_14,Meter_Charges_15,  Meter_Charges_16,Meter_Charges_17,Meter_Charges_18,Meter_Charges_19,Meter_Charges_20,  Meter_Expires_1,Meter_Expires_2,Meter_Expires_3,Meter_Expires_4,Meter_Expires_5,  Meter_Internal_Uses_1,Meter_Internal_Uses_2,Meter_Internal_Uses_3,Meter_Internal_Uses_4,Meter_Internal_Uses_5,  Meter_Actuals_1,Meter_Actuals_2,Meter_Actuals_3,Meter_Actuals_4,Meter_Actuals_5,  Meter_Startings_1,Meter_Startings_2,Meter_Startings_3,Meter_Startings_4,Meter_Startings_5,  Amount_To_Invoice,Invoiced_Amount,Total_Invoiced,INVODATE,  Orig_Amount_To_Invoice, Orig_Invoiced_Amount, OrigTotalInvoiced,  Originating_Meter_Charge_1,Originating_Meter_Charge_2,Originating_Meter_Charge_3,  Originating_Meter_Charge_4,Originating_Meter_Charge_5,  Originating_Meter_Charge_6,Originating_Meter_Charge_7,Originating_Meter_Charge_8,  Originating_Meter_Charge_9,Originating_Meter_Charge_10,  Originating_Meter_Charge_11,Originating_Meter_Charge_12,Originating_Meter_Charge_13,  Originating_Meter_Charge_14,Originating_Meter_Charge_15,  Originating_Meter_Charge_16,Originating_Meter_Charge_17,Originating_Meter_Charge_18,  Originating_Meter_Charge_19,Originating_Meter_Charge_20, @Version  from SVC00607 where CONSTS = @CONSTS and CONTNBR = @CONTNBR and LNSEQNBR = @Line  if @@error <> 0 goto baderror  FETCH NEXT FROM cursor_607 INTO @Line  END deallocate cursor_607  declare cursor_608 cursor for select LNSEQNBR from SVC00608 where CONSTS = @CONSTS and CONTNBR = @CONTNBR open cursor_608  FETCH NEXT FROM cursor_608 INTO @Line  while @@FETCH_STATUS = 0  BEGIN  INSERT INTO SVC30608 with (rowlock)  select  CONSTS, CONTNBR, LNSEQNBR, isnull(@TransferStatus, Contract_Transfer_Status), Contract_Transfer_Date, TAXSCHID,  priorityLevel,ADRSCODE, NOTEINDX, TIMEZONE, CONTPRC, RENCNTTYP, RENPRCSCHD, PCTCRYFWD, FRZEND, FRXSTRT,  MXINCPCT, BLKTIM, VALTIM, DSCPCTAM, COMDLRAM, COUNTRY, PRCSTAT, PORDNMBR, DSCRIPTN, PARTPCT,  LABPCT, MISCPCT, PMMSCPCT, PMPRTPCT, PMLABPCT, VENDORID, RETNAGAM, RTNBILLD, SLPRSNID,  COMMCODE, COMPRCNT, BILSTRT, BILEND, BILLNGTH, BILPRD, TOTAL, FRSTBLDTE, Last_Amount_Billed,  LSTBLDTE, NBRCAL, ACTCAL, TOTVALCAL, CONTACT, CURNCYID, NXTBLDTE, CNTTYPE, PRICSHED, CUSTNMBR,  ENTDTE, MINBIL, MAXBIL, MAXBILL, AUTOREN, MSTCNTRCT, SRVTYPE, BILFRRET, TOTBIL, PREPAID,  BILONDY, BILCYC, UOFM, BILSTAT, ENTTME, STRTDATE, ENDDATE, CNTCOVPD_1, CNTCOVPD_2, CNTCOVPD_3,  CNTCOVPD_4, CNTCOVPD_5, CNTCOVPD_6, CNTCOVPD_7, Contract_Coverage_Period_1, Contract_Coverage_Period_2,  Contract_Coverage_Period_3, Contract_Coverage_Period_4, Contract_Coverage_Period_5, Contract_Coverage_Period_6,  Contract_Coverage_Period_7, USECVPD_1, USECVPD_2, USECVPD_3, USECVPD_4, USECVPD_5, USECVPD_6, USECVPD_7,  Contract_Length, Contract_Period, Invoiced_Amount, Liabiltiy_Reduction, Amount_To_Invoice, Liability_Amount,  Total_Liability_Amount, NUMOFINV, Quote_Status, QUOEXPDA, Credit_Hold, TAXEXMT1, TAXEXMT2, New_PO_Required,  Contract_Renewal_Contact, Source_Contract_Number, Source_Contract_Type, Contract_Response_Time, Liability_Months,  Next_Liability_Date, Last_Liability_Date, Total_Liability_Billed, Total_Unit, Created_User_ID, Source_User_ID,  SVC_Contract_Signed, SVC_Liability_Type, RETTYPE, Location_Segment, Bill_To_Customer,   Cover_All, canceled, CURRNIDX, RATETPID,EXGTBLID,XCHGRATE, EXCHDATE,DECPLACS, TIME1,RATECALC, VIEWMODE,  ISMCTRX, EXPNDATE,DENXRATE,MCTRXSTT, ORIGVALTIM,ORCOMAMT,ORIGRETNAGAM,ORIGRTNBILLD,ORIGLASTAmountBilled,  ORIGTOTAL, ORIGTOTVALCAL, ORIGMINBIL,ORIGMAXBIL,Originating_Max_Billable, ORIGTOTBIL,  Orig_Invoiced_Amount,Orig_Amount_To_Invoice,Orig_Liability_Amount,  OrigTotLiabilityAmount, OrigTotLiabBilled, Originating_Total_Unit, @Version,  SVC_Bill_To_Address_Code, svcBillingFrequency  from SVC00608 where CONSTS = @CONSTS and CONTNBR = @CONTNBR and LNSEQNBR = @Line  if @@error <> 0 goto baderror  FETCH NEXT FROM cursor_608 INTO @Line  END deallocate cursor_608  if @MoveDist = 1   BEGIN  declare cursor_609 cursor for select LNSEQNBR,SEQNUMBR,SVC_Distribution_Type  from SVC00609 where CONSTS = @CONSTS and CONTNBR = @CONTNBR  open cursor_609  FETCH NEXT FROM cursor_609 INTO @Line,@LineSeq,@DistType  while @@FETCH_STATUS = 0  BEGIN  INSERT INTO SVC30609 with (rowlock)  select  CONSTS, CONTNBR, LNSEQNBR,SEQNUMBR,SVC_Distribution_Type,DistRef,ACTINDX, @Version  from SVC00609 where CONSTS = @CONSTS and CONTNBR = @CONTNBR and LNSEQNBR = @Line  and SVC_Distribution_Type = @DistType and SEQNUMBR = @LineSeq  if @@error <> 0 goto baderror  FETCH NEXT FROM cursor_609 INTO @Line,@LineSeq,@DistType  END  deallocate cursor_609  END  declare cursor_610 cursor for select LNSEQNBR,SCHEDID from SVC00610 where CONSTS = @CONSTS and CONTNBR = @CONTNBR open cursor_610  FETCH NEXT FROM cursor_610 INTO @Line,@Schedule  while @@FETCH_STATUS = 0  BEGIN  INSERT INTO SVC30610 with (rowlock)  select  CONSTS, CONTNBR, LNSEQNBR,EQUIPID, ACTIVE, SCHEDID, @Version  from SVC00610 where CONSTS = @CONSTS and CONTNBR = @CONTNBR and LNSEQNBR = @Line and SCHEDID = @Schedule  if @@error <> 0 goto baderror  FETCH NEXT FROM cursor_610 INTO @Line,@Schedule  END deallocate cursor_610  select @UserID = SYSTEM_USER if @FromRoutine = 1   exec SVC_Create_Contract_Audit @CONSTS, @CONTNBR,0,'','','',@UserID,'Moved Record To History via Move Routine'  declare cursor_620 cursor for select LNITMSEQ from SVC00620 where CONSTS = @CONSTS and CONTNBR = @CONTNBR open cursor_620  FETCH NEXT FROM cursor_620 INTO @LineSeq  while @@FETCH_STATUS = 0  BEGIN  INSERT INTO SVC30620 with (rowlock)  select  CONSTS, CONTNBR, LNITMSEQ,SVC_Contract_Line_SEQ, DATE1,TIME1,ITEMNMBR,  SERLNMBR, ADRSCODE,ITEMDESC,USERID, @Version  from SVC00620 where CONSTS = @CONSTS and CONTNBR = @CONTNBR and LNITMSEQ = @LineSeq  if @@error <> 0 goto baderror  FETCH NEXT FROM cursor_620 INTO @LineSeq  END deallocate cursor_620  declare cursor_652 cursor for select LNSEQNBR,OPTTYPE from SVC00652 where CONSTS = @CONSTS and CONTNBR = @CONTNBR open cursor_652  FETCH NEXT FROM cursor_652 INTO @Line,@OPTTYPE  while @@FETCH_STATUS = 0  BEGIN  INSERT INTO SVC30652 with (rowlock)  select  CONSTS, CONTNBR, LNSEQNBR,OPTTYPE,STRTDATE,ENDDATE,UNITPRCE,UNITCOST , ORUNTCST,ORUNTPRC, @Version  from SVC00652 where CONSTS = @CONSTS and CONTNBR = @CONTNBR and LNSEQNBR = @Line and OPTTYPE = @OPTTYPE  if @@error <> 0 goto baderror  FETCH NEXT FROM cursor_652 INTO @Line,@OPTTYPE  END deallocate cursor_652  declare cursor_655 cursor for select LNSEQNBR,OPTTYPE from SVC00655 where CONSTS = @CONSTS and CONTNBR = @CONTNBR open cursor_655  FETCH NEXT FROM cursor_655 INTO @Line,@OPTTYPE  while @@FETCH_STATUS = 0  BEGIN  INSERT INTO SVC30655 with (rowlock)  select  CONSTS, CONTNBR, LNSEQNBR,OPTTYPE,STRTDATE,ENDDATE,UNITPRCE,UNITCOST , ORUNTCST,ORUNTPRC, @Version  from SVC00655 where CONSTS = @CONSTS and CONTNBR = @CONTNBR and LNSEQNBR = @Line and OPTTYPE = @OPTTYPE  if @@error <> 0 goto baderror  FETCH NEXT FROM cursor_655 INTO @Line,@OPTTYPE  END deallocate cursor_655  INSERT INTO SVC30681 with (rowlock)  select  CONSTS, CONTNBR, @Version,  svcCoveragePeriodStart2_1, svcCoveragePeriodStart2_2, svcCoveragePeriodStart2_3,  svcCoveragePeriodStart2_4, svcCoveragePeriodStart2_5, svcCoveragePeriodStart2_6, svcCoveragePeriodStart2_7,  svcCoveragePeriodEnd2_1, svcCoveragePeriodEnd2_2, svcCoveragePeriodEnd2_3,  svcCoveragePeriodEnd2_4, svcCoveragePeriodEnd2_5, svcCoveragePeriodEnd2_6, svcCoveragePeriodEnd2_7,  svcCoveragePeriodStart3_1, svcCoveragePeriodStart3_2, svcCoveragePeriodStart3_3,  svcCoveragePeriodStart3_4, svcCoveragePeriodStart3_5, svcCoveragePeriodStart3_6, svcCoveragePeriodStart3_7,  svcCoveragePeriodEnd3_1, svcCoveragePeriodEnd3_2, svcCoveragePeriodEnd3_3,  svcCoveragePeriodEnd3_4, svcCoveragePeriodEnd3_5, svcCoveragePeriodEnd3_6, svcCoveragePeriodEnd3_7,  svcCoveragePeriodStart4_1, svcCoveragePeriodStart4_2, svcCoveragePeriodStart4_3,  svcCoveragePeriodStart4_4, svcCoveragePeriodStart4_5, svcCoveragePeriodStart4_6, svcCoveragePeriodStart4_7,  svcCoveragePeriodEnd4_1, svcCoveragePeriodEnd4_2, svcCoveragePeriodEnd4_3,  svcCoveragePeriodEnd4_4, svcCoveragePeriodEnd4_5, svcCoveragePeriodEnd4_6, svcCoveragePeriodEnd4_7  from SVC00681 where CONSTS = @CONSTS and CONTNBR = @CONTNBR  INSERT INTO SVC30682 with (rowlock)  select  CONSTS, CONTNBR, @Version,LNSEQNBR,  svcCoveragePeriodStart2_1, svcCoveragePeriodStart2_2, svcCoveragePeriodStart2_3,  svcCoveragePeriodStart2_4, svcCoveragePeriodStart2_5, svcCoveragePeriodStart2_6, svcCoveragePeriodStart2_7,  svcCoveragePeriodEnd2_1, svcCoveragePeriodEnd2_2, svcCoveragePeriodEnd2_3,  svcCoveragePeriodEnd2_4, svcCoveragePeriodEnd2_5, svcCoveragePeriodEnd2_6, svcCoveragePeriodEnd2_7,  svcCoveragePeriodStart3_1, svcCoveragePeriodStart3_2, svcCoveragePeriodStart3_3,  svcCoveragePeriodStart3_4, svcCoveragePeriodStart3_5, svcCoveragePeriodStart3_6, svcCoveragePeriodStart3_7,  svcCoveragePeriodEnd3_1, svcCoveragePeriodEnd3_2, svcCoveragePeriodEnd3_3,  svcCoveragePeriodEnd3_4, svcCoveragePeriodEnd3_5, svcCoveragePeriodEnd3_6, svcCoveragePeriodEnd3_7,  svcCoveragePeriodStart4_1, svcCoveragePeriodStart4_2, svcCoveragePeriodStart4_3,  svcCoveragePeriodStart4_4, svcCoveragePeriodStart4_5, svcCoveragePeriodStart4_6, svcCoveragePeriodStart4_7,  svcCoveragePeriodEnd4_1, svcCoveragePeriodEnd4_2, svcCoveragePeriodEnd4_3,  svcCoveragePeriodEnd4_4, svcCoveragePeriodEnd4_5, svcCoveragePeriodEnd4_6, svcCoveragePeriodEnd4_7  from SVC00682 where CONSTS = @CONSTS and CONTNBR = @CONTNBR   INSERT INTO SVC30683 with (rowlock)  select  CONSTS, CONTNBR, @Version,LNSEQNBR,  svcCoveragePeriodStart2_1, svcCoveragePeriodStart2_2, svcCoveragePeriodStart2_3,  svcCoveragePeriodStart2_4, svcCoveragePeriodStart2_5, svcCoveragePeriodStart2_6, svcCoveragePeriodStart2_7,  svcCoveragePeriodEnd2_1, svcCoveragePeriodEnd2_2, svcCoveragePeriodEnd2_3,  svcCoveragePeriodEnd2_4, svcCoveragePeriodEnd2_5, svcCoveragePeriodEnd2_6, svcCoveragePeriodEnd2_7,  svcCoveragePeriodStart3_1, svcCoveragePeriodStart3_2, svcCoveragePeriodStart3_3,  svcCoveragePeriodStart3_4, svcCoveragePeriodStart3_5, svcCoveragePeriodStart3_6, svcCoveragePeriodStart3_7,  svcCoveragePeriodEnd3_1, svcCoveragePeriodEnd3_2, svcCoveragePeriodEnd3_3,  svcCoveragePeriodEnd3_4, svcCoveragePeriodEnd3_5, svcCoveragePeriodEnd3_6, svcCoveragePeriodEnd3_7,  svcCoveragePeriodStart4_1, svcCoveragePeriodStart4_2, svcCoveragePeriodStart4_3,  svcCoveragePeriodStart4_4, svcCoveragePeriodStart4_5, svcCoveragePeriodStart4_6, svcCoveragePeriodStart4_7,  svcCoveragePeriodEnd4_1, svcCoveragePeriodEnd4_2, svcCoveragePeriodEnd4_3,  svcCoveragePeriodEnd4_4, svcCoveragePeriodEnd4_5, svcCoveragePeriodEnd4_6, svcCoveragePeriodEnd4_7  from SVC00683 where CONSTS = @CONSTS and CONTNBR = @CONTNBR   if @@error <> 0 goto baderror  delete from SVC00603 with (rowlock) where CONSTS = @CONSTS and CONTNBR = @CONTNBR delete from SVC00604 with (rowlock) where CONSTS = @CONSTS and CONTNBR = @CONTNBR delete from SVC00605 with (rowlock) where CONSTS = @CONSTS and CONTNBR = @CONTNBR delete from SVC00606 with (rowlock) where CONSTS = @CONSTS and CONTNBR = @CONTNBR delete from SVC00607 with (rowlock) where CONSTS = @CONSTS and CONTNBR = @CONTNBR delete from SVC00608 with (rowlock) where CONSTS = @CONSTS and CONTNBR = @CONTNBR delete from SVC00609 with (rowlock) where CONSTS = @CONSTS and CONTNBR = @CONTNBR delete from SVC00610 with (rowlock) where CONSTS = @CONSTS and CONTNBR = @CONTNBR delete from SVC00620 with (rowlock) where CONSTS = @CONSTS and CONTNBR = @CONTNBR delete from SVC00652 with (rowlock) where CONSTS = @CONSTS and CONTNBR = @CONTNBR delete from SVC00655 with (rowlock) where CONSTS = @CONSTS and CONTNBR = @CONTNBR delete from SVC00681 with (rowlock) where CONSTS = @CONSTS and CONTNBR = @CONTNBR delete from SVC00682 with (rowlock) where CONSTS = @CONSTS and CONTNBR = @CONTNBR delete from SVC00683 with (rowlock) where CONSTS = @CONSTS and CONTNBR = @CONTNBR delete from SVC00600 with (rowlock) where CONSTS = @CONSTS and CONTNBR = @CONTNBR delete from SVC00601 with (rowlock) where CONSTS = @CONSTS and CONTNBR = @CONTNBR  END  return(0) baderror:  return (99)   
GO
GRANT EXECUTE ON  [dbo].[SVC_Transfer_ContractToHistory] TO [DYNGRP]
GO
