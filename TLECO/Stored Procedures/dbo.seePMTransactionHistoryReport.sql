SET QUOTED_IDENTIFIER OFF
GO
SET ANSI_NULLS ON
GO
 create procedure [dbo].[seePMTransactionHistoryReport]  @SORTBY char(15),       @i_VENDOR_RS char(15) = '',     @i_VENDOR_RE char(15) = '',     @i_VCHNMBR_RS char(11) = '',    @i_VCHNMBR_RE char(11) = '',    @i_AUDTRAIL_RS char(65) = '',    @i_AUDTRAIL_RE char(65) = '',    @i_DOCDATE_RS char(17) = '',    @i_DOCDATE_RE char(17) = '',    @i_DOCTYPE_RS tinyint = 0,     @i_DOCTYPE_RE tinyint = 9,     @INCMC tinyint = 0,       @ASOFDATE char(21) = NULL      as  set nocount on  If OBJECT_ID('tempdb..#PMTRXALL') is  NULL  Begin  create table #PMTRXALL (  VENDORID char(15) not null default '',  VENDNAME char(65) not null default '',  VENDCLID char(11) not null default '',  VCHRNMBR char(21) not null default '',  DOCNUMBR char(21) not null default '',  TRXSORCE char(21) not null default '',  DOCAMNT numeric(19,5) not null default 0.00,  INVAMNT numeric(19,5) not null default 0.00,  PAYAMNT numeric(19,5) not null default 0.00,  WROFAMNT numeric(19,5) not null default 0.00,  DISAMTAV numeric(19,5) not null default 0.00,  DISTKNAM numeric(19,5) not null default 0.00,  DISCAMNT numeric(19,5) not null default 0.00,  TEN99AMT numeric(19,5)  not null default 0.00,  DOCTYPE tinyint not null default 0,  DOCDATE datetime not null default '01/01/1900',  DUEDATE datetime not null default '01/01/1900',  DISCDATE datetime not null default '01/01/1900',  USERDEF1 char(21) not null default '',  USERDEF2 char(21) not null default '',  VOIDED tinyint not null default 0,  APDCNMBR char(21) not null default '',  APDOCDTE datetime not null default '01/01/1900',  APFRVCNM char(21) not null default '',  APTVCHNM char(21) not null default '',  APPLDAMT numeric(19,5) not null default 0.00,  APFRAMNT numeric(19,5) not null default 0.00,  APDCTYPE tinyint not null default 0,  MY_DEX_ROW int Identity (1,1) )  End   delete #PMTRXALL   insert into #PMTRXALL (VENDORID,VENDNAME,VENDCLID,VCHRNMBR,DOCNUMBR,TRXSORCE,DOCAMNT,INVAMNT,PAYAMNT,WROFAMNT,DISAMTAV,DISTKNAM,DISCAMNT,TEN99AMT,DOCTYPE,DOCDATE,DUEDATE,DISCDATE,USERDEF1,USERDEF2,APDCNMBR,  APDOCDTE,APFRVCNM,APTVCHNM,APPLDAMT,APFRAMNT,APDCTYPE)  select a.VENDORID,b.VENDNAME,b.VNDCLSID,a.VCHRNMBR,a.DOCNUMBR,a.TRXSORCE,a.DOCAMNT,   case when a.DOCTYPE = 1 then a.DOCAMNT else 0.00 end,  case when a.DOCTYPE = 6 then a.DOCAMNT else 0.00 end,  a.WROFAMNT,a.DISAMTAV,a.DISTKNAM,a.DISCAMNT,a.TEN99AMNT,a.DOCTYPE,a.DOCDATE,a.DUEDATE,a.DISCDATE,b.USERDEF1,  b.USERDEF2, c.APFRDCNM, c.APTODCDT, c.VCHRNMBR, c.APTVCHNM,c.APPLDAMT,c.APFRMAPLYAMT,c.DOCTYPE  from PM30200 a, PM00200 b, PM30300 c  where a.VENDORID = b.VENDORID and  a.VENDORID = c.VENDORID and  a.DOCNUMBR = c.APTODCNM and  a.VCHRNMBR = c.APTVCHNM and  a.DOCTYPE in (1,2,3) and  a.VENDORID between @i_VENDOR_RS and @i_VENDOR_RE and  a.VCHRNMBR between @i_VCHNMBR_RS and @i_VCHNMBR_RE and  a.TRXSORCE between @i_AUDTRAIL_RS and @i_AUDTRAIL_RE and   a.DOCDATE between @i_DOCDATE_RS and @i_DOCDATE_RE and  a.DOCTYPE between @i_DOCTYPE_RS and @i_DOCTYPE_RE  order by a.VENDORID, a.DOCDATE ASC   insert into #PMTRXALL (VENDORID,VENDNAME,VENDCLID,VCHRNMBR,DOCNUMBR,TRXSORCE,DOCAMNT,INVAMNT,PAYAMNT,WROFAMNT,DISAMTAV,DISTKNAM,DISCAMNT,TEN99AMT,DOCTYPE,DOCDATE,DUEDATE,DISCDATE,USERDEF1,USERDEF2)  select a.VENDORID,b.VENDNAME,b.VNDCLSID,a.VCHRNMBR,a.DOCNUMBR,a.TRXSORCE,a.DOCAMNT,  case when a.DOCTYPE = 1 then a.DOCAMNT else 0.00 end,  case when a.DOCTYPE = 6 then a.DOCAMNT else 0.00 end,  a.WROFAMNT,a.DISAMTAV,a.DISTKNAM,a.DISCAMNT,a.TEN99AMNT,a.DOCTYPE,a.DOCDATE,a.DUEDATE,a.DISCDATE,b.USERDEF1,  b.USERDEF2  from PM30200 a, PM00200 b  where a.VENDORID = b.VENDORID and  a.DOCTYPE in (4,5,6) and  a.VENDORID between @i_VENDOR_RS and @i_VENDOR_RE and  a.VCHRNMBR between @i_VCHNMBR_RS and @i_VCHNMBR_RE and  a.TRXSORCE between @i_AUDTRAIL_RS and @i_AUDTRAIL_RE and   a.DOCDATE between @i_DOCDATE_RS and @i_DOCDATE_RE and  a.DOCTYPE between @i_DOCTYPE_RS and @i_DOCTYPE_RE  order by a.VENDORID, a.DOCDATE ASC   insert into #PMTRXALL (VENDORID,VENDNAME,VENDCLID,VCHRNMBR,DOCNUMBR,TRXSORCE,DOCAMNT,WROFAMNT,DISAMTAV,DISTKNAM,DISCAMNT,TEN99AMT,DOCTYPE,DOCDATE,DUEDATE,DISCDATE,USERDEF1,USERDEF2,VOIDED)  select a.VENDORID,b.VENDNAME,b.VNDCLSID,a.VCHRNMBR,a.DOCNUMBR,a.TRXSORCE,a.DOCAMNT,  a.WROFAMNT,a.DISAMTAV,a.DISTKNAM,a.DISCAMNT,a.TEN99AMNT,a.DOCTYPE,a.DOCDATE,a.DUEDATE,a.DISCDATE,b.USERDEF1,  b.USERDEF2,a.VOIDED  from PM30200 a, PM00200 b  where a.VENDORID = b.VENDORID and  a.VOIDED = 1 and  a.VENDORID between @i_VENDOR_RS and @i_VENDOR_RE and  a.VCHRNMBR between @i_VCHNMBR_RS and @i_VCHNMBR_RE and  a.TRXSORCE between @i_AUDTRAIL_RS and @i_AUDTRAIL_RE and   a.DOCDATE between @i_DOCDATE_RS and @i_DOCDATE_RE and  a.DOCTYPE between @i_DOCTYPE_RS and @i_DOCTYPE_RE  order by a.VENDORID, a.DOCDATE ASC  select * from #PMTRXALL   
GO
GRANT EXECUTE ON  [dbo].[seePMTransactionHistoryReport] TO [DYNGRP]
GO
GRANT EXECUTE ON  [dbo].[seePMTransactionHistoryReport] TO [rpt_accounting manager]
GO
GRANT EXECUTE ON  [dbo].[seePMTransactionHistoryReport] TO [rpt_accounts payable coordinator]
GO
GRANT EXECUTE ON  [dbo].[seePMTransactionHistoryReport] TO [rpt_bookkeeper]
GO
GRANT EXECUTE ON  [dbo].[seePMTransactionHistoryReport] TO [rpt_power user]
GO
