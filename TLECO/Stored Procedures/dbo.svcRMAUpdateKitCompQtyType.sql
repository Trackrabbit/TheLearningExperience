SET QUOTED_IDENTIFIER OFF
GO
SET ANSI_NULLS ON
GO
 Create Procedure [dbo].[svcRMAUpdateKitCompQtyType] (@ReturnRecType smallint,  @RMANumber char(15),  @RMALine numeric(19,5),  @CompLine int,  @QtyType smallint) as declare @QTYONHND numeric(19,5), @QTYRTRND numeric(19,5), @QTYINUSE numeric(19,5), @QTYINSVC numeric(19,5), @QTYDMGED numeric(19,5)  ,@CompLineQty numeric(19,5) if not exists(select * from SVC05200 where Return_Record_Type = @ReturnRecType and RETDOCID = @RMANumber and LNSEQNBR = @RMALine and svcRMAComponentSeq > 0 )  return  if @QtyType = 1  update SVC05200 with (rowlock) set QTYONHND = QUANTITY ,QTYRTRND=0,QTYINUSE=0,QTYINSVC=0,QTYDMGED = 0  where Return_Record_Type = @ReturnRecType and RETDOCID = @RMANumber and LNSEQNBR = @RMALine and svcRMAComponentSeq > 0 else if @QtyType = 2   update SVC05200 with (rowlock) set QTYRTRND = QUANTITY , QTYONHND = 0,QTYINUSE=0,QTYINSVC=0,QTYDMGED = 0  where Return_Record_Type = @ReturnRecType and RETDOCID = @RMANumber and LNSEQNBR = @RMALine and svcRMAComponentSeq > 0 else if @QtyType = 3   update SVC05200 with (rowlock) set QTYINUSE = QUANTITY , QTYONHND = 0,QTYRTRND=0,QTYINSVC=0,QTYDMGED = 0  where Return_Record_Type = @ReturnRecType and RETDOCID = @RMANumber and LNSEQNBR = @RMALine and svcRMAComponentSeq > 0 else if @QtyType = 4   update SVC05200 with (rowlock) set QTYINSVC = QUANTITY , QTYONHND = 0,QTYINUSE=0,QTYRTRND=0,QTYDMGED = 0  where Return_Record_Type = @ReturnRecType and RETDOCID = @RMANumber and LNSEQNBR = @RMALine and svcRMAComponentSeq > 0 else  update SVC05200 with (rowlock) set QTYDMGED = QUANTITY , QTYONHND = 0,QTYINUSE=0,QTYINSVC=0,QTYRTRND = 0  where Return_Record_Type = @ReturnRecType and RETDOCID = @RMANumber and LNSEQNBR = @RMALine and svcRMAComponentSeq > 0 if exists(select 1 from SVC05210 where Return_Record_Type = @ReturnRecType and RETDOCID = @RMANumber and LNSEQNBR = @RMALine)  update SVC05210 with (rowlock)set QTYTYPE = @QtyType where Return_Record_Type = @ReturnRecType and RETDOCID = @RMANumber and LNSEQNBR = @RMALine if exists(select 1 from SVC05212 where Return_Record_Type = @ReturnRecType and RETDOCID = @RMANumber and LNSEQNBR = @RMALine)  update SVC05212 with (rowlock)set QTYTYPE = @QtyType where Return_Record_Type = @ReturnRecType and RETDOCID = @RMANumber and LNSEQNBR = @RMALine if exists(select 1 from SVC05255 where Return_Record_Type = @ReturnRecType and RETDOCID = @RMANumber and LNSEQNBR = @RMALine)  update SVC05255 with (rowlock)set QTYTYPE = @QtyType where Return_Record_Type = @ReturnRecType and RETDOCID = @RMANumber and LNSEQNBR = @RMALine return    
GO
GRANT EXECUTE ON  [dbo].[svcRMAUpdateKitCompQtyType] TO [DYNGRP]
GO
