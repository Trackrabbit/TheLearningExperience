SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO
 create procedure [dbo].[glpmcVerifyAccountCurrency]   @I_iAccountIndex                int             = NULL,  @I_sAccountCurrencyType smallint        = NULL,  @I_cCurrencyID                  char(15)        = NULL,  @I_tPosting                     tinyint = NULL,  @IO_bLineMessages2              binary(4)       = NULL  output,  @O_iErrorState                  int             = NULL  output as  declare  @TRUE                                   tinyint,  @POSTING_ACCOUNT                        smallint,  @DISTRIBUTION_ACCOUNT           smallint,  @RETAINED_EARNINGS                      smallint,  @RETAINED_EARNINGS_DIST         smallint,  @OFFSET_ACCOUNT                 smallint,  @MS_ITEM_1                              int,  @MS_ITEM_2                              int,  @MS_ITEM_3                              int,  @MS_ITEM_4                              int,  @MS_ITEM_5                              int,  @tTransaction                           tinyint,  @tLoop                                  tinyint  select   @O_iErrorState = 0  if @@trancount = 0 begin  select @tTransaction = 1  begin transaction end   while (@tLoop is NULL) begin  select @tLoop = 1   if      @I_iAccountIndex                is NULL or  @I_sAccountCurrencyType is NULL or  @I_cCurrencyID                  is NULL or  @I_tPosting                     is NULL or   @IO_bLineMessages2              is NULL  begin  select @O_iErrorState = 20769  break  end    select  @TRUE                                   = 1,  @POSTING_ACCOUNT                        = 1,  @DISTRIBUTION_ACCOUNT           = 2,  @RETAINED_EARNINGS                      = 3,  @RETAINED_EARNINGS_DIST         = 4,  @OFFSET_ACCOUNT                 = 5,  @MS_ITEM_1                              = power(2,24),  @MS_ITEM_2                              = power(2,25),  @MS_ITEM_3                              = power(2,26),  @MS_ITEM_4                              = power(2,27),  @MS_ITEM_5                              = power(2,28)   if not exists (select  1  from  MC00200  where  ACTINDX = @I_iAccountIndex  and     CURNCYID = @I_cCurrencyID)  begin  if @I_sAccountCurrencyType = @POSTING_ACCOUNT  select @IO_bLineMessages2 = (@IO_bLineMessages2 | @MS_ITEM_1)  else if @I_sAccountCurrencyType = @DISTRIBUTION_ACCOUNT  select @IO_bLineMessages2 = (@IO_bLineMessages2 | @MS_ITEM_2)  else if @I_sAccountCurrencyType = @RETAINED_EARNINGS  select @IO_bLineMessages2 = (@IO_bLineMessages2 | @MS_ITEM_3)  else if @I_sAccountCurrencyType = @RETAINED_EARNINGS_DIST  select @IO_bLineMessages2 = (@IO_bLineMessages2 | @MS_ITEM_4)  else if @I_sAccountCurrencyType = @OFFSET_ACCOUNT  select @IO_bLineMessages2 = (@IO_bLineMessages2 | @MS_ITEM_5)  else  begin  select @O_iErrorState = 20770  break  end  if @I_tPosting = @TRUE  begin  select @O_iErrorState = 20771  break  end   end  end   if @O_iErrorState <> 0 begin  if @tTransaction = 1  rollback transaction end else if @tTransaction = 1  commit transaction   return    
GO
GRANT EXECUTE ON  [dbo].[glpmcVerifyAccountCurrency] TO [DYNGRP]
GO
