SET QUOTED_IDENTIFIER OFF
GO
SET ANSI_NULLS ON
GO
 CREATE PROCEDURE [dbo].[SVC_Update_Contract_Liability](@CONSTS smallint = NULL,@CONTNBR char(11)= NULL) AS declare @NEXTLIABDATE datetime declare @LIABAMT numeric(19,2) declare @LIABMONTHAMT numeric(19,2) declare @TOTALBILLED numeric(19,2) declare @DLIABAMT numeric(19,2) declare @DLIABMONTHAMT numeric(19,2) declare @DTOTALBILLED numeric(19,2) declare @ORIGLIABAMT numeric(19,2) declare @ORIGLIABMONTHAMT numeric(19,2) declare @ORIGTOTALBILLED numeric(19,2) declare @ORIGDLIABAMT numeric(19,2) declare @ORIGDLIABMONTHAMT numeric(19,2) declare @ORIGDTOTALBILLED numeric(19,2) declare @LIABMONTHS integer declare @LIABILITY smallint declare @LASTDATE datetime set nocount on SELECT  @LIABILITY = MAX(IsNull(SVC00601.Liabiltiy_Reduction,0)),  @NEXTLIABDATE = MIN(SVC00601.Next_Liability_Date),  @LIABMONTHAMT = SUM(IsNull(SVC00601.Liability_Amount,0)),  @DLIABMONTHAMT = SUM(IsNull(SVC00601.SVC_Discount_Next,0)),  @ORIGLIABMONTHAMT = SUM(IsNull(SVC00601.Orig_Liability_Amount,0)),  @ORIGDLIABMONTHAMT = SUM(IsNull(SVC00601.OrigDiscountNext,0)),   @LIABMONTHS = MAX(IsNull(SVC00601.Liability_Months,0)) FROM SVC00601 WITH (NOLOCK)  WHERE (SVC00601.CONSTS = @CONSTS AND SVC00601.CONTNBR = @CONTNBR AND   SVC00601.Next_Liability_Date <> '01/01/1900'  AND   SVC00601.Contract_Line_Status <> 'C') SELECT @ORIGLIABAMT = SUM(IsNull(SVC00601.OrigTotLiabilityAmount,0)),  @ORIGTOTALBILLED = SUM(IsNull(SVC00601.OrigTotLiabBilled,0)),  @ORIGDLIABAMT = SUM(IsNull(SVC00601.OrigDiscountRemaining,0)),  @ORIGDTOTALBILLED = SUM(IsNull(SVC00601.OrigDiscountReceived,0)),  @LIABAMT = SUM(IsNull(SVC00601.Total_Liability_Amount,0)),  @TOTALBILLED = SUM(IsNull(SVC00601.Total_Liability_Billed,0)),  @DLIABAMT = SUM(IsNull(SVC00601.SVC_Discount_Remaining,0)),  @DTOTALBILLED = SUM(IsNull(SVC00601.SVC_Discount_Recognized,0)),   @LASTDATE = MAX(SVC00601.Last_Liability_Date) FROM SVC00601 WITH (NOLOCK) WHERE (SVC00601.CONSTS = @CONSTS AND SVC00601.CONTNBR = @CONTNBR) UPDATE SVC00600  SET   SVC00600.Liabiltiy_Reduction = IsNull(@LIABILITY,0),  SVC00600.Total_Liability_Amount = Round(IsNull(@LIABAMT,0),2),  SVC00600.Total_Liability_Billed = Round(IsNull(@TOTALBILLED,0),2),  SVC00600.Liability_Amount = Round(IsNull(@LIABMONTHAMT,0),2),  SVC00600.SVC_Discount_Remaining = Round(IsNull(@DLIABAMT,0),2),  SVC00600.SVC_Discount_Recognized = Round(IsNull(@DTOTALBILLED,0),2),  SVC00600.SVC_Discount_Next = Round(IsNull(@DLIABMONTHAMT,0),2),  SVC00600.OrigTotLiabilityAmount = Round(IsNull(@ORIGLIABAMT,0),2),  SVC00600.OrigTotLiabBilled = Round(IsNull(@ORIGTOTALBILLED,0),2),  SVC00600.Orig_Liability_Amount = Round(IsNull(@ORIGLIABMONTHAMT,0),2),  SVC00600.OrigDiscountRemaining = Round(IsNull(@ORIGDLIABAMT,0),2),  SVC00600.OrigDiscountReceived = Round(IsNull(@ORIGDTOTALBILLED,0),2),  SVC00600.OrigDiscountNext = Round(IsNull(@ORIGDLIABMONTHAMT,0),2),  SVC00600.Liability_Months = IsNull(@LIABMONTHS,0),  SVC00600.Next_Liability_Date = IsNull(@NEXTLIABDATE,'01/01/1900 00:00:00'),  SVC00600.Last_Liability_Date = IsNull(@LASTDATE,'01/01/1900 00:00:00') FROM SVC00600 WHERE SVC00600.CONSTS = @CONSTS AND   SVC00600.CONTNBR = @CONTNBR    
GO
GRANT EXECUTE ON  [dbo].[SVC_Update_Contract_Liability] TO [DYNGRP]
GO
