SET QUOTED_IDENTIFIER OFF
GO
SET ANSI_NULLS ON
GO
 Create Procedure [dbo].[SVC_Find_Contract_Line]  (  @CONSTS smallint,  @CONTNBR char(11),  @SERIAL char(21),  @ITEMNMBR char(31),  @LINE numeric(19,5) OUTPUT,  @History tinyint,  @Version smallint  ) As  if @History = 1  Begin  if @SERIAL = '' or @SERIAL is null  begin  if exists(select 1 from SVC30601 where CONSTS = @CONSTS and CONTNBR = @CONTNBR and SVC_Contract_Version = @Version and ITEMNMBR = @ITEMNMBR and SERLNMBR = '')  select @LINE = LNSEQNBR from SVC30601 where CONSTS = @CONSTS and CONTNBR = @CONTNBR and SVC_Contract_Version = @Version and  ITEMNMBR = @ITEMNMBR and SERLNMBR = ''  else  select @LINE = IsNull(LNSEQNBR,0)  from SVC30601 where CONSTS = @CONSTS and CONTNBR = @CONTNBR and SVC_Contract_Version = @Version and ITEMNMBR = @ITEMNMBR   end  else if @ITEMNMBR = '' or @ITEMNMBR is null  select @LINE = IsNull(LNSEQNBR,0)  from SVC30601 where CONSTS = @CONSTS and CONTNBR = @CONTNBR and   SVC_Contract_Version = @Version and SERLNMBR = @SERIAL  else  select @LINE = IsNull(LNSEQNBR,0)  from SVC30601 where CONSTS = @CONSTS and CONTNBR = @CONTNBR and SVC_Contract_Version = @Version and  ITEMNMBR = @ITEMNMBR and SERLNMBR = @SERIAL End else Begin  if @SERIAL = '' or @SERIAL is null  begin  if exists(select 1 from SVC00601 where CONSTS = @CONSTS and CONTNBR = @CONTNBR and ITEMNMBR = @ITEMNMBR and SERLNMBR = '')  select @LINE = LNSEQNBR from SVC00601 where CONSTS = @CONSTS and CONTNBR = @CONTNBR and ITEMNMBR = @ITEMNMBR and SERLNMBR = ''  else  select @LINE = isnull(LNSEQNBR,0) from SVC00601 where CONSTS = @CONSTS and CONTNBR = @CONTNBR and ITEMNMBR = @ITEMNMBR   end  else if @ITEMNMBR = '' or @ITEMNMBR is null  select @LINE = IsNull(LNSEQNBR,0)  from SVC00601 where CONSTS = @CONSTS and CONTNBR = @CONTNBR and SERLNMBR = @SERIAL  else  select @LINE = IsNull(LNSEQNBR,0)  from SVC00601 where CONSTS = @CONSTS and CONTNBR = @CONTNBR and  ITEMNMBR = @ITEMNMBR and SERLNMBR = @SERIAL End  return    
GO
GRANT EXECUTE ON  [dbo].[SVC_Find_Contract_Line] TO [DYNGRP]
GO
