SET QUOTED_IDENTIFIER OFF
GO
SET ANSI_NULLS ON
GO
  CREATE Procedure [dbo].[SVC_Create_RMA_Audit](  @RETDOCID char(15),  @LineNumber numeric(19,5),  @From_Status char(3),  @To_Status  char(3),  @Description char(100),  @User char(15)  ) AS declare @L_datetime datetime,  @L_date datetime,  @L_time datetime,  @L_stat char(3),  @L_line int,  @LNSEQNBR int,  @Item char(30)  declare @RecordType int select @L_datetime = getdate() exec SVC_util_split_datetime @L_datetime,  @L_date output,  @L_time output  exec SVC_Get_RMA_Record_Type @RETDOCID, @RecordType output  if @LineNumber = 0  begin  if not exists(select * from SVC35000 where RETDOCID = @RETDOCID)  SET @RecordType = 1 end else  if not exists(select * from SVC35200 where RETDOCID = @RETDOCID and LNSEQNBR = @LineNumber)  SET @RecordType = 1  IF @RecordType = 2   begin  select @LNSEQNBR =max(IsNull(LNITMSEQ,0)) + 1 from SVC35020  where RETDOCID = @RETDOCID  if @LineNumber > 0 and exists(select * from SVC35200 where RETDOCID = @RETDOCID and LNSEQNBR = @LineNumber)  begin  select @Item = ITEMNMBR from SVC35200 where RETDOCID = @RETDOCID and LNSEQNBR = @LineNumber  select @Description = Rtrim(@Item) + '-' + substring(@Description, 1, 70)  end  select @LNSEQNBR = IsNull(@LNSEQNBR,1)   Insert into SVC35020   select @RETDOCID, @LineNumber, @LNSEQNBR, @From_Status, @To_Status, @Description, @User, @L_date, @L_time  end   ELSE   begin  select @LNSEQNBR =max(IsNull(LNITMSEQ,0)) + 1 from SVC05020  where RETDOCID = @RETDOCID  if @LineNumber > 0 and exists(select * from SVC05200 where RETDOCID = @RETDOCID and LNSEQNBR = @LineNumber)  begin  select @Item = ITEMNMBR from SVC05200 where RETDOCID = @RETDOCID and LNSEQNBR = @LineNumber  select @Description = Rtrim(@Item) + '-' + substring(@Description, 1, 70)  end  select @LNSEQNBR = IsNull(@LNSEQNBR,1)   Insert into SVC05020   select @RETDOCID, @LineNumber, @LNSEQNBR, @From_Status, @To_Status, @Description, @User, @L_date, @L_time   end  return   
GO
GRANT EXECUTE ON  [dbo].[SVC_Create_RMA_Audit] TO [DYNGRP]
GO
