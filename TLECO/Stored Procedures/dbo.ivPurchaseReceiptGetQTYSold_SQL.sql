SET QUOTED_IDENTIFIER OFF
GO
SET ANSI_NULLS ON
GO
 CREATE PROCEDURE [dbo].[ivPurchaseReceiptGetQTYSold_SQL]  @ItemNmbr char(31),  @Start_DateRecd datetime,  @Start_RctSeqNm int,  @End_DateRecd datetime,  @End_RctSeqNm int,  @RangeReversed tinyint,  @QtySold numeric(19,5) output AS  set @QtySold = 0  if @RangeReversed = 1 begin   set @QtySold =   isnull (  (select SUM(QTYSOLD)   from IV10201 a  where ITEMNMBR = @ItemNmbr and DOCDATE between @Start_DateRecd and @End_DateRecd    and QTYTYPE = 1                    and TRXREFERENCE <> 109      and   ((DOCDATE = @Start_DateRecd AND RCTSEQNM > @End_RctSeqNm)  OR  (DOCDATE = @End_DateRecd AND @Start_DateRecd <> @End_DateRecd and RCTSEQNM < @Start_RctSeqNm)  OR  (DOCDATE > @Start_DateRecd and DOCDATE < @End_DateRecd))    and ((select top 1 VCTNMTHD from IV10200 where ITEMNMBR = a.ITEMNMBR and RCTSEQNM = a.SRCRCTSEQNM   order by ITEMNMBR, RCTSEQNM, DEX_ROW_ID) > 0)   )  ,0) end else begin   set @QtySold =   isnull (  (select SUM(QTYSOLD)   from IV10201 a  where ITEMNMBR = @ItemNmbr and DOCDATE between @Start_DateRecd and @End_DateRecd    and QTYTYPE = 1                    and TRXREFERENCE <> 109      and   ((DOCDATE = @Start_DateRecd AND RCTSEQNM > @Start_RctSeqNm and DOCDATE = @End_DateRecd and RCTSEQNM < @End_RctSeqNm)  OR  (DOCDATE = @Start_DateRecd AND RCTSEQNM > @Start_RctSeqNm and DOCDATE <> @End_DateRecd)  OR  (DOCDATE = @End_DateRecd and @Start_DateRecd <> @End_DateRecd and RCTSEQNM < @End_RctSeqNm)  OR  (DOCDATE > @Start_DateRecd and DOCDATE < @End_DateRecd))   and ((select top 1 VCTNMTHD from IV10200 where ITEMNMBR = a.ITEMNMBR and RCTSEQNM = a.SRCRCTSEQNM   order by ITEMNMBR, RCTSEQNM, DEX_ROW_ID) <> 0)    )  ,0) end  if @Start_DateRecd > '1900-01-01' begin  if @RangeReversed = 1  begin  set @QtySold = @QtySold +   ISNULL (  (select sum(QTYSOLD)  from IV10201   where ITEMNMBR = @ItemNmbr and SRCRCTSEQNM = @End_RctSeqNm      and TRXREFERENCE = 109              )  ,0)  end  else  begin  set @QtySold = @QtySold +   ISNULL (   (select sum(QTYSOLD)  from IV10201   where ITEMNMBR = @ItemNmbr and SRCRCTSEQNM = @Start_RctSeqNm     and TRXREFERENCE = 109              )  ,0)   end end   
GO
GRANT EXECUTE ON  [dbo].[ivPurchaseReceiptGetQTYSold_SQL] TO [DYNGRP]
GO
