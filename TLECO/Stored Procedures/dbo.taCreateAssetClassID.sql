SET QUOTED_IDENTIFIER OFF
GO
SET ANSI_NULLS ON
GO
 create procedure [dbo].[taCreateAssetClassID]  @I_vASSETCLASSID char(15),    @I_vASSETCLASSIDDESC char(30) = '',   @I_vACCTGRPID char(15) = '',   @I_vINSCLASSID char(15) = '',   @I_vUSRDEFND1   char(50) = '',       @I_vUSRDEFND2   char(50) = '',       @I_vUSRDEFND3   char(50) = '',       @I_vUSRDEFND4   varchar(8000) = '',  @I_vUSRDEFND5   varchar(8000) = '',  @O_iErrorState   int output,   @oErrString   varchar(255) output   with encryption as  set transaction isolation level read uncommitted set nocount on  declare   @ASSETCLASSINDX int,    @DEFACCTGRPINDX int,    @DEFINSCLASSINDX int,    @NOTEINDX numeric(19,5),  @CMPANYID smallint,  @O_iNumErrorState int,  @iGetNextNoteIdxErrState int,  @iAddCodeErrState int,    @iStatus int,  @iCustomState int,  @iCustomErrString varchar(255),  @O_oErrorState int,  @iError int     select  @ASSETCLASSINDX = 0,    @DEFACCTGRPINDX = 0,    @DEFINSCLASSINDX = 0,    @CMPANYID = 0,  @iStatus = 0,   @O_iErrorState = 0    if (@oErrString is NULL) begin  select @oErrString = '' end  exec @iStatus = taCreateAssetClassIDPre  @I_vASSETCLASSID output,  @I_vASSETCLASSIDDESC output,  @I_vACCTGRPID output,  @I_vINSCLASSID output,  @I_vUSRDEFND1 output,  @I_vUSRDEFND2 output,  @I_vUSRDEFND3 output,  @I_vUSRDEFND4 output,  @I_vUSRDEFND5 output,  @O_iErrorState = @iCustomState output,  @oErrString = @iCustomErrString output select @iError = @@error if @iStatus = 0 and @iError <> 0 begin  select @iStatus = @iError end if (@iStatus <> 0) or (@iCustomState <> 0) begin  select @oErrString = rtrim(@oErrString) + ' ' + ltrim(rtrim(@iCustomErrString))  select @O_iErrorState = 3141    exec @iStatus = taUpdateString  @O_iErrorState,   @oErrString,  @oErrString output,  @O_oErrorState output  return (@O_iErrorState) end  if(  @I_vASSETCLASSID is NULL or  @I_vASSETCLASSIDDESC is NULL or  @I_vACCTGRPID is NULL or  @I_vINSCLASSID is NULL or  @I_vUSRDEFND1 is NULL or   @I_vUSRDEFND2 is NULL or   @I_vUSRDEFND3 is NULL or   @I_vUSRDEFND4 is NULL or  @I_vUSRDEFND5 is NULL   )  begin  select @O_iErrorState = 3142    exec @iStatus = taUpdateString  @O_iErrorState,   @oErrString,  @oErrString output,  @O_oErrorState output  return (@O_iErrorState) end  select  @I_vASSETCLASSID = UPPER(@I_vASSETCLASSID),  @I_vACCTGRPID = UPPER(@I_vACCTGRPID),  @I_vINSCLASSID = UPPER(@I_vINSCLASSID)  select @CMPANYID = CMPANYID from DYNAMICS..SY01500 (nolock) where INTERID = db_name()  if (@ASSETCLASSINDX = 0)   begin  exec @iStatus = taGetAssetClassIndex  @I_tInc_Dec = 1,   @O_vAssetClassIndex = @ASSETCLASSINDX output,  @O_iErrorState = @O_iNumErrorState output  select @iError = @@error  if ((@iStatus <> 0) or (@O_iNumErrorState <> 0) or (@iError <> 0))  begin  select @O_iErrorState = 9152   exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output  return (@O_iErrorState)  end end  exec @iStatus = DYNAMICS..tasmGetNextNoteIndex  @I_sCompanyID   = @CMPANYID,  @I_iSQLSessionID = 0,  @I_noteincrement  = 1,  @O_mNoteIndex   = @NOTEINDX output,  @O_iErrorState  = @iGetNextNoteIdxErrState output select @iError = @@error if @iStatus = 0 and @iError <> 0 begin  select @iStatus = @iError end if (@iStatus <> 0) or (@iGetNextNoteIdxErrState <> 0) begin  if (@iGetNextNoteIdxErrState <> 0)  begin  exec @iStatus = taUpdateString  @iGetNextNoteIdxErrState,  @oErrString,  @oErrString output,  @O_oErrorState output  end  select @O_iErrorState = 3143   exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output end  if  ( @I_vASSETCLASSID = '' ) begin  select @O_iErrorState = 3144    exec @iStatus = taUpdateString  @O_iErrorState,   @oErrString,  @oErrString output,  @iAddCodeErrState output end  if  ( @I_vACCTGRPID <> '' ) begin  if (not exists(select 1 from FA41300 (nolock) where ACCTGRPID = @I_vACCTGRPID))  begin  select @O_iErrorState = 3145     exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output  end end  select @DEFACCTGRPINDX = ACCTGRPINDEX from FA41300 (nolock) where ACCTGRPID = @I_vACCTGRPID  if  ( @I_vINSCLASSID <> '' ) begin  if (not exists(select 1 from FA41200 (nolock) where INSCLASSID = @I_vINSCLASSID))  begin  select @O_iErrorState = 3146     exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output  end end  select @DEFINSCLASSINDX = INSCLASSINDX from FA41200 (nolock) where INSCLASSID = @I_vINSCLASSID  if (@O_iErrorState = 0) begin  if not exists( select 1 from FA40201 (nolock) where  ASSETCLASSID = @I_vASSETCLASSID )   begin  insert into FA40201 ( ASSETCLASSINDX,  ASSETCLASSID,  ASSETCLASSIDDESC,  DEFACCTGRPINDX,   DEFINSCLASSINDX,  NOTEINDX,  LASTMNTDDATE,  LASTMNTDTIME,  LASTMNTDUSERID  )  select   @ASSETCLASSINDX,     @I_vASSETCLASSID,     @I_vASSETCLASSIDDESC,     @DEFACCTGRPINDX,      @DEFINSCLASSINDX,     @NOTEINDX,      convert(varchar(12),getdate()),    '',       'eConnect'      if @@error <> 0  begin  select @O_iErrorState = 3147    exec @iStatus = taUpdateString  @O_iErrorState,   @oErrString,  @oErrString output,  @O_oErrorState output  return (@O_iErrorState)  end  end  else  begin  select @O_iErrorState = 3148    exec @iStatus = taUpdateString  @O_iErrorState,   @oErrString,  @oErrString output,  @iAddCodeErrState output  end  end  if @O_iErrorState <> 0  return (@O_iErrorState)  exec @iStatus = taCreateAssetClassIDPost  @I_vASSETCLASSID,  @I_vASSETCLASSIDDESC,  @I_vACCTGRPID,  @I_vINSCLASSID,  @I_vUSRDEFND1,  @I_vUSRDEFND2,  @I_vUSRDEFND3,  @I_vUSRDEFND4,  @I_vUSRDEFND5,  @O_iErrorState = @iCustomState output,  @oErrString = @iCustomErrString output select @iError = @@error if @iStatus = 0 and @iError <> 0 begin  select @iStatus = @iError end if (@iStatus <> 0) or (@iCustomState <> 0) begin  select @oErrString = rtrim(@oErrString) + ' ' + ltrim(rtrim(@iCustomErrString))  select @O_iErrorState = 3149    exec @iStatus = taUpdateString  @O_iErrorState,   @oErrString,  @oErrString output,  @O_oErrorState output  return (@O_iErrorState) end  return (@O_iErrorState)   
GO
GRANT EXECUTE ON  [dbo].[taCreateAssetClassID] TO [DYNGRP]
GO
