SET QUOTED_IDENTIFIER OFF
GO
SET ANSI_NULLS ON
GO
 CREATE Procedure [dbo].[SVC_Create_Transfer]  ( @FromLocation char(11),  @ToLocation char(11),  @ItemNumber char(31),  @Descr char(31),  @UofM char(9),  @QtyType smallint,  @Qty numeric(19,5),  @CallNumber char(11) = '',  @SrvRecType smallint = 0,  @SrvLineSeq int = 0,  @EquipLine int = 0,  @LineItemType char(3) = '',  @RetDocID char(15) = '',  @RetLineNum numeric(19,5) = 0,  @RTV_Number char(15) = '',  @WO_RecType smallint = 0,  @WO_Number char(11) = '',  @AddressOption smallint,  @AddressCode char(15),  @Customer char(15),  @UserDate datetime,  @DECPLCUR smallint,  @DECPLQTY smallint,  @QtyInBaseUOM numeric(19,5),  @TransferNumber char(15) = '' output,  @TransferLine int output  ) As declare @NextLine integer declare  @NowDateTime datetime,  @NowDate datetime,  @NowTime datetime declare  @H_ORDDOCID char(15),  @H_RFRNCDOC char(21),  @H_TECHID   char(11),  @H_OFFID    char(11),  @H_STATUS   smallint,  @H_ORDRDATE datetime,  @H_ETADTE   datetime,  @H_NAME     char(65),  @H_ADDRESS1 char(31),  @H_ADDRESS2 char(31),  @H_ADDRESS3 char(31),  @H_CITY     char(31),  @H_STATE    char(30),  @H_ZIPCODE  char(11),  @H_COUNTRY     char(21),  @H_SHIPMTHD char(15),  @H_TRNSFLOC char(11),  @H_ITLOCN   char(11),  @H_LOCNCODE char(11),  @H_DocLocation char(11),  @H_NOTEINDX numeric(19,5),  @H_SVC_Address_Option smallint,  @H_SVC_Misc_Address_Code char(15) declare  @L_ORDDOCID              char(15),  @L_LNITMSEQ              int,  @L_STATUS                smallint,  @L_ITEMNMBR              char(31),  @L_DSCRIPTN              char(31),  @L_UOFM                  char(9),  @L_TRNSFQTY              numeric(19,5),  @L_QTYFULFI              numeric(19,5),  @L_QTYSHPPD              numeric(19,5),  @L_QTY_To_Receive        numeric(19,5),  @L_QTYRECVD              numeric(19,5),  @L_CALLNBR               char(11),  @L_SRVRECTYPE            smallint,  @L_SERVLITEMSEQ          int,  @L_EQPLINE               int,  @L_LINITMTYP             char(3),  @L_RETDOCID              char(15),  @L_Line_Number numeric(19,5),  @L_RTV_Number            char(15),  @L_WORECTYPE             smallint,  @L_WORKORDNUM            char(11),  @L_QTYBSUOM numeric(19,5),  @L_TRNSFLOC char(11),  @L_ITLOCN char(11),   @L_TRNSTLOC char(11),  @L_TRFQTYTY smallint,  @L_TRTQTYTY smallint,  @L_DECPLCUR smallint,  @L_DECPLQTY smallint,  @L_Landed_Cost_Group_ID char(15),  @ETADays smallint declare @grouping tinyint, @IDfound tinyint declare @tstatus integer  select @tstatus = 0, @IDfound = 0  set nocount on  select @H_SVC_Address_Option = SVC_Address_Option,  @H_SVC_Misc_Address_Code = '',  @grouping = SVC_Disable_XFR_Grouping  from SVC00998  if @CallNumber is null or @CallNumber = ''  BEGIN  if @grouping = 0  BEGIN  select @H_ORDDOCID=ORDDOCID from SVC00700   where TRNSFLOC = @FromLocation and LOCNCODE = @ToLocation and  STATUS = @tstatus   if @H_ORDDOCID > ''  select @IDfound = 1  END  END else  BEGIN  if @grouping = 0  exec SVC_Find_XFR_For_Grouping @FromLocation,@ToLocation,'',@CallNumber,@SrvLineSeq,@EquipLine,0,@H_ORDDOCID output,@IDfound output  END  select @H_SHIPMTHD = SHIPMTHD, @ETADays = ETADAYS, @L_ITLOCN = isnull(ITLOCN,'') from SVC00952  where ITEMNMBR = @ItemNumber and LOCNCODE = @ToLocation and TRNSFLOC = @FromLocation  if @IDfound = 0 BEGIN  exec SVC_Get_Next_Xfer_Number @H_ORDDOCID output  if @AddressOption <> 0  BEGIN  select @H_SVC_Address_Option = @AddressOption  select @H_SVC_Misc_Address_Code = @AddressCode  END   select @NowDateTime = getdate()  exec SVC_util_split_datetime @NowDateTime,@NowDate output,@NowTime output   select @H_ORDRDATE = @UserDate,  @H_RFRNCDOC = '',  @H_TECHID = '',  @H_OFFID  = '',  @H_STATUS = 0,  @H_ETADTE  = dateadd(dd,@ETADays,@UserDate)  if @AddressOption = 1  BEGIN  select @H_NAME = CUSTNAME from RM00101 where CUSTNMBR = @Customer  select @H_ADDRESS1 = ADDRESS1,  @H_ADDRESS2 = ADDRESS2,  @H_ADDRESS3 = ADDRESS3,  @H_SHIPMTHD = SHIPMTHD,  @H_CITY     = CITY,  @H_COUNTRY = COUNTRY,  @H_STATE    = STATE,  @H_ZIPCODE  = ZIP  from RM00102  where CUSTNMBR = @Customer and ADRSCODE = @AddressCode  END  ELSE if @AddressOption = 3  BEGIN  select @H_NAME = DSCRIPTN,  @H_SHIPMTHD = SHIPMTHD,  @H_ADDRESS1 = ADDRESS1,  @H_ADDRESS2 = ADDRESS2,  @H_ADDRESS3 = ADDRESS3,  @H_CITY     = CITY,  @H_COUNTRY = COUNTRY,  @H_STATE    = STATE,  @H_ZIPCODE  = ZIP  from SVC00980  where SVC_Misc_Address_Code = @AddressCode  END  ELSE  BEGIN  select  @H_NAME = LOCNDSCR,  @H_ADDRESS1 = ADDRESS1,  @H_ADDRESS2 = ADDRESS2,  @H_ADDRESS3 = ADDRESS3,  @H_CITY     = CITY,  @H_COUNTRY = COUNTRY,  @H_STATE    = STATE,  @H_ZIPCODE  = ZIPCODE  from IV40700  where LOCNCODE = @ToLocation  END   select  @H_TRNSFLOC = @FromLocation,  @H_ITLOCN  = '',  @H_LOCNCODE = @ToLocation,  @H_NOTEINDX = 0  select @H_SHIPMTHD = isnull(@H_SHIPMTHD,'')  insert SVC00700  values  (  @H_ORDDOCID ,  @H_RFRNCDOC ,  @H_TECHID   ,  @H_OFFID    ,  @H_STATUS   ,  isnull(@H_ORDRDATE,@NowDate) ,  isnull(@H_ETADTE,@NowDate)   ,  @H_NAME     ,  @H_ADDRESS1 ,  @H_ADDRESS2 ,  @H_CITY     ,  @H_STATE    ,  @H_ZIPCODE  ,  @H_SHIPMTHD ,  @H_TRNSFLOC ,  @H_ITLOCN   ,  @H_LOCNCODE ,  @H_NOTEINDX ,  @H_SVC_Address_Option ,  @H_SVC_Misc_Address_Code,  @H_ADDRESS3,  @H_COUNTRY,''  ) END else    select  @H_TRNSFLOC = @FromLocation,  @H_ITLOCN  = '',  @H_LOCNCODE = @ToLocation,  @H_NOTEINDX = 0,  @H_SHIPMTHD = isnull(@H_SHIPMTHD,'')  exec SVC_Get_Next_Transfer_Line @H_ORDDOCID, @NextLine output select @L_Landed_Cost_Group_ID = isnull(Landed_Cost_Group_ID,'') from IV00102 where ITEMNMBR = @ItemNumber and LOCNCODE = @ToLocation select  @L_ORDDOCID = @H_ORDDOCID,  @L_LNITMSEQ = isnull(@NextLine,16384),  @L_STATUS = 0,  @L_ITEMNMBR = @ItemNumber,  @L_DSCRIPTN = @Descr,  @L_UOFM = @UofM,  @L_TRNSFQTY = @Qty,  @L_QTYFULFI = 0,  @L_QTYSHPPD = 0,  @L_QTY_To_Receive = 0,  @L_QTYRECVD = 0,  @L_CALLNBR = @CallNumber,  @L_SRVRECTYPE = @SrvRecType,  @L_SERVLITEMSEQ = @SrvLineSeq,  @L_EQPLINE = @EquipLine,  @L_LINITMTYP = @LineItemType,  @L_RETDOCID = @RetDocID,  @L_Line_Number = @RetLineNum,  @L_RTV_Number = @RTV_Number,  @L_WORECTYPE = @WO_RecType,  @L_WORKORDNUM = @WO_Number,  @L_TRNSFLOC = @H_TRNSFLOC,   @L_TRNSTLOC = @H_LOCNCODE,  @L_TRFQTYTY = @QtyType,  @L_TRTQTYTY =@QtyType,  @L_DECPLCUR = @DECPLCUR,  @L_DECPLQTY = @DECPLQTY,  @L_QTYBSUOM = @QtyInBaseUOM select  @L_DECPLCUR = DECPLCUR, @L_DECPLQTY = DECPLQTY from IV00101 where ITEMNMBR = @ItemNumber  insert SVC00701 values (  @L_ORDDOCID,  @L_LNITMSEQ,  @L_STATUS,  @L_ITEMNMBR,  @L_DSCRIPTN,  @L_UOFM,  @L_TRNSFQTY,  @L_QTYFULFI,  @L_QTYSHPPD,  @L_QTY_To_Receive,  @L_QTYRECVD,  @L_CALLNBR,  @L_SRVRECTYPE,  @L_SERVLITEMSEQ,  @L_EQPLINE,  @L_LINITMTYP,  @L_RETDOCID,  @L_Line_Number,  @L_RTV_Number,  @L_WORECTYPE,  @L_WORKORDNUM,  @L_QTYBSUOM,  @L_TRNSFLOC,  isnull(@L_ITLOCN,''),  @L_TRNSTLOC,  @L_TRFQTYTY,  @L_TRTQTYTY,  @L_DECPLCUR,  @L_DECPLQTY,  @L_Landed_Cost_Group_ID,  ''  ) select @TransferNumber = @L_ORDDOCID select  @TransferLine = @L_LNITMSEQ return    
GO
GRANT EXECUTE ON  [dbo].[SVC_Create_Transfer] TO [DYNGRP]
GO
