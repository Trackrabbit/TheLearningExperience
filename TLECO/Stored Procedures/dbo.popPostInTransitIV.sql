SET QUOTED_IDENTIFIER OFF
GO
SET ANSI_NULLS ON
GO
 Create Procedure [dbo].[popPostInTransitIV] (  @Date datetime,  @RCVNumber char(21),  @RCVLineSeq numeric(19,5),  @TransferNumber char(21),  @TransferLine numeric(19,5),  @ItemNumber char(31),  @UnitCost numeric(19,5) output,  @Tracking smallint,  @ValuaMethod smallint,  @InvenIndex int,  @OffsetIndex int,  @Qty numeric(19,5) ) AS declare @MultiBinEnabled tinyint,  @Sequence int,  @POPTYPE smallint,  @SerialLotNumber char(21),  @Location char(11),  @DateRcv datetime,  @DateSeq numeric(19,5),  @RcvSequence int,  @PurRctType smallint,  @nError int,  @UpdatedQty numeric(19,5),  @AvailableQTY numeric(19,5),  @ExtCost numeric(19,5),  @CurrentCost numeric(19,5),  @BinQty numeric(19,5),  @TotalBinQty numeric(19,5),  @ToBin char(15),  @ShippedQty numeric(19,5),  @trys int,  @iErrorState int  select @UpdatedQty = 0, @ExtCost = 0, @TotalBinQty = @Qty, @ShippedQty = @Qty, @trys = 0 if (select ENABLEMULTIBIN from IV40100) = 1  select @MultiBinEnabled = 1 else  select @MultiBinEnabled = 0  if @Tracking = 1  Begin  if @MultiBinEnabled = 1  Begin  declare XBin_record cursor for select SEQNUMBR, QUANTITY, TOBIN,LOCNCODE from SVC00712   where ORDDOCID = @TransferNumber and LNITMSEQ = @TransferLine   open XBin_record   fetch next from XBin_record into @Sequence, @BinQty, @ToBin, @Location  while @@FETCH_STATUS = 0 and @TotalBinQty > 0  begin    select @AvailableQTY = ATYALLOC from IV00112   where ITEMNMBR =@ItemNumber and LOCNCODE =@Location and BIN = @ToBin and QTYTYPE = 1  if @AvailableQTY >= @BinQty  select @UpdatedQty = @BinQty  else  select @UpdatedQty = @AvailableQTY   if @TotalBinQty > @UpdatedQty  update IV00112 set ATYALLOC = ATYALLOC - @UpdatedQty, QUANTITY = QUANTITY - @UpdatedQty where  ITEMNMBR =@ItemNumber and LOCNCODE =@Location and BIN = @ToBin and QTYTYPE = 1  else  update IV00112 set ATYALLOC = ATYALLOC - @TotalBinQty, QUANTITY = QUANTITY - @TotalBinQty where  ITEMNMBR =@ItemNumber and LOCNCODE =@Location and BIN = @ToBin and QTYTYPE = 1  select @TotalBinQty = @TotalBinQty - @UpdatedQty  fetch next from XBin_record into @Sequence, @BinQty, @ToBin, @Location  end  close XBin_record  deallocate XBin_record  End  End  return    
GO
GRANT EXECUTE ON  [dbo].[popPostInTransitIV] TO [DYNGRP]
GO
