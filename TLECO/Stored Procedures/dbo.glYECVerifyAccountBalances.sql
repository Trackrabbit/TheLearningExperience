SET QUOTED_IDENTIFIER OFF
GO
SET ANSI_NULLS ON
GO
 create procedure [dbo].[glYECVerifyAccountBalances]  @I_sYear smallint = NULL,  @I_tMCRegistered tinyint  = NULL,  @O_tBalanceExists tinyint  = NULL output,  @O_SQL_Error_State int   = NULL output as  declare  @iStatus int,  @iError int,  @FALSE int,  @TRUE int,  @POST_ACCT int,  @UNIT_ACCT int,  @BAL_SHEET int  select @O_SQL_Error_State = 0,  @O_tBalanceExists = 0  if  @I_sYear   is NULL or  @I_tMCRegistered is NULL  begin  select @O_SQL_Error_State = 21093  return  end   exec @iStatus = DYNAMICS..smGetConstantInt  'FALSE',  @FALSE output,  @O_SQL_Error_State output  select @iError = @@error  if @iStatus = 0 and @iError <> 0  select @iStatus = @iError if ( (@iStatus <> 0) or (@O_SQL_Error_State <> 0) )  return (@iStatus)  exec @iStatus = DYNAMICS..smGetConstantInt  'TRUE',  @TRUE output,  @O_SQL_Error_State output  select @iError = @@error  if @iStatus = 0 and @iError <> 0  select @iStatus = @iError if ( (@iStatus <> 0) or (@O_SQL_Error_State <> 0) )  return (@iStatus)  exec @iStatus = DYNAMICS..smGetConstantInt  'POST_ACCT',  @POST_ACCT output,  @O_SQL_Error_State output  select @iError = @@error  if @iStatus = 0 and @iError <> 0  select @iStatus = @iError if ( (@iStatus <> 0) or (@O_SQL_Error_State <> 0) )  return (@iStatus)  exec @iStatus = DYNAMICS..smGetConstantInt  'UNIT_ACCT',  @UNIT_ACCT output,  @O_SQL_Error_State output  select @iError = @@error  if @iStatus = 0 and @iError <> 0  select @iStatus = @iError if ( (@iStatus <> 0) or (@O_SQL_Error_State <> 0) )  return (@iStatus)  exec @iStatus = DYNAMICS..smGetConstantInt  'BAL_SHEET',  @BAL_SHEET output,  @O_SQL_Error_State output  select @iError = @@error  if @iStatus = 0 and @iError <> 0  select @iStatus = @iError if ( (@iStatus <> 0) or (@O_SQL_Error_State <> 0) )  return (@iStatus)  if exists(  select  distinct 1  from   GL00100 join GL10110 on (GL00100.ACTINDX = GL10110.ACTINDX)  where   ((ACCTTYPE = @POST_ACCT and PSTNGTYP = @BAL_SHEET) or ACCTTYPE = @UNIT_ACCT)  and ACTIVE = 0  and GL10110.YEAR1 = @I_sYear  group by  GL00100.ACTINDX  having  SUM(GL10110.PERDBLNC) <> 0 ) begin  select @O_tBalanceExists = 1  return end  if @I_tMCRegistered = @TRUE begin  if exists(  select   distinct 1  from  GL00100 join MC00201 on (GL00100.ACTINDX = MC00201.ACTINDX)  where   ACCTTYPE = @POST_ACCT  and PSTNGTYP = @BAL_SHEET  and ACTIVE = 0  and MC00201.OPENYEAR = @I_sYear  group by  MC00201.ACTINDX, MC00201.CURRNIDX  having  SUM(MC00201.ORIGAMT) <> 0 )  begin  select @O_tBalanceExists = 1  return  end end  return    
GO
GRANT EXECUTE ON  [dbo].[glYECVerifyAccountBalances] TO [DYNGRP]
GO
