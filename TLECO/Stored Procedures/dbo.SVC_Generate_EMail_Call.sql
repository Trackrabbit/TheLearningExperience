SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO
 CREATE procedure [dbo].[SVC_Generate_EMail_Call](@CallNumber char(11),  @RecType smallint, @message varchar(8000) output) as  SELECT  @message = 'Call Type:' + CONVERT(varchar(2),@RecType) + char(13) + char(10) +  'ServiceDescription:' + SVC00200.SVCDESCR + char(13) + char(10) +   'ServiceCallCustomer:' + SVC00200.CUSTNMBR + char(13) + char(10) +  'Call Phone:' + SVC00200.PHONE1 + char(13) + char(10) +   'Entered Date:' + CONVERT(varchar(10),SVC00200.ENTDTE,101) + char(13) + char(10) +   'Entered Time:' +  CONVERT(varchar(10),SVC00200.ENTTME,108) + char(13) + char(10) +   'ETA Date:' + CONVERT(varchar(10),SVC00200.ETADTE,101) + char(13) + char(10) +   'ETA Time:' +  CONVERT(varchar(10),SVC00200.ETATME,108) + char(13) + char(10) +   'Call Notes:' + CONVERT(varchar(3000),IsNull(SY03900.TXTFIELD,'')) + char(13) + char(10) +   'Call Address:' + SVC00200.ADDRESS1 + ', ' + SVC00200.ADDRESS2 + ', ' +  SVC00200.ADDRESS3 + char(13) + char(10) +  'Call City:' + SVC00200.CITY + char(13) + char(10) +   'Call State:' + SVC00200.STATE + char(13) + char(10) +   'Call Zip:' + SVC00200.ZIP + char(13) + char(10) +   'Call Country:' + SVC00200.COUNTRY + char(13) + char(10) +   'Status Description:' + IsNull(SVC00913.STSDESCR,'') + char(13) + char(10) +   'Call Type Description:' + IsNull(SVC00920.DSCRIPTN,'')  + char(13) + char(10) +   'Call Types:' + SVC00200.SRVTYPE + ' ' + IsNull(SVC00920.DSCRIPTN,'')  + char(13) + char(10) +   'PO Number:' + SVC00200.PORDNMBR + char(13) + char(10) +   'Item Number:' + IsNull(SVC00201.ITEMNMBR,'') + char(13) + char(10) +   'Item Description:' + IsNull(IV00101.ITEMDESC,'') + char(13) + char(10) +   'Serial Number:' + IsNull(SVC00300.SERLNMBR,'') + char(13) + char(10) +   'Problem Code:' + IsNull(SVC00201.PROBCDE,'') + char(13) + char(10) +   'Problem Code Description:' + IsNull(SVC00907.DSCRIPTN,'') + char(13) + char(10) +   'Cause Code:' + IsNull(SVC00201.CAUSECDE,'') + char(13) + char(10) +   'Cause Code Description:' +  IsNull(SVC00901.DSCRIPTN,'')  + char(13) + char(10) +   'Repair Code:' +SVC00201.RPRCODE + char(13) + char(10) +   'Repair Code Description:' + IsNull(SVC00908.DSCRIPTN,'')  + char(13) + char(10)  FROM SVC00200 INNER JOIN   SVC00913 ON (SVC00200.SRVSTAT = SVC00913.SRVSTAT) LEFT OUTER JOIN   SVC00920 ON (SVC00200.SRVTYPE = SVC00920.SRVTYPE) LEFT OUTER JOIN   SVC00201 ON (SVC00200.SRVRECTYPE = SVC00201.SRVRECTYPE and SVC00200.CALLNBR = SVC00201.CALLNBR) LEFT OUTER JOIN  SVC00300 ON (SVC00201.EQUIPID = SVC00300.EQUIPID) LEFT OUTER JOIN   SY03900 ON (SVC00200.NOTEINDX = SY03900.NOTEINDX) LEFT OUTER JOIN  SVC00907 ON (SVC00201.PROBCDE = SVC00907.PROBCDE) LEFT OUTER JOIN  SVC00908 ON (SVC00201.RPRCODE = SVC00908.RPRCODE) LEFT OUTER JOIN  SVC00901 ON (SVC00201.CAUSECDE = SVC00901.CAUSECDE) LEFT OUTER JOIN  IV00101 ON (SVC00201.ITEMNMBR = IV00101.ITEMNMBR) where SVC00200.CALLNBR = @CallNumber and SVC00200.SRVRECTYPE = @RecType    
GO
GRANT EXECUTE ON  [dbo].[SVC_Generate_EMail_Call] TO [DYNGRP]
GO
