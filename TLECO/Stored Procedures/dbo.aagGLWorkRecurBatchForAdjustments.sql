SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO
 CREATE Procedure [dbo].[aagGLWorkRecurBatchForAdjustments] @JRNENTRY    int, @RCTRXSEQ numeric(19,5), @aaGLHdrID int, @aaGLWorkHdrID int as Begin  declare  @aaGLDistID int,  @aaGLAssignID  int,  @aaTrxDimID int,  @aaTrxCodeID int,  @aaAcctClassID int,  @TempTrxDimID int  Select  @aaGLDistID =0,  @aaGLAssignID  =0,  @aaTrxDimID =0,  @aaTrxCodeID =0,  @aaAcctClassID  =0   declare CCode cursor fast_forward for   Select aaGLDistID, aaGLAssignID  from AAG30002  where aaGLHdrID = @aaGLHdrID and aaGLDistID > 0  and aaGLAssignID >0  open CCode  fetch next from CCode into @aaGLDistID, @aaGLAssignID  while @@fetch_status = 0  begin  Select @aaAcctClassID = aaAcctClassID from AAG00200  where ACTINDX in (select ACTINDX from AAG30001  where aaGLHdrID = @aaGLHdrID and aaGLDistID = @aaGLDistID)  Insert into AAG10003  (aaGLWorkHdrID, aaGLWorkDistID, aaGLWorkAssignID, aaTrxDimID, aaTrxCodeID, aaCodeErrors)  Select @aaGLWorkHdrID,@aaGLDistID, @aaGLAssignID, aaTrxDimID, 0, 0 from AAG00202  where aaAcctClassID = @aaAcctClassID and aaTrxDimID >=0   and aaTrxDimID not in(select aaTrxDimID from AAG10003 where aaGLWorkHdrID=@aaGLWorkHdrID  and aaGLWorkDistID=@aaGLDistID and aaGLWorkAssignID=@aaGLAssignID)   declare CCodeTrx cursor fast_forward for  select aaTrxDimID, aaTrxCodeID from AAG30003  where aaGLHdrID = @aaGLHdrID and  aaGLDistID = @aaGLDistID and  aaGLAssignID = @aaGLAssignID  open CCodeTrx  fetch next from CCodeTrx into @aaTrxDimID,@aaTrxCodeID  while @@fetch_status = 0  begin  update AAG10003 set aaTrxCodeID = @aaTrxCodeID  where aaGLWorkHdrID = @aaGLWorkHdrID and  aaGLWorkDistID = @aaGLDistID and  aaGLWorkAssignID = @aaGLAssignID and  aaTrxDimID = @aaTrxDimID   fetch next from CCodeTrx into @aaTrxDimID,@aaTrxCodeID  end   close CCodeTrx  deallocate CCodeTrx  fetch next from CCode into @aaGLDistID, @aaGLAssignID  end  close CCode  deallocate CCode End    
GO
GRANT EXECUTE ON  [dbo].[aagGLWorkRecurBatchForAdjustments] TO [DYNGRP]
GO
