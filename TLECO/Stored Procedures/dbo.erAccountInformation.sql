SET QUOTED_IDENTIFIER OFF
GO
SET ANSI_NULLS OFF
GO
 create procedure [dbo].[erAccountInformation] @list_of_segments varchar(255)=NULL as  declare   @vGroupByList varchar(255),  @bFirstGroupBy bit,  @vFinalSelectList1 varchar(255),  @vFinalSelectList2 varchar(255),  @vMinSelectList varchar(255),  @tNumberSegments tinyint,  @tLoopControl tinyint,  @cIndex char(2),  @vInternalSegList varchar(255),  @vSortOrder varchar(255),  @iRetval integer  set nocount on  select @tLoopControl    = 1 select @bFirstGroupBy   = 1 select @vFinalSelectList1  = '' select @vFinalSelectList2  = '' select @vMinSelectList   = '' select @vGroupByList   = '' select @vSortOrder    = ''  exec @iRetval = erInternalParseSegmentList   @list_of_segments,   @vInternalSegList out,   @vSortOrder out,  @tNumberSegments out if @iRetval <> 0 begin  return @iRetval end  while @tLoopControl <= @tNumberSegments begin  select @cIndex = ltrim(str(@tLoopControl))  if substring(@vInternalSegList,@tLoopControl,1) = '1'  begin  if @bFirstGroupBy = 1  begin  select @vGroupByList = @vGroupByList + 'ACTNUMBR_' + @cIndex  select @bFirstGroupBy = 0  end  else  begin  select @vGroupByList = @vGroupByList + ', ACTNUMBR_' + @cIndex  end   if @tLoopControl <= 8  begin  select @vFinalSelectList1 = @vFinalSelectList1 +   'account_number_' + @cIndex +   '=ACTNUMBR_' + @cIndex + ','  end  else  begin  select @vFinalSelectList2 = @vFinalSelectList2 +   'account_number_' + @cIndex +   '=ACTNUMBR_' + @cIndex + ','  end  end  else  begin  select @vMinSelectList = @vMinSelectList + 'ACTNUMBR_' + @cIndex + '+'  end   select @tLoopControl = @tLoopControl + 1 end  if rtrim(ltrim(@vMinSelectList)) <> '' begin  create table ##TEMPACT99 ( min_list varchar(255) )   exec(  'insert into ##TEMPACT99 select min( ' +  @vMinSelectList +  ' convert(char(10),ACTINDX)+'':'') from GL00100 '+  'where (ACCTTYPE >= 1 and ACCTTYPE <= 2) group by ' +  @vGroupByList  )   exec(  'select ' +  @vFinalSelectList1 + @vFinalSelectList2 +  'account_description= ACTDESCR,' +  'account_alias  = ACTALIAS,' +  'posting_type  = PSTNGTYP,' +  'typical_balance = TPCLBLNC,' +  'account_type  = ACCTTYPE' +  ' from ##TEMPACT99, GL00100' +   ' where (ACCTTYPE >= 1 and ACCTTYPE <= 2) and' +  ' (convert(int,substring(right(min_list,11),1,10)) = ACTINDX)' +  ' order by ' + @vSortOrder  )   drop table ##TEMPACT99  end else begin  exec(  'select '+  @vFinalSelectList1 + @vFinalSelectList2 +  'account_description= ACTDESCR,'+  'account_alias  = ACTALIAS,'+  'posting_type  = PSTNGTYP,'+  'typical_balance = TPCLBLNC,'+  'account_type  = ACCTTYPE'+  ' from GL00100'+  ' where ACCTTYPE >= 1 and ACCTTYPE <= 2 '+  ' order by ' + @vSortOrder  ) end  return 0    
GO
GRANT EXECUTE ON  [dbo].[erAccountInformation] TO [DYNGRP]
GO
