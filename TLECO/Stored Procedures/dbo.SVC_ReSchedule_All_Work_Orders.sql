SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO
 CREATE PROCEDURE [dbo].[SVC_ReSchedule_All_Work_Orders]   (@ERROR integer OUTPUT)  AS  declare @WORKORDNUM char(11)  declare @WORECTYPE smallint  declare @Priority numeric(19,5)  declare @EstimatedCompletion datetime declare @Commit datetime declare @etadate datetime declare G_cursor INSENSITIVE CURSOR for   select distinct WO.WORECTYPE,WO.WORKORDNUM, WO.SVC_Depot_Priority,WO.ETADTE   from SVC06100 WO   WHERE WO.WORECTYPE < 3 and   (WO.Commit_Date = '01/01/1900 00:00' or WO.NUMRESCHED = 0)  order by WO.SVC_Depot_Priority,WO.ETADTE  set nocount on  update SVC06105   set ETADTE = '01/01/1900 00:00:00',   ETATME = '01/01/1900 00:00:00',   ECOMPDT = '01/01/1900 00:00:00',   EComp_Time = '01/01/1900 00:00:00'   from SVC06100  where SVC06105.WORECTYPE = @WORECTYPE and   SVC06105.WORKORDNUM = @WORKORDNUM and   Status <> 3 and Status <> 2 and   SVC06100.WORKORDNUM = SVC06105.WORKORDNUM and  SVC06100.WORECTYPE = SVC06105.WORECTYPE and  ((SVC06100.Commit_Date = '01/01/1900 00:00') or  SVC06100.NUMRESCHED = 0) delete from SVC06300 where SVC06300.Status <> 2 and SVC06300.WORKORDNUM in (select distinct SVC06300.WORKORDNUM from SVC06300 inner join  SVC06100 ON (SVC06100.WORECTYPE = SVC06300.WORECTYPE and SVC06100.WORKORDNUM = SVC06300.WORKORDNUM)  where   ((SVC06100.Commit_Date = '01/01/1900 00:00') or  SVC06100.NUMRESCHED = 0))  OPEN G_cursor FETCH NEXT FROM G_cursor INTO @WORECTYPE,@WORKORDNUM, @Priority, @etadate  WHILE (@@FETCH_STATUS = 0)  BEGIN   exec SVC_Schedule_Work_Order @WORECTYPE,@WORKORDNUM,0,1   select @EstimatedCompletion = CONVERT(char(10),a.ECOMPDT,102) + ' ' +   CONVERT(char(5),a.EComp_Time,108)   from SVC06300 a  where a.WORECTYPE = @WORECTYPE and   a.WORKORDNUM = @WORKORDNUM and  a.Route_Sequence = (select max(b.Route_Sequence)   from SVC06300 b  where b.WORECTYPE = @WORECTYPE AND   b.WORKORDNUM = @WORKORDNUM)  select @Commit = CONVERT(char(10),Commit_Date,102) + ' ' +   CONVERT(char(5),Commit_Time,108)   from SVC06100  where  WORECTYPE = @WORECTYPE AND   WORKORDNUM = @WORKORDNUM  if @Commit > '01/01/1900 00:00' and @Commit < @EstimatedCompletion  BEGIN  delete from SVC06300   where Status <> 2 and   WORECTYPE = @WORECTYPE AND   WORKORDNUM = @WORKORDNUM   exec SVC_Schedule_Work_Order @WORECTYPE,@WORKORDNUM,0,1   END  FETCH NEXT FROM G_cursor INTO @WORECTYPE,@WORKORDNUM, @Priority, @etadate  END  DEALLOCATE G_cursor    
GO
GRANT EXECUTE ON  [dbo].[SVC_ReSchedule_All_Work_Orders] TO [DYNGRP]
GO
