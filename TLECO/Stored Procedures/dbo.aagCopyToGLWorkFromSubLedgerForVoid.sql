SET QUOTED_IDENTIFIER OFF
GO
SET ANSI_NULLS ON
GO
 Create        procedure [dbo].[aagCopyToGLWorkFromSubLedgerForVoid]  @I_nSubLedHdrID int, @I_nOrigSeqNum numeric(19,5), @I_nGLWorkHdrID int, @I_nDistID int, @I_nJrnEntry int, @I_dtGLPostingDate datetime, @L_SeqLine numeric(19,5), @O_fSuccess tinyint  output  as   DECLARE @FUNLCURR char(15),  @aaGLWorkDistID int,  @CURRID char(15),  @SEQNUM numeric(19,5)   select @FUNLCURR = FUNLCURR from MC40000  if (select min(SEQNUMBR) from AAG20001 where aaSubLedgerHdrID = @I_nSubLedHdrID)=32768 begin  select @I_nOrigSeqNum = @I_nOrigSeqNum+16384 end SELECT TOP 1 @SEQNUM=A.SEQNUMBR  from GL10001 G left outer join AAG20001 A on A.ACTINDX=G.ACTINDX and A.CRDTAMNT=G.CRDTAMNT and A.DEBITAMT=G.DEBITAMT where A.aaSubLedgerHdrID = @I_nSubLedHdrID and  G.OrigSeqNum =  @I_nOrigSeqNum and G.JRNENTRY=@I_nJrnEntry ORDER BY A.aaSubLedgerDistID DESC if @I_nOrigSeqNum <> 0  begin  INSERT INTO AAG10001(aaGLWorkHdrID,aaGLWorkDistID,  INTERID,CorrespondingUnit,ACTINDX,ACCTTYPE,DECPLACS,FXDORVAR,  DEBITAMT,CRDTAMNT,ORDBTAMT,ORCRDAMT,CURNCYID,CURRNIDX,RATETPID,EXGTBLID,  XCHGRATE,EXCHDATE,TIME1,RTCLCMTD,DENXRATE,MCTRXSTT,SQNCLINE,  aaCustID,aaVendID,aaSiteID,aaItemID,EMPLOYID,  aaCopyStatus,aaWinWasOpen,aaDistErrors,aaBrowseType,aaChangeDate, aaChangeTime)  SELECT @I_nGLWorkHdrID,@I_nDistID,  INTERID,CorrespondingUnit,ACTINDX,ACCTTYPE,DECPLACS,dbo.aagFixedOrVar(ACTINDX),   DEBITAMT,CRDTAMNT,ORDBTAMT,ORCRDAMT,CURNCYID,CURRNIDX,RATETPID,EXGTBLID,  XCHGRATE,EXCHDATE,TIME1,RTCLCMTD,DENXRATE,MCTRXSTT,@L_SeqLine,  aaCustID,aaVendID,aaSiteID,aaItemID,EMPLOYID,  aaCopyStatus,1,0,aaBrowseType,convert(char(12), getdate(), 102),convert(char(12), getdate(), 108)  from AAG20001 where aaSubLedgerHdrID = @I_nSubLedHdrID and  SEQNUMBR =  @SEQNUM   INSERT INTO AAG10002(aaGLWorkHdrID,aaGLWorkDistID,aaGLWorkAssignID,aaAssignedPercent,  DEBITAMT,CRDTAMNT,ORDBTAMT,ORCRDAMT,DistRef,NOTEINDX,aaAliasID)  SELECT @I_nGLWorkHdrID,@I_nDistID,aaSubLedgerAssignID,aaAssignedPercent,  DEBITAMT,CRDTAMNT,ORDBTAMT,ORCRDAMT,DistRef,NOTEINDX,aaAliasID  from AAG20002 where aaSubLedgerHdrID = @I_nSubLedHdrID and  aaSubLedgerDistID in (select aaSubLedgerDistID from AAG20001   where aaSubLedgerHdrID = @I_nSubLedHdrID and  SEQNUMBR =  @SEQNUM)   INSERT INTO AAG10003(aaGLWorkHdrID,aaGLWorkDistID,aaGLWorkAssignID,  aaTrxDimID,aaTrxCodeID,aaCodeErrors)  SELECT @I_nGLWorkHdrID,@I_nDistID,aaSubLedgerAssignID,  aaTrxDimID,aaTrxCodeID,aaCodeErrors  from AAG20003 where aaSubLedgerHdrID = @I_nSubLedHdrID  and  aaSubLedgerDistID in (select aaSubLedgerDistID from AAG20001   where aaSubLedgerHdrID = @I_nSubLedHdrID and  SEQNUMBR =  @SEQNUM) end else begin  INSERT INTO AAG10001(aaGLWorkHdrID,aaGLWorkDistID,  INTERID,CorrespondingUnit,ACTINDX,ACCTTYPE,DECPLACS,FXDORVAR,  DEBITAMT,CRDTAMNT,ORDBTAMT,ORCRDAMT,CURNCYID,CURRNIDX,RATETPID,EXGTBLID,  XCHGRATE,EXCHDATE,TIME1,RTCLCMTD,DENXRATE,MCTRXSTT,SQNCLINE,  aaCustID,aaVendID,aaSiteID,aaItemID,EMPLOYID,  aaCopyStatus,aaWinWasOpen,aaDistErrors,aaBrowseType,aaChangeDate, aaChangeTime)  SELECT @I_nGLWorkHdrID,@I_nDistID,  INTERID,CorrespondingUnit,ACTINDX,ACCTTYPE,DECPLACS,dbo.aagFixedOrVar(ACTINDX),   CRDTAMNT,DEBITAMT,ORCRDAMT,ORDBTAMT,CURNCYID,CURRNIDX,RATETPID,EXGTBLID,  XCHGRATE,EXCHDATE,TIME1,RTCLCMTD,DENXRATE,MCTRXSTT,@L_SeqLine,  aaCustID,aaVendID,aaSiteID,aaItemID,EMPLOYID,  aaCopyStatus,1,0,aaBrowseType,convert(char(12), getdate(), 102),convert(char(12), getdate(), 108)  from AAG20001 where aaSubLedgerHdrID = @I_nSubLedHdrID and  SEQNUMBR =  @L_SeqLine   INSERT INTO AAG10002(aaGLWorkHdrID,aaGLWorkDistID,aaGLWorkAssignID,aaAssignedPercent,  DEBITAMT,CRDTAMNT,ORDBTAMT,ORCRDAMT,DistRef,NOTEINDX,aaAliasID)  SELECT @I_nGLWorkHdrID,@I_nDistID,aaSubLedgerAssignID,aaAssignedPercent,  CRDTAMNT,DEBITAMT,ORCRDAMT,ORDBTAMT,DistRef,NOTEINDX,aaAliasID  from AAG20002 where aaSubLedgerHdrID = @I_nSubLedHdrID and  aaSubLedgerDistID in (select aaSubLedgerDistID from AAG20001   where aaSubLedgerHdrID = @I_nSubLedHdrID and  SEQNUMBR =  @L_SeqLine)   INSERT INTO AAG10003(aaGLWorkHdrID,aaGLWorkDistID,aaGLWorkAssignID,  aaTrxDimID,aaTrxCodeID,aaCodeErrors)  SELECT @I_nGLWorkHdrID,@I_nDistID,aaSubLedgerAssignID,  aaTrxDimID,aaTrxCodeID,aaCodeErrors  from AAG20003 where aaSubLedgerHdrID = @I_nSubLedHdrID  and  aaSubLedgerDistID in (select aaSubLedgerDistID from AAG20001   where aaSubLedgerHdrID = @I_nSubLedHdrID and  SEQNUMBR =  @L_SeqLine) end  SELECT  @aaGLWorkDistID = aaGLWorkDistID,@CURRID = CURNCYID from AAG10001 WHERE aaGLWorkHdrID = @I_nGLWorkHdrID and SQNCLINE =  @L_SeqLine  if  (@FUNLCURR = @CURRID) or len(rtrim(ltrim(@CURRID))) = 0  begin  update AAG10001 set ORCRDAMT = CRDTAMNT , ORDBTAMT = DEBITAMT where  aaGLWorkHdrID = @I_nGLWorkHdrID and aaGLWorkDistID = @aaGLWorkDistID  update AAG10002 set ORCRDAMT = CRDTAMNT , ORDBTAMT = DEBITAMT where  aaGLWorkHdrID = @I_nGLWorkHdrID and aaGLWorkDistID = @aaGLWorkDistID  and aaGLWorkAssignID > 0  end     
GO
GRANT EXECUTE ON  [dbo].[aagCopyToGLWorkFromSubLedgerForVoid] TO [DYNGRP]
GO
