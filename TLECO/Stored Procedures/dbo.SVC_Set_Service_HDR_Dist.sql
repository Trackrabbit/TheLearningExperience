SET QUOTED_IDENTIFIER OFF
GO
SET ANSI_NULLS ON
GO
 CREATE PROCEDURE [dbo].[SVC_Set_Service_HDR_Dist]  @CallNumber char(11),  @RecordType smallint,  @DistType smallint,  @oldAccountIndex integer,  @AccountIndex integer,  @CurrencyIndex smallint AS declare  @NextLine integer declare  @CAmount numeric(19,2) declare  @OrigCAmount numeric (19,2) declare  @DAmount numeric(19,2) declare  @OrigDAmount numeric (19,2) declare  @MinDate datetime  exec smGetMinDate @MinDate output  if @oldAccountIndex > 0   BEGIN  delete from SVC00230 where SRVRECTYPE = @RecordType and CALLNBR = @CallNumber  and SVC_Distribution_Type=@DistType and POSTED = 0 and ACTINDX = @oldAccountIndex   if (select count(*) from SVC00231  where SRVRECTYPE = @RecordType and CALLNBR = @CallNumber   and ACTINDX = @oldAccountIndex and SVC_Distribution_Type = @DistType and POSTED = 0) > 0  BEGIN  select @CAmount = sum(CRDTAMNT), @OrigCAmount = sum(ORCRDAMT), @DAmount = sum(DEBITAMT), @OrigDAmount = sum(ORDBTAMT) from SVC00231  where SRVRECTYPE = @RecordType and CALLNBR = @CallNumber and ACTINDX = @oldAccountIndex  and SVC_Distribution_Type = @DistType and POSTED = 0  exec SVC_Dist_Get_SEQ_Service  @CallNumber,  @RecordType,  0,  0,  '',  @DistType,  @NextLine output   insert SVC00230  select   @RecordType,  @CallNumber,  @NextLine,  @DistType,   '',  @oldAccountIndex,  @DAmount,   @OrigDAmount,  @CAmount,   @OrigCAmount,  isnull(@CurrencyIndex,0),  '',  0,  @MinDate  END  END  if @AccountIndex > 0  BEGIN  delete from SVC00230 where SRVRECTYPE = @RecordType and CALLNBR = @CallNumber  and SVC_Distribution_Type=@DistType and POSTED = 0 and ACTINDX = @AccountIndex   if exists (select * from SVC00231 where SRVRECTYPE = @RecordType and CALLNBR = @CallNumber  and ACTINDX = @AccountIndex and SVC_Distribution_Type = @DistType and POSTED = 0)  BEGIN  select @CAmount = sum(CRDTAMNT), @OrigCAmount = sum(ORCRDAMT), @DAmount = sum(DEBITAMT), @OrigDAmount = sum(ORDBTAMT) from SVC00231  where SRVRECTYPE = @RecordType and CALLNBR = @CallNumber and ACTINDX = @AccountIndex  and SVC_Distribution_Type = @DistType and POSTED = 0  exec SVC_Dist_Get_SEQ_Service  @CallNumber,  @RecordType,  0,  0,  '',  @DistType,  @NextLine output   insert SVC00230  select   @RecordType,  @CallNumber,  @NextLine,  @DistType,   '',  @AccountIndex,  @DAmount,   @OrigDAmount,  @CAmount,   @OrigCAmount,  isnull(@CurrencyIndex,0),  '',  0,  @MinDate  END END  return(0)    
GO
GRANT EXECUTE ON  [dbo].[SVC_Set_Service_HDR_Dist] TO [DYNGRP]
GO
