SET QUOTED_IDENTIFIER OFF
GO
SET ANSI_NULLS ON
GO
 CREATE PROCEDURE [dbo].[seeGLAPDaysOutstandingDetail] @UserDate DATETIME = NULL,   @Label    VARCHAR(30),   @CurPrev  VARCHAR(30),  @Date DATETIME = NULL AS  IF (@Label IS NULL OR @Label = '') BEGIN  SET @Label = (SELECT rtrim(PERNAME) AS PERNAME   FROM (SELECT DISTINCT(PERNAME), PERIODID   FROM SY40100   WHERE PERNAME <> 'Beginning Balance'   and @Date between PERIODDT and PERDENDT) SY40100)  END  IF (@UserDate IS NULL or @UserDate = '') BEGIN  SET @UserDate = @Date END   CREATE TABLE #Payables   (   AcctCat      INT,   DEBIT        NUMERIC(19, 5),   CREDIT       NUMERIC(19, 5),   ACTINDX      INT,   JRNENTRY     VARCHAR(30),   TRXDATE      DATETIME,   OrderingDate DATETIME,   Label        VARCHAR(30)   )    CREATE TABLE #COGS   (   AcctCat      INT,   DEBIT        NUMERIC(19, 5),   CREDIT       NUMERIC(19, 5),   ACTINDX      INT,   JRNENTRY     VARCHAR(30),   TRXDATE      DATETIME,   OrderingDate DATETIME,   Label        VARCHAR(30)   )    INSERT INTO #Payables   SELECT AcctCat,   DEBIT,   CREDIT,   ACTINDX,   JRNENTRY,   TRXDATE,   OrderingDate,   Label   FROM   (SELECT *   FROM   seeGetGLAcctCatDetail(@UserDate, 'YTD', 13, @Label, @CurPrev)   WHERE  Label = @Label) s1    INSERT INTO #COGS   SELECT AcctCat,   DEBIT,   CREDIT,   ACTINDX,   JRNENTRY,   TRXDATE,   OrderingDate,   Label   FROM   (SELECT *   FROM   seeGetGLAcctCatDetail(@UserDate, 'NetChange', 33, @Label, @CurPrev)   WHERE  Label = @Label) s2    SELECT rtrim(GL00102.ACCATDSC) AS ACCATDSC,   DEBIT,   CREDIT,   #COGS.ACTINDX,   rtrim(ACTNUMST)         AS ACTNUMST,   JRNENTRY,   TRXDATE,  case  when JRNENTRY = 'BBF'  then ''  else [Journal Entry For Drillback]  end as [Journal Entry For Drillback],   [Account Index For Drillback]  FROM   #COGS   JOIN GL00105   ON #COGS.ACTINDX = GL00105.ACTINDX   JOIN GL00100   ON #COGS.ACTINDX = GL00100.ACTINDX   JOIN GL00102   ON GL00100.ACCATNUM = GL00102.ACCATNUM   LEFT OUTER JOIN (SELECT DISTINCT [Journal Entry],  [Journal Entry For Drillback]  FROM [AccountTransactions]) AccountTransactions   ON AccountTransactions.[Journal Entry] =   case   when #COGS.JRNENTRY = 'BBF'   then 0   else #COGS.JRNENTRY  end  JOIN (SELECT DISTINCT [Account Index], [Account Index For Drillback]  FROM [AccountTransactions]) AccountDrillback   ON #COGS.ACTINDX = AccountDrillback.[Account Index]   UNION ALL   SELECT rtrim(GL00102.ACCATDSC) AS ACCATDSC,   DEBIT,   CREDIT,   #Payables.ACTINDX,   rtrim(ACTNUMST)         AS ACTNUMST,   JRNENTRY,   TRXDATE,  case  when JRNENTRY = 'BBF'  then ''  else [Journal Entry For Drillback]  end as [Journal Entry For Drillback],   [Account Index For Drillback]   FROM   #Payables   JOIN GL00105   ON #Payables.ACTINDX = GL00105.ACTINDX   JOIN GL00100   ON #Payables.ACTINDX = GL00100.ACTINDX   JOIN GL00102   ON GL00100.ACCATNUM = GL00102.ACCATNUM  LEFT OUTER JOIN (SELECT DISTINCT [Journal Entry],  [Journal Entry For Drillback]  FROM [AccountTransactions]) AccountTransactions   ON AccountTransactions.[Journal Entry] =   case   when #Payables.JRNENTRY = 'BBF'   then 0   else #Payables.JRNENTRY  end  JOIN (SELECT DISTINCT [Account Index], [Account Index For Drillback]  FROM [AccountTransactions]) AccountDrillback   ON #Payables.ACTINDX = AccountDrillback.[Account Index]   ORDER  BY ACCATDSC,   ACTNUMST,   TRXDATE,   JRNENTRY    
GO
GRANT EXECUTE ON  [dbo].[seeGLAPDaysOutstandingDetail] TO [DYNGRP]
GO
GRANT EXECUTE ON  [dbo].[seeGLAPDaysOutstandingDetail] TO [rpt_accounting manager]
GO
GRANT EXECUTE ON  [dbo].[seeGLAPDaysOutstandingDetail] TO [rpt_accounts payable coordinator]
GO
GRANT EXECUTE ON  [dbo].[seeGLAPDaysOutstandingDetail] TO [rpt_bookkeeper]
GO
GRANT EXECUTE ON  [dbo].[seeGLAPDaysOutstandingDetail] TO [rpt_certified accountant]
GO
GRANT EXECUTE ON  [dbo].[seeGLAPDaysOutstandingDetail] TO [rpt_executive]
GO
