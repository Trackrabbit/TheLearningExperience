SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO
 CREATE procedure [dbo].[SVC_Get_Service_Totals]  (  @srvrectype int = NULL,   @callnbr    varchar(11) = NULL,  @TableName varchar(255) )  as declare @linetotals numeric(19,2) declare @partsprice numeric(19,2) declare @partscost numeric(19,2) declare @partstax numeric(19,2) declare @laborprice numeric(19,2) declare @laborcost numeric(19,2) declare @labortax numeric(19,2) declare @miscprice numeric(19,2) declare @misccost numeric(19,2) declare @misctax numeric(19,2)  declare @origlinetotals numeric(19,2)  declare @origpartsprice numeric(19,2) declare @origpartscost numeric(19,2) declare @origpartstax numeric(19,2) declare @origlaborprice numeric(19,2) declare @origlaborcost numeric(19,2) declare @origlabortax numeric(19,2) declare @origmiscprice numeric(19,2) declare @origmisccost numeric(19,2) declare @origmisctax numeric(19,2) declare @expenseprice numeric(19,2),  @expensecost numeric(19,2),  @expensetax numeric(19,2),  @origexpenseprice numeric(19,2),  @origexpensecost numeric(19,2),  @origexpensetax numeric(19,2) declare @SQL varchar(5000),  @Quote char(1)  select @Quote = char(39) if @srvrectype is NULL or @callnbr is NULL begin return 500 end  if exists(select * from sysobjects where name = @TableName)  exec ('delete from @TableName') select  @partsprice = SUM(XTNDPRCE),   @partscost = SUM(EXTDCOST),  @partstax = SUM(TAXAMNT),  @origpartstax = SUM(ORTAXAMT),  @origpartsprice = SUM(OXTNDPRC),   @origpartscost = SUM(OREXTCST)   from SVC00203   where SRVRECTYPE  = @srvrectype and  CALLNBR     = @callnbr and  LINITMTYP = 'P' and CMPNTSEQ = 0 select @laborprice = SUM(XTNDPRCE),   @laborcost = SUM(EXTDCOST),  @labortax = SUM(TAXAMNT),  @origlabortax = SUM(ORTAXAMT),   @origlaborprice = SUM(OXTNDPRC),   @origlaborcost = SUM(OREXTCST)   from SVC00203   where SRVRECTYPE  = @srvrectype and  CALLNBR     = @callnbr and  LINITMTYP = 'L' and CMPNTSEQ = 0 select @miscprice = SUM(XTNDPRCE),   @misccost = SUM(EXTDCOST),  @misctax = SUM(TAXAMNT),  @origmisctax = SUM(ORTAXAMT),   @origmiscprice = SUM(OXTNDPRC),   @origmisccost = SUM(OREXTCST)   from SVC00203   where SRVRECTYPE  = @srvrectype and  CALLNBR     = @callnbr and  (LINITMTYP = 'A') and CMPNTSEQ = 0 select @expenseprice = SUM(XTNDPRCE),   @expensecost = SUM(EXTDCOST),  @expensetax = SUM(TAXAMNT),  @origexpensetax = SUM(ORTAXAMT),  @origexpenseprice = SUM(OXTNDPRC),   @origexpensecost = SUM(OREXTCST)   from SVC00203   where SRVRECTYPE  = @srvrectype and  CALLNBR     = @callnbr and  (LINITMTYP = 'E' ) and CMPNTSEQ = 0  select @partsprice = IsNull(@partsprice,0) select @partscost = IsNull(@partscost,0) select @partstax = IsNull(@partstax,0) select @laborprice = IsNull(@laborprice,0) select @laborcost = IsNull(@laborcost,0) select @labortax = IsNull(@labortax,0) select @miscprice = IsNull(@miscprice,0) select @misccost = IsNull(@misccost,0) select @misctax = IsNull(@misctax,0) select @expenseprice = IsNull(@expenseprice,0) select @expensecost = IsNull(@expensecost,0) select @expensetax = IsNull(@expensetax,0)  select @origlinetotals = IsNull(@origlinetotals,0) select @origpartsprice = IsNull(@origpartsprice,0) select @origpartscost = IsNull(@origpartscost,0) select @origpartstax = IsNull(@origpartstax,0) select @origlaborprice = IsNull(@origlaborprice,0) select @origlaborcost = IsNull(@origlaborcost,0) select @origlabortax = IsNull(@origlabortax,0) select @origmiscprice = IsNull(@origmiscprice,0) select @origmisccost = IsNull(@origmisccost,0) select @origmisctax = IsNull(@origmisctax,0) select @origexpenseprice = IsNull(@origexpenseprice,0) select @origexpensecost = IsNull(@origexpensecost,0) select @origexpensetax = IsNull(@origexpensetax,0) if @@error <> 0 begin return @@error end select @SQL = 'insert into ' + @TableName select @SQL = @SQL + ' (SRVRECTYPE,CALLNBR,PARSTOTCST,ORIGPARSTOTCST, PARSTOTPRC,ORIGPARSTOTPRC,Part_Sub_Total_Tax,' select @SQL = @SQL + ' Orig_PartSubTotalTax,LABSTOTCST,ORIGLABSUBTOTCOST,LABSTOTPRC,ORIGLABSTOTPRC,Labor_Sub_Total_Tax,' select @SQL = @SQL + ' OrigLaborSubTotalTax,MISSTOTCST,ORIGMISSTOTCST,MSCSTOTPRC,ORIGMSCSTOTPRC,Misc_Sub_Total_Tax,' select @SQL = @SQL + ' OrigMiscSubTotalTax,Expense_Sub_Total_Cost,Orig_ExpensesSubCost,Expenses_SubTotal_Price,' select @SQL = @SQL + ' OrigExpensesSubPrice,Expenses_SubTotal_Tax,Originating_Expenses_Sub)' select @SQL = @SQL + ' values (' + CONVERT(varchar(2),@srvrectype) + ',' + @Quote + @callnbr + @Quote + ',' + CONVERT(varchar(20),@partscost) select @SQL = @SQL + ',' + CONVERT(varchar(20),@origpartscost)+ ',' + CONVERT(varchar(20),@partsprice)  select @SQL = @SQL + ',' + CONVERT(varchar(20),@origpartsprice)+ ',' + CONVERT(varchar(20),@partstax) select @SQL = @SQL + ',' + CONVERT(varchar(20),@origpartstax)+ ',' + CONVERT(varchar(20),@laborcost) select @SQL = @SQL + ',' + CONVERT(varchar(20),@origlaborcost)+ ',' + CONVERT(varchar(20),@laborprice) select @SQL = @SQL + ',' + CONVERT(varchar(20),@origlaborprice)+ ',' + CONVERT(varchar(20),@labortax)  select @SQL = @SQL + ',' + CONVERT(varchar(20),@origlabortax)+ ',' + CONVERT(varchar(20),@misccost) select @SQL = @SQL + ',' + CONVERT(varchar(20),@origmisccost)+ ',' + CONVERT(varchar(20),@miscprice) select @SQL = @SQL + ',' + CONVERT(varchar(20),@origmiscprice)+ ',' + CONVERT(varchar(20),@misctax) select @SQL = @SQL + ',' + CONVERT(varchar(20),@origmisctax)+ ',' + CONVERT(varchar(20),@expensecost) select @SQL = @SQL + ',' + CONVERT(varchar(20),@origexpensecost)+ ',' + CONVERT(varchar(20),@expenseprice) select @SQL = @SQL + ',' + CONVERT(varchar(20),@origexpenseprice) + ',' + CONVERT(varchar(20),@expensetax)  select @SQL = @SQL + ',' + CONVERT(varchar(20),@origexpensetax) + ')'  exec (@SQL) return    
GO
GRANT EXECUTE ON  [dbo].[SVC_Get_Service_Totals] TO [DYNGRP]
GO
