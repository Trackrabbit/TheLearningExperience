SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO
 create procedure [dbo].[aagPopulateBudgetReport] ( @IN_TableName char(100) ='', @IN_BudgetID bigint, @IN_aaCodeSequence bigint, @IN_IsQtySelected  int, @IN_BudgetTreeID   bigint ) as begin declare @TableName varchar(200) declare @CName char(15) declare @sSQL  varchar(8000) declare @sCols varchar(1000) declare @iCols varchar(8000) declare @Level int  set @Level=0 set @iCols='' set @sSQL='' exec('declare aaLvl cursor fast_forward for  select aaLevel from ' + @IN_TableName + ' order by DEX_ROW_ID desc') open aaLvl fetch next from  aaLvl into @Level close aaLvl deallocate aaLvl set @iCols = 'aaBudgetTreeID,aaCodeSequence,aaTrxDimID,aaLevel,aaTrxDimCodeFr,aaTrxDimCodeTo, aaTrxDimDescr,AMNTDUE,QTYSLCTD,' set @sCols = 'select 0 as aaBudgetTreeID, 0 as aaCodeSequence,0 as aaTrxDimID,0 as aaLevel, 0 as aaTrxDimCodeFr,0 as aaTrxDimCodeTo,'''' as aaTrxDimDescr,0 as AMNTDUE,0 as QTYSLCTD,' declare c cursor fast_forward for  select COLUMN_NAME from INFORMATION_SCHEMA.COLUMNS where TABLE_NAME='GL00100' and COLUMN_NAME like 'ACTNUMBR%' open c fetch next from c into @CName while @@fetch_status=0  begin  set @sSQL = @sSQL + ltrim(rtrim(@CName))  fetch next from c into @CName  if @@fetch_status=0  set @sSQL = @sSQL + ','  end close c deallocate c set @iCols= @iCols + @sSQL +  ',ACTINDX,ACTDESCR,ACCTTYPE' set @sSQL= @sCols + @sSQL +  ',ACTINDX,ACTDESCR,ACCTTYPE from GL00100 where ACTINDX in(' exec('insert into ' + @IN_TableName + '(' + @iCols + ')' + '('+@sSQL + 'SELECT ACTINDX FROM AAG00905 WHERE aaBudgetID=''' + @IN_BudgetID + ''' and aaCodeSequence= ''' + @IN_aaCodeSequence + '''))') exec('update ' + @IN_TableName + ' set aaBudgetTreeID =''' + @IN_BudgetTreeID + ''',QTYSLCTD = ''' + @IN_IsQtySelected + ''',aaLevel=''' + @Level + ''' where aaBudgetTreeID=0') end    
GO
GRANT EXECUTE ON  [dbo].[aagPopulateBudgetReport] TO [DYNGRP]
GO
