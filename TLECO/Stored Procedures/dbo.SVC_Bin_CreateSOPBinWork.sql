SET QUOTED_IDENTIFIER OFF
GO
SET ANSI_NULLS ON
GO
 Create Procedure [dbo].[SVC_Bin_CreateSOPBinWork]  (@DocType smallint,  @RecType smallint,  @DocNumber char(20),  @Line numeric(19,5),  @SOPType smallint,  @SOPNumber char(21),  @SOPCompSeq int,  @SOPLine int,  @CMPNTSEQ int = 0   ) As declare @Sequence int declare @Item char(31) declare @Location char(11) declare @Bin char(15) declare @Qty numeric(19,5)  if @DocType = 1   declare Bin_record cursor for select SEQNUMBR from SVC00212 where  SRVRECTYPE = @RecType and CALLNBR = @DocNumber and EQPLINE = 1 and LINITMTYP = 'P'  and LNITMSEQ = @Line and CMPNTSEQ = @CMPNTSEQ else if @DocType = 3  declare Bin_record cursor for select SEQNUMBR from SVC05212 where   Return_Record_Type = @RecType and RETDOCID = @DocNumber and LNSEQNBR = @Line and CMPNTSEQ = @CMPNTSEQ else if @DocType = 4  declare Bin_record cursor for select SEQNUMBR from SVC05612  where RTV_Number = @DocNumber else if @DocType = 5  declare Bin_record cursor for select SEQNUMBR from SVC06112 where   WORECTYPE = @RecType and WORKORDNUM = @DocNumber and LINITMTYP = 'P' and LNITMSEQ = @Line and CMPNTSEQ = @CMPNTSEQ  open Bin_record   fetch next from Bin_record into @Sequence  while @@FETCH_STATUS = 0  begin  if @DocType = 1   insert into SOP10203 select @SOPNumber, @SOPType, @SOPLine, @SOPCompSeq, @Sequence,  ITEMNMBR, LOCNCODE, BIN, QTYTYPE, QUANTITY, 0 from SVC00212 where SEQNUMBR = @Sequence and CMPNTSEQ = @CMPNTSEQ and  SRVRECTYPE = @RecType and CALLNBR = @DocNumber and EQPLINE = 1 and LINITMTYP = 'P' and LNITMSEQ = @Line  else if @DocType = 3   begin  if @SOPType = 4   insert into SOP10203 select @SOPNumber, @SOPType, @SOPLine, @SOPCompSeq, @Sequence,  ITEMNMBR, LOCNCODE, BIN, QTYTYPE, QUANTITY, 0 from SVC05212 where SEQNUMBR = @Sequence and  Return_Record_Type = @RecType and RETDOCID = @DocNumber and LNSEQNBR = @Line and CMPNTSEQ = @CMPNTSEQ  end  else if @DocType = 4   insert into SOP10203 select @SOPNumber, @SOPType, @SOPLine, @SOPCompSeq, @Sequence,  ITEMNMBR, LOCNCODE, BIN, QTYTYPE, QUANTITY, 0 from SVC05612 where SEQNUMBR = @Sequence and  RTV_Number = @DocNumber  else if @DocType = 5   insert into SOP10203 select @SOPNumber, @SOPType, @SOPLine, @SOPCompSeq, @Sequence,  ITEMNMBR, LOCNCODE, BIN, QTYTYPE, QUANTITY, 0 from SVC06112 where SEQNUMBR = @Sequence and  WORECTYPE = @RecType and WORKORDNUM = @DocNumber and LINITMTYP = 'P' and LNITMSEQ = @Line  and CMPNTSEQ = @CMPNTSEQ  fetch next from Bin_record into @Sequence  end deallocate Bin_record if @DocType = 3 and @SOPType = 2 begin  select @Item = Replace_Item_Number, @Location = Location_Code_Replacemen, @Qty = Replace_QTY   from SVC05200 where Return_Record_Type = @RecType and RETDOCID = @DocNumber and LNSEQNBR = @Line   and svcRMAComponentSeq = @CMPNTSEQ  if @Location = '' or @Location is null  select @Location = LOCNCODE from SOP40100  exec SVC_Bin_GetDefault @Item, @Location, 'I', @Bin Output  select @Sequence = 16384  insert into SOP10203 select @SOPNumber, @SOPType, @SOPLine, @SOPCompSeq, @Sequence,  @Item, @Location, isnull(@Bin,''), 1, @Qty, 0  end  return (0)    
GO
GRANT EXECUTE ON  [dbo].[SVC_Bin_CreateSOPBinWork] TO [DYNGRP]
GO
