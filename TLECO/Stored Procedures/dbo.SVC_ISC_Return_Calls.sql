SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO
 CREATE procedure [dbo].[SVC_ISC_Return_Calls]   (@custnmbr varchar(15) = NULL,  @srvrectype smallint)  as if @srvrectype = 2 begin SELECT   SVC00200.SRVRECTYPE,   SVC00200.CALLNBR,   SVC00913.STSDESCR,   SVC00920.DSCRIPTN 'CALLTYPE',  SVC00200.ADRSCODE,   SVC00200.ADDRESS1,   SVC00200.ADDRESS2,   SVC00200.CITY,   SVC00200.STATE,  SVC00200.ZIP,  RTRIM(SVC00200.CITY) + ', ' + RTRIM(SVC00200.STATE) + '   ' + RTRIM(SVC00200.ZIP) 'FULLCITY',  SVC00200.SRVSTAT,   SVC00200.SRVTYPE,   SVC00200.PHONE1,   SVC00200.CNTCPRSN,  CONVERT(char(10),SVC00200.ENTDTE,101) + ' ' + CONVERT(char(5),SVC00200.ENTTME,108) 'ENTERED',  SVC00200.PORDNMBR,   SVC00201.ITEMNMBR,   IV00101.ITEMDESC,   SVC00300.SERLNMBR,   SVC00201.PROBCDE,   SVC00200.SVCDESCR,   SVC00200.CUSTNMBR,   SVC00200.CNTCPRSN,   SVC00907.DSCRIPTN,  CASE  WHEN @srvrectype = 2 THEN  CONVERT(char(10),SVC00200.ETADTE,101) + ' ' + CONVERT(char(5),SVC00200.ETATME,108)  ELSE  CONVERT(char(10),SVC00200.ETADTE,101) + ' ' + CONVERT(char(5),SVC00200.ETATME,108)  END 'ETA',  SVC00200.PRETAXTOT,   SY03900.TXTFIELD,  CONVERT(char(10),SVC00200.COMPDTE,101) + ' ' + CONVERT(char(5), SVC00200.COMPTME,108) COMPLETED,  SVC00200.ADDRESS3 FROM SVC00200 INNER JOIN   SVC00913 ON (SVC00200.SRVSTAT = SVC00913.SRVSTAT) LEFT OUTER JOIN   SVC00920 ON (SVC00200.SRVTYPE = SVC00920.SRVTYPE) LEFT OUTER JOIN   SVC00201 ON (SVC00200.SRVRECTYPE = SVC00201.SRVRECTYPE and SVC00200.CALLNBR = SVC00201.CALLNBR) LEFT OUTER JOIN  SVC00300 ON (SVC00201.EQUIPID = SVC00300.EQUIPID) LEFT OUTER JOIN   SY03900 ON (SVC00200.NOTEINDX = SY03900.NOTEINDX) LEFT OUTER JOIN  SVC00907 ON (SVC00201.PROBCDE = SVC00907.PROBCDE) LEFT OUTER JOIN  IV00101 ON (SVC00201.ITEMNMBR = IV00101.ITEMNMBR) where SVC00200.SRVRECTYPE = @srvrectype and  SVC00200.CUSTNMBR = @custnmbr  order by SVC00200.CALLNBR end  if @srvrectype = 3  SELECT   SVC00200.SRVRECTYPE,   SVC00200.CALLNBR,   SVC00913.STSDESCR,   SVC00920.DSCRIPTN 'CALLTYPE',  SVC00200.ADRSCODE,   SVC00200.ADDRESS1,   SVC00200.ADDRESS2,   SVC00200.CITY,   SVC00200.STATE,  SVC00200.ZIP,  RTRIM(SVC00200.CITY) + ', ' + RTRIM(SVC00200.STATE) + '   ' + RTRIM(SVC00200.ZIP) 'FULLCITY',  SVC00200.SRVSTAT,   SVC00200.SRVTYPE,   SVC00200.PHONE1,   SVC00200.CNTCPRSN,  CONVERT(char(10),SVC00200.ENTDTE,101) + ' ' + CONVERT(char(5),SVC00200.ENTTME,108) 'ENTERED',  SVC00200.PORDNMBR,   SVC00201.ITEMNMBR,   IV00101.ITEMDESC,   SVC00300.SERLNMBR,   SVC00201.PROBCDE,   SVC00200.SVCDESCR,   SVC00200.CUSTNMBR,   SVC00200.CNTCPRSN,   SVC00907.DSCRIPTN,  CASE  WHEN @srvrectype = 2 THEN  CONVERT(char(10),SVC00200.ETADTE,101) + ' ' + CONVERT(char(5),SVC00200.ETATME,108)  ELSE  CONVERT(char(10),SVC00200.ETADTE,101) + ' ' + CONVERT(char(5),SVC00200.ETATME,108)  END 'ETA',  SVC00200.PRETAXTOT,   SY03900.TXTFIELD,  CONVERT(char(10),SVC00200.COMPDTE,101) + ' ' + CONVERT(char(5), SVC00200.COMPTME,108) COMPLETED,  SVC00200.ADDRESS3 FROM SVC00200 INNER JOIN   SVC00913 ON (SVC00200.SRVSTAT = SVC00913.SRVSTAT) LEFT OUTER JOIN   SVC00920 ON (SVC00200.SRVTYPE = SVC00920.SRVTYPE) LEFT OUTER JOIN   SVC00201 ON (SVC00200.SRVRECTYPE = SVC00201.SRVRECTYPE and SVC00200.CALLNBR = SVC00201.CALLNBR) LEFT OUTER JOIN  SVC00300 ON (SVC00201.EQUIPID = SVC00300.EQUIPID) LEFT OUTER JOIN   SY03900 ON (SVC00200.NOTEINDX = SY03900.NOTEINDX) LEFT OUTER JOIN  SVC00907 ON (SVC00201.PROBCDE = SVC00907.PROBCDE) LEFT OUTER JOIN  IV00101 ON (SVC00201.ITEMNMBR = IV00101.ITEMNMBR) where SVC00200.SRVRECTYPE = @srvrectype and  SVC00200.CUSTNMBR = @custnmbr   union all  select  SVC30200.SRVRECTYPE,   SVC30200.CALLNBR,   SVC00913.STSDESCR,   SVC00920.DSCRIPTN 'CALLTYPE',  SVC30200.ADRSCODE,   SVC30200.ADDRESS1,   SVC30200.ADDRESS2,   SVC30200.CITY,   SVC30200.STATE,  SVC30200.ZIP,  RTRIM(SVC30200.CITY) + ', ' + RTRIM(SVC30200.STATE) + '   ' + RTRIM(SVC30200.ZIP) 'FULLCITY',  SVC30200.SRVSTAT,   SVC30200.SRVTYPE,   SVC30200.PHONE1,   SVC30200.CNTCPRSN,  CONVERT(char(10),SVC30200.ENTDTE,101) + ' ' + CONVERT(char(5),SVC30200.ENTTME,108) 'ENTERED',  SVC30200.PORDNMBR,   SVC30201.ITEMNMBR,   IV00101.ITEMDESC,   SVC00300.SERLNMBR,   SVC30201.PROBCDE,   SVC30200.SVCDESCR,   SVC30200.CUSTNMBR,   SVC30200.CNTCPRSN,   SVC00907.DSCRIPTN,  CASE  WHEN @srvrectype = 3 THEN   CONVERT(char(10),SVC30200.ARRIVDTE,101) + ' ' + CONVERT(char(5), SVC30200.ARRIVTME,108)  ELSE  CONVERT(char(10),SVC30200.ETADTE,101) + ' ' + CONVERT(char(5),SVC30200.ETATME,108)  END 'ETA',  SVC30200.PRETAXTOT,   SY03900.TXTFIELD,  CONVERT(char(10),SVC30200.COMPDTE,101) + ' ' + CONVERT(char(5), SVC30200.COMPTME,108) COMPLETED,  SVC30200.ADDRESS3 FROM SVC30200 INNER JOIN   SVC00913 ON (SVC30200.SRVSTAT = SVC00913.SRVSTAT) LEFT OUTER JOIN   SVC00920 ON (SVC30200.SRVTYPE = SVC00920.SRVTYPE) LEFT OUTER JOIN   SVC30201 ON (SVC30200.SRVRECTYPE = SVC30201.SRVRECTYPE and SVC30200.CALLNBR = SVC30201.CALLNBR) LEFT OUTER JOIN  SVC00300 ON (SVC30201.EQUIPID = SVC00300.EQUIPID) LEFT OUTER JOIN   SY03900 ON (SVC30200.NOTEINDX = SY03900.NOTEINDX) LEFT OUTER JOIN  SVC00907 ON (SVC30201.PROBCDE = SVC00907.PROBCDE) LEFT OUTER JOIN  IV00101 ON (SVC30201.ITEMNMBR = IV00101.ITEMNMBR) where SVC30200.SRVRECTYPE = @srvrectype and  SVC30200.CUSTNMBR = @custnmbr  order by SVC00200.CALLNBR  return    
GO
GRANT EXECUTE ON  [dbo].[SVC_ISC_Return_Calls] TO [DYNGRP]
GO
