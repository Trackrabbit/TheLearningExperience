SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO
CREATE PROC [dbo].[aagFA_Create_PostTransferDist]  @TransferEvent INT, @LastFinancialIndex INT, @CompanyID SMALLINT, @InterID VARCHAR(20) AS  BEGIN   DECLARE @FromAssetIndex INT,  @ToAssetIndex INT,  @LatestFinancialIndex INT,  @PartialXfr BIT   SET @PartialXfr=1  SET @FromAssetIndex=0  SELECT @FromAssetIndex=FROMASSETINDX FROM FA00800 WHERE FROMASSETINDX=TOASSETINDX AND TRANSFEREVENT=@TransferEvent   IF @FromAssetIndex !=0   BEGIN  SET @PartialXfr=0  SELECT @ToAssetIndex=aaAssetIndex FROM AAG04000 WHERE aaAssetIndex NOT IN (SELECT TOASSETINDX FROM FA00800 WHERE TRANSFEREVENT=@TransferEvent)  UPDATE AAG04000 SET aaBookIndex =0 WHERE aaAssetIndex IN (SELECT TOASSETINDX FROM FA00800 WHERE TRANSFEREVENT=@TransferEvent and aaAssetIndex<>@FromAssetIndex)  SELECT * into ##aaFATempSetup FROM AAG04000 WHERE aaAssetIndex=@ToAssetIndex and aaBookIndex>0  DELETE  FROM AAG04000 WHERE aaAssetIndex=@ToAssetIndex and aaBookIndex>0  DELETE FROM AAG04001 WHERE aaFASetupID in (SELECT aaFASetupID FROM AAG04000 WHERE aaAssetIndex=(-1)*@FromAssetIndex and aaBookIndex=0)  DELETE FROM AAG04000 WHERE aaAssetIndex=(-1)*@FromAssetIndex and aaBookIndex=0  UPDATE AAG04000 SET aaAssetIndex=(-1)*@FromAssetIndex WHERE  aaAssetIndex =@FromAssetIndex and aaBookIndex=0  INSERT INTO AAG04000(aaFASetupID,ListID,INTERID,USERID,SERIES,ACTINDX,ACCTTYPE,aaBrowseType,aaAssetIndex,aaBookIndex,aaAliasID)  SELECT aaFASetupID,ListID,INTERID,USERID,SERIES,ACTINDX,ACCTTYPE,aaBrowseType,@FromAssetIndex,0,aaAliasID FROM ##aaFATempSetup  DELETE FROM AAG04001 WHERE aaFASetupID IN (SELECT aaFASetupID FROM AAG04000 WHERE aaAssetIndex=@FromAssetIndex and aaBookIndex>0)  DELETE FROM AAG04000 WHERE aaAssetIndex=@FromAssetIndex and aaBookIndex>0   DROP TABLE ##aaFATempSetup  END  EXEC aagFA_Create_PostTransferDist2 @LastFinancialIndex,206,@CompanyID,@InterID,@LatestFinancialIndex OUT,@PartialXfr END   
GO
GRANT EXECUTE ON  [dbo].[aagFA_Create_PostTransferDist] TO [DYNGRP]
GO
