SET QUOTED_IDENTIFIER OFF
GO
SET ANSI_NULLS ON
GO
 CREATE PROCEDURE [dbo].[sp_AATransactions] @iLanguageID int  as  set nocount on   declare @sqldropstring varchar(400),  @sqldefaultstring varchar(8000),  @sqlstring1 varchar(8000),  @sqlstring2 varchar(8000),  @sqlstring3 varchar(8000),  @sqlstring4 varchar(8000),  @sqlstring5 varchar(8000),  @sqlstring6 varchar(8000),  @sqlstring7 varchar(8000),  @sqlstring8 varchar(8000),  @sqlstring9 varchar(8000),  @sqlstring10 varchar(8000),  @sqljoinstring varchar(8000),  @sqlaccessstring varchar(400),  @tNumberSegments int,  @tSegment int,  @I_iDictID int,  @I_iLangID int,  @I_iMessageNumber int,  @I_iAliasMessageNumber int,  @I_iIntegerValue int,  @Debit_Amount varchar(255), @Journal_Entry varchar(255), @AA_Transaction_Source varchar(255), @Credit_Amount varchar(255), @Account_Index varchar(255), @Account_Description varchar(255), @Transaction_Dimension_Code varchar(255), @Description_1 varchar(255), @Change_Date varchar(255), @Change_Time varchar(255), @Account_Number varchar(255), @Assignment_Percentage varchar(255), @Distribution_Reference varchar(255), @Originating_Credit_Amount varchar(255), @Originating_Debit_Amount varchar(255), @Transaction_Source varchar(255), @Year varchar(255) select @I_iDictID = 1493 select @I_iMessageNumber = 24513 select @I_iAliasMessageNumber = 0 exec DYNAMICS..smGetBIMsgString  @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @Debit_Amount output  select @I_iDictID = 1493 select @I_iMessageNumber = 24400 select @I_iAliasMessageNumber = 0 exec DYNAMICS..smGetBIMsgString  @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @Journal_Entry output  select @I_iDictID = 0 select @I_iMessageNumber = 22089 select @I_iAliasMessageNumber = 0 exec DYNAMICS..smGetBIMsgString  @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @AA_Transaction_Source output  select @I_iDictID = 1493 select @I_iMessageNumber = 24512 select @I_iAliasMessageNumber = 0 exec DYNAMICS..smGetBIMsgString  @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @Credit_Amount output  select @I_iDictID = 1493 select @I_iMessageNumber = 24415 select @I_iAliasMessageNumber = 0 exec DYNAMICS..smGetBIMsgString  @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @Account_Index output  select @I_iDictID = 1493 select @I_iMessageNumber = 22505 select @I_iAliasMessageNumber = 0 exec DYNAMICS..smGetBIMsgString  @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @Account_Description output  select @I_iDictID = 3180 select @I_iMessageNumber = 22134 select @I_iAliasMessageNumber = 0 exec DYNAMICS..smGetBIMsgString  @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @Transaction_Dimension_Code output  select @I_iDictID = 3180 select @I_iMessageNumber = 22142 select @I_iAliasMessageNumber = 0 exec DYNAMICS..smGetBIMsgString  @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @Description_1 output  select @I_iDictID = 1493 select @I_iMessageNumber = 24323 select @I_iAliasMessageNumber = 0 exec DYNAMICS..smGetBIMsgString  @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @Change_Date output  select @I_iDictID = 0 select @I_iMessageNumber = 22086 select @I_iAliasMessageNumber = 0 exec DYNAMICS..smGetBIMsgString  @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @Change_Time output  select @I_iDictID = 1493 select @I_iMessageNumber = 22423 select @I_iAliasMessageNumber = 0 exec DYNAMICS..smGetBIMsgString  @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @Account_Number output  select @I_iDictID = 0 select @I_iMessageNumber = 22087 select @I_iAliasMessageNumber = 0 exec DYNAMICS..smGetBIMsgString  @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @Assignment_Percentage output  select @I_iDictID = 0 select @I_iMessageNumber = 22088 select @I_iAliasMessageNumber = 0 exec DYNAMICS..smGetBIMsgString  @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @Distribution_Reference output  select @I_iDictID = 1493 select @I_iMessageNumber = 24454 select @I_iAliasMessageNumber = 0 exec DYNAMICS..smGetBIMsgString  @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @Originating_Credit_Amount output  select @I_iDictID = 1493 select @I_iMessageNumber = 24455 select @I_iAliasMessageNumber = 0 exec DYNAMICS..smGetBIMsgString  @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @Originating_Debit_Amount output  select @I_iDictID = 258 select @I_iMessageNumber = 32160 select @I_iAliasMessageNumber = 0 exec DYNAMICS..smGetBIMsgString  @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @Transaction_Source output  select @I_iDictID = 1493 select @I_iMessageNumber = 23598 select @I_iAliasMessageNumber = 0 exec DYNAMICS..smGetBIMsgString  @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @Year output   select @sqldropstring =   'if exists (select * from dbo.sysobjects where id = object_id(N''[dbo].[AATransactions]'') and OBJECTPROPERTY(id, N''IsView'') = 1) ' +  'drop view [dbo].[AATransactions] '  select @sqldefaultstring =   'CREATE VIEW AATransactions AS ' +   'select ' +   '[''aaGLDist''].[DEBITAMT] as ''' + @Debit_Amount + ''', ' + '[''aaGLHdr''].[JRNENTRY] as ''' + @Journal_Entry + ''', ' + 'rtrim([''aaGLHdr''].[aaTRXSource]) as ''' + @AA_Transaction_Source + ''', ' + '[''aaGLDist''].[CRDTAMNT] as ''' + @Credit_Amount + ''', ' + '[''Account Master''].[ACTINDX] as ''' + @Account_Index + ''', ' + 'rtrim([''Account Master''].[ACTDESCR]) as ''' + @Account_Description + ''', ' + 'rtrim([''aaTrxDimCodeSetp''].[aaTrxDimCode]) as ''' + @Transaction_Dimension_Code + ''', ' + 'rtrim([''aaTrxDimCodeSetp''].[aaTrxDimCodeDescr]) as ''' + @Description_1 + ''', '   select @sqlstring1 =   '(select rtrim([ACTNUMST]) from [GL00105] as [''Account Index Master''] where [''Account Index Master''].[ACTINDX] = [''Account Master''].[ACTINDX]) as ''' + @Account_Number + ''', ' + '[''aaGLAssign''].[aaAssignedPercent] as ''' + @Assignment_Percentage + ''', ' +  '[''aaGLDist''].[aaChangeDate] as ''' + @Change_Date + ''', ' +  '[''aaGLDist''].[aaChangeTime] as ''' + @Change_Time + ''', ' +  'rtrim([''aaGLAssign''].[DistRef]) as ''' + @Distribution_Reference + ''', ' +  '[''aaGLDist''].[ORCRDAMT] as ''' + @Originating_Credit_Amount + ''', ' +  '[''aaGLDist''].[ORDBTAMT] as ''' + @Originating_Debit_Amount + ''', ' +  'rtrim([''aaGLHdr''].[aaGLTRXSource]) as ''' + @Transaction_Source + ''', ' +  '[''aaGLHdr''].[YEAR1] as ''' + @Year + ''' '   select @sqljoinstring =   'from [AAG30003] as [''aaGLCode''] with (NOLOCK) '   + 'left outer join [AAG30001] as [''aaGLDist''] with (NOLOCK) on '   + '[''aaGLCode''].[aaGLHdrID] = [''aaGLDist''].[aaGLHdrID] '   + ' and [''aaGLCode''].[aaGLDistID] = [''aaGLDist''].[aaGLDistID] '   + 'left outer join [AAG30000] as [''aaGLHdr''] with (NOLOCK) on '   + '[''aaGLCode''].[aaGLHdrID] = [''aaGLHdr''].[aaGLHdrID] '   + ' and [''aaGLCode''].[aaGLHdrID] = [''aaGLHdr''].[aaGLHdrID] '   + 'left outer join [GL00100] as [''Account Master''] with (NOLOCK) on '   + '[''aaGLDist''].[ACTINDX] = [''Account Master''].[ACTINDX] '   + 'left outer join [AAG00401] as [''aaTrxDimCodeSetp''] with (NOLOCK) on '   + '[''aaGLCode''].[aaTrxDimID] = [''aaTrxDimCodeSetp''].[aaTrxDimID] '   + ' and [''aaGLCode''].[aaTrxCodeID] = [''aaTrxDimCodeSetp''].[aaTrxDimCodeID] '   + 'left outer join [AAG30002] as [''aaGLAssign''] with (NOLOCK) on '   + '[''aaGLCode''].[aaGLHdrID] = [''aaGLAssign''].[aaGLHdrID] '   + ' and [''aaGLCode''].[aaGLDistID] = [''aaGLAssign''].[aaGLDistID] '   + ' and [''aaGLCode''].[aaGLAssignID] = [''aaGLAssign''].[aaGLAssignID] '   select @sqlaccessstring =   'GRANT  SELECT ,  INSERT ,  DELETE ,  UPDATE  ON [dbo].[AATransactions] TO [rpt_accounting manager] ' + 'GRANT  SELECT ,  INSERT ,  DELETE ,  UPDATE  ON [dbo].[AATransactions] TO [rpt_certified accountant] '  exec (@sqldropstring)  exec (@sqldefaultstring+' '+@sqlstring1+' '+@sqlstring2+' '+@sqlstring3+' '+@sqlstring4+' '+@sqlstring5+' '+@sqlstring6+' '+@sqlstring7+' '+@sqlstring8+' '+@sqlstring9+' '+@sqlstring10+' '+@sqljoinstring)  exec (@sqlaccessstring)   set nocount off     
GO
GRANT EXECUTE ON  [dbo].[sp_AATransactions] TO [DYNGRP]
GO
