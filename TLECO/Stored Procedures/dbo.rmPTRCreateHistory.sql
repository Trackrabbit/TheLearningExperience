SET QUOTED_IDENTIFIER OFF
GO
SET ANSI_NULLS ON
GO
 create procedure [dbo].[rmPTRCreateHistory] @I_cBalanceForwardNumber char(21) = NULL, @O_iErrorState                  int             = NULL output as  declare  @TRUE tinyint,  @FALSE tinyint,  @tHATB tinyint,  @tLoopControl           tinyint,  @iStatus                int,  @iError                 int,  @tSchDocsExist tinyint  select  @TRUE  = 1,  @FALSE = 0  select  @iStatus = 0,  @O_iErrorState = 0  while @tLoopControl is NULL begin  select @tLoopControl = 1   if @I_cBalanceForwardNumber is NULL  begin  select @O_iErrorState = 21028  break  end    update  A  set  A.TRXMISNG = 1  from  RM30502 A JOIN   (  select  distinct RM20101.TRXSORCE  from  #Documents DOC JOIN RM20101 ON   (DOC.DOCNUMBR = RM20101.DOCNUMBR and DOC.RMDTYPAL = RM20101.RMDTYPAL)  where  RM20101.TRXSORCE <> ''  and DOC.TRANHIST = 0  and DOC.DISTHIST = 0  ) B  ON (A.TRXSORCE = B.TRXSORCE)   Update  RM00401  set  DCSTATUS = 3   from  #Documents  DOCTMP  where  RM00401.DOCNUMBR = DOCTMP.DOCNUMBR  and RM00401.RMDTYPAL = DOCTMP.RMDTYPAL  and  ((DOCTMP.TRANHIST > 0)  or (DOCTMP.DISTHIST > 0))   delete  RM00401  from  #Documents  DOCTMP  where  RM00401.DOCNUMBR = DOCTMP.DOCNUMBR  and RM00401.RMDTYPAL = DOCTMP.RMDTYPAL  and  ((DOCTMP.TRANHIST = 0)  and (DOCTMP.DISTHIST  = 0))   Insert into  RM30101(CUSTNMBR,CPRCSTNM,DOCNUMBR,CHEKNMBR,BACHNUMB,BCHSOURC,  TRXSORCE,RMDTYPAL,DUEDATE,DOCDATE,POSTDATE,PSTUSRID,  GLPOSTDT,LSTEDTDT,LSTUSRED,ORTRXAMT,CURTRXAM,SLSAMNT,   COSTAMNT,FRTAMNT,MISCAMNT,TAXAMNT,COMDLRAM,CASHAMNT,  DISTKNAM,DISAVAMT,DISCRTND,DISCDATE,DSCDLRAM,DSCPCTAM,  WROFAMNT,TRXDSCRN,CSPORNBR,SLPRSNID,SLSTERCD,DINVPDOF,   PPSAMDED,GSTDSAMT,DELETE1,TAXSCHID,SLSCHDID,FRTSCHID,  MSCSCHID,CURNCYID,SHIPMTHD,PYMTRMID,TRDISAMT,NOTEINDX,  VOIDSTTS,VOIDDATE,BALFWDNM,CSHRCTYP,Tax_Date,APLYWITH,  SALEDATE,CORRCTN,SIMPLIFD,Electronic,ECTRX,BackoutTradeDisc,BKTSLSAM,BKTFRTAM,BKTMSCAM,ADRSCODE)  select  DOC.CUSTNMBR,DOC.CPRCSTNM,DOC.DOCNUMBR,DOC.CHEKNMBR,DOC.BACHNUMB,DOC.BCHSOURC,  DOC.TRXSORCE,DOC.RMDTYPAL,DOC.DUEDATE,DOC.DOCDATE,DOC.POSTDATE,DOC.PSTUSRID,  DOC.GLPOSTDT,DOC.LSTEDTDT,DOC.LSTUSRED,DOC.ORTRXAMT,DOC.CURTRXAM,DOC.SLSAMNT,  DOC.COSTAMNT,DOC.FRTAMNT,DOC.MISCAMNT,DOC.TAXAMNT,DOC.COMDLRAM,DOC.CASHAMNT,  DOC.DISTKNAM,DOC.DISAVAMT,DOC.DISCRTND,DOC.DISCDATE,DOC.DSCDLRAM,DOC.DSCPCTAM,  DOC.WROFAMNT,DOC.TRXDSCRN,DOC.CSPORNBR,DOC.SLPRSNID,DOC.SLSTERCD,DOC.DINVPDOF,  DOC.PPSAMDED,DOC.GSTDSAMT,DOC.DELETE1,DOC.TAXSCHID,DOC.SLSCHDID,DOC.FRTSCHID,  DOC.MSCSCHID,DOC.CURNCYID,DOC.SHIPMTHD,DOC.PYMTRMID,DOC.TRDISAMT,DOC.NOTEINDX,  DOC.VOIDSTTS,DOC.VOIDDATE,@I_cBalanceForwardNumber,DOC.CSHRCTYP,DOC.Tax_Date,DOC.APLYWITH,  DOC.SALEDATE,DOC.CORRCTN,DOC.SIMPLIFD,DOC.Electronic,DOC.ECTRX,DOC.BackoutTradeDisc,DOC.BKTSLSAM,DOC.BKTFRTAM,DOC.BKTMSCAM, ADRSCODE  from  #Documents DOCTMP JOIN RM20101 DOC ON (DOC.DOCNUMBR = DOCTMP.DOCNUMBR and DOC.RMDTYPAL = DOCTMP.RMDTYPAL)  where  DOCTMP.TRANHIST > 0  or DOCTMP.DISTHIST > 0   select @iError = @@error  if @iError <> 0   begin  select @iStatus = @iError  return (@iStatus)  end   delete  RM20101  from  #Documents DOCTMP  where  RM20101.DOCNUMBR = DOCTMP.DOCNUMBR  and RM20101.RMDTYPAL = DOCTMP.RMDTYPAL   Update  MC020102  set  DCSTATUS = 3   from  #Documents  DOCTMP  where  MC020102.DOCNUMBR = DOCTMP.DOCNUMBR  and MC020102.RMDTYPAL = DOCTMP.RMDTYPAL  and  ((DOCTMP.TRANHIST > 0)  or (DOCTMP.DISTHIST > 0))   delete  MC020102  from  #Documents  DOCTMP  where  MC020102.DOCNUMBR = DOCTMP.DOCNUMBR  and MC020102.RMDTYPAL = DOCTMP.RMDTYPAL  and  ((DOCTMP.TRANHIST = 0)  and (DOCTMP.DISTHIST  = 0))   delete  MC020104  from  #Documents  DOCTMP  where  MC020104.DOCNUMBR = DOCTMP.DOCNUMBR  and MC020104.DOCTYPE  = DOCTMP.RMDTYPAL  and MC020104.CURNCYID = DOCTMP.CURNCYID  and  ((DOCTMP.TRANHIST = 0)  and (DOCTMP.DISTHIST  = 0))   insert into  RM30301(TRXSORCE,POSTEDDT,DOCNUMBR,DISTTYPE,RMDTYPAL,  SEQNUMBR,CUSTNMBR,DSTINDX,DEBITAMT,CRDTAMNT,  PROJCTID,USERID,CATEGUSD,CURNCYID,CURRNIDX,  ORCRDAMT,ORDBTAMT,DistRef )  select  DISTS.TRXSORCE,DISTS.POSTEDDT,DISTS.DOCNUMBR,DISTS.DISTTYPE,  DISTS.RMDTYPAL,DISTS.SEQNUMBR,DISTS.CUSTNMBR,DISTS.DSTINDX,  DISTS.DEBITAMT,DISTS.CRDTAMNT,DISTS.PROJCTID,DISTS.USERID,  DISTS.CATEGUSD,DISTS.CURNCYID,DISTS.CURRNIDX,DISTS.ORCRDAMT,  DISTS.ORDBTAMT,DISTS.DistRef  from  RM10101 DISTS JOIN #Documents DOCTMP ON (DISTS.DOCNUMBR = DOCTMP.DOCNUMBR and DISTS.RMDTYPAL = DOCTMP.RMDTYPAL)  where  DOCTMP.DISTHIST  > 0    select @iError = @@error  if @iError <> 0   begin  select @iStatus = @iError  return (@iStatus)  end   delete  RM10101  from  #Documents DOCTMP  where  RM10101.DOCNUMBR = DOCTMP.DOCNUMBR  and RM10101.RMDTYPAL = DOCTMP.RMDTYPAL   insert into  RM10504(RMDTYPAL,DOCNUMBR,SALSTERR,SLPRSNID,CUSTNMBR,  COMDLRAM,NCOMAMNT,COMPRCNT,PRCTOSAL,SLSAMNT,  COMTRSRC,ORCOMAMT,ORNCMAMT,ORSLSAMT,CURRNIDX )  select  COMM.RMDTYPAL,COMM.DOCNUMBR,COMM.SALSTERR,COMM.SLPRSNID,  COMM.CUSTNMBR,COMM.COMDLRAM,COMM.NCOMAMNT,COMM.COMPRCNT,  COMM.PRCTOSAL,COMM.SLSAMNT,COMM.COMTRSRC,COMM.ORCOMAMT,  COMM.ORNCMAMT,COMM.ORSLSAMT,COMM.CURRNIDX  from  RM10501 COMM JOIN #Documents DOCTMP ON (COMM.RMDTYPAL = DOCTMP.RMDTYPAL and COMM.DOCNUMBR = DOCTMP.DOCNUMBR)  where  COMM.COMMPAID = @FALSE   select @iError = @@error  if @iError <> 0   begin  select @iStatus = @iError  return (@iStatus)  end   insert into  RM30501(NCOMAMNT,RMDTYPAL,COMPRCNT,DOCNUMBR,SEQNUMBR,TRXSORCE,  COMTRSRC,CUSTNMBR,SLPRSNID,SALSTERR,COMMCODE,PRCTOSAL,  SLSAMNT,COMDLRAM,POSTED,COMMPAID,COMMDEST,ORCOMAMT,  ORSLSAMT,ORNCMAMT,CURRNIDX )  select  COMM.NCOMAMNT,COMM.RMDTYPAL,COMM.COMPRCNT,COMM.DOCNUMBR,COMM.SEQNUMBR,  COMM.TRXSORCE,COMM.COMTRSRC,COMM.CUSTNMBR,COMM.SLPRSNID,COMM.SALSTERR,  COMM.COMMCODE,COMM.PRCTOSAL,COMM.SLSAMNT,COMM.COMDLRAM,COMM.POSTED,  COMM.COMMPAID,COMM.COMMDEST,COMM.ORCOMAMT,COMM.ORSLSAMT,COMM.ORNCMAMT,COMM.CURRNIDX  from  RM10501 COMM JOIN #Documents DOCTMP ON (COMM.RMDTYPAL = DOCTMP.RMDTYPAL and COMM.DOCNUMBR = DOCTMP.DOCNUMBR)  where  DOCTMP.DISTHIST > 0    select @iError = @@error  if @iError <> 0   begin  select @iStatus = @iError  return (@iStatus)  end   delete  RM10501  from  #Documents DOCTMP  where  RM10501.RMDTYPAL = DOCTMP.RMDTYPAL  and RM10501.DOCNUMBR = DOCTMP.DOCNUMBR   insert into  RM30601(BACHNUMB,RMDTYPAL,DOCNUMBR,CUSTNMBR,TRXSORCE,TAXDTLID,  ACTINDX,TAXAMNT,ORTAXAMT,STAXAMNT,ORSLSTAX,FRTTXAMT,  ORFRTTAX,MSCTXAMT,ORMSCTAX,TAXDTSLS,ORTOTSLS,TDTTXSLS,  ORTXSLS,POSTED,SEQNUMBR,CURRNIDX )  select  TAX.BACHNUMB,TAX.RMDTYPAL,TAX.DOCNUMBR,TAX.CUSTNMBR,TAX.TRXSORCE,   TAX.TAXDTLID,TAX.ACTINDX,TAX.TAXAMNT,TAX.ORTAXAMT,TAX.STAXAMNT,  TAX.ORSLSTAX,TAX.FRTTXAMT,TAX.ORFRTTAX,TAX.MSCTXAMT,TAX.ORMSCTAX,TAX.TAXDTSLS,  TAX.ORTOTSLS,TAX.TDTTXSLS,TAX.ORTXSLS,TAX.POSTED,TAX.SEQNUMBR,TAX.CURRNIDX  from  RM10601 TAX JOIN #Documents DOCTMP ON (TAX.RMDTYPAL = DOCTMP.RMDTYPAL and TAX.DOCNUMBR = DOCTMP.DOCNUMBR)  where  ((DOCTMP.TRANHIST > 0)  or (DOCTMP.DISTHIST > 0))   select @iError = @@error  if @iError <> 0   begin  select @iStatus = @iError  return (@iStatus)  end   delete  RM10601  from  #Documents DOCTMP  where  RM10601.RMDTYPAL = DOCTMP.RMDTYPAL  and RM10601.DOCNUMBR = DOCTMP.DOCNUMBR   delete  SY04910  from  #Documents DOCTMP  where  SY04910.MODULE1  = 9   and SY04910.DOCNUMBR = DOCTMP.DOCNUMBR  and SY04910.DOCTYPE  = DOCTMP.RMDTYPAL  and DOCTMP.TRANHIST = 0  and DOCTMP.DISTHIST = 0   delete  SY04915  from  #Documents DOCTMP  where  SY04915.MODULE1  = 9   and SY04915.DOCNUMBR = DOCTMP.DOCNUMBR  and SY04915.DOCTYPE  = DOCTMP.RMDTYPAL  and DOCTMP.TRANHIST = 0  and DOCTMP.DISTHIST = 0   insert into  RM30201(CUSTNMBR,CPRCSTNM,TRXSORCE,DATE1,TIME1,GLPOSTDT,POSTED,TAXDTLID,APTODCNM,APTODCTY,APTODCDT,ApplyToGLPostDate,  CURNCYID,CURRNIDX,APPTOAMT,DISTKNAM,DISAVTKN,WROFAMNT,ORAPTOAM,ORDISTKN,ORDATKN,ORWROFAM,APTOEXRATE,APTODENRATE,  APTORTCLCMETH,APTOMCTRXSTT,APFRDCNM,APFRDCTY,APFRDCDT,ApplyFromGLPostDate,FROMCURR,APFRMAPLYAMT,APFRMDISCTAKEN,  APFRMDISCAVAIL,APFRMWROFAMT,ActualApplyToAmount,ActualDiscTakenAmount,ActualDiscAvailTaken,ActualWriteOffAmount,  APFRMEXRATE,APFRMDENRATE,APFRMRTCLCMETH,APFRMMCTRXSTT,APYFRMRNDAMT,APYTORNDAMT,APYTORNDDISC,OAPYFRMRNDAMT,OAPYTORNDAMT,  OAPYTORNDDISC,GSTDSAMT,PPSAMDED,RLGANLOS,Settled_Gain_CreditCurrT,Settled_Loss_CreditCurrT,Settled_Gain_DebitCurrTr,  Settled_Loss_DebitCurrTr,Settled_Gain_DebitDiscAv,Settled_Loss_DebitDiscAv,Revaluation_Status )  select  A.CUSTNMBR,A.CPRCSTNM,A.TRXSORCE,A.DATE1,A.TIME1,A.GLPOSTDT,A.POSTED,A.TAXDTLID,A.APTODCNM,A.APTODCTY,A.APTODCDT,  A.ApplyToGLPostDate,A.CURNCYID,A.CURRNIDX,A.APPTOAMT,A.DISTKNAM,A.DISAVTKN,A.WROFAMNT,A.ORAPTOAM,A.ORDISTKN,A.ORDATKN,  A.ORWROFAM,A.APTOEXRATE,A.APTODENRATE,A.APTORTCLCMETH,A.APTOMCTRXSTT,A.APFRDCNM,A.APFRDCTY,A.APFRDCDT,A.ApplyFromGLPostDate,  A.FROMCURR,A.APFRMAPLYAMT,A.APFRMDISCTAKEN,A.APFRMDISCAVAIL,A.APFRMWROFAMT,A.ActualApplyToAmount,A.ActualDiscTakenAmount,  A.ActualDiscAvailTaken,A.ActualWriteOffAmount,A.APFRMEXRATE,A.APFRMDENRATE,A.APFRMRTCLCMETH,A.APFRMMCTRXSTT,A.APYFRMRNDAMT,  A.APYTORNDAMT,A.APYTORNDDISC,A.OAPYFRMRNDAMT,A.OAPYTORNDAMT,A.OAPYTORNDDISC,A.GSTDSAMT,A.PPSAMDED,A.RLGANLOS,A.Settled_Gain_CreditCurrT,  A.Settled_Loss_CreditCurrT,A.Settled_Gain_DebitCurrTr,A.Settled_Loss_DebitCurrTr,A.Settled_Gain_DebitDiscAv,A.Settled_Loss_DebitDiscAv,A.Revaluation_Status  from  RM20201 A JOIN #Documents DOCTMP ON (A.APFRDCTY = DOCTMP.RMDTYPAL and A.APFRDCNM = DOCTMP.DOCNUMBR)  where  ((DOCTMP.TRANHIST > 0)  or (DOCTMP.DISTHIST > 0))  and NOT EXISTS(  select  APTODCNM  from  RM30201 B  where  A.APTODCTY = B.APTODCTY  and A.APTODCNM = B.APTODCNM  and A.APFRDCNM = B.APFRDCNM  and A.APFRDCTY = B.APFRDCTY )   select @iError = @@error  if @iError <> 0   begin  select @iStatus = @iError  return (@iStatus)  end   delete  RM20201  from  #Documents DOCTMP  where  RM20201.APFRDCTY = DOCTMP.RMDTYPAL  and RM20201.APFRDCNM = DOCTMP.DOCNUMBR  and  NOT EXISTS(  select  DOCNUMBR  from  RM20101  where  RM20101.DOCNUMBR = RM20201.APTODCNM  and RM20101.RMDTYPAL = RM20201.APTODCTY )   insert into  RM30201(CUSTNMBR,CPRCSTNM,TRXSORCE,DATE1,TIME1,GLPOSTDT,POSTED,TAXDTLID,APTODCNM,APTODCTY,APTODCDT,ApplyToGLPostDate,  CURNCYID,CURRNIDX,APPTOAMT,DISTKNAM,DISAVTKN,WROFAMNT,ORAPTOAM,ORDISTKN,ORDATKN,ORWROFAM,APTOEXRATE,APTODENRATE,  APTORTCLCMETH,APTOMCTRXSTT,APFRDCNM,APFRDCTY,APFRDCDT,ApplyFromGLPostDate,FROMCURR,APFRMAPLYAMT,APFRMDISCTAKEN,  APFRMDISCAVAIL,APFRMWROFAMT,ActualApplyToAmount,ActualDiscTakenAmount,ActualDiscAvailTaken,ActualWriteOffAmount,  APFRMEXRATE,APFRMDENRATE,APFRMRTCLCMETH,APFRMMCTRXSTT,APYFRMRNDAMT,APYTORNDAMT,APYTORNDDISC,OAPYFRMRNDAMT,OAPYTORNDAMT,  OAPYTORNDDISC,GSTDSAMT,PPSAMDED,RLGANLOS,Settled_Gain_CreditCurrT,Settled_Loss_CreditCurrT,Settled_Gain_DebitCurrTr,  Settled_Loss_DebitCurrTr,Settled_Gain_DebitDiscAv,Settled_Loss_DebitDiscAv,Revaluation_Status )  select  A.CUSTNMBR,A.CPRCSTNM,A.TRXSORCE,A.DATE1,A.TIME1,A.GLPOSTDT,A.POSTED,A.TAXDTLID,A.APTODCNM,A.APTODCTY,A.APTODCDT,  A.ApplyToGLPostDate,A.CURNCYID,A.CURRNIDX,A.APPTOAMT,A.DISTKNAM,A.DISAVTKN,A.WROFAMNT,A.ORAPTOAM,A.ORDISTKN,A.ORDATKN,  A.ORWROFAM,A.APTOEXRATE,A.APTODENRATE,A.APTORTCLCMETH,A.APTOMCTRXSTT,A.APFRDCNM,A.APFRDCTY,A.APFRDCDT,A.ApplyFromGLPostDate,  A.FROMCURR,A.APFRMAPLYAMT,A.APFRMDISCTAKEN,A.APFRMDISCAVAIL,A.APFRMWROFAMT,A.ActualApplyToAmount,A.ActualDiscTakenAmount,  A.ActualDiscAvailTaken,A.ActualWriteOffAmount,A.APFRMEXRATE,A.APFRMDENRATE,A.APFRMRTCLCMETH,A.APFRMMCTRXSTT,A.APYFRMRNDAMT,  A.APYTORNDAMT,A.APYTORNDDISC,A.OAPYFRMRNDAMT,A.OAPYTORNDAMT,A.OAPYTORNDDISC,A.GSTDSAMT,A.PPSAMDED,A.RLGANLOS,A.Settled_Gain_CreditCurrT,  A.Settled_Loss_CreditCurrT,A.Settled_Gain_DebitCurrTr,A.Settled_Loss_DebitCurrTr,A.Settled_Gain_DebitDiscAv,A.Settled_Loss_DebitDiscAv,A.Revaluation_Status  from  RM20201 A JOIN #Documents DOCTMP ON(A.APTODCTY = DOCTMP.RMDTYPAL and A.APTODCNM = DOCTMP.DOCNUMBR)  where  ((DOCTMP.TRANHIST > 0)  or (DOCTMP.DISTHIST > 0))  and NOT EXISTS(  select  APTODCNM  from  RM30201 B  where  A.APTODCTY = B.APTODCTY  and A.APTODCNM = B.APTODCNM  and A.APFRDCNM = B.APFRDCNM  and A.APFRDCTY = B.APFRDCTY )   select @iError = @@error  if @iError <> 0   begin  select @iStatus = @iError  return (@iStatus)  end   delete  RM20201  from  #Documents DOCTMP  where  RM20201.APTODCTY = DOCTMP.RMDTYPAL  and RM20201.APTODCNM = DOCTMP.DOCNUMBR  and  NOT EXISTS(  select  1  from  RM20101  where  RM20101.DOCNUMBR = RM20201.APFRDCNM  and RM20101.RMDTYPAL = RM20201.APFRDCTY )   if exists(select 1 from #Documents where RMDTYPAL = 2)   begin  select @tSchDocsExist = @TRUE  end  else  begin  select @tSchDocsExist = @FALSE  end   if @tSchDocsExist = @TRUE  begin  insert into  RM30401(SCHEDULE_NUMBER,  SCHEDULE_DESC,  ORIG_DOC_NUMBER,  ORIG_DOC_TYPE,  CUSTNMBR,  SCH_DOC_DATE,  SCHEDULE_AMOUNT,  CURNCYID,  SCHEDULE_INT_TYPE1,  SCHEDULE_INT_RATE,  NUM_PAYMENTS,  PYMNT_FREQUENCY,  PAYMENT_AMOUNT,  FIRST_INV_DOC_DATE,  FIRST_INV_DUE_DATE,  REC_ACCT_IDX,  REC_OFFSET_ACCT_IDX,  INT_INCOME_ACCT_IDX,  Status,  FuncSchAmnt,  CREDIT_MEMO_DOC_NUM)  select  SCHHDR.SCHEDULE_NUMBER,  SCHHDR.SCHEDULE_DESC,  SCHHDR.ORIG_DOC_NUMBER,  SCHHDR.ORIG_DOC_TYPE,  SCHHDR.CUSTNMBR,  SCHHDR.SCH_DOC_DATE,  SCHHDR.SCHEDULE_AMOUNT,  SCHHDR.CURNCYID,  SCHHDR.SCHEDULE_INT_TYPE1,  SCHHDR.SCHEDULE_INT_RATE,  SCHHDR.NUM_PAYMENTS,  SCHHDR.PYMNT_FREQUENCY,  SCHHDR.PAYMENT_AMOUNT,  SCHHDR.FIRST_INV_DOC_DATE,  SCHHDR.FIRST_INV_DUE_DATE,  SCHHDR.REC_ACCT_IDX,  SCHHDR.REC_OFFSET_ACCT_IDX,  SCHHDR.INT_INCOME_ACCT_IDX,  SCHHDR.Status,  SCHHDR.FuncSchAmnt,  SCHHDR.CREDIT_MEMO_DOC_NUM  from  RM20400 SCHHDR JOIN #Documents DOCTMP ON(SCHHDR.SCHEDULE_NUMBER = DOCTMP.DOCNUMBR)  where  DOCTMP.TRANHIST > 0  and  DOCTMP.RMDTYPAL = 2    select @iError = @@error  if @iError <> 0   begin  select @iStatus = @iError  return (@iStatus)  end   delete  RM20400  from  #Documents DOCTMP  where  DOCTMP.DOCNUMBR = RM20400.SCHEDULE_NUMBER  and  DOCTMP.RMDTYPAL = 2   select @iError = @@error  if @iError <> 0   begin  select @iStatus = @iError  return (@iStatus)  end   delete  RM20401  from  #Documents DOCTMP  where  DOCTMP.DOCNUMBR = RM20401.SCHEDULE_NUMBER  and  DOCTMP.RMDTYPAL = 2  and  DOCTMP.TRANHIST = 0   select @iError = @@error  if @iError <> 0   begin  select @iStatus = @iError  return (@iStatus)  end  end  end   return (@iStatus)   
GO
GRANT EXECUTE ON  [dbo].[rmPTRCreateHistory] TO [DYNGRP]
GO
