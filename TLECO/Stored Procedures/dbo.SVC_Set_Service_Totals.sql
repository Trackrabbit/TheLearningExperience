SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO
 CREATE procedure [dbo].[SVC_Set_Service_Totals] (@srvrectype int = NULL, @callnbr varchar(11) = NULL)  as declare @linetotals numeric(19,2) declare @partsprice numeric(19,2) declare @partscost numeric(19,2) declare @laborprice numeric(19,2) declare @laborcost numeric(19,2) declare @miscprice numeric(19,2) declare @misccost numeric(19,2) declare @origlinetotals numeric(19,2) declare @origpartsprice numeric(19,2) declare @origpartscost numeric(19,2) declare @origlaborprice numeric(19,2) declare @origlaborcost numeric(19,2) declare @origmiscprice numeric(19,2) declare @origmisccost numeric(19,2) if @srvrectype is NULL or @callnbr is NULL begin return 500 end select  @linetotals = SUM(XTNDPRCE),  @origlinetotals = SUM(OXTNDPRC)   from SVC00203   where SRVRECTYPE  = @srvrectype and  CALLNBR     = @callnbr select  @partsprice = SUM(XTNDPRCE),   @partscost = SUM(EXTDCOST),  @origpartsprice = SUM(OXTNDPRC),   @origpartscost = SUM(OREXTCST)   from SVC00203   where SRVRECTYPE  = @srvrectype and  CALLNBR     = @callnbr and  LINITMTYP = 'P' select  @laborprice = SUM(XTNDPRCE),   @laborcost = SUM(EXTDCOST),  @origlaborprice = SUM(OXTNDPRC),   @origlaborcost = SUM(OREXTCST)   from SVC00203   where SRVRECTYPE  = @srvrectype and  CALLNBR     = @callnbr and  LINITMTYP = 'L' select  @miscprice = SUM(XTNDPRCE),   @misccost = SUM(EXTDCOST),  @origmiscprice = SUM(OXTNDPRC),   @origmisccost = SUM(OREXTCST)   from SVC00203   where SRVRECTYPE  = @srvrectype and  CALLNBR     = @callnbr and  (LINITMTYP = 'E' or   LINITMTYP = 'A') select @linetotals = IsNull(@linetotals,0) select @partsprice = IsNull(@partsprice,0) select @partscost = IsNull(@partscost,0) select @laborprice = IsNull(@laborprice,0) select @laborcost = IsNull(@laborcost,0) select @miscprice = IsNull(@miscprice,0) select @misccost = IsNull(@misccost,0) select @origlinetotals = IsNull(@origlinetotals,0) select @origpartsprice = IsNull(@origpartsprice,0) select @origpartscost = IsNull(@origpartscost,0) select @origlaborprice = IsNull(@origlaborprice,0) select @origlaborcost = IsNull(@origlaborcost,0) select @origmiscprice = IsNull(@origmiscprice,0) select @origmisccost = IsNull(@origmisccost,0) update SVC00200 set  PRETAXTOT = @linetotals,  PARSTOTPRC = @partsprice,  PARSTOTCST = @partscost,  LABSTOTPRC = @laborprice,  LABSTOTCST = @laborcost,  MSCSTOTPRC = @miscprice,  MISSTOTCST = @misccost,  ORIGPRETAXTOT = @origlinetotals,  ORIGPARSTOTPRC = @origpartsprice,  ORIGPARSTOTCST = @origpartscost,  ORIGLABSTOTPRC = @origlaborprice,  ORIGLABSUBTOTCOST = @origlaborcost,  ORIGMSCSTOTPRC = @origmiscprice,  ORIGMISSTOTCST = @origmisccost   where SRVRECTYPE = @srvrectype and  CALLNBR    = @callnbr if @@error <> 0 begin return @@error end return    
GO
GRANT EXECUTE ON  [dbo].[SVC_Set_Service_Totals] TO [DYNGRP]
GO
