SET QUOTED_IDENTIFIER OFF
GO
SET ANSI_NULLS ON
GO
CREATE Procedure [dbo].[SVC_RMA_Reset_HDR_Status] (@RMANumber char(15), @RetType char(11),@ReturnStatus char(3) output) as declare @EntryStatus char(3),  @ReceivedStatus char(3),  @DiscpStatus char(3),  @PartialReceivedStatus char(3),  @ReadyToCloseStatus char(3),  @ClosedStatus char(3),  @RMAStatus int,  @OLDEntryStatus char(3),  @OLDReceivedStatus char(3),  @OLDDiscpStatus char(3),  @OLDPartialReceivedStatus char(3),  @OLDReadyToCloseStatus char(3),  @OLDClosedStatus char(3),  @OLDRetType char(11),  @Received tinyint,  @RecType smallint,  @HeaderStatus char(3)  select @EntryStatus = SVC05501.RETSTAT, @ReceivedStatus = SVC05501.Received_Status,   @PartialReceivedStatus = SVC05501.SVC_Partial_Received_Sta,  @DiscpStatus = SVC_Discrepancy_Status, @ClosedStatus = Close_Status,  @ReadyToCloseStatus = SVC05501.SVC_Ready_To_Close_Statu  from SVC05501 where  RETTYPE = @RetType  select @OLDEntryStatus = SVC05501.RETSTAT, @OLDReceivedStatus = SVC05501.Received_Status,   @OLDPartialReceivedStatus = SVC05501.SVC_Partial_Received_Sta,  @OLDDiscpStatus = SVC_Discrepancy_Status, @OLDClosedStatus = Close_Status,  @OLDReadyToCloseStatus = SVC05501.SVC_Ready_To_Close_Statu, @OLDRetType = SVC05000.RETSTAT  from SVC05501 left join SVC05000 on  SVC05000.RETTYPE = SVC05501.RETTYPE where SVC05000.RETDOCID = @RMANumber  if not exists(select * from SVC05000 where RETDOCID = @RMANumber)   select @HeaderStatus = @EntryStatus  else  if exists(select * from SVC05000 where RETDOCID = @RMANumber and RETSTAT = @OLDEntryStatus)  select @HeaderStatus = @EntryStatus  else if exists(select * from SVC05000 where RETDOCID = @RMANumber and RETSTAT = @OLDPartialReceivedStatus )  select @HeaderStatus = @PartialReceivedStatus  else if exists(select * from SVC05000 where RETDOCID = @RMANumber and (RETSTAT = @OLDDiscpStatus or RETSTAT = @OLDReceivedStatus))  select @HeaderStatus = @ReceivedStatus  else  select @HeaderStatus = RETSTAT from SVC05000 where RETDOCID = @RMANumber  select @ReturnStatus = @HeaderStatus return     
GO
GRANT EXECUTE ON  [dbo].[SVC_RMA_Reset_HDR_Status] TO [DYNGRP]
GO
