SET QUOTED_IDENTIFIER OFF
GO
SET ANSI_NULLS ON
GO
 CREATE PROCEDURE [dbo].[sp_Dynamics_ReceivablesApply_Open] @iLanguageID int  as  set nocount on   declare @sqldropstring varchar(400),  @sqldefaultstring varchar(8000),  @sqlstring1 varchar(8000),  @sqlstring2 varchar(8000),  @sqlstring3 varchar(8000),  @sqlstring4 varchar(8000),  @sqlstring5 varchar(8000),  @sqlstring6 varchar(8000),  @sqlstring7 varchar(8000),  @sqlstring8 varchar(8000),  @sqlstring9 varchar(8000),  @sqlstring10 varchar(8000),  @sqlstring11 varchar(8000),  @sqlstring12 varchar(8000),  @sqlstring13 varchar(8000),  @sqlstring14 varchar(8000),  @sqlstring15 varchar(8000),  @sqlstring16 varchar(8000),  @sqlstring17 varchar(8000),  @sqlstring18 varchar(8000),  @sqlstring19 varchar(8000),  @sqlstring20 varchar(8000),  @sqlstring21 varchar(8000),  @sqlstring22 varchar(8000),  @sqljoinstring varchar(8000),  @sqlaccessstring varchar(2000),  @tNumberSegments int,  @tSegment int,  @I_iDictID int,  @I_iLangID int,  @I_iMessageNumber int,  @I_iAliasMessageNumber int,  @I_iIntegerValue int,  @Apply_From_Document_Number varchar(255), @Apply_From_Document_Date varchar(255), @Apply_From_Document_Type varchar(255), @Apply_To_Document_Type varchar(255), @Apply_To_Document_Number varchar(255), @Apply_Bucket1 varchar(255), @Apply_Bucket2 varchar(255), @Apply_Bucket3 varchar(255), @Apply_Bucket4 varchar(255), @Apply_Bucket5 varchar(255), @Apply_Bucket6 varchar(255), @Apply_Bucket7 varchar(255), @DrillBack_Base_Url varchar(255)  select @DrillBack_Base_Url = DYNAMICS.dbo.createBaseDrillBackUrlString(DB_NAME(),0)  select @I_iDictID = 0 select @I_iMessageNumber = 22014 select @I_iAliasMessageNumber = 0 exec DYNAMICS..smGetBIMsgString  @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @Apply_From_Document_Number output   select @I_iDictID = 0 select @I_iMessageNumber = 22015 select @I_iAliasMessageNumber = 0 exec DYNAMICS..smGetBIMsgString  @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @Apply_From_Document_Date output   select @I_iDictID = 0 select @I_iMessageNumber = 22017 select @I_iAliasMessageNumber = 0 exec DYNAMICS..smGetBIMsgString  @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @Apply_From_Document_Type output   select @I_iDictID = 0 select @I_iMessageNumber = 22012 select @I_iAliasMessageNumber = 0 exec DYNAMICS..smGetBIMsgString  @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @Apply_To_Document_Type output   select @I_iDictID = 0 select @I_iMessageNumber = 22022 select @I_iAliasMessageNumber = 0 exec DYNAMICS..smGetBIMsgString  @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @Apply_To_Document_Number output   select @I_iDictID = 0 select @I_iMessageNumber = 22023 select @I_iAliasMessageNumber = 0 exec DYNAMICS..smGetBIMsgString  @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @Apply_Bucket1 output   select @I_iDictID = 0 select @I_iMessageNumber = 22024 select @I_iAliasMessageNumber = 0 exec DYNAMICS..smGetBIMsgString  @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @Apply_Bucket2 output   select @I_iDictID = 0 select @I_iMessageNumber = 22025 select @I_iAliasMessageNumber = 0 exec DYNAMICS..smGetBIMsgString  @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @Apply_Bucket3 output   select @I_iDictID = 0 select @I_iMessageNumber = 22026 select @I_iAliasMessageNumber = 0 exec DYNAMICS..smGetBIMsgString  @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @Apply_Bucket4 output   select @I_iDictID = 0 select @I_iMessageNumber = 22027 select @I_iAliasMessageNumber = 0 exec DYNAMICS..smGetBIMsgString  @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @Apply_Bucket5 output   select @I_iDictID = 0 select @I_iMessageNumber = 22028 select @I_iAliasMessageNumber = 0 exec DYNAMICS..smGetBIMsgString  @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @Apply_Bucket6 output   select @I_iDictID = 0 select @I_iMessageNumber = 22029 select @I_iAliasMessageNumber = 0 exec DYNAMICS..smGetBIMsgString  @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @Apply_Bucket7 output   select @sqldropstring =   'if exists (select * from dbo.sysobjects where id = object_id(N''[dbo].[ReceivablesApply_Open]'') and OBJECTPROPERTY(id, N''IsView'') = 1) ' +  'drop view [dbo].[ReceivablesApply_Open] '  select @sqldefaultstring =   'CREATE VIEW ReceivablesApply_Open AS ' +  'select ' +   'rtrim([''RM Apply Open File''].[APFRDCNM]) as ''' + @Apply_From_Document_Number + ''', ' + '[''RM Apply Open File''].[APFRDCDT] as ''' + @Apply_From_Document_Date + ''', ' + '''' + @Apply_From_Document_Type + ''' = dbo.DYN_FUNC_Document_Type_RM_Trx([''RM Apply Open File''].[APFRDCTY]), ' + '''' + @Apply_To_Document_Type + ''' = dbo.DYN_FUNC_Document_Type_RM_Trx([''RM Apply Open File''].[APTODCTY]), ' + 'rtrim([''RM Apply Open File''].[APTODCNM]) as ''' + @Apply_To_Document_Number + ''', ' + 'case [''RM Open File''].[AGNGBUKT] when 1 THEN -[''RM Apply Open File''].[APPTOAMT] ELSE 0.00 END as ''' + @Apply_Bucket1 + ''', ' + 'case [''RM Open File''].[AGNGBUKT] when 2 THEN -[''RM Apply Open File''].[APPTOAMT] ELSE 0.00 END as ''' + @Apply_Bucket2 + ''', ' + 'case [''RM Open File''].[AGNGBUKT] when 3 THEN -[''RM Apply Open File''].[APPTOAMT] ELSE 0.00 END as ''' + @Apply_Bucket3 + ''', ' + 'case [''RM Open File''].[AGNGBUKT] when 4 THEN -[''RM Apply Open File''].[APPTOAMT] ELSE 0.00 END as ''' + @Apply_Bucket4 + ''', ' + 'case [''RM Open File''].[AGNGBUKT] when 5 THEN -[''RM Apply Open File''].[APPTOAMT] ELSE 0.00 END as ''' + @Apply_Bucket5 + ''', ' + 'case [''RM Open File''].[AGNGBUKT] when 6 THEN -[''RM Apply Open File''].[APPTOAMT] ELSE 0.00 END as ''' + @Apply_Bucket6 + ''', ' + 'case [''RM Open File''].[AGNGBUKT] when 7 THEN -[''RM Apply Open File''].[APPTOAMT] ELSE 0.00 END as ''' + @Apply_Bucket7 + ''' '   select @sqlstring1 =   'from RM20201 [''RM Apply Open File''] with (NOLOCK) join RM20101 [''RM Open File''] with (NOLOCK) on   ([''RM Apply Open File''].APTODCTY = [''RM Open File''].RMDTYPAL and   [''RM Apply Open File''].APTODCNM = [''RM Open File''].DOCNUMBR) '  select @sqlaccessstring =   'GRANT SELECT ON [dbo].[ReceivablesApply_Open] TO [rpt_collections manager]' + 'GRANT SELECT ON [dbo].[ReceivablesApply_Open] TO [rpt_accounting manager]' + 'GRANT SELECT ON [dbo].[ReceivablesApply_Open] TO [rpt_accounts receivable coordinator]' + 'GRANT SELECT ON [dbo].[ReceivablesApply_Open] TO [rpt_executive]' + 'GRANT SELECT ON [dbo].[ReceivablesApply_Open] TO [rpt_bookkeeper]'   exec (@sqldropstring)  exec (@sqldefaultstring+' '+@sqlstring1+' '+@sqlstring2+' '+@sqlstring3+' '+@sqlstring4+' '+@sqlstring5+' '+@sqlstring6+' '+@sqlstring7+' '+@sqlstring8+' '+@sqlstring9+' '+@sqlstring10+' '+@sqlstring11+' '+@sqlstring12+' '+@sqlstring13+' '+@sqlstring14+' '+@sqlstring15+' '+@sqlstring16+' '+@sqlstring17+' '+@sqlstring18+' '+@sqlstring19+' '+@sqlstring20+' '+@sqljoinstring)  exec (@sqlaccessstring)   set nocount off    
GO
GRANT EXECUTE ON  [dbo].[sp_Dynamics_ReceivablesApply_Open] TO [DYNGRP]
GO
