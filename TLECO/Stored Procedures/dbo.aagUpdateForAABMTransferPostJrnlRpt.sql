SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO
 create  PROCEDURE [dbo].[aagUpdateForAABMTransferPostJrnlRpt]  @DOCNUMBR CHAR(21),  @CHEKBKID CHAR(15),  @TRXBTCHSRC CHAR(10),  @SERIES SMALLINT,  @WinType TINYINT AS BEGIN  DECLARE @TRANTYPE CHAR(1),  @CHEKNMBR CHAR(21),  @aaSubLedgerHdrID INT,  @create TINYINT,  @AcctLinked INT,  @WinOpen INT,  @DistCnt INT   IF @WinType = 7 OR @WinType=8   BEGIN  SET @TRANTYPE = 'T'  exec ('DECLARE CMREP CURSOR FOR  SELECT TOP 1 ''T'',CB_Transfer_No, '''',0   FROM CB990021  WHERE CB_Transfer_No = ''' + @DOCNUMBR + '''  UNION  SELECT TOP 1 ''T'',CB_Transfer_No, '''',0   FROM CB990023  WHERE CB_Transfer_No = ''' + @DOCNUMBR + '''  UNION ALL  SELECT ''C'',''T''+ltrim(rtrim(''' + @DOCNUMBR + '''))+''/''+CB_BT_CHG_Number, CBKIDCSH,0  FROM CB990021  WHERE CB_Transfer_No = ''' + @DOCNUMBR + ''' and   len(ltrim(rtrim(CB_BT_CHG_Number ))) <> 0  UNION ALL  SELECT ''C'',''T''+ltrim(rtrim(''' + @DOCNUMBR + '''))+''/''+CB_BT_CHG_Number, CHEKBKID,0   FROM CB990023  WHERE CB_Transfer_No = ''' + @DOCNUMBR + ''' and   len(ltrim(rtrim(CB_BT_CHG_Number ))) <> 0')    OPEN CMREP   FETCH NEXT FROM  CMREP INTo @TRANTYPE,@CHEKNMBR,@CHEKBKID,@SERIES  WHILE @@FETCH_STATUS = 0  BEGIN  EXEC aagInitialiseAABMHdr  @TRANTYPE,   @CHEKNMBR,   @CHEKBKID ,   @SERIES,   0,  @aaSubLedgerHdrID output,   @create ,  @AcctLinked,  @WinOpen,   @DistCnt  UPDATE AAG50000 SET TRXBTCHSRC = @TRXBTCHSRC  WHERE aaSubLedgerHdrID = @aaSubLedgerHdrID  UPDATE AAG50001 SET TRXBTCHSRC = @TRXBTCHSRC  WHERE aaSubLedgerHdrID = @aaSubLedgerHdrID   UPDATE AAG50002 SET TRXBTCHSRC = @TRXBTCHSRC  WHERE aaSubLedgerHdrID = @aaSubLedgerHdrID   FETCH NEXT FROM  CMREP INTo @TRANTYPE,@CHEKNMBR,@CHEKBKID,@SERIES  END   CLOSE CMREP  DEALLOCATE CMREP  END  ELSE IF @WinType = 9   BEGIN  SET @aaSubLedgerHdrID = @DOCNUMBR   UPDATE AAG50000 SET TRXBTCHSRC = @TRXBTCHSRC  WHERE aaSubLedgerHdrID = @aaSubLedgerHdrID  UPDATE AAG50001 SET TRXBTCHSRC = @TRXBTCHSRC  WHERE aaSubLedgerHdrID = @aaSubLedgerHdrID   UPDATE AAG50002 SET TRXBTCHSRC = @TRXBTCHSRC  WHERE aaSubLedgerHdrID = @aaSubLedgerHdrID   END END    
GO
GRANT EXECUTE ON  [dbo].[aagUpdateForAABMTransferPostJrnlRpt] TO [DYNGRP]
GO
