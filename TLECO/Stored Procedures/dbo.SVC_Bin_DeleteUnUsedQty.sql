SET QUOTED_IDENTIFIER OFF
GO
SET ANSI_NULLS ON
GO
 Create Procedure [dbo].[SVC_Bin_DeleteUnUsedQty]  (@DocType smallint,  @RecType smallint,  @DocNumber char(20),  @Line numeric(19,5) ) As declare @Sequence int declare @Item char(31) declare @Location char(11) declare @Bin char(15) declare @Qty numeric(19,5)  if @DocType = 1   declare Bin_record cursor for select SEQNUMBR,ITEMNMBR,LOCNCODE,BIN,QUANTITY from SVC00212 where  SRVRECTYPE = @RecType and CALLNBR = @DocNumber and EQPLINE = 1 and LINITMTYP = 'P' and LNITMSEQ = @Line and POSTED = 0 and MKDTOPST = 0 else if @DocType = 3  declare Bin_record cursor for select SEQNUMBR,ITEMNMBR,LOCNCODE,BIN,QUANTITY from SVC05212 where   Return_Record_Type = @RecType and RETDOCID = @DocNumber and LNSEQNBR = @Line and POSTED = 0 else if @DocType = 4  declare Bin_record cursor for select SEQNUMBR,ITEMNMBR,LOCNCODE,BIN,QUANTITY from SVC05612  where RTV_Number = @DocNumber and POSTED = 0 else if @DocType = 5  declare Bin_record cursor for select SEQNUMBR,ITEMNMBR,LOCNCODE,BIN,QUANTITY from SVC06112 where   WORECTYPE = @RecType and WORKORDNUM = @DocNumber and LINITMTYP = 'P' and LNITMSEQ = @Line and POSTED = 0 and MKDTOPST = 0  open Bin_record   fetch next from Bin_record into @Sequence, @Item, @Location, @Bin, @Qty  while @@FETCH_STATUS = 0  begin  update IV00112 set ATYALLOC = ATYALLOC - @Qty where ITEMNMBR = @Item and LOCNCODE = @Location and BIN = @Bin  fetch next from Bin_record into @Sequence, @Item, @Location, @Bin, @Qty  end deallocate Bin_record  if @DocType = 1   delete from SVC00212 where SRVRECTYPE = @RecType and CALLNBR = @DocNumber  and EQPLINE = 1 and LINITMTYP = 'P' and LNITMSEQ = @Line and POSTED = 0 and MKDTOPST = 0 else if @DocType = 2  delete from SVC00712 where ORDDOCID = @DocNumber and LNITMSEQ = @Line and POSTED = 0 else if @DocType = 3  delete from SVC05212 where Return_Record_Type = @RecType and RETDOCID = @DocNumber  and LNSEQNBR = @Line and POSTED = 0 else if @DocType = 4  delete from SVC05612 where RTV_Number = @DocNumber and POSTED = 0 else if @DocType = 5  delete from SVC06112 where WORECTYPE = @RecType and WORKORDNUM = @DocNumber  and LINITMTYP = 'P' and LNITMSEQ = @Line and POSTED = 0 and MKDTOPST = 0  return (0)    
GO
GRANT EXECUTE ON  [dbo].[SVC_Bin_DeleteUnUsedQty] TO [DYNGRP]
GO
