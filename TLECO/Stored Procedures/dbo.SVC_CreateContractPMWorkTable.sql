SET QUOTED_IDENTIFIER OFF
GO
SET ANSI_NULLS ON
GO
 Create Procedure [dbo].[SVC_CreateContractPMWorkTable] (  @BeginCustomer char(15),  @EndCustomer char(15),  @BeginItem char(31),  @EndItem char(31),  @BeginSerial char(21),  @EndSerial char(21),  @BeginSchedule char(9),  @EndSchedule char(9),  @CheckDate datetime ) As SELECT distinct SVC00601.EQUIPID,  case   when (SVC00601.SVC_PM_Date is null) or (SVC00601.SVC_PM_Date = 0) THEN '01/01/1900 00:00:00'  when (SVC00601.SVC_PM_Day is null) or (SVC00601.SVC_PM_Day = 0)  THEN '01/01/1900 00:00:00'  else CONVERT(datetime,(CONVERT(varchar(2),SVC00601.SVC_PM_Date) + '/' +   CONVERT(varchar(2),SVC00601.SVC_PM_Day) + '/' +   CONVERT(varchar(4),DATEPART(yy,@CheckDate)) +   ' 00:00:00'))  end 'SVC_PM_Annual_Date',  SVC8009.SCHEDID,   SVC8009.PMDTLID,   SVC8009.FREQOFPM,  SVC8005.SRVTYPE,  SVC8009.QUANTITY,  SVC8009.SVC_PM_Type,  SVC8009.SVC_Meter_Type,  SVC00601.CONTNBR,  SVC00601.LNSEQNBR INTO #TEMPPMWORK   FROM SVC00601 INNER JOIN  SVC00610 ON (SVC00601.CONSTS = SVC00610.CONSTS and SVC00601.CONTNBR = SVC00610.CONTNBR   and SVC00601.LNSEQNBR = SVC00610.LNSEQNBR) INNER JOIN  SVC00300 ON(SVC00300.EQUIPID = SVC00610.EQUIPID) INNER JOIN  SVC8005 ON (SVC00610.SCHEDID = SVC8005.SCHEDID) INNER JOIN  SVC8009 ON (SVC8005.SCHEDID = SVC8009.SCHEDID)  WHERE   (SVC00601.CUSTNMBR >= @BeginCustomer AND SVC00601.CUSTNMBR <= @EndCustomer) AND   (SVC00601.ITEMNMBR >= @BeginItem AND SVC00601.ITEMNMBR <= @EndItem) AND   (SVC00610.SCHEDID >= @BeginSchedule AND SVC00610.SCHEDID <= @EndSchedule)  AND  (SVC00300.SERLNMBR >= @BeginSerial AND SVC00300.SERLNMBR <= @EndSerial) AND  (SVC00601.STRTDATE <= @CheckDate and SVC00601.ENDDATE >= @CheckDate) AND     (SVC00610.ACTIVE = 1)  delete from SVC00350 where (EQUIPID in (select distinct EQUIPID from #TEMPPMWORK)  and SCHEDID in (select distinct SCHEDID from #TEMPPMWORK)  and PMDTLID in (select distinct PMDTLID from #TEMPPMWORK)) INSERT INTO SVC00350  (EQUIPID, SVC_PM_Annual_Date, SCHEDID, PMDTLID, FREQOFPM, SRVTYPE, QUANTITY, SVC_PM_Type,   SVC_Meter_Type,CONTNBR,LNSEQNBR) select  EQUIPID, SVC_PM_Annual_Date, SCHEDID, PMDTLID, FREQOFPM, SRVTYPE, QUANTITY, SVC_PM_Type,   SVC_Meter_Type,CONTNBR,LNSEQNBR from #TEMPPMWORK drop table #TEMPPMWORK return    
GO
GRANT EXECUTE ON  [dbo].[SVC_CreateContractPMWorkTable] TO [DYNGRP]
GO
