SET QUOTED_IDENTIFIER OFF
GO
SET ANSI_NULLS OFF
GO
 CREATE PROCEDURE [dbo].[aaPortfolio_AAPosting]   @Egreso_numbr as char(20),  @Batch_numbr as char(20),  @User as char(30)  AS  DECLARE   @Ingreso_Num as char(21),   @Doc_numbr as char(21),  @aaSubLedgerHdrID as int,  @aaSubLedgerDistID as int,  @SERIES as char(5),  @DOCTYPE as char(5),  @ACTINDX as int,  @DEBITAMT as numeric(19,5),  @CRDTAMNT as numeric(19,5),  @ORDBTAMT as numeric(19,5),  @ORCRDAMT as numeric(19,5),  @CURNCYID as char(15),  @CURRNIDX as int,  @POSTED as int,  @DEBITAMT2 as numeric(19,5),  @CRDTAMNT2 as numeric(19,5),  @ORDBTAMT2 as numeric(19,5),  @ORCRDAMT2 as numeric(19,5),  @aaSubLedgerAssignID as int  BEGIN  DELETE FROM AAG50000  DELETE FROM AAG50001  DELETE FROM AAG50002   DECLARE AAG20000_Cursor CURSOR FOR   Select aaSubLedgerHdrID,SERIES,DOCTYPE from AAG20000 where DOCNUMBR = @Egreso_numbr  OPEN AAG20000_Cursor   FETCH NEXT FROM AAG20000_Cursor INTO @aaSubLedgerHdrID,@SERIES,@DOCTYPE  WHILE @@FETCH_STATUS = 0   BEGIN   INSERT INTO [dbo].[AAG50000]([USERID],[TRXBTCHSRC],[aaSubLedgerHdrID],[SERIES],[DOCTYPE],[DOCNUMBR],[PSTGDATE],[aaOrder])   VALUES (@User,@Batch_numbr,@aaSubLedgerHdrID,@SERIES,@DOCTYPE,@Egreso_numbr,'',1)   DECLARE AAG20001_Cursor CURSOR FOR   Select aaSubLedgerDistID,ACTINDX,DEBITAMT,CRDTAMNT,ORDBTAMT,ORCRDAMT,CURNCYID,CURRNIDX,POSTED  from AAG20001 where aaSubLedgerHdrID = @aaSubLedgerHdrID  OPEN AAG20001_Cursor   FETCH NEXT FROM AAG20001_Cursor INTO @aaSubLedgerDistID,@ACTINDX,@DEBITAMT,@CRDTAMNT,@ORDBTAMT,@ORCRDAMT,@CURNCYID,@CURRNIDX,@POSTED  WHILE @@FETCH_STATUS = 0   BEGIN  INSERT INTO [dbo].[AAG50001]([USERID],[TRXBTCHSRC],[SERIES],[aaSubLedgerHdrID],[aaSubLedgerDistID],[ACTINDX],[DEBITAMT],  [CRDTAMNT],[ORDBTAMT],[ORCRDAMT],[CURNCYID],[CURRNIDX],[POSTED])  VALUES (@User,@Batch_numbr,@SERIES,@aaSubLedgerHdrID,@aaSubLedgerDistID,@ACTINDX,@DEBITAMT,@CRDTAMNT,@ORDBTAMT,@ORCRDAMT,@CURNCYID,  @CURRNIDX,@POSTED)   DECLARE AAG20002_Cursor CURSOR FOR   Select aaSubLedgerAssignID,DEBITAMT,CRDTAMNT,ORDBTAMT,ORCRDAMT  from AAG20002 where aaSubLedgerHdrID = @aaSubLedgerHdrID and aaSubLedgerDistID = @aaSubLedgerDistID  OPEN AAG20002_Cursor   FETCH NEXT FROM AAG20002_Cursor INTO @aaSubLedgerAssignID,@DEBITAMT2,@CRDTAMNT2,@ORDBTAMT2,@ORCRDAMT2  WHILE @@FETCH_STATUS = 0   BEGIN  INSERT INTO [dbo].[AAG50002]([USERID],[TRXBTCHSRC],[SERIES],[aaSubLedgerHdrID],[aaSubLedgerDistID],[aaSubLedgerAssignID],[DEBITAMT],  [CRDTAMNT],[ORDBTAMT],[ORCRDAMT])  VALUES (@User,@Batch_numbr,@SERIES,@aaSubLedgerHdrID,@aaSubLedgerDistID,@aaSubLedgerAssignID,@DEBITAMT2,@CRDTAMNT2,  @ORDBTAMT2,@ORCRDAMT2)   FETCH NEXT FROM AAG20002_Cursor INTO @aaSubLedgerAssignID,@DEBITAMT2,@CRDTAMNT2,@ORDBTAMT2,@ORCRDAMT2  END  CLOSE AAG20002_Cursor   DEALLOCATE AAG20002_Cursor    FETCH NEXT FROM AAG20001_Cursor INTO @aaSubLedgerDistID,@ACTINDX,@DEBITAMT,@CRDTAMNT,@ORDBTAMT,@ORCRDAMT,@CURNCYID,@CURRNIDX,@POSTED  END  CLOSE AAG20001_Cursor   DEALLOCATE AAG20001_Cursor    FETCH NEXT FROM AAG20000_Cursor INTO @aaSubLedgerHdrID,@SERIES,@DOCTYPE  END  CLOSE AAG20000_Cursor   DEALLOCATE AAG20000_Cursor  END    
GO
GRANT EXECUTE ON  [dbo].[aaPortfolio_AAPosting] TO [DYNGRP]
GO
