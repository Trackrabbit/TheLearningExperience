SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO
 CREATE   procedure [dbo].[aagDeriveParentDimCodeAlias]  @I_nTrxDimID   int = 0,  @I_nTrxDCodeID int = 0,  @I_cTableCodeAliasDimTemp1  varchar(30) = null,  @I_cTableCodeAliasDimTemp2  varchar(30) = null output,  @O_cParentTrxDim  varchar(16)= '' output,  @O_cParentTrxDimCode  varchar(31) ='' output,  @O_nDimInactive tinyint = 0 output,  @O_nCodeInactive tinyint = 0 output,  @O_nDataEntry tinyint = 0 output  as   exec ('truncate TABLE ' + @I_cTableCodeAliasDimTemp2 )   exec ('insert into ' + @I_cTableCodeAliasDimTemp2 + ' select aaTrxDimID, aaTrxDim, aaOrder, aaTrxDimCodeID,aaTrxDimCode, aaTrxDimCodeDescr, aaDataType, aaInactive from ' + @I_cTableCodeAliasDimTemp1 + ' where aaDataType = 1')   begin   declare   @cTrxDimID int,   @cTrxCodeID int,   @cParentTrxDimID int,   @cParentTrxDimCodeID int,   @cParentTrxDimCodeDesc char(51)   set @cTrxDimID = @I_nTrxDimID   set @cTrxCodeID = @I_nTrxDCodeID   set @O_cParentTrxDim = space(0)   set @O_cParentTrxDimCode = space(0)   WHILE (@cTrxDimID <> 0 and  @cTrxCodeID <> 0)   begin   exec   aagDeriveParentDimCode   @cTrxDimID,   @cTrxCodeID,  @cParentTrxDimID output,   @cParentTrxDimCodeID output,   @O_cParentTrxDim output,   @O_cParentTrxDimCode output,   @cParentTrxDimCodeDesc output   if (@cParentTrxDimID = 0 or  @cParentTrxDimCodeID = 0)   return   else   if (select INACTIVE from AAG00400 where aaTrxDimID = @cParentTrxDimID) = 1   begin   set @O_nDimInactive = 1   return   end   else   if (select INACTIVE from AAG00401 where aaTrxDimID = @cParentTrxDimID   and aaTrxDimCodeID = @cParentTrxDimCodeID) = 1   begin   set @O_nCodeInactive = 1   return   end   begin   exec ('update ' + @I_cTableCodeAliasDimTemp2 +  ' set aaTrxDimCodeID ='''  + @cParentTrxDimCodeID +  ''',aaTrxDim = ''' + @O_cParentTrxDim +  ''', aaTrxDimCode = ''' + @O_cParentTrxDimCode +   ''', aaTrxDimCodeDescr = ''' + @cParentTrxDimCodeDesc +  '''  where aaTrxDimID = ' + @cParentTrxDimID)   set @cTrxDimID = @cParentTrxDimID   set @cTrxCodeID = @cParentTrxDimCodeID   end   end   end   return    
GO
GRANT EXECUTE ON  [dbo].[aagDeriveParentDimCodeAlias] TO [DYNGRP]
GO
