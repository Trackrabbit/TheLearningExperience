SET QUOTED_IDENTIFIER OFF
GO
SET ANSI_NULLS ON
GO
create procedure [dbo].[PC_GetSeatPositionAmountsToDate]  @v_PYRNTYPE smallint,   @v_Plan char(15),  @v_JobTitle char(6),   @v_StartDate datetime,  @v_PYADNMBR int,   @v_AUCTRLCD char(13),   @v_EmployID char(15),  @v_SSTaxPos numeric(19,5) output,   @v_MedTaxPos numeric(19,5) output,   @v_BenefitPos numeric(19,5) output,   @v_PayPos numeric(19,5) output  As  set nocount on  Begin  Declare   @StartDate datetime,   @PYADNMBR int,   @AUCTRLCD char(13),   @SSTaxTotalOnCheck numeric(19,5),   @MedTaxTotalOnCheck numeric(19,5),   @SSWageTotalOnCheck numeric(19,5),   @MedWageTotalOnCheck numeric(19,5),   @TrnMedAmt numeric(19,5),   @MedTaxRate numeric(19,5),   @SSTaxPos numeric(19,5),   @MedTaxPos numeric(19,5),   @BenefitPos numeric(19,5),   @PayPos numeric(19,5) Set @v_BenefitPos = 0  Set @v_SSTaxPos = 0  Set @v_MedTaxPos = 0  Set @v_PayPos = 0  Set @StartDate = @v_StartDate  if @StartDate = '1/1/1900' or @StartDate is null   Select @StartDate = isnull(min(STRTDATE), '1/1/1900')   From PC40306   Where PLANCODE = @v_Plan and JOBTITLE = @v_JobTitle  Declare CheckRcd Cursor For   Select   a.PYADNMBR,  a.AUCTRLCD,  sum(FCASWPR + FICSTPTX),   Sum(FICAMWPR + FICMTPTX),   sum(FICASSWP + FICASS_TipsPay_Run),  sum(FICAMWGP + FICAMed_TipsPay_Run)   From UPR30100 a   inner join (Select PYADNMBR, AUCTRLCD From UPR30300 Where PYRLRTYP = 1 and JOBTITLE = @v_JobTitle   Group By PYADNMBR, AUCTRLCD) f on a.PYADNMBR = f.PYADNMBR and a.AUCTRLCD = f.AUCTRLCD   Where POSTEDDT >= @StartDate and  a.EMPLOYID = @v_EmployID and   (case @v_AUCTRLCD   When '' Then  ''  else  VOIDED   End) =   (Case @v_PYRNTYPE  When 2 Then  1   When 1 Then  0   Else  ''  End)   And (case @v_AUCTRLCD   When '' Then  ''  else  a.AUCTRLCD   End) =   (case @v_AUCTRLCD   When '' Then   ''   else  @v_AUCTRLCD  End)  And (case @v_PYADNMBR   When 0 Then  0  else  a.PYADNMBR   End) =   (case @v_PYADNMBR   When 0 Then   ''   else  @v_PYADNMBR  End)   Group By a.PYADNMBR, a.AUCTRLCD  Open CheckRcd  Fetch Next From CheckRcd  Into @PYADNMBR, @AUCTRLCD, @SSTaxTotalOnCheck, @MedTaxTotalOnCheck, @SSWageTotalOnCheck, @MedWageTotalOnCheck  WHILE @@FETCH_STATUS = 0   BEGIN   Select  @v_SSTaxPos = @v_SSTaxPos + sum(SSTaxPos),   @v_MedTaxPos = @v_MedTaxPos + Sum(MedTaxPos),   @v_BenefitPos = @v_BenefitPos + Sum(BenefitPos),   @v_PayPos = @v_PayPos + sum(PayPos)   From dbo.PC_ProcessCheckAmounts(  @PYADNMBR,   @AUCTRLCD,   @v_EmployID,   @SSTaxTotalOnCheck,   @MedTaxTotalOnCheck,   @SSWageTotalOnCheck,   @MedWageTotalOnCheck,  @v_JobTitle)  Fetch NEXT From CheckRcd  Into @PYADNMBR, @AUCTRLCD, @SSTaxTotalOnCheck,   @MedTaxTotalOnCheck, @SSWageTotalOnCheck, @MedWageTotalOnCheck  End  Close CheckRcd  Deallocate CheckRcd End    
GO
GRANT EXECUTE ON  [dbo].[PC_GetSeatPositionAmountsToDate] TO [DYNGRP]
GO
