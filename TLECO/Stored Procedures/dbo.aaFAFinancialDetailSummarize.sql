SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO
CREATE PROC [dbo].[aaFAFinancialDetailSummarize]  @I_FromYear SMALLINT,  @I_FromPeriod SMALLINT,  @I_ToYear SMALLINT,  @I_ToPeriod SMALLINT AS BEGIN DECLARE  @FINANCIALINDX INTEGER, @aaSubLedgerHdrID INTEGER, @aaSubLedgerDistID INTEGER, @aaSubLedgerHdrID1 INTEGER, @oStatus BIT  SELECT 1 aaSubLedgerHdrID INTO #TEMP1 WHERE 1 = 2   DECLARE FASummarize CURSOR FAST_FORWARD FOR  SELECT FINANCIALINDX FROM FA00902 WHERE FAYEAR BETWEEN @I_FromYear AND @I_ToYear AND FAPERIOD BETWEEN @I_ToYear AND @I_ToPeriod  OPEN FASummarize  FETCH NEXT FROM FASummarize   INTO @FINANCIALINDX  WHILE @@FETCH_STATUS = 0  BEGIN  SELECT @aaSubLedgerHdrID = aaSubLedgerHdrID, @aaSubLedgerDistID = aaSubLedgerDistID FROM AAG20001 WHERE TRXNUMBER = @FINANCIALINDX  INSERT INTO #TEMP1 Values(@aaSubLedgerHdrID)  DELETE FROM AAG20001 WHERE aaSubLedgerHdrID = @aaSubLedgerHdrID AND aaSubLedgerDistID = @aaSubLedgerDistID  DELETE FROM AAG20002 WHERE aaSubLedgerHdrID = @aaSubLedgerHdrID AND aaSubLedgerDistID = @aaSubLedgerDistID  DELETE FROM AAG20003 WHERE aaSubLedgerHdrID = @aaSubLedgerHdrID AND aaSubLedgerDistID = @aaSubLedgerDistID   FETCH NEXT FROM FASummarize   INTO @FINANCIALINDX  END  CLOSE FASummarize  DEALLOCATE FASummarize    DELETE FROM AAG20000 WHERE aaSubLedgerHdrID IN (SELECT DISTINCT aaSubLedgerHdrID #TEMP1) AND aaSubLedgerHdrID   NOT IN (SELECT DISTINCT aaSubLedgerHdrID FROM AAG20001 WHERE aaSubLedgerHdrID IN (SELECT DISTINCT aaSubLedgerHdrID #TEMP1))    DECLARE AARenumber CURSOR FAST_FORWARD FOR  SELECT DISTINCT aaSubLedgerHdrID FROM #TEMP1  OPEN AARenumber  FETCH NEXT FROM AARenumber   INTO @aaSubLedgerHdrID1  WHILE @@FETCH_STATUS = 0  BEGIN  IF EXISTS (SELECT TOP 1 1 FROM AAG20001 WHERE aaSubLedgerHdrID = @aaSubLedgerHdrID1)  EXEC aagRenumberAADistsALL @aaSubLedgerHdrID1,@oStatus OUTPUT  FETCH NEXT FROM AARenumber   INTO @aaSubLedgerHdrID1  END  CLOSE AARenumber  DEALLOCATE AARenumber   END   
GO
GRANT EXECUTE ON  [dbo].[aaFAFinancialDetailSummarize] TO [DYNGRP]
GO
