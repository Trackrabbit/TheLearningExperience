SET QUOTED_IDENTIFIER OFF
GO
SET ANSI_NULLS ON
GO
 create procedure [dbo].[glVerifyTaxDate]  @I_tPosting tinyint  = NULL,  @I_tUseTaxPeriods       tinyint         = NULL,  @I_dTaxDate             datetime        = NULL,  @I_sHdrTransactionType smallint = NULL,  @IO_bHeaderMessages2    binary(4)       = NULL  output,  @O_iErrorState          int             = NULL  output  as  declare  @dMinDate datetime,  @TRUE                           tinyint,  @MS_ITEM_13                     int,  @MS_ITEM_14                     int,  @MS_ITEM_15                     int,  @MS_ITEM_16                     int,  @tClosed tinyint,  @dYear int,  @nError int,  @REVERSING smallint,  @iStatus                 int  exec @iStatus = smGetMinDate @dMinDate output  select          @O_iErrorState  = 0  if      ( ( @I_dTaxDate is NULL ) or  ( @I_tPosting is NULL ) or  ( @I_tUseTaxPeriods is NULL ) or  ( @I_sHdrTransactionType is NULL ) or  ( @IO_bHeaderMessages2 is NULL ) )   select          @O_iErrorState = 21090  select  @TRUE                   = 1,  @REVERSING  = 1,  @MS_ITEM_13             = power(2, 20),  @MS_ITEM_14             = power(2, 21),  @MS_ITEM_15             = power(2, 22),  @MS_ITEM_16             = power(2, 23)  if @I_tUseTaxPeriods = @TRUE and @I_dTaxDate <> @dMinDate begin  select   @dYear = YEAR1  from  SY40103  where  FSTFSCDY <= @I_dTaxDate  and LSTFSCDY >= @I_dTaxDate  select @nError = @@rowcount  if @nError <> 1  begin   if (@I_sHdrTransactionType = @REVERSING)  select @IO_bHeaderMessages2 = (@IO_bHeaderMessages2 | @MS_ITEM_16)  else  select @IO_bHeaderMessages2 = (@IO_bHeaderMessages2 | @MS_ITEM_14)  if (@I_tPosting = @TRUE)  select @O_iErrorState = 21089  return  end    select  @tClosed     = PSERIES_1  from   SY40102  where  PERIODID > 0 and  PERIODDT =  (select  max(PERIODDT)  from  SY40102  where  PERIODDT <= @I_dTaxDate and  PERIODID > 0)   if @tClosed is NULL  select          @O_iErrorState = 21091   if @tClosed = @TRUE  begin  if (@I_sHdrTransactionType = @REVERSING)  select @IO_bHeaderMessages2 = (@IO_bHeaderMessages2 | @MS_ITEM_15)  else  select @IO_bHeaderMessages2 = (@IO_bHeaderMessages2 | @MS_ITEM_13)   if (@I_tPosting = @TRUE)  select @O_iErrorState = 21088  end  end  return    
GO
GRANT EXECUTE ON  [dbo].[glVerifyTaxDate] TO [DYNGRP]
GO
