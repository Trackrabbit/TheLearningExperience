SET QUOTED_IDENTIFIER OFF
GO
SET ANSI_NULLS ON
GO
 create         PROCEDURE [dbo].[aagRenumberAADistsALL]  @iHdrID int,  @oStatus smallint = NULL out AS  declare @transaction tinyint,  @retCode int,  @dbName varchar(32),  @companyID smallint,  @companyStatus smallint,  @DistID int,  @SeqNum bigint,  @NextDistID int,  @TempDistID int,  @DistIDINSPos int ,  @ID int   select  @transaction = 0,  @retCode = 0,  @dbName = '',  @companyID = 0,  @companyStatus = 0,  @DistID = 0,  @SeqNum = 0  if (@iHdrID is NULL) begin select @oStatus = 35000 return end  if (@iHdrID = 0) begin select @oStatus = 35001 return end  select @dbName = db_name() exec @retCode = DYNAMICS.dbo.aagGetCompanyStatus @dbName, @companyID out, @companyStatus out, @oStatus out if ((@retCode <> 0) or (@oStatus <> 0)) return @retCode  if (@@trancount = 0)  begin   select @transaction = 1   begin transaction  end  Update AAG20003  Set aaSubLedgerDistID = aaSubLedgerDistID * -1 Where aaSubLedgerHdrID = @iHdrID  Update AAG20002  Set aaSubLedgerDistID = aaSubLedgerDistID * -1 Where aaSubLedgerHdrID = @iHdrID  Update AAG20001  Set aaSubLedgerDistID = aaSubLedgerDistID * -1 Where aaSubLedgerHdrID = @iHdrID  DECLARE Cur1 cursor fast_forward FOR SELECT aaSubLedgerDistID FROM AAG20001 Where aaSubLedgerHdrID = @iHdrID Order by SEQNUMBR, aaOffsetAcct OPEN Cur1   FETCH NEXT FROM Cur1 INTO @DistID  select @ID = 1 while @@FETCH_STATUS = 0 Begin    Update AAG20003   Set aaSubLedgerDistID = @ID  Where aaSubLedgerHdrID = @iHdrID and aaSubLedgerDistID = @DistID  IF @@error <> 0  goto errlbl   Update AAG20002   Set aaSubLedgerDistID = @ID  Where aaSubLedgerHdrID = @iHdrID and aaSubLedgerDistID = @DistID  IF @@error <> 0  goto errlbl  Update AAG20001   Set aaSubLedgerDistID = @ID  Where aaSubLedgerHdrID = @iHdrID and aaSubLedgerDistID = @DistID  IF @@error <> 0  goto errlbl  set @ID = @ID + 1   FETCH NEXT FROM Cur1 INTO @DistID End  errlbl:  close Cur1  deallocate Cur1   if (@transaction = 1)  and @@error  = 0   Begin   commit transaction   return 0  End  Else  Begin  Rollback  return @@error  End    
GO
GRANT EXECUTE ON  [dbo].[aagRenumberAADistsALL] TO [DYNGRP]
GO
