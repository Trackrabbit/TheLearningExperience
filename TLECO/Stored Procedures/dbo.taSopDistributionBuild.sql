SET QUOTED_IDENTIFIER OFF
GO
SET ANSI_NULLS ON
GO
 create procedure [dbo].[taSopDistributionBuild]  @I_vSOPTYPE  smallint = 0,   @I_vSOPNUMBE  char(21),    @I_vCUSTNMBR  char(15),   @I_vITEMNMBR  char(30),   @I_vINDEX  int,    @I_vDTSAMT  numeric(19,5), @I_vCTSAMT  numeric(19,5), @I_vORDTSAMT  numeric(19,5), @I_vORCTSAMT  numeric(19,5), @I_vTYPE  int, @I_vCURRNIDX  int, @O_iErrorState  int = NULL output, @oErrString  varchar(255) output   with encryption as  set transaction isolation level read uncommitted set nocount on  declare   @iStatus int,  @iError int,  @O_oErrorState int  select @O_iErrorState = 0,  @iStatus = 0,  @O_oErrorState = 0  if (  @I_vSOPTYPE is NULL or   @I_vSOPNUMBE is NULL or   @I_vCUSTNMBR is NULL or   @I_vDTSAMT is NULL or   @I_vORDTSAMT is NULL or   @I_vTYPE  is NULL or   @I_vCTSAMT is NULL or  @I_vORCTSAMT is NULL or  @I_vCURRNIDX is NULL or  @I_vINDEX is NULL) begin  select @O_iErrorState = 1201    return (@O_iErrorState) end  select @I_vSOPNUMBE = UPPER(@I_vSOPNUMBE),  @I_vCUSTNMBR = UPPER(@I_vCUSTNMBR)  if (  @I_vSOPTYPE = 0 or   @I_vSOPNUMBE = '') begin  select @O_iErrorState = 1202     return (@O_iErrorState) end  if ((@I_vDTSAMT > 0) or (@I_vCTSAMT > 0)) begin  if @I_vINDEX = 0  begin  exec @iStatus = taSopAuxAcctsGetIdx  @I_vSOPTYPE,  @I_vSOPNUMBE,  @I_vCUSTNMBR,  @I_vITEMNMBR,   @I_vTYPE ,  @I_vINDEX output,  @O_oErrorState output  select @iError = @@error  if @iStatus = 0 and @iError <> 0  select @iStatus = @iError  if (@iStatus <> 0) or (@O_oErrorState <> 0)  begin  select @O_iErrorState = 1203    return (@O_iErrorState)  end  end   exec @iStatus = taSopDistributionInsert  @I_vSOPTYPE,  @I_vSOPNUMBE,  @I_vINDEX,  @I_vDTSAMT,  @I_vCTSAMT,  @I_vORDTSAMT,  @I_vORCTSAMT,  @I_vTYPE,  @I_vCURRNIDX,  '',  '',  @O_oErrorState output,  @oErrString  output  select @iError = @@error  if @iStatus = 0 and @iError <> 0  select @iStatus = @iError  if (@iStatus <> 0) or (@O_oErrorState <> 0)  begin  select @O_iErrorState = 1204    return (@O_iErrorState)  end end  return (@O_iErrorState)   
GO
GRANT EXECUTE ON  [dbo].[taSopDistributionBuild] TO [DYNGRP]
GO
