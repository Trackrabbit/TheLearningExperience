SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO
 Create Procedure [dbo].[SVC_Get_Item_CostPrice] (  @ItemNumber char(30),  @PriceLevel char(11),  @Qty numeric(19,5),  @UOM char(9) output,  @ListPrice numeric(19,5) output,  @ItemCost numeric(19,5) output) As  declare @Curr char(15), @Price numeric(19,5), @CurrencyPrice numeric(19,5),  @ItemPriceLevel char(11),@PriceMethod smallint,@UOMSchedule char(11),  @CurrentCost numeric(19,5), @StandardCost numeric(19,5),  @QtyInBase numeric(19,5), @DecimalPlaceCurrency smallint if @Qty <= 0 select @Qty = 1 select @Curr=FUNLCURR from MC40000 select @UOMSchedule=UOMSCHDL,@ItemPriceLevel = PRCLEVEL, @DecimalPlaceCurrency = DECPLCUR,  @CurrentCost = CURRCOST, @StandardCost = STNDCOST, @PriceMethod = PRICMTHD  from IV00101 where ITEMNMBR = @ItemNumber if @UOM is null or @UOM = ''  select @UOM = BASEUOFM from IV40201 where UOMSCHDL = @UOMSchedule if @PriceLevel = '' or @PriceLevel is null  select @PriceLevel = @ItemPriceLevel if @PriceLevel = '' or @PriceLevel is null  select @PriceLevel = PRCLEVEL from RM40101 select @CurrencyPrice = LISTPRCE from IV00105 where ITEMNMBR = @ItemNumber and CURNCYID = @Curr select @Price =UOMPRICE from IV00108 where ITEMNMBR = @ItemNumber  and UOFM = @UOM and CURNCYID = @Curr and PRCLEVEL = @PriceLevel and @Qty <= TOQTY  and @Qty >=FROMQTY exec SVC_Get_QtyInBase @ItemNumber, @UOM, 1,@QtyInBase OUTPUT  if @DecimalPlaceCurrency >0 select @DecimalPlaceCurrency = @DecimalPlaceCurrency -1 select @ItemCost = @CurrentCost select @ListPrice = case @PriceMethod  when 1  then @Price   when 2 then  round(@Price * @CurrencyPrice * @QtyInBase/ 100.0, @DecimalPlaceCurrency)  when 3  then  round(@CurrentCost * @QtyInBase * (@Price/100.0 + 1.0) , @DecimalPlaceCurrency)  when 4  then  round (@StandardCost * @QtyInBase * (@Price/100.0 + 1.0) , @DecimalPlaceCurrency)  when 5  then  round (@CurrentCost * @QtyInBase * (100.0 /(100.0 - @Price)) , @DecimalPlaceCurrency)  when 6  then  round (@StandardCost * @QtyInBase * (100.0 /(100.0 - @Price)) , @DecimalPlaceCurrency) END  if @ListPrice is null  select @ListPrice = 0  return   
GO
GRANT EXECUTE ON  [dbo].[SVC_Get_Item_CostPrice] TO [DYNGRP]
GO
