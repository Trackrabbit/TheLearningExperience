SET QUOTED_IDENTIFIER OFF
GO
SET ANSI_NULLS ON
GO
 create procedure [dbo].[glUpdateAccountIndexMaster]  @O_SQL_Error_State int    = NULL   output as  declare  @Length_Of_Segment smallint,  @cSeperator char(1),  @End_String_Pos   int,  @String_Position int,  @cColumn char(25),  @cLength_Of_Segment  char(3),  @cEnd_String_Pos char(3),  @tNumberSegments tinyint,  @tLoopCount tinyint,  @cSelectList varchar(255)  select @O_SQL_Error_State = 0  select   @cSeperator = ACSEGSEP from  DYNAMICS..SY01500 where  INTERID = db_name()    select  @tNumberSegments = count(*) from  SY00300  select @cSelectList = ''  declare Account_Format insensitive CURSOR FOR select  LOFSGMNT  from  SY00300  order by SGMTNUMB  OPEN Account_Format  FETCH NEXT FROM  Account_Format into  @Length_Of_Segment  select  @String_Position = 1,  @End_String_Pos = 0,  @tLoopCount = 1  while @@FETCH_STATUS = 0 begin  select @cColumn = 'ACTNUMBR_' + ltrim(str(@tLoopCount))  select @cEnd_String_Pos  = convert (char(3),@End_String_Pos)  select @cLength_Of_Segment = convert(char(3),@Length_Of_Segment)  if @tLoopCount < @tNumberSegments  begin  exec (' update  #AccountIndex  set  ACTNUMST = substring(ACTNUMST, 1,' + @cEnd_String_Pos + ' )   + substring(' + @cColumn + ', 1,' + @cLength_Of_Segment +  ')   + ''' + @cSeperator + '''  from  GL00100  where  GL00100.ACTINDX = #AccountIndex.ACTINDX')   select @cSelectList = @cSelectList + @cColumn + ','  end  else  begin  exec (' update  #AccountIndex  set  ACTNUMST = substring(ACTNUMST, 1,' + @cEnd_String_Pos + ' )   + substring(' + @cColumn + ', 1,' + @cLength_Of_Segment + ')  from  GL00100  where  GL00100.ACTINDX = #AccountIndex.ACTINDX')   select @cSelectList = @cSelectList + @cColumn  end   select @tLoopCount = @tLoopCount + 1   select @End_String_Pos  = @End_String_Pos + @Length_Of_Segment + 1   FETCH NEXT FROM Account_Format  into  @Length_Of_Segment end  DEALLOCATE Account_Format  delete  GL00105 from  #AccountIndex where  GL00105.ACTINDX = #AccountIndex.ACTINDX  exec(' insert into  GL00105  (ACTINDX,  ACTNUMST,  ' + @cSelectList + ')  select  #AccountIndex.ACTINDX,  #AccountIndex.ACTNUMST,  ' + @cSelectList +   ' from  GL00100,  #AccountIndex  where  GL00100.ACTINDX = #AccountIndex.ACTINDX') return    
GO
GRANT EXECUTE ON  [dbo].[glUpdateAccountIndexMaster] TO [DYNGRP]
GO
