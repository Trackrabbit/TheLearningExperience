SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO
 create  procedure [dbo].[aagCreateDistforAABMRecurringBatch]  @CB_Trans_Type char(1),  @SERIES smallint,   @DOCNUMBRORG char(21),  @DOCNUMBR char(21),  @CHEKBKID char(31),  @CMPANYID smallint,  @aaSubLedgerHdrID  int output as begin  declare @create tinyint,  @AcctLinked int,  @WinOpen int,   @DistCnt int,  @aaSubLedgerHdrIDORG int   select  @create   = 0,  @AcctLinked  = 0,  @WinOpen  = 0,   @DistCnt  = 0,  @aaSubLedgerHdrIDORG = 0   exec aagInitialiseAABMHdr   @CB_Trans_Type,   @DOCNUMBRORG,   @CHEKBKID ,   @SERIES,   @CMPANYID,   @aaSubLedgerHdrIDORG output,  @create ,  @AcctLinked,  @WinOpen,   @DistCnt    select @create = 1  exec aagInitialiseAABMHdr   @CB_Trans_Type,   @DOCNUMBR,   @CHEKBKID ,   @SERIES,   @CMPANYID,   @aaSubLedgerHdrID output,  @create ,  @AcctLinked,  @WinOpen,   @DistCnt    insert into AAG20001   (aaSubLedgerHdrID,aaSubLedgerDistID,INTERID,CorrespondingUnit,ACTINDX,DISTTYPE,  ACCTTYPE,aaBrowseType,DECPLACS,DEBITAMT,CRDTAMNT,ORDBTAMT,ORCRDAMT,CURNCYID,CURRNIDX,  RATETPID,EXGTBLID,XCHGRATE,EXCHDATE,TIME1,RTCLCMTD,DENXRATE,MCTRXSTT,SEQNUMBR,GLPOSTDT,  aaCustID,aaVendID,aaSiteID,aaItemID,aaCopyStatus,aaWinWasOpen,POSTED,HISTORY,aaDistErrors,  APTVCHNM,APTODCTY,aaFutureDist,aaOffsetAcct,ITEMNMBR,TRXLOCTN,BINNMBR,TRNSTLOC,TRXQTY  ,aaChangeDate, aaChangeTime)  select @aaSubLedgerHdrID,aaSubLedgerDistID,INTERID,CorrespondingUnit,ACTINDX,DISTTYPE,  ACCTTYPE,aaBrowseType,DECPLACS,DEBITAMT,CRDTAMNT,ORDBTAMT,ORCRDAMT,CURNCYID,CURRNIDX,  RATETPID,EXGTBLID,XCHGRATE,EXCHDATE,TIME1,RTCLCMTD,DENXRATE,MCTRXSTT,SEQNUMBR,GLPOSTDT,  aaCustID,aaVendID,aaSiteID,aaItemID,aaCopyStatus,aaWinWasOpen,POSTED,HISTORY,aaDistErrors,  APTVCHNM,APTODCTY,aaFutureDist,aaOffsetAcct,ITEMNMBR,TRXLOCTN,BINNMBR,TRNSTLOC,TRXQTY,  convert(char(12), getdate(), 102), convert(char(12), getdate(), 108)  from AAG20001 where aaSubLedgerHdrID = @aaSubLedgerHdrIDORG and aaSubLedgerDistID > 0   insert into AAG20002  (aaSubLedgerHdrID,aaSubLedgerDistID,aaSubLedgerAssignID,DEBITAMT,CRDTAMNT,ORDBTAMT,ORCRDAMT,  aaAssignedPercent,DistRef,NOTEINDX,aaAssignErrors,aaAliasID)  select @aaSubLedgerHdrID,aaSubLedgerDistID,aaSubLedgerAssignID,DEBITAMT,CRDTAMNT,ORDBTAMT,ORCRDAMT,  aaAssignedPercent,DistRef,NOTEINDX,aaAssignErrors,aaAliasID from AAG20002   where aaSubLedgerHdrID = @aaSubLedgerHdrIDORG and aaSubLedgerDistID > 0 and  aaSubLedgerAssignID > 0  insert into AAG20003   (aaSubLedgerHdrID,aaSubLedgerDistID,aaSubLedgerAssignID,aaTrxDimID,aaTrxCodeID,aaCodeErrors)  select @aaSubLedgerHdrID,aaSubLedgerDistID,aaSubLedgerAssignID,aaTrxDimID,aaTrxCodeID,aaCodeErrors  from AAG20003 where aaSubLedgerHdrID = @aaSubLedgerHdrIDORG and aaSubLedgerDistID > 0 and   aaSubLedgerAssignID > 0 and aaTrxDimID > 0   update AAG50000 set DOCNUMBR = @DOCNUMBR where aaSubLedgerHdrID = @aaSubLedgerHdrIDORG end    
GO
GRANT EXECUTE ON  [dbo].[aagCreateDistforAABMRecurringBatch] TO [DYNGRP]
GO
