SET QUOTED_IDENTIFIER OFF
GO
SET ANSI_NULLS OFF
GO
 create procedure [dbo].[erInternalParseSegmentList]  @list_of_segments varchar(255)=NULL,  @internal_seg_list varchar(255)=NULL OUT,  @sort_order varchar(255)=NULL OUT,  @num_segments tinyint=NULL OUT as  declare   @cIndex char(2),  @vTemp varchar(255),  @iNum integer,  @iTempPos integer,  @bDone bit,  @cTwoCharTemp char(2),  @bFirstSortColumn bit,  @tLoopControl tinyint  set nocount on  select @bFirstSortColumn = 1  select  @num_segments = count(*) from  SY00300  if @list_of_segments is null begin  select @internal_seg_list = replicate('1',255)   select @tLoopControl = 1  while @tLoopControl <= @num_segments  begin  select @cTwoCharTemp =  ltrim(str(@tLoopControl))  if @bFirstSortColumn = 1  begin  select @sort_order = 'ACTNUMBR_' + @cTwoCharTemp  select @bFirstSortColumn = 0  end  else  begin  select @sort_order = @sort_order + ',ACTNUMBR_' + @cTwoCharTemp  end  select @tLoopControl = @tLoopControl + 1  end end else begin  select @vTemp = @list_of_segments  select @internal_seg_list = space(255)   select @iTempPos = charindex(',',@vTemp)  select @bDone = 0   while @bDone <> 1   begin  if @iTempPos = 0  begin  select @iTempPos = len(@vTemp)+1  select @bDone = 1  end   if len(ltrim(substring(@vTemp,1,@iTempPos-1))) > 2  begin  return -1  end   select @cTwoCharTemp = rtrim(ltrim(substring(@vTemp,1,@iTempPos-1)))  if patindex('%[ 0-9]%',@cTwoCharTemp)+patindex('%[ 0-9]%',substring(@cTwoCharTemp,2,1)) <> 2  begin  return -1  end   select @iNum = convert(integer,@cTwoCharTemp)   if @iNum is null  begin  return -1  end  if @iNum not in (select SGMTNUMB from SY00300)  begin  return -2  end   select @internal_seg_list = stuff(@internal_seg_list,@iNum,1,'1')   if @bFirstSortColumn = 1  begin  select @sort_order = 'ACTNUMBR_' + @cTwoCharTemp  select @bFirstSortColumn = 0  end  else  begin  select @sort_order = @sort_order + ',ACTNUMBR_' + @cTwoCharTemp  end   select @vTemp = substring(@vTemp,@iTempPos+1,255)   select @iTempPos = charindex(',',@vTemp)  end end  return 0    
GO
GRANT EXECUTE ON  [dbo].[erInternalParseSegmentList] TO [DYNGRP]
GO
