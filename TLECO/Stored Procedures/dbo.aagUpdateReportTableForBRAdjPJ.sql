SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO
 create         procedure [dbo].[aagUpdateReportTableForBRAdjPJ]   @USERID char(15),   @UDate datetime,  @Master_ID char(31),  @TRXBTCHSRC char(51) as begin  declare @aaSubLedgerHdrID int,  @lDocType int,  @DocNum char(21),  @isval tinyint,  @POSTED int    delete AAG50000   delete AAG50001  delete AAG50002   declare CHdr cursor fast_forward for  Select Hdr.aaSubLedgerHdrID, Hdr.DOCTYPE, Hdr.DOCNUMBR, Dist.POSTED  from AAG20000 as Hdr , AAG20001 as Dist  where  Dist.aaSubLedgerHdrID = Hdr.aaSubLedgerHdrID and   Dist.aaSubLedgerDistID = 1 and   SERIES = 2 and DOCTYPE > 0 and   DOCNUMBR <> '' and Master_ID = @Master_ID and  Dist.POSTED = 0   open CHdr  fetch next from CHdr into @aaSubLedgerHdrID, @lDocType, @DocNum, @POSTED  while @@fetch_status = 0  begin  insert into AAG50000  (USERID, TRXBTCHSRC, aaSubLedgerHdrID,  SERIES, DOCTYPE, DOCNUMBR,PSTGDATE,aaOrder)   values(@USERID, @TRXBTCHSRC,@aaSubLedgerHdrID,2,@lDocType,@DocNum,@UDate,0)   insert into AAG50001(USERID, TRXBTCHSRC, SERIES,aaSubLedgerHdrID,aaSubLedgerDistID,  ACTINDX,DEBITAMT, CRDTAMNT, ORDBTAMT, ORCRDAMT, CURNCYID, CURRNIDX,POSTED)  select @USERID, @TRXBTCHSRC, 2 , aaSubLedgerHdrID,aaSubLedgerDistID,   ACTINDX,DEBITAMT, CRDTAMNT, ORDBTAMT, ORCRDAMT, CURNCYID, CURRNIDX,POSTED  from AAG20001 where aaSubLedgerHdrID = @aaSubLedgerHdrID and POSTED = 0   insert into AAG50002(USERID, TRXBTCHSRC, SERIES, aaSubLedgerHdrID,aaSubLedgerDistID,aaSubLedgerAssignID,  DEBITAMT, CRDTAMNT, ORDBTAMT, ORCRDAMT,  DistRef)  select @USERID, @TRXBTCHSRC, 2, aaSubLedgerHdrID,aaSubLedgerDistID,  aaSubLedgerAssignID,DEBITAMT, CRDTAMNT, ORDBTAMT, ORCRDAMT,  CAST(((aaSubLedgerDistID-(SELECT MIN(aaSubLedgerDistID) FROM AAG20002 where aaSubLedgerHdrID = @aaSubLedgerHdrID))+1) AS VARCHAR(10))   from AAG20002 where aaSubLedgerHdrID = @aaSubLedgerHdrID    fetch next from CHdr into @aaSubLedgerHdrID, @lDocType, @DocNum, @POSTED   end  close CHdr  deallocate CHdr end    
GO
GRANT EXECUTE ON  [dbo].[aagUpdateReportTableForBRAdjPJ] TO [DYNGRP]
GO
