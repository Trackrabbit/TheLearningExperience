SET QUOTED_IDENTIFIER OFF
GO
SET ANSI_NULLS ON
GO
 CREATE PROCEDURE [dbo].[SVC_util_Fix_Missing_SVC00200] as declare @RecType smallint declare @Call char(11) declare @EquipLine integer declare @EquipID integer declare @default_status varchar(3) declare @default_type varchar(10) declare @entry_date datetime declare @entry_time datetime declare @price_level char(15) declare @Print_to_Web tinyint declare @time_zone char(3) declare @SRVTYPE char(11),  @priorityLevel smallint, @CUSTNMBR char(15), @ADRSCODE char(15), @CUSTNAME char(31), @ADDRESS1 char(31), @ADDRESS2 char(31), @CITY char(31), @STATECD char(30), @ZIP char(11), @CNTCPRSN char(31), @PHONE1 char(21), @OFFID char(11), @SVCAREA char(11), @TECHID char(11), @TIMEZONE char(3), @PYMTRMID char(21), @SLPRSNID char(15), @LABPCT numeric(19,5), @PARTPCT numeric(19,5), @MISCPCT numeric(19,5), @TAXSCHID char(15), @TAXEXMT1 char(25), @TAXEXMT2 char(25), @PORDNMBR char(21), @CONSTS smallint, @CONTNBR char(11), @LNSEQNBR numeric(19,5), @HOLD tinyint, @Bill_To_Customer char(15), @CURNCYID char(15), @SVC_Bill_To_Address_Code char(15), @CURRNIDX smallint, @RATETPID char(15), @EXGTBLID char(15), @XCHGRATE numeric(19,7), @EXCHDATE datetime, @DECPLACS smallint, @TIME1 datetime, @RATECALC smallint, @VIEWMODE smallint, @ISMCTRX smallint, @EXPNDATE datetime, @DENXRATE numeric(19,7), @MCTRXSTT smallint, @ADDRESS3 char(31), @COUNTRY char(21) declare @MinDate datetime, @MaxDate datetime  exec smGetMinDate @MinDate output  exec smGetMaxDate @MaxDate output  select  @default_status = SRVSTAT, @default_type = SRVTYPE, @Print_to_Web = Print_to_Web,  @price_level = PRCLEVEL, @time_zone = TIMEZONE from SVC00998  begin transaction    declare Fix_Service_cursor cursor for select SRVRECTYPE, CALLNBR,EQPLINE,EQUIPID  from SVC00202 where SRVRECTYPE > 1  open Fix_Service_cursor  FETCH NEXT FROM Fix_Service_cursor INTO @RecType,@Call,@EquipLine,@EquipID  while @@FETCH_STATUS = 0  BEGIN  if @EquipID > 0  BEGIN  if not exists(select * from SVC00200 where SRVRECTYPE = @RecType and CALLNBR = @Call)  BEGIN  select @entry_date = min(CREATDDT),@entry_time = min(CREATETIME) from SVC00210  where SRVRECTYPE = @RecType and CALLNBR = @Call  if exists(select * from SVC00601 where EQUIPID = @EquipID)   BEGIN  select   @SRVTYPE= SVC00601.SRVTYPE,   @priorityLevel = SVC00601.priorityLevel,  @CUSTNMBR = SVC00601.CUSTNMBR,  @ADRSCODE = SVC00601.ADRSCODE,  @CUSTNAME = RM00101.CUSTNAME,  @ADDRESS1 = SVC00300.ADDRESS1,  @ADDRESS2 = SVC00300.ADDRESS2,  @CITY = SVC00300.CITY,  @STATECD = SVC00300.STATE,  @ZIP = SVC00300.ZIP,  @CNTCPRSN = SVC00300.CNTCPRSN,  @PHONE1 = RM00101.PHONE1,  @OFFID = SVC00300.OFFID,  @SVCAREA = SVC00300.SVCAREA,  @TECHID = SVC00300.TECHID,  @TIMEZONE = SVC00300.TIMEZONE,  @PYMTRMID = RM00101.PYMTRMID,  @SLPRSNID = SVC00601.SLPRSNID,  @LABPCT = SVC00601.LABPCT,  @PARTPCT = SVC00601.PARTPCT,  @MISCPCT = SVC00601.MISCPCT,  @TAXSCHID = SVC00601.TAXSCHID,  @TAXEXMT1 = SVC00601.TAXEXMT1,  @TAXEXMT2 = RM00101.TAXEXMT2,  @PORDNMBR = SVC00601.PORDNMBR,  @CONSTS = SVC00601.CONSTS,  @CONTNBR = SVC00601.CONTNBR,  @LNSEQNBR = SVC00601.LNSEQNBR,  @HOLD = RM00101.HOLD,  @Bill_To_Customer = SVC00601.Bill_To_Customer,  @CURNCYID = RM00101.CURNCYID,  @SVC_Bill_To_Address_Code = SVC00601.SVC_Bill_To_Address_Code,  @CURRNIDX = SVC00601.CURRNIDX,  @RATETPID = SVC00601.RATETPID,  @EXGTBLID = SVC00601.EXGTBLID,  @XCHGRATE = SVC00601.XCHGRATE,  @EXCHDATE = SVC00601.EXCHDATE,  @DECPLACS = SVC00601.DECPLACS,  @TIME1 = SVC00601.TIME1,  @RATECALC = SVC00601.RATECALC,  @VIEWMODE = SVC00601.VIEWMODE,  @ISMCTRX = SVC00601.ISMCTRX,  @EXPNDATE = SVC00601.EXPNDATE,  @DENXRATE = SVC00601.DENXRATE,  @MCTRXSTT = SVC00601.MCTRXSTT,  @ADDRESS3 = SVC00300.ADDRESS3 ,  @COUNTRY = SVC00601.COUNTRY  FROM SVC00601 INNER JOIN RM00101 ON SVC00601.CUSTNMBR = RM00101.CUSTNMBR  INNER JOIN SVC00300 ON SVC00601.EQUIPID = SVC00300.EQUIPID  where SVC00601.EQUIPID = @EquipID   insert into SVC00200   select   @Call,   @RecType,   @default_status,   @SRVTYPE,   '',  @priorityLevel,  @CUSTNMBR,  '',  @ADRSCODE,  isnull(@CUSTNAME,''),  isnull(@ADDRESS1,''),  isnull(@ADDRESS2,''),  isnull(@CITY,''),  isnull(@STATECD,''),  isnull(@ZIP,''),  isnull(@CNTCPRSN,''),  isnull(@PHONE1,''),  isnull(@OFFID,''),  isnull(@SVCAREA,''),  isnull(@TECHID,''),  isnull(@TIMEZONE,''),  isnull(@entry_date,@MinDate),  isnull(@entry_time,@MinDate),  @MinDate,  @MinDate,  isnull(@entry_date,@MinDate),  isnull(@entry_time,@MinDate),  @MinDate,  @MinDate,  @MinDate,  @MinDate,  @MinDate,  @MinDate,  @MinDate,  @MinDate,  @price_level,  isnull(@PYMTRMID,''),  isnull(@SLPRSNID,''),  0,  @LABPCT,  0,  0,  @PARTPCT,  0,  0,  @MISCPCT,  0,  isnull(@TAXSCHID,''),  isnull(@TAXEXMT1,''),  isnull(@TAXEXMT2,''),  0.0,  0.0,  0.0,  0.0,  0,  0,  0,  isnull(@PORDNMBR,''),  0,  0,  '',  '',  '',  '',  '',  0,  '',  @MinDate,  @MinDate,  0,  '',  0,  '',  '',  '',  '',  '',  @CONSTS,  @CONTNBR,  @LNSEQNBR,  0,  isnull(@HOLD,0),  @Print_to_Web,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  @Bill_To_Customer,  @CURNCYID,  @SVC_Bill_To_Address_Code,  @CURRNIDX,  isnull(@RATETPID,''),  isnull(@EXGTBLID,''),  @XCHGRATE,  @EXCHDATE,  @DECPLACS,  @TIME1,  @RATECALC,  @VIEWMODE,  @ISMCTRX,  @EXPNDATE,  @DENXRATE,  @MCTRXSTT,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  isnull(@ADDRESS3,''),  isnull(@COUNTRY,''),0,'',0,0,0,0,0 ,9,2   if @@error <> 0 goto baderror  exec SVC_Set_Service_Totals @RecType,@Call  select @RecType,@Call,@CONTNBR  END   else   BEGIN  select   @priorityLevel = 0,  @LABPCT = 100.0,  @PARTPCT = 100.0,  @MISCPCT = 100.0,  @CUSTNMBR = SVC00300.CUSTNMBR,  @ADRSCODE = SVC00300.ADRSCODE,  @CUSTNAME = RM00101.CUSTNAME,  @ADDRESS1 = SVC00300.ADDRESS1,  @ADDRESS2 = SVC00300.ADDRESS2,  @CITY = SVC00300.CITY,  @STATECD = SVC00300.STATE,  @ZIP = SVC00300.ZIP,  @CNTCPRSN = SVC00300.CNTCPRSN,  @PHONE1 = RM00101.PHONE1,  @OFFID = SVC00300.OFFID,  @SVCAREA = SVC00300.SVCAREA,  @TECHID = SVC00300.TECHID,  @TIMEZONE = SVC00300.TIMEZONE,  @PYMTRMID = RM00101.PYMTRMID,  @SLPRSNID = RM00101.SLPRSNID,  @TAXSCHID = RM00101.TAXSCHID,  @TAXEXMT1 = RM00101.TAXEXMT1,  @TAXEXMT2 = RM00101.TAXEXMT2,  @HOLD = RM00101.HOLD,  @Bill_To_Customer = SVC00300.CUSTNMBR,  @CURNCYID = RM00101.CURNCYID,  @SVC_Bill_To_Address_Code = SVC00300.ADRSCODE,  @ADDRESS3 = SVC00300.ADDRESS3 ,  @COUNTRY = SVC00300.COUNTRY  FROM SVC00300 INNER JOIN RM00101 ON SVC00300.CUSTNMBR = RM00101.CUSTNMBR  where SVC00300.EQUIPID = @EquipID   insert into SVC00200   select   @Call,   @RecType,   @default_status,   @default_type,   '',  @priorityLevel,  @CUSTNMBR,  '',  @ADRSCODE,  isnull(@CUSTNAME,''),  isnull(@ADDRESS1,''),  isnull(@ADDRESS2,''),  isnull(@CITY,''),  isnull(@STATECD,''),  isnull(@ZIP,''),  isnull(@CNTCPRSN,''),  isnull(@PHONE1,''),  isnull(@OFFID,''),  isnull(@SVCAREA,''),  isnull(@TECHID,''),  isnull(@TIMEZONE,''),  isnull(@entry_date,@MinDate),  isnull(@entry_time,@MinDate),  @MinDate,  @MinDate,  isnull(@entry_date,@MinDate),  isnull(@entry_time,@MinDate),  @MinDate,  @MinDate,  @MinDate,  @MinDate,  @MinDate,  @MinDate,  @MinDate,  @MinDate,  @price_level,  isnull(@PYMTRMID,''),  isnull(@SLPRSNID,''),  0,  @LABPCT,  0,  0,  @PARTPCT,  0,  0,  @MISCPCT,  0,  isnull(@TAXSCHID,''),  isnull(@TAXEXMT1,''),  isnull(@TAXEXMT2,''),  0.0,  0.0,  0.0,  0.0,  0,  0,  0,  '',  0,  0,  '',  '',  '',  '',  '',  0,  '',  @MinDate,  @MinDate,  0,  '',  0,  '',  '',  '',  '',  '',  0,  '',  0,  0,  @HOLD,  @Print_to_Web,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  isnull(@CUSTNMBR,''),  isnull(@CURNCYID,''),  isnull(@ADRSCODE,''),  0,  '',  '',  0,  @MinDate,  0,  @MinDate,  0,  0,  0,  @MinDate,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  isnull(@ADDRESS3,''),  isnull(@COUNTRY,''),0,'',0,0,0,0,0 ,9,2   if @@error <> 0 goto baderror  exec SVC_Set_Service_Totals @RecType,@Call  select @RecType,@Call  END  END  END  else   BEGIN   if not exists(select * from SVC00200 where SRVRECTYPE = @RecType and CALLNBR = @Call)  BEGIN  insert into SVC00200   select   @Call,   @RecType,   @default_status,   @default_type,   '',  0,  '',  '',  '',  '',  '',  '',  '',  '',  '',  '',  '',  '',  '',  '',  '',  isnull(@entry_date,@MinDate),  isnull(@entry_time,@MinDate),  @MinDate,  @MinDate,  isnull(@entry_date,@MinDate),  isnull(@entry_time,@MinDate),  @MinDate,  @MinDate,  @MinDate,  @MinDate,  @MinDate,  @MinDate,  @MinDate,  @MinDate,  @price_level,  '',  '',  0,  100.0,  0,  0,  100.0,  0,  0,  100.0,  0,  '',  '',  '',  0.0,  0.0,  0.0,  0.0,  0,  0,  0,  '',  0,  0,  '',  '',  '',  '',  '',  0,  '',  @MinDate,  @MinDate,  0,  '',  0,  '',  '',  '',  '',  '',  0,  '',  0,  0,  0,  @Print_to_Web,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  '',  '',  '',  0,  '',  '',  0,  @MinDate,  0,  @MinDate,  0,  0,  0,  @MinDate,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  '',  '',0,'',0,0,0,0,0 ,9,2  if @@error <> 0 goto baderror  exec SVC_Set_Service_Totals @RecType,@Call  select @RecType,@Call  END  END  FETCH NEXT FROM Fix_Service_cursor INTO @RecType,@Call,@EquipLine,@EquipID  END  deallocate Fix_Service_cursor  COMMIT TRANSACTION return(0) baderror:  rollback transaction  return (99)    
GO
GRANT EXECUTE ON  [dbo].[SVC_util_Fix_Missing_SVC00200] TO [DYNGRP]
GO
