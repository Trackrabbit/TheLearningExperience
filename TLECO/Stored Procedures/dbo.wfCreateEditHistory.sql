SET QUOTED_IDENTIFIER OFF
GO
SET ANSI_NULLS ON
GO
 CREATE PROCEDURE [dbo].[wfCreateEditHistory]  @WorkflowStepInstanceID char(37),  @Workflow_User char(85),  @Comments char(255),  @Workflow_Error int OUTPUT AS  BEGIN   declare @Workflow_Comments char(2000)  declare @WorkflowInstanceID char(37), @Workflow_Step_Assign_To char(37)  declare @Workflow_Step_Name char(51), @Workflow_Name char(51), @Workflow_Version int  declare @CMPANYID smallint, @server_name nvarchar(128), @SystemDB nvarchar(6)  declare @Workflow_Due_Date datetime, @Workflow_Due_Time datetime,  @Workflow_Completion_Date datetime, @Workflow_Completion_Time datetime  declare @WfBusObjKey char(201)  declare @Workflow_Require_One_App tinyint  select @WorkflowStepInstanceID=UPPER(@WorkflowStepInstanceID)  select @Workflow_User=UPPER(@Workflow_User)   select @Workflow_Name=Workflow_Name, @Workflow_Step_Name=Workflow_Step_Name,  @Workflow_Step_Assign_To=Workflow_Step_Assign_To,  @Workflow_Name=Workflow_Name, @Workflow_Version=Workflow_Version,  @WorkflowInstanceID=WorkflowInstanceID  from WFI10003 where WorkflowStepInstanceID=@WorkflowStepInstanceID   select @WfBusObjKey=WfBusObjKey, @Workflow_Require_One_App=Workflow_Require_One_App   from WFI10002 where WorkflowInstanceID=@WorkflowInstanceID  if @Comments=''  begin  select @WfBusObjKey=replace(@WfBusObjKey,'~',' ')   select @Workflow_Comments= rtrim(@WfBusObjKey)+' was edited.'  end  else  begin  select @Workflow_Comments=rtrim(@Comments)  end   select @Workflow_Due_Date=cast(SYSDATETIME() as date),@Workflow_Due_Time=cast(SYSDATETIME() as time)  select @Workflow_Completion_Date=@Workflow_Due_Date,@Workflow_Completion_Time=@Workflow_Due_Time  exec wfCreateHistoryRecord @WorkflowInstanceID,  @WorkflowStepInstanceID,  @Workflow_User,  @Workflow_Name,  @Workflow_Step_Name,  @Workflow_Step_Assign_To,  9,  @Workflow_Due_Date,  @Workflow_Due_Time,  @Workflow_Completion_Date,  @Workflow_Completion_Time,  @Workflow_Comments,  @Workflow_Error OUTPUT  END   
GO
GRANT EXECUTE ON  [dbo].[wfCreateEditHistory] TO [DYNGRP]
GO
