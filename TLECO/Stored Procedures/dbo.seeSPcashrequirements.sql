SET QUOTED_IDENTIFIER OFF
GO
SET ANSI_NULLS ON
GO
 CREATE PROCEDURE [dbo].[seeSPcashrequirements]  @Date DATETIME,  @FromVendorID VARCHAR(12),  @ToVendorID VARCHAR(12),  @FromVendorName VARCHAR(30),  @ToVendorName VARCHAR(30),  @FromVendorClass VARCHAR(12),  @ToVendorClass VARCHAR(12),  @FromUDF_1 VARCHAR(30),  @ToUDF_1 VARCHAR(30),  @FromUDF_2 VARCHAR(30),  @ToUDF_2 VARCHAR(30),  @FromPaymentPriority VARCHAR(12),  @ToPaymentPriority VARCHAR(12),  @DueDateFrom DATETIME,  @DueDateTo DATETIME,  @DiscountDateFrom DATETIME,  @DiscountDateTo DATETIME AS   SELECT DISTINCT  PM_Vendor_MSTR.VENDORID AS [Vendor ID],  PM_Vendor_MSTR.VENDNAME AS [Vendor Name],  PM_Vendor_MSTR.VNDCLSID AS [Vendor ClassID],  PM_Vendor_MSTR.USERDEF1 AS [UDF_1],  PM_Vendor_MSTR.USERDEF2 AS [UDF_2],  PM_Vendor_MSTR.PYMNTPRI AS [Payment Priority],   PM_Trx_Open.DOCNUMBR AS [Document Number],  CONVERT(VARCHAR(10), PM_Trx_Open.DOCDATE, 101) AS [Document Date],   CASE WHEN (PM_Trx_Open.DOCTYPE = 1) THEN 'INV'  WHEN (PM_Trx_Open.DOCTYPE = 2) THEN 'FIN'  WHEN (PM_Trx_Open.DOCTYPE = 3) THEN 'MIS'  WHEN (PM_Trx_Open.DOCTYPE = 4) THEN 'RET'  WHEN (PM_Trx_Open.DOCTYPE = 5) THEN 'CRM'  WHEN (PM_Trx_Open.DOCTYPE In (6,7,8,9)) THEN 'PMT'  ELSE ''  END AS [Document Type],   CASE WHEN PM_Trx_Open.DOCTYPE <= 3 THEN PM_Trx_Open.DOCAMNT ELSE -PM_Trx_Open.DOCAMNT END AS [Amount],   CONVERT(CHAR(10), PM_Trx_Open.DUEDATE, 101) AS [Due Date],  PM_Trx_Open.VCHRNMBR AS [Voucher],   CASE WHEN   (PM_Trx_Open.DOCTYPE <= 3) THEN   ISNULL(PM_Trx_Open.DOCAMNT - PM_Trx_Open.CURTRXAM - ISNULL(MC_PM_Revaluation.Total_Gain_or_Loss_on_Cu,0),0)  ELSE  ISNULL(PM_Trx_Open.DOCAMNT - PM_Trx_Open.CURTRXAM + ISNULL(MC_PM_Revaluation.Total_Gain_or_Loss_on_Cu,0),0)  END AS [Applied Amount],   CASE WHEN (PM_Trx_Open.DISCDATE >= @Date) THEN PM_Trx_Open.DISAMTAV ELSE '0.00' END AS [Valid Discount],   CONVERT(CHAR(10), PM_Trx_Open.DISCDATE, 101) AS [Discount Date],   CASE WHEN (PM_Trx_Open.DISCDATE < @Date) THEN PM_Trx_Open.DISAMTAV ELSE '0.00' END AS [Discount Lost],   DATEDIFF(DAY, PM_Trx_Open.DOCDATE, @Date) AS [Days Old],   isnull(MC_PM_Revaluation.Total_Gain_or_Loss_on_Cu,0) AS [Unpaid LossGain]   FROM PM00200 AS PM_Vendor_MSTR   INNER JOIN PM20000 AS PM_Trx_Open ON PM_Vendor_MSTR.VENDORID = PM_Trx_Open.VENDORID  LEFT OUTER JOIN PM20100 AS PM_ApplyTo_Open ON PM_Trx_Open.VENDORID = PM_ApplyTo_Open.VENDORID   AND PM_Trx_Open.DOCNUMBR = PM_ApplyTo_Open.APTODCNM   LEFT OUTER JOIN MC020105 as MC_PM_Revaluation ON PM_Trx_Open.VCHRNMBR = MC_PM_Revaluation.VCHRNMBR  WHERE (@FromVendorID = 'ALL' OR PM_Vendor_MSTR.VENDORID >= @FromVendorID)  AND (@ToVendorID = 'ALL' OR PM_Vendor_MSTR.VENDORID <= @ToVendorID)  AND (@FromVendorName = 'ALL' OR PM_Vendor_MSTR.VENDNAME >= @FromVendorName)  AND (@ToVendorName = 'ALL' OR PM_Vendor_MSTR.VENDNAME <= @ToVendorName)  AND (@FromVendorClass = 'ALL' OR PM_Vendor_MSTR.VNDCLSID >= @FromVendorClass)  AND (@ToVendorClass = 'ALL' OR PM_Vendor_MSTR.VNDCLSID <= @ToVendorClass)  AND (@FromUDF_1 = 'ALL' OR PM_Vendor_MSTR.USERDEF1 >= @FromUDF_1)  AND (@ToUDF_1 = 'ALL' OR PM_Vendor_MSTR.USERDEF1 <= @ToUDF_1)  AND (@FromUDF_2 = 'ALL' OR PM_Vendor_MSTR.USERDEF2 >= @FromUDF_2)  AND (@ToUDF_2 = 'ALL' OR PM_Vendor_MSTR.USERDEF2 <= @ToUDF_2)  AND (@FromPaymentPriority = 'ALL' OR PM_Vendor_MSTR.PYMNTPRI >= @FromPaymentPriority)  AND (@ToPaymentPriority = 'ALL' OR PM_Vendor_MSTR.PYMNTPRI <= @ToPaymentPriority)  AND (PM_Trx_Open.DUEDATE BETWEEN @DueDateFrom AND @DueDateTo OR PM_Trx_Open.DUEDATE = '01/01/1900')   AND (PM_Trx_Open.DISCDATE BETWEEN @DiscountDateFrom AND @DiscountDateTo)   
GO
GRANT EXECUTE ON  [dbo].[seeSPcashrequirements] TO [DYNGRP]
GO
GRANT EXECUTE ON  [dbo].[seeSPcashrequirements] TO [rpt_accounting manager]
GO
GRANT EXECUTE ON  [dbo].[seeSPcashrequirements] TO [rpt_accounts payable coordinator]
GO
GRANT EXECUTE ON  [dbo].[seeSPcashrequirements] TO [rpt_bookkeeper]
GO
GRANT EXECUTE ON  [dbo].[seeSPcashrequirements] TO [rpt_power user]
GO
