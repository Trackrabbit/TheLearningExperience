SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO
 CREATE  PROCEDURE [dbo].[aagGetDispDetail_UPR_EditList] @oEMPLOYID char(15) OUTPUT, @iPYRNTYPE smallint, @oPYRLRTYP smallint OUTPUT, @oTRXNUMBER int OUTPUT, @oSEQNUMBR int OUTPUT, @oACTINDX int OUTPUT, @oDEPRTMNT char(7) OUTPUT, @oJOBTITLE char(7) OUTPUT, @oPAYROLCD char(7) OUTPUT, @oUPRACTYP smallint OUTPUT, @oPYADNMBR int OUTPUT, @iDispID int, @oDistID int OUTPUT, @oDistIDExist int OUTPUT, @oHdrID int OUTPUT AS BEGIN   SELECT USERID,  EMPLOYID,  PYRNTYPE,  PYRLRTYP,  TRXNUMBER,  SEQNUMBR,  ACTINDX,  AMNTOPST,  DEPRTMNT,  JOBTITLE,  PAYROLCD,  UPRACTYP,  PYADNMBR,  IDENTITY(int, 1,1) AS DisplayDistID  INTO #newtable1   FROM UPR10209  WHERE USERID = system_user and   PYRNTYPE = @iPYRNTYPE  ORDER BY DEX_ROW_ID   SELECT  @oEMPLOYID = EMPLOYID,  @oPYRLRTYP = PYRLRTYP,  @oTRXNUMBER = TRXNUMBER,  @oSEQNUMBR = SEQNUMBR,  @oACTINDX = ACTINDX,  @oDEPRTMNT = DEPRTMNT,  @oJOBTITLE = JOBTITLE,  @oPAYROLCD = PAYROLCD,  @oUPRACTYP = UPRACTYP,  @oPYADNMBR = PYADNMBR  FROM #newtable1   WHERE DisplayDistID = @iDispID   SELECT upr.USERID,  upr.EMPLOYID,  upr.PYRNTYPE,  upr.PYRLRTYP,  upr.TRXNUMBER,  upr.SEQNUMBR,  upr.ACTINDX,  upr.AMNTOPST,  upr.DEPRTMNT,  upr.JOBTITLE,  upr.PAYROLCD,  upr.UPRACTYP,  upr.PYADNMBR,  isnull(hdr.aaSubLedgerHdrID,0) aaSubLedgerHdrID,  isnull(dist.aaSubLedgerDistID,0) aaSubLedgerDistID,  IDENTITY(int, 1,1) AS DisplayDistID  INTO #newtable2   FROM UPR10209 upr   left outer join AAG20000 hdr on hdr.DOCNUMBR = upr.USERID and   hdr.Master_ID = upr.EMPLOYID and   hdr.PYRNTYPE = upr.PYRNTYPE  left outer join AAG20001 dist on dist.aaSubLedgerHdrID = hdr.aaSubLedgerHdrID and  dist.ACTINDX = upr.ACTINDX and   dist.SEQNUMBR = upr.SEQNUMBR and   dist.PYRLRTYP = upr.PYRLRTYP and   dist.TRXNUMBER = upr.TRXNUMBER   WHERE upr.USERID = system_user and   upr.EMPLOYID = @oEMPLOYID and   upr.PYRNTYPE = @iPYRNTYPE  ORDER BY upr.DEX_ROW_ID   SELECT @oDistID = DisplayDistID,  @oHdrID = aaSubLedgerHdrID,  @oDistIDExist = aaSubLedgerDistID  FROM #newtable2   WHERE PYRNTYPE = @iPYRNTYPE and   PYRLRTYP = @oPYRLRTYP and   TRXNUMBER = @oTRXNUMBER and   SEQNUMBR = @oSEQNUMBR and   ACTINDX = @oACTINDX and   DEPRTMNT = @oDEPRTMNT and   JOBTITLE = @oJOBTITLE and   PAYROLCD = @oPAYROLCD and   UPRACTYP = @oUPRACTYP and   PYADNMBR = @oPYADNMBR  END    
GO
GRANT EXECUTE ON  [dbo].[aagGetDispDetail_UPR_EditList] TO [DYNGRP]
GO
