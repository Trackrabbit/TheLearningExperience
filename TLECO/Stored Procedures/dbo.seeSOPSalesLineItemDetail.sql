SET QUOTED_IDENTIFIER OFF
GO
SET ANSI_NULLS ON
GO
 create procedure [dbo].[seeSOPSalesLineItemDetail]  @ItemNumber varchar(50) = null,  @StartDate datetime = null,  @EndDate datetime = null,  @CustomerNumber varchar(max),  @SalesPerson varchar(max),  @HistoryOnly tinyint,  @DisplayQuotes tinyint,  @ProspectQuotesOnly tinyint as  declare @vSelect_Statement1 varchar(500) declare @WhereClaseAdded tinyint select  @WhereClaseAdded = 0 select @vSelect_Statement1 = 'select * from SalesLineItems'   if @CustomerNumber = '' and @SalesPerson = '' begin  if @StartDate is not null and @EndDate is not null  begin  select @vSelect_Statement1 = @vSelect_Statement1 + ' where ([Document Date] >= ''' + convert(char(10),@StartDate,110) + ''' and [Document Date] <= '''   + convert(char(10),@EndDate,110) + ''')'  select @WhereClaseAdded = 1  end   if @DisplayQuotes = 1  begin  if @ProspectQuotesOnly = 1  begin  if @WhereClaseAdded = 0  begin  select @vSelect_Statement1 = @vSelect_Statement1 + ' where'  select @WhereClaseAdded = 1  end  else  begin  select @vSelect_Statement1 = @vSelect_Statement1 + ' and'  end   select @vSelect_Statement1 = @vSelect_Statement1 + ' [SOP Type] = ''' + dbo.DYN_FUNC_SOP_Type(1) + ''''  end   end  else  begin  if @WhereClaseAdded = 0  begin  select @vSelect_Statement1 = @vSelect_Statement1 + ' where'  select @WhereClaseAdded = 1  end  else  begin  select @vSelect_Statement1 = @vSelect_Statement1 + ' and'  end   select @vSelect_Statement1 = @vSelect_Statement1 + ' [SOP Type] <> ''' + dbo.DYN_FUNC_SOP_Type(1) + ''''  end   If @HistoryOnly = 1  begin  select @vSelect_Statement1 = @vSelect_Statement1 +  ' and [Document Status] = ''' + dbo.DYN_FUNC_Document_Status_SOP_Line_Items(2) + ''''  end   if @ItemNumber is not null  begin  if @WhereClaseAdded = 0  begin  select @vSelect_Statement1 = @vSelect_Statement1 + ' where'  end  else  begin  select @vSelect_Statement1 = @vSelect_Statement1 + ' and'  end   select @vSelect_Statement1 = @vSelect_Statement1 + ' (''' + @ItemNumber +   ''' is null or [Item Number] = ''' + @ItemNumber + ''')'  end end  if @CustomerNumber != '' begin  select @vSelect_Statement1 = @vSelect_Statement1 + ' where [Customer Number] in (select * from dbo.seeSplitString(''' + @CustomerNumber + ''' , '', ''))'   if @StartDate is not null and @EndDate is not null  begin  select @vSelect_Statement1 = @vSelect_Statement1 + ' and ([Document Date] >= ''' + convert(char(10),@StartDate,110) + ''' and [Document Date] <= '''   + convert(char(10),@EndDate,110) + ''')'  end    if @DisplayQuotes = 1  begin  if @ProspectQuotesOnly = 1  begin  select @vSelect_Statement1 = @vSelect_Statement1 + ' and [SOP Type] = ''' + dbo.DYN_FUNC_SOP_Type(1) + ''''  end   end  else  begin  select @vSelect_Statement1 = @vSelect_Statement1 + ' and [SOP Type] <> ''' + dbo.DYN_FUNC_SOP_Type(1) + ''''  end   If @HistoryOnly = 1  begin  select @vSelect_Statement1 = @vSelect_Statement1 +  ' and [Document Status] = ''' + dbo.DYN_FUNC_Document_Status_SOP_Line_Items(2) + ''''  end   if @ItemNumber is not null  begin  select @vSelect_Statement1 = @vSelect_Statement1 + ' and (''' + @ItemNumber +   ''' is null or [Item Number] = ''' + @ItemNumber + ''')'  end end  if @SalesPerson != '' begin  select @vSelect_Statement1 = @vSelect_Statement1 + ' where [Salesperson ID] in (select * from dbo.seeSplitString(''' + @SalesPerson + ''' , '', ''))'   if @StartDate is not null and @EndDate is not null  begin  select @vSelect_Statement1 = @vSelect_Statement1 + ' and ([Document Date] >= ''' + convert(char(10),@StartDate,110) + ''' and [Document Date] <= '''   + convert(char(10),@EndDate,110) + ''')'  end    if @DisplayQuotes = 1  begin  if @ProspectQuotesOnly = 1  begin  select @vSelect_Statement1 = @vSelect_Statement1 + ' and [SOP Type] = ''' + dbo.DYN_FUNC_SOP_Type(1) + ''''  end   end  else  begin  select @vSelect_Statement1 = @vSelect_Statement1 + ' and [SOP Type] <> ''' + dbo.DYN_FUNC_SOP_Type(1) + ''''  end   If @HistoryOnly = 1  begin  select @vSelect_Statement1 = @vSelect_Statement1 +  ' and [Document Status] = ''' + dbo.DYN_FUNC_Document_Status_SOP_Line_Items(2) + ''''  end   if @ItemNumber is not null  begin  select @vSelect_Statement1 = @vSelect_Statement1 + ' and (''' + @ItemNumber +   ''' is null or [Item Number] = ''' + @ItemNumber + ''')'  end end  exec (@vSelect_Statement1)    
GO
GRANT EXECUTE ON  [dbo].[seeSOPSalesLineItemDetail] TO [DYNGRP]
GO
GRANT EXECUTE ON  [dbo].[seeSOPSalesLineItemDetail] TO [rpt_executive]
GO
GRANT EXECUTE ON  [dbo].[seeSOPSalesLineItemDetail] TO [rpt_materials manager]
GO
GRANT EXECUTE ON  [dbo].[seeSOPSalesLineItemDetail] TO [rpt_operations manager]
GO
GRANT EXECUTE ON  [dbo].[seeSOPSalesLineItemDetail] TO [rpt_order processor]
GO
GRANT EXECUTE ON  [dbo].[seeSOPSalesLineItemDetail] TO [rpt_shipping and receiving]
GO
GRANT EXECUTE ON  [dbo].[seeSOPSalesLineItemDetail] TO [rpt_warehouse manager]
GO
