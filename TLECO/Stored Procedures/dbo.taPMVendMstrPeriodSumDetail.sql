SET QUOTED_IDENTIFIER OFF
GO
SET ANSI_NULLS ON
GO
create procedure [dbo].[taPMVendMstrPeriodSumDetail] @I_sHISTTYPE	smallint,		 @O_iErrorState	int = NULL output	 with encryption as declare  @iStatus int select	@iStatus = 0, @O_iErrorState = 0 select @I_sHISTTYPE HISTTYPE, h.VENDORID, h.YEAR1, h.PERIODID, sum(AMBLDLIF) Total into #Total2 from #Holding h where (h.DOCTYPE = 1 or h.DOCTYPE = 3) group by h.VENDORID, h.YEAR1, h.PERIODID update r set r.AMBLDLIF = c.Total from PM00202 r, #Total2 c where c.HISTTYPE = r.HISTTYPE and	c.VENDORID = r.VENDORID and	c.YEAR1 = r.YEAR1 and	c.PERIODID = r.PERIODID if (@@error <> 0) begin select @iStatus = @@error select @O_iErrorState = 101  return end drop table #Total2 select @I_sHISTTYPE HISTTYPE, h.VENDORID, h.YEAR1, h.PERIODID, sum(AMBLDLIF) Total into #Total3 from #Holding h where (h.DOCTYPE = 5) group by h.VENDORID, h.YEAR1, h.PERIODID update r set r.AMBLDLIF = r.AMBLDLIF - c.Total from PM00202 r, #Total3 c where c.HISTTYPE = r.HISTTYPE and	c.VENDORID = r.VENDORID and	c.YEAR1 = r.YEAR1 and	c.PERIODID = r.PERIODID if (@@error <> 0) begin select @iStatus = @@error select @O_iErrorState = 102  return end drop table #Total3 select @I_sHISTTYPE HISTTYPE, h.VENDORID, h.YEAR1, h.PERIODID, sum(AMTPDLIF) Total into #Total4 from #Holding h where (h.DOCTYPE = 1 or h.DOCTYPE = 2 or h.DOCTYPE = 3 or h.DOCTYPE = 6) group by h.VENDORID, h.YEAR1, h.PERIODID update r set r.AMTPDLIF = c.Total from PM00202 r, #Total4 c where c.HISTTYPE = r.HISTTYPE and	c.VENDORID = r.VENDORID and	c.YEAR1 = r.YEAR1 and	c.PERIODID = r.PERIODID if (@@error <> 0) begin select @iStatus = @@error select @O_iErrorState = 103  return end drop table #Total4 select @I_sHISTTYPE HISTTYPE, h.VENDORID, h.YEAR1, h.PERIODID, sum(AMTPDLIF) Total into #Total5 from #Holding h where (h.DOCTYPE = 4) group by h.VENDORID, h.YEAR1, h.PERIODID update r set r.AMTPDLIF = r.AMTPDLIF - c.Total from PM00202 r, #Total5 c where c.HISTTYPE = r.HISTTYPE and	c.VENDORID = r.VENDORID and	c.YEAR1 = r.YEAR1 and	c.PERIODID = r.PERIODID if (@@error <> 0) begin select @iStatus = @@error select @O_iErrorState = 104  return end drop table #Total5 select @I_sHISTTYPE HISTTYPE, h.VENDORID, h.YEAR1, h.PERIODID, sum(TEN99ALIF) Total into #Total6 from #Holding h where (h.DOCTYPE = 1 or h.DOCTYPE = 2 or h.DOCTYPE = 3 or h.DOCTYPE = 6) group by h.VENDORID, h.YEAR1, h.PERIODID update r set r.TEN99ALIF = c.Total from PM00202 r, #Total6 c where c.HISTTYPE = r.HISTTYPE and	c.VENDORID = r.VENDORID and	c.YEAR1 = r.YEAR1 and	c.PERIODID = r.PERIODID if (@@error <> 0) begin select @iStatus = @@error select @O_iErrorState = 105  return end drop table #Total6 select @I_sHISTTYPE HISTTYPE, h.VENDORID, h.YEAR1, h.PERIODID, sum(TEN99ALIF) Total into #Total7 from #Holding h where (h.DOCTYPE = 4) group by h.VENDORID, h.YEAR1, h.PERIODID update r set r.TEN99ALIF = r.TEN99ALIF - c.Total from PM00202 r, #Total7 c where c.HISTTYPE = r.HISTTYPE and	c.VENDORID = r.VENDORID and	c.YEAR1 = r.YEAR1 and	c.PERIODID = r.PERIODID if (@@error <> 0) begin select @iStatus = @@error select @O_iErrorState = 106  return end drop table #Total7 select @I_sHISTTYPE HISTTYPE, h.VENDORID, h.YEAR1, h.PERIODID, sum(DISAVLIF) Total into #Total8 from #Holding h where (h.DOCTYPE = 1 or h.DOCTYPE = 2 or h.DOCTYPE = 3) group by h.VENDORID, h.YEAR1, h.PERIODID update r set r.DISAVLIF = c.Total from PM00202 r, #Total8 c where c.HISTTYPE = r.HISTTYPE and	c.VENDORID = r.VENDORID and	c.YEAR1 = r.YEAR1 and	c.PERIODID = r.PERIODID if (@@error <> 0) begin select @iStatus = @@error select @O_iErrorState = 107  return end drop table #Total8 select @I_sHISTTYPE HISTTYPE, h.VENDORID, h.YEAR1, h.PERIODID, sum(DISTKNLF) Total into #Total9 from #Holding h where (h.DOCTYPE = 1 or h.DOCTYPE = 2 or h.DOCTYPE = 3 or h.DOCTYPE = 4 or h.DOCTYPE = 5) group by h.VENDORID, h.YEAR1, h.PERIODID update r set r.DISTKNLF = c.Total from PM00202 r, #Total9 c where c.HISTTYPE = r.HISTTYPE and	c.VENDORID = r.VENDORID and	c.YEAR1 = r.YEAR1 and	c.PERIODID = r.PERIODID if (@@error <> 0) begin select @iStatus = @@error select @O_iErrorState = 108  return end drop table #Total9 select @I_sHISTTYPE HISTTYPE, h.VENDORID, h.YEAR1, h.PERIODID, sum(DISLSTLF) Total into #Total10 from #Holding h where (h.DOCTYPE = 1 or h.DOCTYPE = 2 or h.DOCTYPE = 3 or h.DOCTYPE = 4 or h.DOCTYPE = 5) group by h.VENDORID, h.YEAR1, h.PERIODID update r set r.DISLSTLF = c.Total from PM00202 r, #Total10 c where c.HISTTYPE = r.HISTTYPE and	c.VENDORID = r.VENDORID and	c.YEAR1 = r.YEAR1 and	c.PERIODID = r.PERIODID if (@@error <> 0) begin select @iStatus = @@error select @O_iErrorState = 109  return end drop table #Total10 select @I_sHISTTYPE HISTTYPE, h.VENDORID, h.YEAR1, h.PERIODID, sum(FINCHLIF) Total into #Total11 from #Holding h where h.DOCTYPE = 2 group by h.VENDORID, h.YEAR1, h.PERIODID update r set r.FINCHLIF = c.Total from PM00202 r, #Total11 c where c.HISTTYPE = r.HISTTYPE and	c.VENDORID = r.VENDORID and	c.YEAR1 = r.YEAR1 and	c.PERIODID = r.PERIODID if (@@error <> 0) begin select @iStatus = @@error select @O_iErrorState = 110  return end drop table #Total11 select @I_sHISTTYPE HISTTYPE, h.VENDORID, h.YEAR1, h.PERIODID, sum(WROFSLIF) Total into #Total12 from #Holding h where (h.DOCTYPE = 1 or h.DOCTYPE = 3 or h.DOCTYPE = 4 or h.DOCTYPE = 5) group by h.VENDORID, h.YEAR1, h.PERIODID update r set r.WROFSLIF = c.Total from PM00202 r, #Total12 c where c.HISTTYPE = r.HISTTYPE and	c.VENDORID = r.VENDORID and	c.YEAR1 = r.YEAR1 and	c.PERIODID = r.PERIODID if (@@error <> 0) begin select @iStatus = @@error select @O_iErrorState = 111  return end drop table #Total12 select @I_sHISTTYPE HISTTYPE, h.VENDORID, h.YEAR1, h.PERIODID, sum(RTRNSLIF) Total into #Total13 from #Holding h where h.DOCTYPE = 4 group by h.VENDORID, h.YEAR1, h.PERIODID update r set r.RTRNSLIF = c.Total from PM00202 r, #Total13 c where c.HISTTYPE = r.HISTTYPE and	c.VENDORID = r.VENDORID and	c.YEAR1 = r.YEAR1 and	c.PERIODID = r.PERIODID if (@@error <> 0) begin select @iStatus = @@error select @O_iErrorState = 112  return end drop table #Total13 select @I_sHISTTYPE HISTTYPE, h.VENDORID, h.YEAR1, h.PERIODID, sum(TRDTKLIF) Total into #Total14 from #Holding h where (h.DOCTYPE = 1 or h.DOCTYPE = 2 or h.DOCTYPE = 3) group by h.VENDORID, h.YEAR1, h.PERIODID update r set r.TRDTKLIF = c.Total from PM00202 r, #Total14 c where c.HISTTYPE = r.HISTTYPE and	c.VENDORID = r.VENDORID and	c.YEAR1 = r.YEAR1 and	c.PERIODID = r.PERIODID if (@@error <> 0) begin select @iStatus = @@error select @O_iErrorState = 113  return end drop table #Total14 select @I_sHISTTYPE HISTTYPE, h.VENDORID, h.YEAR1, h.PERIODID, sum(TRDTKLIF) Total into #Total15 from #Holding h where (h.DOCTYPE = 4 or h.DOCTYPE = 5) group by h.VENDORID, h.YEAR1, h.PERIODID update r set r.TRDTKLIF = r.TRDTKLIF - c.Total from PM00202 r, #Total15 c where c.HISTTYPE = r.HISTTYPE and	c.VENDORID = r.VENDORID and	c.YEAR1 = r.YEAR1 and	c.PERIODID = r.PERIODID if (@@error <> 0) begin select @iStatus = @@error select @O_iErrorState = 114  return end drop table #Total15 select @I_sHISTTYPE HISTTYPE, h.VENDORID, h.YEAR1, h.PERIODID, count(*) Total into #Total1 from #Holding h where h.DOCTYPE = 2 group by h.VENDORID, h.YEAR1, h.PERIODID update r set r.NFNCHLIF = c.Total from PM00202 r, #Total1 c where c.HISTTYPE = r.HISTTYPE and	c.VENDORID = r.VENDORID and	c.YEAR1 = r.YEAR1 and	c.PERIODID = r.PERIODID if (@@error <> 0) begin select @iStatus = @@error select @O_iErrorState = 115  return end drop table #Total1 select @I_sHISTTYPE HISTTYPE, h.VENDORID, h.YEAR1, h.PERIODID, count(*) Total into #Total16 from #Holding h where h.DOCTYPE = 1 group by h.VENDORID, h.YEAR1, h.PERIODID update r set r.NOINVLIF = c.Total from PM00202 r, #Total16 c where c.HISTTYPE = r.HISTTYPE and	c.VENDORID = r.VENDORID and	c.YEAR1 = r.YEAR1 and	c.PERIODID = r.PERIODID if (@@error <> 0) begin select @iStatus = @@error select @O_iErrorState = 116  return end drop table #Total16 return(@iStatus) 
GO
GRANT EXECUTE ON  [dbo].[taPMVendMstrPeriodSumDetail] TO [DYNGRP]
GO
