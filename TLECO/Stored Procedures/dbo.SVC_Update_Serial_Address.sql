SET QUOTED_IDENTIFIER OFF
GO
SET ANSI_NULLS ON
GO
 CREATE Procedure [dbo].[SVC_Update_Serial_Address]  (   @EQUIPID int  ) As  DECLARE @CONTRACT_TYPE_QUOTE SMALLINT DECLARE @CONTRACT_TYPE_CONTRACT SMALLINT SET @CONTRACT_TYPE_QUOTE = 1 SET @CONTRACT_TYPE_CONTRACT = 2  UPDATE SVC00300 WITH(ROWLOCK)  SET  CNTCPRSN = cm.CNTCPRSN,  ADDRESS1 = cm.ADDRESS1,  ADDRESS2 = cm.ADDRESS2,  ADDRESS3 = cm.ADDRESS3,  CITY = cm.CITY,  STATE = cm.STATE,  ZIP = cm.ZIP,  COUNTRY = cm.COUNTRY,   SVCAREA =   CASE  WHEN cs.CUSTNMBR IS NULL THEN sm.SVCAREA  WHEN cs.SVCAREA <> '' THEN cs.SVCAREA  WHEN cm.ZIP <> '' THEN  ISNULL((SELECT TOP 1 SVCAREA FROM SVC00910   WHERE ZIPCODE LIKE (RTRIM(cm.ZIP) + '%')),  '')  ELSE ''  END,  OFFID =   CASE  WHEN cs.CUSTNMBR IS NULL THEN sm.OFFID  WHEN cs.OFFID is null THEN sm.OFFID  ELSE cs.OFFID   END,  TECHID =   CASE  WHEN cs.CUSTNMBR IS NULL THEN sm.TECHID  WHEN cs.TECHID is null THEN sm.TECHID  ELSE cs.TECHID  END,   TIMEZONE =   CASE  WHEN cs.CUSTNMBR IS NULL THEN sm.TIMEZONE  WHEN cs.TIMEZONE = '' THEN   ISNULL((SELECT TOP 1 TIMEZONE FROM SVC00998),  '')  ELSE cs.TIMEZONE  END,  SVC_PM_Date =  CASE  WHEN cs.CUSTNMBR IS NULL THEN sm.SVC_PM_Date   WHEN cs.SVC_PM_Allowed = 0 THEN 0  ELSE cs.SVC_PM_Date  END,   SVC_PM_Day =   CASE   WHEN cs.CUSTNMBR IS NULL THEN sm.SVC_PM_Day  WHEN cs.SVC_PM_Allowed = 0 THEN 0  ELSE cs.SVC_PM_Day  END  FROM   SVC00300 as sm   LEFT OUTER JOIN RM00102 AS cm   ON sm.CUSTNMBR = cm.CUSTNMBR and sm.ADRSCODE = cm.ADRSCODE  LEFT OUTER JOIN SVC00950 AS cs   ON sm.CUSTNMBR = cs.CUSTNMBR and sm.ADRSCODE = cs.ADRSCODE   WHERE  sm.EQUIPID = @EQUIPID   IF @@ERROR = 0  return    
GO
GRANT EXECUTE ON  [dbo].[SVC_Update_Serial_Address] TO [DYNGRP]
GO
