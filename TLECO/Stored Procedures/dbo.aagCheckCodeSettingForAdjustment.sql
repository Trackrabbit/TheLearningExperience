SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO
 CREATE procedure [dbo].[aagCheckCodeSettingForAdjustment] @I_nValidationLevel smallint =0,  @I_nAcctClassID  int =0, @I_nActIndx int = 0, @I_nTrxDimID   int = 0, @I_nTrxDimCodeID  int = 0, @O_cTrxDim   varchar(15)= '' output, @O_cTrxDimCode  varchar(30)='' output, @O_nErrorNumber  int = 0 output, @I_UserID varchar(20), @I_Right int  as  declare @nDataEntry int, @nTrxDimCodeIDDflt int, @nDataType tinyint, @nTrxDimID int  set @O_nErrorNumber = 0  if @I_nTrxDimID = 0 return  if @I_nTrxDimID <> 0 and @I_nValidationLevel <> 2 begin  if NOT exists(select aaDataType from AAG00400 where aaTrxDimID = @I_nTrxDimID)  begin  select @O_nErrorNumber = 1   return  end  else  begin  if (select INACTIVE from AAG00400 where aaTrxDimID = @I_nTrxDimID) <> 0  begin  select @O_nErrorNumber = 3   select @O_cTrxDim =  aaTrxDim from AAG00400 where aaTrxDimID = @I_nTrxDimID  return  end  end end  select @nDataType = aaDataType from AAG00400 where aaTrxDimID = @I_nTrxDimID if @I_nTrxDimCodeID <> 0 begin   if @nDataType = 1 and @I_nValidationLevel <> 1  if NOT exists(select aaTrxDimCodeID from AAG00401 where aaTrxDimID = @I_nTrxDimID and aaTrxDimCodeID = @I_nTrxDimCodeID)  begin  select @O_nErrorNumber = 103   select @O_cTrxDim =  aaTrxDim from AAG00400 where aaTrxDimID = @I_nTrxDimID  return  end  else  begin  if (select INACTIVE from AAG00401 where aaTrxDimID = @I_nTrxDimID and aaTrxDimCodeID = @I_nTrxDimCodeID) <> 0  begin  select @O_nErrorNumber = 105   select @O_cTrxDim =  aaTrxDim from AAG00400 where aaTrxDimID = @I_nTrxDimID  select @O_cTrxDimCode = aaTrxDimCode from AAG00401 where aaTrxDimID = @I_nTrxDimID and aaTrxDimCodeID = @I_nTrxDimCodeID  return  end  end  else  if @nDataType = 2 and @I_nValidationLevel <> 1  begin  if NOT exists(select aaTrxDimID from AAG00402 where aaTrxDimID = @I_nTrxDimID and aaTrxDimCodeNumID = @I_nTrxDimCodeID)  begin  select @O_nErrorNumber = 103   select @O_cTrxDim =  aaTrxDim from AAG00400 where aaTrxDimID = @I_nTrxDimID  return  end  end  else  if @nDataType = 3 and @I_nValidationLevel <> 1  begin  if NOT exists(select aaTrxDimID from AAG00403 where aaTrxDimID = @I_nTrxDimID and aaTrxDimCodeBoolID = @I_nTrxDimCodeID)  begin  select @O_nErrorNumber = 103   select @O_cTrxDim =  aaTrxDim from AAG00400 where aaTrxDimID = @I_nTrxDimID  return  end  end  else  if @nDataType = 4 and @I_nValidationLevel <> 1  begin  if NOT exists(select aaTrxDimID from AAG00404 where aaTrxDimID = @I_nTrxDimID and aaTrxDimCodeDateID = @I_nTrxDimCodeID)  begin  select @O_nErrorNumber = 103   select @O_cTrxDim =  aaTrxDim from AAG00400 where aaTrxDimID = @I_nTrxDimID  return  end  end end  If Not Exists(Select aaAcctClassID from AAG00202 where aaAcctClassID = @I_nAcctClassID and aaTrxDimID = @I_nTrxDimID) Set @O_nErrorNumber = 2  select @nDataEntry = aaDataEntry,  @nTrxDimCodeIDDflt = aaTrxDimCodeIDDflt from AAG00202 where aaTrxDimID = @I_nTrxDimID and aaAcctClassID = @I_nAcctClassID  if @nDataEntry = 2  begin    if @I_nTrxDimCodeID <> 0 and @I_nValidationLevel <> 1  Begin  if @I_Right=2  if (select aaAdjust from AAG02000 where USERID=@I_UserID and aaTrxDimID=@I_nTrxDimID and aaTrxDimCodeID=@I_nTrxDimCodeID)=0  select @O_nErrorNumber = 114   end   if @I_nTrxDimCodeID = 0 and @I_nValidationLevel = 2  select @O_nErrorNumber = 104  end else   if @nDataEntry = 3  begin   if @I_nTrxDimCodeID <> 0 and @I_nValidationLevel <> 1  Begin  if @I_Right=2   begin  if (select aaAdjust from AAG02000 where USERID=@I_UserID and aaTrxDimID=@I_nTrxDimID and aaTrxDimCodeID=@I_nTrxDimCodeID)=0  select @O_nErrorNumber = 114   end  end end  else if @nDataEntry = 4  begin   if @I_nTrxDimCodeID <> 0 and @I_nValidationLevel <> 1  Begin  if @I_Right=2   begin  if (select aaAdjust from AAG02000 where USERID=@I_UserID and aaTrxDimID=@I_nTrxDimID and aaTrxDimCodeID=@I_nTrxDimCodeID)=0  select @O_nErrorNumber = 114   end  end   if @I_nTrxDimCodeID = 0 and @I_nValidationLevel <> 2  select @O_nErrorNumber = 8   else  begin   if @nTrxDimCodeIDDflt <> @I_nTrxDimCodeID and @I_nValidationLevel <> 2  select @O_nErrorNumber = 7   end end  if @I_nAcctClassID<>0 begin  if @I_Right=2   begin  if (select aaAdjust from AAG02000 where USERID=@I_UserID and aaTrxDimID=@I_nTrxDimID and aaTrxDimCodeID=@I_nTrxDimCodeID)=0  select @O_nErrorNumber = 114  select @O_cTrxDim =  aaTrxDim from AAG00400 where aaTrxDimID = @I_nTrxDimID  select @O_cTrxDimCode = aaTrxDimCode from AAG00401 where aaTrxDimID = @I_nTrxDimID and aaTrxDimCodeID = @I_nTrxDimCodeID   if @I_nTrxDimCodeID <> 0 and @I_nValidationLevel <> 1   begin  if   Exists(select aaTrxDimCodeID from  AAG02001 where aaTrxDimCodeID = @I_nTrxDimCodeID)  begin   if not Exists(select ACTINDX from  AAG02001 where ACTINDX = @I_nActIndx and aaTrxDimCodeID = @I_nTrxDimCodeID)  begin  select @O_nErrorNumber = 116  end  end  end   end end select @nDataEntry = aaDataEntry,  @nTrxDimCodeIDDflt = aaTrxDimCodeIDDflt from AAG00202 where aaTrxDimID = @I_nTrxDimID and aaAcctClassID = @I_nAcctClassID  if(select aaAllowAdjustment from AAG00407 where aaTrxDimID=@I_nTrxDimID)=1 if(select aaCodeReqdDrgAdj from AAG00407 where aaTrxDimID=@I_nTrxDimID)=1 if @I_nTrxDimCodeID = 0 and @I_nValidationLevel <> 1 Begin   select @O_nErrorNumber = 110   select @O_cTrxDim =  aaTrxDim from AAG00400 where aaTrxDimID = @I_nTrxDimID  select @O_cTrxDimCode = aaTrxDimCode from AAG00401 where aaTrxDimID = @I_nTrxDimID and aaTrxDimCodeID = @I_nTrxDimCodeID End  else   if @O_nErrorNumber <> 0 begin  select @O_cTrxDim =  aaTrxDim from AAG00400 where aaTrxDimID = @I_nTrxDimID  if @nDataType = 1 and @I_nTrxDimCodeID <> 0  select @O_cTrxDimCode = aaTrxDimCode from AAG00401 where aaTrxDimID = @I_nTrxDimID and aaTrxDimCodeID = @I_nTrxDimCodeID  else   if @nDataType = 2 and @I_nTrxDimCodeID <> 0  select @O_cTrxDimCode = aaTrxDimCode from AAG00401 where aaTrxDimID = @I_nTrxDimID and aaTrxDimCodeID = @I_nTrxDimCodeID  else   if @nDataType = 3 and @I_nTrxDimCodeID <> 0  select @O_cTrxDimCode = aaTrxDimCode from AAG00401 where aaTrxDimID = @I_nTrxDimID and aaTrxDimCodeID = @I_nTrxDimCodeID  else   if @nDataType = 4 and @I_nTrxDimCodeID <> 0  select @O_cTrxDimCode = aaTrxDimCode from AAG00401 where aaTrxDimID = @I_nTrxDimID and aaTrxDimCodeID = @I_nTrxDimCodeID  return end    
GO
GRANT EXECUTE ON  [dbo].[aagCheckCodeSettingForAdjustment] TO [DYNGRP]
GO
