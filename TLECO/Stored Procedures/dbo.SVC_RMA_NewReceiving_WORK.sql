SET QUOTED_IDENTIFIER OFF
GO
SET ANSI_NULLS ON
GO
 CREATE PROCEDURE [dbo].[SVC_RMA_NewReceiving_WORK]  (@USERID char(15)) AS  if (select count(*) from SVC00200) > 0    insert into SVC05015   SELECT @USERID,SVC05200.RETDOCID, SVC05200.LNSEQNBR,   case when IV00101.ITEMTYPE = 3 then 30 else SVC05200.RMA_Status end , isnull(SVC00200.TECHID,''),   SVC05200.RETTYPE, isnull(SVC05200.OFFID,''),   SVC05200.CUSTNMBR, SVC05200.ADRSCODE,   SVC05200.CUSTNAME, SVC05200.QUANTITY, isnull(SVC05200.ITEMNMBR,''),   isnull(SVC05200.Return_Item_Number,''),  isnull(SVC05200.QUANTITY,0),   isnull(SVC05200.Return_Location_Code,''),   case when SVC05200.CUSTOWN = 1 then '1' else '0' end,  isnull(SVC05200.ORDDOCID,''),   isnull(SVC05200.CALLNBR,''),  isnull(SVC05200.RETREF,''), 0,  case when ITMTRKOP > 1 then 1 else 0 end,  0,0,0,'','','','',SVC05200.UOFM,SVC05200.Return_U_Of_M, SVC05200.DECPLQTY  FROM SVC05200 LEFT JOIN  SVC00200 WITH (NOLOCK) ON (SVC05200.CALLNBR = SVC00200.CALLNBR and SVC05200.SRVRECTYPE = SVC00200.SRVRECTYPE)  Left join IV00101 on (SVC05200.Return_Item_Number = IV00101.ITEMNMBR)  left join SVC05015 on (SVC05200.RETDOCID = SVC05015.RETDOCID and SVC05200.LNSEQNBR = SVC05015.LNSEQNBR and SVC05015.USERID = @USERID)  WHERE SVC05200.Received = 0 and SVC05200.QUANTITY > 0 and SVC05200.svcRMAComponentSeq = 0 and SVC05200.RETDOCID not in (select RETDOCID from SVC05015 where SVC05015.LNSEQNBR = SVC05200.LNSEQNBR and SVC05015.USERID = @USERID) else   insert into SVC05015   SELECT @USERID,SVC05200.RETDOCID, SVC05200.LNSEQNBR,   case when IV00101.ITEMTYPE = 3 then 30 else SVC05200.RMA_Status end , '',   SVC05200.RETTYPE, isnull(SVC05200.OFFID,''),   SVC05200.CUSTNMBR, SVC05200.ADRSCODE,   SVC05200.CUSTNAME, SVC05200.QUANTITY, isnull(SVC05200.ITEMNMBR,''),   isnull(SVC05200.Return_Item_Number,''),  isnull(SVC05200.QUANTITY,0),   isnull(SVC05200.Return_Location_Code,''),   case when SVC05200.CUSTOWN = 1 then '1' else '0' end,  isnull(SVC05200.ORDDOCID,''),   isnull(SVC05200.CALLNBR,''),  isnull(SVC05200.RETREF,''), 0,  case when ITMTRKOP > 1 then 1 else 0 end,  0,0,0,'','','','',SVC05200.UOFM,SVC05200.Return_U_Of_M, SVC05200.DECPLQTY  FROM SVC05200  Left join IV00101 on (SVC05200.Return_Item_Number = IV00101.ITEMNMBR)  left join SVC05015 on (SVC05200.RETDOCID = SVC05015.RETDOCID and SVC05200.LNSEQNBR = SVC05015.LNSEQNBR and SVC05015.USERID = @USERID)  WHERE SVC05200.Received = 0 and SVC05200.QUANTITY > 0 and SVC05200.svcRMAComponentSeq = 0 and SVC05200.RETDOCID not in (select RETDOCID from SVC05015 where SVC05015.LNSEQNBR = SVC05200.LNSEQNBR and SVC05015.USERID = @USERID) if (select count(*) from SVC05015 where USERID = @USERID and POSTED = 1) > 0   delete from SVC05015 with (rowlock) where USERID = @USERID and POSTED = 1 return    
GO
GRANT EXECUTE ON  [dbo].[SVC_RMA_NewReceiving_WORK] TO [DYNGRP]
GO
