SET QUOTED_IDENTIFIER OFF
GO
SET ANSI_NULLS ON
GO
 create procedure [dbo].[taBRDeleteBankDeposits]  @I_vCHEKBKID char(15),    @I_vdepositnumber char(20),   @I_vRequesterTrx smallint = 0,   @I_vUSRDEFND1 char(50) = '',       @I_vUSRDEFND2 char(50) = '',       @I_vUSRDEFND3 char(50) = '',       @I_vUSRDEFND4 varchar(8000) = '',  @I_vUSRDEFND5 varchar(8000) = '',  @O_iErrorState int output,   @oErrString varchar(255) output  with encryption as  set transaction isolation level read uncommitted set nocount on  declare   @iStatus int,  @O_oErrorState int,  @iError int,  @iCustomState int,  @iCustomErrString varchar(255)  select  @iStatus = 0,  @O_oErrorState = 0,  @iError = 0,  @iCustomState = 0,  @iCustomErrString = '',  @O_iErrorState = 0  if (@oErrString is null) begin  select @oErrString = '' end  exec @iStatus = taBRDeleteBankDepositsPre  @I_vCHEKBKID output,  @I_vdepositnumber output,  @I_vRequesterTrx output,  @I_vUSRDEFND1 output,  @I_vUSRDEFND2 output,  @I_vUSRDEFND3 output,  @I_vUSRDEFND4 output,  @I_vUSRDEFND5 output,  @O_iErrorState = @iCustomState output,  @oErrString = @iCustomErrString output select @iError = @@error if ((@iStatus <> 0) or (@iCustomState <> 0) or (@iError <> 0)) begin  select @oErrString = rtrim(@oErrString) + ' ' + @iCustomErrString  select @O_iErrorState = 7391    exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output  return (@O_iErrorState) end  if (  @I_vCHEKBKID is null or  @I_vdepositnumber is null or  @I_vRequesterTrx is null or  @I_vUSRDEFND1 is null or  @I_vUSRDEFND2 is null or  @I_vUSRDEFND3 is null or  @I_vUSRDEFND4 is null or  @I_vUSRDEFND5 is null  ) begin  select @O_iErrorState = 7392    exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output  return (@O_iErrorState) end  select  @I_vCHEKBKID = UPPER(@I_vCHEKBKID),  @I_vdepositnumber = UPPER(@I_vdepositnumber)  if (@I_vCHEKBKID = '') begin  select @O_iErrorState = 7393     exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output end  if (@I_vdepositnumber = '') begin  select @O_iErrorState = 7394     exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output end  if ((@I_vRequesterTrx < 0) or (@I_vRequesterTrx > 1)) begin  select @O_iErrorState = 7395     exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output end  if (not exists(select 1 from CM10100 (nolock) where CHEKBKID = @I_vCHEKBKID and depositnumber = @I_vdepositnumber)) begin  select @O_iErrorState = 7396     exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output end  if (exists(select 1 from CM20300 (nolock) where CHEKBKID = @I_vCHEKBKID and depositnumber = @I_vdepositnumber and ((DEPOSITED = 1) or (VOIDED = 1)))) begin  select @O_iErrorState = 7397     exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output end  if (@O_iErrorState <> 0) begin  return (@O_iErrorState) end  delete CM10100 where CHEKBKID = @I_vCHEKBKID and depositnumber = @I_vdepositnumber if (@@error <> 0) begin  select @O_iErrorState = 7398    exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output  return (@O_iErrorState) end  delete CM10101 where CHEKBKID = @I_vCHEKBKID and depositnumber = @I_vdepositnumber if (@@error <> 0) begin  select @O_iErrorState = 7399    exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output  return (@O_iErrorState) end  update CM20300 set  MODIFDT = convert(varchar(12),getdate()),  depositnumber = ''  where CHEKBKID = @I_vCHEKBKID and depositnumber = @I_vdepositnumber and DEPOSITED = 0 if (@@error <> 0) begin  select @O_iErrorState = 7402    exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output  return (@O_iErrorState) end  exec @iStatus = taBRDeleteBankDepositsPost  @I_vCHEKBKID,  @I_vdepositnumber,  @I_vRequesterTrx,  @I_vUSRDEFND1,  @I_vUSRDEFND2,  @I_vUSRDEFND3,  @I_vUSRDEFND4,  @I_vUSRDEFND5,  @O_iErrorState = @iCustomState output,  @oErrString = @iCustomErrString output select @iError = @@error if ((@iStatus <> 0) or (@iCustomState <> 0) or (@iError <> 0)) begin  select @oErrString = rtrim(@oErrString) + ' ' + @iCustomErrString  select @O_iErrorState = 7400    exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output  return (@O_iErrorState) end  return (@O_iErrorState)   
GO
GRANT EXECUTE ON  [dbo].[taBRDeleteBankDeposits] TO [DYNGRP]
GO
