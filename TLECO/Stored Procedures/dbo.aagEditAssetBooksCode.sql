SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO
CREATE PROCEDURE [dbo].[aagEditAssetBooksCode] (  @AssetIndex INTEGER,  @ListId SMALLINT,  @aaTrxDimId INTEGER,  @aaTrxDimCodeId INTEGER,   @aaAliasID INTEGER ) AS BEGIN  DECLARE @aaFASetupID INTEGER   DECLARE UPDATECODE CURSOR FAST_FORWARD FOR  SELECT aaFASetupID FROM AAG04000 WHERE  aaAssetIndex=@AssetIndex and aaBookIndex > 0 and ListID = @ListId  OPEN UPDATECODE  FETCH NEXT FROM UPDATECODE INTO @aaFASetupID  WHILE @@fetch_status = 0  BEGIN  UPDATE AAG04000 SET aaAliasID = @aaAliasID WHERE aaFASetupID = @aaFASetupID and ListID =@ListId  IF (SELECT COUNT(*) FROM AAG04001 WHERE aaFASetupID=@aaFASetupID and ListID=@ListId and aaTrxDimID=@aaTrxDimId)>0  UPDATE AAG04001 SET aaTrxDimCodeID=@aaTrxDimCodeId WHERE aaFASetupID=@aaFASetupID and ListID=@ListId and aaTrxDimID=@aaTrxDimId  ELSE  INSERT INTO AAG04001 VALUES (@aaFASetupID,@ListId,@aaTrxDimId,@aaTrxDimCodeId)  FETCH NEXT FROM UPDATECODE INTO @aaFASetupID  END  CLOSE UPDATECODE  DEALLOCATE UPDATECODE END SET QUOTED_IDENTIFIER OFF    
GO
GRANT EXECUTE ON  [dbo].[aagEditAssetBooksCode] TO [DYNGRP]
GO
