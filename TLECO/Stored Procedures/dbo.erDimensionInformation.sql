SET QUOTED_IDENTIFIER OFF
GO
SET ANSI_NULLS OFF
GO
 create procedure [dbo].[erDimensionInformation] @list_of_segments varchar(255)=NULL as  declare   @vSelectAcct varchar(255),  @vSelectAcct1 varchar(255),  @vSelectAcct2 varchar(255),  @vSelectDesc varchar(255),  @vSelectDesc1 varchar(255),  @vSelectDesc2 varchar(255),  @vFromClause varchar(255),  @vWhereClause varchar(255),  @vWhereClause1 varchar(255),  @vWhereClause2 varchar(255),  @cTableAlias char(2),  @vAcctSegName varchar(20),  @vAcctColName varchar(20),  @vDescName varchar(20),  @tNumberSegments tinyint,  @tLoopControl tinyint,  @cIndex char(2),  @vInternalSegList varchar(255),  @vSortOrder varchar(255),  @bFirstSelectTerm bit,  @iRetval integer  select @tLoopControl    = 1 select @bFirstSelectTerm  = 1 select @vSelectAcct    = '' select @vSelectAcct1   = '' select @vSelectAcct2   = '' select @vSelectDesc    = '' select @vSelectDesc1   = '' select @vSelectDesc2   = '' select @vFromClause    = '' select @vWhereClause   = '' select @vWhereClause1   = '' select @vWhereClause2   = '' select @vSortOrder    = ''  set nocount on exec @iRetval = erInternalParseSegmentList   @list_of_segments,   @vInternalSegList out,   @vSortOrder out,  @tNumberSegments out if @iRetval <> 0 begin  return @iRetval end  while @tLoopControl <= @tNumberSegments begin  select @cIndex = ltrim(str(@tLoopControl))  if substring(@vInternalSegList,@tLoopControl,1) = '1'  begin   select @cTableAlias  = 'T' + @cIndex  select @vAcctSegName = 'account_number_' + @cIndex  select @vAcctColName = 'ACTNUMBR_' + @cIndex  select @vDescName  = 'description_' + @cIndex   select @vFromClause = @vFromClause + ',GL40200 ' + @cTableAlias   select @vSelectDesc = @vSelectDesc + ',' +  @vDescName + ' = ' +   @cTableAlias + '.DSCRIPTN'   if @bFirstSelectTerm = 1  begin  select @vSelectAcct  = @vAcctSegName + ' = ' + @vAcctColName   select @vWhereClause = @vAcctColName + '= '+ @cTableAlias +   '.SGMNTID and ' + @cTableAlias +   '.SGMTNUMB=' + @cIndex  select @bFirstSelectTerm = 0  end  else  begin  select @vSelectAcct  = @vSelectAcct + ',' +  @vAcctSegName + ' = ' +   @vAcctColName  select @vWhereClause = @vWhereClause + ' and ' +  @vAcctColName + '= '+ @cTableAlias +   '.SGMNTID and ' + @cTableAlias +   '.SGMTNUMB=' + @cIndex  end    end  if @tLoopControl = 5  begin  select @vSelectAcct1 = @vSelectAcct  select @vSelectDesc1 = @vSelectDesc  select @vWhereClause1 = @vWhereClause  select @vSelectAcct  = ''  select @vSelectDesc  = ''  select @vWhereClause = ''  end  if @tLoopControl = 10  begin  select @vSelectAcct2 = @vSelectAcct  select @vSelectDesc2 = @vSelectDesc  select @vWhereClause2 = @vWhereClause  select @vSelectAcct  = ''  select @vSelectDesc  = ''  select @vWhereClause = ''  end   select @tLoopControl = @tLoopControl + 1 end  exec (   'select DISTINCT ' +  @vSelectAcct1 + @vSelectAcct2 + @vSelectAcct +  @vSelectDesc1 + @vSelectDesc2 + @vSelectDesc +  ' from GL00100' + @vFromClause +  ' where ACCTTYPE >= 1 and ACCTTYPE <= 2 and ' +  @vWhereClause1 + @vWhereClause2 + @vWhereClause +  ' order by ' + @vSortOrder )  return 0    
GO
GRANT EXECUTE ON  [dbo].[erDimensionInformation] TO [DYNGRP]
GO
