SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO
 CREATE procedure [dbo].[SVC_Obj_GetListPrice]( @ServiceType char(11), @Location char(1), @ListPrice numeric(19,5)output, @ItemNumber char(31) ) as declare @UpdatePrice tinyint,  @CBADDNL tinyint,  @CBARTS tinyint,  @CBEXP tinyint,  @CBLABOR tinyint,  @DLRORPCT char(1),  @Price numeric(19,5),  @Item char(31)  declare LineCheck CURSOR for   select CBADDNL,CBARTS,CBEXP,CBLABOR,DLRORPCT,LISTPRCE,ITEMNMBR from SVC00921 where SRVTYPE = @ServiceType order by LNITMSEQ open LineCheck fetch next from LineCheck into @CBADDNL,@CBARTS,@CBEXP,@CBLABOR,@DLRORPCT,@Price,@Item WHILE (@@FETCH_status <> -1) BEGIN  select @UpdatePrice = 0  if Upper(@Location) = 'A'  begin  if @CBADDNL = 1 and (rtrim(@Item) = rtrim(@ItemNumber) or  rtrim(@Item) = '')  select @UpdatePrice = 1  else   select @UpdatePrice = 0  end  if Upper(@Location) = 'P'  begin  if @CBARTS = 1 and (rtrim(@Item) = rtrim(@ItemNumber) or rtrim(@Item) = '')  select @UpdatePrice = 1  else   select @UpdatePrice = 0  end  if Upper(@Location) = 'E'  begin  if @CBEXP = 1 and (rtrim(@Item) = rtrim(@ItemNumber) or rtrim(@Item) = '')  select @UpdatePrice = 1  else   select @UpdatePrice = 0  end  if Upper(@Location) = 'L'  begin  if @CBLABOR = 1 and (rtrim(@Item) = rtrim(@ItemNumber) or rtrim(@Item) = '')  select @UpdatePrice = 1  else   select @UpdatePrice = 0  end   if rtrim(@DLRORPCT) = 'A' and @UpdatePrice = 1   Begin  select @ListPrice = @Price + @ListPrice  end  else if rtrim(@DLRORPCT) = 'P' and @UpdatePrice = 1  Begin  select @ListPrice = (1+(@Price/100)) * @ListPrice   end  fetch next from LineCheck into @CBADDNL,@CBARTS,@CBEXP,@CBLABOR,@DLRORPCT,@Price,@Item END close LineCheck DEALLOCATE LineCheck   
GO
GRANT EXECUTE ON  [dbo].[SVC_Obj_GetListPrice] TO [DYNGRP]
GO
