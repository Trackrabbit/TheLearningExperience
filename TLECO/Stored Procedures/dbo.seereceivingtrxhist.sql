SET QUOTED_IDENTIFIER OFF
GO
SET ANSI_NULLS ON
GO
 create procedure [dbo].[seereceivingtrxhist] @ReceiptNumber_RS varchar(12), @ReceiptNumber_RE varchar(12)  as set nocount on  select  r.PONUMBER as [PO Number], r.POLNENUM as [PO Line Number], h.VNDDOCNM as [VendorDoc], h.TRXSORCE as [Audit Trail Code], r.CURNCYID as [Currency ID], r.VENDORID as [Vendor ID], p.VENDNAME as [Vendor Name], r.ITEMNMBR as [Item Number], r.POPRCTNM as [Receipt Number], r.RCPTLNNM as [Receipt Line], r.DATERECD as [Date Received], r.DATERECD as [Date Received Parameter], r.TRXLOCTN as [Site ID], r.UOFM as [Shipment UOM], r.QTYSHPPD AS [Qty Shipped], r.QTYINVCD as [Qty Invoiced], r.QTYREJ as [Qty Rejected], rl.UNITCOST as [PO Unit Cost], rl.EXTDCOST as [PO Extended Cost], h.SUBTOTAL as [Subtotal], h.TRDISAMT as [Discount], h.FRTAMNT as [Freight], h.MISCAMNT as [Miscellaneous], h.TAXAMNT as [Tax], (h.SUBTOTAL-h.TRDISAMT+h.FRTAMNT+h.MISCAMNT+h.TAXAMNT )as [Total], h.VOIDSTTS as [Void Status], isnull(s.SERLTNUM,'') as [Serial Number], isnull(s.SERLTQTY, 0) as [Serial Quantity], case when h.Total_Landed_Cost_Amount <>0 then 1 else 0 end as [Landed Cost Invoice]  into #temp_rectrxhist  from POP10500 r join POP30300 h on  r.POPRCTNM =h.POPRCTNM   left join PM20000 t on  h.VNDDOCNM = t.DOCNUMBR   left join PM00200 p on   r.VENDORID =p.VENDORID  left join POP30330 s on  s.POPRCTNM = r.POPRCTNM and  s.RCPTLNNM = r.RCPTLNNM   left join POP30310 rl on  r.POPRCTNM = rl.POPRCTNM and  r.RCPTLNNM = rl.RCPTLNNM  where h.POPRCTNM between @ReceiptNumber_RS and @ReceiptNumber_RE  group by r.PONUMBER, r.POLNENUM, r.POPRCTNM, r.RCPTLNNM,  r.CURNCYID, r.VENDORID, p.VENDNAME, r.Status, r.ITEMNMBR, r.DATERECD, r.TRXLOCTN, r.ORCPTCOST, r.XCHGRATE, r.RATECALC, r.UOFM, h.VOIDSTTS, r.QTYSHPPD, r.QTYINVCD, r.QTYREJ, h.VNDDOCNM, h.TRXSORCE, rl.UNITCOST, rl.EXTDCOST, h.SUBTOTAL, h.TRDISAMT, h.FRTAMNT, h.MISCAMNT, h.TAXAMNT, h.TEN99AMNT, s.SERLTNUM, s.SERLTQTY, h.Total_Landed_Cost_Amount order by r.POPRCTNM  SELECT  rni.[PO Number], rni.[PO Line Number], rni.[Currency ID], rni.[Vendor ID], rni.[Vendor Name], rni.[VendorDoc], rni.[Audit Trail Code] as [Audit Trail Code], rni.[Item Number], isnull(s.VNDITNUM, rni.[Item Number]) as [Vendor Item], isnull(i.ITEMDESC, '') as [Item Description], rni.[PO Unit Cost], rni.[PO Extended Cost], rni.[Receipt Number], rni.[Receipt Line], Convert(char(10),rni.[Date Received],101) as [Date Received], rni.[Date Received] as [Date Received Parameter], rni.[Site ID], rni.[Shipment UOM], rni.[Qty Shipped], rni.[Qty Invoiced], rni.[Qty Rejected], rni.[Subtotal], rni.[Discount], rni.[Freight], rni.[Miscellaneous], rni.[Tax], rni.[Total], rni.[Serial Number], rni.[Serial Quantity], rni.[Void Status], rni.[Landed Cost Invoice], i.ITEMTYPE as [Item Type]  into #temp_rectrxhistdetails   from #temp_rectrxhist rni left join IV00101 i on rni.[Item Number] = i.ITEMNMBR left join IV00103 s on  rni.[Item Number] = s.ITEMNMBR and  rni.[Vendor ID] = s.VENDORID left join POP10110 p on  rni.[PO Number] = p.PONUMBER and rni.[Item Number] = p.ITEMNMBR  left join POP30110 ph on  rni.[PO Number] = ph.PONUMBER and rni.[Item Number] = ph.ITEMNMBR   select * from #temp_rectrxhistdetails  order by [Receipt Number], [PO Line Number]   
GO
GRANT EXECUTE ON  [dbo].[seereceivingtrxhist] TO [DYNGRP]
GO
GRANT EXECUTE ON  [dbo].[seereceivingtrxhist] TO [rpt_purchasing agent]
GO
GRANT EXECUTE ON  [dbo].[seereceivingtrxhist] TO [rpt_purchasing manager]
GO
GRANT EXECUTE ON  [dbo].[seereceivingtrxhist] TO [rpt_shipping and receiving]
GO
