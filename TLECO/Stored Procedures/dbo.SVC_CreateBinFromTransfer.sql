SET QUOTED_IDENTIFIER OFF
GO
SET ANSI_NULLS ON
GO
 create procedure [dbo].[SVC_CreateBinFromTransfer]  (@DocType smallint,  @RecType smallint,  @DocNumber char(20),  @Line numeric(19,5),  @ORDDOCID char(15),   @TransferLine integer,   @CMPNTSEQ int = 0 ) as  declare @Location char(10), @ToLocation Char(10) declare @Item char(30) declare @Bin char(15), @ToBin char(15) declare @Qty numeric(19,5) declare @SEQNUMBR int  declare XBin_record cursor for select ITEMNMBR, TRNSFLOC, LOCNCODE, BIN, QUANTITY, TOBIN from SVC00712  where ORDDOCID = @ORDDOCID and LNITMSEQ = @TransferLine open XBin_record   fetch next from XBin_record into @Item, @Location, @ToLocation, @Bin, @Qty, @ToBin  while @@FETCH_STATUS = 0  begin  if @DocType = 3   Begin  if not exists(select * from SVC05212 where Return_Record_Type = @RecType and RETDOCID = @DocNumber and LNSEQNBR = @Line)  exec SVC_Bin_CreateBinWork @DocType, @RecType, @DocNumber, @Line,  @Item, @Location, @ToLocation, @ToBin, @ToBin, @Qty , @CMPNTSEQ  else  update SVC05212 set LOCNCODE = @ToLocation, BIN = @ToBin   where Return_Record_Type = @RecType and RETDOCID = @DocNumber and LNSEQNBR = @Line  End  else  Begin  exec SVC_Bin_CreateBinWork @DocType, @RecType, @DocNumber, @Line,  @Item, @Location, @ToLocation, @ToBin, @ToBin, @Qty, @CMPNTSEQ  if not exists(select * from IV00112 where ITEMNMBR = @Item and LOCNCODE = @ToLocation  and QTYTYPE = 1 and BIN = @ToBin)   insert into IV00112 select @Item,@ToLocation,@ToBin,1,0,0  update IV00112 set ATYALLOC = ATYALLOC + @Qty where ITEMNMBR = @Item and LOCNCODE = @ToLocation  and QTYTYPE = 1 and BIN = @ToBin  End  fetch next from XBin_record into @Item, @Location, @ToLocation, @Bin, @Qty, @ToBin  end deallocate XBin_record    
GO
GRANT EXECUTE ON  [dbo].[SVC_CreateBinFromTransfer] TO [DYNGRP]
GO
