SET QUOTED_IDENTIFIER OFF
GO
SET ANSI_NULLS ON
GO
 create procedure [dbo].[sopLineWorkTemp]  @TempTable varchar(31),      @SopNumber varchar(21),   @SopType smallint,  @O_iErrorState int     = NULL output as  set nocount on  declare @sql_statement as varchar(8000), @lSOPNUMBER AS varchar(21),  @lSOPTYPE AS smallint, @lLIS as int, @lCS as int, @ItemNumber as varchar(31), @Site as varchar(11), @SOFulfillmentBin varchar(15), @MultipleBins tinyint, @lOuterOrd as int, @lInnerOrd as int  exec ('delete from '+ @TempTable)  select @O_iErrorState = 0,@SOFulfillmentBin=''  if(@TempTable is NULL or  @SopNumber is NULL or  @SopType Is NULL) begin  select          @O_iErrorState = 21022  return end  declare SelectRegularLines cursor local fast_forward  for   select SOPNUMBE,SOPTYPE,LNITMSEQ  from SOP10200   WHERE SOP10200.SOPTYPE = @SopType AND   SOP10200.SOPNUMBE = @SopNumber AND   CMPNTSEQ=0   ORDER BY LOCNCODE,SOFULFILLMENTBIN,ITEMNMBR  open SelectRegularLines fetch next from SelectRegularLines into  @lSOPNUMBER,@lSOPTYPE,@lLIS select @lOuterOrd = 16384 while @@fetch_status = 0  Begin  select @sql_statement = ''  select @sql_statement = 'INSERT INTO '+@TempTable + ' SELECT '  select @sql_statement = @sql_statement + cast(@lOuterOrd as varchar(30))+','  select @sql_statement = @sql_statement + ''''+@lSOPNUMBER+''''+','  select @sql_statement = @sql_statement + cast(@lSOPTYPE as varchar(30))+','  select @sql_statement = @sql_statement + cast(@lLIS as varchar(30))+','  select @sql_statement = @sql_statement +'0'  exec(@sql_statement)  declare SelectKitLines cursor local fast_forward   for   select SOPNUMBE,SOPTYPE,LNITMSEQ,CMPNTSEQ  from SOP10200   where SOP10200.SOPNUMBE = @lSOPNUMBER AND SOP10200.SOPTYPE = @lSOPTYPE AND   SOP10200.LNITMSEQ = @lLIS AND CMPNTSEQ<>0  order by LOCNCODE,SOFULFILLMENTBIN,ITEMNMBR  open SelectKitLines  fetch next from SelectKitLines into @lSOPNUMBER,@lSOPTYPE,@lLIS,@lCS  select @lInnerOrd = @lOuterOrd+1  while @@fetch_status = 0   begin  select @sql_statement = ''  select @sql_statement = 'INSERT INTO '+@TempTable + ' SELECT '  select @sql_statement = @sql_statement + cast(@lInnerOrd as char(30))+','  select @sql_statement = @sql_statement + ''''+@lSOPNUMBER+''''+','  select @sql_statement = @sql_statement + cast(@lSOPTYPE as char(30))+','  select @sql_statement = @sql_statement + cast(@lLIS as char(30))+','  select @sql_statement = @sql_statement +cast(@lCS as char(30))  exec(@sql_statement)   fetch next from SelectKitLines into @lSOPNUMBER,@lSOPTYPE,@lLIS,@lCS  select @lInnerOrd = @lInnerOrd+1  end   close SelectKitLines  deallocate SelectKitLines   fetch next from SelectRegularLines into @lSOPNUMBER,@lSOPTYPE,@lLIS  select @lOuterOrd = @lOuterOrd + 16384 end  close SelectRegularLines deallocate SelectRegularLines  set nocount OFF RETURN    
GO
GRANT EXECUTE ON  [dbo].[sopLineWorkTemp] TO [DYNGRP]
GO
