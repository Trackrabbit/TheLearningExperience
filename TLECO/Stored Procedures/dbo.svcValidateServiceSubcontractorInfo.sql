SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO
 CREATE PROC [dbo].[svcValidateServiceSubcontractorInfo]  @I_vSRVRECTYPE smallint,  @I_vCALLNBR char(11),  @I_vSRVTYPE char(11),  @I_vEQPLINE integer,  @I_vLINITMTYP char(3),  @I_vLNITMSEQ integer,  @I_vTECHID char(11),  @O_vErrorState integer  output,  @O_vErrorString char(255)  output AS  declare @iRecordExists   smallint,  @svcSubContractor  tinyint,  @svcPayableBatchID  char(15),  @VENDORID   char(15),  @TECHID   char(11)  select  @I_vSRVRECTYPE = isnull(@I_vSRVRECTYPE, 0),  @I_vCALLNBR = isnull(@I_vCALLNBR, ''),  @I_vSRVTYPE = isnull(@I_vSRVTYPE, ''),  @I_vEQPLINE = isnull(@I_vEQPLINE, 0),  @I_vLINITMTYP = isnull(@I_vLINITMTYP, ''),  @I_vLNITMSEQ = isnull(@I_vLNITMSEQ, 0),  @I_vTECHID = isnull(@I_vTECHID, ''),  @O_vErrorState = 0,  @O_vErrorString = '',  @iRecordExists = 0,  @svcSubContractor = 0,  @svcPayableBatchID = '',  @TECHID = '',  @VENDORID = ''  if ( @I_vSRVRECTYPE <= 0 or  @I_vCALLNBR = '') begin  select  @O_vErrorState = 0,  @O_vErrorString = ''  return (@O_vErrorState) end  if (@I_vSRVTYPE = '') begin  set @iRecordExists = 0  select  @iRecordExists = 1,  @I_vSRVTYPE = isnull(SRVTYPE, ''),  @TECHID = isnull(TECHID, '')  from SVC00200   where SRVRECTYPE = @I_vSRVRECTYPE and CALLNBR = @I_vCALLNBR  if (@iRecordExists <> 1)  begin  select  @O_vErrorState = 1001,  @O_vErrorString = 'Service Call ' + rtrim(@I_vCALLNBR) + ' does not exist.'  return (@O_vErrorState)  end end  if (@I_vSRVTYPE = '') begin  select  @O_vErrorState = 1002,  @O_vErrorString = 'Service Type is not entered for the Service Call ' + rtrim(@I_vCALLNBR) + '. '  return (@O_vErrorState) end  set @iRecordExists = 0 select  @iRecordExists = 1,  @svcSubContractor = isnull(svcSubcontractor, 0),  @svcPayableBatchID = isnull(svcPayableBatchID, '')  from SVC00920  where SRVTYPE = @I_vSRVTYPE  if (@iRecordExists <> 1) begin  select  @O_vErrorState = 1003,  @O_vErrorString = 'Service Type ' + rtrim(@I_vSRVTYPE) + ' does not exist.'  return (@O_vErrorState) end  if (@svcSubContractor <> 1) begin  select  @O_vErrorState = 1004,  @O_vErrorString = 'Service Type ' + rtrim(@I_vSRVTYPE) + ' is not setup for Subcontractor.'  return (@O_vErrorState) end  if (@svcSubContractor <> 1 and @svcPayableBatchID = '') begin  select  @O_vErrorState = 1005,  @O_vErrorString = 'Subcontractor feature requires a valid Payables Batch ID setup for Service Type ' + rtrim(@I_vSRVTYPE) + '. '  return (@O_vErrorState) end  if (@I_vTECHID = '') begin  if (@I_vEQPLINE > 0 and @I_vLINITMTYP in ('L', 'A', 'E') and @I_vLNITMSEQ > 0)  begin  set @iRecordExists = 0  select  @iRecordExists = 1,  @I_vTECHID = isnull(TECHID, '')  from SVC00203  where SRVRECTYPE = @I_vSRVRECTYPE and CALLNBR = @I_vCALLNBR   and EQPLINE = @I_vEQPLINE and LINITMTYP = @I_vLINITMTYP and LNITMSEQ = @I_vLNITMSEQ  end   select @I_vTECHID = case  when @I_vTECHID is null or @I_vTECHID = '' then @TECHID  else @I_vTECHID  end end  if (@I_vTECHID <> '') begin  set @iRecordExists = 0  select  @iRecordExists = 1,  @VENDORID = isnull(VENDORID, '')  from SVC00100  WHERE TECHID = @I_vTECHID  if (@iRecordExists <> 1)  begin  select  @O_vErrorState = 1006,  @O_vErrorString = 'Technician ' + rtrim(@I_vTECHID) + ' does not exist. '  return (@O_vErrorState)  end  if (@VENDORID = '')  begin  select  @O_vErrorState = 2001,  @O_vErrorString = 'A valid Vendor ID is not set for the Technician ' + rtrim(@I_vTECHID)  return (@O_vErrorState)  end end  return (0)   
GO
GRANT EXECUTE ON  [dbo].[svcValidateServiceSubcontractorInfo] TO [DYNGRP]
GO
