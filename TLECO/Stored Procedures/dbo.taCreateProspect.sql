SET QUOTED_IDENTIFIER OFF
GO
SET ANSI_NULLS ON
GO
 create procedure [dbo].[taCreateProspect]  @I_vPROSPID  char(15),   @I_vCUSTNAME  char(65)='',   @I_vCNTCPRSN  char(60)='',   @I_vADDRESS1  char(60)='',   @I_vADDRESS2  char(60)='',   @I_vADDRESS3  char(60)='',   @I_vCITY  char(35)='',             @I_vSTATE  char(29)='',   @I_vZIP  char(10)='',   @I_vCOUNTRY  char(60)='',   @I_vCUSTCLAS  char(15)='',   @I_vPHONE1  char(21)='',   @I_vPHONE2  char(21)='',   @I_vPHONE3  char(21)='',   @I_vPRCLEVEL char(10)='',   @I_vFAX char(21)='',   @I_vSHIPMTHD char(15)='',   @I_vTAXSCHID char(15)='',   @I_vUSERDEF1 char(20)='',   @I_vUSERDEF2 char(20)='',   @I_vUSER2ENT char(15)='',   @I_vCREATDDT datetime='',   @I_vMODIFDT datetime='',    @I_vUSRDEFND1  char(50) = '',       @I_vUSRDEFND2  char(50) = '',       @I_vUSRDEFND3  char(50) = '',       @I_vUSRDEFND4  varchar(8000) = '',  @I_vUSRDEFND5  varchar(8000) = '',  @O_iErrorState int output,   @oErrString  varchar(255) output   with encryption as  set transaction isolation level read uncommitted set nocount on  declare  @iStatus int,  @iCustomState int,  @iError int,  @O_oErrorState int,  @iAddCodeErrState int,  @NOTEINDX decimal(19,5),  @CMPANYID smallint,  @iGetNextNoteIdxErrState int,   @iCustomErrString varchar(255)  select  @NOTEINDX = 0,  @iStatus = 0,  @iCustomState = 0,  @iError = 0,  @O_oErrorState = 0,  @iAddCodeErrState = 0,  @O_iErrorState = 0    if (@oErrString is NULL) begin  select @oErrString = '' end  exec @iStatus = taCreateProspectPre  @I_vPROSPID  output,  @I_vCUSTNAME  output,  @I_vCNTCPRSN  output,  @I_vADDRESS1  output,  @I_vADDRESS2  output,  @I_vADDRESS3  output,  @I_vCITY  output,  @I_vSTATE  output,  @I_vZIP  output,  @I_vCOUNTRY  output,  @I_vCUSTCLAS  output,  @I_vPHONE1  output,  @I_vPHONE2  output,  @I_vPHONE3  output,  @I_vPRCLEVEL output,  @I_vFAX output,  @I_vSHIPMTHD output,  @I_vTAXSCHID output,  @I_vUSERDEF1 output,  @I_vUSERDEF2 output,  @I_vUSER2ENT  output,  @I_vCREATDDT  output,  @I_vMODIFDT output,  @I_vUSRDEFND1 output,  @I_vUSRDEFND2 output,  @I_vUSRDEFND3 output,  @I_vUSRDEFND4 output,  @I_vUSRDEFND5 output,  @O_iErrorState  = @iCustomState output,  @oErrString = @iCustomErrString output select @iError = @@error if @iStatus = 0 and @iError <> 0 begin  select @iStatus = @iError end if (@iStatus <> 0) or (@iCustomState <> 0) begin  select @oErrString = rtrim(@oErrString) + ' ' + ltrim(rtrim(@iCustomErrString))  select @O_iErrorState = 2063   exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output  return (@O_iErrorState) end  if ( @I_vPROSPID is null or  @I_vCUSTNAME is null or  @I_vCNTCPRSN is null or  @I_vADDRESS1 is null or  @I_vADDRESS2 is null or  @I_vADDRESS3 is null or  @I_vCITY is null or  @I_vSTATE is null or  @I_vZIP is null or  @I_vCOUNTRY is null or  @I_vPHONE1 is null or  @I_vPHONE2 is null or  @I_vPHONE3 is null or  @I_vPRCLEVEL is null or  @I_vFAX is null or   @I_vSHIPMTHD is null or  @I_vTAXSCHID is null or  @I_vUSERDEF1 is null or  @I_vUSERDEF2 is null or   @I_vUSER2ENT is null or  @I_vCREATDDT is null or   @I_vMODIFDT is null ) begin  select @O_iErrorState = 2064    exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @iAddCodeErrState output end  select  @I_vPROSPID = UPPER(@I_vPROSPID),  @I_vSHIPMTHD = UPPER(@I_vSHIPMTHD),  @I_vTAXSCHID = UPPER(@I_vTAXSCHID),  @I_vPRCLEVEL = UPPER(@I_vPRCLEVEL),  @I_vCUSTCLAS = UPPER(@I_vCUSTCLAS)  select @CMPANYID = CMPANYID from DYNAMICS..SY01500 (nolock) where INTERID = db_name()  exec @iStatus = DYNAMICS..tasmGetNextNoteIndex  @I_sCompanyID   = @CMPANYID,  @I_iSQLSessionID = 0,  @I_noteincrement  = 1,  @O_mNoteIndex   = @NOTEINDX output,  @O_iErrorState  = @iGetNextNoteIdxErrState output select @iError = @@error if @iStatus = 0 and @iError <> 0 begin  select @iStatus = @iError end if (@iStatus <> 0) or (@iGetNextNoteIdxErrState <> 0) begin  if (@iGetNextNoteIdxErrState <> 0)  begin  exec @iStatus = taUpdateString  @iGetNextNoteIdxErrState,  @oErrString,  @oErrString output,  @O_oErrorState output  end  select @O_iErrorState = 2065    exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output end  if (@I_vPROSPID = '') begin  select @O_iErrorState = 2066     exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @iAddCodeErrState output end  if (@I_vTAXSCHID <> '') begin  if not exists(select 1 from TX00102 (nolock) where TAXSCHID = @I_vTAXSCHID)  begin   select @O_iErrorState = 2067     exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @iAddCodeErrState output  end end  if (@I_vSHIPMTHD <> '') begin  if (not exists (select 1 from SY03000 (nolock) where SHIPMTHD = @I_vSHIPMTHD))  begin   select @O_iErrorState = 2068     exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @iAddCodeErrState output  end end  if (@I_vPRCLEVEL <> '') begin  if (not exists (select 1 from IV40800 (nolock) where PRCLEVEL = @I_vPRCLEVEL))  begin   select @O_iErrorState = 2069     exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @iAddCodeErrState output  end end  if (@I_vCUSTCLAS <> '') begin  if (not exists(select 1 from RM00201 (nolock) where CLASSID = @I_vCUSTCLAS))  begin  select @O_iErrorState = 2070     exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @iAddCodeErrState output  end end  if (@O_iErrorState = 0) begin  if (not exists (select 1 from SOP00200 (nolock) where PROSPID = @I_vPROSPID))  begin  insert SOP00200  (  PROSPID,  NOTEINDX,  CUSTNAME,  CNTCPRSN,  ADDRESS1,  ADDRESS2,  ADDRESS3,  CITY,  STATE,  ZIP,  COUNTRY,  CUSTCLAS,  PHONE1,  PHONE2,  PHONE3,  PRCLEVEL,  FAX,  SHIPMTHD,  TAXSCHID,  USERDEF1,  USERDEF2,  USER2ENT,  CREATDDT,  MODIFDT  )  select  @I_vPROSPID,    @NOTEINDX,    @I_vCUSTNAME,    @I_vCNTCPRSN,    @I_vADDRESS1,    @I_vADDRESS2,    @I_vADDRESS3,    @I_vCITY,    @I_vSTATE,    @I_vZIP,    @I_vCOUNTRY,    @I_vCUSTCLAS,    @I_vPHONE1,    @I_vPHONE2,    @I_vPHONE3,    @I_vPRCLEVEL,    @I_vFAX,    @I_vSHIPMTHD,    @I_vTAXSCHID,    @I_vUSERDEF1,    @I_vUSERDEF2,    @I_vUSER2ENT,    case     WHEN @I_vCREATDDT = ''  THEN convert(varchar(12),getdate())  ELSE @I_vCREATDDT  end,  case     WHEN @I_vMODIFDT = ''  THEN convert(varchar(12),getdate())   ELSE @I_vMODIFDT  end   end end if (@@error <> 0) begin  select @O_iErrorState = 2071    exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @iAddCodeErrState output  return (@O_iErrorState) end  if @O_iErrorState <> 0  return (@O_iErrorState)  exec @iStatus = taCreateProspectPost  @I_vPROSPID,  @I_vCUSTNAME,  @I_vCNTCPRSN,  @I_vADDRESS1,  @I_vADDRESS2,  @I_vADDRESS3,  @I_vCITY,  @I_vSTATE,  @I_vZIP,  @I_vCOUNTRY,  @I_vCUSTCLAS,  @I_vPHONE1,  @I_vPHONE2,  @I_vPHONE3,  @I_vPRCLEVEL,  @I_vFAX,  @I_vSHIPMTHD,  @I_vTAXSCHID,  @I_vUSERDEF1,  @I_vUSERDEF2,  @I_vUSER2ENT,  @I_vCREATDDT,  @I_vMODIFDT,  @I_vUSRDEFND1,  @I_vUSRDEFND2,  @I_vUSRDEFND3,  @I_vUSRDEFND4,  @I_vUSRDEFND5,  @O_iErrorState = @iCustomState output,  @oErrString = @iCustomErrString output select @iError = @@error if @iStatus = 0 and @iError <> 0 begin  select @iStatus = @iError end if (@iStatus <> 0) or (@iCustomState <> 0) begin  select @oErrString = rtrim(@oErrString) + ' ' + ltrim(rtrim(@iCustomErrString))  select @O_iErrorState = 2072    exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output  return (@O_iErrorState) end  return (@O_iErrorState)   
GO
GRANT EXECUTE ON  [dbo].[taCreateProspect] TO [DYNGRP]
GO
