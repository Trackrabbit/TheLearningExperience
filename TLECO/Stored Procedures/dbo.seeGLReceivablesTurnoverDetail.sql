SET QUOTED_IDENTIFIER OFF
GO
SET ANSI_NULLS ON
GO
create procedure [dbo].[seeGLReceivablesTurnoverDetail]   @CurrPrevType smallint,   @UserDate datetime,   @NetCurrentSales numeric (19,5) = 0.00,   @NetCurrentReturn_Discounts numeric (19,5) = 0.00,   @CurrentAverageAR numeric (19,5) = 0.00,   @NetPrevSales numeric (19,5) = 0.00,   @NetPrevReturn_Discounts  numeric (19,5) = 0.00,   @PrevAverageAR numeric (19,5) = 0.00,   @TurnoverRatio numeric (19,5) = 0.00,   @Label varchar(30) = '',   @Date datetime = '' as IF (@Label IS NULL OR @Label = '') BEGIN       SET @Label = (SELECT rtrim(PERNAME) AS PERNAME                            FROM (SELECT DISTINCT(PERNAME), PERIODID                                      FROM SY40100                                      WHERE PERNAME <> 'Beginning Balance'                                            and @Date between PERIODDT and PERDENDT) SY40100)  END IF (@UserDate IS NULL or @UserDate = '') BEGIN       SET @UserDate = @Date END DECLARE @IsHist int   DECLARE @CurrentYear int DECLARE @DATEMAX datetime DECLARE @StartDate datetime DECLARE @EndDate datetime  DECLARE @PERIODOD smallint DECLARE @DetailDates TABLE (StartDate datetime,  EndDate datetime,  DateLabel varchar(30),  CurrPrevType int) INSERT INTO @DetailDates  SELECT   StartDate, EndDate, DateLabel, CurrPrevType  FROM   GetKPIDetailDates(@UserDate, 'Fiscal') SET @StartDate = (select StartDate from @DetailDates where DateLabel = @Label and CurrPrevType = @CurrPrevType) SET @EndDate = (select EndDate from @DetailDates where DateLabel = @Label and CurrPrevType = @CurrPrevType) SELECT @CurrentYear = YEAR1,   @IsHist = HISTORYR  FROM SY40101  WHERE @StartDate between FSTFSCDY and LSTFSCDY  SELECT @PERIODOD = PERIODID   FROM SY40100  WHERE @StartDate between PERIODDT and PERDENDT   AND PERIODID <> 0   AND  FORIGIN = 1   AND YEAR1 = @CurrentYear IF @IsHist = 1  BEGIN  SELECT ACTNUMST, JRNENTRY, TRXDATE, GL00102.ACCATDSC, ISNULL(DEBITAMT,0.00) as DEBITAMT, ISNULL(CRDTAMNT,0.00) as CRDTAMNT, [Journal Entry For Drillback], [Account Index For Drillback]  FROM GL30000   join GL00100 on    GL30000.ACTINDX = GL00100.ACTINDX  join GL00105 on   GL30000.ACTINDX = GL00105.ACTINDX  join GL00102 on   GL00100.ACCATNUM = GL00102.ACCATNUM   join (SELECT DISTINCT [Journal Entry],  [Journal Entry For Drillback]    FROM [AccountTransactions]) AccountTransactions on   GL30000.JRNENTRY = AccountTransactions.[Journal Entry]  join (SELECT DISTINCT [Account Index], [Account Index For Drillback]    FROM [AccountTransactions]) AccountDrillback on   GL30000.ACTINDX = AccountDrillback.[Account Index]  WHERE   GL00100.ACCATNUM in (31, 32, 3)   AND   TRXDATE >= @StartDate    AND   TRXDATE <= @EndDate  ORDER BY JRNENTRY     END   ELSE  BEGIN  SELECT ACTNUMST, JRNENTRY, TRXDATE, GL00102.ACCATDSC, ISNULL(DEBITAMT,0.00) as DEBITAMT, ISNULL(CRDTAMNT,0.00) as CRDTAMNT, [Journal Entry For Drillback], [Account Index For Drillback]  FROM GL20000   join GL00100 on    GL20000.ACTINDX = GL00100.ACTINDX   join GL00105 on   GL20000.ACTINDX = GL00105.ACTINDX  join GL00102 on   GL00100.ACCATNUM = GL00102.ACCATNUM  join (SELECT DISTINCT [Journal Entry],  [Journal Entry For Drillback]    FROM [AccountTransactions]) AccountTransactions on   GL20000.JRNENTRY = AccountTransactions.[Journal Entry]  join (SELECT DISTINCT [Account Index], [Account Index For Drillback]    FROM [AccountTransactions]) AccountDrillback on   GL20000.ACTINDX = AccountDrillback.[Account Index]    WHERE   GL00100.ACCATNUM  in (31, 32, 3)   AND   TRXDATE >= @StartDate    AND   TRXDATE <= @EndDate  ORDER BY JRNENTRY    END          
GO
GRANT EXECUTE ON  [dbo].[seeGLReceivablesTurnoverDetail] TO [DYNGRP]
GO
GRANT EXECUTE ON  [dbo].[seeGLReceivablesTurnoverDetail] TO [rpt_accounting manager]
GO
GRANT EXECUTE ON  [dbo].[seeGLReceivablesTurnoverDetail] TO [rpt_accounts receivable coordinator]
GO
GRANT EXECUTE ON  [dbo].[seeGLReceivablesTurnoverDetail] TO [rpt_bookkeeper]
GO
GRANT EXECUTE ON  [dbo].[seeGLReceivablesTurnoverDetail] TO [rpt_certified accountant]
GO
GRANT EXECUTE ON  [dbo].[seeGLReceivablesTurnoverDetail] TO [rpt_executive]
GO
