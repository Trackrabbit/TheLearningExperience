SET QUOTED_IDENTIFIER OFF
GO
SET ANSI_NULLS ON
GO
 create procedure [dbo].[seebackordersreceived] @StartItemNumber varchar(31), @EndItemNumber varchar(31) as set nocount on  if exists (select * from dbo.sysobjects where id = object_id(N'[temp_backordersreceived]') and OBJECTPROPERTY(id, N'IsUserTable') = 1) drop table [temp_backordersreceived]  select   distinct (rl.RCPTLNNM) as Line,  'Receipt' as [Transaction Type],  '' as [Order Type],  '' as Linked,  RTRIM(rl.ITEMNMBR) as [Item Number],   rl.ITEMDESC as [Item Description],  CASE WHEN rl.NONINVEN = 1 THEN rl.UOFM ELSE s.BASEUOFM end as [Base UOM],  rh.POPRCTNM as [Document Number],   rl.LOCNCODE as [Site ID],  rl.UOFM as [UOM],  (rl.EXTDCOST/rl.UNITCOST) as [Quantity],   CASE WHEN rl.NONINVEN = 1 THEN (rl.EXTDCOST/rl.UNITCOST) else ((rl.EXTDCOST/rl.UNITCOST)* u.QTYBSUOM) end as [Quantity Base UOM],  '' as [Sales Order Date],  '' as [Requested Ship Date],  Convert(char(10),rh.receiptdate,101) as [Receipt Date],   rl.UNITCOST as [New Unit Cost],  s.UMDPQTYS as [UOM Decimals],  '' as [Customer ID] into #temp_backordersreceived from  IV40202 u join IV40201 s on u.UOMSCHDL = s.UOMSCHDL  join IV00101 i on  i.UOMSCHDL = s.UOMSCHDL right join POP10310 rl on  RTRIM(i.ITEMNMBR) = RTRIM(rl.ITEMNMBR) and rl.UOFM = u.UOFM  join  POP10300 rh  on rh.POPRCTNM = rl.POPRCTNM where  rl.SHIPMTHD <> 'DROP SHIP' and (RTRIM(rl.ITEMNMBR) in (select RTRIM(ITEMNMBR) from SOP10200 where QTYTBAOR > 0) or RTRIM(rl.ITEMNMBR) in (select RTRIM(ITEMNMBR) from SOP10200 where SOPTYPE = 5)) and   ((RTRIM(rl.ITEMNMBR) >=   case when @StartItemNumber = 'ALL' then (select rtrim(min(ITEMNMBR)) from POP10310)  else @StartItemNumber end) and RTRIM(rl.ITEMNMBR) <=   case when @EndItemNumber = 'ALL' then (select rtrim(max(ITEMNMBR)) from POP10310)  else @EndItemNumber end)  union all  select   distinct(sl.LNITMSEQ) as Line,  'Order' AS [Transaction Type], CASE WHEN (sh.SOPTYPE) = '5' THEN 'Back Order' WHEN sh.SOPTYPE = 3 THEN 'Invoice' ELSE 'Order' END as [Order Type],  case when (sl.QTYONPO > 0) then 'Linked' else 'Unlinked' end as Linked,  RTRIM(sl.ITEMNMBR) as [Item Number],  rl.ITEMDESC as [Item Description],  uom.BASEUOFM as [Base UOM],  sh.SOPNUMBE as [Document Number],   sl.LOCNCODE as [Site ID],   sl.UOFM as [UOM],   CASE WHEN (sh.SOPTYPE) = '5' THEN sl.[QUANTITY] ELSE   (sl.QTYTBAOR) END as [Quantity],  CASE WHEN (sh.SOPTYPE) = '5' THEN (sl.QTYBSUOM * sl.[QUANTITY]) ELSE   (sl.QTYBSUOM * sl.QTYTBAOR) end as [Quantity Base UOM],  Convert(char(10),sh.DOCDATE, 101) as [Sales Order Date],   Convert(char(10),sl.ReqShipDate, 101) as [Requested Ship Date],  '' as [Receipt Date],  '0' as [New Unit Cost],  uom.UMDPQTYS as [UOM Decimals],  sh.CUSTNMBR as [Customer ID]  from   SOP10100 sh  join   SOP10200 sl  on   sh.SOPNUMBE = sl.SOPNUMBE  right join POP10310 rl  on RTRIM(rl.ITEMNMBR) = RTRIM(sl.ITEMNMBR)and   rl.LOCNCODE = sl.LOCNCODE left join   IV00101 i on  RTRIM(sl.ITEMNMBR) = RTRIM(i.ITEMNMBR) left join  IV40201 uom on   i.UOMSCHDL = uom.UOMSCHDL where   ((sl.QTYTBAOR > 0 AND sh.SOPTYPE <> 6)  or sh.SOPTYPE = '5') and rl.SHIPMTHD <> 'DROP SHIP' and ((RTRIM(sl.ITEMNMBR) >=   case when @StartItemNumber = 'ALL' then (select rtrim(min(ITEMNMBR)) from SOP10200)  else @StartItemNumber end) and RTRIM(sl.ITEMNMBR) <=   case when @EndItemNumber = 'ALL' then (select rtrim(max(ITEMNMBR)) from SOP10200)  else @EndItemNumber end)  select boa.* from #temp_backordersreceived boa  order by [Item Number]   
GO
GRANT EXECUTE ON  [dbo].[seebackordersreceived] TO [DYNGRP]
GO
GRANT EXECUTE ON  [dbo].[seebackordersreceived] TO [rpt_materials manager]
GO
GRANT EXECUTE ON  [dbo].[seebackordersreceived] TO [rpt_order processor]
GO
GRANT EXECUTE ON  [dbo].[seebackordersreceived] TO [rpt_purchasing agent]
GO
GRANT EXECUTE ON  [dbo].[seebackordersreceived] TO [rpt_purchasing manager]
GO
