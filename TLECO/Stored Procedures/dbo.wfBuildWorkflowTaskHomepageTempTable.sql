SET QUOTED_IDENTIFIER OFF
GO
SET ANSI_NULLS ON
GO
 CREATE PROCEDURE [dbo].[wfBuildWorkflowTaskHomepageTempTable]  @AssignedTo char(86),  @TempTableName char(51),  @Error int output  AS  BEGIN  set nocount on   select distinct Tasks.WorkflowTaskAssignedTo,  Tasks.Workflow_Step_Type,  Tasks.Workflow_Due_Date,  Tasks.Workflow_Due_Time,  Workflow.WfBusObjKey,  Workflow.Workflow_Type_Name,  Workflow.DICTID,  Types.FormID,  Types.WINNAME  into #tempTasks  from WFI10004 as Tasks, WFI10002 as Workflow, WF100001 as Types   where  Workflow.WorkflowInstanceID = Tasks.WorkflowInstanceID   and Types.FormID = Workflow.FormID   and Types.DICTID = Workflow.DICTID   and UPPER(Tasks.WorkflowTaskAssignedTo) = UPPER(@AssignedTo)   and Tasks.Workflow_Action_Date = ''   select * into #tasksResults from #tempTasks where 1=2   declare @insertScript varchar(2000)  declare @WorkflowTaskAssignedTo varchar(85),  @Workflow_Step_Type smallint,  @Workflow_Due_Date datetime,  @Workflow_Due_Time datetime,  @WfBusObjKey char(201),   @Workflow_Type_Name char(51),  @DICTID smallint,  @FormID smallint,  @WINNAME char(79)   declare TasksForUser cursor local fast_forward for  select WorkflowTaskAssignedTo,  Workflow_Step_Type,  Workflow_Due_Date,  Workflow_Due_Time,  WfBusObjKey,  Workflow_Type_Name,  DICTID,  FormID,  WINNAME   from #tempTasks  order by Workflow_Due_Date, Workflow_Due_Time   open TasksForUser   fetch next from TasksForUser into   @WorkflowTaskAssignedTo,  @Workflow_Step_Type,  @Workflow_Due_Date,  @Workflow_Due_Time,  @WfBusObjKey,  @Workflow_Type_Name,  @DICTID,  @FormID,  @WINNAME   while @@FETCH_STATUS=0  begin   if ((select count(WfBusObjKey) from #tasksResults where WfBusObjKey = @WfBusObjKey) < 1)  begin  insert into #tasksResults  select @WorkflowTaskAssignedTo,  @Workflow_Step_Type,  @Workflow_Due_Date,  @Workflow_Due_Time,  @WfBusObjKey,  @Workflow_Type_Name,  @DICTID,  @FormID,  @WINNAME  end   fetch next from TasksForUser into @WorkflowTaskAssignedTo,  @Workflow_Step_Type,  @Workflow_Due_Date,  @Workflow_Due_Time,  @WfBusObjKey,  @Workflow_Type_Name,  @DICTID,  @FormID,  @WINNAME  end  close TasksForUser  deallocate TasksForUser   exec ('delete from ' + @TempTableName)   set @insertScript = 'insert into ' + @TempTableName +  ' select distinct WorkflowTaskAssignedTo, ' +  'Workflow_Step_Type, ' +  'Workflow_Due_Date, ' +  'Workflow_Due_Time, ' +  'WfBusObjKey, ' +  'Workflow_Type_Name, ' +  'DICTID, ' +  'FormID, ' +  'WINNAME ' +  'from #tasksResults '   exec (@insertScript)   drop table #tempTasks  drop table #tasksResults  END   
GO
GRANT EXECUTE ON  [dbo].[wfBuildWorkflowTaskHomepageTempTable] TO [DYNGRP]
GO
