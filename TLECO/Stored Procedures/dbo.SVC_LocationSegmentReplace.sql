SET QUOTED_IDENTIFIER OFF
GO
SET ANSI_NULLS ON
GO
Create Procedure [dbo].[SVC_LocationSegmentReplace] (@ActIndex int, @Site char(10), @NewIndex int output) as declare @ActSegment smallint, @SiteSegment char(66), @Act1 char(9),@Act2 char(9),@Act3 char(9),@Act4 char(9),@Act5 char(9),@Act6 char(9),@Act7 char(9),@Act8 char(9),@Act9 char(9),@Act10 char(10) select @SiteSegment = Location_Segment from IV40700 where LOCNCODE = @Site  select @ActSegment = ACSGFLOC from IV40100 select @Act1 = ACTNUMBR_1, @Act2 = ACTNUMBR_2, @Act3 = ACTNUMBR_3,  @Act4 = ACTNUMBR_4 from GL00100 where ACTINDX = @ActIndex if @ActSegment = 1  begin  if exists(select * from GL00100 where ACTNUMBR_1 = @SiteSegment and ACTNUMBR_2 = @Act2  and ACTNUMBR_3 = @Act3  and ACTNUMBR_4 = @Act4)  select @NewIndex = ACTINDX from GL00100 where ACTNUMBR_1 = @SiteSegment and ACTNUMBR_2 = @Act2  and ACTNUMBR_3 = @Act3  and ACTNUMBR_4 = @Act4  end else if @ActSegment = 2  begin  if exists(select * from GL00100 where ACTNUMBR_1 = @Act1 and ACTNUMBR_2 = @SiteSegment  and ACTNUMBR_3 = @Act3  and ACTNUMBR_4 = @Act4)  select @NewIndex = ACTINDX from GL00100 where ACTNUMBR_1 = @Act1 and ACTNUMBR_2 = @SiteSegment  and ACTNUMBR_3 = @Act3  and ACTNUMBR_4 = @Act4  end else if @ActSegment = 3  begin  if exists(select * from GL00100 where ACTNUMBR_1 = @Act1 and ACTNUMBR_2 = @Act2  and ACTNUMBR_3 = @SiteSegment  and ACTNUMBR_4 = @Act4)  select @NewIndex = ACTINDX from GL00100 where ACTNUMBR_1 = @Act1 and ACTNUMBR_2 = @Act2  and ACTNUMBR_3 = @SiteSegment  and ACTNUMBR_4 = @Act4  end else if @ActSegment = 4  begin  if exists(select * from GL00100 where ACTNUMBR_1 = @Act1 and ACTNUMBR_2 = @Act2  and ACTNUMBR_3 = @Act3  and ACTNUMBR_4 = @SiteSegment)  select @NewIndex = ACTINDX from GL00100 where ACTNUMBR_1 = @Act1 and ACTNUMBR_2 = @Act2  and ACTNUMBR_3 = @Act3  and ACTNUMBR_4 = @SiteSegment  end if @NewIndex = 0 or @NewIndex is null  select @NewIndex = @ActIndex return 
GO
GRANT EXECUTE ON  [dbo].[SVC_LocationSegmentReplace] TO [DYNGRP]
GO
