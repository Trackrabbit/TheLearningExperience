SET QUOTED_IDENTIFIER OFF
GO
SET ANSI_NULLS ON
GO
 create procedure [dbo].[taFSRTVMaster]  @I_vRTV_Number char(15),    @I_vRTV_Type char(11) = null,    @I_vRTV_Return_Status char(3) = null,   @I_vVRMA_Document_ID char(15) = null,   @I_vRETDOCID char(15) = null,    @I_vDSCRIPTN char(31) = null,    @I_vVENDORID char(15) = null,    @I_vVENDNAME char(65) = null,    @I_vCKHOLD smallint = 0,    @I_vADRSCODE char(15) = null,    @I_vShip_Address_Name char(65) = null,   @I_vShip_Address_1 char(61) = null,   @I_vShip_Address_2 char(61) = null,   @I_vShip_Address_3 char(61) = null,   @I_vShip_City char(35) = null,    @I_vShip_State char(29) = null,    @I_vZIPCODE char(11) = null,    @I_vShip_Country char(61) = null,   @I_vENTDTE datetime = null,    @I_vENTTME datetime = null,    @I_vLOCCODEB char(11) = null,    @I_vLOCNCODE char(11) = null,    @I_vBill_of_Lading_Out char(31) = null,   @I_vShipping_Method_Out char(15) = null,  @I_vBill_of_Lading char(31) = null,   @I_vSHIPMTHD char(15) = null,    @I_vOFFID char(11) = null,    @I_vNOTETXT nvarchar(2000) = null,    @I_vUSERID char(15) = null,    @I_vUSERDEF1 char(21) = null,    @I_vUSERDEF2 char(21) = null,    @I_vUSRDEF03 char(21) = null,    @I_vUSRDEF04 char(21) = null,    @I_vUSRDEF05 char(21) = null,    @I_vCURNCYID char(15) = '',    @I_vUpdateIfExists tinyint = 1,    @I_vRequesterTrx smallint = 0,    @I_vUSRDEFND1  char(50) = '',    @I_vUSRDEFND2  char(50) = '',     @I_vUSRDEFND3  char(50) = '',    @I_vUSRDEFND4  varchar(8000) = '',   @I_vUSRDEFND5  varchar(8000) = '',   @O_iErrorState int output,    @oErrString varchar(255) output     with encryption as  set transaction isolation level read uncommitted set nocount on  declare  @O_TODAY datetime,  @O_DUMMYDT datetime,  @I_vNotify_Date datetime,  @I_vNotify_Time datetime,  @I_vTAXSCHID char (15),  @I_vNOTEINDX numeric (19,5),  @I_vORTAXAMT numeric (19,5),  @iStatus int,  @iError int,  @iCustomState int,  @O_oErrorState int,  @iCustomErrString varchar(255),  @Line_Seq_Exists smallint,  @VENDORID char(15),  @HOLD smallint,  @INACTIVE smallint,  @NAME char(31),  @ADRSCODE char(15),  @VNDCNTCT char(61),  @VADCDSFR char(31),  @PYMTRMID char (21),  @PHONE1 char (21),  @PRBTADCD char(15),  @CURNCYID char(15),  @RATETPID char(15),  @ISMCTRX int,  @FUNLCURR char (15),  @iGetNextNoteIdxErrState int,  @CMPANYID smallint,  @OFFID char (11),  @AuditLNITMSEQ int,  @FRMSTAT char(3),  @AuditDesc char(31),  @UserID char(15),  @RTV_Type char(11),  @RTV_Return_Status char(3),  @RTV_Shipping_Status char(3),  @RTV_Received_Status char(3),  @RTV_Closed_Status char(3),  @SVC_Ready_To_Ship_Status char(3),  @SVC_Partial_Shipped_Stat char(3),  @SVC_Partial_Received_Sta char(3),  @RTVLOCNCODE char(11),  @Location_Code_Vendor char(11),  @SVC_PO_Validation smallint,  @RETSTATUS char(3),  @USERETPRICELVL tinyint,  @RETPRICELVL char(11),  @iValueExists smallint,  @Received_Status char(3),  @Close_Status char(3),  @O_vCURRNIDX int,  @O_vEXGTBLID char(15),  @O_vDECPLACS int,  @O_vRATECALC int,  @O_vDENXRATE numeric(19,5),  @O_vMCTRXSTT int,  @O_vVIEWMODE int,  @I_vPart_Price numeric(19,5),  @I_vPart_Cost numeric(19,5),  @I_vLabor_Price numeric(19,5),  @I_vLabor_Cost numeric(19,5),  @I_vExpense_Price numeric(19,5),  @I_vExpense_Cost numeric(19,5),  @I_vTravel_Price numeric(19,5),  @I_vTravel_Cost numeric(19,5),  @O_vOriginating_Part_Price numeric(19,5),  @O_vOriginating_Part_Cost numeric(19,5),  @O_vOriginating_Labor_Price numeric(19,5),  @O_vOriginating_Labor_Cost numeric(19,5),  @O_vOriginating_ExpensePrice numeric(19,5),  @O_vOriginating_Expense_Cost numeric(19,5),  @O_vOriginating_Travel_Price numeric(19,5),  @O_vOriginating_Travel_Cost numeric(19,5),  @iCURRNIDX int,  @iMCCurrDecPlaces int,  @iCurrDecPlaces smallint,  @I_vPRMDATE datetime,  @I_vPromised_Time datetime,  @I_vShipped_Date datetime,  @I_vShipped_Time datetime,  @I_vReceiptdate datetime,  @I_vReceipt_Time datetime,  @I_vCOMPDTE datetime,  @I_vCOMPTME datetime,  @iTotalCost numeric(19,5),  @iOrigTotalCost numeric(19,5),  @iTotalPrice numeric(19,5),  @iOrigTotalPrice numeric(19,5),  @O_vVCHNUMWK char(17),  @O_vVoucher_Number_Invoice char(17),  @O_vVoucher_Number_Reimburse char(17),  @O_vRTV_Status smallint,  @SLSRATETPID char(15),  @FINRATETPID char(15),  @PURRATETPID char(15),  @O_vXCHGRATE numeric(19,7),  @O_vRATETPID char(15),  @O_vEXCHDATE datetime,  @O_vTIME1 datetime,  @O_vEXPNDATE datetime,  @O_vEXGTBDSC char(30),  @O_vEXTBLSRC char(50),  @O_vRATEEXPR smallint,  @O_vDYSTINCR smallint,  @O_vRATEVARC numeric(19,7),  @O_vTRXDTDEF smallint,  @O_vRTCLCMTD smallint,  @O_vPRVDSLMT smallint,  @O_vDATELMTS smallint,  @O_vCUSTOWN tinyint,  @O_vLNSEQNBR numeric(19,5),  @O_vVOIDSTTS smallint,  @SITEINACTIVE tinyint  select  @O_TODAY = convert(varchar(10),getdate(), 101),  @O_DUMMYDT = convert(varchar(10),'1900-01-01', 101),  @oErrString = '',  @I_vNotify_Date = '',  @I_vNotify_Time = '',  @I_vTAXSCHID = '',  @I_vNOTEINDX  = 0,  @I_vORTAXAMT  = 0,  @iStatus = 0,  @iError = 0,  @iCustomState =  0,  @O_oErrorState = 0,  @iCustomErrString = '',  @Line_Seq_Exists = 0,  @VENDORID = '',  @HOLD = 0,  @INACTIVE = 0,  @NAME = '',  @ADRSCODE = '',  @VNDCNTCT = '',  @VADCDSFR = '',  @PYMTRMID = '',  @PHONE1 = '',  @PRBTADCD='',  @CURNCYID='',  @RATETPID='',  @ISMCTRX = 0,  @FUNLCURR = '',  @O_vMCTRXSTT = 0,  @iGetNextNoteIdxErrState = 0,  @CMPANYID = 0,  @OFFID='',  @AuditLNITMSEQ = 0,  @FRMSTAT = '',  @AuditDesc = 'RTV Record Add/Update',  @UserID = 'eConnect',  @RTV_Type = '',  @RTV_Return_Status = '',  @RTV_Shipping_Status = '',  @RTV_Received_Status = '',  @RTV_Closed_Status = '',  @SVC_Ready_To_Ship_Status = '',  @SVC_Partial_Shipped_Stat = '',  @SVC_Partial_Received_Sta = '',  @RTVLOCNCODE = '',  @Location_Code_Vendor = '',  @SVC_PO_Validation = 1,  @RETSTATUS = '',  @USERETPRICELVL = 0,  @RETPRICELVL = '',  @O_iErrorState = 0,  @iValueExists = 0,  @Received_Status = '',  @Close_Status = '',  @O_vEXGTBLID = '',  @O_vDECPLACS = 0,  @O_vRATECALC = 0,  @O_vDENXRATE = 0,  @O_vMCTRXSTT = 0,  @O_vVIEWMODE = 3,  @I_vPart_Price = 0,  @I_vPart_Cost = 0,  @I_vLabor_Price = 0,  @I_vLabor_Cost = 0,  @I_vExpense_Price = 0,  @I_vExpense_Cost = 0,  @I_vTravel_Price = 0,  @I_vTravel_Cost = 0,  @O_vOriginating_Part_Price = 0,  @O_vOriginating_Part_Cost = 0,  @O_vOriginating_Labor_Price = 0,  @O_vOriginating_Labor_Cost = 0,  @O_vOriginating_ExpensePrice = 0,  @O_vOriginating_Expense_Cost = 0,  @O_vOriginating_Travel_Price = 0,  @O_vOriginating_Travel_Cost = 0,  @iCURRNIDX = 0,  @iMCCurrDecPlaces = 0,  @iCurrDecPlaces = 0,  @I_vPRMDATE = @O_DUMMYDT,  @I_vPromised_Time = @O_DUMMYDT,  @I_vShipped_Date = @O_DUMMYDT,  @I_vShipped_Time = @O_DUMMYDT,  @I_vReceiptdate = @O_DUMMYDT,  @I_vReceipt_Time = @O_DUMMYDT,  @I_vCOMPDTE = @O_DUMMYDT,  @I_vCOMPTME = @O_DUMMYDT,  @iTotalCost = 0,  @iOrigTotalCost = 0,  @iTotalPrice = 0,  @iOrigTotalPrice = 0,  @O_vVCHNUMWK = '',  @O_vVoucher_Number_Invoice = '',  @O_vVoucher_Number_Reimburse = '',  @O_vRTV_Status = 0,  @SLSRATETPID = '',  @FINRATETPID = '',  @PURRATETPID = '',  @O_vRATEEXPR = -1,  @O_vDYSTINCR = -1,  @O_vRATEVARC = 0,  @O_vTRXDTDEF = -1,  @O_vRTCLCMTD = -1,  @O_vPRVDSLMT = 0,  @O_vDATELMTS = 0,  @O_vCUSTOWN = 0,  @O_vLNSEQNBR = 0,  @O_vVOIDSTTS = 0,  @SITEINACTIVE = 0  exec @iStatus = taFSRTVMasterPre  @I_vRTV_Number output,  @I_vRTV_Type output,  @I_vRTV_Return_Status output,  @I_vVRMA_Document_ID output,  @I_vRETDOCID output,  @I_vDSCRIPTN output,  @I_vVENDORID output,  @I_vVENDNAME output,  @I_vCKHOLD output,  @I_vADRSCODE output,  @I_vShip_Address_Name output,  @I_vShip_Address_1 output,  @I_vShip_Address_2 output,  @I_vShip_Address_3 output,  @I_vShip_City output,  @I_vShip_State output,  @I_vZIPCODE output,  @I_vShip_Country output,  @I_vENTDTE output,  @I_vENTTME output,  @I_vLOCCODEB output,  @I_vLOCNCODE output,  @I_vBill_of_Lading_Out output,  @I_vShipping_Method_Out output,  @I_vBill_of_Lading output,  @I_vSHIPMTHD output,  @I_vOFFID output,  @I_vNOTETXT output,  @I_vUSERID output,  @I_vUSERDEF1 output,  @I_vUSERDEF2 output,  @I_vUSRDEF03 output,  @I_vUSRDEF04 output,  @I_vUSRDEF05 output,  @I_vCURNCYID output,  @I_vUpdateIfExists output,  @I_vRequesterTrx output,  @I_vUSRDEFND1 output,  @I_vUSRDEFND2 output,  @I_vUSRDEFND3 output,  @I_vUSRDEFND4 output,  @I_vUSRDEFND5 output,  @O_iErrorState = @iCustomState output,  @oErrString = @iCustomErrString output select @iError = @@error if @iStatus = 0 and @iError <> 0 begin  select @iStatus = @iError end if (@iStatus <> 0) or (@iCustomState <> 0) begin  select @oErrString = rtrim(@oErrString) + ' ' + ltrim(rtrim(@iCustomErrString))  set @O_iErrorState = 10270     exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output end  if( @I_vRTV_Number is NULL or  @I_vRTV_Type is NULL or  @I_vVENDORID is NULL or  @I_vADRSCODE is NULL or  @I_vCURNCYID is NULL ) begin  set @O_iErrorState = 10271    exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output  return @O_oErrorState end  if( @I_vRTV_Number = '' or  @I_vVENDORID = '' ) begin  set @O_iErrorState = 10272    exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output  return (@O_iErrorState) end  if @O_vCUSTOWN < 0 or   @O_vVOIDSTTS < 0 begin  set @O_iErrorState = 10273    exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output  return (@O_iErrorState) end  if (@I_vUpdateIfExists not in (0,1)) begin  set @O_iErrorState = 10325     exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output  return (@O_iErrorState) end  select  @I_vVENDORID = UPPER(@I_vVENDORID),  @I_vCURNCYID = UPPER(@I_vCURNCYID)  if exists(select 1 from SVC05635 (nolock) where RTV_Number = @I_vRTV_Number and (MKDTOPST = 1 or POSTED = 1)) begin  set @O_iErrorState = 10276    exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output  return (@O_iErrorState) end  if exists(select 1 from SVC05625 (nolock) where RTV_Number = @I_vRTV_Number and (MKDTOPST = 1 or POSTED = 1)) begin  set @O_iErrorState = 10275    exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output  return (@O_iErrorState) end  if exists(select 1 from SVC05615 (nolock) where RTV_Number = @I_vRTV_Number and (MKDTOPST = 1 or POSTED = 1)) begin  set @O_iErrorState = 10274    exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output  return (@O_iErrorState) end  if (@Line_Seq_Exists = 1) begin  select  @I_vRTV_Type = case   when @I_vRTV_Type is null then isnull(RTV_Type, '')  else @I_vRTV_Type  end,  @O_vRTV_Status = case  when @O_vRTV_Status = 0 then isnull(RTV_Status, 1)  else @O_vRTV_Status  end,  @I_vRTV_Return_Status = case  when @I_vRTV_Return_Status is null then isnull(RTV_Return_Status, '')  else @I_vRTV_Return_Status  end,  @I_vVRMA_Document_ID = case  when @I_vVRMA_Document_ID is null then isnull(VRMA_Document_ID, '')  else @I_vVRMA_Document_ID  end,  @I_vRETDOCID = case  when @I_vRETDOCID is null then isnull(RETDOCID, '')  else @I_vRETDOCID  end,  @O_vLNSEQNBR = isnull(LNSEQNBR, 0),  @I_vDSCRIPTN = case  when @I_vDSCRIPTN is null then isnull(DSCRIPTN, '')  else @I_vDSCRIPTN  end,  @VENDORID = isnull(VENDORID, ''),  @I_vVENDNAME = case  when @I_vVENDNAME is null then isnull(VENDNAME, '')  else @I_vVENDNAME  end,  @I_vADRSCODE = case  when @I_vADRSCODE is null then isnull(ADRSCODE, '')  else @I_vADRSCODE  end,  @I_vShip_Address_Name = case  when @I_vShip_Address_Name is null then isnull(Ship_Address_Name, '')  else @I_vShip_Address_Name  end,  @I_vShip_Address_1 = case  when @I_vShip_Address_1 is null then isnull(Ship_Address_1, '')  else @I_vShip_Address_1  end,  @I_vShip_Address_2 = case  when @I_vShip_Address_2 is null then isnull(Ship_Address_2, '')  else @I_vShip_Address_2  end,  @I_vShip_Address_3 = case  when @I_vShip_Address_3 is null then isnull(Ship_Address_3, '')  else @I_vShip_Address_3  end,  @I_vShip_City = case  when @I_vShip_City is null then isnull(Ship_City, '')  else @I_vShip_City  end,  @I_vShip_State = case  when @I_vShip_State is null then isnull(Ship_State, '')  else @I_vShip_State  end,  @I_vZIPCODE = case  when @I_vZIPCODE is null then isnull(ZIPCODE, '')  else @I_vZIPCODE  end,  @I_vShip_Country = case  when @I_vShip_Country is null then isnull(Ship_Country, '')  else @I_vShip_Country  end,  @I_vOFFID = case  when @I_vOFFID is null then isnull(OFFID, '')  else @I_vOFFID  end,  @I_vLOCCODEB = case  when @I_vLOCCODEB is null then isnull(LOCCODEB, '')  else @I_vLOCCODEB  end,  @I_vLOCNCODE = case  when @I_vLOCNCODE is null then isnull(LOCNCODE, '')  else @I_vLOCNCODE  end,  @I_vENTDTE = case  when @I_vENTDTE is null then isnull(ENTDTE, @O_TODAY)  else @I_vENTDTE  end,  @I_vENTTME = case  when @I_vENTTME is null then isnull(ENTTME, convert(varchar(12), getdate(), 108))  else @I_vENTTME  end,  @I_vPRMDATE = case  when @I_vPRMDATE is null then isnull(PRMDATE, @O_DUMMYDT)  else @I_vPRMDATE  end,  @I_vPromised_Time = case  when @I_vPromised_Time is null then isnull(Promised_Time, @O_DUMMYDT)  else @I_vPromised_Time  end,  @I_vShipped_Date = case  when @I_vShipped_Date is null then isnull(Shipped_Date, @O_DUMMYDT)  else @I_vShipped_Date  end,  @I_vShipped_Time = case  when @I_vShipped_Time is null then isnull(Shipped_Time, @O_DUMMYDT)  else @I_vShipped_Time  end,  @I_vReceiptdate = case  when @I_vReceiptdate is null then isnull(receiptdate, @O_DUMMYDT)  else @I_vReceiptdate  end,  @I_vReceipt_Time = case  when @I_vReceipt_Time is null then isnull(Receipt_Time, @O_DUMMYDT)  else @I_vReceipt_Time  end,  @I_vCOMPDTE = case  when @I_vCOMPDTE is null then isnull(COMPDTE, @O_DUMMYDT)  else @I_vCOMPDTE  end,  @I_vCOMPTME = case  when @I_vCOMPTME is null then isnull(COMPTME, @O_DUMMYDT)  else @I_vCOMPTME  end,  @I_vBill_of_Lading_Out = case  when @I_vBill_of_Lading_Out is null then isnull(Bill_of_Lading_Out, '')  else @I_vBill_of_Lading_Out  end,  @I_vShipping_Method_Out = case  when @I_vShipping_Method_Out is null then isnull(Shipping_Method_Out, '')  else @I_vShipping_Method_Out  end,  @I_vBill_of_Lading = case  when @I_vBill_of_Lading is null then isnull(Bill_of_Lading, '')  else @I_vBill_of_Lading  end,  @I_vSHIPMTHD = case  when @I_vSHIPMTHD is null then isnull(SHIPMTHD, '')  else @I_vSHIPMTHD  end,  @O_vVCHNUMWK = case  when @O_vVCHNUMWK is null then isnull(VCHNUMWK, '')  else @O_vVCHNUMWK  end,  @O_vVoucher_Number_Invoice = case  when @O_vVoucher_Number_Invoice is null then isnull(Voucher_Number_Invoice, '')  else @O_vVoucher_Number_Invoice  end,  @O_vVoucher_Number_Reimburse = case  when @O_vVoucher_Number_Reimburse is null then isnull(Voucher_Number_Reimburse, '')  else @O_vVoucher_Number_Reimburse  end,   @O_vCUSTOWN = isnull(CUSTOWN, 0),  @I_vUSERDEF1 = case  when @I_vUSERDEF1 is null then isnull(USERDEF1, '')  else @I_vUSERDEF1  end,  @I_vUSERDEF2 = case  when @I_vUSERDEF2 is null then isnull(USERDEF2, '')  else @I_vUSERDEF2  end,  @I_vUSRDEF03 = case   when @I_vUSRDEF03 is null then isnull(USRDEF03, '')  else @I_vUSRDEF03  end,  @I_vUSRDEF04 = case  when @I_vUSRDEF04 is null then isnull(USRDEF04, '')  else @I_vUSRDEF04  end,  @I_vUSRDEF05 = case  when @I_vUSRDEF05 is null then isnull(USRDEF05, '')  else @I_vUSRDEF05  end,  @I_vPart_Price = case  when @I_vPart_Price is null or @I_vPart_Price = 0 then isnull(Part_Price, 0)  else @I_vPart_Price  end,  @I_vPart_Cost = case  when @I_vPart_Cost is null or @I_vPart_Cost = 0 then isnull(Part_Cost, 0)  else @I_vPart_Cost  end,  @I_vLabor_Price = case  when @I_vLabor_Price is null or @I_vLabor_Price = 0 then isnull(Labor_Price, 0)  else @I_vLabor_Price  end,  @I_vLabor_Cost = case  when @I_vLabor_Cost is null or @I_vLabor_Cost = 0 then isnull(Labor_Cost, 0)  else @I_vLabor_Cost  end,  @I_vExpense_Price = case  when @I_vExpense_Price is null or @I_vExpense_Price = 0 then isnull(Expense_Price, 0)  else @I_vExpense_Price  end,  @I_vExpense_Cost = case  when @I_vExpense_Cost is null or @I_vExpense_Cost = 0 then isnull(Expense_Cost, 0)  else @I_vExpense_Cost  end,  @I_vTravel_Price = case  when @I_vTravel_Price is null or @I_vTravel_Price = 0 then isnull(Travel_Price, 0)  else @I_vTravel_Price  end,  @I_vTravel_Cost = case  when @I_vTravel_Cost is null or @I_vTravel_Cost = 0 then isnull(Travel_Cost, 0)  else @I_vTravel_Cost  end,  @O_vOriginating_Part_Price = isnull(Originating_Part_Price, 0),  @O_vOriginating_Part_Cost = isnull(Originating_Part_Cost, 0),  @O_vOriginating_Labor_Price = isnull(Originating_Labor_Price, 0),  @O_vOriginating_Labor_Cost = isnull(Originating_Labor_Cost, 0),  @O_vOriginating_ExpensePrice = isnull(Originating_ExpensePrice, 0),  @O_vOriginating_Expense_Cost = isnull(Originating_Expense_Cost, 0),  @O_vOriginating_Travel_Price = isnull(Originating_Travel_Price, 0),  @O_vOriginating_Travel_Cost = isnull(Originating_Travel_Cost, 0),  @O_vVOIDSTTS = isnull(VOIDSTTS, 0),  @I_vCURNCYID = case   when @I_vCURNCYID is null then isnull(CURNCYID, '')  else @I_vCURNCYID  end,  @O_vXCHGRATE = case   when @O_vXCHGRATE is null then isnull(XCHGRATE, 0)  else @O_vXCHGRATE  end,  @O_vRATETPID = case  when @O_vRATETPID is null then isnull(RATETPID, '')  else @O_vRATETPID  end,  @O_vEXCHDATE = case  when @O_vEXCHDATE is null then isnull(EXCHDATE, @O_DUMMYDT)  else @O_vEXCHDATE  end,  @O_vTIME1 = case  when @O_vTIME1 is null then isnull(TIME1, @O_DUMMYDT)  else @O_vTIME1  end,  @O_vEXPNDATE = case  when @O_vEXPNDATE is null then isnull(EXPNDATE, @O_DUMMYDT)  else @O_vEXPNDATE  end,  @iCURRNIDX = isnull(CURRNIDX, 0),  @O_vEXGTBLID = isnull(EXGTBLID, ''),  @O_vDECPLACS = isnull(DECPLACS, 0),  @O_vRATECALC = isnull(RATECALC, 0),  @O_vVIEWMODE = isnull(VIEWMODE, 3),  @ISMCTRX = isnull(ISMCTRX, 0),  @O_vDENXRATE = isnull(DENXRATE, 0),  @O_vMCTRXSTT = isnull(MCTRXSTT, 0),  @I_vNOTEINDX = isnull(NOTEINDX, 0),  @I_vUSERID = case  when @I_vUSERID is null then isnull(USERID, @UserID)  else @I_vUSERID  end  from SVC05600 (nolock)   where RTV_Number = @I_vRTV_Number end  if (@VENDORID <> '') and (@I_vVENDORID <> @VENDORID) begin  set @O_iErrorState = 10287     exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output  return (@O_iErrorState)  end  select @RTV_Type= isnull(RTV_Type, ''),  @Location_Code_Vendor = isnull(Location_Code_Vendor, ''),  @SVC_PO_Validation = isnull(SVC_PO_Validation, 1),  @RETSTATUS = isnull(RETSTATUS, ''),  @USERETPRICELVL = isnull(SVC_Use_Return_Price_Lev, 0),  @RETPRICELVL = isnull(SVC_Return_Price_Level, '')  from SVC00998 (nolock)  select  @I_vRTV_Type = case   when @I_vRTV_Type is null then @RTV_Type  else @I_vRTV_Type  end,  @O_vRTV_Status = 1,  @I_vRTV_Return_Status = case  when @I_vRTV_Return_Status is null then ''  else @I_vRTV_Return_Status  end,  @I_vVRMA_Document_ID = case  when @I_vVRMA_Document_ID is null then ''  else @I_vVRMA_Document_ID  end,  @I_vRETDOCID = case  when @I_vRETDOCID is null then ''  else @I_vRETDOCID  end,  @O_vLNSEQNBR = case  when @O_vLNSEQNBR <> 0 then @O_vLNSEQNBR  else 0  end,  @I_vDSCRIPTN = case  when @I_vDSCRIPTN is null then ''  else @I_vDSCRIPTN  end,  @I_vVENDORID = case  when @I_vVENDORID is null then ''  else @I_vVENDORID  end,  @I_vVENDNAME = case  when @I_vVENDNAME is null then ''  else @I_vVENDNAME  end,  @I_vADRSCODE = case  when @I_vADRSCODE is null then ''  else @I_vADRSCODE  end,  @I_vShip_Address_Name = case  when @I_vShip_Address_Name is null then ''  else @I_vShip_Address_Name  end,  @I_vShip_Address_1 = case  when @I_vShip_Address_1 is null then ''  else @I_vShip_Address_1  end,  @I_vShip_Address_2 = case  when @I_vShip_Address_2 is null then ''  else @I_vShip_Address_2  end,  @I_vShip_Address_3 = case  when @I_vShip_Address_3 is null then ''  else @I_vShip_Address_3  end,  @I_vShip_City = case  when @I_vShip_City is null then ''  else @I_vShip_City  end,  @I_vShip_State = case  when @I_vShip_State is null then ''  else @I_vShip_State  end,  @I_vZIPCODE = case  when @I_vZIPCODE is null then ''  else @I_vZIPCODE  end,  @I_vShip_Country = case  when @I_vShip_Country is null then ''  else @I_vShip_Country  end,  @I_vOFFID = case  when @I_vOFFID is null then ''  else @I_vOFFID  end,  @I_vLOCCODEB = case  when @I_vLOCCODEB is null then ''  else @I_vLOCCODEB  end,  @I_vLOCNCODE = case  when @I_vLOCNCODE is null then ''  else @I_vLOCNCODE  end,  @I_vENTDTE = case  when @I_vENTDTE is null then @O_TODAY  else @I_vENTDTE  end,  @I_vENTTME = case  when @I_vENTTME is null then convert(varchar(12), getdate(), 108)  else @I_vENTTME  end,  @I_vPRMDATE = case  when @I_vPRMDATE is null then @O_DUMMYDT  else @I_vPRMDATE  end,  @I_vPromised_Time = case  when @I_vPromised_Time is null then @O_DUMMYDT  else @I_vPromised_Time  end,  @I_vShipped_Date = case  when @I_vShipped_Date is null then @O_DUMMYDT  else @I_vShipped_Date  end,  @I_vShipped_Time = case  when @I_vShipped_Time is null then @O_DUMMYDT  else @I_vShipped_Time  end,  @I_vReceiptdate = case  when @I_vReceiptdate is null then @O_DUMMYDT  else @I_vReceiptdate  end,  @I_vReceipt_Time = case  when @I_vReceipt_Time is null then @O_DUMMYDT  else @I_vReceipt_Time  end,  @I_vCOMPDTE = case  when @I_vCOMPDTE is null then @O_DUMMYDT  else @I_vCOMPDTE  end,  @I_vCOMPTME = case  when @I_vCOMPTME is null then @O_DUMMYDT  else @I_vCOMPTME  end,  @I_vBill_of_Lading_Out = case  when @I_vBill_of_Lading_Out is null then ''  else @I_vBill_of_Lading_Out  end,  @I_vShipping_Method_Out = case  when @I_vShipping_Method_Out is null then ''  else @I_vShipping_Method_Out  end,  @I_vBill_of_Lading = case  when @I_vBill_of_Lading is null then ''  else @I_vBill_of_Lading  end,  @I_vSHIPMTHD = case  when @I_vSHIPMTHD is null then ''  else @I_vSHIPMTHD  end,  @O_vVCHNUMWK = case  when @O_vVCHNUMWK is null then ''  else @O_vVCHNUMWK  end,  @O_vVoucher_Number_Invoice = case  when @O_vVoucher_Number_Invoice is null then ''  else @O_vVoucher_Number_Invoice  end,  @O_vVoucher_Number_Reimburse = case  when @O_vVoucher_Number_Reimburse is null then ''  else @O_vVoucher_Number_Reimburse  end,   @O_vCUSTOWN = case  when @O_vCUSTOWN <> 0 then @O_vCUSTOWN  else 0  end,  @I_vUSERDEF1 = case  when @I_vUSERDEF1 is null then ''  else @I_vUSERDEF1  end,  @I_vUSERDEF2 = case  when @I_vUSERDEF2 is null then ''  else @I_vUSERDEF2  end,  @I_vUSRDEF03 = case   when @I_vUSRDEF03 is null then ''  else @I_vUSRDEF03  end,  @I_vUSRDEF04 = case  when @I_vUSRDEF04 is null then ''  else @I_vUSRDEF04  end,  @I_vUSRDEF05 = case  when @I_vUSRDEF05 is null then ''  else @I_vUSRDEF05  end,  @I_vPart_Price = case  when @I_vPart_Price is null then 0  else @I_vPart_Price  end,  @I_vPart_Cost = case  when @I_vPart_Cost is null then 0  else @I_vPart_Cost  end,  @I_vLabor_Price = case  when @I_vLabor_Price is null then 0  else @I_vLabor_Price  end,  @I_vLabor_Cost = case  when @I_vLabor_Cost is null then 0  else @I_vLabor_Cost  end,  @I_vExpense_Price = case  when @I_vExpense_Price is null then 0  else @I_vExpense_Price  end,  @I_vExpense_Cost = case  when @I_vExpense_Cost is null then 0  else @I_vExpense_Cost  end,  @I_vTravel_Price = case  when @I_vTravel_Price is null then 0  else @I_vTravel_Price  end,  @I_vTravel_Cost = case  when @I_vTravel_Cost is null then 0  else @I_vTravel_Cost  end,  @O_vVOIDSTTS = case   when @O_vVOIDSTTS <> 0 then @O_vVOIDSTTS  else 0  end,  @I_vCURNCYID = case   when @I_vCURNCYID is null then ''  else @I_vCURNCYID  end,  @O_vXCHGRATE = case   when @O_vXCHGRATE is null then 0  else @O_vXCHGRATE  end,  @O_vRATETPID = case  when @O_vRATETPID is null then ''  else @O_vRATETPID  end,  @O_vEXCHDATE = case  when @O_vEXCHDATE is null then @O_DUMMYDT  else @O_vEXCHDATE  end,  @O_vTIME1 = case  when @O_vTIME1 is null then @O_DUMMYDT  else @O_vTIME1  end,  @O_vEXPNDATE = case  when @O_vEXPNDATE is null then @O_DUMMYDT  else @O_vEXPNDATE  end,  @I_vUSERID = case  when @I_vUSERID is null then user_name()  else @I_vUSERID  end  if exists(select 1 from SVC35600 (nolock) where RTV_Number = @I_vRTV_Number) begin  select @Line_Seq_Exists=1   set @O_iErrorState = 10277    exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output  return (@O_iErrorState)  end  if exists (select 1 from SVC05600 (nolock) where RTV_Number = @I_vRTV_Number) begin  select  @Line_Seq_Exists=1,  @FRMSTAT = isnull(RTV_Return_Status,'')   from SVC05600 (nolock) where RTV_Number = @I_vRTV_Number end  if (@Line_Seq_Exists=1) and (@I_vUpdateIfExists = 0)  begin  set @O_iErrorState = 10278    exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output end  if @O_vRTV_Status < 1 or @O_vRTV_Status > 6 begin  set @O_iErrorState = 10279     exec @iStatus = taUpdateString  @O_iErrorState,   @oErrString,  @oErrString output,  @O_oErrorState output   return (@O_iErrorState) end  if @O_vVOIDSTTS < 0 or @O_vVOIDSTTS > 1 begin  set @O_iErrorState = 10280     exec @iStatus = taUpdateString  @O_iErrorState,   @oErrString,  @oErrString output,  @O_oErrorState output  return (@O_iErrorState) end  if @O_vCUSTOWN < 0 or @O_vCUSTOWN > 1 begin  set @O_iErrorState = 10281     exec @iStatus = taUpdateString  @O_iErrorState,   @oErrString,  @oErrString output,  @O_oErrorState output  return (@O_iErrorState) end  if (@I_vRTV_Type = '')  set @I_vRTV_Type = @RTV_Type  if (@I_vRTV_Type <> '')  begin  set @iValueExists = 0  select @iValueExists = 1, @RTV_Return_Status = isnull(RTV_Return_Status, ''),   @I_vDSCRIPTN = case   when @I_vDSCRIPTN is null or @I_vDSCRIPTN = '' then DSCRIPTN  else @I_vDSCRIPTN  end,  @RTV_Shipping_Status = isnull(RTV_Shipping_Status,''),  @RTV_Received_Status = isnull(RTV_Received_Status, ''),  @RTV_Closed_Status = isnull(RTV_Closed_Status, ''),  @RTVLOCNCODE = isnull(LOCNCODE, ''),  @SVC_Ready_To_Ship_Status = isnull(SVC_Ready_To_Ship_Status, ''),  @SVC_Partial_Shipped_Stat = isnull(SVC_Partial_Shipped_Stat, ''),  @SVC_Partial_Received_Sta = isnull(SVC_Partial_Received_Sta, '')  from SVC05003 where RTV_Type = @I_vRTV_Type  if @iValueExists <> 1  begin  set @O_iErrorState = 10290    exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output  return (@O_iErrorState)  end end  if @I_vVENDORID <> '' begin  set @iValueExists = 0  select  @iValueExists = 1,  @HOLD=isnull(HOLD,0),  @INACTIVE=isnull(VENDSTTS,0),  @PYMTRMID=isnull(PYMTRMID,''),  @NAME=isnull(VENDNAME,''),  @ADRSCODE=isnull(VADDCDPR,''),  @VNDCNTCT = isnull(VNDCNTCT, ''),  @VADCDSFR=isnull(VADCDSFR,''),  @CURNCYID=isnull(CURNCYID,''),  @RATETPID=isnull(RATETPID,''),  @I_vShipping_Method_Out = case  when @I_vShipping_Method_Out is null or @I_vShipping_Method_Out = '' then SHIPMTHD  else @I_vShipping_Method_Out  end,  @I_vSHIPMTHD = case  when @I_vSHIPMTHD is null or @I_vSHIPMTHD = '' then SHIPMTHD  else @I_vSHIPMTHD  end   from PM00200 (nolock) where VENDORID=@I_vVENDORID   if (@iValueExists <> 1)  begin  set @O_iErrorState = 10283    exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output  return (@O_iErrorState)  end   if (@I_vCKHOLD = 0) and (@HOLD=1)  begin  set @O_iErrorState = 10284    exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output  return (@O_iErrorState)  end   if (@INACTIVE<>1)  begin   set @O_iErrorState = 10285    exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output  return (@O_iErrorState)  end   select @I_vVENDNAME =   case  when @I_vVENDNAME = '' then @NAME   else  @I_vVENDNAME  end,  @I_vADRSCODE =   case  when @I_vADRSCODE = '' and @I_vShip_Address_1 = '' and @I_vShip_Address_2 = '' and @I_vShip_Address_3 = '' and @I_vShip_City = '' and @I_vShip_State = ''  and @I_vZIPCODE = '' and @I_vShip_Country = ''then @ADRSCODE   else  @I_vADRSCODE  end,  @I_vCURNCYID =   case  when @I_vCURNCYID = '' then @CURNCYID   else  @I_vCURNCYID  end,  @O_vRATETPID =   case  when @O_vRATETPID = '' then @RATETPID   else  @O_vRATETPID  end end  if (@I_vADRSCODE <> '') begin  select  @ADRSCODE=''   if (@I_vShip_Address_1 = '' and @I_vShip_City = '' and @I_vShip_State = ''  and @I_vZIPCODE = '' and @I_vShip_Country = '')  begin  select  @ADRSCODE=isnull(ADRSCODE,''),  @I_vShip_Address_1=isnull(ADDRESS1,''),  @I_vShip_Address_2=isnull(ADDRESS2,''),  @I_vShip_Address_3=isnull(ADDRESS3,''),  @I_vShip_Country=isnull(COUNTRY,''),  @I_vShip_City=isnull(CITY,''),  @I_vShip_State=isnull(STATE,''),  @I_vZIPCODE=isnull(ZIPCODE,''),  @I_vTAXSCHID=isnull(TAXSCHID,''),  @VNDCNTCT = isnull(VNDCNTCT, ''),  @PHONE1=isnull(PHNUMBR1,''),  @I_vShipping_Method_Out = case  when @I_vShipping_Method_Out is null or @I_vShipping_Method_Out = '' then SHIPMTHD  else @I_vShipping_Method_Out  end,  @I_vSHIPMTHD = case  when @I_vSHIPMTHD is null or @I_vSHIPMTHD = '' then SHIPMTHD  else @I_vSHIPMTHD  end   from PM00300 (nolock) where VENDORID=@I_vVENDORID and ADRSCODE = @I_vADRSCODE   if (@ADRSCODE='')  begin  set @O_iErrorState = 10245    exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output  return (@O_iErrorState)  end   select @I_vShip_Address_Name =   case  when @I_vShip_Address_Name = '' then @NAME  else  @I_vShip_Address_Name  end  end  else  begin  select  @ADRSCODE=isnull(ADRSCODE,''),  @I_vTAXSCHID=isnull(TAXSCHID,''),  @VNDCNTCT=isnull(VNDCNTCT,''),  @PHONE1=isnull(PHNUMBR1,'')  from PM00300 (nolock) where VENDORID=@I_vVENDORID and ADRSCODE = @I_vADRSCODE   if (@ADRSCODE='')  begin  set @O_iErrorState = 10286    exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output  return (@O_iErrorState)  end   select @I_vShip_Address_Name =   case  when @I_vShip_Address_Name = '' then @VNDCNTCT   else  @I_vShip_Address_Name  end  end end  if (@I_vShipping_Method_Out <> '') begin  if not exists(select 1 from SY03000 where SHIPMTHD = @I_vShipping_Method_Out)  begin  set @O_iErrorState = 10288     exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output  return (@O_iErrorState)  end end  if (@I_vSHIPMTHD <> '') begin  if not exists(select 1 from SY03000 where SHIPMTHD = @I_vSHIPMTHD)  begin  set @O_iErrorState = 10289     exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output  return (@O_iErrorState)  end end  if (@I_vRTV_Return_Status = '') begin  set @I_vRTV_Return_Status = case  when @O_vRTV_Status = 2 then @SVC_Ready_To_Ship_Status  when @O_vRTV_Status = 3 then @RTV_Shipping_Status  when @O_vRTV_Status = 4 then @SVC_Partial_Received_Sta  when @O_vRTV_Status = 5 then @RTV_Received_Status  when @O_vRTV_Status = 6 then @RTV_Closed_Status  else @RTV_Return_Status  end end  if (@I_vRTV_Return_Status <> '') begin  if not exists(select 1 from SVC05002 where RTV_Return_Status = @I_vRTV_Return_Status)  begin  set @O_iErrorState = 10291     exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output  return (@O_iErrorState)  end end  select  @I_vPart_Price = isnull(sum(Originating_Part_Price), 0),  @I_vPart_Cost = isnull(sum(Originating_Part_Cost), 0),  @I_vLabor_Price = isnull(sum(Originating_Labor_Price), 0),  @I_vLabor_Cost = isnull(sum(Originating_Labor_Cost), 0),  @I_vExpense_Price = isnull(sum(Originating_ExpensePrice), 0),  @I_vExpense_Cost = isnull(sum(Originating_Expense_Cost), 0),  @I_vTravel_Price = isnull(sum(Originating_Travel_Price), 0),  @I_vTravel_Cost = isnull(sum(Originating_Travel_Cost), 0),  @I_vPRMDATE = isnull(max(PRMDATE), @O_DUMMYDT),  @I_vPromised_Time = isnull(max(Promised_Time), @O_DUMMYDT),  @I_vShipped_Date = isnull(max(Shipped_Date), @O_DUMMYDT),  @I_vShipped_Time = isnull(max(Shipped_Time), @O_DUMMYDT),  @I_vReceiptdate = isnull(max(receiptdate), @O_DUMMYDT),  @I_vReceipt_Time = isnull(max(Receipt_Time), @O_DUMMYDT),  @I_vCOMPDTE = isnull(max(COMPDTE), @O_DUMMYDT),  @I_vCOMPTME = isnull(max(COMPTME), @O_DUMMYDT)  from SVC05601 where RTV_Number = @I_vRTV_Number  if @@error <> 0 begin  set @O_iErrorState = 10292    exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output  return (@O_iErrorState) end  if (@I_vENTDTE = '')  select @I_vENTDTE = convert(varchar(12),getdate())  if (@I_vENTTME = '')  select @I_vENTTME = getdate()- convert(char(12),getdate(),12)  if not (datepart(day,@I_vENTTME) = 1 and datepart(month,@I_vENTTME) = 1 and datepart(year,@I_vENTTME) = 1900) begin  set @O_iErrorState = 10293      exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output  return (@O_iErrorState) end  if not (datepart(hour,@I_vENTDTE) = 0 and datepart(minute,@I_vENTDTE) = 0 and datepart(second,@I_vENTDTE) = 0   and datepart(millisecond,@I_vENTDTE) = 0) begin  set @O_iErrorState = 10294     exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output  return (@O_iErrorState) end  if (@I_vPRMDATE <> '') begin  if not (datepart(day,@I_vPromised_Time) = 1 and datepart(month,@I_vPromised_Time) = 1 and datepart(year,@I_vPromised_Time) = 1900)  begin  set @O_iErrorState = 10295    exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output  return (@O_iErrorState)  end   if not (datepart(hour,@I_vPRMDATE) = 0 and datepart(minute,@I_vPRMDATE) = 0 and datepart(second,@I_vPRMDATE) = 0   and datepart(millisecond,@I_vPRMDATE) = 0)  begin  set @O_iErrorState = 10296    exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output  return (@O_iErrorState)  end   if (@I_vPRMDATE < @I_vENTDTE)  begin  set @O_iErrorState = 10297     exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output  return (@O_iErrorState)  end   if ((@I_vPRMDATE <= @I_vENTDTE) and (@I_vPromised_Time < @I_vENTTME) )  begin  set @O_iErrorState = 10298     exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output  return (@O_iErrorState)  end end else begin  select @I_vPRMDATE=@I_vENTDTE, @I_vPromised_Time=@I_vENTTME end  if (@I_vShipped_Date <> '') begin   if not (datepart(day,@I_vShipped_Time) = 1 and datepart(month,@I_vShipped_Time) = 1 and datepart(year,@I_vShipped_Time) = 1900)  begin  set @O_iErrorState = 10299     exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output  return (@O_iErrorState)  end   if not (datepart(hour,@I_vShipped_Date) = 0 and datepart(minute,@I_vShipped_Date) = 0 and datepart(second,@I_vShipped_Date) = 0   and datepart(millisecond,@I_vShipped_Date) = 0)  begin  set @O_iErrorState = 10300     exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output  return (@O_iErrorState)  end   if (@I_vShipped_Date < @I_vENTDTE)  begin  set @O_iErrorState = 10301     exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output  return (@O_iErrorState)  end   if ((@I_vShipped_Date <= @I_vPRMDATE) and (@I_vShipped_Time < @I_vPromised_Time) )  begin  set @O_iErrorState = 10302     exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output  return (@O_iErrorState)  end   select @RTV_Return_Status = @RTV_Shipping_Status end  if (@I_vReceiptdate <> '') begin  if not (datepart(day,@I_vReceipt_Time) = 1 and datepart(month,@I_vReceipt_Time) = 1 and datepart(year,@I_vReceipt_Time) = 1900)  begin  set @O_iErrorState = 10303     exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output  return (@O_iErrorState)  end   if not (datepart(hour,@I_vReceiptdate) = 0 and datepart(minute,@I_vReceiptdate) = 0 and datepart(second,@I_vReceiptdate) = 0   and datepart(millisecond,@I_vReceiptdate) = 0)  begin  set @O_iErrorState = 10304     exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output  return (@O_iErrorState)  end   if (@I_vReceiptdate < @I_vShipped_Date)  begin  set @O_iErrorState = 10305     exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output  return (@O_iErrorState)  end   if ((@I_vReceiptdate <= @I_vENTDTE) and (@I_vReceipt_Time < @I_vENTTME) )  begin  set @O_iErrorState = 10306      exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output  return (@O_iErrorState)  end   select @RTV_Return_Status = @RTV_Received_Status end  if (@I_vCOMPDTE <> '') begin  if not (datepart(day,@I_vCOMPTME) = 1 and datepart(month,@I_vCOMPTME) = 1 and datepart(year,@I_vCOMPTME) = 1900)  begin  set @O_iErrorState = 10307     exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output  return (@O_iErrorState)  end   if not (datepart(hour,@I_vCOMPDTE) = 0 and datepart(minute,@I_vCOMPDTE) = 0 and datepart(second,@I_vCOMPDTE) = 0   and datepart(millisecond,@I_vCOMPDTE) = 0)  begin  set @O_iErrorState = 10308     exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output  return (@O_iErrorState)  end   if (@I_vCOMPDTE < @I_vReceiptdate)  begin  set @O_iErrorState = 10309     exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output  return (@O_iErrorState)  end   if ((@I_vCOMPDTE <= @I_vReceiptdate) and (@I_vCOMPTME < @I_vReceipt_Time) )  begin  set @O_iErrorState = 10310     exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output  return (@O_iErrorState)  end   select @RTV_Return_Status = @RTV_Closed_Status end  if (@I_vRETDOCID <> '' and @O_vLNSEQNBR > 0) begin  set @iValueExists = 0  select @iValueExists = 1, @OFFID = isnull(OFFID,'') from SVC05200 where RETDOCID = @I_vRETDOCID and LNSEQNBR = @O_vLNSEQNBR  if (@iValueExists <> 1)  begin  set @O_iErrorState = 10311    exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output  return (@O_iErrorState)  end end  if (@I_vOFFID <> '') begin  if (not exists(select 1 from SVC00902 (nolock) where OFFID = @I_vOFFID))  begin  set @O_iErrorState = 10312     exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output  end end  select @AuditLNITMSEQ = count(RTV_Number) + 1 from SVC05620 (nolock) where RTV_Number = @I_vRTV_Number  if (@Line_Seq_Exists=0) begin  select @CMPANYID = CMPANYID from DYNAMICS..SY01500 c (nolock) where c.INTERID = db_name()  exec @iStatus = DYNAMICS..tasmGetNextNoteIndex  @I_sCompanyID   = @CMPANYID,  @I_iSQLSessionID = 0,  @O_mNoteIndex   = @I_vNOTEINDX output,  @O_iErrorState  = @iGetNextNoteIdxErrState output  select @iError = @@error   if @iStatus = 0 and @iError <> 0  begin  select @iStatus = @iError  end   if (@iStatus <> 0) or (@iGetNextNoteIdxErrState <> 0)  begin  if (@iGetNextNoteIdxErrState <> 0)  begin  exec @iStatus = taUpdateString  @iGetNextNoteIdxErrState,   @oErrString,  @oErrString output,  @O_oErrorState output  end  set @O_iErrorState = 10313   exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output  return (@O_iErrorState)  end end else begin  select @I_vNOTEINDX = isnull(NOTEINDX,0) from SVC05600 (nolock) where RTV_Number = @I_vRTV_Number end  if (@I_vCURNCYID <> '') begin  set @iValueExists= 0  select @iValueExists = 1, @iCURRNIDX = isnull(CURRNIDX,0), @iMCCurrDecPlaces = DECPLCUR from DYNAMICS..MC40200 (nolock) where CURNCYID = @I_vCURNCYID  if (@iValueExists = 0) or (@iCURRNIDX = 0)  begin  set @O_iErrorState = 10246     exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output  return (@O_iErrorState)  end  else  set @iCurrDecPlaces = @iMCCurrDecPlaces end  select @FUNLCURR = FUNLCURR, @SLSRATETPID = isnull(DEFSLSTP, ''), @FINRATETPID = isnull(DEFFINTP, ''), @PURRATETPID = isnull(DEFPURTP, '')  from MC40000 (nolock)  select @O_vRATETPID = case  when @O_vRATETPID = '' and @PURRATETPID <> '' then @PURRATETPID  when @O_vRATETPID = '' and @FINRATETPID <> '' then  @FINRATETPID  when @O_vRATETPID = '' then @RATETPID  else @O_vRATETPID  end  if (@O_vRATETPID <> '')  begin  if (not exists(select 1 from MC40100 (nolock) where RATETPID = @O_vRATETPID))  begin  set @O_iErrorState = 10317     exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output  end end  select @O_vDECPLACS = DECPLCUR - 1 from DYNAMICS..MC40200 (nolock) where CURNCYID = @FUNLCURR  if (@I_vCURNCYID = '') and (@iCURRNIDX = 0) begin  select @I_vCURNCYID = isnull(FUNLCURR,''), @iCURRNIDX = isnull(FUNCRIDX,0) from MC40000 (nolock) end else if (@I_vCURNCYID = '') and (@iCURRNIDX <> 0) begin  select @I_vCURNCYID = isnull(CURNCYID,'') from DYNAMICS..MC40200 (nolock) where CURRNIDX = @iCURRNIDX end else begin  select @iCURRNIDX = isnull(CURRNIDX,0) from DYNAMICS..MC40200 (nolock) where CURNCYID = @I_vCURNCYID end  if (@I_vCURNCYID <> '') begin  set @iValueExists= 0  select @iValueExists = 1, @iCURRNIDX = isnull(CURRNIDX,0), @iMCCurrDecPlaces = DECPLCUR from DYNAMICS..MC40200 (nolock) where CURNCYID = @I_vCURNCYID  if (@iValueExists = 0) or (@iCURRNIDX = 0)  begin  set @O_iErrorState = 10315     exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output  return (@O_iErrorState)  end  else  set @iCurrDecPlaces = @iMCCurrDecPlaces end  if (@iCURRNIDX <> 0) begin  set @iValueExists= 0  select @iValueExists = 1, @I_vCURNCYID = isnull(CURNCYID,0), @iMCCurrDecPlaces = DECPLCUR from DYNAMICS..MC40200 (nolock) where CURRNIDX = @iCURRNIDX  if (@iValueExists = 0)  begin  set @O_iErrorState = 10314     exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output  return (@O_iErrorState)  end  else  set @iCurrDecPlaces = @iMCCurrDecPlaces end  if  (@I_vCURNCYID <> '') and ( @I_vCURNCYID <> @FUNLCURR) begin  select @ISMCTRX = 1,@O_vVIEWMODE=4   if (@O_vEXCHDATE is null or @O_vEXCHDATE = '' or @O_vEXCHDATE = @O_DUMMYDT)  begin  select top 1 @O_vEXCHDATE = EXCHDATE from DYNAMICS..MC00100 (nolock)  where EXGTBLID = (select top 1 EXGTBLID from MC40301 where CURNCYID = @I_vCURNCYID AND RATETPID = @O_vRATETPID)  AND EXCHDATE <= @I_vENTDTE and EXPNDATE >= @I_vENTDTE  order by EXCHDATE + TIME1 desc  end   exec @iStatus = taMCCurrencyValidate  @I_vMASTERID = @I_vVENDORID,  @I_vDOCDATE  = @I_vENTDTE,  @I_vCURNCYID = @I_vCURNCYID,  @I_vEXCHDATE = @O_vEXCHDATE,  @I_vEXGTBDSC = @O_vEXGTBDSC,  @I_vEXTBLSRC = @O_vEXTBLSRC,  @I_vRATEEXPR = @O_vRATEEXPR output,  @I_vDYSTINCR = @O_vDYSTINCR output,  @I_vRATEVARC = @O_vRATEVARC,  @I_vTRXDTDEF = @O_vTRXDTDEF,  @I_vPRVDSLMT = @O_vPRVDSLMT,  @I_vDATELMTS = @O_vDATELMTS,  @I_vMODULE = 0,  @I_vTIME1 = @O_vTIME1 output,  @I_vXCHGRATE = @O_vXCHGRATE output,  @I_vEXPNDATE = @O_vEXPNDATE output,  @I_vRATETPID = @O_vRATETPID output,  @I_vRTCLCMTD = @O_vRTCLCMTD output,  @I_vEXGTBLID = @O_vEXGTBLID output,  @oErrString = @oErrString output,  @O_iErrorState = @O_iErrorState output   select @iError = @@error  if @iStatus = 0 and @iError <> 0  select @iStatus = @iError  if (@iStatus <> 0) or (@O_iErrorState <> 0)  begin  if (@O_iErrorState <> 0)  begin  exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output  end   set @O_iErrorState = 10316   exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output  return (@O_iErrorState)  end end  else begin  select @ISMCTRX = 0, @O_vRATEEXPR = 0, @O_vDYSTINCR = 0, @O_vRTCLCMTD = 0, @O_vVIEWMODE = 3 end   select @O_vOriginating_Part_Price = @I_vPart_Price,      @O_vOriginating_Part_Cost = @I_vPart_Cost,      @O_vOriginating_Labor_Price = @I_vLabor_Price,       @O_vOriginating_Labor_Cost = @I_vLabor_Cost,      @O_vOriginating_ExpensePrice = @I_vExpense_Price,     @O_vOriginating_Expense_Cost = @I_vExpense_Cost,     @O_vOriginating_Travel_Price = @I_vTravel_Price,     @O_vOriginating_Travel_Cost = @I_vTravel_Cost     if ( @ISMCTRX = 1) begin  if @O_vXCHGRATE = 0   begin  set @O_iErrorState = 10318     exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output  return (@O_iErrorState)  end   if @O_vRTCLCMTD = 0     begin  select  @I_vPart_Price   = round(@O_vOriginating_Part_Price * @O_vXCHGRATE, @O_vDECPLACS),  @I_vPart_Cost   = round(@O_vOriginating_Part_Cost * @O_vXCHGRATE, @O_vDECPLACS),  @I_vLabor_Price  = round(@O_vOriginating_Labor_Price * @O_vXCHGRATE, @O_vDECPLACS),  @I_vLabor_Cost   = round(@O_vOriginating_Labor_Cost * @O_vXCHGRATE, @O_vDECPLACS),  @I_vExpense_Price  = round(@O_vOriginating_ExpensePrice * @O_vXCHGRATE, @O_vDECPLACS),  @I_vExpense_Cost  = round(@O_vOriginating_Expense_Cost * @O_vXCHGRATE, @O_vDECPLACS),  @I_vTravel_Price  = round(@O_vOriginating_Travel_Price * @O_vXCHGRATE, @O_vDECPLACS),  @I_vTravel_Cost  = round(@O_vOriginating_Travel_Cost * @O_vXCHGRATE, @O_vDECPLACS)  end  else if @O_vRTCLCMTD = 1    begin  select  @I_vPart_Price   = round(@O_vOriginating_Part_Price / @O_vXCHGRATE, @O_vDECPLACS),  @I_vPart_Cost   = round(@O_vOriginating_Part_Cost / @O_vXCHGRATE, @O_vDECPLACS),  @I_vLabor_Price  = round(@O_vOriginating_Labor_Price / @O_vXCHGRATE, @O_vDECPLACS),  @I_vLabor_Cost   = round(@O_vOriginating_Labor_Cost / @O_vXCHGRATE, @O_vDECPLACS),  @I_vExpense_Price  = round(@O_vOriginating_ExpensePrice / @O_vXCHGRATE, @O_vDECPLACS),  @I_vExpense_Cost  = round(@O_vOriginating_Expense_Cost / @O_vXCHGRATE, @O_vDECPLACS),  @I_vTravel_Price  = round(@O_vOriginating_Travel_Price / @O_vXCHGRATE, @O_vDECPLACS),  @I_vTravel_Cost  = round(@O_vOriginating_Travel_Cost / @O_vXCHGRATE, @O_vDECPLACS)  end end  if (@oErrString <> '')  return (@O_iErrorState)  if (@Line_Seq_Exists=0) begin  insert into SVC05600(   RTV_Number,  RTV_Type,  RTV_Return_Status,  RTV_Status,  VRMA_Document_ID,  RETDOCID,  LNSEQNBR,  DSCRIPTN,  VENDORID,  VENDNAME,  ADRSCODE,  Ship_Address_Name,  Ship_Address_1,  Ship_Address_2,  Ship_Address_3,  Ship_City,  Ship_State,  ZIPCODE,  Ship_Country,  ENTDTE,  ENTTME,  PRMDATE,  Promised_Time,  Shipped_Date,  Shipped_Time,  receiptdate,  Receipt_Time,  COMPDTE,  COMPTME,  LOCCODEB,  LOCNCODE,  Part_Price,  Part_Cost,  Labor_Price,  Labor_Cost,  Expense_Price,  Expense_Cost,  Travel_Price,  Travel_Cost,  Bill_of_Lading_Out,  Shipping_Method_Out,  Bill_of_Lading,  SHIPMTHD,  OFFID,  NOTEINDX,  VCHNUMWK,  Voucher_Number_Invoice,  Voucher_Number_Reimburse,  CUSTOWN,  USERID,  USERDEF1,  USERDEF2,  USRDEF03,  USRDEF04,  USRDEF05,  CURNCYID,  RATETPID,  XCHGRATE,  EXCHDATE,  TIME1,  EXPNDATE,  CURRNIDX,  EXGTBLID,  DECPLACS,  RATECALC,  VIEWMODE,  ISMCTRX,  DENXRATE,  MCTRXSTT,  Originating_Part_Price,  Originating_Part_Cost,  Originating_Labor_Price,  Originating_Labor_Cost,  Originating_ExpensePrice,  Originating_Expense_Cost,  Originating_Travel_Price,  Originating_Travel_Cost,  VOIDSTTS  )  select  @I_vRTV_Number,  @I_vRTV_Type,  @I_vRTV_Return_Status,  @O_vRTV_Status,  @I_vVRMA_Document_ID,  @I_vRETDOCID,  @O_vLNSEQNBR,  @I_vDSCRIPTN,  @I_vVENDORID,  @I_vVENDNAME,  @I_vADRSCODE,  @I_vShip_Address_Name,  @I_vShip_Address_1,  @I_vShip_Address_2,  @I_vShip_Address_3,  @I_vShip_City,  @I_vShip_State,  @I_vZIPCODE,  @I_vShip_Country,  @I_vENTDTE,  @I_vENTTME,  @I_vPRMDATE,  @I_vPromised_Time,  @I_vShipped_Date,  @I_vShipped_Time,  @I_vReceiptdate,  @I_vReceipt_Time,  @I_vCOMPDTE,  @I_vCOMPTME,  @I_vLOCCODEB,  @I_vLOCNCODE,  @I_vPart_Price,  @I_vPart_Cost,  @I_vLabor_Price,  @I_vLabor_Cost,  @I_vExpense_Price,  @I_vExpense_Cost,  @I_vTravel_Price,  @I_vTravel_Cost,  @I_vBill_of_Lading_Out,  @I_vShipping_Method_Out,  @I_vBill_of_Lading,  @I_vSHIPMTHD,  @I_vOFFID,  @I_vNOTEINDX,  @O_vVCHNUMWK,  @O_vVoucher_Number_Invoice,  @O_vVoucher_Number_Reimburse,  @O_vCUSTOWN,  @I_vUSERID,  @I_vUSERDEF1,  @I_vUSERDEF2,  @I_vUSRDEF03,  @I_vUSRDEF04,  @I_vUSRDEF05,  @I_vCURNCYID,  @O_vRATETPID,  @O_vXCHGRATE,  @O_vEXCHDATE,  @O_vTIME1,  @O_vEXPNDATE,  @iCURRNIDX,  @O_vEXGTBLID,  @O_vDECPLACS,  @O_vRATECALC,  @O_vVIEWMODE,  @ISMCTRX,  @O_vDENXRATE,  @O_vMCTRXSTT,  @O_vOriginating_Part_Price,  @O_vOriginating_Part_Cost,  @O_vOriginating_Labor_Price,  @O_vOriginating_Labor_Cost,  @O_vOriginating_ExpensePrice,  @O_vOriginating_Expense_Cost,  @O_vOriginating_Travel_Price,  @O_vOriginating_Travel_Cost,  @O_vVOIDSTTS  if @@error <> 0  begin  set @O_iErrorState = 10319    exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output  return (@O_iErrorState)  end   insert into SVC05620  (RTV_Number,  RTV_Line,  LNSEQNBR,  SVCFRMSTAT,  SVCTOSTAT,  DSCRPTION,  USERID,  CREATDDT,  CREATETIME)  select  @I_vRTV_Number,  0,  @AuditLNITMSEQ,  @FRMSTAT,  @I_vRTV_Return_Status,  @AuditDesc,  @UserID,  convert(varchar(12),getdate(),101),  getdate()- convert(char(12),getdate(),12)  if @@error <> 0  begin  set @O_iErrorState = 10247    exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output  return (@O_iErrorState)  end  end else begin  if (@I_vUpdateIfExists > 0)  begin  update SVC05600 set   RTV_Type = @I_vRTV_Type,  RTV_Return_Status = @I_vRTV_Return_Status,  RTV_Status = @O_vRTV_Status,  VRMA_Document_ID = @I_vVRMA_Document_ID,  RTV_Number = @I_vRTV_Number,  LNSEQNBR = @O_vLNSEQNBR,  DSCRIPTN = @I_vDSCRIPTN,  VENDORID = @I_vVENDORID,  VENDNAME = @I_vVENDNAME,  ADRSCODE = @I_vADRSCODE,  Ship_Address_Name = @I_vShip_Address_Name,  Ship_Address_1 = @I_vShip_Address_1,  Ship_Address_2 = @I_vShip_Address_2,  Ship_Address_3 = @I_vShip_Address_3,  Ship_City = @I_vShip_City,  Ship_State = @I_vShip_State,  ZIPCODE = @I_vZIPCODE,  Ship_Country = @I_vShip_Country,  ENTDTE = @I_vENTDTE,  ENTTME = @I_vENTTME,  PRMDATE = @I_vPRMDATE,  Promised_Time = @I_vPromised_Time,  Shipped_Date = @I_vShipped_Date,  Shipped_Time = @I_vShipped_Time,  receiptdate = @I_vReceiptdate,  Receipt_Time = @I_vReceipt_Time,  COMPDTE = @I_vCOMPDTE,  COMPTME = @I_vCOMPTME,  LOCCODEB = @I_vLOCCODEB,  LOCNCODE = @I_vLOCNCODE,  Part_Price = @I_vPart_Price,  Part_Cost = @I_vPart_Cost,  Labor_Price = @I_vLabor_Price,  Labor_Cost = @I_vLabor_Cost,  Expense_Price = @I_vExpense_Price,  Expense_Cost = @I_vExpense_Cost,  Travel_Price = @I_vTravel_Price,  Travel_Cost = @I_vTravel_Cost,  Bill_of_Lading_Out = @I_vBill_of_Lading_Out,  Shipping_Method_Out = @I_vShipping_Method_Out,  Bill_of_Lading = @I_vBill_of_Lading,  SHIPMTHD = @I_vSHIPMTHD,  OFFID = @I_vOFFID,  NOTEINDX = @I_vNOTEINDX,  VCHNUMWK = @O_vVCHNUMWK,  Voucher_Number_Invoice = @O_vVoucher_Number_Invoice,  Voucher_Number_Reimburse = @O_vVoucher_Number_Reimburse,  CUSTOWN = @O_vCUSTOWN,  USERID = @I_vUSERID,  USERDEF1 = @I_vUSERDEF1,  USERDEF2 = @I_vUSERDEF2,  USRDEF03 = @I_vUSRDEF03,  USRDEF04 = @I_vUSRDEF04,  USRDEF05 = @I_vUSRDEF05,  CURNCYID = @I_vCURNCYID,  RATETPID = @O_vRATETPID,  XCHGRATE = @O_vXCHGRATE,  EXCHDATE = @O_vEXCHDATE,  TIME1 = @O_vTIME1,  EXPNDATE = @O_vEXPNDATE,  CURRNIDX = @iCURRNIDX,  EXGTBLID = @O_vEXGTBLID,  DECPLACS = @O_vDECPLACS,  RATECALC = @O_vRATECALC,  VIEWMODE = @O_vVIEWMODE,  ISMCTRX = @ISMCTRX,  DENXRATE = @O_vDENXRATE,  MCTRXSTT = @O_vMCTRXSTT,  Originating_Part_Price = @O_vOriginating_Part_Price,  Originating_Part_Cost = @O_vOriginating_Part_Cost,  Originating_Labor_Price = @O_vOriginating_Labor_Price,  Originating_Labor_Cost = @O_vOriginating_Labor_Cost,  Originating_ExpensePrice = @O_vOriginating_ExpensePrice,  Originating_Expense_Cost = @O_vOriginating_Expense_Cost,  Originating_Travel_Price = @O_vOriginating_Travel_Price,  Originating_Travel_Cost = @O_vOriginating_Travel_Cost,  VOIDSTTS = @O_vVOIDSTTS  where RTV_Number = @I_vRTV_Number  if (@@error <> 0)  begin  set @O_iErrorState = 10321    exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output  return (@O_iErrorState)  end   insert into SVC05620  (RTV_Number,  RTV_Line,  LNSEQNBR,  SVCFRMSTAT,  SVCTOSTAT,  DSCRPTION,  USERID,  CREATDDT,  CREATETIME)  select  @I_vRTV_Number,  0,  @AuditLNITMSEQ,  @FRMSTAT,  @I_vRTV_Return_Status,  @AuditDesc,  @UserID,  convert(varchar(12),getdate(),101),  getdate()- convert(char(12),getdate(),12)   if @@error <> 0  begin  set @O_iErrorState = 10320    exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output  return (@O_iErrorState)  end  end end  if (@I_vNOTETXT is NULL)  select @I_vNOTETXT = convert(varchar(2000),isnull(TXTFIELD,''))  from SY03900 where NOTEINDX = @I_vNOTEINDX select @I_vNOTETXT = isnull(@I_vNOTETXT, '')  if (@I_vNOTEINDX > 0 and @I_vNOTETXT <> '') begin  if exists(select 1 from SY03900 (nolock) where NOTEINDX = @I_vNOTEINDX)  update SY03900 set TXTFIELD = @I_vNOTETXT,   DATE1 = @O_TODAY,   TIME1 = convert(char(12), getdate(), 108)   where NOTEINDX = @I_vNOTEINDX  else  insert into SY03900 (NOTEINDX,   DATE1,   TIME1,   TXTFIELD)   select @I_vNOTEINDX,   @O_TODAY,   convert(char(12), getdate(), 108),   @I_vNOTETXT end  exec @iStatus =  SVC_Get_RTV_Dist_Amount   @I_vRTV_Number,  0,   'I',   4,   @iTotalCost,  @iOrigTotalCost,  @iTotalPrice,  @iOrigTotalPrice set @iError = @@error if (@iStatus = 0 and @iError <> 0)  set @iStatus = @iError  if (@iStatus <> 0) begin  set @O_iErrorState = 10322    exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output  return (@O_iErrorState) end  if (@iTotalCost > 0) begin  exec @iStatus = SVC_Set_RTV_Dist   @I_vRTV_Number,  0,     'I',     '',       @iTotalPrice,     @iOrigTotalPrice,    @iTotalCost,  @iOrigTotalCost   select @iError = @@error  if (@iStatus = 0 and @iError <> 0)  set @iStatus = @iError   if (@iStatus <> 0)  begin  select @oErrString = rtrim(@oErrString) + ' ' + ltrim(rtrim(@iCustomErrString))  set @O_iErrorState = 10323    exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output  return (@O_iErrorState)  end end  exec @iStatus = taFSRTVMasterPost  @I_vRTV_Number,  @I_vRTV_Type,  @I_vRTV_Return_Status,  @I_vVRMA_Document_ID,  @I_vRETDOCID,  @I_vDSCRIPTN,  @I_vVENDORID,  @I_vVENDNAME,  @I_vCKHOLD,  @I_vADRSCODE,  @I_vShip_Address_Name,  @I_vShip_Address_1,  @I_vShip_Address_2,  @I_vShip_Address_3,  @I_vShip_City,  @I_vShip_State,  @I_vZIPCODE,  @I_vShip_Country,  @I_vENTDTE,  @I_vENTTME,  @I_vLOCCODEB,  @I_vLOCNCODE,  @I_vBill_of_Lading_Out,  @I_vShipping_Method_Out,  @I_vBill_of_Lading,  @I_vSHIPMTHD,  @I_vOFFID,  @I_vNOTETXT,  @I_vUSERID,  @I_vUSERDEF1,  @I_vUSERDEF2,  @I_vUSRDEF03,  @I_vUSRDEF04,  @I_vUSRDEF05,  @I_vCURNCYID,  @I_vUpdateIfExists,  @I_vRequesterTrx,  @I_vUSRDEFND1,  @I_vUSRDEFND2,  @I_vUSRDEFND3,  @I_vUSRDEFND4,  @I_vUSRDEFND5,  @O_iErrorState = @iCustomState output,  @oErrString = @iCustomErrString output select @iError = @@error if @iStatus = 0 and @iError <> 0 begin  select @iStatus = @iError end if (@iStatus <> 0) or (@iCustomState <> 0) begin  select @oErrString = rtrim(@oErrString) + ' ' + ltrim(rtrim(@iCustomErrString))  set @O_iErrorState = 10324    exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output  return (@O_iErrorState) end  return (@O_iErrorState)   
GO
GRANT EXECUTE ON  [dbo].[taFSRTVMaster] TO [DYNGRP]
GO
