SET QUOTED_IDENTIFIER OFF
GO
SET ANSI_NULLS ON
GO
 CREATE Procedure [dbo].[SVC_Update_Contract_Line]  ( @iType smallint,  @CONSTS smallint,   @CONTNBR char(11),  @LNSEQNBR numeric(19,5),  @Old_BLOCKTIME numeric(19,2),  @Old_TIMEVALUE numeric(19,2),  @Old_ACTUALCALLS numeric(19,2),  @Old_VALUECALLS numeric(19,2),  @Old_MAXCALLS numeric(19,2),  @Old_CTOTAL numeric(19,2),  @Old_CTOTALUNIT numeric(19,2),  @Old_CINVAMT numeric(19,2),  @Old_CAMTTOINVOICE numeric(19,2),  @Old_CDiscount numeric(19,2),  @Old_ORIGTIMEVALUE numeric(19,2),  @Old_ORIGVALUECALLS numeric(19,2),  @Old_ORIGCTOTAL numeric(19,2),  @Old_ORIGCTOTALUNIT numeric(19,2),  @Old_ORIGCINVAMT numeric(19,2),  @Old_ORIGCAMTTOINVOICE numeric(19,2),  @Old_ORIGCDiscount numeric(19,2),  @Customer char(15),  @Address char(15)  ) As  declare @New_BLOCKTIME numeric(19,2) declare @New_TIMEVALUE numeric(19,2) declare @New_ACTUALCALLS numeric(19,2) declare @New_VALUECALLS numeric(19,2) declare @New_MAXCALLS numeric(19,2) declare @New_CTOTAL numeric(19,2) declare @New_CTOTALUNIT numeric(19,2) declare @New_CINVAMT numeric(19,2) declare @New_CAMTTOINVOICE numeric(19,2) declare @New_CDiscount numeric(19,2) declare @New_ORIGTIMEVALUE numeric(19,2) declare @New_ORIGVALUECALLS numeric(19,2) declare @New_ORIGCTOTAL numeric(19,2) declare @New_ORIGCTOTALUNIT numeric(19,2) declare @New_ORIGCINVAMT numeric(19,2) declare @New_ORIGCAMTTOINVOICE numeric(19,2) declare @New_ORIGCDiscount numeric(19,2) set nocount on  SET TRANSACTION ISOLATION LEVEL READ UNCOMMITTED   if @iType = 0 or @iType = 2 BEGIN  exec SVC_Calc_Cont_Line @CONSTS, @CONTNBR, @LNSEQNBR   exec SVC_Set_Contract_Line_Invoice @CONSTS, @CONTNBR, @LNSEQNBR   select @New_BLOCKTIME = BLKTIM,  @New_TIMEVALUE = VALTIM,  @New_ACTUALCALLS = ACTCAL,  @New_VALUECALLS = TOTVALCAL,   @New_MAXCALLS = NBRCAL,  @New_CTOTAL = TOTAL,  @New_CTOTALUNIT = Unit_Cost_Total,  @New_CDiscount = DSCDLRAM,  @New_CINVAMT = Invoiced_Amount,  @New_ORIGTIMEVALUE = ORIGVALTIM,  @New_ORIGVALUECALLS = ORIGTOTVALCAL,   @New_ORIGCTOTAL = ORIGTOTAL,  @New_ORIGCTOTALUNIT = ORIGUNITCOSTTOTAL,  @New_ORIGCDiscount = ORDDLRAT,  @New_ORIGCINVAMT = Orig_Invoiced_Amount,   @Customer = CUSTNMBR,  @Address = ADRSCODE,  @New_ORIGCAMTTOINVOICE = Orig_Amount_To_Invoice,  @New_CAMTTOINVOICE = Amount_To_Invoice  from SVC00601 WITH (NOLOCK)  where @CONSTS=CONSTS and @CONTNBR=CONTNBR and @LNSEQNBR=LNSEQNBR END ELSE BEGIN  select @New_BLOCKTIME = 0,  @New_TIMEVALUE = 0,  @New_ACTUALCALLS = 0,  @New_VALUECALLS =0,   @New_MAXCALLS = 0,  @New_CTOTAL = 0,  @New_CTOTALUNIT = 0,  @New_CDiscount = 0,  @New_CINVAMT = 0,  @New_CAMTTOINVOICE = 0,  @New_ORIGTIMEVALUE = 0,  @New_ORIGVALUECALLS = 0,   @New_ORIGCTOTAL = 0,  @New_ORIGCTOTALUNIT = 0,  @New_ORIGCDiscount = 0,  @New_ORIGCINVAMT = 0,   @Customer = CUSTNMBR,  @Address = ADRSCODE  from SVC00600 WITH (NOLOCK)  where @CONSTS=CONSTS and @CONTNBR=CONTNBR END  if @iType <> 2 BEGIN  if @iType = 0   select @Old_CTOTAL = 0, @Old_ORIGCTOTAL = 0, @New_CTOTAL = 0, @New_ORIGCTOTAL = 0,   @Old_CDiscount = 0, @Old_ORIGCDiscount = 0, @New_CDiscount = 0,@New_ORIGCDiscount = 0 exec SVC_Inc_Update_Cont_HDR @CONSTS,  @CONTNBR,   @Customer,   @Address,   @Old_BLOCKTIME,  @Old_TIMEVALUE,  @Old_ACTUALCALLS,  @Old_VALUECALLS,   @Old_MAXCALLS,  @Old_CTOTAL,  @Old_CTOTALUNIT,  @Old_CINVAMT,  @Old_CAMTTOINVOICE,  @Old_CDiscount,  @Old_ORIGTIMEVALUE ,  @Old_ORIGVALUECALLS ,  @Old_ORIGCTOTAL ,  @Old_ORIGCTOTALUNIT ,  @Old_ORIGCINVAMT ,  @Old_ORIGCAMTTOINVOICE ,  @Old_ORIGCDiscount,   @New_BLOCKTIME,  @New_TIMEVALUE,  @New_ACTUALCALLS,  @New_VALUECALLS,   @New_MAXCALLS,  @New_CTOTAL,  @New_CTOTALUNIT,  @New_CINVAMT,  @New_CAMTTOINVOICE,  @New_CDiscount,  @New_ORIGTIMEVALUE,  @New_ORIGVALUECALLS ,  @New_ORIGCTOTAL,  @New_ORIGCTOTALUNIT ,  @New_ORIGCINVAMT,  @New_ORIGCAMTTOINVOICE ,  @New_ORIGCDiscount  END  return    
GO
GRANT EXECUTE ON  [dbo].[SVC_Update_Contract_Line] TO [DYNGRP]
GO
