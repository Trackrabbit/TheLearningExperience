SET QUOTED_IDENTIFIER OFF
GO
SET ANSI_NULLS ON
GO
create procedure [dbo].[smUsrCmpnyAccssUnchkAccssCHG]  @I_cUserID varchar(15) = NULL,  @I_sCompanyID smallint = NULL,  @I_iSQLSessionID int  = NULL,  @I_tControlUser tinyint = NULL,  @O_iErrorState int  = NULL output as  declare  @iError int,    @iStatus int,    @tTransaction tinyint,   @cMasterOwner char(30),   @cDynamicsOwner char(30),   @TRUE tinyint,   @iNumberOfRows int    if @I_cUserID is NULL  or @I_sCompanyID is NULL  or @I_iSQLSessionID is NULL  or @I_tControlUser is NULL begin  select @O_iErrorState = 20110  return end else begin  select   @O_iErrorState = 0,  @iNumberOfRows = 0 end  exec @iStatus = DYNAMICS.dbo.smGetConstantInt  'TRUE',  @TRUE output,  @O_iErrorState output  select @iError = @@error if @iStatus = 0 and @iError <> 0 begin  select @iStatus = @iError end  if @iStatus <> 0 or @O_iErrorState <> 0  return @iStatus  delete  DYNAMICS.dbo.SY60100 where  USERID = @I_cUserID  and CMPANYID = @I_sCompanyID  if @@rowcount <> 1 begin  select @O_iErrorState = 20191  return end  select  @iNumberOfRows = count(CMPANYID) from  DYNAMICS.dbo.SY10500 where  USERID = @I_cUserID  and CMPANYID = @I_sCompanyID  if @iNumberOfRows > 0 begin  delete  DYNAMICS.dbo.SY10500  where  USERID = @I_cUserID  and CMPANYID = @I_sCompanyID   if @@rowcount <> @iNumberOfRows  begin  select @O_iErrorState = 21102  return  end end   select  @iNumberOfRows = count(CMPANYID) from  DYNAMICS.dbo.SY10550 where  USERID = @I_cUserID  and CMPANYID = @I_sCompanyID  if @iNumberOfRows > 0 begin  delete  DYNAMICS.dbo.SY10550  where  USERID = @I_cUserID  and CMPANYID = @I_sCompanyID   if @@rowcount <> @iNumberOfRows  begin  select @O_iErrorState = 21103  return  end end   select  @iNumberOfRows = count(INIT.USERID) from  DYNAMICS.dbo.SY01600 INIT,  DYNAMICS.dbo.SY01500 COMPANY where  INIT.USERID = @I_cUserID  and INIT.CMPNYNAM = COMPANY.CMPNYNAM  and COMPANY.CMPANYID = @I_sCompanyID  if @iNumberOfRows > 0 begin  delete  DYNAMICS.dbo.SY01600  from  DYNAMICS.dbo.SY01600 INIT,  DYNAMICS.dbo.SY01500 COMPANY  where  INIT.USERID = @I_cUserID  and INIT.CMPNYNAM = COMPANY.CMPNYNAM  and COMPANY.CMPANYID = @I_sCompanyID   if @@rowcount <> @iNumberOfRows  begin  select @O_iErrorState = 20193  return  end end   return    
GO
GRANT EXECUTE ON  [dbo].[smUsrCmpnyAccssUnchkAccssCHG] TO [DYNGRP]
GO
