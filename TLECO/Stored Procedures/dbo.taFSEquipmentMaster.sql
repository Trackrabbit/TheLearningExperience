SET QUOTED_IDENTIFIER OFF
GO
SET ANSI_NULLS ON
GO
 create procedure [dbo].[taFSEquipmentMaster] @I_vSERLNMBR char(21),    @I_vITEMNMBR char(31),    @I_vREFRENCE char(31) = null,   @I_vVersion char(21) = null,   @I_vSRLSTAT char(11) = null,   @I_vCUSTNMBR char(15) = null,   @I_vADRSCODE char(15) = null,   @I_vADDRESS1 char(61) = null,   @I_vADDRESS2 char(61) = null,   @I_vADDRESS3 char(61) = null,   @I_vCITY char(35) = null,   @I_vSTATE char(29) = null,   @I_vZIP char(11) = null,   @I_vCOUNTRY char(61) = null,   @I_vCNTCPRSN char(61) = null,   @I_vINSTDTE datetime = null,   @I_vShipped_Date datetime = null,  @I_vSVC_Register_Date datetime = null,  @I_vLSTPMDTE datetime = null,   @I_vLSTSRVDTE datetime = null,   @I_vTECHID char(11) = null,   @I_vOFFID char(11) = null,   @I_vSVCAREA char(11) = null,   @I_vTIMEZONE char(3) = null,   @I_vVENDORID char(15) = null,   @I_vWARRCDE char(11) = null,   @I_vWARRSTART datetime = null,   @I_vWARREND datetime = null,   @I_vSLRWARR char(11) = null,    @I_vSLRWSTART datetime = null,   @I_vSLRWEND datetime = null,   @I_vNOTETXT nvarchar(2000) = '',  @I_vSVC_PM_Date smallint = null,  @I_vSVC_PM_Day smallint = null,   @I_vUSERDEF1 char(21) = null,   @I_vUSERDEF2 char(21) = null,   @I_vUSRDEF03 char(21) = null,   @I_vUSRDEF04 char(21) = null,   @I_vUSRDEF05 char(21) = null,   @I_vSVC_Serial_ID char(21) = null,  @I_vSVC_Asset_Tag char(21) = null,  @I_vUpdateIfExists tinyint = 1,   @I_vRequesterTrx smallint = 0,   @I_vUSRDEFND1 char(50) = '',   @I_vUSRDEFND2 char(50) = '',     @I_vUSRDEFND3 char(50) = '',   @I_vUSRDEFND4 varchar(8000) = '',  @I_vUSRDEFND5 varchar(8000) = '',  @O_iErrorState int output,   @oErrString varchar(255) output    with encryption as  set transaction isolation level read uncommitted set nocount on  declare  @O_TODAY datetime,  @O_DUMMYDT datetime,  @USERID char(15),  @Note_Index_1 numeric (19,5),  @Line_Seq_Exists smallint,  @iStatus int,  @iCustomState int,  @iCustomErrString varchar(255),  @iAddCodeErrState int,    @O_oErrorState int,  @iError int,  @iGetNextNoteIdxErrState int,   @sCompanyID smallint,    @AuditLNITMSEQ int,  @AuditDesc char(31),  @EQUIPID int,  @STREQUIPID char(10),  @CUSTNMBR char(15),  @ADRSCODE char(15),  @iValueExists smallint,  @O_vMTTR numeric(19,5),  @O_vMTBF numeric(19,5),  @O_vMTBI numeric(19,5),  @O_vLast_Calc_Date datetime,  @O_vMeters_1 int,  @O_vMeters_2 int,  @O_vMeters_3 int,  @O_vMeters_4 int,  @O_vMeters_5 int,  @O_vDailys_1 numeric(19,5),  @O_vDailys_2 numeric(19,5),  @O_vDailys_3 numeric(19,5),  @O_vDailys_4 numeric(19,5),  @O_vDailys_5 numeric(19,5),  @O_vMTBFs_1 numeric(19,5),  @O_vMTBFs_2 numeric(19,5),  @O_vMTBFs_3 numeric(19,5),  @O_vMTBFs_4 numeric(19,5),  @O_vMTBFs_5 numeric(19,5),  @O_vMeter_Deltas_1 int,  @O_vMeter_Deltas_2 int,  @O_vMeter_Deltas_3 int,  @O_vMeter_Deltas_4 int,  @O_vMeter_Deltas_5 int,  @O_vQUANTITY numeric(19,5),  @O_iItemMetered smallint,  @O_iBadReading smallint,  @EquipDocExists tinyint,  @HOLD smallint,  @INACTIVE smallint,  @ADDRESS1 char(30),  @ADDRESS2 char(30),  @ADDRESS3 char(30),  @COUNTRY char(30),  @CITY char(30),  @STATE char(30),  @ZIP char(10),  @CNTCPRSN char(30),  @PHONE1 char(22),  @SVCAREA char(11),  @OFFID char(11),  @TECHID char(11),  @TIMEZONE char(3),  @TECHSTAT char(11),  @VENDHOLD smallint,  @VENDINACTIVE int,  @VADDCDPR char(10),  @VENDNAME char(65),  @O_vTECHID2 char(11)  select   @O_TODAY = convert(varchar(10), getdate(), 101),  @O_DUMMYDT = convert(varchar(10), '1900/01/01', 100),  @USERID = 'eConnect',  @Note_Index_1 = 0,  @Line_Seq_Exists = 0,  @iStatus  = 0,  @iCustomState  = 0,  @iCustomErrString = '',  @iAddCodeErrState  = 0,  @O_oErrorState  = 0,  @iError  = 0,  @iGetNextNoteIdxErrState  = 0,  @sCompanyID  = 0,  @AuditLNITMSEQ = 0,  @AuditDesc = 'Equipment updated via eConnect',  @EQUIPID = 0,  @STREQUIPID = '',  @CUSTNMBR = '',  @ADRSCODE = '',  @O_iErrorState = 0,  @oErrString = '',  @iValueExists = 0,  @O_vMTTR = 0,  @O_vMTBF = 0,  @O_vMTBI = 0,  @O_vLast_Calc_Date = @O_DUMMYDT,  @O_vMeters_1 = 0,  @O_vMeters_2 = 0,  @O_vMeters_3 = 0,  @O_vMeters_4 = 0,  @O_vMeters_5 = 0,  @O_vDailys_1 = 0,  @O_vDailys_2 = 0,  @O_vDailys_3 = 0,  @O_vDailys_4 = 0,  @O_vDailys_5 = 0,  @O_vMTBFs_1 = 0,  @O_vMTBFs_2 = 0,  @O_vMTBFs_3 = 0,  @O_vMTBFs_4 = 0,  @O_vMTBFs_5 = 0,  @O_vMeter_Deltas_1 = 0,  @O_vMeter_Deltas_2 = 0,  @O_vMeter_Deltas_3 = 0,  @O_vMeter_Deltas_4 = 0,  @O_vMeter_Deltas_5 = 0,  @O_vQUANTITY = 1,  @O_iItemMetered = 0,  @O_iBadReading = 0,  @EquipDocExists = 0,  @HOLD = 0,  @INACTIVE = 0,  @ADDRESS1 = '',  @ADDRESS2 = '',  @ADDRESS3 = '',  @COUNTRY = '',  @CITY = '',  @STATE = '',  @ZIP = '',  @CNTCPRSN = '',  @PHONE1 = '',  @SVCAREA = '',  @OFFID = '',  @TECHID = '',  @TIMEZONE = '',  @TECHSTAT = '',  @VENDHOLD = 0,  @VENDINACTIVE = 0,  @VADDCDPR = '',  @VENDNAME  = '',  @O_vTECHID2 = ''  if (@oErrString is NULL) begin  select @oErrString = '' end  exec @iStatus = taFSEquipmentMasterPre  @I_vSERLNMBR output,  @I_vITEMNMBR output,  @I_vREFRENCE output,  @I_vVersion output,  @I_vSRLSTAT output,  @I_vCUSTNMBR output,  @I_vADRSCODE output,  @I_vADDRESS1 output,  @I_vADDRESS2 output,  @I_vADDRESS3 output,  @I_vCITY output,  @I_vSTATE output,  @I_vZIP output,  @I_vCOUNTRY output,  @I_vCNTCPRSN output,  @I_vINSTDTE output,  @I_vShipped_Date output,  @I_vSVC_Register_Date output,  @I_vLSTPMDTE output,  @I_vLSTSRVDTE output,  @I_vTECHID output,  @I_vOFFID output,  @I_vSVCAREA output,  @I_vTIMEZONE output,  @I_vVENDORID output,  @I_vWARRCDE output,  @I_vWARRSTART output,  @I_vWARREND output,  @I_vSLRWARR output,  @I_vSLRWSTART output,  @I_vSLRWEND output,  @I_vNOTETXT output,  @I_vSVC_PM_Date output,  @I_vSVC_PM_Day output,  @I_vUSERDEF1 output,  @I_vUSERDEF2 output,  @I_vUSRDEF03 output,  @I_vUSRDEF04 output,  @I_vUSRDEF05 output,  @I_vSVC_Serial_ID output,  @I_vSVC_Asset_Tag output,  @I_vUpdateIfExists output,  @I_vRequesterTrx output,  @I_vUSRDEFND1 output,  @I_vUSRDEFND2 output,  @I_vUSRDEFND3 output,  @I_vUSRDEFND4 output,  @I_vUSRDEFND5 output,  @O_iErrorState = @iCustomState output,  @oErrString = @iCustomErrString output select @iError = @@error if @iStatus = 0 and @iError <> 0 begin  select @iStatus = @iError end if (@iStatus <> 0) or (@iCustomState <> 0) begin  select @oErrString = rtrim(@oErrString) + ' ' + ltrim(rtrim(@iCustomErrString))  set @O_iErrorState = 10095    exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output  return (@O_iErrorState) end  if( @I_vSERLNMBR is null or  @I_vITEMNMBR is null or    @I_vCUSTNMBR is null or   @I_vADRSCODE is null   ) begin  set @O_iErrorState = 10096    exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output  return (@O_iErrorState) end  if( @I_vSERLNMBR='' or  @I_vITEMNMBR='' or  @I_vCUSTNMBR='' OR  @I_vADRSCODE=''  ) begin  set @O_iErrorState = 10097    exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output  return (@O_iErrorState) end  if( @I_vSVC_PM_Date < 0 or   @I_vSVC_PM_Day < 0  ) begin  set @O_iErrorState = 10098    exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output  return (@O_iErrorState) end  if (@I_vUpdateIfExists not in (0,1)) begin  set @O_iErrorState = 10135     exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output  return (@O_iErrorState) end  select  @I_vITEMNMBR = UPPER(@I_vITEMNMBR),  @I_vSERLNMBR = UPPER(@I_vSERLNMBR),  @I_vCUSTNMBR = UPPER(@I_vCUSTNMBR),  @I_vADRSCODE = UPPER(@I_vADRSCODE),  @I_vVENDORID = UPPER(@I_vVENDORID),  @I_vTECHID = UPPER(@I_vTECHID),  @I_vOFFID = UPPER(@I_vOFFID),  @I_vSRLSTAT = UPPER(@I_vSRLSTAT),  @I_vSVCAREA = UPPER(@I_vSVCAREA),  @I_vTIMEZONE = UPPER(@I_vTIMEZONE)  set @Line_Seq_Exists = 0 select @Line_Seq_Exists = 1,   @EQUIPID = isnull(EQUIPID, 0),   @CUSTNMBR = isnull(CUSTNMBR, ''),  @ADRSCODE = isnull(ADRSCODE, '')  from SVC00300 (nolock) where SERLNMBR = @I_vSERLNMBR and ITEMNMBR = @I_vITEMNMBR  if (@Line_Seq_Exists=0) or (@EQUIPID = 0) begin  select @EQUIPID = isnull(max(EQUIPID), 0) + 1 from SVC00300 (nolock) end  if (@Line_Seq_Exists=1) and (@I_vUpdateIfExists = 0)  begin  set @O_iErrorState = 10099    exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output  return (@O_iErrorState) end  if (@I_vCUSTNMBR <> '') begin  set @iValueExists = 0  select  @iValueExists=1,  @HOLD=isnull(HOLD,0),  @INACTIVE=isnull(INACTIVE,0)  from RM00101 (nolock) where CUSTNMBR=@I_vCUSTNMBR   if (@iValueExists <> 1)  begin  set @O_iErrorState = 10100     exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output  return (@O_iErrorState)  end  end  if (@I_vCUSTNMBR <> '') and (@I_vADRSCODE <> '') begin  set @iValueExists = 0  select  @iValueExists = 1,  @ADDRESS1=isnull(ADDRESS1,''),  @ADDRESS2=isnull(ADDRESS2,''),  @ADDRESS3=isnull(ADDRESS3,''),  @COUNTRY=isnull(COUNTRY,''),  @CITY=isnull(CITY,''),  @STATE=isnull(STATE,''),  @ZIP=isnull(ZIP,''),  @CNTCPRSN=isnull(CNTCPRSN,0),  @PHONE1=isnull(PHONE1,'')  from RM00102 (nolock) where CUSTNMBR=@I_vCUSTNMBR and ADRSCODE = @I_vADRSCODE   if (@iValueExists <> 1)  begin  set @O_iErrorState = 10103     exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output  return (@O_iErrorState)  end end  if (@Line_Seq_Exists=0) begin  select @sCompanyID = CMPANYID from DYNAMICS..SY01500 c (nolock) where c.INTERID = db_name()   exec @iStatus = DYNAMICS..tasmGetNextNoteIndex  @I_sCompanyID   = @sCompanyID,  @I_iSQLSessionID = 0,  @I_noteincrement = 3,  @O_mNoteIndex   = @Note_Index_1 output,  @O_iErrorState  = @iGetNextNoteIdxErrState output  select @iError = @@error  if @iStatus = 0 and @iError <> 0  begin  select @iStatus = @iError  end  if (@iStatus <> 0) or (@iGetNextNoteIdxErrState <> 0)  begin  if (@iGetNextNoteIdxErrState <> 0)  begin  exec @iStatus = taUpdateString  @iGetNextNoteIdxErrState,  @oErrString,  @oErrString output,  @O_oErrorState output  end   set @O_iErrorState = 10104   exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output  return (@O_iErrorState)  end end  if (@Line_Seq_Exists=1)  begin  select  @I_vREFRENCE = case  when @I_vREFRENCE is null then isnull(REFRENCE, '')  else @I_vREFRENCE  end,  @I_vVersion = case  when @I_vVersion is null then isnull(Version, '')  else @I_vVersion  end,  @I_vSRLSTAT = case  when @I_vSRLSTAT is null then isnull(SRLSTAT, '')  else @I_vSRLSTAT  end,  @CUSTNMBR = isnull(CUSTNMBR, ''),  @ADRSCODE = isnull(ADRSCODE, ''),  @I_vADDRESS1 = case  when @I_vADDRESS1 is null then isnull(ADDRESS1, '')  else @I_vADDRESS1  end,  @I_vADDRESS2 = case  when @I_vADDRESS2 is null then isnull(ADDRESS2, '')  else @I_vADDRESS2  end,  @I_vADDRESS3 = case  when @I_vADDRESS3 is null then isnull(ADDRESS3, '')  else @I_vADDRESS3  end,  @I_vCITY = case  when @I_vCITY is null then isnull(CITY, '')  else @I_vCITY  end,  @I_vSTATE = case  when @I_vSTATE is null then isnull(STATE, '')  else @I_vSTATE   end,  @I_vZIP = case  when @I_vZIP is null then isnull(ZIP, '')  else @I_vZIP   end,  @I_vCOUNTRY = case  when @I_vCOUNTRY is null then isnull(COUNTRY, '')  else @I_vCOUNTRY   end,  @I_vCNTCPRSN = case  when @I_vCNTCPRSN is null then isnull(CNTCPRSN, '')  else @I_vCNTCPRSN   end,  @I_vINSTDTE = case  when @I_vINSTDTE is null then isnull(INSTDTE, @O_TODAY)  else @I_vINSTDTE   end,  @I_vShipped_Date = case  when @I_vShipped_Date is null then isnull(Shipped_Date, @O_DUMMYDT)  else @I_vShipped_Date   end,  @I_vSVC_Register_Date = case  when @I_vSVC_Register_Date is null then isnull(SVC_Register_Date, @O_DUMMYDT)  else @I_vSVC_Register_Date   end,  @I_vLSTPMDTE = case  when @I_vLSTPMDTE is null then isnull(LSTPMDTE, @O_DUMMYDT)  else @I_vLSTPMDTE   end,  @I_vLSTSRVDTE = case  when @I_vLSTSRVDTE is null then isnull(LSTSRVDTE, @O_DUMMYDT)  else @I_vLSTSRVDTE   end,  @I_vTECHID = case  when @I_vTECHID is null then isnull(TECHID, '')  else @I_vTECHID   end,  @O_vTECHID2 = isnull(TECHID2, ''),  @I_vOFFID = case  when @I_vOFFID is null then isnull(OFFID, '')  else @I_vOFFID   end,  @I_vSVCAREA = case  when @I_vSVCAREA is null then isnull(SVCAREA, '')  else @I_vSVCAREA   end,  @I_vTIMEZONE = case  when @I_vTIMEZONE is null then isnull(TIMEZONE, '')  else @I_vTIMEZONE   end,  @I_vVENDORID = case  when @I_vVENDORID is null then isnull(VENDORID, '')  else @I_vVENDORID   end,  @I_vWARRCDE = case  when @I_vWARRCDE is null then isnull(WARRCDE, '')  else @I_vWARRCDE   end,  @I_vWARRSTART = case  when @I_vWARRSTART is null then isnull(WARRSTART, @O_DUMMYDT)  else @I_vWARRSTART   end,  @I_vWARREND = case  when @I_vWARREND is null then isnull(WARREND, @O_DUMMYDT)  else @I_vWARREND   end,  @I_vSLRWARR = case  when @I_vSLRWARR is null then isnull(SLRWARR, '')  else @I_vSLRWARR   end,  @I_vSLRWSTART = case  when @I_vSLRWSTART is null then isnull(SLRWSTART, @O_DUMMYDT)  else @I_vSLRWSTART   end,  @I_vSLRWEND = case  when @I_vSLRWEND is null then isnull(SLRWEND, @O_DUMMYDT)  else @I_vSLRWEND   end,  @Note_Index_1 = isnull(NOTEINDX, 0),  @I_vSVC_PM_Date = case  when @I_vSVC_PM_Date is null then isnull(SVC_PM_Date, 0)  else @I_vSVC_PM_Date   end,  @I_vSVC_PM_Day = case  when @I_vSVC_PM_Day is null then isnull(SVC_PM_Day, 0)  else @I_vSVC_PM_Day   end,  @I_vUSERDEF1 = case  when @I_vUSERDEF1 is null then isnull(USERDEF1, '')  else @I_vUSERDEF1   end,  @I_vUSERDEF2 = case  when @I_vUSERDEF2 is null then isnull(USERDEF2, '')  else @I_vUSERDEF2   end,  @I_vUSRDEF03 = case  when @I_vUSRDEF03 is null then isnull(USRDEF03, '')  else @I_vUSRDEF03   end,  @I_vUSRDEF04 = case  when @I_vUSRDEF04 is null then isnull(USRDEF04, '')  else @I_vUSRDEF04   end,  @I_vUSRDEF05 = case  when @I_vUSRDEF05 is null then isnull(USRDEF05, '')  else @I_vUSRDEF05   end,  @I_vSVC_Serial_ID = case  when @I_vSVC_Serial_ID is null or @I_vSVC_Serial_ID = '' then isnull(SVC_Serial_ID, isnull(@I_vSERLNMBR, ''))  else @I_vSVC_Serial_ID   end,  @I_vSVC_Asset_Tag = case  when @I_vSVC_Asset_Tag is null then isnull(SVC_Asset_Tag, '')  else @I_vSVC_Asset_Tag   end,  @O_vMTTR = isnull(MTTR, 0),  @O_vMTBF = isnull(MTBF, 0),  @O_vMTBI = isnull(MTBI, 0),  @O_vLast_Calc_Date = isnull(Last_Calc_Date, @O_DUMMYDT),  @O_vMeters_1 = isnull(Meters_1, 0),  @O_vMeters_2 = isnull(Meters_2, 0),  @O_vMeters_3 = isnull(Meters_3, 0),  @O_vMeters_4 = isnull(Meters_4, 0),  @O_vMeters_5 = isnull(Meters_5, 0),  @O_vDailys_1 = isnull(Dailys_1, 0),  @O_vDailys_2 = isnull(Dailys_2, 0),  @O_vDailys_3 = isnull(Dailys_3, 0),  @O_vDailys_4 = isnull(Dailys_4, 0),  @O_vDailys_5 = isnull(Dailys_5, 0),  @O_vMTBFs_1 = isnull(MTBFs_1, 0),  @O_vMTBFs_2 = isnull(MTBFs_2, 0),  @O_vMTBFs_3 = isnull(MTBFs_3, 0),  @O_vMTBFs_4 = isnull(MTBFs_4, 0),  @O_vMTBFs_5 = isnull(MTBFs_5, 0),  @O_vMeter_Deltas_1 = isnull(Meter_Deltas_1, 0),  @O_vMeter_Deltas_2 = isnull(Meter_Deltas_2, 0),  @O_vMeter_Deltas_3 = isnull(Meter_Deltas_3, 0),  @O_vMeter_Deltas_4 = isnull(Meter_Deltas_4, 0),  @O_vMeter_Deltas_5 = isnull(Meter_Deltas_5, 0),  @O_vQUANTITY = isnull(QUANTITY, 0)   from SVC00300 (nolock) where EQUIPID = @EQUIPID and SERLNMBR = @I_vSERLNMBR and ITEMNMBR = @I_vITEMNMBR end   select  @I_vREFRENCE = case  when @I_vREFRENCE is null then ''  else @I_vREFRENCE  end,  @I_vVersion = case  when @I_vVersion is null then ''  else @I_vVersion  end,  @I_vSRLSTAT = case  when @I_vSRLSTAT is null then ''  else @I_vSRLSTAT  end,  @I_vCUSTNMBR = case  when @I_vCUSTNMBR is null then ''  else @I_vCUSTNMBR  end,  @I_vADRSCODE = case  when @I_vADRSCODE is null then ''  else @I_vADRSCODE  end,  @I_vADDRESS1 = case  when @I_vADDRESS1 is null then ''  else @I_vADDRESS1  end,  @I_vADDRESS2 = case  when @I_vADDRESS2 is null then ''  else @I_vADDRESS2  end,  @I_vADDRESS3 = case  when @I_vADDRESS3 is null then ''  else @I_vADDRESS3  end,  @I_vCITY = case  when @I_vCITY is null then ''  else @I_vCITY  end,  @I_vSTATE = case  when @I_vSTATE is null then ''  else @I_vSTATE   end,  @I_vZIP = case  when @I_vZIP is null then ''  else @I_vZIP   end,  @I_vCOUNTRY = case  when @I_vCOUNTRY is null then ''  else @I_vCOUNTRY   end,  @I_vCNTCPRSN = case  when @I_vCNTCPRSN is null then ''  else @I_vCNTCPRSN   end,  @I_vINSTDTE = case  when @I_vINSTDTE is null then @O_TODAY  else @I_vINSTDTE   end,  @I_vShipped_Date = case  when @I_vShipped_Date is null then @O_DUMMYDT  else @I_vShipped_Date   end,  @I_vSVC_Register_Date = case  when @I_vSVC_Register_Date is null then @O_DUMMYDT  else @I_vSVC_Register_Date   end,  @I_vLSTPMDTE = case  when @I_vLSTPMDTE is null then @O_DUMMYDT  else @I_vLSTPMDTE   end,  @I_vLSTSRVDTE = case  when @I_vLSTSRVDTE is null then @O_DUMMYDT  else @I_vLSTSRVDTE   end,  @I_vTECHID = case  when @I_vTECHID is null then ''  else @I_vTECHID   end,  @O_vTECHID2 = '',  @I_vOFFID = case  when @I_vOFFID is null then ''  else @I_vOFFID   end,  @I_vSVCAREA = case  when @I_vSVCAREA is null then ''  else @I_vSVCAREA   end,  @I_vTIMEZONE = case  when @I_vTIMEZONE is null then ''  else @I_vTIMEZONE   end,  @I_vVENDORID = case  when @I_vVENDORID is null then ''  else @I_vVENDORID   end,  @I_vWARRCDE = case  when @I_vWARRCDE is null then ''  else @I_vWARRCDE   end,  @I_vWARRSTART = case  when @I_vWARRSTART is null then @O_DUMMYDT  else @I_vWARRSTART   end,  @I_vWARREND = case  when @I_vWARREND is null then @O_DUMMYDT  else @I_vWARREND   end,  @I_vSLRWARR = case  when @I_vSLRWARR is null then ''  else @I_vSLRWARR   end,  @I_vSLRWSTART = case  when @I_vSLRWSTART is null then @O_DUMMYDT  else @I_vSLRWSTART   end,  @I_vSLRWEND = case  when @I_vSLRWEND is null then @O_DUMMYDT  else @I_vSLRWEND   end,  @I_vSVC_PM_Date = case  when @I_vSVC_PM_Date is null then 0  else @I_vSVC_PM_Date   end,  @I_vSVC_PM_Day = case  when @I_vSVC_PM_Day is null then 0  else @I_vSVC_PM_Day   end,  @I_vUSERDEF1 = case  when @I_vUSERDEF1 is null then ''  else @I_vUSERDEF1   end,  @I_vUSERDEF2 = case  when @I_vUSERDEF2 is null then ''  else @I_vUSERDEF2   end,  @I_vUSRDEF03 = case  when @I_vUSRDEF03 is null then ''  else @I_vUSRDEF03   end,  @I_vUSRDEF04 = case  when @I_vUSRDEF04 is null then ''  else @I_vUSRDEF04   end,  @I_vUSRDEF05 = case  when @I_vUSRDEF05 is null then ''  else @I_vUSRDEF05   end,  @I_vSVC_Serial_ID = case  when @I_vSVC_Serial_ID is null or @I_vSVC_Serial_ID = '' then isnull(@I_vSERLNMBR, '')  else @I_vSVC_Serial_ID   end,  @I_vSVC_Asset_Tag = case  when @I_vSVC_Asset_Tag is null then ''  else @I_vSVC_Asset_Tag   end  select @AuditLNITMSEQ = count(*) + 1 from SVC00310 (nolock) where EQUIPID = @EQUIPID  if (@I_vITEMNMBR <> '') begin  if not exists(select 1 from IV00101 (nolock) where ITEMNMBR=@I_vITEMNMBR)  begin  set @O_iErrorState = 10105     exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output  return (@O_iErrorState)  end end  if (@I_vITEMNMBR <> '') begin  set @iValueExists = 0  select @iValueExists = 1, @O_iItemMetered = isnull(METERED, 0) from SVC00951 (nolock) where ITEMNMBR = @I_vITEMNMBR  if (@@ERROR <> 0)  begin  set @O_iErrorState = 10106   exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output  return (@O_iErrorState)  end end   if (@I_vADDRESS1 is null or @I_vADDRESS1 = '') or (@I_vCITY is null or @I_vCITY = '') begin  select @I_vADDRESS1 = @ADDRESS1,  @I_vADDRESS2 = @ADDRESS2,  @I_vADDRESS3 = @ADDRESS3,  @I_vCITY = @CITY,  @I_vSTATE = @STATE,  @I_vZIP = @ZIP,  @I_vCOUNTRY = @COUNTRY end  if (@I_vCNTCPRSN is null) or (@I_vCNTCPRSN = '') begin  set @I_vCNTCPRSN = @CNTCPRSN end  select @SVCAREA =  case  when @I_vSVCAREA = ''  then isnull(SVCAREA, '')  else @I_vSVCAREA  end,  @OFFID=  case  when @I_vOFFID = ''  then isnull(OFFID, '')  else @I_vOFFID  end,  @TECHID=  case  when @I_vTECHID = ''  then isnull(TECHID, '')  else @I_vTECHID  end,  @TIMEZONE=  case  when @I_vTIMEZONE = ''  then isnull(TIMEZONE, '')  else @I_vTIMEZONE  end  from SVC00950 (nolock) where CUSTNMBR=@I_vCUSTNMBR and ADRSCODE = @I_vADRSCODE  select @I_vSRLSTAT = case  when @I_vSRLSTAT is null or @I_vSRLSTAT = '' then SRLSTAT  else @I_vSRLSTAT  end,  @TIMEZONE = case  when @TIMEZONE = '' then TIMEZONE  else @TIMEZONE  end,  @OFFID = case  when @OFFID = '' then OFFID  else @OFFID  end  from SVC00998 (nolock)  if (@I_vSVCAREA = '')  set @I_vSVCAREA = @SVCAREA  if (@I_vSVCAREA <> '') begin  if (not exists(select 1 from SVC00909 (nolock) where SVCAREA = @I_vSVCAREA))  begin  set @O_iErrorState = 10107     exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output  return (@O_iErrorState)  end end  if (@I_vTECHID = '')  set @I_vTECHID = @TECHID  if (@I_vTECHID <> '') begin  set @iValueExists = 0  select @iValueExists=1, @TECHSTAT=isnull(TECHSTAT,''),   @OFFID = case   when @OFFID = '' then isnull(OFFID, '')   else @OFFID   end  from SVC00100 (nolock) where TECHID = @I_vTECHID  if (@iValueExists <> 1)  begin  set @O_iErrorState = 10108     exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output  return (@O_iErrorState)  end end  if (@O_vTECHID2 <> '') begin  set @iValueExists = 0  select @iValueExists=1, @TECHSTAT=isnull(TECHSTAT,'')  from SVC00100 (nolock) where TECHID = @O_vTECHID2   if (@iValueExists <> 1)  begin   set @O_vTECHID2 = ''  end end  if (@I_vOFFID = '')  set @I_vOFFID = @OFFID  if (@I_vOFFID <> '') begin  if (not exists(select 1 from SVC00902 (nolock) where OFFID = @I_vOFFID))  begin  set @O_iErrorState = 10110     exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output  return (@O_iErrorState)  end end  if (@I_vTIMEZONE = '')  set @I_vTIMEZONE = @TIMEZONE  if (@I_vTIMEZONE <> '') begin  if (not exists(select 1 from SVC00900 (nolock) where TIMEZONE = @I_vTIMEZONE))  begin  set @O_iErrorState = 10111     exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output  return (@O_iErrorState)  end end  if @I_vSRLSTAT <> '' begin  if not exists(select 1 from SVC00911 (nolock) where SRLSTAT = @I_vSRLSTAT)  begin  set @O_iErrorState = 10112     exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output  return (@O_iErrorState)  end end  if (@CUSTNMBR <> '' and @CUSTNMBR <> @I_vCUSTNMBR) or (@ADRSCODE <> '' and @ADRSCODE <> @I_vADRSCODE) begin  set @EquipDocExists = 0  if exists(select 1 from SVC00601 (nolock) where (CONSTS = 1 or CONSTS = 2) and (Contract_Line_Status = 'C' or Contract_Line_Status = 'E')  and EQUIPID = @EQUIPID and ENDDATE < @O_TODAY)  set @EquipDocExists = 1   if exists(select 1 from SVC00202 (nolock) where SRVRECTYPE = 2 and EQUIPID = @EQUIPID)  set @EquipDocExists = 1  if (@EquipDocExists = 1)  begin  set @O_iErrorState = 10113     exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output  return (@O_iErrorState)  end   set @iStatus = 0  exec @iStatus = SVC_Check_Equip_On_Config  '',   @EQUIPID   if (@iStatus > 0)  begin  set @O_iErrorState = 10114     exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output  return (@O_iErrorState)  end  end  if (@I_vINSTDTE <> '') and not (datepart(hour, @I_vINSTDTE) = 0 and datepart(minute, @I_vINSTDTE) = 0 and datepart(second, @I_vINSTDTE) = 0   and datepart(millisecond,@I_vShipped_Date) = 0) begin  set @O_iErrorState = 10115     exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output  return (@O_iErrorState) end  if (@I_vShipped_Date <> '') and not (datepart(hour,@I_vShipped_Date) = 0 and datepart(minute,@I_vShipped_Date) = 0 and datepart(second,@I_vShipped_Date) = 0   and datepart(millisecond,@I_vShipped_Date) = 0) begin  set @O_iErrorState = 10116     exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output  return (@O_iErrorState) end  if (@I_vSVC_Register_Date <> '') and not (datepart(hour,@I_vSVC_Register_Date) = 0 and datepart(minute,@I_vSVC_Register_Date) = 0 and datepart(second,@I_vSVC_Register_Date ) = 0   and datepart(millisecond,@I_vSVC_Register_Date) = 0) begin  set @O_iErrorState = 10117     exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output  return (@O_iErrorState) end  if (@I_vLSTPMDTE <> '') and not (datepart(hour,@I_vLSTPMDTE) = 0 and datepart(minute,@I_vLSTPMDTE) = 0 and datepart(second,@I_vLSTPMDTE) = 0   and datepart(millisecond,@I_vLSTPMDTE) = 0) begin  set @O_iErrorState = 10118     exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output  return (@O_iErrorState) end  if (@I_vLSTSRVDTE <> '') and not (datepart(hour,@I_vLSTSRVDTE) = 0 and datepart(minute,@I_vLSTSRVDTE) = 0 and datepart(second,@I_vLSTSRVDTE) = 0   and datepart(millisecond,@I_vLSTSRVDTE) = 0) begin  set @O_iErrorState = 10119     exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output  return (@O_iErrorState) end  if (@I_vWARRSTART <> '') and not (datepart(hour,@I_vWARRSTART) = 0 and datepart(minute,@I_vWARRSTART) = 0 and datepart(second,@I_vWARRSTART) = 0   and datepart(millisecond,@I_vWARRSTART) = 0) begin  set @O_iErrorState = 10120     exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output  return (@O_iErrorState) end  if (@I_vWARREND <> '') and not (datepart(hour,@I_vWARREND) = 0 and datepart(minute,@I_vWARREND) = 0 and datepart(second,@I_vWARREND) = 0   and datepart(millisecond,@I_vWARREND) = 0) begin  set @O_iErrorState = 10121     exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output  return (@O_iErrorState) end  if (@I_vWARREND < @I_vWARRSTART) begin  set @O_iErrorState = 10122     exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output  return (@O_iErrorState) end  if (@I_vSLRWSTART <> '') and not (datepart(hour,@I_vSLRWSTART) = 0 and datepart(minute,@I_vSLRWSTART) = 0 and datepart(second,@I_vSLRWSTART) = 0   and datepart(millisecond,@I_vSLRWSTART) = 0) begin  set @O_iErrorState = 10123     exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output  return (@O_iErrorState) end  if (@I_vSLRWEND <> '') and not (datepart(hour,@I_vSLRWEND) = 0 and datepart(minute,@I_vSLRWEND) = 0 and datepart(second,@I_vSLRWEND) = 0   and datepart(millisecond,@I_vSLRWEND) = 0) begin  set @O_iErrorState = 10124     exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output  return (@O_iErrorState) end  if (@I_vSLRWEND < @I_vSLRWSTART) begin  set @O_iErrorState = 10125     exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output  return (@O_iErrorState) end  if (@I_vVENDORID <> '') begin  set @iValueExists = 0  select  @iValueExists=1,  @VENDHOLD=isnull(HOLD,0),  @VENDINACTIVE=isnull(VENDSTTS,1),  @VADDCDPR=isnull(VADDCDPR,''),  @VENDNAME = isnull(@VENDNAME, '')  from PM00200 (nolock) where VENDORID=@I_vVENDORID   if (@iValueExists <> 1)  begin  set @O_iErrorState = 10126     exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output  return (@O_iErrorState)  end   if (@VENDHOLD=1)  begin  set @O_iErrorState = 10127     exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output  return (@O_iErrorState)  end end  if (@I_vWARRCDE <> '') and not exists(select 1 from SVC00906 (nolock) where WARRCDE = @I_vWARRCDE) begin  set @O_iErrorState = 10128     exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output  return (@O_iErrorState) end  if (@I_vSLRWARR <> '') and not exists(select 1 from SVC00906 (nolock) where WARRCDE = @I_vSLRWARR) begin  set @O_iErrorState = 10129     exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output  return (@O_iErrorState) end  if (@I_vSVC_PM_Date = 0)  set @I_vSVC_PM_Day = 0 else begin  if (@I_vSVC_PM_Day > case   when @I_vSVC_PM_Date in (1,3,5,7,8,10,12) then 31   when @I_vSVC_PM_Date = 2 then 29  else 30   end  )  begin  set @O_iErrorState = 10130     exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output  return (@O_iErrorState)   end  end  if (@O_iErrorState <> 0)  return (@O_iErrorState)  if (@Line_Seq_Exists=0) begin  insert into SVC00300( EQUIPID,  SERLNMBR,  ITEMNMBR,  REFRENCE,  Version,  SRLSTAT,  CUSTNMBR,  ADRSCODE,  ADDRESS1,  ADDRESS2,  ADDRESS3,  CITY,  STATE,  ZIP,  COUNTRY,  CNTCPRSN,  INSTDTE,  Shipped_Date,  SVC_Register_Date,  LSTPMDTE,  LSTSRVDTE,  TECHID,  TECHID2,  OFFID,  SVCAREA,  TIMEZONE,  VENDORID,  WARRCDE,  WARRSTART,  WARREND,  SLRWARR,  SLRWSTART,  SLRWEND,  NOTEINDX,  MTTR,  MTBF,  MTBI,  Last_Calc_Date,  Meters_1,  Meters_2,  Meters_3,  Meters_4,  Meters_5,  Dailys_1,  Dailys_2,  Dailys_3,  Dailys_4,  Dailys_5,  MTBFs_1,  MTBFs_2,  MTBFs_3,  MTBFs_4,  MTBFs_5,  Meter_Deltas_1,  Meter_Deltas_2,  Meter_Deltas_3,  Meter_Deltas_4,  Meter_Deltas_5,  SVC_PM_Date,  SVC_PM_Day,  USERDEF1,  USERDEF2,  USRDEF03,  USRDEF04,  USRDEF05,  SVC_Serial_ID,  QUANTITY,  SVC_Asset_Tag,  SOPNUMBE  )  select  @EQUIPID,  @I_vSERLNMBR,  @I_vITEMNMBR,  @I_vREFRENCE,  @I_vVersion,  @I_vSRLSTAT,  @I_vCUSTNMBR,  @I_vADRSCODE,  @I_vADDRESS1,  @I_vADDRESS2,  @I_vADDRESS3,  @I_vCITY,  @I_vSTATE,  @I_vZIP,  @I_vCOUNTRY,  @I_vCNTCPRSN,  @I_vINSTDTE,  @I_vShipped_Date,  @I_vSVC_Register_Date,  @I_vLSTPMDTE,  @I_vLSTSRVDTE,  @I_vTECHID,  @O_vTECHID2,  @I_vOFFID,  @I_vSVCAREA,  @I_vTIMEZONE,  @I_vVENDORID,  @I_vWARRCDE,  @I_vWARRSTART,  @I_vWARREND,  @I_vSLRWARR,  @I_vSLRWSTART,  @I_vSLRWEND,  @Note_Index_1,  @O_vMTTR,  @O_vMTBF,  @O_vMTBI,  @O_vLast_Calc_Date,  @O_vMeters_1,  @O_vMeters_2,  @O_vMeters_3,  @O_vMeters_4,  @O_vMeters_5,  @O_vDailys_1,  @O_vDailys_2,  @O_vDailys_3,  @O_vDailys_4,  @O_vDailys_5,  @O_vMTBFs_1,  @O_vMTBFs_2,  @O_vMTBFs_3,  @O_vMTBFs_4,  @O_vMTBFs_5,  @O_vMeter_Deltas_1,  @O_vMeter_Deltas_2,  @O_vMeter_Deltas_3,  @O_vMeter_Deltas_4,  @O_vMeter_Deltas_5,  @I_vSVC_PM_Date,  @I_vSVC_PM_Day,  @I_vUSERDEF1,  @I_vUSERDEF2,  @I_vUSRDEF03,  @I_vUSRDEF04,  @I_vUSRDEF05,  @I_vSVC_Serial_ID,  @O_vQUANTITY,  @I_vSVC_Asset_Tag,  ''       if (@@error <> 0)  begin  set @O_iErrorState = 10131    exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @iAddCodeErrState output  return (@O_iErrorState)  end   insert into SVC00310  (EQUIPID,  LNITMSEQ,  DATE1,  TIME1,  USERID,  From_Customer_Number,  To_Customer_Number,  From_Config_Reference,  To_Config_Reference,  From_Confg_Level,  To_Config_Level,  From_Config_Sequence,  To_Config_Sequence,  From_Serial_Number,  To_Serial_Number,  From_Item_Number,  To_Item_Number,  DSCRIPTN)  select  @EQUIPID,  @AuditLNITMSEQ,  @O_TODAY,  convert(varchar(12),getdate(),108),  @USERID,  case when @CUSTNMBR <> @I_vCUSTNMBR then '' else @I_vCUSTNMBR end,  @I_vCUSTNMBR,  '',  '',  0,  0,  0,  0,  @I_vSERLNMBR,  @I_vSERLNMBR,  @I_vITEMNMBR,  @I_vITEMNMBR,  @AuditDesc  if @@error <> 0  begin  set @O_iErrorState = 10327    exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output  return (@O_iErrorState)  end end else begin  if (@I_vUpdateIfExists > 0)  begin  update SVC00300 set  SERLNMBR = @I_vSERLNMBR,  ITEMNMBR = @I_vITEMNMBR,  REFRENCE = @I_vREFRENCE,  Version = @I_vVersion,  SRLSTAT = @I_vSRLSTAT,  CUSTNMBR = @I_vCUSTNMBR,  ADRSCODE = @I_vADRSCODE,  ADDRESS1 = @I_vADDRESS1,  ADDRESS2 = @I_vADDRESS2,  ADDRESS3 = @I_vADDRESS3,  CITY = @I_vCITY,  STATE = @I_vSTATE,  ZIP = @I_vZIP,  COUNTRY = @I_vCOUNTRY,  CNTCPRSN = @I_vCNTCPRSN,  INSTDTE = @I_vINSTDTE,  Shipped_Date = @I_vShipped_Date,  SVC_Register_Date = @I_vSVC_Register_Date,  LSTPMDTE = @I_vLSTPMDTE,  LSTSRVDTE = @I_vLSTSRVDTE,  TECHID = @I_vTECHID,  TECHID2 = @O_vTECHID2,  OFFID = @I_vOFFID,  SVCAREA = @I_vSVCAREA,  TIMEZONE = @I_vTIMEZONE,  VENDORID = @I_vVENDORID,  WARRCDE = @I_vWARRCDE,  WARRSTART = @I_vWARRSTART,  WARREND = @I_vWARREND,  SLRWARR = @I_vSLRWARR,  SLRWSTART = @I_vSLRWSTART,  SLRWEND = @I_vSLRWEND,  NOTEINDX = @Note_Index_1,  MTTR = @O_vMTTR,  MTBF = @O_vMTBF,  MTBI = @O_vMTBI,  Last_Calc_Date = @O_vLast_Calc_Date,  Meters_1 = @O_vMeters_1,  Meters_2 = @O_vMeters_2,  Meters_3 = @O_vMeters_3,  Meters_4 = @O_vMeters_4,  Meters_5 = @O_vMeters_5,  Dailys_1 = @O_vDailys_1,  Dailys_2 = @O_vDailys_2,  Dailys_3 = @O_vDailys_3,  Dailys_4 = @O_vDailys_4,  Dailys_5 = @O_vDailys_5,  MTBFs_1 = @O_vMTBFs_1,  MTBFs_2 = @O_vMTBFs_2,  MTBFs_3 = @O_vMTBFs_3,  MTBFs_4 = @O_vMTBFs_4,  MTBFs_5 = @O_vMTBFs_5,  Meter_Deltas_1 = @O_vMeter_Deltas_1,  Meter_Deltas_2 = @O_vMeter_Deltas_2,  Meter_Deltas_3 = @O_vMeter_Deltas_3,  Meter_Deltas_4 = @O_vMeter_Deltas_4,  Meter_Deltas_5 = @O_vMeter_Deltas_5,  SVC_PM_Date = @I_vSVC_PM_Date,  SVC_PM_Day = @I_vSVC_PM_Day,  USERDEF1 = @I_vUSERDEF1,  USERDEF2 = @I_vUSERDEF2,  USRDEF03 = @I_vUSRDEF03,  USRDEF04 = @I_vUSRDEF04,  USRDEF05 = @I_vUSRDEF05,  SVC_Serial_ID = @I_vSVC_Serial_ID,  QUANTITY = @O_vQUANTITY,  SVC_Asset_Tag = @I_vSVC_Asset_Tag   where EQUIPID = @EQUIPID AND SERLNMBR = @I_vSERLNMBR and ITEMNMBR = @I_vITEMNMBR  if (@@error <> 0)  begin  set @O_iErrorState = 10133    exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @iAddCodeErrState output  return (@O_iErrorState)  end   insert into SVC00310  (EQUIPID,  LNITMSEQ,  DATE1,  TIME1,  USERID,  From_Customer_Number,  To_Customer_Number,  From_Config_Reference,  To_Config_Reference,  From_Confg_Level,  To_Config_Level,  From_Config_Sequence,  To_Config_Sequence,  From_Serial_Number,  To_Serial_Number,  From_Item_Number,  To_Item_Number,  DSCRIPTN)  select  @EQUIPID,  @AuditLNITMSEQ,  @O_TODAY,  convert(varchar(12),getdate(),108),  @USERID,  case when @CUSTNMBR <> @I_vCUSTNMBR then '' else @I_vCUSTNMBR end,  @I_vCUSTNMBR,  '',  '',  0,  0,  0,  0,  '',  @I_vSERLNMBR,  '',  @I_vITEMNMBR,  @AuditDesc  if @@error <> 0  begin  set @O_iErrorState = 10132    exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output  return (@O_iErrorState)  end  end end  if (@O_iErrorState <> 0)  return (@O_iErrorState)  if (@I_vNOTETXT <> '') and (@Note_Index_1 > 0) begin  if exists(select 1 from SY03900 where NOTEINDX = @Note_Index_1)  update SY03900 set TXTFIELD = @I_vNOTETXT,   DATE1 = @O_TODAY,   TIME1 = convert(char(12), getdate(), 108)   where NOTEINDX = @Note_Index_1  else  insert into SY03900 (NOTEINDX,   DATE1,   TIME1,   TXTFIELD)   select @Note_Index_1,   @O_TODAY,   convert(char(12), getdate(), 108),   @I_vNOTETXT end  exec @iStatus = taFSEquipmentMasterPost  @I_vSERLNMBR,  @I_vITEMNMBR,  @I_vREFRENCE,  @I_vVersion,  @I_vSRLSTAT,  @I_vCUSTNMBR,  @I_vADRSCODE,  @I_vADDRESS1,  @I_vADDRESS2,  @I_vADDRESS3,  @I_vCITY,  @I_vSTATE,  @I_vZIP,  @I_vCOUNTRY,  @I_vCNTCPRSN,  @I_vINSTDTE,  @I_vShipped_Date,  @I_vSVC_Register_Date,  @I_vLSTPMDTE,  @I_vLSTSRVDTE,  @I_vTECHID,  @I_vOFFID,  @I_vSVCAREA,  @I_vTIMEZONE,  @I_vVENDORID,  @I_vWARRCDE,  @I_vWARRSTART,  @I_vWARREND,  @I_vSLRWARR,  @I_vSLRWSTART,  @I_vSLRWEND,  @I_vNOTETXT,  @I_vSVC_PM_Date,  @I_vSVC_PM_Day,  @I_vUSERDEF1,  @I_vUSERDEF2,  @I_vUSRDEF03,  @I_vUSRDEF04,  @I_vUSRDEF05,  @I_vSVC_Serial_ID,  @I_vSVC_Asset_Tag,  @I_vUpdateIfExists,  @I_vRequesterTrx,  @I_vUSRDEFND1,  @I_vUSRDEFND2,  @I_vUSRDEFND3,  @I_vUSRDEFND4,  @I_vUSRDEFND5,  @O_iErrorState = @iCustomState output,  @oErrString = @iCustomErrString output select @iError = @@error if @iStatus = 0 and @iError <> 0 begin  select @iStatus = @iError end if (@iStatus <> 0) or (@iCustomState <> 0) begin  select @oErrString = rtrim(@oErrString) + ' ' + ltrim(rtrim(@iCustomErrString))  set @O_iErrorState = 10134    exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output  return (@O_iErrorState) end  return (@O_iErrorState)   
GO
GRANT EXECUTE ON  [dbo].[taFSEquipmentMaster] TO [DYNGRP]
GO
