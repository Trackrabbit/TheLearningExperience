SET QUOTED_IDENTIFIER OFF
GO
SET ANSI_NULLS ON
GO
 CREATE Procedure [dbo].[SVC_Get_Contract_Work_Hours]  (@ContractNumber char(11),  @ContractLine numeric(19,5),  @InDate datetime,  @InPeriod smallint = 1,  @Avail smallint OUTPUT,  @STARTTIME datetime OUTPUT,  @ENDTIME datetime OUTPUT) As declare @Day smallint  select @STARTTIME = @InDate,  @ENDTIME = @InDate  select @Day = DATEPART(dw,@InDate) select @Avail = case @Day  WHEN 2 THEN USECVPD_1  WHEN 3 THEN USECVPD_2  WHEN 4 THEN USECVPD_3  WHEN 5 THEN USECVPD_4  WHEN 6 THEN USECVPD_5  WHEN 7 THEN USECVPD_6  WHEN 1 THEN USECVPD_7  END from SVC00601  WHERE CONSTS = 2 and CONTNBR = @ContractNumber and LNSEQNBR = @ContractLine if @Avail <> 0 and @InPeriod = 1 BEGIN  select @STARTTIME = case @Day  WHEN 2 THEN CNTCOVPD_1  WHEN 3 THEN CNTCOVPD_2  WHEN 4 THEN CNTCOVPD_3  WHEN 5 THEN CNTCOVPD_4  WHEN 6 THEN CNTCOVPD_5  WHEN 7 THEN CNTCOVPD_6  WHEN 1 THEN CNTCOVPD_7  END,  @ENDTIME = case @Day  WHEN 2 THEN Contract_Coverage_Period_1  WHEN 3 THEN Contract_Coverage_Period_2  WHEN 4 THEN Contract_Coverage_Period_3  WHEN 5 THEN Contract_Coverage_Period_4  WHEN 6 THEN Contract_Coverage_Period_5  WHEN 7 THEN Contract_Coverage_Period_6  WHEN 1 THEN Contract_Coverage_Period_7  END  from SVC00601   WHERE CONSTS = 2 and CONTNBR = @ContractNumber and LNSEQNBR = @ContractLine END  else if @Avail <> 0 and @InPeriod = 2 BEGIN  select @STARTTIME = case @Day  WHEN 2 THEN svcCoveragePeriodStart2_1  WHEN 3 THEN svcCoveragePeriodStart2_2  WHEN 4 THEN svcCoveragePeriodStart2_3  WHEN 5 THEN svcCoveragePeriodStart2_4  WHEN 6 THEN svcCoveragePeriodStart2_5  WHEN 7 THEN svcCoveragePeriodStart2_6  WHEN 1 THEN svcCoveragePeriodStart2_7  END,  @ENDTIME = case @Day  WHEN 2 THEN svcCoveragePeriodEnd2_1  WHEN 3 THEN svcCoveragePeriodEnd2_2  WHEN 4 THEN svcCoveragePeriodEnd2_3  WHEN 5 THEN svcCoveragePeriodEnd2_4  WHEN 6 THEN svcCoveragePeriodEnd2_5  WHEN 7 THEN svcCoveragePeriodEnd2_6  WHEN 1 THEN svcCoveragePeriodEnd2_7  END  from SVC00683   WHERE CONSTS = 2 and CONTNBR = @ContractNumber and LNSEQNBR = @ContractLine END  else if @Avail <> 0 and @InPeriod = 3 BEGIN  select @STARTTIME = case @Day  WHEN 2 THEN svcCoveragePeriodStart3_1  WHEN 3 THEN svcCoveragePeriodStart3_2  WHEN 4 THEN svcCoveragePeriodStart3_3  WHEN 5 THEN svcCoveragePeriodStart3_4  WHEN 6 THEN svcCoveragePeriodStart3_5  WHEN 7 THEN svcCoveragePeriodStart3_6  WHEN 1 THEN svcCoveragePeriodStart3_7  END,  @ENDTIME = case @Day  WHEN 2 THEN svcCoveragePeriodEnd3_1  WHEN 3 THEN svcCoveragePeriodEnd3_2  WHEN 4 THEN svcCoveragePeriodEnd3_3  WHEN 5 THEN svcCoveragePeriodEnd3_4  WHEN 6 THEN svcCoveragePeriodEnd3_5  WHEN 7 THEN svcCoveragePeriodEnd3_6  WHEN 1 THEN svcCoveragePeriodEnd3_7  END  from SVC00683   WHERE CONSTS = 2 and CONTNBR = @ContractNumber and LNSEQNBR = @ContractLine END  else if @Avail <> 0 and @InPeriod = 4 BEGIN  select @STARTTIME = case @Day  WHEN 2 THEN svcCoveragePeriodStart4_1  WHEN 3 THEN svcCoveragePeriodStart4_2  WHEN 4 THEN svcCoveragePeriodStart4_3  WHEN 5 THEN svcCoveragePeriodStart4_4  WHEN 6 THEN svcCoveragePeriodStart4_5  WHEN 7 THEN svcCoveragePeriodStart4_6  WHEN 1 THEN svcCoveragePeriodStart4_7  END,  @ENDTIME = case @Day  WHEN 2 THEN svcCoveragePeriodEnd4_1  WHEN 3 THEN svcCoveragePeriodEnd4_2  WHEN 4 THEN svcCoveragePeriodEnd4_3  WHEN 5 THEN svcCoveragePeriodEnd4_4  WHEN 6 THEN svcCoveragePeriodEnd4_5  WHEN 7 THEN svcCoveragePeriodEnd4_6  WHEN 1 THEN svcCoveragePeriodEnd4_7  END  from SVC00683   WHERE CONSTS = 2 and CONTNBR = @ContractNumber and LNSEQNBR = @ContractLine  END   select @STARTTIME = CONVERT(varchar(20),@InDate,102) + ' ' +   CONVERT(varchar(20),@STARTTIME,108),  @ENDTIME = CONVERT(varchar(20),@InDate,102) + ' ' +  CONVERT(varchar(20),@ENDTIME,108)  return (0)    
GO
GRANT EXECUTE ON  [dbo].[SVC_Get_Contract_Work_Hours] TO [DYNGRP]
GO
