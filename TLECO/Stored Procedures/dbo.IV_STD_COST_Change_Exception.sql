SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO
 create Procedure [dbo].[IV_STD_COST_Change_Exception] ( @CalledBy smallint =null ,  @ItemNumber varchar(200)=null , @TableName varchar(100) out   ) as   BEGIN  Declare @ExecString_1 nvarchar(4000) ,  @INVACTINX bit    ,  @REVACTINX bit    ,  @ClassID varchar(200) ,  @ItemDesc varchar(500) ,  @lSQLError int  set  @ItemDesc=''  set  @ClassID=''  set  @INVACTINX=0  set  @REVACTINX=0  set  @ExecString_1='' IF @CalledBy= 1  BEGIN   select @INVACTINX=IVIVINDX,  @REVACTINX=IVSCRVIX,  @ClassID=ITMCLSCD,  @ItemDesc=ITEMDESC   from IV00101 where ITEMNMBR=@ItemNumber  select @INVACTINX =ISNULL(@INVACTINX,0),  @REVACTINX =ISNULL(@REVACTINX,0),  @ClassID =ISNULL(@ClassID,''),  @ItemDesc =ISNULL(@ItemDesc,'')   if @INVACTINX=0   begin  select @INVACTINX=ACTINDX from SY01100 where SERIES=5 and SEQNUMBR=100  select @INVACTINX=ISNULL(@INVACTINX,0)  end   if @REVACTINX=0  begin   select @REVACTINX=ACTINDX from SY01100 where SERIES=5 and SEQNUMBR=1500  select @REVACTINX=ISNULL(@REVACTINX,0)   end  if @INVACTINX=0 or @REVACTINX=0  begin  if @INVACTINX=0   set @INVACTINX=1   else set @INVACTINX=0  if @REVACTINX=0   set @REVACTINX=1   else set @REVACTINX=0  select @ExecString_1='Insert into '+ @TableName +' values('''+replace(@ItemNumber,'''','''''' )+''',  '''+replace(@ItemDesc,'''','''''' )+''','+convert(varchar(2),@INVACTINX)+',  '+convert(varchar(2),@REVACTINX)+')'  exec(@ExecString_1)   end   END else if @CalledBy = 2  BEGIN  set @ItemNumber=''   declare YearEndcloseException Cursor LOCAL FAST_Forward for  select ITEMNMBR,  ITEMDESC,  ITMCLSCD,  IVIVINDX,  IVSCRVIX   from IV00101 where VCTNMTHD>3  open YearEndcloseException  Fetch Next from YearEndcloseException into @ItemNumber,@ItemDesc,@ClassID,@INVACTINX,@REVACTINX  while @@FETCH_STATUS=0  Begin  IF @INVACTINX=0  begin   select @INVACTINX=ACTINDX from SY01100 where SERIES=5 and SEQNUMBR=100  select @INVACTINX=ISNULL(@INVACTINX,0)   end  IF @REVACTINX=0  begin  select @REVACTINX=ACTINDX from SY01100 where SERIES=5 and SEQNUMBR=1500   select @REVACTINX=ISNULL(@REVACTINX,0)   end  if @INVACTINX=0 or @REVACTINX=0  begin  if @INVACTINX=0   set @INVACTINX=1   else set @INVACTINX=0  if @REVACTINX=0   set @REVACTINX=1   else set @REVACTINX=0   select @ExecString_1='Insert into '+ @TableName +'   values('''+replace(@ItemNumber,'''','''''' )+''',  '''+replace(@ItemDesc,'''','''''' )+''',  '+convert(varchar(2),@INVACTINX)+',  '+convert(varchar(2),@REVACTINX)+')'   exec(@ExecString_1)   end   Fetch Next from YearEndcloseException into @ItemNumber,@ItemDesc,@ClassID,@INVACTINX,@REVACTINX  end  close YearEndcloseException  deallocate YearEndcloseException   END  RETURN (@lSQLError)  END   
GO
GRANT EXECUTE ON  [dbo].[IV_STD_COST_Change_Exception] TO [DYNGRP]
GO
