SET QUOTED_IDENTIFIER OFF
GO
SET ANSI_NULLS ON
GO
 create procedure [dbo].[SVC_RTV_Delete] (  @RTV char(15)   ) as declare @ProcessLine numeric(19,5), @RMALine numeric(19,5) declare @RMA char(15), @Transfer char(11), @TableType smallint   exec SVC_Get_RTV_Table @RTV, @TableType output if @TableType = 2   Begin  delete from SVC05612 where RTV_Number = @RTV  delete from SVC35620 where RTV_Number = @RTV  delete from SVC35630 where RTV_Number = @RTV  delete from SVC35601 where RTV_Number = @RTV  delete from SVC35602 where RTV_Number = @RTV  delete from SVC35600 where RTV_Number = @RTV   End else  Begin  select @RMA = RETDOCID from SVC05600 where RTV_Number = @RTV  if @RMA > ''  begin  declare Process_Line cursor for select SVC_Process_SEQ_Number, LNSEQNBR   from SVC05210 where SVC05210.RETDOCID = @RMA and SVC05210.SVC_Document_Number = @RTV and SVC_Process_Type = 2  open Process_Line   fetch next from Process_Line into @ProcessLine, @RMALine  while @@FETCH_STATUS = 0  Begin  update SVC05210 set SVC_Document_Number = '' ,SVC_Process_Status = '', SVC_IV_SEQ_Number = 0,  Return_Disposition_Statu = 0 where Return_Record_Type = 1  and RETDOCID = @RMA and LNSEQNBR = @RMALine and SVC_Process_SEQ_Number = @ProcessLine  fetch next from Process_Line into  @ProcessLine, @RMALine  End  deallocate Process_Line   end  if (select count(*) from SVC05601 where RTV_Number = @RTV and Transfer_Reference > '') > 0   begin  declare Transfer_Line cursor for select Transfer_Reference from SVC05601 where RTV_Number = @RTV and Transfer_Reference > ''  open Transfer_Line   fetch next from Transfer_Line into @Transfer  while @@FETCH_STATUS = 0  Begin  delete SVC00731 where ORDDOCID = @Transfer  delete SVC00701 where ORDDOCID = @Transfer  delete SVC00700 where ORDDOCID = @Transfer  fetch next from Transfer_Line into  @Transfer  End  deallocate Transfer_Line   end   delete from SVC05612 where RTV_Number = @RTV  delete from SVC05620 where RTV_Number = @RTV  delete from SVC05630 where RTV_Number = @RTV  delete from SVC05601 where RTV_Number = @RTV  delete from SVC05602 where RTV_Number = @RTV  delete from SVC05600 where RTV_Number = @RTV   End  return     
GO
GRANT EXECUTE ON  [dbo].[SVC_RTV_Delete] TO [DYNGRP]
GO
