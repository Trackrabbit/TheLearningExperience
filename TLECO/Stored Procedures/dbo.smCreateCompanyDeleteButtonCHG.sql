SET QUOTED_IDENTIFIER OFF
GO
SET ANSI_NULLS ON
GO
 create procedure [dbo].[smCreateCompanyDeleteButtonCHG]  @I_iSQLSessionID int = NULL, @I_cCompanyName char(64) = NULL, @I_sCompanyid smallint = NULL, @I_tControlUser tinyint = NULL, @O_iErrorState int = NULL output  as  declare  @tTransaction tinyint,  @iCount int,  @iStatus int,  @cMasterOwner char(30),  @cDynamicsOwner char(30),  @cUserID char(15)  if  @I_cCompanyName is NULL or  @I_sCompanyid is NULL or  @I_iSQLSessionID is NULL begin   select @O_iErrorState = 20084  return end else begin  select @O_iErrorState = 0 end  create table #USERID (  USERID char(15) )  select @iCount = (select  count(CMPANYID)  from  DYNAMICS.dbo.SY60100  where  @I_sCompanyid = CMPANYID)  if @@rowcount <> 0 begin  delete   DYNAMICS.dbo.SY60100  where   @I_sCompanyid = CMPANYID   if @@rowcount <> @iCount  begin  select @O_iErrorState = 20245  return  end end  select @iCount = (select  count(CMPANYID)  from  DYNAMICS.dbo.SY10500  where  @I_sCompanyid = CMPANYID)  if @@rowcount <> 0 begin  delete   DYNAMICS.dbo.SY10500  where   @I_sCompanyid = CMPANYID  if @@rowcount <> @iCount begin  select @O_iErrorState = 21098  return  end end  select @iCount = (select  count(CMPANYID)  from  DYNAMICS.dbo.SY10550  where  @I_sCompanyid = CMPANYID)  if @@rowcount <> 0 begin  delete   DYNAMICS.dbo.SY10550  where   @I_sCompanyid = CMPANYID  if @@rowcount <> @iCount begin  select @O_iErrorState = 21099  return  end end  select @iCount = (select  count(CMPNYNAM)  from  DYNAMICS.dbo.SY01600  where  @I_cCompanyName = CMPNYNAM)  if @@rowcount <> 0 begin  delete   DYNAMICS.dbo.SY01600  where   @I_cCompanyName = CMPNYNAM   if @@rowcount <> @iCount  begin  select @O_iErrorState = 20247  return  end end  select @iCount = (select  count(CMPANYID)  from  DYNAMICS.dbo.SY02100  where  @I_sCompanyid = CMPANYID)  if @@rowcount <> 0 begin  delete   DYNAMICS.dbo.SY02100  where   @I_sCompanyid = CMPANYID   if @@rowcount <> @iCount  begin  select @O_iErrorState = 20248  return  end end  select @iCount = (select  count(CMPANYID)  from  DYNAMICS.dbo.SY01900  where  @I_sCompanyid = CMPANYID)  if @@rowcount <> 0 begin  delete   DYNAMICS.dbo.SY01900  where   @I_sCompanyid = CMPANYID   if @@rowcount <> @iCount  begin  select @O_iErrorState = 20249  return  end end  select @iCount = (select  count(CMPANYID)  from  SY00600  where  @I_sCompanyid = CMPANYID)  if @@rowcount <> 0 begin  delete   SY00600  where   @I_sCompanyid = CMPANYID   if @@rowcount <> @iCount  begin  select @O_iErrorState = 20250  return  end end  select @iCount = (select  count(companyID)  from  DYNAMICS.dbo.DU000020  where  @I_sCompanyid = companyID)  if @@rowcount <> 0 begin  delete   DYNAMICS.dbo.DU000020  where   @I_sCompanyid = companyID   if @@rowcount <> @iCount  begin  select @O_iErrorState = 21107  return  end end  select @iCount = (select  count(companyID)  from  DYNAMICS.dbo.DU000030  where  @I_sCompanyid = companyID)  if @@rowcount <> 0 begin  delete   DYNAMICS.dbo.DU000030  where   @I_sCompanyid = companyID   if @@rowcount <> @iCount  begin  select @O_iErrorState = 21108  return  end end  select @iCount = (select  count(db_name)  from  DYNAMICS.dbo.DB_Upgrade, DYNAMICS.dbo.SY01500  where  @I_sCompanyid = CMPANYID and INTERID = db_name)  if @@rowcount <> 0 begin  DELETE   DYNAMICS.dbo.DB_Upgrade  where   db_name = (select INTERID from DYNAMICS.dbo.SY01500 where CMPANYID = @I_sCompanyid)   if @@rowcount <> @iCount  begin  select @O_iErrorState = 21108  return  end end  return    
GO
GRANT EXECUTE ON  [dbo].[smCreateCompanyDeleteButtonCHG] TO [DYNGRP]
GO
