SET QUOTED_IDENTIFIER OFF
GO
SET ANSI_NULLS ON
GO
 CREATE PROCEDURE [dbo].[seeSOPSalesDocumentCountDetail_Create] @iLanguageID int   as   set nocount on   declare @sqldropstring varchar(400),   @sqlstring1 varchar(8000),   @sqlstring2 varchar(8000),   @sqlstring3 varchar(8000),   @sqlstring4 varchar(8000),   @sqlstring5 varchar(8000),   @sqlstring6 varchar(8000),   @sqlstring7 varchar(8000),   @sqlstring8 varchar(8000),   @sqlstring9 varchar(8000),   @sqlstring10 varchar(8000),   @sqljoinstring varchar(8000),   @sqlaccessstring varchar(2000),   @tNumberSegments int,   @tSegment int,   @I_iDictID int,   @I_iLangID int,   @I_iMessageNumber int,   @I_iAliasMessageNumber int,   @I_iIntegerValue int,  @SOP_Type varchar(255), @Customer_Number varchar(255), @Document_Date varchar(255)  select @I_iDictID = 1493 select @I_iMessageNumber = 22600 select @I_iAliasMessageNumber = 0 exec DYNAMICS..smGetBIMsgStringForProcs  @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @SOP_Type output   select @I_iDictID = 1493 select @I_iMessageNumber = 22637 select @I_iAliasMessageNumber = 0 exec DYNAMICS..smGetBIMsgStringForProcs  @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @Customer_Number output   select @I_iDictID = 1493 select @I_iMessageNumber = 22606 select @I_iAliasMessageNumber = 0 exec DYNAMICS..smGetBIMsgStringForProcs  @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @Document_Date output    select @sqldropstring =   'IF EXISTS (SELECT * FROM   sys.objects WHERE  object_id = OBJECT_ID(N''[dbo].[seeSOPSalesDocumentCountDetail]'') AND type in ( N''P'', N''PC'' ))  ' +   '  DROP PROCEDURE [dbo].[seeSOPSalesDocumentCountDetail]  '   select @sqlstring1 =   'create procedure dbo.seeSOPSalesDocumentCountDetail '+   ' @CustomerNumber varchar(50) = null, '+   ' @DocumentDateStart datetime = null, '+   ' @DocumentDateEnd datetime = null, '+   ' @DocumentType varchar(50) = null '+   'as '+   'if @DocumentDateEnd is null or @DocumentDateStart is null '+   ' if @CustomerNumber is null '+   '  if @DocumentType is null '+   '   select *  '+   '    from SalesTransactions '+   '  else '+   '   select *  '+   '    from SalesTransactions '+   '    where ['+@SOP_Type+'] = @DocumentType '+   ' else '+   '  if @DocumentType is null '+   '   select *  '+   '    from SalesTransactions '+   '    where ['+@Customer_Number+'] = @CustomerNumber '+   '  else '+   '   select *  '+   '    from SalesTransactions '+   '    where ['+@Customer_Number+'] = @CustomerNumber '+   '     and ['+@SOP_Type+'] = @DocumentType '+   'if @DocumentDateEnd is not null and @DocumentDateStart is not null '+   ' if @CustomerNumber is null '+   '  if @DocumentType is null '+   '   select *  '+   '    from SalesTransactions '+   '    where (['+@Document_Date+'] >= @DocumentDateStart and ['+@Document_Date+'] <= @DocumentDateEnd) '+   '  else '+   '   select *  '+   '    from SalesTransactions '+   '    where ['+@SOP_Type+'] = @DocumentType '+   '     and (['+@Document_Date+'] >= @DocumentDateStart and ['+@Document_Date+'] <= @DocumentDateEnd) '+   ' else '+   '  if @DocumentType is null '+   '   select *  '+   '    from SalesTransactions '+   '    where ['+@Customer_Number+'] = @CustomerNumber '+   '     and (['+@Document_Date+'] >= @DocumentDateStart and ['+@Document_Date+'] <= @DocumentDateEnd) '+   '  else '+   '   select *  '+   '    from SalesTransactions '+   '    where ['+@Customer_Number+'] = @CustomerNumber '+   '     and ['+@SOP_Type+'] = @DocumentType '+   '     and (['+@Document_Date+'] >= @DocumentDateStart and ['+@Document_Date+'] <= @DocumentDateEnd) '   select @sqlaccessstring =   'GRANT execute ON [dbo].[seeSOPSalesDocumentCountDetail] TO  [rpt_accounts receivable coordinator],[rpt_collections manager], '+  ' [rpt_accounting manager],[rpt_order processor],[rpt_executive]'   exec (@sqldropstring)   exec (@sqlstring1+' '+@sqlstring2+' '+@sqlstring3+' '+@sqlstring4+' '+@sqlstring5+' '+@sqlstring6+' '+@sqlstring7+' '+@sqlstring8+' '+@sqlstring9+' '+@sqlstring10)   exec (@sqlaccessstring)   set nocount off    
GO
GRANT EXECUTE ON  [dbo].[seeSOPSalesDocumentCountDetail_Create] TO [DYNGRP]
GO
