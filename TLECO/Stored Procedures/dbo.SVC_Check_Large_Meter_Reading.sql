SET QUOTED_IDENTIFIER OFF
GO
SET ANSI_NULLS ON
GO
 Create Procedure [dbo].[SVC_Check_Large_Meter_Reading] (  @MeterToCheck integer,   @EquipID integer,  @Date datetime,    @Meter integer,   @BadReading tinyint OUTPUT  ) As  DECLARE @DailyUsage numeric(19,5),   @PrevMeter integer,  @PrevDate datetime select @BadReading = 0   IF @MeterToCheck = 1 BEGIN  select @PrevMeter = Meters_1, @PrevDate = LSTDTEDT from SVC00301 with (NOLOCK)  where Meters_1 > 0 and EQUIPID = @EquipID and LNITMSEQ = (select max(a.LNITMSEQ) from SVC00301 a  where a.Meters_1 > 0 and a.EQUIPID = @EquipID)   select @DailyUsage = Dailys_1 from SVC00300 where EQUIPID = @EquipID  END ELSE IF @MeterToCheck = 2 BEGIN  select @PrevMeter = Meters_2, @PrevDate = LSTDTEDT from SVC00301 with (NOLOCK)  where Meters_2 > 0 and EQUIPID = @EquipID and LNITMSEQ = (select max(a.LNITMSEQ) from SVC00301 a  where a.Meters_2 > 0 and a.EQUIPID = @EquipID)  select @DailyUsage = Dailys_2 from SVC00300 where EQUIPID = @EquipID  END ELSE IF @MeterToCheck = 3 BEGIN  select @PrevMeter = Meters_3, @PrevDate = LSTDTEDT from SVC00301 with (NOLOCK)  where Meters_3 > 0 and EQUIPID = @EquipID and LNITMSEQ = (select max(a.LNITMSEQ) from SVC00301 a  where a.Meters_3 > 0 and a.EQUIPID = @EquipID)  select @DailyUsage = Dailys_3 from SVC00300 where EQUIPID = @EquipID  END ELSE IF @MeterToCheck = 4 BEGIN  select @PrevMeter = Meters_4, @PrevDate = LSTDTEDT from SVC00301 with (NOLOCK)  where Meters_4 > 0 and EQUIPID = @EquipID and LNITMSEQ = (select max(a.LNITMSEQ) from SVC00301 a  where a.Meters_4 > 0 and a.EQUIPID = @EquipID)   select @DailyUsage = Dailys_4 from SVC00300 where EQUIPID = @EquipID  END ELSE IF @MeterToCheck = 5 BEGIN  select @PrevMeter = Meters_5, @PrevDate = LSTDTEDT from SVC00301 with (NOLOCK)  where Meters_5 > 0 and EQUIPID = @EquipID and LNITMSEQ = (select max(a.LNITMSEQ) from SVC00301 a  where a.Meters_5 > 0 and a.EQUIPID = @EquipID)   select @DailyUsage = Dailys_5 from SVC00300 where EQUIPID = @EquipID  END   if (@Meter - @PrevMeter) > (1.5 * @DailyUsage * DateDiff(dd,@PrevDate,@Date) )  select @BadReading = 1 return     
GO
GRANT EXECUTE ON  [dbo].[SVC_Check_Large_Meter_Reading] TO [DYNGRP]
GO
