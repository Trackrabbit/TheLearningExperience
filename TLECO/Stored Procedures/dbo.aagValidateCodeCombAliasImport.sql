SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO
 CREATE  PROCEDURE [dbo].[aagValidateCodeCombAliasImport]  @I_cTableAliasDim NVARCHAR(30) = NULL, @IO_fValidCodeComb TINYINT = 1 OUTPUT, @O_ErrorNumber TINYINT = 1 OUTPUT  AS  SET @IO_fValidCodeComb = 1  BEGIN   DECLARE  @nTrxDimID INT   DECLARE  @nTrxDimCodeID INT   DECLARE  @nRelTrxDimID INT   DECLARE  @TrxDimIDDup INT   EXEC ('DECLARE Alias CURSOR FAST_FORWARD FOR  SELECT aaTrxDimID, aaTrxDimCodeID FROM ' + @I_cTableAliasDim +   '   WHERE aaDataType = 1 AND aaTrxDimCodeID IS NOT NULL')   OPEN Alias   FETCH NEXT FROM Alias INTO @nTrxDimID, @nTrxDimCodeID   WHILE @@FETCH_STATUS = 0   BEGIN    IF NOT EXISTS(SELECT aaTrxDimID FROM AAG00401 WHERE aaTrxDimID = @nTrxDimID AND aaTrxDimCodeID = @nTrxDimCodeID)  BEGIN  SET @IO_fValidCodeComb = 0  SET @O_ErrorNumber = 5  CLOSE Alias   DEALLOCATE Alias   RETURN  END   DECLARE CurRelType CURSOR FAST_FORWARD FOR  SELECT A.aaRelTrxDimID FROM AAG00406 A  INNER JOIN AAG00405 B ON A.aaTrxDimID = B.aaTrxDimID  AND A.aaRelTrxDimID = B.aaRelTrxDimID  AND aaTrxDimRelType = 3  WHERE A.aaTrxDimID = @nTrxDimID AND aaTrxDimCodeID = @nTrxDimCodeID   OPEN CurRelType   FETCH NEXT FROM CurRelType INTO @nRelTrxDimID  WHILE @@FETCH_STATUS = 0   BEGIN  SET @IO_fValidCodeComb = 0  EXEC ('DECLARE AliasDup CURSOR FAST_FORWARD FOR SELECT aaTrxDimID FROM ' + @I_cTableAliasDim +  ' WHERE aaDataType = 1')   OPEN AliasDup   FETCH NEXT FROM AliasDup INTO @TrxDimIDDup   WHILE @@FETCH_STATUS = 0   BEGIN   IF @nRelTrxDimID = @TrxDimIDDup   BEGIN  SET @IO_fValidCodeComb = 1  END  FETCH NEXT FROM AliasDup INTO @TrxDimIDDup   END  CLOSE AliasDup   DEALLOCATE AliasDup   IF @IO_fValidCodeComb = 0   BEGIN  SET @O_ErrorNumber = 7  CLOSE CurRelType  DEALLOCATE CurRelType   CLOSE Alias   DEALLOCATE Alias   RETURN  END  FETCH NEXT FROM CurRelType INTO @nRelTrxDimID  END  CLOSE CurRelType  DEALLOCATE CurRelType   FETCH NEXT FROM Alias INTO @nTrxDimID,@nTrxDimCodeID   END   CLOSE Alias   DEALLOCATE Alias   RETURN(0)  END    
GO
GRANT EXECUTE ON  [dbo].[aagValidateCodeCombAliasImport] TO [DYNGRP]
GO
