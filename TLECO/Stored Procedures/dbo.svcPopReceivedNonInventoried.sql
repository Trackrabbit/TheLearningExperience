SET QUOTED_IDENTIFIER OFF
GO
SET ANSI_NULLS ON
GO
 Create Procedure [dbo].[svcPopReceivedNonInventoried]  (@PONumber char(21),  @POLineSeq numeric(19,5),  @ItemNumber char(31),  @Qty numeric(19,5),  @RCVNumber char(21),  @RCVLineSeq numeric(19,5),  @VendorID char(15),  @UserDate datetime  ) As declare @CallNumber char(15),  @SrvRecType smallint,  @EquipLine integer,  @LineItemType char(3),  @LineItemSeq int,  @Status char(3),  @RTVNumber char(15),  @RTVLine numeric(19,5),  @RTVType char(11),  @RecStat char(3), @PartialRcvStat char(3),  @NowDate datetime,  @NowTime datetime,  @NowDateTime datetime,  @MinDate datetime,  @WONumber char(15),  @WORecType smallint,  @Auditdesc char(100) declare   @UserID char(21) declare @Line int declare @ItemType smallint declare @ProcessLine Numeric(19,5), @RMA char(15), @RMALine numeric(19,5) declare @RTVStatus smallint, @RTVStatus_Current smallint declare @PrevStatus char(3) declare @NonIV tinyint declare @UNITCOST Numeric(19,5), @EXTDCOST Numeric(19,5),@ORUNTCST Numeric(19,5) ,@OREXTCST Numeric(19,5), @CMPNTSEQ int if not exists(select * from SVC00998) return if exists(select * from IV00101 where ITEMNMBR = @ItemNumber) return  select @NowDateTime = getdate() exec SVC_util_split_datetime @NowDateTime, @NowDate output, @NowTime output exec smGetMinDate @MinDate output  if @PONumber > ''  BEGIN  select @RTVNumber = RTV_Number, @RTVLine = RTV_Line, @RTVType = RTV_Type, @RTVStatus_Current = RTV_Status,  @RMA = RETDOCID, @RMALine = LNSEQNBR, @ProcessLine = SVC_Process_SEQ_Number, @PrevStatus = RTV_Return_Status  from SVC05601  where PONMBRSTR = @PONumber and POLNSEQ = @POLineSeq  if @RTVNumber >''  BEGIN  select @RecStat = RTV_Received_Status from SVC05003 where RTV_Type = @RTVType  update SVC05601 set RTV_Status = 5, receiptdate = @UserDate, Receipt_Time = @NowTime,   POPRCTNM = @RCVNumber, RCPTLNNM = @RCVLineSeq, QTY_To_Receive = @Qty , QTYRECVD = QTYRECVD + @Qty  ,  Return_Item_Number = @ItemNumber ,RTV_Return_Status = @RecStat   where RTV_Number = @RTVNumber and RTV_Line = @RTVLine  exec SVC_RTV_Set_HDR_Values @RTVNumber  if @RMA > ''  exec SVC_RTV_Update_RMAProcessStatus @RTVNumber, @RTVLine, @RecStat,1  select @Auditdesc =' PO Receiving: Rcv. Number/Line Number : '+ rtrim(@RCVNumber)+ '/' + rtrim(cast(@RCVLineSeq as char(20)))  exec SVC_Create_RTV_Audit  @RTVNumber,@RTVLine, @PrevStatus,@RecStat, @Auditdesc,@UserID,@NowDateTime,@NowDateTime  END  else   BEGIN  select @Status = Parts_Available_Status from SVC00998  select @UNITCOST = UNITCOST, @EXTDCOST = EXTDCOST, @ORUNTCST = ORUNTCST ,@OREXTCST = OREXTCST from POP30310   where POPRCTNM=@RCVNumber and  RCPTLNNM = @RCVLineSeq and PONUMBER = @PONumber  select @CallNumber = CALLNBR,   @SrvRecType = SRVRECTYPE,  @EquipLine = EQPLINE,  @LineItemType = LINITMTYP,  @LineItemSeq = LNITMSEQ,  @CMPNTSEQ = CMPNTSEQ  from SVC00203  where PONMBRSTR = @PONumber and POLNSEQ = @POLineSeq and ITEMNMBR = @ItemNumber  IF @CallNumber > '' and @SrvRecType = 2  BEGIN  update SVC00203 set SRVSTAT = @Status,  UNITCOST = @UNITCOST, EXTDCOST = @EXTDCOST, ORUNTCST = @ORUNTCST ,OREXTCST = @OREXTCST  where  @CallNumber = CALLNBR and   @SrvRecType = SRVRECTYPE and  @EquipLine = EQPLINE and  @LineItemType = LINITMTYP and  @LineItemSeq = LNITMSEQ and  @CMPNTSEQ = CMPNTSEQ  exec SVC_Set_SC_HDR_Status @SrvRecType, @CallNumber  END  END  END  return (0)    
GO
GRANT EXECUTE ON  [dbo].[svcPopReceivedNonInventoried] TO [DYNGRP]
GO
