SET QUOTED_IDENTIFIER OFF
GO
SET ANSI_NULLS ON
GO
 CREATE PROCEDURE [dbo].[SVC_RTV_Update_Line_Vendor] (  @RTV char(15) ) AS declare @AddressCode char(15) declare @ShipAddressName char(60) declare @Vendor char(15) declare @VendorItem char(31) declare @VendorName char(65) declare @UserID char(15) declare @RTVLine numeric(19,5) declare @RTVType char(11) declare @CallNumber char(11) declare @address1 varchar(61) declare @address2 varchar(61) declare @address3 varchar(61) declare @city varchar(61) declare @Shipmethod varchar(15) declare @state varchar(60) declare @zip varchar(11) declare @Country char(61) declare @Item char(31) declare @PARTAMOUNT numeric(19,2),  @LABORAMOUNT numeric(19,2),  @TRAVELAMOUNT numeric(19,2),  @MISCAMOUNT numeric(19,2)  select @Vendor = VENDORID, @VendorName = VENDNAME, @AddressCode = ADRSCODE,  @ShipAddressName = Ship_Address_Name,   @address1 = Ship_Address_1, @address2 = Ship_Address_2, @address3 = Ship_Address_3, @city = Ship_City,  @state = Ship_State,@zip = ZIPCODE, @Country = Ship_Country, @Shipmethod = SHIPMTHD  from SVC05600 where RTV_Number = @RTV   declare RTVLine cursor for select RTV_Line, ITEMNMBR,  RTV_Type from SVC05601 where RTV_Number = @RTV  open RTVLine   fetch next from RTVLine into @RTVLine, @Item, @RTVType  while @@FETCH_STATUS = 0  Begin  select @VendorItem = VNDITNUM from IV00103 where ITEMNMBR = @Item and VENDORID = @Vendor  exec SVC_RMA_Get_Vendor_Reimburse @Vendor,@Item,@RTVType,'',  @PARTAMOUNT OUTPUT,@LABORAMOUNT OUTPUT, @TRAVELAMOUNT OUTPUT,@MISCAMOUNT OUTPUT  update SVC05601 with (rowlock) set VENDORID = @Vendor, VNDITNUM = isnull(@VendorItem,@Item), ADRSCODE = @AddressCode,   Ship_Address_1 = isnull(@address1,''), Ship_Address_2 = isnull(@address2,''), Ship_Address_3 = isnull(@address3,''),  Ship_Address_Name = isnull(@ShipAddressName,''),  Ship_City = isnull(@city,''),   Ship_State = isnull(@state,''), ZIPCODE = isnull(@zip,''), Ship_Country = isnull(@Country,''),  Part_Price = @PARTAMOUNT, Labor_Price = @LABORAMOUNT, Expense_Price =@MISCAMOUNT, Travel_Price = @TRAVELAMOUNT  where RTV_Number = @RTV  fetch next from RTVLine into  @RTVLine, @Item, @RTVType  End  deallocate RTVLine   return    
GO
GRANT EXECUTE ON  [dbo].[SVC_RTV_Update_Line_Vendor] TO [DYNGRP]
GO
