SET QUOTED_IDENTIFIER OFF
GO
SET ANSI_NULLS ON
GO
 CREATE Procedure [dbo].[SVC_Find_XFR_For_Grouping] ( @FromLocation char(11), @ToLocation char(11), @IntransitLocation char(11), @ServiceCallNumber char(11), @ServiceCallLineItemSequence integer, @ServiceCallEquipmentLine integer, @FromTA tinyint, @TransferNumber char(15) output, @Found tinyint output ) As declare @AddressOption smallint declare @MiscAddressCode char(15) declare @CustomerName char(65) declare @SiteID char(10) declare @AddressCode char(15) declare @ServiceAddressOption smallint declare @ServiceMiscAddressCode char(15) declare @ServiceCustomerNumber char(15) declare @ServiceAddressCode char(15) declare @DocNumber char(15)  if exists(select 1 from SVC00997 where SVC_Module='CL' and SVC_Form_Name = 'SVC_Service_Entry' and  SVC_Window_Name = 'SVC_Service_Entry' and SVC_Option = 'Consolidat' and SVC_Doc_Type = 2 and SVC_Option_Enabled = 1)  and  exists(select 1 from SVC00701 where CALLNBR = @ServiceCallNumber and STATUS < 2)  begin  select @Found = 1, @TransferNumber = ORDDOCID from SVC00701 where CALLNBR = @ServiceCallNumber and STATUS < 2  return  end  select @ServiceAddressOption = SVC_Address_Option,  @ServiceMiscAddressCode = rtrim(SVC_Misc_Address_Code),  @SiteID = rtrim(LOCNCODE) from SVC00203   where SRVRECTYPE=2 and   CALLNBR=@ServiceCallNumber and   EQPLINE=@ServiceCallEquipmentLine and   LINITMTYP='P' and  LNITMSEQ=@ServiceCallLineItemSequence  if @ServiceAddressOption = 3  select @CustomerName =  rtrim(NAME) from SVC00980 where SVC_Misc_Address_Code = @ServiceMiscAddressCode else  begin   if @ServiceAddressOption = 2   select @CustomerName = rtrim(LOCNDSCR) from IV40700 where LOCNCODE = @SiteID  else  select @CustomerName = rtrim(CUSTNAME), @ServiceAddressCode=rtrim(ADRSCODE)  from SVC00200  where SVC00200.SRVRECTYPE=2 and   SVC00200.CALLNBR = @ServiceCallNumber  end select @DocNumber = ORDDOCID  from SVC00700 where TRNSFLOC = @FromLocation  and ITLOCN = @IntransitLocation  and LOCNCODE = @ToLocation  and SVC_Address_Option = @ServiceAddressOption  and SVC_Misc_Address_Code = @ServiceMiscAddressCode  and CUSTNAME = @CustomerName and STATUS < 2   if @DocNumber > ''  select @Found = 1, @TransferNumber = @DocNumber else  select @Found = 0, @TransferNumber = ''  return (0)    
GO
GRANT EXECUTE ON  [dbo].[SVC_Find_XFR_For_Grouping] TO [DYNGRP]
GO
