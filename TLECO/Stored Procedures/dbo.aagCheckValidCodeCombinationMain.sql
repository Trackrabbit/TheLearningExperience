SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO
 CREATE PROCEDURE [dbo].[aagCheckValidCodeCombinationMain]  @I_cTable1  nvarchar(30) = NULL,   @O_nTrxDim char(15) = NULL OUTPUT,   @O_nTrxDimCode char(30) = NULL OUTPUT,  @O_nRelTrxDim char(15) = NULL OUTPUT,   @O_nRelTrxDimCode char(30) = NULL OUTPUT,  @IO_fValidCodeComb TINYINT = 1 OUTPUT AS  SET @IO_fValidCodeComb = 1  BEGIN  DECLARE  @nTrxDimID INT,   @nTrxDimCodeID INT,  @nRelTrxDimID INT,   @nRelTrxDimCodeID INT  EXECUTE ('DECLARE aaCodes_Cursor1 cursor fast_forward FOR  SELECT aaTrxDimID, aaTrxCodeID FROM ' + @I_cTable1)  OPEN aaCodes_Cursor1  FETCH NEXT FROM aaCodes_Cursor1 INTO @nTrxDimID,@nTrxDimCodeID  WHILE @@FETCH_STATUS = 0  BEGIN  EXECUTE ('DECLARE aaCodes_Cursor2 cursor fast_forward FOR  SELECT aaTrxDimID, aaTrxCodeID FROM ' + @I_cTable1)  OPEN aaCodes_Cursor2  FETCH NEXT FROM aaCodes_Cursor2 INTO @nRelTrxDimID,@nRelTrxDimCodeID  WHILE @@FETCH_STATUS = 0   BEGIN  IF @nTrxDimID <> @nRelTrxDimID   AND @nTrxDimID <> 0 AND @nTrxDimCodeID <> 0  AND @nRelTrxDimID <> 0 AND @nRelTrxDimCodeID <> 0  BEGIN  EXEC aagCheckValidCodeCombination  @nTrxDimID,   @nTrxDimCodeID,  @nRelTrxDimID,   @nRelTrxDimCodeID,  @IO_fValidCodeComb OUTPUT  IF @IO_fValidCodeComb = 0  BEGIN  SELECT @O_nTrxDim =  aaTrxDim FROM AAG00400 WHERE aaTrxDimID = @nTrxDimID   SELECT @O_nTrxDimCode = aaTrxDimCode FROM AAG00401 WHERE aaTrxDimID = @nTrxDimID AND aaTrxDimCodeID = @nTrxDimCodeID  SELECT @O_nRelTrxDim = aaTrxDim FROM AAG00400 WHERE aaTrxDimID = @nRelTrxDimID   SELECT @O_nRelTrxDimCode = aaTrxDimCode FROM AAG00401 WHERE aaTrxDimID = @nRelTrxDimID AND aaTrxDimCodeID = @nRelTrxDimCodeID   CLOSE aaCodes_Cursor1  DEALLOCATE aaCodes_Cursor1  CLOSE aaCodes_Cursor2  DEALLOCATE aaCodes_Cursor2  RETURN(0)  BREAK  END  END  FETCH NEXT FROM aaCodes_Cursor1 INTO @nRelTrxDimID,@nRelTrxDimCodeID  END  CLOSE aaCodes_Cursor2  DEALLOCATE aaCodes_Cursor2  FETCH NEXT FROM aaCodes_Cursor1 INTO @nTrxDimID,@nTrxDimCodeID  END  SELECT @O_nTrxDim =  aaTrxDim FROM AAG00400 WHERE aaTrxDimID = @nTrxDimID   SELECT @O_nTrxDimCode = aaTrxDimCode FROM AAG00401 WHERE aaTrxDimID = @nTrxDimID AND aaTrxDimCodeID = @nTrxDimCodeID  SELECT @O_nRelTrxDim = aaTrxDim FROM AAG00400 WHERE aaTrxDimID = @nRelTrxDimID   SELECT @O_nRelTrxDimCode = aaTrxDimCode FROM AAG00401 WHERE aaTrxDimID = @nRelTrxDimID AND aaTrxDimCodeID = @nRelTrxDimCodeID  CLOSE aaCodes_Cursor1  DEALLOCATE aaCodes_Cursor1  RETURN(0) END    
GO
GRANT EXECUTE ON  [dbo].[aagCheckValidCodeCombinationMain] TO [DYNGRP]
GO
