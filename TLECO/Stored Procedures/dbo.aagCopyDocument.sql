SET QUOTED_IDENTIFIER OFF
GO
SET ANSI_NULLS ON
GO
 CREATE  procedure [dbo].[aagCopyDocument]  @iHdrID int,  @iDocNumPrimary varchar(30),  @iDocNumPosting varchar(30),  @iCompanyID smallint = NULL,  @iSQL_Session_ID int = NULL,  @oNewHdrID int out,  @oStatus int out as  begin  declare @NoteIndex int,  @nStatus smallint  if @iCompanyID = NULL or @iSQL_Session_ID = NULL  if (@iHdrID is null) or (@iDocNumPrimary is null) or (@iDocNumPosting is null)   begin select @oStatus = 35000 return end   if (@iHdrID = 0) or (@iDocNumPrimary = '') or (@iDocNumPosting = '')   begin select @oStatus = 35001 return end  exec DYNAMICS.dbo.aagGetNextID 20000, @iCompanyID, @oNewHdrID out  exec DYNAMICS.dbo.smGetNextNoteIndex @iCompanyID, @iSQL_Session_ID, @NoteIndex out   insert into AAG20000 (aaSubLedgerHdrID, SERIES, DOCTYPE, DOCNUMBR)  select @oNewHdrID, SERIES, DOCTYPE, @iDocNumPosting from AAG20000  where aaSubLedgerHdrID = @iHdrID   insert into AAG20001 ([aaSubLedgerHdrID], [aaSubLedgerDistID], [INTERID], [CorrespondingUnit], [ACTINDX], [DISTTYPE], [ACCTTYPE], [aaBrowseType],   [DECPLACS], [DEBITAMT], [CRDTAMNT], [ORDBTAMT], [ORCRDAMT], [CURNCYID], [CURRNIDX], [RATETPID], [EXGTBLID], [XCHGRATE], [EXCHDATE], [TIME1],   [RTCLCMTD], [DENXRATE], [MCTRXSTT], [SEQNUMBR], [GLPOSTDT], [aaCustID], [aaVendID], [aaSiteID], [aaItemID], [aaCopyStatus], [aaWinWasOpen],   [POSTED], [HISTORY], [aaDistErrors], [APTVCHNM], [APTODCTY], [aaFutureDist], [aaOffsetAcct], [ITEMNMBR], [TRXLOCTN], [TRNSTLOC], [BINNMBR], [TRXQTY],  [aaChangeDate],[aaChangeTime])  select @oNewHdrID, [aaSubLedgerDistID], [INTERID], [CorrespondingUnit], [ACTINDX], [DISTTYPE], [ACCTTYPE], [aaBrowseType], [DECPLACS], [DEBITAMT],   [CRDTAMNT], [ORDBTAMT], [ORCRDAMT], [CURNCYID], [CURRNIDX], [RATETPID], [EXGTBLID], [XCHGRATE], [EXCHDATE], [TIME1], [RTCLCMTD], [DENXRATE],   [MCTRXSTT], [SEQNUMBR], [GLPOSTDT], [aaCustID], [aaVendID], [aaSiteID], [aaItemID], [aaCopyStatus], [aaWinWasOpen], [POSTED], [HISTORY],   [aaDistErrors], [APTVCHNM], [APTODCTY], [aaFutureDist], [aaOffsetAcct], [ITEMNMBR], [TRXLOCTN], [TRNSTLOC], [BINNMBR], [TRXQTY],convert(char(12), getdate(), 102),  convert(char(12), getdate(), 108)  from AAG20001  where aaSubLedgerHdrID = @iHdrID   insert into AAG20002 ([aaSubLedgerHdrID], [aaSubLedgerDistID], [aaSubLedgerAssignID], [DEBITAMT], [CRDTAMNT], [ORDBTAMT], [ORCRDAMT], [aaAssignedPercent], [DistRef], [NOTEINDX], [aaAssignErrors], [aaAliasID])  select @oNewHdrID, [aaSubLedgerDistID], [aaSubLedgerAssignID], [DEBITAMT], [CRDTAMNT], [ORDBTAMT], [ORCRDAMT], [aaAssignedPercent], [DistRef], @NoteIndex, [aaAssignErrors], [aaAliasID]  from AAG20002  where aaSubLedgerHdrID = @iHdrID   insert into AAG20003 ([aaSubLedgerHdrID], [aaSubLedgerDistID], [aaSubLedgerAssignID], [aaTrxDimID], [aaTrxCodeID], [aaCodeErrors])  select @oNewHdrID, [aaSubLedgerDistID], [aaSubLedgerAssignID], [aaTrxDimID], [aaTrxCodeID], [aaCodeErrors]  from AAG20003  where aaSubLedgerHdrID = @iHdrID end     
GO
GRANT EXECUTE ON  [dbo].[aagCopyDocument] TO [DYNGRP]
GO
