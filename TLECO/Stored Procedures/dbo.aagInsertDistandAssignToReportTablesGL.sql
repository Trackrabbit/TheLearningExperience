SET QUOTED_IDENTIFIER OFF
GO
SET ANSI_NULLS ON
GO
 create        procedure [dbo].[aagInsertDistandAssignToReportTablesGL]  @cUserID  char(37),  @cTrxBatchSrc char(73),  @iSeries int,  @iHdrID  int,  @iOnlyUnposted  tinyint = 0 as SELECT @cTrxBatchSrc = replace(@cTrxBatchSrc,'''','''''')  exec('delete from AAG70001 where USERID = ''' + @cUserID + ''' and TRXBTCHSRC = ''' + @cTrxBatchSrc + ''' and SERIES = ''' +@iSeries + ''' and aaGLHdrID = ' + @iHdrID) exec('delete from AAG70002 where USERID = ''' + @cUserID + ''' and TRXBTCHSRC = ''' + @cTrxBatchSrc + ''' and aaGLHdrID = ' + @iHdrID)  begin if @iOnlyUnposted = 1  begin   insert into AAG70001(aaGLHdrID,aaGLDistID, ACTINDX,  DEBITAMT, CRDTAMNT, ORDBTAMT, ORCRDAMT, CURNCYID, CURRNIDX)  select aaGLHdrID,aaGLDistID, ACTINDX,  DEBITAMT, CRDTAMNT, ORDBTAMT, ORCRDAMT, CURNCYID, CURRNIDX  from AAG30001 where aaGLHdrID = @iHdrID  end  else  begin  insert into AAG70001(aaGLHdrID,aaGLDistID, ACTINDX,  DEBITAMT, CRDTAMNT, ORDBTAMT, ORCRDAMT, CURNCYID, CURRNIDX)  select aaGLHdrID,aaGLDistID, ACTINDX,  DEBITAMT, CRDTAMNT, ORDBTAMT, ORCRDAMT, CURNCYID, CURRNIDX  from AAG30001 where aaGLHdrID = @iHdrID  end end exec('update AAG70001 set USERID = ''' + @cUserID + ''', TRXBTCHSRC = ''' + @cTrxBatchSrc + ''', SERIES = ''' +@iSeries + ''' where aaGLHdrID = ' + @iHdrID)  begin if @iOnlyUnposted = 1  begin   insert into AAG70002(aaGLHdrID,aaGLDistID,aaGLAssignID,  DEBITAMT, CRDTAMNT, ORDBTAMT, ORCRDAMT, DistRef)  select aaGLHdrID,aaGLDistID,aaGLAssignID,  DEBITAMT, CRDTAMNT, ORDBTAMT, ORCRDAMT,  DistRef  from AAG30002 where aaGLHdrID = @iHdrID  end else  begin  insert into AAG70002(aaGLHdrID,aaGLDistID,aaGLAssignID,  DEBITAMT, CRDTAMNT, ORDBTAMT, ORCRDAMT, DistRef)  select aaGLHdrID,aaGLDistID,aaGLAssignID,  DEBITAMT, CRDTAMNT, ORDBTAMT, ORCRDAMT, DistRef  from AAG30002 where aaGLHdrID = @iHdrID  end end exec('update AAG70002 set USERID = ''' + @cUserID + ''', TRXBTCHSRC = ''' + @cTrxBatchSrc + ''' where aaGLHdrID = ' + @iHdrID)    
GO
GRANT EXECUTE ON  [dbo].[aagInsertDistandAssignToReportTablesGL] TO [DYNGRP]
GO
