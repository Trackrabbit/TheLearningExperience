SET QUOTED_IDENTIFIER OFF
GO
SET ANSI_NULLS ON
GO
 CREATE PROCEDURE [dbo].[wfRecall]  @WorkflowInstanceID char(37),  @WorkflowStepInstanceID char(37),  @Workflow_User char(85),  @Workflow_Comments char(2000),  @Workflow_Error int OUTPUT AS  BEGIN   declare @Workflow_Step_Name char(51), @Workflow_Name char(51)  declare @CMPANYID smallint, @server_name nvarchar(128), @SystemDB nvarchar(6)  declare @Workflow_Due_Date datetime, @Workflow_Due_Time datetime,  @Workflow_Completion_Date datetime, @Workflow_Completion_Time datetime  declare @Workflow_Version int  declare @Workflow_Step_Assign_To char(37)  declare @domain nvarchar(64), @alias nvarchar(20), @charindex tinyint  select @WorkflowInstanceID=UPPER(@WorkflowInstanceID)   select @WorkflowStepInstanceID=UPPER(newid())  select @Workflow_User=UPPER(@Workflow_User)  select @Workflow_Step_Name='Recall Workflow'   select @Workflow_Name=Workflow_Name, @Workflow_Version=Workflow_Version   from WFI10002 where WorkflowInstanceID=@WorkflowInstanceID  update WFI10002 set Workflow_Status=5  where WorkflowInstanceID=@WorkflowInstanceID   update WFI10003 set Workflow_Step_Status=5    where Workflow_Step_Status=2 and WorkflowInstanceID=@WorkflowInstanceID   delete from WFI10004 where WorkflowInstanceID=@WorkflowInstanceID and Workflow_Action_Date=''   exec wfUpdateDocument @WorkflowInstanceID,1,5,'','',@Workflow_Error OUTPUT   select @Workflow_Due_Date=cast(SYSDATETIME() as date),@Workflow_Due_Time=cast(SYSDATETIME() as time)  select @Workflow_Completion_Date=@Workflow_Due_Date, @Workflow_Completion_Time=@Workflow_Due_Time   insert into WFI10003  select @WorkflowStepInstanceID,@Workflow_Step_Name,@WorkflowInstanceID,Workflow_Name,Workflow_Version,  @Workflow_Step_Name,5,99999,1,0,  0,'','',  '','',0,8,  1,0,1,  0,SYSDATETIME() from WF100002   where Workflow_Name=@Workflow_Name and Workflow_Version=@Workflow_Version   exec wfCreateHistoryRecord @WorkflowInstanceID,  @WorkflowStepInstanceID,  @Workflow_User,  @Workflow_Name,  @Workflow_Step_Name,  '',  7,  @Workflow_Due_Date,  @Workflow_Due_Time,  @Workflow_Completion_Date,  @Workflow_Completion_Time,  @Workflow_Comments,  @Workflow_Error OUTPUT  END   
GO
GRANT EXECUTE ON  [dbo].[wfRecall] TO [DYNGRP]
GO
