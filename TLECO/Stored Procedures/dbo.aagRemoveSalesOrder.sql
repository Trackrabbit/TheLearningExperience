SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO
 CREATE PROCEDURE [dbo].[aagRemoveSalesOrder]  @CompanyID SMALLINT,  @SqlSessionID INT,  @aaSubLedgerHdrID INT OUTPUT,  @l_ErrorCode SMALLINT = NULL OUTPUT AS  BEGIN   DECLARE   @SEQNUMBR INT,  @aaSubLedgerDistID INTEGER,  @NOTEINDX NUMERIC(19,5)  IF @aaSubLedgerHdrID = 0 or @aaSubLedgerHdrID = NULL  RETURN   SELECT @aaSubLedgerDistID = 3, @SEQNUMBR = 0  SELECT @SEQNUMBR = MAX([SEQNUMBR]) + 16384 FROM AAG20001 WHERE aaSubLedgerHdrID = @aaSubLedgerHdrID   While @aaSubLedgerDistID <= 4  BEGIN   EXEC DYNAMICS.dbo.smGetNextNoteIndex @CompanyID, @SqlSessionID, @NOTEINDX output   INSERT INTO AAG20001([aaSubLedgerHdrID],[aaSubLedgerDistID]   ,[INTERID] ,[CorrespondingUnit],[ACTINDX],[DISTTYPE],[ACCTTYPE] ,[aaBrowseType]   ,[DECPLACS],[DEBITAMT],[ORDBTAMT],[CRDTAMNT],[ORCRDAMT],[CURNCYID]   ,[CURRNIDX],[RATETPID],[EXGTBLID],[XCHGRATE],[EXCHDATE],[TIME1]   ,[RTCLCMTD],[DENXRATE],[MCTRXSTT],[SEQNUMBR],[GLPOSTDT],[aaCustID]   ,[aaVendID],[aaSiteID],[aaItemID],[aaCopyStatus],[aaWinWasOpen],[POSTED]   ,[HISTORY],[aaDistErrors],[APTVCHNM],[APTODCTY],[aaFutureDist],[aaOffsetAcct]   ,[ITEMNMBR],[TRXLOCTN],[BINNMBR],[TRNSTLOC],[TRXQTY] ,[aaChangeDate] ,[aaChangeTime])   SELECT @aaSubLedgerHdrID, @aaSubLedgerDistID   ,[INTERID] ,[CorrespondingUnit],[ACTINDX],[DISTTYPE],[ACCTTYPE] ,[aaBrowseType]   ,[DECPLACS],[CRDTAMNT],[ORCRDAMT],[DEBITAMT],[ORDBTAMT],[CURNCYID]   ,[CURRNIDX],[RATETPID],[EXGTBLID],[XCHGRATE],[EXCHDATE],[TIME1]   ,[RTCLCMTD],[DENXRATE],[MCTRXSTT],@SEQNUMBR,[GLPOSTDT],[aaCustID]   ,[aaVendID],[aaSiteID],[aaItemID],[aaCopyStatus],[aaWinWasOpen],[POSTED]   ,[HISTORY],[aaDistErrors],[APTVCHNM],[APTODCTY],[aaFutureDist],[aaOffsetAcct]   ,[ITEMNMBR],[TRXLOCTN],[BINNMBR],[TRNSTLOC],[TRXQTY] ,[aaChangeDate] ,[aaChangeTime]   FROM AAG20001 WHERE[aaSubLedgerHdrID] = @aaSubLedgerHdrID AND [aaSubLedgerDistID] = @aaSubLedgerDistID - 2   INSERT INTO AAG20002 ([aaSubLedgerHdrID], [aaSubLedgerDistID], [aaSubLedgerAssignID], [DEBITAMT], [ORDBTAMT],   [CRDTAMNT], [ORCRDAMT], [aaAssignedPercent], [NOTEINDX], [aaAliasID])  SELECT @aaSubLedgerHdrID, @aaSubLedgerDistID, [aaSubLedgerAssignID], [CRDTAMNT], [ORCRDAMT],   [DEBITAMT], [ORDBTAMT], [aaAssignedPercent], @NOTEINDX, [aaAliasID]  FROM AAG20002 WHERE[aaSubLedgerHdrID] = @aaSubLedgerHdrID AND [aaSubLedgerDistID] = @aaSubLedgerDistID - 2   INSERT INTO [dbo].[AAG20003] ([aaSubLedgerHdrID],[aaSubLedgerDistID],[aaSubLedgerAssignID],   [aaTrxDimID],[aaTrxCodeID],[aaCodeErrors])   SELECT @aaSubLedgerHdrID, @aaSubLedgerDistID, [aaSubLedgerAssignID],   [aaTrxDimID],[aaTrxCodeID],[aaCodeErrors]  FROM AAG20003 WHERE[aaSubLedgerHdrID] = @aaSubLedgerHdrID AND [aaSubLedgerDistID] = @aaSubLedgerDistID - 2   SET @aaSubLedgerDistID = @aaSubLedgerDistID + 1  SET @SEQNUMBR = @SEQNUMBR + 16384  END  END    
GO
GRANT EXECUTE ON  [dbo].[aagRemoveSalesOrder] TO [DYNGRP]
GO
