SET QUOTED_IDENTIFIER OFF
GO
SET ANSI_NULLS ON
GO
 CREATE PROCEDURE [dbo].[seeYTDCommissionsByState_Create] @iLanguageID int   as   set nocount on   declare @sqldropstring varchar(400),   @sqlstring1 varchar(8000),   @sqlstring2 varchar(8000),   @sqlstring3 varchar(8000),   @sqlstring4 varchar(8000),   @sqlstring5 varchar(8000),   @sqlstring6 varchar(8000),   @sqlstring7 varchar(8000),   @sqlstring8 varchar(8000),   @sqlstring9 varchar(8000),   @sqlstring10 varchar(8000),   @sqljoinstring varchar(8000),   @sqlaccessstring varchar(2000),   @tNumberSegments int,   @tSegment int,   @I_iDictID int,   @I_iLangID int,   @I_iMessageNumber int,   @I_iAliasMessageNumber int,   @I_iIntegerValue int,  @Salesperson_ID varchar(255), @SalespersonID_For_DrillBack varchar(255)  select @I_iDictID = 1493 select @I_iMessageNumber = 23443 select @I_iAliasMessageNumber = 0 exec DYNAMICS..smGetBIMsgStringForProcs  @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @Salesperson_ID output   select @I_iDictID = 1493 select @I_iMessageNumber = 23443 select @I_iAliasMessageNumber = 22214 exec DYNAMICS..smGetBIMsgStringForProcs  @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @SalespersonID_For_DrillBack output    select @sqldropstring =   'IF EXISTS (SELECT * FROM   sys.objects WHERE  object_id = OBJECT_ID(N''[dbo].[seeYTDCommissionsByState]'') AND type in ( N''P'', N''PC'' ))  ' +   '  DROP PROCEDURE [dbo].[seeYTDCommissionsByState]  '   select @sqlstring1 =   'CREATE PROCEDURE dbo.seeYTDCommissionsByState @STATE  varchar(5) '+   'as  '+   'select  '+   '     RM00301.SLPRSNID, '+   '     RM00301.SLPRSNFN, '+   '     RM00301.SPRSNSMN, '+   '     RM00301.SPRSNSLN, '+   '     case when rtrim(SLPRSNFN) = '''' and rtrim(SPRSNSMN) = ''''  and  rtrim(SPRSNSLN) = '''' '+   '   then rtrim(SLPRSNID) '+   '   else  '+   '    case  '+   '     when rtrim(SPRSNSMN) = '''' '+   '     then rtrim(SLPRSNFN) + '' '' + rtrim(SPRSNSLN) '+   '     else rtrim(SLPRSNFN) + '' '' + rtrim(SPRSNSMN) + '' '' + rtrim(SPRSNSLN) '+   '    end '+   ' end as SLSPRSNFULLNAME, '+   '     RM00301.CITY, '+   '     RM00301.STATE, '+   '     RM00301.COUNTRY, '+   '     RM00301.SALSTERR, '+   '     RM00301.TTLCOMTD, '+   '     ReceivablesTransactions.['+@SalespersonID_For_DrillBack+'] '+   '     from RM00301 '+   '     join (select distinct(['+@SalespersonID_For_DrillBack+']), ['+@Salesperson_ID+'] from ReceivablesTransactions ) ReceivablesTransactions on RM00301.SLPRSNID = ReceivablesTransactions.['+@Salesperson_ID+'] '+   ' where RM00301.STATE = @STATE '   select @sqlaccessstring =   'GRANT execute ON [dbo].[seeYTDCommissionsByState] TO [rpt_executive],[rpt_power user],[rpt_sales manager] '   exec (@sqldropstring)   exec (@sqlstring1+' '+@sqlstring2+' '+@sqlstring3+' '+@sqlstring4+' '+@sqlstring5+' '+@sqlstring6+' '+@sqlstring7+' '+@sqlstring8+' '+@sqlstring9+' '+@sqlstring10)   exec (@sqlaccessstring)   set nocount off    
GO
GRANT EXECUTE ON  [dbo].[seeYTDCommissionsByState_Create] TO [DYNGRP]
GO
