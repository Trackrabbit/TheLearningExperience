SET QUOTED_IDENTIFIER OFF
GO
SET ANSI_NULLS ON
GO
create procedure [dbo].[popRequisitionLookupBuildList]  @I_vTableName varchar(25) = NULL,  @I_vInclude smallint = NULL,  @I_vUserID varchar(15) = NULL,  @I_vDomainUserName varchar(255) = NULL,   @O_iErrorState           int       = NULL output  as  declare @iError int,  @iStatus int,   @iByUserOpen smallint,  @iByUserHist smallint  select @iError = 0,  @iStatus = 0,  @iByUserOpen = 4,  @iByUserHist = 5  select @O_iErrorState   = 0  if( @I_vTableName is NULL or  @I_vInclude is NULL or  @I_vUserID is NULL or  @I_vDomainUserName is NULL ) begin  select          @O_iErrorState = 21022  return end  if exists(select * from DYNAMICS..SY01400 where USERID = @I_vUserID )  BEGIN  IF @I_vInclude = @iByUserOpen  BEGIN    exec  ('insert ' + @I_vTableName   + ' (POPRequisitionNumber, Requisition_Note_Index, RequisitionDescription, RequisitionStatus, COMMNTID, Comment_Note_Index, DOCDATE, REQDATE, REQSTDBY, PRSTADCD, CMPNYNAM, '  + ' CONTACT, ADDRESS1, ADDRESS2, ADDRESS3, CITY, STATE, ZIPCODE, CCode, COUNTRY, PHONE1, PHONE2, PHONE3, FAX, DOCAMNT, CREATDDT, MODIFDT, USER2ENT, '  + ' Flags, Workflow_Status, DomainUserName, USERDEF1, USERDEF2)'  + ' select POPRequisitionNumber, Requisition_Note_Index, RequisitionDescription, RequisitionStatus, COMMNTID, Comment_Note_Index, DOCDATE, REQDATE, REQSTDBY, PRSTADCD, CMPNYNAM, '  + ' CONTACT, ADDRESS1, ADDRESS2, ADDRESS3, CITY, STATE, ZIPCODE, CCode, COUNTRY, PHONE1, PHONE2, PHONE3, FAX, DOCAMNT, CREATDDT, MODIFDT, USER2ENT, '  + ' Flags, Workflow_Status, DomainUserName, USERDEF1, USERDEF2'  + ' from POP10200 P where REQSTDBY = ''' +  @I_vUserID  + ''' '  + '  or (not exists(select (1) from DYNAMICS..SY01400 U where U.USERID = P.REQSTDBY) and P.DomainUserName = ''' + @I_vDomainUserName + ''' )')   END  ELSE  BEGIN   exec  ('insert ' + @I_vTableName   + ' (POPRequisitionNumber, Requisition_Note_Index, RequisitionDescription, RequisitionStatus, COMMNTID, Comment_Note_Index, DOCDATE, REQDATE, REQSTDBY, PRSTADCD, CMPNYNAM, '  + ' CONTACT, ADDRESS1, ADDRESS2, ADDRESS3, CITY, STATE, ZIPCODE, CCode, COUNTRY, PHONE1, PHONE2, PHONE3, FAX, DOCAMNT, CREATDDT, MODIFDT, USER2ENT, '  + ' Flags, Workflow_Status, DomainUserName, USERDEF1, USERDEF2)'  + ' select POPRequisitionNumber, Requisition_Note_Index, RequisitionDescription, RequisitionStatus, COMMNTID, Comment_Note_Index, DOCDATE, REQDATE, REQSTDBY, PRSTADCD, CMPNYNAM, '  + ' CONTACT, ADDRESS1, ADDRESS2, ADDRESS3, CITY, STATE, ZIPCODE, CCode, COUNTRY, PHONE1, PHONE2, PHONE3, FAX, DOCAMNT, CREATDDT, MODIFDT, USER2ENT, '  + ' Flags, Workflow_Status, DomainUserName, USERDEF1, USERDEF2'  + ' from POP30200 P where REQSTDBY = ''' +  @I_vUserID  + ''' '  + '  or (not exists(select (1) from DYNAMICS..SY01400 U where U.USERID = P.REQSTDBY) and P.DomainUserName = ''' + @I_vDomainUserName + ''' )')   END  END ELSE     BEGIN  IF @I_vInclude = @iByUserOpen  BEGIN    exec  ('insert ' + @I_vTableName   + ' (POPRequisitionNumber, Requisition_Note_Index, RequisitionDescription, RequisitionStatus, COMMNTID, Comment_Note_Index, DOCDATE, REQDATE, REQSTDBY, PRSTADCD, CMPNYNAM, '  + ' CONTACT, ADDRESS1, ADDRESS2, ADDRESS3, CITY, STATE, ZIPCODE, CCode, COUNTRY, PHONE1, PHONE2, PHONE3, FAX, DOCAMNT, CREATDDT, MODIFDT, USER2ENT, '  + ' Flags, Workflow_Status, DomainUserName, USERDEF1, USERDEF2)'  + ' select POPRequisitionNumber, Requisition_Note_Index, RequisitionDescription, RequisitionStatus, COMMNTID, Comment_Note_Index, DOCDATE, REQDATE, REQSTDBY, PRSTADCD, CMPNYNAM, '  + ' CONTACT, ADDRESS1, ADDRESS2, ADDRESS3, CITY, STATE, ZIPCODE, CCode, COUNTRY, PHONE1, PHONE2, PHONE3, FAX, DOCAMNT, CREATDDT, MODIFDT, USER2ENT, '  + ' Flags, Workflow_Status, Workflow_Priority, DomainUserName, USERDEF1, USERDEF2'  + ' from POP10200 where DomainUserName = ''' +  @I_vDomainUserName  + ''' ')    END  ELSE  BEGIN   exec  ('insert ' + @I_vTableName   + ' (POPRequisitionNumber, Requisition_Note_Index, RequisitionDescription, RequisitionStatus, COMMNTID, Comment_Note_Index, DOCDATE, REQDATE, REQSTDBY, PRSTADCD, CMPNYNAM, '  + ' CONTACT, ADDRESS1, ADDRESS2, ADDRESS3, CITY, STATE, ZIPCODE, CCode, COUNTRY, PHONE1, PHONE2, PHONE3, FAX, DOCAMNT, CREATDDT, MODIFDT, USER2ENT, '  + ' Flags, Workflow_Status, DomainUserName, USERDEF1, USERDEF2)'  + ' select POPRequisitionNumber, Requisition_Note_Index, RequisitionDescription, RequisitionStatus, COMMNTID, Comment_Note_Index, DOCDATE, REQDATE, REQSTDBY, PRSTADCD, CMPNYNAM, '  + ' CONTACT, ADDRESS1, ADDRESS2, ADDRESS3, CITY, STATE, ZIPCODE, CCode, COUNTRY, PHONE1, PHONE2, PHONE3, FAX, DOCAMNT, CREATDDT, MODIFDT, USER2ENT, '  + ' Flags, Workflow_Status, DomainUserName, USERDEF1, USERDEF2'  + ' from POP30200 where DomainUserName = ''' +  @I_vDomainUserName  + ''' ')    END  END  select @iError = @@error if @iStatus = 0 and @iError <> 0  select @iStatus = @iError  return(@iStatus)    
GO
GRANT EXECUTE ON  [dbo].[popRequisitionLookupBuildList] TO [DYNGRP]
GO
