SET QUOTED_IDENTIFIER OFF
GO
SET ANSI_NULLS ON
GO
 create procedure [dbo].[taCreateCustomerClass]  @I_vCLASSID char(15),    @I_vCLASDSCR char(30) = '',   @I_vCRLMTTYP smallint = 0,   @I_vCRLMTAMT numeric(19,5) = 0,  @I_vCRLMTPER smallint = 0,   @I_vCRLMTPAM numeric(19,5) = 0,  @I_vDEFLTCLS tinyint = 0,   @I_vBALNCTYP smallint = 0,   @I_vCHEKBKID char(15) = '',   @I_vTAXSCHID char(15) = '',   @I_vSHIPMTHD char(15) = '',   @I_vPYMTRMID char(20) = '',   @I_vCUSTDISC smallint = 0,   @I_vMINPYTYP smallint = 0,   @I_vMINPYDLR numeric(19,5) = 0,  @I_vMINPYPCT smallint = 0,   @I_vMXWOFTYP smallint = 0,   @I_vMXWROFAM numeric(19,5) = 0,  @I_vFNCHATYP smallint = 0,   @I_vFINCHDLR numeric(19,5) = 0,  @I_vFNCHPCNT smallint = 0,   @I_vPRCLEVEL char(10) = '',   @I_vCURNCYID char(15) = '',   @I_vRATETPID char(15) = '',   @I_vDEFCACTY smallint = 0,   @I_vCASHACCT char(75) = '',   @I_vACCTRECACCT char(75) = '',   @I_vSALESACCT char(75) = '',   @I_vCOSTOFSALESACCT char(75) = '',   @I_vIVACCT char(75) = '',   @I_vTERMDISCTAKENACCT char(75) = '',   @I_vTERMDISCAVAILACCT char(75) = '',   @I_vFINCHRGACCT char(75) = '',   @I_vWRITEOFFACCT char(75) = '',   @I_vSALESORDERRETACCT char(75) = '',   @I_vSALSTERR char(15) = '',   @I_vSLPRSNID char(15) = '',   @I_vSTMTCYCL smallint = 5,   @I_vKPCALHST tinyint = 1,   @I_vKPDSTHST tinyint = 1,   @I_vKPERHIST tinyint = 1,   @I_vKPTRXHST tinyint = 1,   @I_vDISGRPER smallint = 0,   @I_vDUEGRPER smallint = 0,   @I_vRevalue_Customer tinyint = 1,   @I_vPost_Results_To smallint = 0,   @I_vORDERFULFILLDEFAULT tinyint = 1,   @I_vCUSTPRIORITY smallint = 1,   @I_vRMOvrpymtWrtoffAcct char(75) = '',   @I_vRequesterTrx  smallint = 0,   @I_vUSRDEFND1 char(50) = '',       @I_vUSRDEFND2 char(50) = '',       @I_vUSRDEFND3 char(50) = '',       @I_vUSRDEFND4 varchar(8000) = '',  @I_vUSRDEFND5 varchar(8000) = '',  @O_iErrorState int output,   @oErrString   varchar(255) output   with encryption as  set transaction isolation level read uncommitted set nocount on  declare   @RMCSHACC int,     @RMARACC  int,                    @RMCOSACC int,               @RMIVACC  int,                    @RMSLSACC int,                    @RMAVACC  int,                    @RMTAKACC int,                    @RMFCGACC int,                    @RMWRACC  int,                    @RMSORACC int,     @RMOvrpymtWrtoffAcctIdx int,   @NOTEINDX numeric(19,5),  @CMPANYID smallint,  @iGetNextNoteIdxErrState int,  @iAddCodeErrState int,    @iStatus int,  @iCustomState int,  @iCustomErrString varchar(255),  @O_oErrorState int,  @iError int     select  @RMCSHACC = 0,     @RMARACC  = 0,                    @RMCOSACC = 0,               @RMIVACC  = 0,                    @RMSLSACC = 0,                    @RMAVACC  = 0,                    @RMTAKACC = 0,                    @RMFCGACC = 0,                    @RMWRACC  = 0,                    @RMSORACC = 0,     @RMOvrpymtWrtoffAcctIdx = 0,   @CMPANYID = 0,     @iStatus = 0,   @O_iErrorState = 0    if (@oErrString is NULL) begin  select @oErrString = '' end  exec @iStatus = taCreateCustomerClassPre  @I_vCLASSID output,  @I_vCLASDSCR output,  @I_vCRLMTTYP output,  @I_vCRLMTAMT output,  @I_vCRLMTPER output,  @I_vCRLMTPAM output,  @I_vDEFLTCLS output,  @I_vBALNCTYP output,  @I_vCHEKBKID output,  @I_vTAXSCHID output,  @I_vSHIPMTHD output,  @I_vPYMTRMID output,  @I_vCUSTDISC output,  @I_vMINPYTYP output,  @I_vMINPYDLR output,  @I_vMINPYPCT output,  @I_vMXWOFTYP output,  @I_vMXWROFAM output,  @I_vFNCHATYP output,  @I_vFINCHDLR output,  @I_vFNCHPCNT output,  @I_vPRCLEVEL output,  @I_vCURNCYID output,  @I_vRATETPID output,  @I_vDEFCACTY output,  @I_vCASHACCT output,  @I_vACCTRECACCT output,  @I_vSALESACCT output,  @I_vCOSTOFSALESACCT output,  @I_vIVACCT output,  @I_vTERMDISCTAKENACCT output,  @I_vTERMDISCAVAILACCT output,  @I_vFINCHRGACCT output,  @I_vWRITEOFFACCT output,  @I_vSALESORDERRETACCT output,  @I_vSALSTERR output,  @I_vSLPRSNID output,  @I_vSTMTCYCL output,  @I_vKPCALHST output,  @I_vKPDSTHST output,  @I_vKPERHIST output,  @I_vKPTRXHST output,  @I_vDISGRPER output,  @I_vDUEGRPER output,  @I_vRevalue_Customer output,  @I_vPost_Results_To output,  @I_vORDERFULFILLDEFAULT output,  @I_vCUSTPRIORITY output,  @I_vRMOvrpymtWrtoffAcct output,  @I_vRequesterTrx output,  @I_vUSRDEFND1 output,  @I_vUSRDEFND2 output,  @I_vUSRDEFND3 output,  @I_vUSRDEFND4 output,  @I_vUSRDEFND5 output,  @O_iErrorState = @iCustomState output,  @oErrString = @iCustomErrString output select @iError = @@error if @iStatus = 0 and @iError <> 0 begin  select @iStatus = @iError end if (@iStatus <> 0) or (@iCustomState <> 0) begin  select @oErrString = rtrim(@oErrString) + ' ' + ltrim(rtrim(@iCustomErrString))  select @O_iErrorState = 3271    exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output  return (@O_iErrorState) end  if ( @I_vCLASSID is NULL or  @I_vCLASDSCR is NULL or  @I_vCRLMTTYP is NULL or  @I_vCRLMTAMT is NULL or  @I_vCRLMTPER is NULL or  @I_vCRLMTPAM is NULL or  @I_vDEFLTCLS is NULL or  @I_vBALNCTYP is NULL or  @I_vCHEKBKID is NULL or  @I_vTAXSCHID is NULL or  @I_vSHIPMTHD is NULL or  @I_vPYMTRMID is NULL or  @I_vCUSTDISC is NULL or  @I_vMINPYTYP is NULL or  @I_vMINPYDLR is NULL or  @I_vMINPYPCT is NULL or  @I_vMXWOFTYP is NULL or  @I_vMXWROFAM is NULL or  @I_vFNCHATYP is NULL or  @I_vFINCHDLR is NULL or  @I_vFNCHPCNT is NULL or  @I_vPRCLEVEL is NULL or  @I_vCURNCYID is NULL or  @I_vRATETPID is NULL or  @I_vDEFCACTY is NULL or  @I_vCASHACCT is NULL or  @I_vACCTRECACCT is NULL or  @I_vSALESACCT is NULL or  @I_vCOSTOFSALESACCT is NULL or  @I_vIVACCT is NULL or  @I_vTERMDISCTAKENACCT is NULL or  @I_vTERMDISCAVAILACCT is NULL or  @I_vFINCHRGACCT is NULL or  @I_vWRITEOFFACCT is NULL or  @I_vSALESORDERRETACCT is NULL or  @I_vSALSTERR is NULL or  @I_vSLPRSNID is NULL or  @I_vSTMTCYCL is NULL or  @I_vKPCALHST is NULL or  @I_vKPDSTHST is NULL or  @I_vKPERHIST is NULL or  @I_vKPTRXHST is NULL or  @I_vDISGRPER is NULL or  @I_vDUEGRPER is NULL or  @I_vRevalue_Customer is NULL or  @I_vPost_Results_To is NULL or  @I_vORDERFULFILLDEFAULT is NULL or  @I_vCUSTPRIORITY is NULL or  @I_vRMOvrpymtWrtoffAcct is NULL or  @I_vRequesterTrx is NULL or  @I_vUSRDEFND1 is NULL or   @I_vUSRDEFND2 is NULL or   @I_vUSRDEFND3 is NULL or   @I_vUSRDEFND4 is NULL or  @I_vUSRDEFND5 is NULL) begin  select @O_iErrorState = 3272    exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output  return (@O_iErrorState) end  select  @I_vCLASSID = UPPER(@I_vCLASSID),  @I_vSLPRSNID = UPPER(@I_vSLPRSNID),  @I_vSALSTERR = UPPER(@I_vSALSTERR),  @I_vSHIPMTHD = UPPER(@I_vSHIPMTHD),  @I_vTAXSCHID = UPPER(@I_vTAXSCHID),  @I_vPRCLEVEL = UPPER(@I_vPRCLEVEL),  @I_vRATETPID = UPPER(@I_vRATETPID),  @I_vCURNCYID = UPPER(@I_vCURNCYID),  @I_vCHEKBKID = UPPER(@I_vCHEKBKID)  select @CMPANYID = CMPANYID from DYNAMICS..SY01500 (nolock) where INTERID = db_name()  exec @iStatus = DYNAMICS..tasmGetNextNoteIndex  @I_sCompanyID   = @CMPANYID,  @I_iSQLSessionID = 0,  @I_noteincrement  = 1,  @O_mNoteIndex   = @NOTEINDX output,  @O_iErrorState  = @iGetNextNoteIdxErrState output select @iError = @@error if @iStatus = 0 and @iError <> 0 begin  select @iStatus = @iError end if (@iStatus <> 0) or (@iGetNextNoteIdxErrState <> 0) begin  if (@iGetNextNoteIdxErrState <> 0)  begin  exec @iStatus = taUpdateString  @iGetNextNoteIdxErrState,  @oErrString,  @oErrString output,  @O_oErrorState output  end  select @O_iErrorState = 3273   exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output end  if (@I_vCLASSID = '') begin  select @O_iErrorState = 3274    exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @iAddCodeErrState output end  if (@I_vCRLMTAMT < 0) begin  select @O_iErrorState = 3275     exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @iAddCodeErrState output end  if (@I_vCRLMTPER < 0 or @I_vCRLMTPER > 2) begin  select @O_iErrorState = 3276     exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @iAddCodeErrState output end  if (@I_vCRLMTPAM < 0) begin  select @O_iErrorState = 3277     exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @iAddCodeErrState output end  if (@I_vDEFLTCLS < 0 or @I_vDEFLTCLS > 1) begin  select @O_iErrorState = 3278     exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @iAddCodeErrState output end  if (@I_vCRLMTTYP < 0 or @I_vCRLMTTYP > 2) begin  select @O_iErrorState = 3279     exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @iAddCodeErrState output end  if (@I_vBALNCTYP < 0 or @I_vBALNCTYP > 1) begin  select @O_iErrorState = 3280     exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @iAddCodeErrState output end  if (@I_vCHEKBKID <> '')  begin  if (not exists(select 1 from CM00100 (nolock) where CHEKBKID = @I_vCHEKBKID))  begin  select @O_iErrorState = 3281     exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output  end end  if (@I_vTAXSCHID <> '') begin  if (not exists(select 1 from TX00101 (nolock) where TAXSCHID = @I_vTAXSCHID))  begin  select @O_iErrorState = 3282     exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output  end end  if (@I_vSHIPMTHD <> '') begin  if (not exists(select 1 from SY03000 (nolock) where SHIPMTHD = @I_vSHIPMTHD))  begin  select @O_iErrorState = 3283     exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output  end end  if (@I_vPYMTRMID <> '') begin  if (not exists(select 1 from SY03300 (nolock) where PYMTRMID = @I_vPYMTRMID))  begin  select @O_iErrorState = 3284     exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output  end end  if (@I_vCUSTDISC < 0) begin  select @O_iErrorState = 3285     exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @iAddCodeErrState output end  if (@I_vMINPYTYP < 0 or @I_vMINPYTYP > 2)  begin  select @O_iErrorState = 3286     exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @iAddCodeErrState output end  if (@I_vMINPYDLR < 0) begin  select @O_iErrorState = 3287     exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @iAddCodeErrState output end  if (@I_vMINPYPCT < 0) begin  select @O_iErrorState = 3288     exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @iAddCodeErrState output end  if (@I_vMXWOFTYP < 0 or @I_vMXWOFTYP > 2) begin  select @O_iErrorState = 3289     exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @iAddCodeErrState output end  if (@I_vMXWROFAM < 0) begin  select @O_iErrorState = 3290     exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @iAddCodeErrState output end  if (@I_vFNCHATYP < 0 or @I_vFNCHATYP > 2)  begin  select @O_iErrorState = 3291     exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @iAddCodeErrState output end  if (@I_vFINCHDLR < 0)  begin  select @O_iErrorState = 3292     exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @iAddCodeErrState output end  if (@I_vFNCHPCNT < 0)  begin  select @O_iErrorState = 3293     exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @iAddCodeErrState output end  if (@I_vPRCLEVEL <> '') begin  if (not exists(select 1 from IV40800 (nolock) where PRCLEVEL = @I_vPRCLEVEL))  begin  select @O_iErrorState = 3294     exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output  end end  if (@I_vCURNCYID <> '') begin  if (not exists(select 1 from DYNAMICS..MC40200 (nolock) where CURNCYID = @I_vCURNCYID))  begin  select @O_iErrorState = 3295     exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output  end end  if (@I_vRATETPID <> '') begin  if (not exists(select 1 from MC40100 (nolock) where RATETPID = @I_vRATETPID))  begin  select @O_iErrorState = 3296     exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output  end end  if (@I_vDEFCACTY < 0 or @I_vDEFCACTY > 1) begin  select @O_iErrorState = 3297     exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @iAddCodeErrState output end  if (@I_vSALSTERR <> '')  begin  if (not exists(select 1 from RM00303 (nolock) where SALSTERR = @I_vSALSTERR))  begin  select @O_iErrorState = 3298     exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output  end end  if (@I_vSLPRSNID <> '') begin  if (not exists(select 1 from RM00301 (nolock) where SLPRSNID = @I_vSLPRSNID))  begin  select @O_iErrorState = 3299     exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output  end end  if (@I_vSTMTCYCL < 1 or @I_vSTMTCYCL > 7) begin  select @O_iErrorState = 3300     exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @iAddCodeErrState output end  if (@I_vKPCALHST < 0 or @I_vKPCALHST > 1) begin  select @O_iErrorState = 3302     exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @iAddCodeErrState output end  if (@I_vKPDSTHST < 0 or @I_vKPDSTHST > 1) begin  select @O_iErrorState = 3303     exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @iAddCodeErrState output end  if (@I_vKPERHIST < 0 or @I_vKPERHIST > 1) begin  select @O_iErrorState = 3304     exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @iAddCodeErrState output end  if (@I_vKPTRXHST < 0 or @I_vKPTRXHST > 1) begin  select @O_iErrorState = 3305     exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @iAddCodeErrState output end  if (@I_vDISGRPER < 0)  begin  select @O_iErrorState = 3306     exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @iAddCodeErrState output end  if (@I_vDUEGRPER < 0)  begin  select @O_iErrorState = 3307     exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @iAddCodeErrState output end  if (@I_vRevalue_Customer < 0 or @I_vRevalue_Customer > 1) begin  select @O_iErrorState = 3308     exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @iAddCodeErrState output end  if (@I_vPost_Results_To < 0 or @I_vPost_Results_To > 1) begin  select @O_iErrorState = 3309     exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @iAddCodeErrState output end  if (@I_vORDERFULFILLDEFAULT not in (1,2,3)) begin  select @O_iErrorState = 6326     exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @iAddCodeErrState output end  if (@I_vRevalue_Customer = 0 and @I_vPost_Results_To = 1) begin  select @O_iErrorState = 3310     exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @iAddCodeErrState output end  if (@I_vCUSTPRIORITY < 1 or @I_vCUSTPRIORITY > 100) begin  select @O_iErrorState = 6310     exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @iAddCodeErrState output end  if (@I_vRequesterTrx < 0 or @I_vRequesterTrx > 1) begin  select @O_iErrorState = 3713     exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @iAddCodeErrState output end  if (@I_vCASHACCT <> '') begin  select @RMCSHACC = ACTINDX from GL00105 (nolock) where ACTNUMST = @I_vCASHACCT  if (@RMCSHACC = 0)  begin  select @O_iErrorState = 3311      exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output  end end  if (@I_vACCTRECACCT <> '') begin  select @RMARACC = ACTINDX from GL00105 (nolock) where ACTNUMST = @I_vACCTRECACCT  if (@RMARACC = 0)  begin  select @O_iErrorState = 3312      exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output  end end  if (@I_vCOSTOFSALESACCT <> '') begin  select @RMCOSACC = ACTINDX from GL00105 (nolock) where ACTNUMST = @I_vCOSTOFSALESACCT  if (@RMCOSACC = 0)  begin  select @O_iErrorState = 3313      exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output  end end  if (@I_vIVACCT <> '') begin  select @RMIVACC = ACTINDX from GL00105 (nolock) where ACTNUMST = @I_vIVACCT  if (@RMIVACC = 0)  begin  select @O_iErrorState = 3314      exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output  end end  if (@I_vSALESACCT <> '') begin  select @RMSLSACC = ACTINDX from GL00105 (nolock) where ACTNUMST = @I_vSALESACCT  if (@RMSLSACC = 0)  begin  select @O_iErrorState = 3315      exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output  end end  if (@I_vTERMDISCAVAILACCT <> '') begin  select @RMAVACC = ACTINDX from GL00105 (nolock) where ACTNUMST = @I_vTERMDISCAVAILACCT  if (@RMAVACC = 0)  begin  select @O_iErrorState = 3316      exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output  end end  if (@I_vTERMDISCTAKENACCT <> '') begin  select @RMTAKACC = ACTINDX from GL00105 (nolock) where ACTNUMST = @I_vTERMDISCTAKENACCT  if (@RMTAKACC = 0)  begin  select @O_iErrorState = 3317      exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output  end end  if (@I_vFINCHRGACCT <> '') begin  select @RMFCGACC = ACTINDX from GL00105 (nolock) where ACTNUMST = @I_vFINCHRGACCT  if (@RMFCGACC = 0)  begin  select @O_iErrorState = 3318      exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output  end end  if (@I_vWRITEOFFACCT <> '') begin  select @RMWRACC = ACTINDX from GL00105 (nolock) where ACTNUMST = @I_vWRITEOFFACCT  if (@RMWRACC = 0)  begin  select @O_iErrorState = 3319      exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output  end end  if (@I_vSALESORDERRETACCT <> '') begin  select @RMSORACC = ACTINDX from GL00105 (nolock) where ACTNUMST = @I_vSALESORDERRETACCT  if (@RMSORACC = 0)  begin  select @O_iErrorState = 3320      exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output  end end  if (@I_vRMOvrpymtWrtoffAcct <> '') begin  select @RMOvrpymtWrtoffAcctIdx = ACTINDX from GL00105 (nolock) where ACTNUMST = @I_vRMOvrpymtWrtoffAcct  if (@RMOvrpymtWrtoffAcctIdx = 0)  begin  select @O_iErrorState = 6311      exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output  end end  if (@O_iErrorState = 0) begin  if not exists(select 1 from RM00201 (nolock) where CLASSID = @I_vCLASSID)   begin  insert RM00201  (  CLASSID,  CLASDSCR,  CRLMTTYP,  CRLMTAMT,  CRLMTPER,  CRLMTPAM,  DEFLTCLS,  BALNCTYP,  CHEKBKID,  BANKNAME,  TAXSCHID,  SHIPMTHD,  PYMTRMID,  CUSTDISC,  CSTPRLVL,  MINPYTYP,  MINPYDLR,  MINPYPCT,  MXWOFTYP,  MXWROFAM,  FINCHARG,  FNCHATYP,  FINCHDLR,  FNCHPCNT,  PRCLEVEL,  CURNCYID,  RATETPID,  DEFCACTY,  RMCSHACC,  RMARACC,  RMCOSACC,  RMIVACC,  RMSLSACC,  RMAVACC,  RMTAKACC,  RMFCGACC,  RMWRACC,  RMSORACC,  SALSTERR,  SLPRSNID,  STMTCYCL,  SNDSTMNT,  INACTIVE,  KPCALHST,  KPDSTHST,  KPERHIST,  KPTRXHST,  NOTEINDX,  MODIFDT,  CREATDDT,  Revalue_Customer,  Post_Results_To,  DISGRPER,  DUEGRPER,  ORDERFULFILLDEFAULT,  CUSTPRIORITY,  RMOvrpymtWrtoffAcctIdx,  CBVAT,  INCLUDEINDP   )  select  @I_vCLASSID,     @I_vCLASDSCR,     @I_vCRLMTTYP,     @I_vCRLMTAMT,     @I_vCRLMTPER,     @I_vCRLMTPAM,     @I_vDEFLTCLS,     @I_vBALNCTYP,     @I_vCHEKBKID,     '',      @I_vTAXSCHID,     @I_vSHIPMTHD,     @I_vPYMTRMID,     @I_vCUSTDISC,     '',      @I_vMINPYTYP,     @I_vMINPYDLR,     @I_vMINPYPCT,     @I_vMXWOFTYP,     @I_vMXWROFAM,     0,      @I_vFNCHATYP,     @I_vFINCHDLR,     @I_vFNCHPCNT,     @I_vPRCLEVEL,     @I_vCURNCYID,     @I_vRATETPID,     @I_vDEFCACTY,     @RMCSHACC,     @RMARACC,     @RMCOSACC,     @RMIVACC,     @RMSLSACC,     @RMAVACC,     @RMTAKACC,     @RMFCGACC,     @RMWRACC,     @RMSORACC,     @I_vSALSTERR,     @I_vSLPRSNID,     @I_vSTMTCYCL,     0,      0,      @I_vKPCALHST,     @I_vKPDSTHST,     @I_vKPERHIST,     @I_vKPTRXHST,     @NOTEINDX,     convert(varchar(12),getdate()),   convert(varchar(12),getdate()),   @I_vRevalue_Customer,    @I_vPost_Results_To,    @I_vDISGRPER,     @I_vDUEGRPER,     @I_vORDERFULFILLDEFAULT,   @I_vCUSTPRIORITY,    @RMOvrpymtWrtoffAcctIdx,   0,      0      if @@error <> 0  begin  select @O_iErrorState = 3321    exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output  return (@O_iErrorState)  end  end  else  begin  select @O_iErrorState = 3322    exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @iAddCodeErrState output  end end  if @O_iErrorState <> 0  return (@O_iErrorState)  exec @iStatus = taCreateCustomerClassPost  @I_vCLASSID,  @I_vCLASDSCR,  @I_vCRLMTTYP,  @I_vCRLMTAMT,  @I_vCRLMTPER,  @I_vCRLMTPAM,  @I_vDEFLTCLS,  @I_vBALNCTYP,  @I_vCHEKBKID,  @I_vTAXSCHID,  @I_vSHIPMTHD,  @I_vPYMTRMID,  @I_vCUSTDISC,  @I_vMINPYTYP,  @I_vMINPYDLR,  @I_vMINPYPCT,  @I_vMXWOFTYP,  @I_vMXWROFAM,  @I_vFNCHATYP,  @I_vFINCHDLR,  @I_vFNCHPCNT,  @I_vPRCLEVEL,  @I_vCURNCYID,  @I_vRATETPID,  @I_vDEFCACTY,  @I_vCASHACCT,  @I_vACCTRECACCT,  @I_vSALESACCT,  @I_vCOSTOFSALESACCT,  @I_vIVACCT,  @I_vTERMDISCTAKENACCT,  @I_vTERMDISCAVAILACCT,  @I_vFINCHRGACCT,  @I_vWRITEOFFACCT,  @I_vSALESORDERRETACCT,  @I_vSALSTERR,  @I_vSLPRSNID,  @I_vSTMTCYCL,  @I_vKPCALHST,  @I_vKPDSTHST,  @I_vKPERHIST,  @I_vKPTRXHST,  @I_vDISGRPER,  @I_vDUEGRPER,  @I_vRevalue_Customer,  @I_vPost_Results_To,  @I_vORDERFULFILLDEFAULT,  @I_vCUSTPRIORITY,  @I_vRMOvrpymtWrtoffAcct,  @I_vRequesterTrx,  @I_vUSRDEFND1,  @I_vUSRDEFND2,  @I_vUSRDEFND3,  @I_vUSRDEFND4,  @I_vUSRDEFND5,  @O_iErrorState = @iCustomState output,  @oErrString = @iCustomErrString output select @iError = @@error if @iStatus = 0 and @iError <> 0 begin  select @iStatus = @iError end if (@iStatus <> 0) or (@iCustomState <> 0) begin  select @oErrString = rtrim(@oErrString) + ' ' + ltrim(rtrim(@iCustomErrString))  select @O_iErrorState = 3323    exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output  return (@O_iErrorState) end  return (@O_iErrorState)   
GO
GRANT EXECUTE ON  [dbo].[taCreateCustomerClass] TO [DYNGRP]
GO
