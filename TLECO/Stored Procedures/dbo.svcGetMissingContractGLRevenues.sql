SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO
 create proc [dbo].[svcGetMissingContractGLRevenues]  @StartDate datetime,  @EndDate datetime,  @UserID char(15),  @TrxSource char(13) as declare @MinDate datetime begin  SET NOCOUNT ON   exec smGetMinDate @MinDate output   select  @StartDate = isnull(@StartDate, @MinDate),  @EndDate = isnull(@EndDate, @MinDate),  @UserID = isnull(@UserID, ''),  @TrxSource = case   when @TrxSource is null or rtrim(@TrxSource) = '' then 'SVC00604'  else rtrim(@TrxSource)  end   if (rtrim(@UserID) = '' or @TrxSource = '')  return   delete from SVC00614 where USERID = @UserID and (TRXSORCE = @TrxSource or rtrim(TRXSORCE) = 'REVMISSGL')   insert into SVC00614  select @UserID, @TrxSource, CONSTS, CONTNBR, LNSEQNBR, YEAR1, PERIODID, LNITMSEQ, Status, POSTEDDT, Transaction_Date,  PSTDAMNT, Source_Trx_Document_Type, SourceTrxDocumentNumber,   Transaction_Amount, SVC_Coverage_Start_Date, SVC_Coverage_End_Date,  DSCDLRAM, Net_Transaction_Amount, 0, ''  from SVC00604 Src1  where Src1.Status = 1 and Src1.CONSTS = 2  and Src1.DEX_ROW_ID not in   (select DISTINCT Src3.DEX_ROW_ID from SVC00604 Src3  inner join  (select JRNENTRY from GL20000   union all  select JRNENTRY from GL10000)  as GLCONTRACTS on GLCONTRACTS.JRNENTRY = substring(Src3.SourceTrxDocumentNumber, charindex('!', Src3.SourceTrxDocumentNumber) + 1, 8)  where Src3.Status = 1 and Src3.CONSTS = 2 and Src3.CONTNBR = Src1.CONTNBR   and charindex('!', Src3.SourceTrxDocumentNumber) > 0  )  and charindex('!', Src1.SourceTrxDocumentNumber) > 0  and (@StartDate = @MinDate or (@StartDate <> @MinDate and Src1.POSTEDDT >= @StartDate))  and (@EndDate = @MinDate or (@EndDate <> @MinDate and Src1.POSTEDDT <= @EndDate))   SET NOCOUNT OFF end   
GO
GRANT EXECUTE ON  [dbo].[svcGetMissingContractGLRevenues] TO [DYNGRP]
GO
