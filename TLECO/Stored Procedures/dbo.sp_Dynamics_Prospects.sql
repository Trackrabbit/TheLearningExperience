SET QUOTED_IDENTIFIER OFF
GO
SET ANSI_NULLS ON
GO
 CREATE PROCEDURE [dbo].[sp_Dynamics_Prospects] @iLanguageID int  as  set nocount on   declare @sqldropstring varchar(400),  @sqldefaultstring varchar(8000),  @sqlstring1 varchar(8000),  @sqlstring2 varchar(8000),  @sqlstring3 varchar(8000),  @sqlstring4 varchar(8000),  @sqlstring5 varchar(8000),  @sqlstring6 varchar(8000),  @sqlstring7 varchar(8000),  @sqlstring8 varchar(8000),  @sqlstring9 varchar(8000),  @sqlstring10 varchar(8000),  @sqljoinstring varchar(8000),  @sqlaccessstring varchar(2000),  @tNumberSegments int,  @tSegment int,  @I_iDictID int,  @I_iLangID int,  @I_iMessageNumber int,  @I_iAliasMessageNumber int,  @I_iIntegerValue int,  @Prospect_ID varchar(255), @Customer_Name varchar(255), @Contact_Person varchar(255), @Address_1 varchar(255), @Address_2 varchar(255), @Address_3 varchar(255), @City varchar(255), @State varchar(255), @Zip varchar(255), @Country varchar(255), @Customer_Class varchar(255), @Phone_1 varchar(255), @Phone_2 varchar(255), @PriceLevel varchar(255), @Fax varchar(255), @Shipping_Method varchar(255), @Tax_Schedule_ID varchar(255), @User_Defined_1 varchar(255), @User_Defined_2 varchar(255), @User_To_Enter varchar(255), @Created_Date varchar(255), @Modified_Date varchar(255), @Note_Index varchar(255), @Phone_3 varchar(255), @DrillBack_Base_Url varchar(255)  select @DrillBack_Base_Url = DYNAMICS.dbo.createBaseDrillBackUrlString(DB_NAME(),0)  select @I_iDictID = 1493 select @I_iMessageNumber = 24900 select @I_iAliasMessageNumber = 0 exec DYNAMICS..smGetBIMsgString  @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @Prospect_ID output  select @I_iDictID = 1493 select @I_iMessageNumber = 24901 select @I_iAliasMessageNumber = 0 exec DYNAMICS..smGetBIMsgString  @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @Customer_Name output  select @I_iDictID = 1493 select @I_iMessageNumber = 24902 select @I_iAliasMessageNumber = 0 exec DYNAMICS..smGetBIMsgString  @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @Contact_Person output  select @I_iDictID = 1493 select @I_iMessageNumber = 24903 select @I_iAliasMessageNumber = 0 exec DYNAMICS..smGetBIMsgString  @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @Address_1 output  select @I_iDictID = 1493 select @I_iMessageNumber = 24904 select @I_iAliasMessageNumber = 0 exec DYNAMICS..smGetBIMsgString  @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @Address_2 output  select @I_iDictID = 1493 select @I_iMessageNumber = 24905 select @I_iAliasMessageNumber = 0 exec DYNAMICS..smGetBIMsgString  @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @Address_3 output  select @I_iDictID = 1493 select @I_iMessageNumber = 24906 select @I_iAliasMessageNumber = 0 exec DYNAMICS..smGetBIMsgString  @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @City output  select @I_iDictID = 1493 select @I_iMessageNumber = 24907 select @I_iAliasMessageNumber = 0 exec DYNAMICS..smGetBIMsgString  @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @State output  select @I_iDictID = 1493 select @I_iMessageNumber = 24908 select @I_iAliasMessageNumber = 0 exec DYNAMICS..smGetBIMsgString  @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @Zip output  select @I_iDictID = 1493 select @I_iMessageNumber = 24909 select @I_iAliasMessageNumber = 0 exec DYNAMICS..smGetBIMsgString  @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @Country output  select @I_iDictID = 1493 select @I_iMessageNumber = 24910 select @I_iAliasMessageNumber = 0 exec DYNAMICS..smGetBIMsgString  @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @Customer_Class output  select @I_iDictID = 1493 select @I_iMessageNumber = 24911 select @I_iAliasMessageNumber = 0 exec DYNAMICS..smGetBIMsgString  @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @Phone_1 output  select @I_iDictID = 1493 select @I_iMessageNumber = 24912 select @I_iAliasMessageNumber = 0 exec DYNAMICS..smGetBIMsgString  @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @Phone_2 output  select @I_iDictID = 1493 select @I_iMessageNumber = 24913 select @I_iAliasMessageNumber = 0 exec DYNAMICS..smGetBIMsgString  @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @PriceLevel output  select @I_iDictID = 1493 select @I_iMessageNumber = 24914 select @I_iAliasMessageNumber = 0 exec DYNAMICS..smGetBIMsgString  @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @Fax output  select @I_iDictID = 1493 select @I_iMessageNumber = 24915 select @I_iAliasMessageNumber = 0 exec DYNAMICS..smGetBIMsgString  @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @Shipping_Method output  select @I_iDictID = 1493 select @I_iMessageNumber = 24916 select @I_iAliasMessageNumber = 0 exec DYNAMICS..smGetBIMsgString  @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @Tax_Schedule_ID output  select @I_iDictID = 1493 select @I_iMessageNumber = 24917 select @I_iAliasMessageNumber = 0 exec DYNAMICS..smGetBIMsgString  @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @User_Defined_1 output  select @I_iDictID = 1493 select @I_iMessageNumber = 24918 select @I_iAliasMessageNumber = 0 exec DYNAMICS..smGetBIMsgString  @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @User_Defined_2 output  select @I_iDictID = 1493 select @I_iMessageNumber = 24919 select @I_iAliasMessageNumber = 0 exec DYNAMICS..smGetBIMsgString  @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @User_To_Enter output  select @I_iDictID = 1493 select @I_iMessageNumber = 24920 select @I_iAliasMessageNumber = 0 exec DYNAMICS..smGetBIMsgString  @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @Created_Date output  select @I_iDictID = 1493 select @I_iMessageNumber = 24921 select @I_iAliasMessageNumber = 0 exec DYNAMICS..smGetBIMsgString  @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @Modified_Date output  select @I_iDictID = 1493 select @I_iMessageNumber = 24922 select @I_iAliasMessageNumber = 0 exec DYNAMICS..smGetBIMsgString  @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @Note_Index output  select @I_iDictID = 1493 select @I_iMessageNumber = 24894 select @I_iAliasMessageNumber = 0 exec DYNAMICS..smGetBIMsgString  @I_iMessageNumber, @I_iAliasMessageNumber, @I_iDictID, @iLanguageID, @Phone_3 output   select @sqldropstring =   'if exists (select * from dbo.sysobjects where id = object_id(N''[dbo].[Prospects]'') and OBJECTPROPERTY(id, N''IsView'') = 1) ' +  'drop view [dbo].[Prospects] '  select @sqldefaultstring =   'CREATE VIEW Prospects AS ' +   'select ' +   'rtrim([''Sales Prospect Master''].[PROSPID]) as ''' + @Prospect_ID + ''', ' + 'rtrim([''Sales Prospect Master''].[CUSTNAME]) as ''' + @Customer_Name + ''', ' + 'rtrim([''Sales Prospect Master''].[ADDRESS1]) as ''' + @Address_1 + ''', ' + 'rtrim([''Sales Prospect Master''].[ADDRESS2]) as ''' + @Address_2 + ''', ' + 'rtrim([''Sales Prospect Master''].[CITY]) as ''' + @City + ''', ' + 'rtrim([''Sales Prospect Master''].[STATE]) as ''' + @State + ''', ' + 'rtrim([''Sales Prospect Master''].[ZIP]) as ''' + @Zip + ''', ' + 'rtrim([''Sales Prospect Master''].[PHONE1]) as ''' + @Phone_1 + ''', '   select @sqlstring1 =   'rtrim([''Sales Prospect Master''].[ADDRESS3]) as ''' + @Address_3 + ''', ' +  'rtrim([''Sales Prospect Master''].[CNTCPRSN]) as ''' + @Contact_Person + ''', ' +  'rtrim([''Sales Prospect Master''].[COUNTRY]) as ''' + @Country + ''', ' +  '[''Sales Prospect Master''].[CREATDDT] as ''' + @Created_Date + ''', ' +  'rtrim([''Sales Prospect Master''].[CUSTCLAS]) as ''' + @Customer_Class + ''', ' +  'rtrim([''Sales Prospect Master''].[FAX]) as ''' + @Fax + ''', ' +  '[''Sales Prospect Master''].[MODIFDT] as ''' + @Modified_Date + ''', ' +  '[''Sales Prospect Master''].[NOTEINDX] as ''' + @Note_Index + ''', ' +  'rtrim([''Sales Prospect Master''].[PHONE2]) as ''' + @Phone_2 + ''', ' +  'rtrim([''Sales Prospect Master''].[PHONE3]) as ''' + @Phone_3 + ''', ' +  'rtrim([''Sales Prospect Master''].[PRCLEVEL]) as ''' + @PriceLevel + ''', ' +  'rtrim([''Sales Prospect Master''].[SHIPMTHD]) as ''' + @Shipping_Method + ''', ' +  'rtrim([''Sales Prospect Master''].[TAXSCHID]) as ''' + @Tax_Schedule_ID + ''', ' +  'rtrim([''Sales Prospect Master''].[USERDEF1]) as ''' + @User_Defined_1 + ''', ' +  'rtrim([''Sales Prospect Master''].[USERDEF2]) as ''' + @User_Defined_2 + ''', ' +  'rtrim([''Sales Prospect Master''].[USER2ENT]) as ''' + @User_To_Enter + ''' '   select @sqljoinstring =   'from [SOP00200] as [''Sales Prospect Master''] with (NOLOCK) '   select @sqlaccessstring =   'GRANT SELECT ON [dbo].[Prospects] TO [rpt_project manager]' + 'GRANT SELECT ON [dbo].[Prospects] TO [rpt_customer service rep]' + 'GRANT SELECT ON [dbo].[Prospects] TO [rpt_dispatcher]' + 'GRANT SELECT ON [dbo].[Prospects] TO [rpt_bookkeeper]' + 'GRANT SELECT ON [dbo].[Prospects] TO [rpt_sales manager]' + 'GRANT SELECT ON [dbo].[Prospects] TO [rpt_executive]' + 'GRANT SELECT ON [dbo].[Prospects] TO [rpt_accounting manager]'  exec (@sqldropstring)  exec (@sqldefaultstring+' '+@sqlstring1+' '+@sqlstring2+' '+@sqlstring3+' '+@sqlstring4+' '+@sqlstring5+' '+@sqlstring6+' '+@sqlstring7+' '+@sqlstring8+' '+@sqlstring9+' '+@sqlstring10+' '+@sqljoinstring)  exec (@sqlaccessstring)   set nocount off    
GO
GRANT EXECUTE ON  [dbo].[sp_Dynamics_Prospects] TO [DYNGRP]
GO
