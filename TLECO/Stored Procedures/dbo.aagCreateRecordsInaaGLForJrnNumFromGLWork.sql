SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO
 create        PROCEDURE [dbo].[aagCreateRecordsInaaGLForJrnNumFromGLWork] @JrnEntry int, @I_caaAuditTrailPrefix  char(5), @I_CurrAuditTrail varchar(25), @I_cUserID  char(37) AS   DECLARE @aaGLHdrID   int,  @fSuccess tinyint,  @cTrxSource char(13),  @caaAuditTrailCode  char(13),  @nYear    smallint,  @fHist    tinyint,  @cglHistAuditTrailCode  char(13),  @nTrxState smallint,  @dtglPostDate datetime,  @nRecTrxSeq   numeric(19,5),  @nRecrngTrx   tinyint,  @nCompanyID smallint,  @nTrxType   smallint,  @nSuccess   smallint,  @TRXDATE datetime,  @cTrxSourcerev char(13),  @RVRSNGDT datetime,  @aaGLHdrIDNew int,  @Max int,  @RCTRXSEQ int,  @aaGLWorkHdrID int   SELECT @nRecrngTrx = 0, @nRecTrxSeq = 0, @nTrxType = 0  Select @nCompanyID = CMPANYID FROM DYNAMICS. .SY01500 WHERE INTERID = DB_NAME()   select @aaGLWorkHdrID = aaGLWorkHdrID, @RCTRXSEQ = RCTRXSEQ from AAG10000  where  JRNENTRY = @JrnEntry and aaTRXType = 3  select @aaGLHdrID=aaGLHdrID, @TRXDATE = GLPOSTDT,@cTrxSource = aaGLTRXSource,@nYear = YEAR1  from AAG30000 where JRNENTRY=@JrnEntry and RCTRXSEQ = @RCTRXSEQ   set @dtglPostDate = @TRXDATE   delete from AAG30001 where aaGLHdrID=@aaGLHdrID  delete from AAG30002 where aaGLHdrID=@aaGLHdrID  delete from AAG30003 where aaGLHdrID=@aaGLHdrID  delete from AAG30000 where aaGLHdrID=@aaGLHdrID    select @caaAuditTrailCode=@I_CurrAuditTrail   exec aagCopyToGLFromGLWorkForAdjustments  @aaGLWorkHdrID,  @aaGLHdrIDNew output,  @nYear,  @cTrxSource,  @caaAuditTrailCode,  @fSuccess,  @nCompanyID  select @nTrxState = 1   Delete from AAG10000 where aaGLWorkHdrID = @aaGLWorkHdrID  Delete from AAG10001 where aaGLWorkHdrID = @aaGLWorkHdrID  Delete from AAG10002 where aaGLWorkHdrID = @aaGLWorkHdrID  Delete from AAG10003 where aaGLWorkHdrID = @aaGLWorkHdrID   Insert into AAG70000   VALUES(@I_cUserID, 'GL_NORMAL', @aaGLHdrIDNew, @JrnEntry, 2,  @dtglPostDate, @cTrxSource,@caaAuditTrailCode, @nRecTrxSeq, @nYear)    
GO
GRANT EXECUTE ON  [dbo].[aagCreateRecordsInaaGLForJrnNumFromGLWork] TO [DYNGRP]
GO
