SET QUOTED_IDENTIFIER OFF
GO
SET ANSI_NULLS ON
GO
 CREATE PROCEDURE [dbo].[seeFAPrintDepreciationDetail]  @Asset_ID_From VARCHAR(15),  @Asset_ID_To VARCHAR(15),  @Suf varchar(3),  @Asset_Description varchar(41),  @Asset_Type varchar(100),  @Structure_ID varchar(31),  @Asset_Class_ID varchar(15),  @Location_ID varchar(15),  @Property_Type varchar(100),  @Place_In_Service_Date_From datetime,  @Place_In_Service_Date_To datetime,  @Acquisition_Date_From datetime,  @Acquisition_Date_To datetime,  @Original_Life_Years_From smallint,  @Original_Life_Years_To smallint,  @Original_Life_Days_From smallint,  @Original_Life_Days_To smallint,  @Remaining_Life_Years_From smallint,  @Remaining_Life_Years_To smallint,  @Remaining_Life_Days_From smallint,  @Remaining_Life_Days_To smallint,  @Cost_Basis_From numeric(19,5),  @Cost_Basis_To numeric(19,5),  @Depreciation_Method varchar(100),  @Averaging_Convention varchar(100),  @Fiscal_Year_Added varchar(5),   @FA_Period varchar(5),   @FA_Year varchar(5),   @Asset_Status varchar(100),  @Book_ID varchar(15),  @Display_Reset_Amounts tinyint,  @Depreciation_as_of_Date datetime AS  select [Asset ID], [Suf], [Asset Description],  [Location ID], [Asset Class ID],  [Depreciation Method],  [Averaging Convention],  [Cost Before Retire or Delete],[Cost Basis],  isnull([LTD Depreciation Amount],0.0) as [LTD Depreciation Amount],  isnull([YTD Depreciation Amount],0.0) as [YTD Depreciation Amount],  isnull([Net Book Value],0.0) as [Net Book Value],[Place in Service Date],  [Original Life Years],[Original Life Days],  [Structure ID],  case when ([Depreciated to Date] > @Depreciation_as_of_Date) then [Remaining Life Years] else REMAININGLIFEYEARS end as [Remaining Life Years],  case when ([Depreciated to Date] > @Depreciation_as_of_Date) then [Remaining Life Days] else REMAININGLIFEDAYS end as [Remaining Life Days],  [Asset Type],  [Property Type],  [Acquisition Date],[Fully Depreciated Date],  [Switch From 1 Date],  [Asset Status],  isnull([Current Run Depreciation Amount],0.0) as [Current Run Depreciation Amount],  [Amortization Code],  [Amortization Amount],[Depreciated to Date],  [FA Period],  [Depreciation from Date], [FA Year],[Amount],  RETIREMENTDATE, ASSETINDXAFTRET from ( select a.ASSETID as [Asset ID], cast(a.ASSETIDSUF as varchar) as [Suf], a.ASSETDESC as [Asset Description],  a.LOCATNID as [Location ID], a.ASSETCLASSID as [Asset Class ID],  dbo.FA_FUNC_Depreciation_Method(b.DEPRECIATIONMETHOD) as [Depreciation Method],  dbo.FA_FUNC_Averaging_Convention(b.AVERAGINGCONV) as [Averaging Convention],  b.COSTBFRETORDEL as [Cost Before Retire or Delete],b.COSTBASIS as [Cost Basis],b.LTDDEPRAMT as [LTD Depreciation Amount],  b.YTDDEPRAMT as [YTD Depreciation Amount],b.NETBOOKVALUE as [Net Book Value],b.PLINSERVDATE as [Place in Service Date],  b.ORIGINALLIFEYEARS as [Original Life Years],b.ORIGINALLIFEDAYS as [Original Life Days],  a.STRUCTUREID as [Structure ID],  dbo.FA_RWCalcRemainingLife(@Depreciation_as_of_Date,b.PLINSERVDATE,b.DEPRBEGDATE,b.ORIGINALLIFEYEARS,b.ORIGINALLIFEDAYS,0,b.AVERAGINGCONV) as [Remaining Life Years],  b.REMAININGLIFEYEARS,  dbo.FA_RWCalcRemainingLife(@Depreciation_as_of_Date,b.PLINSERVDATE,b.DEPRBEGDATE,b.ORIGINALLIFEYEARS,b.ORIGINALLIFEDAYS,1,b.AVERAGINGCONV) as [Remaining Life Days],  b.REMAININGLIFEDAYS,  dbo.FA_FUNC_Asset_Type(a.ASSETTYPE) as [Asset Type],  dbo.FA_FUNC_Property_Type(a.PROPTYPE) as [Property Type],  a.ACQDATE as [Acquisition Date],b.FULLYDEPRDATE as [Fully Depreciated Date],  b.SWITCHFM1DATE as [Switch From 1 Date],  dbo.FA_FUNC_Asset_Status(a.ASSETSTATUS) as [Asset Status],a.ASSETSTATUS,  b.CURRUNDEPRAMT as [Current Run Depreciation Amount],  dbo.FA_FUNC_Amortization_Code(b.AMORTIZATIONCODE) as [Amortization Code],  b.AMORTIZATIONAMOUNT as [Amortization Amount],b.DEPRTODATE as [Depreciated to Date],c.FAPERIOD as [FA Period],  c.DEPRFROMDATE as [Depreciation from Date], c.FAYEAR as [FA Year],c.AMOUNT as [Amount],  isnull(e.RETIREMENTDATE,'') as RETIREMENTDATE,isnull(e.ASSETINDXAFTRET,0) as ASSETINDXAFTRET  from [FA00902] as c left outer join [FA00100] as a on c.[ASSETINDEX] = a.[ASSETINDEX]   left outer join [FA00200] as b on c.[ASSETINDEX] = b.[ASSETINDEX] and c.[BOOKINDX] = b.[BOOKINDX]   left outer join [FA40200] as d on b.[BOOKINDX] = d.[BOOKINDX]   left outer join [FA00700] as e on a.[ASSETINDEX] = e.[ASSETINDXAFTRET]  where c.TRANSACCTTYPE=2  and (a.ASSETID>=@Asset_ID_From and a.ASSETID<=@Asset_ID_To)  and (@Suf='ALL' or (cast(a.ASSETIDSUF as varchar)=@Suf))  and (@Asset_Description='ALL' or (a.ASSETDESC=@Asset_Description))  and (@Structure_ID='ALL' or (a.STRUCTUREID=@Structure_ID))  and (@Asset_Class_ID='ALL' or (a.ASSETCLASSID=@Asset_Class_ID))  and (@Location_ID='ALL' or (a.LOCATNID=@Location_ID))  and b.PLINSERVDATE between @Place_In_Service_Date_From and @Place_In_Service_Date_To  and a.ACQDATE between @Acquisition_Date_From and @Acquisition_Date_To  and b.ORIGINALLIFEYEARS between @Original_Life_Years_From and @Original_Life_Years_To  and b.ORIGINALLIFEDAYS between @Original_Life_Days_From and @Original_Life_Days_To  and b.REMAININGLIFEYEARS between @Remaining_Life_Years_From and @Remaining_Life_Years_To  and b.REMAININGLIFEDAYS between @Remaining_Life_Days_From and @Remaining_Life_Days_To  and (@Fiscal_Year_Added='ALL' or (cast(c.FISCALYRADDED as varchar)=@Fiscal_Year_Added))  and (@FA_Period='ALL' or (cast(c.FAPERIOD as varchar)=@FA_Period))  and (@FA_Year='ALL' or (cast(c.FAYEAR as varchar)=@FA_Year))  and d.BOOKID=@Book_ID  and c.DEPRTODATE<=@Depreciation_as_of_Date  and @Depreciation_as_of_Date>=b.PLINSERVDATE  and ((@Display_Reset_Amounts=1) or (@Display_Reset_Amounts=0 and c.FA_Reset_User_ID=''))  ) DepreciationDetail  where (@Asset_Type='ALL' or ([Asset Type]=rtrim(@Asset_Type)))  and (@Property_Type='ALL' or ([Property Type]=rtrim(@Property_Type)))  and (@Depreciation_Method='ALL' or ([Depreciation Method]=rtrim(@Depreciation_Method)))  and (@Averaging_Convention='ALL' or ([Averaging Convention]=rtrim(@Averaging_Convention)))  and (@Asset_Status='ALL'   or (@Asset_Status=dbo.FA_FUNC_Asset_Status(1) and   ((ASSETSTATUS=1) or (ASSETSTATUS=4 and RETIREMENTDATE>=@Depreciation_as_of_Date)))  or (@Asset_Status=dbo.FA_FUNC_Asset_Status(4) and (([Asset Status]=rtrim(@Asset_Status) and ASSETSTATUS=4)  and (ASSETSTATUS=4 and RETIREMENTDATE<@Depreciation_as_of_Date))) )  and ( (((ASSETSTATUS=1) or (ASSETSTATUS=4 and RETIREMENTDATE>=@Depreciation_as_of_Date))   and ([Cost Basis] between @Cost_Basis_From and @Cost_Basis_To))  or ( (ASSETSTATUS=4 and RETIREMENTDATE<@Depreciation_as_of_Date)  and ([Cost Before Retire or Delete] between @Cost_Basis_From and @Cost_Basis_To))) order by [Asset ID], [Suf]    
GO
GRANT EXECUTE ON  [dbo].[seeFAPrintDepreciationDetail] TO [DYNGRP]
GO
GRANT EXECUTE ON  [dbo].[seeFAPrintDepreciationDetail] TO [rpt_materials manager]
GO
GRANT EXECUTE ON  [dbo].[seeFAPrintDepreciationDetail] TO [rpt_operations manager]
GO
GRANT EXECUTE ON  [dbo].[seeFAPrintDepreciationDetail] TO [rpt_power user]
GO
GRANT EXECUTE ON  [dbo].[seeFAPrintDepreciationDetail] TO [rpt_production manager]
GO
GRANT EXECUTE ON  [dbo].[seeFAPrintDepreciationDetail] TO [rpt_warehouse manager]
GO
