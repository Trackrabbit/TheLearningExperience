SET QUOTED_IDENTIFIER OFF
GO
SET ANSI_NULLS ON
GO
 CREATE PROCEDURE [dbo].[svcCreateContractMoveLines]  @CONSTS smallint,  @Contract char(11),  @AddressCode char(15),  @Error smallint OUTPUT AS  select @Error = 0  if exists(select * from SVC00675 where CONTNBR = @Contract and CONSTS = @CONSTS and MKDTOPST = 1)  begin  select @Error = 10  return  end  else  delete from SVC00675 where CONTNBR = @Contract and CONSTS = @CONSTS  if not exists(select * from SVC00675 where CONTNBR = @Contract and CONSTS = @CONSTS) Begin if @AddressCode > '' insert into SVC00675 ( CONSTS, CONTNBR, LNSEQNBR, CNTTYPE, STRTDATE, ENDDATE, ITEMNMBR, SERLNMBR, EQUIPID, DSCRIPTN, QUANTITY, To_Customer_Number, ADRSCODE, PRICSHED, CNTPRCOVR, TOTAL, SVC_Monthly_Price, RETNAGAM, RTNBILLD, NBRCAL, ACTCAL, BLKTIM, VALTIM) select CONSTS, CONTNBR, LNSEQNBR, CNTTYPE, STRTDATE, ENDDATE, ITEMNMBR, SERLNMBR, EQUIPID, DSCRIPTN, QUANTITY, CUSTNMBR, ADRSCODE, PRICSHED, CNTPRCOVR, TOTAL, SVC_Monthly_Price, RETNAGAM, RTNBILLD, NBRCAL, ACTCAL, BLKTIM, VALTIM from SVC00601 where CONSTS = @CONSTS and  CONTNBR = @Contract and ADRSCODE = @AddressCode and (Contract_Line_Status = 'N' or Contract_Line_Status = 'R') else insert into SVC00675 ( CONSTS, CONTNBR, LNSEQNBR, CNTTYPE, STRTDATE, ENDDATE, ITEMNMBR, SERLNMBR, EQUIPID, DSCRIPTN, QUANTITY, To_Customer_Number, ADRSCODE, PRICSHED, CNTPRCOVR, TOTAL, SVC_Monthly_Price, RETNAGAM, RTNBILLD, NBRCAL, ACTCAL, BLKTIM, VALTIM) select CONSTS, CONTNBR, LNSEQNBR, CNTTYPE, STRTDATE, ENDDATE, ITEMNMBR, SERLNMBR, EQUIPID, DSCRIPTN, QUANTITY, CUSTNMBR, ADRSCODE, PRICSHED, CNTPRCOVR, TOTAL, SVC_Monthly_Price, RETNAGAM, RTNBILLD, NBRCAL, ACTCAL, BLKTIM, VALTIM from SVC00601 where CONSTS = @CONSTS and  CONTNBR = @Contract  and (Contract_Line_Status = 'N' or Contract_Line_Status = 'R') End  return    
GO
GRANT EXECUTE ON  [dbo].[svcCreateContractMoveLines] TO [DYNGRP]
GO
