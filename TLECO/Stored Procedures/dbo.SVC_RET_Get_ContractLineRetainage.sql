SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO
 CREATE Procedure [dbo].[SVC_RET_Get_ContractLineRetainage]  (  @Type smallint,  @Contract char(11),  @Line Numeric(19,5),  @Status smallint,  @PostedAmount numeric(19,5) OUTPUT,  @OrigPostedAmount numeric(19,5) OUTPUT,  @TrxAmount numeric(19,5) OUTPUT,  @OrigTrxAmount numeric(19,5) OUTPUT,  @CreditAmount numeric(19,5) OUTPUT,  @OrigCreditAmount numeric(19,5) OUTPUT,  @DiscountAmount numeric(19,5) OUTPUT,  @OrigDiscountAmount numeric(19,5) OUTPUT,  @NetTrxAmount numeric(19,5) OUTPUT,  @OrigNetTrxAmount numeric(19,5) OUTPUT,  @History smallint,   @Version smallint  ) As set nocount on   if @History = 1  Begin  if @Line is not null and @Line > 0  BEGIN  SELECT @PostedAmount = SUM(PSTDAMNT),   @OrigPostedAmount = SUM(Originating_PostedAmount),   @TrxAmount = SUM(Transaction_Amount),   @OrigTrxAmount = SUM(OrigTransactionAmount) ,  @CreditAmount = SUM(SVC_Invoice_Credit_Amoun),  @OrigCreditAmount = SUM(OrigInvCreditAmt) ,  @DiscountAmount = SUM(DSCDLRAM) ,  @OrigDiscountAmount = SUM(ORDDLRAT),  @NetTrxAmount = SUM(Net_Transaction_Amount) ,  @OrigNetTrxAmount = SUM(OrigNetTransactionAmount)   FROM SVC00604  WHERE (CONSTS = @Type) AND (CONTNBR = @Contract) AND   (LNSEQNBR = @Line) AND Status = @Status  END ELSE  BEGIN  SELECT @PostedAmount = SUM(PSTDAMNT),   @OrigPostedAmount = SUM(Originating_PostedAmount),   @TrxAmount = SUM(Transaction_Amount),   @OrigTrxAmount = SUM(OrigTransactionAmount) ,  @CreditAmount = SUM(SVC_Invoice_Credit_Amoun),  @OrigCreditAmount = SUM(OrigInvCreditAmt) ,  @DiscountAmount = SUM(DSCDLRAM) ,  @OrigDiscountAmount = SUM(ORDDLRAT),  @NetTrxAmount = SUM(Net_Transaction_Amount) ,  @OrigNetTrxAmount = SUM(OrigNetTransactionAmount)   FROM SVC00604  WHERE (CONSTS = @Type) AND (CONTNBR = @Contract) AND   Status = @Status  END  End else  Begin  if @Line is not null and @Line > 0  BEGIN  SELECT @PostedAmount = SUM(PSTDAMNT),   @OrigPostedAmount = SUM(Originating_PostedAmount),   @TrxAmount = SUM(Transaction_Amount),   @OrigTrxAmount = SUM(OrigTransactionAmount) ,  @CreditAmount = SUM(SVC_Invoice_Credit_Amoun),  @OrigCreditAmount = SUM(OrigInvCreditAmt) ,  @DiscountAmount = SUM(DSCDLRAM) ,  @OrigDiscountAmount = SUM(ORDDLRAT),  @NetTrxAmount = SUM(Net_Transaction_Amount) ,  @OrigNetTrxAmount = SUM(OrigNetTransactionAmount)   FROM SVC30604  WHERE (CONSTS = @Type) AND (CONTNBR = @Contract) AND SVC_Contract_Version = @Version AND  (LNSEQNBR = @Line) AND Status = @Status  END ELSE  BEGIN  SELECT @PostedAmount = SUM(PSTDAMNT),   @OrigPostedAmount = SUM(Originating_PostedAmount),   @TrxAmount = SUM(Transaction_Amount),   @OrigTrxAmount = SUM(OrigTransactionAmount) ,  @CreditAmount = SUM(SVC_Invoice_Credit_Amoun),  @OrigCreditAmount = SUM(OrigInvCreditAmt) ,  @DiscountAmount = SUM(DSCDLRAM) ,  @OrigDiscountAmount = SUM(ORDDLRAT),  @NetTrxAmount = SUM(Net_Transaction_Amount) ,  @OrigNetTrxAmount = SUM(OrigNetTransactionAmount)   FROM SVC30604  WHERE (CONSTS = @Type) AND (CONTNBR = @Contract) AND SVC_Contract_Version = @Version AND  Status = @Status  END  End if @Status = 1    select @TrxAmount = @TrxAmount - @CreditAmount , @OrigTrxAmount = @OrigTrxAmount - @OrigCreditAmount return     
GO
GRANT EXECUTE ON  [dbo].[SVC_RET_Get_ContractLineRetainage] TO [DYNGRP]
GO
