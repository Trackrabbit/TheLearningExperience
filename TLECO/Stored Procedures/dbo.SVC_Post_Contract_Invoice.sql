SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO
 CREATE PROCEDURE [dbo].[SVC_Post_Contract_Invoice]  ( @CONSTS smallint,  @CONTNBR char(11),  @SOPTYPE smallint,  @SOPNUM char(21) ) AS  declare @CTOTAL numeric(19,5) declare @ORIGCTOTAL numeric(19,5) SELECT @CTOTAL = SUM(DOCAMNT),  @ORIGCTOTAL = SUM(ORDOCAMT) from SVC00603 where  CONSTS = @CONSTS and  CONTNBR = @CONTNBR update SVC00603 with (ROWLOCK)  set  POSTEDDT = CONVERT(varchar(10),GETDATE(),102) + ' 00:00:00',  POSTED = 1,  PSTDAMNT = DOCAMNT - SVC_Invoice_Credit_Amoun - DSCDLRAM,  ORIGPSTDAMNT = ORDOCAMT - OrigInvCreditAmt - ORDDLRAT  where  CONSTS = @CONSTS and  CONTNBR = @CONTNBR update SVC00600 with (ROWLOCK)  set  SVC00600.Invoiced_Amount = isnull(@CTOTAL,0.0),  SVC00600.Orig_Invoiced_Amount = isnull(@ORIGCTOTAL,0.0),  SVC00600.Amount_To_Invoice = 0.0,  SVC00600.Orig_Amount_To_Invoice = 0.0,  SVC00600.TOTBIL = isnull(@CTOTAL,0.0),  SVC00600.ORIGTOTBIL = isnull(@ORIGCTOTAL,0.0),  SVC00600.Last_Amount_Billed = isnull(@CTOTAL,0.0),  SVC00600.ORIGLASTAmountBilled = isnull(@ORIGCTOTAL,0.0),  SVC00600.FRSTBLDTE = CONVERT(varchar(10),GETDATE(),102) + ' 00:00:00',  SVC00600.LSTBLDTE = CONVERT(varchar(10),GETDATE(),102) + ' 00:00:00',  SVC00600.BILSTAT = 1,  SVC00600.NXTBLDTE = 'January 1, 2999 00:00:00' where  SVC00600.CONSTS = @CONSTS and  SVC00600.CONTNBR = @CONTNBR update SVC00601 with (ROWLOCK)  set  SVC00601.FRSTBLDTE = CONVERT(varchar(10),GETDATE(),102) + ' 00:00:00',  SVC00601.NXTBLDTE = 'January 1, 2999 00:00:00' where  SVC00601.CONSTS = @CONSTS and  SVC00601.CONTNBR = @CONTNBR insert SVC00605 with (ROWLOCK) select @CONSTS,  @CONTNBR,  @SOPNUM,  @SOPTYPE,  CONVERT(varchar(10),GETDATE(),102) + ' 00:00:00',   isnull(@CTOTAL,0.0),   isnull(@CTOTAL,0.0), isnull(@ORIGCTOTAL,0.0), isnull(@ORIGCTOTAL,0.0),0 return    
GO
GRANT EXECUTE ON  [dbo].[SVC_Post_Contract_Invoice] TO [DYNGRP]
GO
