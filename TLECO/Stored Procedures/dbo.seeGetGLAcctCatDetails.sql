SET QUOTED_IDENTIFIER OFF
GO
SET ANSI_NULLS ON
GO
create procedure [dbo].[seeGetGLAcctCatDetails] (  @StartDate datetime,      @AcctCat   int ) AS   BEGIN    DECLARE @FullPeriodStart datetime        DECLARE @FullPeriodEnd datetime        DECLARE @FullPeriodIDStart int        DECLARE @FullPeriodIDEnd int        DECLARE @CurrentYear int        DECLARE @IsHist int        DECLARE @TrxStartDate datetime        DECLARE @TrxEndDate datetime        DECLARE @DATEMAX datetime        DECLARE @INVALIDPERIOD int        DECLARE @FinalBalance Numeric(19, 5)     SELECT @StartDate = dbo.GetDateStripTime(@StartDate)        SET @DATEMAX = dbo.GetDefaultMaxDate()        set @INVALIDPERIOD = -1        SELECT @CurrentYear = YEAR1,               @IsHist = HISTORYR        FROM   SY40101        WHERE  @StartDate between FSTFSCDY and LSTFSCDY     SELECT @FullPeriodStart = ISNULL((SELECT TOP 1 PERIODDT                                          FROM   SY40100                                          WHERE  PERIODDT <= @StartDate                                                 AND PERDENDT >= @StartDate                                                 AND YEAR1 = @CurrentYear                                                 AND FORIGIN = 1                                          ORDER  BY PERIODDT ASC), @DATEMAX)        SELECT @FullPeriodIDStart = ISNULL((SELECT DISTINCT PERIODID                                            FROM   SY40100                                            WHERE  PERIODDT = @FullPeriodStart                                                   AND YEAR1 = @CurrentYear                                                   AND FORIGIN = 1),                                    @INVALIDPERIOD)        SELECT @FullPeriodEnd = ISNULL((SELECT TOP 1 PERDENDT                                        FROM   SY40100                                        WHERE  PERIODDT <= @StartDate                                               AND PERDENDT >= @StartDate                                               AND YEAR1 = @CurrentYear                                               AND FORIGIN = 1                                        ORDER  BY PERDENDT DESC), @DATEMAX)        SELECT @FullPeriodIDEnd = ISNULL((SELECT DISTINCT PERIODID                                          FROM   SY40100                                          WHERE  PERDENDT = @FullPeriodEnd                                                 AND YEAR1 = @CurrentYear                                                 AND FORIGIN = 1), @INVALIDPERIOD)     IF @AcctCat = 1          BEGIN        select a.* from AccountTransactions a     inner join GL00100 b on a.[Account Index] = b.ACTINDX     where [TRX Date] >= @FullPeriodStart and  [TRX Date] <=@FullPeriodEnd     and b.ACCATNUM in (33,34,35,36,37,38,39,40,41,42,47)         END       IF @AcctCat = 2         BEGIN              select a.* from AccountTransactions a     inner join GL00100 b on a.[Account Index] = b.ACTINDX     where [TRX Date] >= @FullPeriodStart and  [TRX Date] <=@FullPeriodEnd     and b.ACCATNUM in (31,43,32,46)         END       IF @AcctCat = 3   BEGIN       select a.* from AccountTransactions a     inner join GL00100 b on a.[Account Index] = b.ACTINDX     where [TRX Date] >= @FullPeriodStart and  [TRX Date] <=@FullPeriodEnd     and b.ACCATNUM in (33)   END END          
GO
GRANT EXECUTE ON  [dbo].[seeGetGLAcctCatDetails] TO [DYNGRP]
GO
GRANT EXECUTE ON  [dbo].[seeGetGLAcctCatDetails] TO [rpt_accounting manager]
GO
GRANT EXECUTE ON  [dbo].[seeGetGLAcctCatDetails] TO [rpt_bookkeeper]
GO
GRANT EXECUTE ON  [dbo].[seeGetGLAcctCatDetails] TO [rpt_certified accountant]
GO
GRANT EXECUTE ON  [dbo].[seeGetGLAcctCatDetails] TO [rpt_executive]
GO
