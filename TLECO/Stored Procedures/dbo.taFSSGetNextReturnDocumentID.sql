SET QUOTED_IDENTIFIER OFF
GO
SET ANSI_NULLS ON
GO
 CREATE procedure [dbo].[taFSSGetNextReturnDocumentID]  @I_vGETDOCIDFOR char(3), @O_vNEWDOCID varchar(15) output, @O_iErrorState int output  as  declare @iBaseTemplate char(12),  @iNEWDOCID varchar(15),  @iStatus int,  @oErrString varchar(255),  @O_oErrorState int  select @iBaseTemplate = '000000000000',  @iNEWDOCID = '',  @iStatus = 0,  @oErrString = '',  @O_oErrorState = 0,  @O_vNEWDOCID = '',  @O_iErrorState = 0  if (@I_vGETDOCIDFOR is NULL) begin  set @O_iErrorState = 9800   exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output end  set @I_vGETDOCIDFOR = UPPER(@I_vGETDOCIDFOR)  if (@I_vGETDOCIDFOR <> 'RMA' and @I_vGETDOCIDFOR <> 'RTV') begin  set @O_iErrorState = 8800    exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output  return (@O_iErrorState) end  if @I_vGETDOCIDFOR = 'RMA' begin   update SVC00999 set SVC00999.RETDOCID = Convert(char(12), (CONVERT(numeric(12,0),RETDOCID) + 1)),   @O_vNEWDOCID = RETDOCID   where SEQUENCE1 = 1   if @@error <> 0  begin  set @O_iErrorState = 8801    exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output  return (@O_iErrorState)  end end else if @I_vGETDOCIDFOR = 'RTV' begin  update SVC00999 set SVC00999.RTV_Number = Convert(char(12), (CONVERT(numeric(12,0),RTV_Number) + 1)),   @O_vNEWDOCID = RTV_Number   where SEQUENCE1 = 1   if @@error <> 0  begin  set @O_iErrorState = 8802    exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output  return (@O_iErrorState)  end end  set @iNEWDOCID = @I_vGETDOCIDFOR + stuff(@iBaseTemplate,12 - LEN(rtrim(@O_vNEWDOCID)) + 1, LEN(@O_vNEWDOCID), @O_vNEWDOCID)  set @O_vNEWDOCID = @iNEWDOCID  return (@O_iErrorState)   
GO
GRANT EXECUTE ON  [dbo].[taFSSGetNextReturnDocumentID] TO [DYNGRP]
GO
