SET QUOTED_IDENTIFIER OFF
GO
SET ANSI_NULLS ON
GO
 Create   PROCEDURE [dbo].[FA_Asset_Group_Transfer_Validation]  (  @Grpname varchar(15),  @IntercomID varchar(5),  @Create_New int, @Transfertyp  int,  @ClassID varchar(20), @OutReslt  int OUTPUT  )  AS  declare  @AssetID VARCHAR (15),  @AssetSufix smallint,  @SQL_Statement nvarchar(4000),  @Reslt int, @Reslt1 int,  @MaxCountParam nvarchar(500), @Param   nvarchar(100), @Next_Asset_ID varchar(20),  @NextAssetParam nvarchar(200),  @NextAssetID1 varchar(20),  @Errstate int,  @Corp_BookID int , @Corp_BookID1 int , @NXTASSETIDFLG_CLS smallint, @NXTASSETIDFLG1 smallint, @NextAssetFlg nvarchar(200), @NXTASSETID1 varchar(15), @NextAssetIDParam nvarchar(200), @NXTASSETID varchar(15)  BEGIN   set @OutReslt=0   select @SQL_Statement = 'select @Corp_BookID=CORPBOOKINDX from FA49900'   set @Param = N'@Corp_BookID int output'   EXEC sp_executesql @SQL_Statement, @Param, @Corp_BookID= @Corp_BookID1 output    select @SQL_Statement = 'select  @NXTASSETIDFLG = ClassNextAssetIDFLG from '  + @IntercomID + '..FA40201 where   ASSETCLASSID = '''+ @ClassID +''''  set @NextAssetFlg = N'@NXTASSETIDFLG smallint output'   EXEC sp_executesql @SQL_Statement, @NextAssetFlg, @NXTASSETIDFLG= @NXTASSETIDFLG_CLS output   if @NXTASSETIDFLG_CLS = 1  begin  select @SQL_Statement = 'select @NextAssetID=NXTASSETID from '  + @IntercomID + '..FA40201 where   ASSETCLASSID = '''+ @ClassID +''''   set @NextAssetParam = N'@NextAssetID varchar(100) output'  EXEC sp_executesql @SQL_Statement, @NextAssetParam, @NextAssetID= @NextAssetID1 output    end   else  begin   select @SQL_Statement = 'select @NXTASSETIDFLG=NXTASSETIDFLG from '  + @IntercomID + '..FA49900'   set @NextAssetFlg = N'@NXTASSETIDFLG smallint output'   EXEC sp_executesql @SQL_Statement, @NextAssetFlg, @NXTASSETIDFLG= @NXTASSETIDFLG1 output   if @NXTASSETIDFLG1 = 1   begin  select @SQL_Statement = 'select @NextAssetID=NXTASSETID from '  + @IntercomID + '..FA49900'   set @NextAssetParam = N'@NextAssetID varchar(100) output'   EXEC sp_executesql @SQL_Statement, @NextAssetParam, @NextAssetID= @NextAssetID1 output   end   end    set @Next_Asset_ID=@NextAssetID1   DECLARE Cur_Asset cursor for   select ASSETID,ASSETIDSUF from FA10200 where GROUPNAME=@Grpname   OPEN Cur_Asset   FETCH NEXT FROM Cur_Asset INTO @AssetID,@AssetSufix   while @@FETCH_STATUS = 0   BEGIN   set @Reslt=0  set @Reslt1=0  if @Create_New=1  BEGIN  set @Next_Asset_ID=@NextAssetID1  select @SQL_Statement = 'select @Reslt=COUNT(*) from '  + @IntercomID + '..FA00100 where ASSETID=''' + @Next_Asset_ID + ''' and   ASSETIDSUF='''+convert(varchar(10),1)+''''   set @MaxCountParam = N'@Reslt int output'   EXEC sp_executesql @SQL_Statement, @MaxCountParam, @Reslt= @Reslt1 output   if @Reslt1>=1   begin   set @OutReslt=1   DEALLOCATE Cur_Asset   return  @OutReslt   end   set @Reslt=0  set @Reslt1=0   exec FA_Number_Inc_Dec 1,@Next_Asset_ID output,@Errstate output   if @Errstate=1   begin   set @OutReslt=2   DEALLOCATE Cur_Asset   return  @OutReslt   end   end   if @Create_New=0  BEGIN  set @Next_Asset_ID=@NextAssetID1  select @SQL_Statement = 'select @Reslt=COUNT(*) from '  + @IntercomID + '..FA00100 where   ASSETID=''' + @AssetID + ''' and ASSETIDSUF='''+convert(varchar(10),@AssetSufix)+''''   set @MaxCountParam = N'@Reslt int output'   EXEC sp_executesql @SQL_Statement, @MaxCountParam, @Reslt= @Reslt1 output   if @Reslt1>=1   begin   set @OutReslt=1   DEALLOCATE Cur_Asset   return  @OutReslt   end   set @Reslt=0  set @Reslt1=0   exec FA_Number_Inc_Dec 1,@Next_Asset_ID output,@Errstate output   if @Errstate=1   begin   set @OutReslt=2   DEALLOCATE Cur_Asset   return  @OutReslt   end   END  if @Transfertyp<>3   BEGIN   set @Reslt=0  set @Reslt1=0  select @SQL_Statement = 'select @Reslt=COUNT(*) from FA00200 where BOOKINDX='''+convert(varchar(10),@Corp_BookID1)+''' and ASSETINDEX in (select ASSETINDEX from FA00100 where ASSETID=''' + @AssetID + ''' and ASSETIDSUF='''+convert(varchar(10),@AssetSufix)+''')'  set @MaxCountParam = N'@Reslt int output'   EXEC sp_executesql @SQL_Statement, @MaxCountParam, @Reslt= @Reslt1 output   if @Reslt1=0   begin   set @OutReslt=3   DEALLOCATE Cur_Asset   return  @OutReslt   end   END   FETCH NEXT FROM Cur_Asset INTO @AssetID,@AssetSufix   END   DEALLOCATE Cur_Asset   END   
GO
GRANT EXECUTE ON  [dbo].[FA_Asset_Group_Transfer_Validation] TO [DYNGRP]
GO
