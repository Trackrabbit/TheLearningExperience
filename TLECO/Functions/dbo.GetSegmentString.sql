SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO
 CREATE FUNCTION [dbo].[GetSegmentString](@SEGMENTNO INTEGER, @ACTDESCR VARCHAR(50)) RETURNS VARCHAR(50) AS BEGIN  DECLARE   @FIRST               VARCHAR(50)='',  @SECOND              VARCHAR(50)='',  @THIRD               VARCHAR(50)='',  @FORTH               VARCHAR(50)='',  @FIFTH               VARCHAR(50)='',  @SIXTH               VARCHAR(50)='',  @SEVENTH             VARCHAR(50)='',  @EIGHT               VARCHAR(50)='',  @NINTH               VARCHAR(50)='',  @TENTH               VARCHAR(50)='',  @RESULTSTRING      VARCHAR(50)='',  @AcctDescSep         VARCHAR(2)=''   SELECT @AcctDescSep = ACSEGSEP FROM DYNAMICS..SY01500 WHERE INTERID=DB_NAME()  SELECT @FIRST=SUBSTRING(@ACTDESCR,1,CASE CHARINDEX(@AcctDescSep,@ACTDESCR) WHEN 0 THEN LEN(@ACTDESCR) ELSE CHARINDEX(@AcctDescSep,@ACTDESCR)-1 END)  IF @SEGMENTNO = 1   BEGIN   SET @RESULTSTRING = @FIRST  RETURN @RESULTSTRING  END   SELECT @ACTDESCR = (SUBSTRING(@ACTDESCR,LEN('['+@FIRST+']'),LEN(@ACTDESCR)))  SELECT @SECOND=SUBSTRING(@ACTDESCR,1,CASE CHARINDEX(@AcctDescSep,@ACTDESCR) WHEN 0 THEN LEN(@ACTDESCR) ELSE CHARINDEX(@AcctDescSep,@ACTDESCR)-1 END)  IF @SEGMENTNO = 2   BEGIN   SET @RESULTSTRING = @SECOND  RETURN @RESULTSTRING  END   SELECT @ACTDESCR = (SUBSTRING(@ACTDESCR,LEN('['+@SECOND+']'),LEN(@ACTDESCR)))  SELECT @THIRD=SUBSTRING(@ACTDESCR,1,CASE CHARINDEX(@AcctDescSep,@ACTDESCR) WHEN 0 THEN LEN(@ACTDESCR) ELSE CHARINDEX(@AcctDescSep,@ACTDESCR)-1 END)  IF @SEGMENTNO = 3   BEGIN   SET @RESULTSTRING = @THIRD  RETURN @RESULTSTRING  END   SELECT @ACTDESCR = (SUBSTRING(@ACTDESCR,LEN('['+@THIRD+']'),LEN(@ACTDESCR)))  SELECT @FORTH=SUBSTRING(@ACTDESCR,1,CASE CHARINDEX(@AcctDescSep,@ACTDESCR) WHEN 0 THEN LEN(@ACTDESCR) ELSE CHARINDEX(@AcctDescSep,@ACTDESCR)-1 END)  IF @SEGMENTNO = 4   BEGIN   SET @RESULTSTRING = @FORTH  RETURN @RESULTSTRING  END   SELECT @ACTDESCR = (SUBSTRING(@ACTDESCR,LEN('['+@FORTH+']'),LEN(@ACTDESCR)))  SELECT @FIFTH=SUBSTRING(@ACTDESCR,1,CASE CHARINDEX(@AcctDescSep,@ACTDESCR) WHEN 0 THEN LEN(@ACTDESCR) ELSE CHARINDEX(@AcctDescSep,@ACTDESCR)-1 END)  IF @SEGMENTNO = 5   BEGIN   SET @RESULTSTRING = @FIFTH  RETURN @RESULTSTRING  END   SELECT @ACTDESCR = (SUBSTRING(@ACTDESCR,LEN('['+@FIFTH+']'),LEN(@ACTDESCR)))  SELECT @SIXTH=SUBSTRING(@ACTDESCR,1,CASE CHARINDEX(@AcctDescSep,@ACTDESCR) WHEN 0 THEN LEN(@ACTDESCR) ELSE CHARINDEX(@AcctDescSep,@ACTDESCR)-1 END)  IF @SEGMENTNO = 6   BEGIN   SET @RESULTSTRING = @SIXTH  RETURN @RESULTSTRING  END   SELECT @ACTDESCR = (SUBSTRING(@ACTDESCR,LEN('['+@SIXTH+']'),LEN(@ACTDESCR)))  SELECT @SEVENTH=SUBSTRING(@ACTDESCR,1,CASE CHARINDEX(@AcctDescSep,@ACTDESCR) WHEN 0 THEN LEN(@ACTDESCR) ELSE CHARINDEX(@AcctDescSep,@ACTDESCR)-1 END)  IF @SEGMENTNO = 7   BEGIN   SET @RESULTSTRING = @SEVENTH  RETURN @RESULTSTRING  END   SELECT @ACTDESCR = (SUBSTRING(@ACTDESCR,LEN('['+@SEVENTH+']'),LEN(@ACTDESCR)))  SELECT @EIGHT=SUBSTRING(@ACTDESCR,1,CASE CHARINDEX(@AcctDescSep,@ACTDESCR) WHEN 0 THEN LEN(@ACTDESCR) ELSE CHARINDEX(@AcctDescSep,@ACTDESCR)-1 END)  IF @SEGMENTNO = 8   BEGIN   SET @RESULTSTRING = @EIGHT  RETURN @RESULTSTRING  END   SELECT @ACTDESCR = (SUBSTRING(@ACTDESCR,LEN('['+@EIGHT+']'),LEN(@ACTDESCR)))  SELECT @NINTH=SUBSTRING(@ACTDESCR,1,CASE CHARINDEX(@AcctDescSep,@ACTDESCR) WHEN 0 THEN LEN(@ACTDESCR) ELSE CHARINDEX(@AcctDescSep,@ACTDESCR)-1 END)  IF @SEGMENTNO = 9   BEGIN   SET @RESULTSTRING = @NINTH  RETURN @RESULTSTRING  END   SELECT @ACTDESCR = (SUBSTRING(@ACTDESCR,LEN('['+@NINTH+']'),LEN(@ACTDESCR)))  SELECT @TENTH=SUBSTRING(@ACTDESCR,1,LEN(@ACTDESCR))  SET @RESULTSTRING = @TENTH  RETURN @RESULTSTRING END    
GO
GRANT EXECUTE ON  [dbo].[GetSegmentString] TO [DYNGRP]
GO
