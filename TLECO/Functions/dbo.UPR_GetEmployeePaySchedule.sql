SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO
 CREATE FUNCTION [dbo].[UPR_GetEmployeePaySchedule] (  @EmployeeID varchar(15), @Frequency int, @OrderByColumn1 varchar(15),  @OrderByColumn2 varchar(15),  @OrderByColumn3 varchar(15),  @OrderByColumn4 varchar(15),  @OrderByColumn5 varchar(15) ) RETURNS varchar(15) AS BEGIN  DECLARE @PaySchedule varchar(15)  SELECT @PaySchedule=Pay_Schedule  FROM (  SELECT TOP 1 UPR42100.Pay_Schedule AS Pay_Schedule,   CASE @OrderByColumn1  WHEN 'DEPRTMNTMATCH' THEN CASE WHEN (UPR00100.DEPRTMNT = UPR42103.DEPRTMNT) THEN 0 ELSE 1 END  WHEN 'JOBTITLEMATCH' THEN CASE WHEN (UPR00100.JOBTITLE = UPR42104.JOBTITLE) THEN 0 ELSE 1 END   WHEN 'EMPLCLASMATCH' THEN CASE WHEN (UPR00100.EMPLCLAS = UPR42105.EMPLCLAS) THEN 0 ELSE 1 END  WHEN 'LOCATNIDMATCH' THEN CASE WHEN (UPR00100.LOCATNID = UPR42102.LOCATNID) THEN 0 ELSE 1 END  WHEN 'EMPLOYIDMATCH' THEN CASE WHEN (UPR00100.EMPLOYID = UPR42106.EMPLOYID) THEN 0 ELSE 1 END  END AS OrderByColumn1,  CASE @OrderByColumn2  WHEN 'DEPRTMNTMATCH' THEN CASE WHEN (UPR00100.DEPRTMNT = UPR42103.DEPRTMNT) THEN 0 ELSE 1 END  WHEN 'JOBTITLEMATCH' THEN CASE WHEN (UPR00100.JOBTITLE = UPR42104.JOBTITLE) THEN 0 ELSE 1 END   WHEN 'EMPLCLASMATCH' THEN CASE WHEN (UPR00100.EMPLCLAS = UPR42105.EMPLCLAS) THEN 0 ELSE 1 END  WHEN 'LOCATNIDMATCH' THEN CASE WHEN (UPR00100.LOCATNID = UPR42102.LOCATNID) THEN 0 ELSE 1 END  WHEN 'EMPLOYIDMATCH' THEN CASE WHEN (UPR00100.EMPLOYID = UPR42106.EMPLOYID) THEN 0 ELSE 1 END  END AS OrderByColumn2,  CASE @OrderByColumn3  WHEN 'DEPRTMNTMATCH' THEN CASE WHEN (UPR00100.DEPRTMNT = UPR42103.DEPRTMNT) THEN 0 ELSE 1 END  WHEN 'JOBTITLEMATCH' THEN CASE WHEN (UPR00100.JOBTITLE = UPR42104.JOBTITLE) THEN 0 ELSE 1 END   WHEN 'EMPLCLASMATCH' THEN CASE WHEN (UPR00100.EMPLCLAS = UPR42105.EMPLCLAS) THEN 0 ELSE 1 END  WHEN 'LOCATNIDMATCH' THEN CASE WHEN (UPR00100.LOCATNID = UPR42102.LOCATNID) THEN 0 ELSE 1 END  WHEN 'EMPLOYIDMATCH' THEN CASE WHEN (UPR00100.EMPLOYID = UPR42106.EMPLOYID) THEN 0 ELSE 1 END  END AS OrderByColumn3,  CASE @OrderByColumn4  WHEN 'DEPRTMNTMATCH' THEN CASE WHEN (UPR00100.DEPRTMNT = UPR42103.DEPRTMNT) THEN 0 ELSE 1 END  WHEN 'JOBTITLEMATCH' THEN CASE WHEN (UPR00100.JOBTITLE = UPR42104.JOBTITLE) THEN 0 ELSE 1 END   WHEN 'EMPLCLASMATCH' THEN CASE WHEN (UPR00100.EMPLCLAS = UPR42105.EMPLCLAS) THEN 0 ELSE 1 END  WHEN 'LOCATNIDMATCH' THEN CASE WHEN (UPR00100.LOCATNID = UPR42102.LOCATNID) THEN 0 ELSE 1 END  WHEN 'EMPLOYIDMATCH' THEN CASE WHEN (UPR00100.EMPLOYID = UPR42106.EMPLOYID) THEN 0 ELSE 1 END  END AS OrderByColumn4,  CASE @OrderByColumn5  WHEN 'DEPRTMNTMATCH' THEN CASE WHEN (UPR00100.DEPRTMNT = UPR42103.DEPRTMNT) THEN 0 ELSE 1 END  WHEN 'JOBTITLEMATCH' THEN CASE WHEN (UPR00100.JOBTITLE = UPR42104.JOBTITLE) THEN 0 ELSE 1 END   WHEN 'EMPLCLASMATCH' THEN CASE WHEN (UPR00100.EMPLCLAS = UPR42105.EMPLCLAS) THEN 0 ELSE 1 END  WHEN 'LOCATNIDMATCH' THEN CASE WHEN (UPR00100.LOCATNID = UPR42102.LOCATNID) THEN 0 ELSE 1 END  WHEN 'EMPLOYIDMATCH' THEN CASE WHEN (UPR00100.EMPLOYID = UPR42106.EMPLOYID) THEN 0 ELSE 1 END  END AS OrderByColumn5  FROM UPR42100  LEFT OUTER JOIN UPR42102 ON UPR42100.Pay_Schedule = UPR42102.Pay_Schedule  LEFT OUTER JOIN UPR42103 ON UPR42100.Pay_Schedule = UPR42103.Pay_Schedule  LEFT OUTER JOIN UPR42104 ON UPR42100.Pay_Schedule = UPR42104.Pay_Schedule  LEFT OUTER JOIN UPR42105 ON UPR42100.Pay_Schedule = UPR42105.Pay_Schedule  LEFT OUTER JOIN UPR42106 ON UPR42100.Pay_Schedule = UPR42106.Pay_Schedule  LEFT OUTER JOIN UPR42110 ON UPR42100.Pay_Schedule = UPR42110.Pay_Schedule  LEFT OUTER JOIN UPR00100 ON UPR42102.LOCATNID = UPR00100.LOCATNID   OR UPR42103.DEPRTMNT = UPR00100.DEPRTMNT  OR UPR42104.JOBTITLE = UPR00100.JOBTITLE  OR UPR42105.EMPLCLAS = UPR00100.EMPLCLAS  OR UPR42106.EMPLOYID = UPR00100.EMPLOYID  WHERE UPR00100.EMPLOYID = @EmployeeID AND UPR42100.PAYPEROD = @Frequency  ORDER BY OrderByColumn1, OrderByColumn2, OrderByColumn3, OrderByColumn4, OrderByColumn5) AS A  RETURN @PaySchedule END   
GO
GRANT EXECUTE ON  [dbo].[UPR_GetEmployeePaySchedule] TO [DYNGRP]
GO
