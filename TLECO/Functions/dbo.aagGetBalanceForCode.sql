SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO
 CREATE FUNCTION [dbo].[aagGetBalanceForCode] ( @aaBudgetID INTEGER , @aaCodeSequence INTEGER , @ACTINDX INTEGER , @YEAR1 SMALLINT, @aaRange SMALLINT ) RETURNS FLOAT AS  BEGIN DECLARE @RESULT FLOAT DECLARE @TEMPTABLE  TABLE ( aaFiscalPeriod INTEGER, PERDBLNC NUMERIC(19,5), DEX_ROW_ID INT )  IF @ACTINDX <=0 OR LEN(RTRIM(LTRIM(STR(@ACTINDX)))) = 0 BEGIN INSERT INTO @TEMPTABLE  SELECT aaFiscalPeriod ,ISNULL(Balance,0) AS PERDBLNC,DEX_ROW_ID FROM AAG00904 WHERE aaBudgetID = @aaBudgetID AND  aaCodeSequence = @aaCodeSequence AND aaActualPriliminary = 0 ORDER BY aaFiscalPeriod  END  ELSE IF @aaRange = 0 or LEN(RTRIM(LTRIM(STR(@aaRange)))) = 0 BEGIN INSERT INTO @TEMPTABLE  SELECT aaFiscalPeriod, ISNULL(Balance,0)  AS PERDBLNC,DEX_ROW_ID FROM AAG00905 WHERE aaBudgetID = @aaBudgetID AND  aaCodeSequence = @aaCodeSequence AND ACTINDX = @ACTINDX AND aaActualPriliminary = 0  ORDER BY aaFiscalPeriod  END ELSE   BEGIN INSERT INTO @TEMPTABLE  SELECT aaFiscalPeriod, ISNULL(SUM(Balance),0) AS PERDBLNC,0 AS DEX_ROW_ID FROM AAG00905 WHERE aaBudgetID = @aaBudgetID AND aaCodeSequence = @aaCodeSequence AND aaActualPriliminary = 0  GROUP BY aaFiscalPeriod  ORDER BY aaFiscalPeriod  END SELECT @RESULT = SUM(PERDBLNC) FROM @TEMPTABLE  RETURN @RESULT END    
GO
GRANT EXECUTE ON  [dbo].[aagGetBalanceForCode] TO [DYNGRP]
GO
