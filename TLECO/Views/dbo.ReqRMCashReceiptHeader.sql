SET QUOTED_IDENTIFIER OFF
GO
SET ANSI_NULLS ON
GO
CREATE VIEW [dbo].[ReqRMCashReceiptHeader] AS 
select  
	1 "TrxState", -- WORK  
	RM10201.CUSTNMBR,  
	NULL "CPRCSTNM",  
	RM10201.DOCNUMBR,  
	CHEKNMBR,  
	CRCARDID,  
	BACHNUMB,  
	BCHSOURC,  
	(SELECT CREATDDT FROM SY00500 WHERE RM10201.BACHNUMB = SY00500.BACHNUMB AND RM10201.BCHSOURC = SY00500.BCHSOURC) AS BatchCreatedDate,  
	(SELECT TIME1 FROM SY00500 WHERE RM10201.BACHNUMB = SY00500.BACHNUMB AND RM10201.BCHSOURC = SY00500.BCHSOURC) AS BatchCreatedTime,  
	NULL "TRXSORCE",  
	CSHRCTYP,  
	CHEKBKID "CBKIDCRD",  
	RM10201.DOCDATE,  
	NULL "POSTDATE",  
	NULL "PSTUSRID",  
	GLPOSTDT,  
	LSTEDTDT,  
	LSTUSRED,  
	ORTRXAMT,  
	MC020102.ORORGTRX,   
	TRXDSCRN, 
	case when RM10201.CURNCYID = '' then (select FUNLCURR from MC40000) else RM10201.CURNCYID end as CURNCYID, 
	isNULL((select ISOCURRC from DYNAMICS..MC40200 where CURNCYID = RM10201.CURNCYID),(select ISOCURRC from DYNAMICS..MC40200 where CURNCYID in (select FUNLCURR from MC40000))) as 'ISOCURRC',  
	XCHGRATE,  
	EXCHDATE,  
	NULL "VOIDSTTS",  
	NULL "VOIDDATE",  
	RM10201.RMDTYPAL,  
	RM10201.DEX_ROW_ID  
from  
	RM10201 left outer join MC020102 on (RM10201.RMDTYPAL = MC020102.RMDTYPAL   
					and RM10201.DOCNUMBR = MC020102.DOCNUMBR)  
where   
	RM10201.RMDTYPAL = 9  
  
  
union all  
  
select  
	2 "TrxState", -- OPEN  
	RM20101.CUSTNMBR,  
	CPRCSTNM,  
	RM20101.DOCNUMBR,  
	CHEKNMBR,  
	FRTSCHID,  
	BACHNUMB,  
	BCHSOURC,  
	'', --BatchCreatedDate  
	'', --BatchCreatedTime  
	RM20101.TRXSORCE,  
	CSHRCTYP,  
	MSCSCHID,  
	RM20101.DOCDATE,  
	POSTDATE,  
	PSTUSRID,  
	GLPOSTDT,  
	LSTEDTDT,  
	LSTUSRED,  
	ORTRXAMT,  
	MC020102.ORORGTRX,   
	TRXDSCRN, 
    case when RM20101.CURNCYID = '' then (select FUNLCURR from MC40000) else RM20101.CURNCYID end as CURNCYID,  
	isNULL((select ISOCURRC from DYNAMICS..MC40200 where CURNCYID = RM20101.CURNCYID),(select ISOCURRC from DYNAMICS..MC40200 where CURNCYID in (select FUNLCURR from MC40000))) as 'ISOCURRC',  
	XCHGRATE,  
	EXCHDATE,  
	VOIDSTTS,  
	VOIDDATE,  
	RM20101.RMDTYPAL,  
	RM20101.DEX_ROW_ID  
from  
	RM20101 left outer join MC020102 on (RM20101.RMDTYPAL = MC020102.RMDTYPAL   
					and RM20101.DOCNUMBR = MC020102.DOCNUMBR)  
where   
	RM20101.RMDTYPAL = 9  
  
  
union all  
  
select  
	3 "TrxState", -- HISTORY  
	RM30101.CUSTNMBR,  
	CPRCSTNM,  
	RM30101.DOCNUMBR,  
	CHEKNMBR,  
	FRTSCHID,  
	BACHNUMB,  
	BCHSOURC,  
	'', --BatchCreatedDate  
	'', --BatchCreatedTime  
	RM30101.TRXSORCE,  
	CSHRCTYP,  
	MSCSCHID,  
	RM30101.DOCDATE,  
	POSTDATE,  
	PSTUSRID,  
	GLPOSTDT,  
	LSTEDTDT,  
	LSTUSRED,  
	ORTRXAMT,  
	MC020102.ORORGTRX,   
	TRXDSCRN, 
    case when RM30101.CURNCYID = '' then (select FUNLCURR from MC40000) else RM30101.CURNCYID end as CURNCYID,  
	isNULL((select ISOCURRC from DYNAMICS..MC40200 where CURNCYID = RM30101.CURNCYID),(select ISOCURRC from DYNAMICS..MC40200 where CURNCYID in (select FUNLCURR from MC40000))) as 'ISOCURRC', 
	XCHGRATE,  
	EXCHDATE,  
	VOIDSTTS,  
	VOIDDATE,  
	RM30101.RMDTYPAL,  
	RM30101.DEX_ROW_ID  
from  
	RM30101 left outer join MC020102 on (RM30101.RMDTYPAL = MC020102.RMDTYPAL   
					and RM30101.DOCNUMBR = MC020102.DOCNUMBR)  
where   
	RM30101.RMDTYPAL = 9  
GO
GRANT SELECT ON  [dbo].[ReqRMCashReceiptHeader] TO [DYNGRP]
GO
GRANT INSERT ON  [dbo].[ReqRMCashReceiptHeader] TO [DYNGRP]
GO
GRANT DELETE ON  [dbo].[ReqRMCashReceiptHeader] TO [DYNGRP]
GO
GRANT UPDATE ON  [dbo].[ReqRMCashReceiptHeader] TO [DYNGRP]
GO
