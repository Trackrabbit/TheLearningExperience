SET QUOTED_IDENTIFIER OFF
GO
SET ANSI_NULLS ON
GO
 CREATE VIEW [dbo].[CFM40100] AS SELECT TEMP1.VENDORID, PONUMBER, POSTATUS, DATE as DOCDATE, TEMP1.PYMTRMID, COALESCE(DISGRPER,0) AS DISGRPER,  COALESCE(DUEGRPER,0) AS DUEGRPER, SUM(Amount) as Amount, MAX(TEMP1.DEX_ROW_ID) AS DEX_ROW_ID  FROM   (SELECT POP10100.VENDORID, PONUMBER, POSTATUS, CASE WHEN POP10100.PYMTRMID = ' ' THEN PM00200.PYMTRMID ELSE POP10100.PYMTRMID END AS PYMTRMID,  CASE WHEN REQDATE = '01/01/1900' THEN DOCDATE ELSE REQDATE   END AS DATE,   (-TRDISAMT + FRTAMNT + MSCCHAMT + TAXAMNT) AS Amount, POP10100.DEX_ROW_ID    FROM  POP10100 INNER JOIN  PM00200 ON PM00200.VENDORID = POP10100.VENDORID    WHERE   POSTATUS <> 5 AND POSTATUS <> 6 AND (-TRDISAMT + FRTAMNT + MSCCHAMT + TAXAMNT) <> 0   UNION ALL    SELECT POP10110.VENDORID, POP10110.PONUMBER, POP10100.POSTATUS,    (CASE WHEN POP10100.PYMTRMID = ' ' THEN PM00200.PYMTRMID ELSE POP10100.PYMTRMID END) AS PYMTRMID,    (CASE WHEN POP10110.REQDATE = '01/01/1900' THEN POP10100.DOCDATE ELSE POP10110.REQDATE   END) AS DATE,    (CAST((((QTYORDER - QTYCANCE) * UNITCOST) - (CASE WHEN POP10110.XCHGRATE = 0 THEN OPOSTSUB    WHEN POP10110.RATECALC = 0 THEN OPOSTSUB * POP10110.XCHGRATE ELSE POP10110.OPOSTSUB / POP10110.XCHGRATE    END)) AS MONEY )) AS Amount, POP10110.DEX_ROW_ID    FROM POP10110 INNER JOIN POP10100 ON POP10100.PONUMBER = POP10110.PONUMBER and LineNumber <> 0   INNER JOIN PM00200 ON PM00200.VENDORID = POP10100.VENDORID    WHERE   POLNESTA <> 5  AND POLNESTA <> 6)  AS TEMP1   LEFT JOIN PM00200 ON TEMP1.VENDORID = PM00200.VENDORID   GROUP BY TEMP1.VENDORID, PONUMBER, POSTATUS, DATE, TEMP1.PYMTRMID, COALESCE(DISGRPER,0), COALESCE(DUEGRPER,0)     
GO
GRANT SELECT ON  [dbo].[CFM40100] TO [DYNGRP]
GO
GRANT INSERT ON  [dbo].[CFM40100] TO [DYNGRP]
GO
GRANT DELETE ON  [dbo].[CFM40100] TO [DYNGRP]
GO
GRANT UPDATE ON  [dbo].[CFM40100] TO [DYNGRP]
GO
