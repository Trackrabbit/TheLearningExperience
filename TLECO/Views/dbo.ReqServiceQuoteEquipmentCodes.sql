SET QUOTED_IDENTIFIER OFF
GO
SET ANSI_NULLS ON
GO
-- Service Quote Equipment Code Line view joining SVC00201, SVC30201 and aggregating data from SVC00202 and SVC30202 
 
CREATE VIEW [dbo].[ReqServiceQuoteEquipmentCodes] AS 
SELECT SVC00201.CALLNBR 
      ,SVC00201.LNITMSEQ 
	  ,(select SERLNMBR from SVC00300 where SVC00300.EQUIPID = SVC00201.EQUIPID) "SERLNMBR" 
      ,SVC00201.ITEMNMBR 
      ,PROBCDE 
      ,CAUSECDE 
      ,RPRCODE 
	  ,SVC00202.EQPLINE 
  FROM SVC00201 
	left outer join SVC00202 on ( 
		SVC00201.CALLNBR = SVC00202.CALLNBR and  
		SVC00201.EQUIPID = SVC00202.EQUIPID and  
		SVC00201.ITEMNMBR = SVC00202.ITEMNMBR		 
		) 
  WHERE SVC00201.SRVRECTYPE = 1 
 
union all 
 
SELECT SVC30201.CALLNBR 
      ,SVC30201.LNITMSEQ 
	  ,(select SERLNMBR from SVC00300 where SVC00300.EQUIPID = SVC30201.EQUIPID) "SERLNMBR" 
      ,SVC30201.ITEMNMBR 
      ,PROBCDE 
      ,CAUSECDE 
      ,RPRCODE 
	  ,SVC30202.EQPLINE 
  FROM SVC30201 
	left outer join SVC30202 on ( 
		SVC30201.CALLNBR = SVC30202.CALLNBR and  
		SVC30201.EQUIPID = SVC30202.EQUIPID and  
		SVC30201.ITEMNMBR = SVC30202.ITEMNMBR		 
		) 
  WHERE SVC30201.SRVRECTYPE = 1 
 
 
GO
GRANT SELECT ON  [dbo].[ReqServiceQuoteEquipmentCodes] TO [DYNGRP]
GO
GRANT INSERT ON  [dbo].[ReqServiceQuoteEquipmentCodes] TO [DYNGRP]
GO
GRANT DELETE ON  [dbo].[ReqServiceQuoteEquipmentCodes] TO [DYNGRP]
GO
GRANT UPDATE ON  [dbo].[ReqServiceQuoteEquipmentCodes] TO [DYNGRP]
GO
