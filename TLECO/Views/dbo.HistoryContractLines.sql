SET QUOTED_IDENTIFIER OFF
GO
SET ANSI_NULLS ON
GO
CREATE VIEW [dbo].[HistoryContractLines] AS select 'Contract Record Type' = dbo.FS_FUNC_Contract_Record_Type(['SVC_Contract_Line_HIST'].[CONSTS]), rtrim(['SVC_Contract_Line_HIST'].[CONTNBR]) as 'Contract Number', ['SVC_Contract_Line_HIST'].[LNSEQNBR] as 'Line SEQ Number', rtrim(['SVC_Contract_Line_HIST'].[ADRSCODE]) as 'Address Code', ['SVC_Contract_Line_HIST'].[QUANTITY] as 'QTY', rtrim(['SVC_Contract_Line_HIST'].[ITEMNMBR]) as 'Item Number', ['SVC_Contract_Line_HIST'].[EQUIPID] as 'Equipment ID', rtrim(['SVC_Contract_Line_HIST'].[SERLNMBR]) as 'Serial Number', ['SVC_Contract_Line_HIST'].[BILSTRT] as 'Bill Start', ['SVC_Contract_Line_HIST'].[BILEND] as 'Bill End', ['SVC_Contract_Line_HIST'].[BILLNGTH] as 'Bill Length', 'Bill Period' = dbo.FS_FUNC_Bill_Period(['SVC_Contract_Line_HIST'].[BILPRD]), ['SVC_Contract_Line_HIST'].[TOTAL] as 'Total', rtrim(['SVC_Contract_Line_HIST'].[CNTTYPE]) as 'Contract Type', rtrim(['RM Customer MSTR'].[CUSTNMBR]) as 'Customer ID', rtrim(['SVC_Contract_Line_HIST'].[SRVTYPE]) as 'Service Type', ['SVC_Contract_Line_HIST'].[TOTBIL] as 'Total Billed', 'Pre Paid' = dbo.DYN_FUNC_Boolean_All(['SVC_Contract_Line_HIST'].[PREPAID]), ['SVC_Contract_Line_HIST'].[BILONDY] as 'Bill On Day', 'Billing Cycle' = dbo.FS_FUNC_Billing_Cycle(['SVC_Contract_Line_HIST'].[BILCYC]), ['SVC_Contract_Line_HIST'].[STRTDATE] as 'Start Date', ['SVC_Contract_Line_HIST'].[ENDDATE] as 'End Date', ['SVC_Contract_Line_HIST'].[Unit_Cost_Total] as 'Unit Cost Total', 'SVC_Liability_Type' = dbo.FS_FUNC_SVC_Liability_Type(['SVC_Contract_Line_HIST'].[SVC_Liability_Type]), ['SVC_Contract_Line_HIST'].[SVC_Contract_Version] as 'SVC_Contract_Version',  ['SVC_Contract_Line_HIST'].[ACTCAL] as 'Actual Number of Calls', ['SVC_Contract_Line_HIST'].[Amount_To_Invoice] as 'Amount To Invoice', 'Auto Renewing' = dbo.DYN_FUNC_Boolean_All(['SVC_Contract_Line_HIST'].[AUTOREN]), 'Bill For Retainer' = dbo.DYN_FUNC_Boolean_All(['SVC_Contract_Line_HIST'].[BILFRRET]), rtrim(['SVC_Contract_Line_HIST'].[Bill_To_Customer]) as 'Bill To Customer ID', rtrim(['RM Customer MSTR2'].[CUSTNAME]) as 'Bill To Customer Name', 'Billing Status' = dbo.FS_FUNC_Billing_Status(['SVC_Contract_Line_HIST'].[BILSTAT]), ['SVC_Contract_Line_HIST'].[BLKTIM] as 'Blocked Time', rtrim(['SVC_Contract_Line_HIST'].[COMMCODE]) as 'Commission Code', ['SVC_Contract_Line_HIST'].[COMDLRAM] as 'Commission Dollar Amount', ['SVC_Contract_Line_HIST'].[COMPRCNT] as 'Commission Percent', ['SVC_Contract_Line_HIST'].[CNFGLVL] as 'Config Level', rtrim(['SVC_Contract_Line_HIST'].[CONFGREF]) as 'Config Reference', ['SVC_Contract_Line_HIST'].[CNFGSEQ] as 'Config Sequence', rtrim(['SVC_Contract_Line_HIST'].[CONTACT]) as 'Contact', ['SVC_Contract_Line_HIST'].[Contract_Coverage_Period_1] as 'Contract Coverage Periods End', ['SVC_Contract_Line_HIST'].[CNTCOVPD_1] as 'Contract Coverage Periods Start', ['SVC_Contract_Line_HIST'].[Contract_Length] as 'Contract Length', rtrim(['SVC_Contract_Line_HIST'].[Contract_Line_Status]) as 'Contract Line Status', 'Contract Period' = dbo.FS_FUNC_Contract_Period(['SVC_Contract_Line_HIST'].[Contract_Period]), 'Contract Price Overridden' = dbo.DYN_FUNC_Boolean_All(['SVC_Contract_Line_HIST'].[CNTPRCOVR]), rtrim(['SVC_Contract_Line_HIST'].[Contract_Renewal_Contact]) as 'Contract Renewal Contact', rtrim(['SVC_Contract_Line_HIST'].[Contract_Response_Time]) as 'Contract Response Time', ['SVC_Contract_Line_HIST'].[Contract_Transfer_Date] as 'Contract Transfer Date', 'Contract Transfer Status' = dbo.FS_FUNC_Contract_Transfer_Status(['SVC_Contract_Line_HIST'].[Contract_Transfer_Status]), rtrim(['SVC_Contract_Line_HIST'].[COUNTRY]) as 'Country', rtrim(['SVC_Contract_Line_HIST'].[CURNCYID]) as 'Currency ID', ['SVC_Contract_Line_HIST'].[CURRNIDX] as 'Currency Index', rtrim(['RM Customer MSTR'].[CUSTNAME]) as 'Customer Name', 'Decimal Places' = dbo.DYN_FUNC_Decimal_Places_QTYS(['SVC_Contract_Line_HIST'].[DECPLACS]), ['SVC_Contract_Line_HIST'].[DENXRATE] as 'Denomination Exchange Rate', rtrim(['SVC_Contract_Line_HIST'].[DSCRIPTN]) as 'Description', ['SVC_Contract_Line_HIST'].[DSCDLRAM] as 'Discount Dollar Amount', ['SVC_Contract_Line_HIST'].[DSCPCTAM]/100.00 as 'Discount Percent Amount', ['SVC_Contract_Line_HIST'].[ENTDTE] as 'Entry Date', ['SVC_Contract_Line_HIST'].[ENTTME] as 'Entry Time', ['SVC_Contract_Line_HIST'].[EXCHDATE] as 'Exchange Date', ['SVC_Contract_Line_HIST'].[XCHGRATE] as 'Exchange Rate', rtrim(['SVC_Contract_Line_HIST'].[EXGTBLID]) as 'Exchange Table ID', ['SVC_Contract_Line_HIST'].[EXPNDATE] as 'Expiration Date', ['SVC_Contract_Line_HIST'].[FRSTBLDTE] as 'First Bill Date', ['SVC_Contract_Line_HIST'].[FRZEND] as 'Frozen End', ['SVC_Contract_Line_HIST'].[FRXSTRT] as 'Frozen Start', ['SVC_Contract_Line_HIST'].[ISMCTRX] as 'IS MC Trx', ['SVC_Contract_Line_HIST'].[Invoiced_Amount] as 'Invoiced Amount', ['SVC_Contract_Line_HIST'].[LABPCT] as 'Labor Pct', ['SVC_Contract_Line_HIST'].[Last_Amount_Billed] as 'Last Amount Billed', ['SVC_Contract_Line_HIST'].[LSTBLDTE] as 'Last Bill Date', ['SVC_Contract_Line_HIST'].[Last_Liability_Date] as 'Last Liability Date', ['SVC_Contract_Line_HIST'].[Liability_Amount] as 'Liability Amount', ['SVC_Contract_Line_HIST'].[Liability_Months] as 'Liability Months', 'Liability Reduction' = dbo.DYN_FUNC_Boolean_All(['SVC_Contract_Line_HIST'].[Liabiltiy_Reduction]), rtrim(['SVC_Contract_Line_HIST'].[Location_Segment]) as 'Location Segment',  ['SVC_Contract_Line_HIST'].[MCTRXSTT] as 'MC Transaction State', rtrim(['SVC_Contract_Line_HIST'].[MSTCNTRCT]) as 'Master Contract Number', ['SVC_Contract_Line_HIST'].[MAXBILL] as 'Max Billable', ['SVC_Contract_Line_HIST'].[MAXBIL] as 'Max Billable Call', ['SVC_Contract_Line_HIST'].[NBRCAL] as 'Max Number of Calls', ['SVC_Contract_Line_HIST'].[MINBIL] as 'Min Billable Call', ['SVC_Contract_Line_HIST'].[MISCPCT] as 'Misc Pct', ['SVC_Contract_Line_HIST'].[New_Invoice_Amount] as 'New Invoice Amount', ['SVC_Contract_Line_HIST'].[NXTBLDTE] as 'Next Bill Date', ['SVC_Contract_Line_HIST'].[Next_Liability_Date] as 'Next Liability Date', ['SVC_Contract_Line_HIST'].[NOTEINDX] as 'Note Index', ['SVC_Contract_Line_HIST'].[NUMOFINV] as 'Number of Invoices', ['SVC_Contract_Line_HIST'].[Orig_Amount_To_Invoice] as 'Originating Amount To Invoice', ['SVC_Contract_Line_HIST'].[ORCOMAMT] as 'Originating Commission Dollar Amount', ['SVC_Contract_Line_HIST'].[ORDDLRAT] as 'Originating Discount Dollar Amount', ['SVC_Contract_Line_HIST'].[OrigDiscountNext] as 'Originating Discount Next', ['SVC_Contract_Line_HIST'].[OrigDiscountReceived] as 'Originating Discount Recognized', ['SVC_Contract_Line_HIST'].[OrigDiscountRemaining] as 'Originating Discount Remaining', ['SVC_Contract_Line_HIST'].[Orig_Invoiced_Amount] as 'Originating Invoiced Amount', ['SVC_Contract_Line_HIST'].[ORIGINVOICEDDISC] as 'Originating Invoiced Discount', ['SVC_Contract_Line_HIST'].[ORIGLASTAmountBilled] as 'Originating Last Amount Billed', ['SVC_Contract_Line_HIST'].[Orig_Liability_Amount] as 'Originating Liability Amount', ['SVC_Contract_Line_HIST'].[Originating_Max_Billable] as 'Originating Max Billable', ['SVC_Contract_Line_HIST'].[ORIGMAXBIL] as 'Originating Max Billable Call', ['SVC_Contract_Line_HIST'].[ORIGMINBIL] as 'Originating Min Billable Call', ['SVC_Contract_Line_HIST'].[ORIGMONTHPRICE] as 'Originating Monthly Price', ['SVC_Contract_Line_HIST'].[OrigNewInvoiceAmount] as 'Originating New Invoice Amount', ['SVC_Contract_Line_HIST'].[ORIGRETNAGAM] as 'Originating Retainage Amount', ['SVC_Contract_Line_HIST'].[ORIGRTNBILLD] as 'Originating Retainage Billed', ['SVC_Contract_Line_HIST'].[ORIGTOTAL] as 'Originating Service Total', ['SVC_Contract_Line_HIST'].[ORTAXAMT] as 'Originating Tax Amount', ['SVC_Contract_Line_HIST'].[ORIGTOTBIL] as 'Originating Total Billed', ['SVC_Contract_Line_HIST'].[OrigTotLiabilityAmount] as 'Originating Total Liability Amount', ['SVC_Contract_Line_HIST'].[OrigTotLiabBilled] as 'Originating Total Liability Billed', ['SVC_Contract_Line_HIST'].[Originating_Total_Unit] as 'Originating Total Unit', ['SVC_Contract_Line_HIST'].[ORIGTOTVALCAL] as 'Originating Total Value of Calls', ['SVC_Contract_Line_HIST'].[ORUNTCST] as 'Originating Unit Cost', ['SVC_Contract_Line_HIST'].[ORIGUNITCOSTTOTAL] as 'Originating Unit Cost Total', ['SVC_Contract_Line_HIST'].[ORIGVALTIM] as 'Originating Value of Time', ['SVC_Contract_Line_HIST'].[PMLABPCT] as 'PM Labor Pct', ['SVC_Contract_Line_HIST'].[PMMSCPCT] as 'PM Misc Pct', ['SVC_Contract_Line_HIST'].[PMPRTPCT] as 'PM Part Pct', ['SVC_Contract_Line_HIST'].[PARTPCT] as 'Part Pct', rtrim(['SVC_Contract_Line_HIST'].[PRICSHED]) as 'Price Schedule', ['SVC_Contract_Line_HIST'].[priorityLevel] as 'priorityLevel', rtrim(['SVC_Contract_Line_HIST'].[PORDNMBR]) as 'Purchase Order Number', ['SVC_Contract_Line_HIST'].[RATECALC] as 'Rate Calc Method', rtrim(['SVC_Contract_Line_HIST'].[RATETPID]) as 'Rate Type ID', ['SVC_Contract_Line_HIST'].[RETNAGAM] as 'Retainage Amount', ['SVC_Contract_Line_HIST'].[RTNBILLD] as 'Retainage Billed', rtrim(['SVC_Contract_Line_HIST'].[SVC_Bill_To_Address_Code]) as 'SVC Bill To Address Code', ['SVC_Contract_Line_HIST'].[SVC_Contract_Signed] as 'SVC_Contract_Signed', ['SVC_Contract_Line_HIST'].[SVC_Discount_Next] as 'SVC Discount Next', ['SVC_Contract_Line_HIST'].[SVC_Discount_Recognized] as 'SVC Discount Recognized', ['SVC_Contract_Line_HIST'].[SVC_Discount_Remaining] as 'SVC Discount Remaining', rtrim(['SVC_Contract_Line_HIST'].[SVC_FO_ID]) as 'SVC FO ID', ['SVC_Contract_Line_HIST'].[SVC_Invoiced_Discount] as 'SVC Invoiced Discount', ['SVC_Contract_Line_HIST'].[SVC_Monthly_Price] as 'SVC Monthly_Price', ['SVC_Contract_Line_HIST'].[SVC_PM_Day] as 'SVC PM Day', 'SVC PM Month' = dbo.FS_FUNC_SVC_PM_Month(['SVC_Contract_Line_HIST'].[SVC_PM_Date]), rtrim(['SVC_Contract_Line_HIST'].[RETTYPE]) as 'SVC Return Type', rtrim(['SVC_Contract_Line_HIST'].[SLPRSNID]) as 'Salesperson ID', rtrim(['SVC_Contract_Line_HIST'].[PRCSTAT]) as 'Status of Price', ['SVC_Contract_Line_HIST'].[TAXAMNT] as 'Tax Amount', rtrim(['SVC_Contract_Line_HIST'].[TAXEXMT1]) as 'Tax Exempt 1', rtrim(['SVC_Contract_Line_HIST'].[TAXEXMT2]) as 'Tax Exempt 2', rtrim(['SVC_Contract_Line_HIST'].[TAXSCHID]) as 'Tax Schedule ID', ['SVC_Contract_Line_HIST'].[TIME1] as 'Time', ['SVC_Contract_Line_HIST'].[Total_Liability_Amount] as 'Total Liability Amount', ['SVC_Contract_Line_HIST'].[Total_Liability_Billed] as 'Total Liability Billed', ['SVC_Contract_Line_HIST'].[Total_Unit] as 'Total Unit', ['SVC_Contract_Line_HIST'].[TOTVALCAL] as 'Total Value of Calls', rtrim(['SVC_Contract_Line_HIST'].[UOFM]) as 'U Of M', ['SVC_Contract_Line_HIST'].[UNITCOST] as 'Unit Cost', 'Use Coverage Period' = dbo.DYN_FUNC_Boolean_All(['SVC_Contract_Line_HIST'].[USECVPD_1]), ['SVC_Contract_Line_HIST'].[VALTIM] as 'Value of Time', rtrim(['SVC_Contract_Line_HIST'].[VENDORID]) as 'Vendor ID', ['SVC_Contract_Line_HIST'].[VIEWMODE] as 'View Mode',  'Customer ID For Drillback' = 'dgpp://DGPB/?Db=&Srv=TLEFLSQL3&Cmp=TLECO&Prod=0' +dbo.dgppCustomerID(1,['RM Customer MSTR'].[CUSTNMBR] ), 'Equipment ID For Drillback' = 'dgpp://DGPB/?Db=&Srv=TLEFLSQL3&Cmp=TLECO&Prod=949' +dbo.dgppEquipmentID(1,['SVC_Contract_Line_HIST'].[EQUIPID] ), 'Item Number For Drillback' = 'dgpp://DGPB/?Db=&Srv=TLEFLSQL3&Cmp=TLECO&Prod=0' +dbo.dgppItemID(1,['SVC_Contract_Line_HIST'].[ITEMNMBR],'' ), 'Salesperson ID For Drillback' = 'dgpp://DGPB/?Db=&Srv=TLEFLSQL3&Cmp=TLECO&Prod=0' +dbo.dgppSalespersonID(1,['SVC_Contract_Line_HIST'].[SLPRSNID],2 ),  'Vendor ID For Drillback' = 'dgpp://DGPB/?Db=&Srv=TLEFLSQL3&Cmp=TLECO&Prod=0' +dbo.dgppVendorID(1,['SVC_Contract_Line_HIST'].[VENDORID] )        from [SVC30601] as ['SVC_Contract_Line_HIST'] with (NOLOCK) left outer join [RM00101] as ['RM Customer MSTR'] with (NOLOCK) on ['SVC_Contract_Line_HIST'].[CUSTNMBR] = ['RM Customer MSTR'].[CUSTNMBR] left outer join [RM00101] as ['RM Customer MSTR2'] with (NOLOCK) on ['SVC_Contract_Line_HIST'].[Bill_To_Customer] = ['RM Customer MSTR2'].[CUSTNMBR] 
GO
GRANT SELECT ON  [dbo].[HistoryContractLines] TO [DYNGRP]
GO
GRANT INSERT ON  [dbo].[HistoryContractLines] TO [DYNGRP]
GO
GRANT DELETE ON  [dbo].[HistoryContractLines] TO [DYNGRP]
GO
GRANT UPDATE ON  [dbo].[HistoryContractLines] TO [DYNGRP]
GO
GRANT SELECT ON  [dbo].[HistoryContractLines] TO [rpt_customer service rep]
GO
GRANT SELECT ON  [dbo].[HistoryContractLines] TO [rpt_dispatcher]
GO
GRANT SELECT ON  [dbo].[HistoryContractLines] TO [rpt_executive]
GO
GRANT SELECT ON  [dbo].[HistoryContractLines] TO [rpt_project manager]
GO
