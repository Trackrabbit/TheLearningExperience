SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO
 CREATE VIEW [dbo].[popHistoryTransactions] as (  select 0 as 'MKTOPROC',  0 as 'InfoValue',  0 as 'CURRNIDX',   GETDATE() AS 'DOCDATE',  REPLICATE('X', 15) as 'VENDORID',  REPLICATE('X', 65) as 'VENDNAME',  REPLICATE('X', 61) as 'CONTACT',  0 as 'SOURCE',  0 as 'DOCTYPE',  REPLICATE('X', 21) as 'DOCTYNAM',  REPLICATE('X', 21) as 'DOCNUMBR',  REPLICATE('X', 21) as 'Other_Number',  REPLICATE('X', 13) as 'TRXSORCE',  0 as 'CNTRLTYP',  0 as 'DCSTATUS',  0 as 'POSTATUS',  REPLICATE('X', 31) as 'STSDESCR',  9999999999999.99999 as 'DOCAMNT',  REPLICATE('X', 15) as 'CURNCYID',  REPLICATE('X', 15) as 'PRSTADCD',  0 as 'VOIDED',  GETDATE() AS 'PRMDATE',  GETDATE() AS 'REQDATE',  GETDATE() AS 'Workflow_Due_Date',  0 as 'Workflow_Approval_Status',  0 as 'Workflow_Status',  REPLICATE('X', 51) as 'Workflow_Name',  REPLICATE('X', 238) as 'Workflow_Approver',  0 as 'Workflow_Priority',  REPLICATE('X', 238) as 'Workflow_Originator',  0 as 'HOLD',  GETDATE() AS 'DUEDATE',  GETDATE() AS 'DISCDATE',  0 as 'WF_Step_Type',  0 as 'RATECALC',  9999999999999.99999 as 'XCHGRATE',  9999999999999.99999 as 'DENXRATE',  0 as 'Emailed'  where (1 = 0)  UNION ALL  select 0 as 'MKTOPROC',   0 as 'InfoValue',  0 as 'CURRNIDX',  ['Purchase Order History'].[DOCDATE] as 'DOCDATE',  rtrim(['Purchase Order History'].[VENDORID]) as 'VENDORID',  rtrim(['Purchase Order History'].[VENDNAME]) as 'VENDNAME',  ISNULL(rtrim(['Purchase Order History'].[CONTACT]),'') as 'CONTACT',  1 as 'SOURCE',   ['Purchase Order History'].[POTYPE] as 'DOCTYPE',  DOCTYNAM = dbo.DYN_FUNC_PO_Type(['Purchase Order History'].[POTYPE]),  rtrim(['Purchase Order History'].[PONUMBER]) as 'DOCNUMBR',  '' as 'Other_Number',  '' as 'TRXSORCE',  0 as 'CNTRLTYP',  DCSTATUS = 3,  ['Purchase Order History'].[POSTATUS] as 'POSTATUS',  STSDESCR = (rtrim(dbo.DYN_FUNC_PO_Status(['Purchase Order History'].[POSTATUS])) +   (select isnull((select '*' where POSTATUS = 1), ''))),   DOCAMNT = case  when (select((['Purchase Order History'].[ORSUBTOT] - ['Purchase Order History'].[ORTDISAM]) +  ['Purchase Order History'].[ORFRTAMT] + ['Purchase Order History'].[OMISCAMT] +   ['Purchase Order History'].[ORTAXAMT])) > 99999999999999.99999   then 99999999999999.99999   else (select((['Purchase Order History'].[ORSUBTOT] - ['Purchase Order History'].[ORTDISAM]) +  ['Purchase Order History'].[ORFRTAMT] + ['Purchase Order History'].[OMISCAMT] +   ['Purchase Order History'].[ORTAXAMT]))  end,    rtrim(['Purchase Order History'].[CURNCYID]) as 'CURNCYID',   rtrim(['Purchase Order History'].[PRSTADCD]) as 'PRSTADCD',  'VOIDED' = case ['Purchase Order History'].[POSTATUS]  when 1 then 1  else 0  end,  '01-01-1900' as 'PRMDATE',  '01-01-1900' as 'REQDATE',  '01-01-1900' as 'Workflow_Due_Date',  0 as 'Workflow_Approval_Status',  0 as 'Workflow_Status',  '' as Workflow_Name,   '' as Workflow_Approver,  0 as Workflow_Priority ,  '' as Workflow_Originator,  0 as HOLD,  DUEDATE = ['Purchase Order History'].[DUEDATE],  DISCDATE = ['Purchase Order History'].[DISCDATE],  0 as WF_Step_Type,  RATECALC = ['Purchase Order History'].[RATECALC],  XCHGRATE = ['Purchase Order History'].[XCHGRATE],  DENXRATE = ['Purchase Order History'].[DENXRATE],  Emailed = dbo.coIsDocumentEmailed(0,12,1,['Purchase Order History'].[PONUMBER])   from [POP30100] as ['Purchase Order History'] with (NOLOCK)   where ['Purchase Order History'].[POTYPE] between 1 and 4  UNION ALL  select 0 as 'MKTOPROC',   0 as 'InfoValue',  0 as 'CURRNIDX',  ['Purchasing Receipt History'].[receiptdate] as 'DOCDATE',  rtrim(['Purchasing Receipt History'].[VENDORID]) as 'VENDORID',  rtrim(['Purchasing Receipt History'].[VENDNAME]) as 'VENDNAME',  ISNULL((select rtrim(VNDCNTCT) from PM00200 where VENDORID = ['Purchasing Receipt History'].[VENDORID]),'') as 'CONTACT',  2 as 'SOURCE',   ['Purchasing Receipt History'].[POPTYPE] as 'DOCTYPE',  DOCTYNAM = dbo.DYN_FUNC_POP_Type(['Purchasing Receipt History'].[POPTYPE]),  rtrim(['Purchasing Receipt History'].[POPRCTNM]) as 'DOCNUMBR',  rtrim(['Purchasing Receipt History'].[VNDDOCNM]) as 'Other_Number',  ['Purchasing Receipt History'].[TRXSORCE] as 'TRXSORCE',  0 as 'CNTRLTYP',  DCSTATUS = 3,  0 as 'POSTATUS',  '' as 'STSDESCR',   DOCAMNT = dbo.popCalcReceiptTotal(['Purchasing Receipt History'].[ORSUBTOT],  ['Purchasing Receipt History'].[ORTDISAM],  ['Purchasing Receipt History'].[ORFRTAMT],  ['Purchasing Receipt History'].[ORMISCAMT],  ['Purchasing Receipt History'].[ORTAXAMT],  ['Purchasing Receipt History'].[POPTYPE]),   rtrim(['Purchasing Receipt History'].[CURNCYID]) as 'CURNCYID',   '' as 'PRSTADCD',  VOIDED = case ['Purchasing Receipt History'].[VOIDSTTS]  when 1 then 1  else 0  end,  '01-01-1900' as 'PRMDATE',  '01-01-1900' as 'REQDATE',  '01-01-1900' as Workflow_Due_Date,  0 as 'Workflow_Approval_Status',  0 as 'Workflow_Status',  '' as Workflow_Name,   '' as Workflow_Approver,  0 as 'Workflow_Priority',  '' as Workflow_Originator,  0 as HOLD,  DUEDATE = ['Purchasing Receipt History'].[DUEDATE],  DISCDATE = ['Purchasing Receipt History'].[DISCDATE],  0 as WF_Step_Type,  RATECALC = ['Purchasing Receipt History'].[RATECALC],  XCHGRATE = ['Purchasing Receipt History'].[XCHGRATE],  DENXRATE = ['Purchasing Receipt History'].[DENXRATE],  Emailed = 0   from [POP30300] as ['Purchasing Receipt History'] with (NOLOCK)   where ['Purchasing Receipt History'].[POPTYPE] <= 8  )    
GO
GRANT SELECT ON  [dbo].[popHistoryTransactions] TO [DYNGRP]
GO
GRANT INSERT ON  [dbo].[popHistoryTransactions] TO [DYNGRP]
GO
GRANT DELETE ON  [dbo].[popHistoryTransactions] TO [DYNGRP]
GO
GRANT UPDATE ON  [dbo].[popHistoryTransactions] TO [DYNGRP]
GO
