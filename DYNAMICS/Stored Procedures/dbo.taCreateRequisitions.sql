SET QUOTED_IDENTIFIER OFF
GO
SET ANSI_NULLS ON
GO
 create procedure [dbo].[taCreateRequisitions] @I_vREQUISITIONNUMBER_I int,      @I_vREQSTATUS_I smallint,       @I_vDEPARTMENTCODE_I char(7),      @I_vPOSITIONCODE_I char(7),       @I_vCOMPANYCODE_I char(5),       @I_vDIVISIONCODE_I char(7)=null,     @I_vMANAGER_I char(31)=null,       @I_vSUPERVISORCODE_I char(7)=null,     @I_vSTRTDATE datetime = null,      @I_vENDDATE datetime = null,      @I_vOPENINGDATE_I datetime = null,     @I_vRECRUITER_I char(31)=null,      @I_vRECRUITMENT_I smallint=null,     @I_vADVERTISINGLIST_I_1 char(15)=null,    @I_vADVERTISINGLIST_I_2 char(15)=null,    @I_vADVERTISINGLIST_I_3 char(15)=null,    @I_vADVERTISINGLIST_I_4 char(15)=null,    @I_vADVERTISINGLIST_I_5 char(15)=null,    @I_vPOSITIONSAVAILABLE_I smallint=null,    @I_vPOSITIONSFILLED_I smallint=null,    @I_vAPPLICANTSAPPLIED_I smallint=null,    @I_vAPPSINTERVIEWED_I smallint=null,    @I_vADVERTISINGCOSTS_I numeric(19,5)=null,   @I_vRECRUITERSFEES_I numeric(19,5)=null,   @I_vCHANGEBY_I char(15)=null,      @I_vUpdateIfExists tinyint = 1,      @I_vRequesterTrx smallint = 0,      @I_vUSRDEFND1 char(50) = '',         @I_vUSRDEFND2 char(50) = '',         @I_vUSRDEFND3 char(50) = '',         @I_vUSRDEFND4 varchar(8000) = '',     @I_vUSRDEFND5 varchar(8000) = '',     @O_iErrorState int output,       @oErrString varchar(255) output       with encryption as  set transaction isolation level read uncommitted set nocount on  declare  @ActualDate datetime,   @exists tinyint,  @existingCOMPANYCODE_I char(5),   @string varchar(4000),   @iStatus int,  @iCustomState int,  @iCustomErrString varchar(255),  @nNextNoteIndex int,     @iGetNextNoteIdxErrState int,   @iAddCodeErrState int,  @O_oErrorState int,  @iError int        select  @ActualDate = '',  @exists = 0,  @existingCOMPANYCODE_I = '',  @string = '',  @O_iErrorState = 0      if (@oErrString is NULL) begin  select @oErrString = '' end  exec @iStatus = taCreateRequisitionsPre  @I_vREQUISITIONNUMBER_I output,  @I_vREQSTATUS_I output,  @I_vDEPARTMENTCODE_I output,  @I_vPOSITIONCODE_I output,  @I_vCOMPANYCODE_I output,  @I_vDIVISIONCODE_I output,  @I_vMANAGER_I output,   @I_vSUPERVISORCODE_I output,  @I_vSTRTDATE output,  @I_vENDDATE output,  @I_vOPENINGDATE_I output,  @I_vRECRUITER_I output,  @I_vRECRUITMENT_I output,  @I_vADVERTISINGLIST_I_1 output,  @I_vADVERTISINGLIST_I_2 output,  @I_vADVERTISINGLIST_I_3 output,  @I_vADVERTISINGLIST_I_4 output,  @I_vADVERTISINGLIST_I_5 output,  @I_vPOSITIONSAVAILABLE_I output,  @I_vPOSITIONSFILLED_I output,  @I_vAPPLICANTSAPPLIED_I output,  @I_vAPPSINTERVIEWED_I output,  @I_vADVERTISINGCOSTS_I output,  @I_vRECRUITERSFEES_I output,  @I_vCHANGEBY_I output,  @I_vUpdateIfExists output,  @I_vRequesterTrx output,  @I_vUSRDEFND1 output,  @I_vUSRDEFND2 output,  @I_vUSRDEFND3 output,  @I_vUSRDEFND4 output,  @I_vUSRDEFND5 output,  @O_iErrorState = @iCustomState output,  @oErrString = @iCustomErrString output select @iError = @@error if ((@iStatus <> 0) or (@iCustomState <> 0) or (@iError <> 0)) begin  select @oErrString = rtrim(@oErrString) + ' ' + ltrim(rtrim(@iCustomErrString))  select @O_iErrorState = 8759    exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output  return (@O_iErrorState) end  if (  @I_vREQUISITIONNUMBER_I is NULL or  @I_vREQSTATUS_I is NULL or   @I_vDEPARTMENTCODE_I is NULL or   @I_vPOSITIONCODE_I is NULL or   @I_vCOMPANYCODE_I is NULL or   @I_vUpdateIfExists is NULL or  @I_vRequesterTrx is NULL or  @I_vUSRDEFND1 is NULL or  @I_vUSRDEFND2 is NULL or  @I_vUSRDEFND3 is NULL or  @I_vUSRDEFND4 is NULL or  @I_vUSRDEFND5 is NULL   ) begin  select @O_iErrorState = 8760    exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @iAddCodeErrState output end  select @I_vPOSITIONCODE_I = UPPER(@I_vPOSITIONCODE_I),  @I_vDIVISIONCODE_I = UPPER(@I_vDIVISIONCODE_I),  @I_vDEPARTMENTCODE_I = UPPER(@I_vDEPARTMENTCODE_I)  select @ActualDate = convert(varchar(12),getdate())  if ( @I_vUpdateIfExists < 0 or @I_vUpdateIfExists > 2 )  begin  select @O_iErrorState = 8776     exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @iAddCodeErrState output end  if (@I_vCOMPANYCODE_I = '') begin  select @O_iErrorState = 11329     exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @iAddCodeErrState output end  if (@I_vCOMPANYCODE_I <> '') begin  if (not exists(select INTERID from DYNAMICS..SY01500 (nolock) where INTERID = @I_vCOMPANYCODE_I))  begin  select @O_iErrorState = 8761     exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @iAddCodeErrState output  return (@O_iErrorState)  end end  if (@I_vREQUISITIONNUMBER_I <> '')  begin  if (exists(select 1 from DYNAMICS..HR2REQ01 (nolock) where REQUISITIONNUMBER_I = @I_vREQUISITIONNUMBER_I))  begin  select @exists = 1  end end  if (@exists = 1) begin  if (@I_vUpdateIfExists = 0)  begin  select @O_iErrorState = 8763     exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output  return (@O_iErrorState)  end  else  begin  if (@I_vUpdateIfExists = 2)  begin  return (@O_iErrorState)  end  end end else begin  if (@I_vUpdateIfExists = 2)  begin  select @I_vUpdateIfExists = 0  end end  if (@I_vREQUISITIONNUMBER_I = '') begin  select @O_iErrorState = 8762    exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @iAddCodeErrState output  return (@O_iErrorState) end  if (@I_vREQUISITIONNUMBER_I <> '') and (@I_vUpdateIfExists = 1) begin  if (not exists(select 1 from DYNAMICS..HR2REQ01 (nolock) where REQUISITIONNUMBER_I = @I_vREQUISITIONNUMBER_I and COMPANYCODE_I = @I_vCOMPANYCODE_I))  begin  select @O_iErrorState = 8764     exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @iAddCodeErrState output  return (@O_iErrorState)  end end   if (@I_vUpdateIfExists = 1) and (@exists = 1) begin   select @existingCOMPANYCODE_I = COMPANYCODE_I from DYNAMICS..HR2REQ01 (nolock) where REQUISITIONNUMBER_I = @I_vREQUISITIONNUMBER_I   if (@existingCOMPANYCODE_I <> @I_vCOMPANYCODE_I)  begin  select   @I_vDEPARTMENTCODE_I =   case  when @I_vDEPARTMENTCODE_I is null   then ''  else @I_vDEPARTMENTCODE_I  end,  @I_vPOSITIONCODE_I =   case   when @I_vPOSITIONCODE_I is null  then ''  else @I_vPOSITIONCODE_I  end,  @I_vDIVISIONCODE_I =   case   when @I_vDIVISIONCODE_I is null  then ''  else @I_vDIVISIONCODE_I  end  end end   if (@I_vSTRTDATE > @I_vENDDATE) begin  select @I_vENDDATE = @I_vSTRTDATE end  if (@I_vREQSTATUS_I not in (1,2,3,4)) begin  select @O_iErrorState = 8765    exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @iAddCodeErrState output  return (@O_iErrorState) end  if (@I_vDEPARTMENTCODE_I = '') begin  select @O_iErrorState = 8766     exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @iAddCodeErrState output  return (@O_iErrorState) end  if (@I_vDEPARTMENTCODE_I <> '') begin  if (not exists(select DEPARTMENTCODE_I from DYNAMICS..HRPMDP01 (nolock) where DEPARTMENTCODE_I = @I_vDEPARTMENTCODE_I and COMPANYCODE_I = @I_vCOMPANYCODE_I))  begin  select @O_iErrorState = 8767     exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @iAddCodeErrState output  return (@O_iErrorState)  end end   if (@I_vPOSITIONCODE_I = '') begin  select @O_iErrorState = 8768     exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @iAddCodeErrState output  return (@O_iErrorState) end  if (@I_vPOSITIONCODE_I <> '') begin  if (not exists(select POSITIONCODE_I from DYNAMICS..HRPMPS01 (nolock) where POSITIONCODE_I = @I_vPOSITIONCODE_I and COMPANYCODE_I = @I_vCOMPANYCODE_I))  begin  select @O_iErrorState = 8769     exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @iAddCodeErrState output  return (@O_iErrorState)  end end  if (@I_vUpdateIfExists = 1) begin  select   @I_vDIVISIONCODE_I =   case   when @I_vDIVISIONCODE_I is null   then DIVISIONCODE_I  when @I_vDIVISIONCODE_I is not null  then @I_vDIVISIONCODE_I  else ''  end,  @I_vMANAGER_I =   case   when @I_vMANAGER_I is null   then MANAGER_I  when @I_vMANAGER_I is not null  then @I_vMANAGER_I  else ''  end,  @I_vSUPERVISORCODE_I =   case   when @I_vSUPERVISORCODE_I is null   then SUPERVISORCODE_I  when @I_vSUPERVISORCODE_I is not null  then @I_vSUPERVISORCODE_I  else ''  end,  @I_vSTRTDATE =   case   when @I_vSTRTDATE is null   then STRTDATE  when @I_vSTRTDATE is not null  then @I_vSTRTDATE  else ''  end,  @I_vENDDATE =   case   when @I_vENDDATE is null   then ENDDATE  when @I_vENDDATE is not null  then @I_vENDDATE  else ''  end,  @I_vOPENINGDATE_I =   case   when @I_vOPENINGDATE_I is null   then OPENINGDATE_I  when @I_vOPENINGDATE_I is not null  then @I_vOPENINGDATE_I  else ''  end,  @I_vRECRUITER_I =   case   when @I_vRECRUITER_I is null   then RECRUITER_I  when @I_vRECRUITER_I is not null  then @I_vRECRUITER_I  else ''  end,  @I_vRECRUITMENT_I =   case   when @I_vRECRUITMENT_I is null   then RECRUITMENT_I  when @I_vRECRUITMENT_I is not null  then @I_vRECRUITMENT_I  else 0  end,  @I_vADVERTISINGLIST_I_1 =   case   when @I_vADVERTISINGLIST_I_1 is null   then ADVERTISINGLIST_I_1  when @I_vADVERTISINGLIST_I_1 is not null  then @I_vADVERTISINGLIST_I_1  else ''  end,  @I_vADVERTISINGLIST_I_2 =   case   when @I_vADVERTISINGLIST_I_2 is null   then ADVERTISINGLIST_I_2  when @I_vADVERTISINGLIST_I_2 is not null  then @I_vADVERTISINGLIST_I_2  else ''  end,  @I_vADVERTISINGLIST_I_3 =   case   when @I_vADVERTISINGLIST_I_3 is null   then ADVERTISINGLIST_I_3  when @I_vADVERTISINGLIST_I_3 is not null  then @I_vADVERTISINGLIST_I_3  else ''  end,  @I_vADVERTISINGLIST_I_4 =   case   when @I_vADVERTISINGLIST_I_4 is null   then ADVERTISINGLIST_I_4  when @I_vADVERTISINGLIST_I_4 is not null  then @I_vADVERTISINGLIST_I_4  else ''  end,  @I_vADVERTISINGLIST_I_5 =   case   when @I_vADVERTISINGLIST_I_5 is null   then ADVERTISINGLIST_I_5  when @I_vADVERTISINGLIST_I_5 is not null  then @I_vADVERTISINGLIST_I_5  else ''  end,  @I_vPOSITIONSAVAILABLE_I =   case   when @I_vPOSITIONSAVAILABLE_I is null   then POSITIONSAVAILABLE_I  when @I_vPOSITIONSAVAILABLE_I is not null  then @I_vPOSITIONSAVAILABLE_I  else 0  end,  @I_vPOSITIONSFILLED_I =   case   when @I_vPOSITIONSFILLED_I is null   then POSITIONSFILLED_I  when @I_vPOSITIONSFILLED_I is not null  then @I_vPOSITIONSFILLED_I  else 0  end,  @I_vAPPLICANTSAPPLIED_I =   case   when @I_vAPPLICANTSAPPLIED_I is null   then APPLICANTSAPPLIED_I  when @I_vAPPLICANTSAPPLIED_I is not null  then @I_vAPPLICANTSAPPLIED_I  else 0  end,  @I_vAPPSINTERVIEWED_I =   case   when @I_vAPPSINTERVIEWED_I is null   then APPSINTERVIEWED_I  when @I_vAPPSINTERVIEWED_I is not null  then @I_vAPPSINTERVIEWED_I  else 0  end,  @I_vADVERTISINGCOSTS_I =   case   when @I_vADVERTISINGCOSTS_I is null   then ADVERTISINGCOSTS_I  when @I_vADVERTISINGCOSTS_I is not null  then @I_vADVERTISINGCOSTS_I  else 0  end,  @I_vRECRUITERSFEES_I =   case   when @I_vRECRUITERSFEES_I is null   then RECRUITERSFEES_I  when @I_vRECRUITERSFEES_I is not null  then @I_vRECRUITERSFEES_I  else 0  end,  @I_vCHANGEBY_I =  case   when @I_vCHANGEBY_I is null  then CHANGEBY_I   when @I_vCHANGEBY_I is not null  then @I_vCHANGEBY_I  else 'eConnect'  end  from DYNAMICS..HR2REQ01 (nolock) where REQUISITIONNUMBER_I = @I_vREQUISITIONNUMBER_I end  else  begin    select  @I_vDIVISIONCODE_I =   case   when @I_vDIVISIONCODE_I is null   then ''  else @I_vDIVISIONCODE_I  end,  @I_vMANAGER_I =   case   when @I_vMANAGER_I is null   then ''  else @I_vMANAGER_I  end,  @I_vSUPERVISORCODE_I =   case   when @I_vSUPERVISORCODE_I is null   then ''  else @I_vSUPERVISORCODE_I  end,  @I_vSTRTDATE =   case   when @I_vSTRTDATE is null   then ''  else @I_vSTRTDATE  end,  @I_vENDDATE =   case   when @I_vENDDATE is null   then ''  else @I_vENDDATE  end,  @I_vOPENINGDATE_I =   case   when @I_vOPENINGDATE_I is null   then ''  else @I_vOPENINGDATE_I  end,  @I_vRECRUITER_I =   case   when @I_vRECRUITER_I is null   then ''  else @I_vRECRUITER_I  end,  @I_vRECRUITMENT_I =   case   when @I_vRECRUITMENT_I is null   then 0  else @I_vRECRUITMENT_I  end,  @I_vADVERTISINGLIST_I_1 =   case   when @I_vADVERTISINGLIST_I_1 is null   then ''  else @I_vADVERTISINGLIST_I_1  end,  @I_vADVERTISINGLIST_I_2 =   case   when @I_vADVERTISINGLIST_I_2 is null   then ''  else @I_vADVERTISINGLIST_I_2  end,  @I_vADVERTISINGLIST_I_3 =   case   when @I_vADVERTISINGLIST_I_3 is null   then ''  else @I_vADVERTISINGLIST_I_3  end,  @I_vADVERTISINGLIST_I_4 =   case   when @I_vADVERTISINGLIST_I_4 is null   then ''  else @I_vADVERTISINGLIST_I_4  end,  @I_vADVERTISINGLIST_I_5 =   case   when @I_vADVERTISINGLIST_I_5 is null   then ''  else @I_vADVERTISINGLIST_I_5  end,  @I_vPOSITIONSAVAILABLE_I =   case   when @I_vPOSITIONSAVAILABLE_I is null   then 0  else @I_vPOSITIONSAVAILABLE_I  end,  @I_vPOSITIONSFILLED_I =   case   when @I_vPOSITIONSFILLED_I is null   then 0  else @I_vPOSITIONSFILLED_I  end,  @I_vAPPLICANTSAPPLIED_I =   case   when @I_vAPPLICANTSAPPLIED_I is null   then 0  else @I_vAPPLICANTSAPPLIED_I  end,  @I_vAPPSINTERVIEWED_I =   case   when @I_vAPPSINTERVIEWED_I is null   then 0  else @I_vAPPSINTERVIEWED_I  end,  @I_vADVERTISINGCOSTS_I =   case   when @I_vADVERTISINGCOSTS_I is null   then 0  else @I_vADVERTISINGCOSTS_I  end,  @I_vRECRUITERSFEES_I =   case   when @I_vRECRUITERSFEES_I is null   then 0  else @I_vRECRUITERSFEES_I  end,  @I_vCHANGEBY_I =   case   when @I_vCHANGEBY_I is null  then 'eConnect'  else @I_vCHANGEBY_I  end end  if (@I_vDIVISIONCODE_I <> '') begin  if (not exists(select DIVISIONCODE_I from DYNAMICS..HRPMDV01 (nolock) where DIVISIONCODE_I = @I_vDIVISIONCODE_I and COMPANYCODE_I = @I_vCOMPANYCODE_I))  begin  select @O_iErrorState = 8770     exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @iAddCodeErrState output  return (@O_iErrorState)  end end  if (@I_vSUPERVISORCODE_I <> '') begin  select @string = 'declare @y varchar(100) select @y=SUPERVISORCODE_I from '+rtrim(@I_vCOMPANYCODE_I)+'..UPR41700 (nolock) where SUPERVISORCODE_I = '''+rtrim(@I_vSUPERVISORCODE_I)+''''  exec (@string)  if (@@ROWCOUNT = 0)  begin  select @O_iErrorState = 8771     exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @iAddCodeErrState output  return (@O_iErrorState)  end end  if (@I_vPOSITIONSAVAILABLE_I < 0 or @I_vPOSITIONSAVAILABLE_I > 999) begin  select @O_iErrorState = 8772     exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @iAddCodeErrState output end  if (@I_vPOSITIONSFILLED_I < 0 or @I_vPOSITIONSFILLED_I > 999) begin  select @O_iErrorState = 8773     exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @iAddCodeErrState output end  if (@I_vAPPSINTERVIEWED_I < 0 or @I_vAPPSINTERVIEWED_I > 999) begin  select @O_iErrorState = 8774     exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @iAddCodeErrState output end  if (@I_vAPPSINTERVIEWED_I > @I_vAPPLICANTSAPPLIED_I) begin  select @I_vAPPSINTERVIEWED_I = @I_vAPPLICANTSAPPLIED_I end  if (@I_vAPPLICANTSAPPLIED_I < 0 or @I_vAPPLICANTSAPPLIED_I > 999) begin  select @O_iErrorState = 11333     exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @iAddCodeErrState output end  if (@I_vRECRUITMENT_I < 0 or @I_vRECRUITMENT_I > 1) begin  select @O_iErrorState = 8775     exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @iAddCodeErrState output end  if (@exists = 1 and @I_vUpdateIfExists = 0) begin  select @O_iErrorState = 8777     exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @iAddCodeErrState output end  if ( @I_vRequesterTrx < 0 or @I_vRequesterTrx > 1 )  begin  select @O_iErrorState = 8778     exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @iAddCodeErrState output end  if @O_iErrorState <> 0  return (@O_iErrorState)  begin  if not exists(select 1 from DYNAMICS..HR2REQ01 (nolock) where REQUISITIONNUMBER_I = @I_vREQUISITIONNUMBER_I)  begin  insert DYNAMICS..HR2REQ01(  REQUISITIONNUMBER_I,  REQSTATUS_I,  COMPANYCODE_I,  DIVISIONCODE_I,  DEPARTMENTCODE_I,  POSITIONCODE_I,  MANAGER_I,  SUPERVISORCODE_I,  STRTDATE,  ENDDATE,  OPENINGDATE_I,  RECRUITER_I,  RECRUITMENT_I,  ADVERTISINGLIST_I_1,  ADVERTISINGLIST_I_2,  ADVERTISINGLIST_I_3,  ADVERTISINGLIST_I_4,  ADVERTISINGLIST_I_5,  POSITIONSAVAILABLE_I,  POSITIONSFILLED_I,  APPLICANTSAPPLIED_I,  APPSINTERVIEWED_I,  ADVERTISINGCOSTS_I,  RECRUITERSFEES_I,  TRAVELCOSTS_I,  LODGINGCOSTS_I,  MOVINGEXPENSES_I,  OTHERCOSTS_I,  NOTESINDEX_I,  CHANGEBY_I,  CHANGEDATE_I  )  select  @I_vREQUISITIONNUMBER_I,     @I_vREQSTATUS_I,       @I_vCOMPANYCODE_I,       @I_vDIVISIONCODE_I,       @I_vDEPARTMENTCODE_I,      @I_vPOSITIONCODE_I,       @I_vMANAGER_I,        @I_vSUPERVISORCODE_I,      @I_vSTRTDATE,        @I_vENDDATE,        @I_vOPENINGDATE_I,       @I_vRECRUITER_I,       @I_vRECRUITMENT_I,       @I_vADVERTISINGLIST_I_1,     @I_vADVERTISINGLIST_I_2,     @I_vADVERTISINGLIST_I_3,     @I_vADVERTISINGLIST_I_4,     @I_vADVERTISINGLIST_I_5,     @I_vPOSITIONSAVAILABLE_I,      @I_vPOSITIONSFILLED_I,      @I_vAPPLICANTSAPPLIED_I,     @I_vAPPSINTERVIEWED_I,      @I_vADVERTISINGCOSTS_I,      @I_vRECRUITERSFEES_I,      0,           0,           0,           0,           0,           @I_vCHANGEBY_I,        @ActualDate         if @@error <> 0  begin  select @O_iErrorState = 8779    exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @iAddCodeErrState output  return (@O_iErrorState)  end  end  else  if (@I_vUpdateIfExists = 1) and (@exists = 1)  begin  update DYNAMICS..HR2REQ01   set   REQSTATUS_I = @I_vREQSTATUS_I,  COMPANYCODE_I = @I_vCOMPANYCODE_I,  DIVISIONCODE_I = @I_vDIVISIONCODE_I,  DEPARTMENTCODE_I = @I_vDEPARTMENTCODE_I,  POSITIONCODE_I = @I_vPOSITIONCODE_I,  MANAGER_I = @I_vMANAGER_I,  SUPERVISORCODE_I = @I_vSUPERVISORCODE_I,  STRTDATE = @I_vSTRTDATE,  ENDDATE = @I_vENDDATE,  OPENINGDATE_I = @I_vOPENINGDATE_I,  RECRUITER_I = @I_vRECRUITER_I,  RECRUITMENT_I = @I_vRECRUITMENT_I,  ADVERTISINGLIST_I_1 = @I_vADVERTISINGLIST_I_1,  ADVERTISINGLIST_I_2 = @I_vADVERTISINGLIST_I_2,  ADVERTISINGLIST_I_3 = @I_vADVERTISINGLIST_I_3,  ADVERTISINGLIST_I_4 = @I_vADVERTISINGLIST_I_4,  ADVERTISINGLIST_I_5 = @I_vADVERTISINGLIST_I_5,  POSITIONSAVAILABLE_I = @I_vPOSITIONSAVAILABLE_I,  POSITIONSFILLED_I = @I_vPOSITIONSFILLED_I,  APPLICANTSAPPLIED_I = @I_vAPPLICANTSAPPLIED_I,  APPSINTERVIEWED_I = @I_vAPPSINTERVIEWED_I,  ADVERTISINGCOSTS_I = @I_vADVERTISINGCOSTS_I,  RECRUITERSFEES_I = @I_vRECRUITERSFEES_I,  CHANGEBY_I = @I_vCHANGEBY_I,  CHANGEDATE_I = @ActualDate  where REQUISITIONNUMBER_I = @I_vREQUISITIONNUMBER_I  if @@error <> 0  begin  select @O_iErrorState = 8780    exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @iAddCodeErrState output  return (@O_iErrorState)  end  end end  exec @iStatus = taCreateRequisitionsPost  @I_vREQUISITIONNUMBER_I,  @I_vREQSTATUS_I,  @I_vDEPARTMENTCODE_I,  @I_vPOSITIONCODE_I,  @I_vCOMPANYCODE_I,  @I_vDIVISIONCODE_I,  @I_vMANAGER_I,   @I_vSUPERVISORCODE_I,  @I_vSTRTDATE,  @I_vENDDATE,  @I_vOPENINGDATE_I,  @I_vRECRUITER_I,  @I_vRECRUITMENT_I,  @I_vADVERTISINGLIST_I_1,  @I_vADVERTISINGLIST_I_2,  @I_vADVERTISINGLIST_I_3,  @I_vADVERTISINGLIST_I_4,  @I_vADVERTISINGLIST_I_5,  @I_vPOSITIONSAVAILABLE_I,  @I_vPOSITIONSFILLED_I,  @I_vAPPLICANTSAPPLIED_I,  @I_vAPPSINTERVIEWED_I,  @I_vADVERTISINGCOSTS_I,  @I_vRECRUITERSFEES_I,  @I_vCHANGEBY_I,   @I_vUpdateIfExists,  @I_vRequesterTrx,  @I_vUSRDEFND1,  @I_vUSRDEFND2,  @I_vUSRDEFND3,  @I_vUSRDEFND4,  @I_vUSRDEFND5,  @O_iErrorState = @iCustomState output,  @oErrString = @iCustomErrString output select @iError = @@error if ((@iStatus <> 0) or (@iCustomState <> 0) or (@iError <> 0)) begin  select @oErrString = rtrim(@oErrString) + ' ' + ltrim(rtrim(@iCustomErrString))  select @O_iErrorState = 8782    exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output  return (@O_iErrorState) end  return (@O_iErrorState)   
GO
GRANT EXECUTE ON  [dbo].[taCreateRequisitions] TO [DYNGRP]
GO
