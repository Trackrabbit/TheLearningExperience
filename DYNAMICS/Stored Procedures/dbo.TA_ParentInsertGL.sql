SET QUOTED_IDENTIFIER OFF
GO
SET ANSI_NULLS ON
GO
CREATE procedure [dbo].[TA_ParentInsertGL] @MASTERDB char(15), @ACTINDX int, @ACTNUMBR_1 varchar(25), @ACTNUMBR_2 varchar(25), @ACTNUMBR_3 varchar(25), @ACTNUMBR_4 varchar(25), @ACTNUMBR_5 varchar(25), @ACTNUMBR_6 varchar(25), @ACTNUMBR_7 varchar(25), @ACTNUMBR_8 varchar(25), @ACTNUMBR_9 varchar(25), @ACTNUMBR_10 varchar(25), @ACTALIAS char(30), @MNACSGMT char(80), @ACCTTYPE smallint, @ACTDESCR char(70), @PSTNGTYP smallint, @ACCATNUM smallint, @ACTIVE tinyint, @TPCLBLNC smallint, @DECPLACS smallint, @FXDORVAR smallint, @BALFRCLC smallint, @DSPLKUPS binary, @CNVRMTHD smallint, @HSTRCLRT numeric(19,5), @NOTEINDX numeric(19,5), @CREATDDT datetime, @MODIFDT datetime, @USERDEF1 char(40), @USERDEF2 char(40), @PostSlsIn smallint, @PostIvIn smallint, @PostPurchIn smallint, @PostPRIn smallint, @ADJINFL tinyint, @INFLAREV int, @INFLAEQU int, @ACCTENTR tinyint,				 @USRDEFS1 char(40),				 @USRDEFS2 char(40),				 @O_SQL_Error_State int = NULL  output with encryption as set transaction isolation level read uncommitted set nocount on declare @CMPNYNAM char(4000), @CStatement varchar(4000),  @CStatement1 varchar(4000), @CStatement2 varchar(4000), @CStatement3 varchar(4000), @CStatement4 varchar(4000), @CStatement5 varchar(4000), @CStatement6 varchar(4000), @CStatement7 varchar(4000), @CStatement8 varchar(4000), @CStatement9 varchar(4000), @CStatement10 varchar(4000), @CStatement11 varchar(4000), @CStatement12 varchar(4000), @CStatement13 varchar(4000), @CStatement14 varchar(4000), @CStatement15 varchar(4000), @CStatement16 varchar(4000), @CStatement17 varchar(4000), @CStatement18 varchar(4000), @CStatement19 varchar(4000), @CStatement20 varchar(4000), @CStatement21 varchar(4000), @CStatement22 varchar(4000), @CStatement23 varchar(4000), @CStatement24 varchar(4000), @CStatement25 varchar(4000), @CStatement26 varchar(4000), @CStatement27 varchar(4000), @CStatement28 varchar(4000), @CStatement29 varchar(4000), @CStatement30 varchar(4000), @CStatement31 varchar(4000), @CStatement32 varchar(4000), @CStatement33 varchar(4000), @CStatement34 varchar(4000), @CStatement35 varchar(4000), @CStatement36 varchar(4000), @CStatement37 varchar(4000), @CStatement38 varchar(4000), @CStatement39 varchar(4000), @CStatement40 varchar(4000), @CStatement41 varchar(4000), @CStatement42 varchar(4000), @CStatement43 varchar(4000), @CStatement44 varchar(4000), @CStatement45 varchar(4000), @CStatement46 varchar(4000), @CStatement47 varchar(4000), @CStatement48 varchar(4000), @CStatement49 varchar(4000), @CStatement50 varchar(4000), @CStatement51 varchar(4000), @CStatement52 varchar(4000), @CStatement53 varchar(4000), @CStatement54 varchar(4000), @CStatement55 varchar(4000), @CStatement56 varchar(4000), @CStatement57 varchar(4000), @CStatement58 varchar(4000), @CStatement59 varchar(4000), @CStatement60 varchar(4000), @CStatement61 varchar(4000), @CStatement62 varchar(4000), @CStatement63 varchar(4000), @CStatement64 varchar(4000), @CStatement65 varchar(4000), @CStatement66 varchar(4000), @CStatement67 varchar(4000), @CStatement68 varchar(4000), @CStatement69 varchar(4000), @CStatement70 varchar(4000), @CStatement71 varchar(4000), @CStatement72 varchar(4000), @CStatement73 varchar(4000), @CStatement74 varchar(4000), @CStatement75 varchar(4000), @CStatement76 varchar(4000), @CStatement77 varchar(4000), @CStatement78 varchar(4000), @CStatement79 varchar(4000), @CStatement80 varchar(4000), @CStatement81 varchar(4000), @CStatement82 varchar(4000), @CStatement83 varchar(4000), @CStatement84 varchar(4000), @CStatement85 varchar(4000), @CStatement86 varchar(4000), @CStatement87 varchar(4000), @CStatement88 varchar(4000), @CStatement89 varchar(4000), @CStatement90 varchar(4000), @CStatement91 varchar(4000), @CStatement92 varchar(4000), @CStatement93 varchar(4000), @CStatement94 varchar(4000), @ACTNUMST char(4000), @MXSEG int, @ACTINDX2 int,			 @ACTINDX3 int,			 @CheckStatus4 int, @iStatus int,			 @O_iErrorState int,		 @iError int, @CMPNYNAMID int, @NumSegments integer,		 @x integer,			 @SegLength integer,		 @SegLengthString char(2),	 @CmdExec varchar(1000),		 @AcctSeparator char(1)		 select	@O_iErrorState = 0, @iStatus = 0, @x = 1 Exec @iStatus = DYNAMICS..taFormatStringsForExecs @ACTDESCR, @ACTDESCR output, @O_iErrorState output Exec @iStatus = DYNAMICS..taFormatStringsForExecs @ACTALIAS, @ACTALIAS output, @O_iErrorState output Exec @iStatus = DYNAMICS..taFormatStringsForExecs @USERDEF1, @USERDEF1 output, @O_iErrorState output Exec @iStatus = DYNAMICS..taFormatStringsForExecs @USERDEF2, @USERDEF2 output, @O_iErrorState output Exec @iStatus = DYNAMICS..taFormatStringsForExecs @USRDEFS1, @USRDEFS1 output, @O_iErrorState output Exec @iStatus = DYNAMICS..taFormatStringsForExecs @USRDEFS2, @USRDEFS2 output, @O_iErrorState output select @MXSEG = MXNUMSEG from DYNAMICS..SY003001 if not exists( select 1 from tempdb..sysobjects where name = '##AccountIndex') begin create table ##AccountIndex ( AcctIndex int ) insert into ##AccountIndex select 0 end if not exists( select 1 from tempdb..sysobjects where name = '##AccountIndex2') begin create table ##AccountIndex2 ( AcctIndex int ) insert into ##AccountIndex2 select 0 end if (not exists(select 1 from tempdb..sysobjects where name = '##REPLMSTR')) begin create table ##REPLMSTR (TYPE int, VALUE char (200)) end select @AcctSeparator = ACSEGSEP from DYNAMICS..SY01500 where INTERID = @MASTERDB if (not exists(select 1 from tempdb..sysobjects where id = (select object_id( 'tempdb..#SegmentString')))) begin create table #SegmentString (SGMTNUMB smallint, LOFSGMNT smallint) end select @CStatement = 'insert into #SegmentString select SGMTNUMB, LOFSGMNT from '+ rtrim(@MASTERDB)+'..SY00300' exec (@CStatement) select @NumSegments = count(*) from #SegmentString select @SegLength = LOFSGMNT from #SegmentString where SGMTNUMB = @x select @SegLengthString = ltrim(str(@SegLength)) select @CmdExec = 'select substring(ACTNUMBR_1,1,' + rtrim(@SegLengthString) + ')' select @x = 2 while (@x <= @NumSegments) begin select @SegLength = LOFSGMNT from #SegmentString where SGMTNUMB = @x select @SegLengthString = ltrim(str(@SegLength)) select @CmdExec = rtrim(@CmdExec) + '+''' + @AcctSeparator + ''''+ '+ substring(ACTNUMBR_'+ltrim(str(@x))+',1,'+rtrim(@SegLengthString)+')' select @x = @x + 1 end select @CmdExec = rtrim(@CmdExec) + ' ACTNUMST into ##AccountString from #inserted' exec (@CmdExec) select @ACTNUMST = ACTNUMST from ##AccountString if (exists(select 1 from tempdb..sysobjects where id = (select object_id( 'tempdb..#SegmentString')))) begin drop table #SegmentString end if (exists(select 1 from tempdb..sysobjects where name = '##AccountString')) begin drop table ##AccountString end if (not exists(select 1 from ##REPLMSTR where TYPE = 3 and VALUE = @ACTNUMST)) begin insert into ##REPLMSTR select 3, @ACTNUMST declare TAParentInsertGL insensitive CURSOR for select REPLICATE_TO_DB from DYNAMICS..TA_Map where MASTERDB = @MASTERDB and Accounts = 1 set nocount on OPEN TAParentInsertGL FETCH NEXT FROM TAParentInsertGL INTO @CMPNYNAM WHILE (@@FETCH_STATUS <> -1) begin select @CMPNYNAMID = CMPANYID from SY01500 (nolock) where INTERID = @CMPNYNAM exec @iStatus = DYNAMICS..smGetNextNoteIndex @I_sCompanyID 	= @CMPNYNAMID, @I_iSQLSessionID= 0, @O_mNoteIndex 	= @NOTEINDX output select @iError = @@error if ((@iStatus <> 0)or (@iError <> 0)) begin break end select @CStatement =  'declare @ACTINDX2 int if not exists (select 1 from '+ rtrim(@CMPNYNAM) + '..GL00100 where ' if @MXSEG > 0 select @CStatement1 = 'ACTNUMBR_1 = ''' + rtrim(@ACTNUMBR_1) +'''' if @MXSEG > 1 select @CStatement1 = @CStatement1 + ' and ACTNUMBR_2 = ''' + rtrim(@ACTNUMBR_2) +'''' if @MXSEG > 2 select @CStatement1 = @CStatement1 + ' and ACTNUMBR_3 = ''' + rtrim(@ACTNUMBR_3) +'''' if @MXSEG > 3 select @CStatement1 = @CStatement1 + ' and ACTNUMBR_4 = ''' + rtrim(@ACTNUMBR_4) +'''' if @MXSEG > 4 select @CStatement1 = @CStatement1 + ' and ACTNUMBR_5 = ''' + rtrim(@ACTNUMBR_5) +'''' if @MXSEG > 5 select @CStatement1 = @CStatement1 + ' and ACTNUMBR_6 = ''' + rtrim(@ACTNUMBR_6) +'''' if @MXSEG > 6 select @CStatement1 = @CStatement1 + ' and ACTNUMBR_7 = ''' + rtrim(@ACTNUMBR_7) +'''' if @MXSEG > 7 select @CStatement1 = @CStatement1 + ' and ACTNUMBR_8 = ''' + rtrim(@ACTNUMBR_8) +''''  if @MXSEG > 8 select @CStatement1 = @CStatement1 + ' and ACTNUMBR_9 = ''' + rtrim(@ACTNUMBR_9) +'''' if @MXSEG > 9 select @CStatement1 = @CStatement1 + ' and ACTNUMBR_10 = ''' + rtrim(@ACTNUMBR_10) +'''' select @CStatement2 = ') begin ' select @CStatement3 = ' if exists ( select 1 from '+ rtrim(@CMPNYNAM) +'..GL00100 where ACTINDX = '+ rtrim(@ACTINDX)+' )' select @CStatement4 = ' begin ' select @CStatement5 = ' select @ACTINDX2 = max(ACTINDX) + 1 from '+ rtrim(@CMPNYNAM) +'..GL00100 ' select @CStatement6 = ' update ##AccountIndex set AcctIndex = @ACTINDX2 end ' select @CStatement7 = ' end ' exec (  @CStatement + @CStatement1 + @CStatement2 + @CStatement3 + @CStatement4 + @CStatement5 + @CStatement6 + @CStatement7 ) select @ACTINDX2 = AcctIndex from ##AccountIndex if @ACTINDX2 <> 0 begin select @ACTINDX = @ACTINDX2 end select @CStatement =  'declare @ACTINDX3 int if exists (select 1 from '+ rtrim(@CMPNYNAM) + '..GL00100 where ' if @MXSEG > 0 select @CStatement1 = 'ACTNUMBR_1 = ''' + rtrim(@ACTNUMBR_1) +''''  if @MXSEG > 1 select @CStatement1 = @CStatement1 + ' and ACTNUMBR_2 = ''' + rtrim(@ACTNUMBR_2) +'''' if @MXSEG > 2 select @CStatement1 = @CStatement1 + ' and ACTNUMBR_3 = ''' + rtrim(@ACTNUMBR_3) +'''' if @MXSEG > 3 select @CStatement1 = @CStatement1 + ' and ACTNUMBR_4 = ''' + rtrim(@ACTNUMBR_4) +'''' if @MXSEG > 4 select @CStatement1 = @CStatement1 + ' and ACTNUMBR_5 = ''' + rtrim(@ACTNUMBR_5) +'''' if @MXSEG > 5 select @CStatement1 = @CStatement1 + ' and ACTNUMBR_6 = ''' + rtrim(@ACTNUMBR_6) +'''' if @MXSEG > 6 select @CStatement1 = @CStatement1 + ' and ACTNUMBR_7 = ''' + rtrim(@ACTNUMBR_7) +'''' if @MXSEG > 7 select @CStatement1 = @CStatement1 + ' and ACTNUMBR_8 = ''' + rtrim(@ACTNUMBR_8) +''''  if @MXSEG > 8 select @CStatement1 = @CStatement1 + ' and ACTNUMBR_9 = ''' + rtrim(@ACTNUMBR_9) +'''' if @MXSEG > 9 select @CStatement1 = @CStatement1 + ' and ACTNUMBR_10 = ''' + rtrim(@ACTNUMBR_10) +'''' select @CStatement2 = ') begin'	 select @CStatement3 = ' select @ACTINDX3 = ACTINDX from '+ rtrim(@CMPNYNAM) + '..GL00100 where ' if @MXSEG > 0 select @CStatement4 = 'ACTNUMBR_1 = ''' + rtrim(@ACTNUMBR_1) +'''' if @MXSEG > 1 select @CStatement4 = @CStatement4 + ' and ACTNUMBR_2 = ''' + rtrim(@ACTNUMBR_2) +'''' if @MXSEG > 2 select @CStatement4 = @CStatement4 + ' and ACTNUMBR_3 = ''' + rtrim(@ACTNUMBR_3) +'''' if @MXSEG > 3 select @CStatement4 = @CStatement4 + ' and ACTNUMBR_4 = ''' + rtrim(@ACTNUMBR_4) +'''' if @MXSEG > 4 select @CStatement4 = @CStatement4 + ' and ACTNUMBR_5 = ''' + rtrim(@ACTNUMBR_5) +'''' if @MXSEG > 5 select @CStatement4 = @CStatement4 + ' and ACTNUMBR_6 = ''' + rtrim(@ACTNUMBR_6) +'''' if @MXSEG > 6 select @CStatement4 = @CStatement4 + ' and ACTNUMBR_7 = ''' + rtrim(@ACTNUMBR_7) +'''' if @MXSEG > 7 select @CStatement4 = @CStatement4 + ' and ACTNUMBR_8 = ''' + rtrim(@ACTNUMBR_8) +''''  if @MXSEG > 8 select @CStatement4 = @CStatement4 + ' and ACTNUMBR_9 = ''' + rtrim(@ACTNUMBR_9) +'''' if @MXSEG > 9 select @CStatement4 = @CStatement4 + ' and ACTNUMBR_10 = ''' + rtrim(@ACTNUMBR_10) +'''' select @CStatement5 = ' update ##AccountIndex2 set AcctIndex = @ACTINDX3 end' exec ( @CStatement + @CStatement1 + @CStatement2 + @CStatement3 + @CStatement4 + @CStatement5 ) select @ACTINDX3 = AcctIndex from ##AccountIndex2 select @CStatement1 =  ' select distinct(0) as STATUS into ##CheckStatus4 from '+ rtrim(@CMPNYNAM)+'..GL20000 where ACTINDX = '+str(@ACTINDX3) exec (@CStatement1) select @CheckStatus4 = 1  select @CheckStatus4 = STATUS from ##CheckStatus4 if exists( select 1 from tempdb..sysobjects where name = '##CheckStatus4') drop table ##CheckStatus4 select @CStatement =  'if not exists (select 1 from '+ rtrim(@CMPNYNAM) + '..GL00100 where ' if @MXSEG > 0 select @CStatement1 = 'ACTNUMBR_1 = ''' + rtrim(@ACTNUMBR_1) +''''  if @MXSEG > 1 select @CStatement1 = @CStatement1 + ' and ACTNUMBR_2 = ''' + rtrim(@ACTNUMBR_2) +'''' if @MXSEG > 2 select @CStatement1 = @CStatement1 + ' and ACTNUMBR_3 = ''' + rtrim(@ACTNUMBR_3) +'''' if @MXSEG > 3 select @CStatement1 = @CStatement1 + ' and ACTNUMBR_4 = ''' + rtrim(@ACTNUMBR_4) +'''' if @MXSEG > 4 select @CStatement1 = @CStatement1 + ' and ACTNUMBR_5 = ''' + rtrim(@ACTNUMBR_5) +'''' if @MXSEG > 5 select @CStatement1 = @CStatement1 + ' and ACTNUMBR_6 = ''' + rtrim(@ACTNUMBR_6) +'''' if @MXSEG > 6 select @CStatement1 = @CStatement1 + ' and ACTNUMBR_7 = ''' + rtrim(@ACTNUMBR_7) +'''' if @MXSEG > 7 select @CStatement1 = @CStatement1 + ' and ACTNUMBR_8 = ''' + rtrim(@ACTNUMBR_8) +''''  if @MXSEG > 8 select @CStatement1 = @CStatement1 + ' and ACTNUMBR_9 = ''' + rtrim(@ACTNUMBR_9) +'''' if @MXSEG > 9 select @CStatement1 = @CStatement1 + ' and ACTNUMBR_10 = ''' + rtrim(@ACTNUMBR_10) +''''  select @CStatement2 = ')' select @CStatement3 = 'insert into '+rtrim(@CMPNYNAM) + '..GL00100 (ACTINDX' select @CStatement4 = '' select @CStatement4 =  +rtrim(@CStatement4)+rtrim(','+'ACTNUMBR_'+ltrim(str(s.SGMTNUMB))) from DYNAMICS..SY00302 s select @CStatement5 = ',ACTALIAS,MNACSGMT,ACCTTYPE,ACTDESCR,PSTNGTYP,ACCATNUM, ACTIVE,TPCLBLNC,DECPLACS,FXDORVAR,BALFRCLC,DSPLKUPS,' select @CStatement6 = ' CNVRMTHD,HSTRCLRT,NOTEINDX,CREATDDT,MODIFDT,USERDEF1, USERDEF2,PostSlsIn,PostIvIn,PostPurchIn,PostPRIn,ADJINFL, INFLAREV,INFLAEQU,ACCTENTR,USRDEFS1,USRDEFS2)' select @CStatement7 = ' select '+str(@ACTINDX) select @CStatement8 = '' select @CStatement8 =  +rtrim(@CStatement8)+rtrim(','+'ACTNUMBR_'+ltrim(str(s.SGMTNUMB))) from DYNAMICS..SY00302 s select @CStatement9 =	','+rtrim(@ACTALIAS)+','''+rtrim(@MNACSGMT)+''','+str(@ACCTTYPE)+','+rtrim(@ACTDESCR)+','+str(@PSTNGTYP)+','+str(@ACCATNUM)+',' select @CStatement10 =	str(@ACTIVE)+','+str(@TPCLBLNC)+','+str(@DECPLACS)+','+str(@FXDORVAR)+','+str(@BALFRCLC)+',0xFFFFFF7F,' select @CStatement11 =   str(@CNVRMTHD)+','+str(@HSTRCLRT)+','+str(@NOTEINDX)+','''+rtrim(@CREATDDT)+''','''+rtrim(@MODIFDT)+''','+rtrim(@USERDEF1)+','+rtrim(@USERDEF2)+',' select @CStatement12 =	str(@PostSlsIn)+','+str(@PostIvIn)+','+str(@PostPurchIn)+','+str(@PostPRIn)+','+rtrim(@ADJINFL)+','+str(@INFLAREV)+',' select @CStatement13 =	str(@INFLAEQU)+','+str(@ACCTENTR)+','+rtrim(@USRDEFS1)+','+rtrim(@USRDEFS2)+' from #inserted' select @CStatement14 = ' else update '+rtrim(@CMPNYNAM) + '..GL00100 ' select @CStatement15 = ' set ACTALIAS = '+rtrim(@ACTALIAS)+', MNACSGMT = '''+rtrim(@MNACSGMT)+''', ACTDESCR = '+rtrim(@ACTDESCR)+',' select @CStatement16 ='      ACCATNUM = '+str(@ACCATNUM)+', PostSlsIn = '+str(@PostSlsIn)+', PostIvIn = '+str(@PostIvIn)+',' select @CStatement17 ='	     PostPurchIn = '+str(@PostPurchIn)+', MODIFDT = '''+cast(@MODIFDT as varchar(12))+''', PostPRIn = '+str(@PostPRIn)+', USERDEF1 = '+rtrim(@USERDEF1)+',' select @CStatement18 ='	     USERDEF2 = '+rtrim(@USERDEF2)+', ACTIVE = case when ('+str(@CheckStatus4)+' = 1) then '+str(@ACTIVE)+' else ACTIVE end, TPCLBLNC = '+str(@TPCLBLNC)+',' select @CStatement19 ='      PSTNGTYP = '+str(@PSTNGTYP)+', DECPLACS = '+str(@DECPLACS)+', ACCTENTR = '+str(@ACCTENTR)+', USRDEFS1 = '+rtrim(@USRDEFS1)+', USRDEFS2 = '+rtrim(@USRDEFS2)+' where ACTINDX = '+str(@ACTINDX3)+'' exec (@CStatement + @CStatement1 + @CStatement2 + @CStatement3 + @CStatement4 + @CStatement5 + @CStatement6 +  @CStatement7 + @CStatement8 + @CStatement9 + @CStatement10 + @CStatement11 + @CStatement12 + @CStatement13 + @CStatement14 + @CStatement15 + @CStatement16 + @CStatement17 + @CStatement18 + @CStatement19 ) select @CStatement =  'if not exists (select 1 from '+ rtrim(@CMPNYNAM) + '..GL00105 where ACTNUMST ='+''''+rtrim(@ACTNUMST)+''')' select @CStatement1 = 'insert into '+rtrim(@CMPNYNAM) + '..GL00105 (ACTINDX' select @CStatement2 = '' select @CStatement2 =  +rtrim(@CStatement2)+rtrim(','+'ACTNUMBR_'+ltrim(str(s.SGMTNUMB))) from DYNAMICS..SY00302 s select @CStatement3 = ', ACTNUMST)' select @CStatement4 = ' select '+str(@ACTINDX) select @CStatement5 = '' select @CStatement5 =  +rtrim(@CStatement5)+rtrim(','+'ACTNUMBR_'+ltrim(str(s.SGMTNUMB))) from DYNAMICS..SY00302 s select @CStatement6 = ','''+rtrim(@ACTNUMST)+'''' + ' from #inserted' exec (@CStatement + @CStatement1 + @CStatement2 + @CStatement3 + @CStatement4 + @CStatement5 + @CStatement6) if @MXSEG > 0 begin select @CStatement25 =  ' if not exists (select 1 from '+ rtrim(@CMPNYNAM) + '..GL40200 where '	 select @CStatement26 = 'SGMNTID = '+char(39) + rtrim(@ACTNUMBR_1) +char(39) select @CStatement27 = ') and ' + char(39) + rtrim(@ACTNUMBR_1) + char(39) + '<> ' + char(39)+ char(39) select @CStatement28 = ' insert into '+ rtrim(@CMPNYNAM) + '..GL40200 (SGMTNUMB, SGMNTID, SEGCOUNT, NOTEINDX)' select @CStatement29 = ' select 1, '+char(39)+ rtrim(@ACTNUMBR_1) + char(39) + ' , 1, '+str(@NOTEINDX) select @CStatement30 = ' else ' select @CStatement31 = 'update '+ rtrim(@CMPNYNAM) + '..GL40200 set SEGCOUNT = SEGCOUNT + 1 where SGMTNUMB = 1 and SGMNTID = '+char(39)+rtrim(@ACTNUMBR_1)+char(39)   end if @MXSEG > 1 begin select @CStatement32 =  ' if not exists (select 1 from '+ rtrim(@CMPNYNAM) + '..GL40200 where '	 select @CStatement33 = 'SGMNTID = '+char(39) + rtrim(@ACTNUMBR_2) +char(39) select @CStatement34 = ') and ' + char(39) + rtrim(@ACTNUMBR_2) + char(39) + '<> ' + char(39)+ char(39) select @CStatement35 = ' insert into '+ rtrim(@CMPNYNAM) + '..GL40200 (SGMTNUMB, SGMNTID, SEGCOUNT, NOTEINDX)' select @CStatement36 = ' select 2, '+char(39)+ rtrim(@ACTNUMBR_2) + char(39) + ' , 1, '+str(@NOTEINDX) select @CStatement37 = ' else ' select @CStatement38 = 'update '+ rtrim(@CMPNYNAM) + '..GL40200 set SEGCOUNT = SEGCOUNT + 1 where SGMTNUMB = 2 and SGMNTID = '+char(39)+rtrim(@ACTNUMBR_2)+char(39)   end if @MXSEG > 2 begin select @CStatement39 =  ' if not exists (select 1 from '+ rtrim(@CMPNYNAM) + '..GL40200 where '	 select @CStatement40 = 'SGMNTID = '+char(39) + rtrim(@ACTNUMBR_3) +char(39) select @CStatement41 = ') and ' + char(39) + rtrim(@ACTNUMBR_3) + char(39) + '<> ' + char(39)+ char(39) select @CStatement42 = ' insert into '+ rtrim(@CMPNYNAM) + '..GL40200 (SGMTNUMB, SGMNTID, SEGCOUNT, NOTEINDX)' select @CStatement43 = ' select 3, '+char(39)+ rtrim(@ACTNUMBR_3) + char(39) + ' , 1, '+str(@NOTEINDX) select @CStatement44 = ' else ' select @CStatement45 = 'update '+ rtrim(@CMPNYNAM) + '..GL40200 set SEGCOUNT = SEGCOUNT + 1 where SGMTNUMB = 3 and SGMNTID = '+char(39)+rtrim(@ACTNUMBR_3)+char(39)   end if @MXSEG > 3 begin select @CStatement46 =  ' if not exists (select 1 from '+ rtrim(@CMPNYNAM) + '..GL40200 where '	 select @CStatement47 = 'SGMNTID = '+char(39) + rtrim(@ACTNUMBR_4) +char(39) select @CStatement48 = ') and ' + char(39) + rtrim(@ACTNUMBR_4) + char(39) + '<> ' + char(39)+ char(39) select @CStatement49 = ' insert into '+ rtrim(@CMPNYNAM) + '..GL40200 (SGMTNUMB, SGMNTID, SEGCOUNT, NOTEINDX)' select @CStatement50 = ' select 4, '+char(39)+ rtrim(@ACTNUMBR_4) + char(39) + ' , 1, '+str(@NOTEINDX) select @CStatement51 = ' else ' select @CStatement52 = 'update '+ rtrim(@CMPNYNAM) + '..GL40200 set SEGCOUNT = SEGCOUNT + 1 where SGMTNUMB = 4 and SGMNTID = '+char(39)+rtrim(@ACTNUMBR_4)+char(39)   end if @MXSEG > 4 begin select @CStatement53 =  ' if not exists (select 1 from '+ rtrim(@CMPNYNAM) + '..GL40200 where '	 select @CStatement54 = 'SGMNTID = '+char(39) + rtrim(@ACTNUMBR_5) +char(39) select @CStatement55 = ') and ' + char(39) + rtrim(@ACTNUMBR_5) + char(39) + '<> ' + char(39)+ char(39) select @CStatement56 = ' insert into '+ rtrim(@CMPNYNAM) + '..GL40200 (SGMTNUMB, SGMNTID, SEGCOUNT, NOTEINDX)' select @CStatement57 = ' select 5, '+char(39)+ rtrim(@ACTNUMBR_5) + char(39) + ' , 1, '+str(@NOTEINDX) select @CStatement58 = ' else ' select @CStatement59 = 'update '+ rtrim(@CMPNYNAM) + '..GL40200 set SEGCOUNT = SEGCOUNT + 1 where SGMTNUMB = 5 and SGMNTID = '+char(39)+rtrim(@ACTNUMBR_5)+char(39)   end if @MXSEG > 5 begin select @CStatement60 =  ' if not exists (select 1 from '+ rtrim(@CMPNYNAM) + '..GL40200 where '	 select @CStatement61 = 'SGMNTID = '+char(39) + rtrim(@ACTNUMBR_6) +char(39) select @CStatement62 = ') and ' + char(39) + rtrim(@ACTNUMBR_6) + char(39) + '<> ' + char(39)+ char(39) select @CStatement63 = ' insert into '+ rtrim(@CMPNYNAM) + '..GL40200 (SGMTNUMB, SGMNTID, SEGCOUNT, NOTEINDX)' select @CStatement64 = ' select 6, '+char(39)+ rtrim(@ACTNUMBR_6) + char(39) + ' , 1, '+str(@NOTEINDX) select @CStatement65 = ' else ' select @CStatement66 = 'update '+ rtrim(@CMPNYNAM) + '..GL40200 set SEGCOUNT = SEGCOUNT + 1 where SGMTNUMB = 6 and SGMNTID = '+char(39)+rtrim(@ACTNUMBR_6)+char(39)   end if @MXSEG > 6 begin select @CStatement67 =  ' if not exists (select 1 from '+ rtrim(@CMPNYNAM) + '..GL40200 where '	 select @CStatement68 = 'SGMNTID = '+char(39) + rtrim(@ACTNUMBR_7) +char(39) select @CStatement69 = ') and ' + char(39) + rtrim(@ACTNUMBR_7) + char(39) + '<> ' + char(39)+ char(39) select @CStatement70 = ' insert into '+ rtrim(@CMPNYNAM) + '..GL40200 (SGMTNUMB, SGMNTID, SEGCOUNT, NOTEINDX)' select @CStatement71 = ' select 7, '+char(39)+ rtrim(@ACTNUMBR_7) + char(39) + ' , 1, '+str(@NOTEINDX) select @CStatement72 = ' else ' select @CStatement73 = 'update '+ rtrim(@CMPNYNAM) + '..GL40200 set SEGCOUNT = SEGCOUNT + 1 where SGMTNUMB = 7 and SGMNTID = '+char(39)+rtrim(@ACTNUMBR_7)+char(39)   end if @MXSEG > 7 begin select @CStatement74 =  ' if not exists (select 1 from '+ rtrim(@CMPNYNAM) + '..GL40200 where '	 select @CStatement75 = 'SGMNTID = '+char(39) + rtrim(@ACTNUMBR_8) +char(39) select @CStatement76 = ') and ' + char(39) + rtrim(@ACTNUMBR_8) + char(39) + '<> ' + char(39)+ char(39) select @CStatement77 = ' insert into '+ rtrim(@CMPNYNAM) + '..GL40200 (SGMTNUMB, SGMNTID, SEGCOUNT, NOTEINDX)' select @CStatement78 = ' select 8, '+char(39)+ rtrim(@ACTNUMBR_8) + char(39) + ' , 1, '+str(@NOTEINDX) select @CStatement79 = ' else ' select @CStatement80 = 'update '+ rtrim(@CMPNYNAM) + '..GL40200 set SEGCOUNT = SEGCOUNT + 1 where SGMTNUMB = 8 and SGMNTID = '+char(39)+rtrim(@ACTNUMBR_8)+char(39)   end if @MXSEG > 8 begin select @CStatement81 =  ' if not exists (select 1 from '+ rtrim(@CMPNYNAM) + '..GL40200 where '	 select @CStatement82 = 'SGMNTID = '+char(39) + rtrim(@ACTNUMBR_9) +char(39) select @CStatement83 = ') and ' + char(39) + rtrim(@ACTNUMBR_9) + char(39) + '<> ' + char(39)+ char(39) select @CStatement84 = ' insert into '+ rtrim(@CMPNYNAM) + '..GL40200 (SGMTNUMB, SGMNTID, SEGCOUNT, NOTEINDX)' select @CStatement85 = ' select 9, '+char(39)+ rtrim(@ACTNUMBR_9) + char(39) + ' , 1, '+str(@NOTEINDX) select @CStatement86 = ' else ' select @CStatement87 = 'update '+ rtrim(@CMPNYNAM) + '..GL40200 set SEGCOUNT = SEGCOUNT + 1 where SGMTNUMB = 9 and SGMNTID = '+char(39)+rtrim(@ACTNUMBR_9)+char(39)   end if @MXSEG > 9 begin select @CStatement88 =  ' if not exists (select 1 from '+ rtrim(@CMPNYNAM) + '..GL40200 where '	 select @CStatement89 = 'SGMNTID = '+char(39) + rtrim(@ACTNUMBR_10) +char(39) select @CStatement90 = ') and ' + char(39) + rtrim(@ACTNUMBR_10) + char(39) + '<> ' + char(39)+ char(39) select @CStatement91 = ' insert into '+ rtrim(@CMPNYNAM) + '..GL40200 (SGMTNUMB, SGMNTID, SEGCOUNT, NOTEINDX)' select @CStatement92 = ' select 10, '+char(39)+ rtrim(@ACTNUMBR_10) + char(39) + ' , 1, '+str(@NOTEINDX) select @CStatement93 = ' else ' select @CStatement94 = 'update '+ rtrim(@CMPNYNAM) + '..GL40200 set SEGCOUNT = SEGCOUNT + 1 where SGMTNUMB = 10 and SGMNTID = '+char(39)+rtrim(@ACTNUMBR_10)+char(39)   end exec ( @CStatement25 + @CStatement26 + @CStatement27 + @CStatement28 + @CStatement29 + @CStatement30 + @CStatement31 + @CStatement32 + @CStatement33 + @CStatement34 + @CStatement35 + @CStatement36 + @CStatement37 + @CStatement38 + @CStatement39 + @CStatement40 + @CStatement41 + @CStatement42 + @CStatement43 + @CStatement44 + @CStatement45 + @CStatement46 + @CStatement47 + @CStatement48 + @CStatement49 + @CStatement50 + @CStatement51 + @CStatement52 + @CStatement53 + @CStatement54 + @CStatement55 + @CStatement56 + @CStatement57 + @CStatement58 + @CStatement59 + @CStatement60 + @CStatement61 + @CStatement62 + @CStatement63 + @CStatement64 + @CStatement65 + @CStatement66 + @CStatement67 + @CStatement68 + @CStatement69 + @CStatement70 + @CStatement71 + @CStatement72 + @CStatement73 + @CStatement74 + @CStatement75 + @CStatement76 + @CStatement77 + @CStatement78 + @CStatement79 + @CStatement80 + @CStatement81 + @CStatement82 + @CStatement83 + @CStatement84 + @CStatement85 + @CStatement86 + @CStatement87 + @CStatement88 + @CStatement89 + @CStatement90 + @CStatement91 + @CStatement92 + @CStatement93 + @CStatement94 ) FETCH NEXT FROM TAParentInsertGL INTO @CMPNYNAM end DEALLOCATE TAParentInsertGL delete ##REPLMSTR where VALUE = @ACTNUMST and TYPE = 3 if exists( select 1 from tempdb..sysobjects where name = '##AccountIndex') drop table ##AccountIndex if exists( select 1 from tempdb..sysobjects where name = '##AccountIndex2') drop table ##AccountIndex2 end 
GO
GRANT EXECUTE ON  [dbo].[TA_ParentInsertGL] TO [DYNGRP]
GO
