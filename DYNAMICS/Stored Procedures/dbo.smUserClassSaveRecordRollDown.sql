SET QUOTED_IDENTIFIER OFF
GO
SET ANSI_NULLS ON
GO
 create procedure [dbo].[smUserClassSaveRecordRollDown]  @I_cUserClass   char(15) = NULL,  @I_iSQLSessionID        int = NULL,  @I_fALSChange tinyint = NULL,  @I_RelationID int = NULL,  @I_SecurityAccess binary(4) = NULL,  @O_iErrorState  int = NULL output as  declare  @tTransaction   tinyint,          @iCount         int               if @I_cUserClass is NULL  or @I_iSQLSessionID is NULL  or @I_fALSChange is NULL  or @I_RelationID is NULL  or @I_SecurityAccess is NULL  or @I_cUserClass = '' begin  select @O_iErrorState = 20237  return end  update  SY01400 set   RELID = CLASS.RELID from  SY40400 CLASS where  SY01400.USRCLASS = @I_cUserClass and  CLASS.USRCLASS = @I_cUserClass and  CLASS.RELID <> @I_RelationID  update  SY01400 set  SECACCS = CLASS.SECACCS from  SY40400 CLASS where  SY01400.USRCLASS = @I_cUserClass and  CLASS.USRCLASS = @I_cUserClass and  CLASS.SECACCS <> @I_SecurityAccess  if @I_fALSChange = 1 begin  if @tTransaction = 1  commit transaction  return end  if not exists(select  1  from   SY40400  where  USRCLASS = @I_cUserClass) begin  select @O_iErrorState = 20087  return end  select @O_iErrorState = 0,  @iCount = 0  if @@trancount = 0 begin  select @tTransaction = 1  begin transaction end  if exists(select   1   from   SY01400   where   USRCLASS = @I_cUserClass) begin  select  @iCount = count(REL.USERID)  from  SY40400 MAIN,  SY60100 REL,  SY01400 USERS  where  MAIN.USRCLASS = @I_cUserClass  and     USERS.USRCLASS = MAIN.USRCLASS  and     REL.USERID = USERS.USERID   if @iCount <> 0  begin   update   SY60100  set  SY60100.SRBCHSEC_1 = MAIN.SRBCHSEC_1,  SY60100.SRBCHSEC_2 = MAIN.SRBCHSEC_2,  SY60100.SRBCHSEC_3 = MAIN.SRBCHSEC_3,  SY60100.SRBCHSEC_4 = MAIN.SRBCHSEC_4,  SY60100.SRBCHSEC_5 = MAIN.SRBCHSEC_5,  SY60100.SRSFNSEC_1 = MAIN.SRSFNSEC_1,  SY60100.SRSFNSEC_2 = MAIN.SRSFNSEC_2,  SY60100.SRSFNSEC_3 = MAIN.SRSFNSEC_3,  SY60100.SRSFNSEC_4 = MAIN.SRSFNSEC_4,  SY60100.SRSFNSEC_5 = MAIN.SRSFNSEC_5,  SY60100.MSCPRMIS = MAIN.MSCPRMIS  from  SY40400 MAIN,  SY60100 ,  SY01400 USERS  where  MAIN.USRCLASS = @I_cUserClass  and     USERS.USRCLASS = MAIN.USRCLASS  and     SY60100.USERID = USERS.USERID   if @@rowcount <> @iCount  begin  if @tTransaction = 1  rollback transaction  select @O_iErrorState = 20259  return  end  end  end  if @tTransaction = 1  commit transaction  return   
GO
GRANT EXECUTE ON  [dbo].[smUserClassSaveRecordRollDown] TO [DYNGRP]
GO
