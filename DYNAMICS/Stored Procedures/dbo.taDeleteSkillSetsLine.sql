SET QUOTED_IDENTIFIER OFF
GO
SET ANSI_NULLS ON
GO
 create procedure [dbo].[taDeleteSkillSetsLine]  @I_vSKILLSET_I char(31),    @I_vSKILLTITLE_I char(31),    @I_vRequesterTrx smallint = 0,   @I_vUSRDEFND1 char(50) = '',      @I_vUSRDEFND2 char(50) = '',      @I_vUSRDEFND3 char(50) = '',      @I_vUSRDEFND4 varchar(8000) = '',  @I_vUSRDEFND5 varchar(8000) = '',  @O_iErrorState int output, @oErrString varchar(255) output  with encryption as  set transaction isolation level read uncommitted set nocount on  declare   @SKILLSETNUMBER_I smallint,  @SKILLNUMBER_I smallint,  @NUMBERAVAILABLE_I smallint,  @O_oErrorState int,  @iCustomState int,  @iCustomErrString varchar(255),  @iStatus int,      @iError int       select   @SKILLSETNUMBER_I = 0,   @SKILLNUMBER_I = 0,  @NUMBERAVAILABLE_I = 0,  @iCustomState = 0,  @O_oErrorState = 0,  @iCustomErrString = '',  @O_iErrorState = 0  if (@oErrString is null) begin  select @oErrString = '' end  exec @iStatus = taDeleteSkillSetsLinePre  @I_vSKILLSET_I output,  @I_vSKILLTITLE_I output,  @I_vRequesterTrx output,  @I_vUSRDEFND1 output,  @I_vUSRDEFND2 output,  @I_vUSRDEFND3 output,  @I_vUSRDEFND4 output,  @I_vUSRDEFND5 output,  @O_iErrorState  = @iCustomState output,  @oErrString = @iCustomErrString output  select @iError = @@error if ((@iStatus <> 0) or (@iCustomState <> 0) or (@iError <> 0)) begin  select @O_iErrorState = 11334    exec @iStatus = taUpdateString  @O_iErrorState,  @iCustomErrString,  @oErrString output,  @O_oErrorState output end  if ( @I_vSKILLSET_I is null or  @I_vSKILLTITLE_I is null or  @I_vRequesterTrx is null  ) begin  select @O_iErrorState = 11335    exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output end  if (@I_vSKILLSET_I = '') begin  select @O_iErrorState = 11336    exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output end  if (@I_vSKILLSET_I <> '') begin  if not exists(select 1 from DYNAMICS..HR2SKL05 (nolock) where SKILLSET_I = @I_vSKILLSET_I)  begin   select @O_iErrorState = 11337    exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output  end end  if (@I_vSKILLSET_I <> '') begin  select @SKILLSETNUMBER_I = SKILLSETNUMBER_I from DYNAMICS..HR2SKL05 (nolock) where SKILLSET_I = @I_vSKILLSET_I end   if (@I_vSKILLTITLE_I = '') begin  select @O_iErrorState = 11338    exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output end  if (@I_vSKILLTITLE_I <> '') begin  if not exists(select 1 from DYNAMICS..HR2SKL01 (nolock) where SKILLTITLE_I = @I_vSKILLTITLE_I)  begin   select @O_iErrorState = 11339    exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output  end end  if (@I_vSKILLTITLE_I <> '') begin  select @SKILLNUMBER_I = SKILLNUMBER_I from DYNAMICS..HR2SKL01 (nolock) where SKILLTITLE_I = @I_vSKILLTITLE_I end   if (@I_vSKILLSET_I <> '') and (@I_vSKILLTITLE_I <> '') begin   if not exists(select 1 from DYNAMICS..HR2SKL06 (nolock) where SKILLSETNUMBER_I = @SKILLSETNUMBER_I and SKILLNUMBER_I = @SKILLNUMBER_I)  begin   select @O_iErrorState = 11340    exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output  end end  if (@I_vRequesterTrx not in (0,1)) begin  select @O_iErrorState = 11341     exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output end  if (@O_iErrorState <> 0) begin  return (@O_iErrorState) end  delete DYNAMICS..HR2SKL06 where SKILLSETNUMBER_I = @SKILLSETNUMBER_I and SKILLNUMBER_I = @SKILLNUMBER_I if (@@error <> 0) begin  select @O_iErrorState = 11342    exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output  return (@O_iErrorState) end  select @NUMBERAVAILABLE_I = count(*) from DYNAMICS..HR2SKL06 (nolock) where SKILLSETNUMBER_I = @SKILLSETNUMBER_I  if @NUMBERAVAILABLE_I is null begin  select @NUMBERAVAILABLE_I = 0  end  update DYNAMICS..HR2SKL05 set NUMBERAVAILABLE_I = @NUMBERAVAILABLE_I where SKILLSETNUMBER_I = @SKILLSETNUMBER_I if (@@error <> 0) begin  select @O_iErrorState = 11344    exec @iStatus = taUpdateString  @O_iErrorState,  @oErrString,  @oErrString output,  @O_oErrorState output  return (@O_iErrorState) end  exec @iStatus = taDeleteSkillSetsLinePost  @I_vSKILLSET_I,  @I_vSKILLTITLE_I,  @I_vRequesterTrx,  @I_vUSRDEFND1,  @I_vUSRDEFND2,  @I_vUSRDEFND3,  @I_vUSRDEFND4,  @I_vUSRDEFND5,  @O_iErrorState  = @iCustomState output,  @oErrString = @iCustomErrString output  select @iError = @@error if ((@iStatus <> 0) or (@iCustomState <> 0) or (@iError <> 0)) begin  select @O_iErrorState = 11343    exec @iStatus = taUpdateString  @O_iErrorState,  @iCustomErrString,  @oErrString output,  @O_oErrorState output  return (@O_iErrorState) end  return (@O_iErrorState)   
GO
GRANT EXECUTE ON  [dbo].[taDeleteSkillSetsLine] TO [DYNGRP]
GO
