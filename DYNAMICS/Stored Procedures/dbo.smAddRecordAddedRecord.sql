SET QUOTED_IDENTIFIER OFF
GO
SET ANSI_NULLS ON
GO
 create procedure [dbo].[smAddRecordAddedRecord]  @I_iSQLSessionID        int             = NULL,  @I_cTableName           char(30)        = NULL,  @I_cRecordName          char(128)       = NULL,  @I_iFileType            int             = NULL,  @I_cProductName         char(30)        = NULL,  @I_cDBName char(5)         = NULL,  @O_tLogTurnedOff        tinyint         = NULL  output,  @O_iErrorState          int             = NULL  output  as  declare  @sCompanyID             smallint,  @iError int,  @iStatus                int,  @iIndex                 int,  @iNumber1               int,  @iNumber2               int,  @cSearchString1         char(2),  @cSearchString2         char(2),  @cUserID                char(15),  @cCompanyName           char(64),  @cMessage1              char(98),  @cUpdatedMessage        char(98),  @cSecurityDesc          char(98),  @sInquiryType           smallint,  @TRUE                   tinyint,  @FALSE                  tinyint,  @sDefaultDate char(12),  @sDefaultTime char(12)  if      @I_iSQLSessionID is NULL or  @I_cTableName is NULL or  @I_cRecordName is NULL or  @I_iFileType is NULL or  @I_cProductName is NULL begin  select  @O_iErrorState = 20861  return end  select  @TRUE   = 1,  @FALSE  = 0  exec @iStatus = smGetDefaultDate @sDefaultDate output exec @iStatus = smGetDefaultTime @sDefaultTime output  select  @O_iErrorState  =       0,  @O_tLogTurnedOff        =       @FALSE,  @cSearchString1 =       '%1',     @cSearchString2 =       '%2'      select  @cUserID        =       ACT.USERID,  @cCompanyName   =       ACT.CMPNYNAM,  @sCompanyID     =       COMP.CMPANYID from  dbo.ACTIVITY   ACT,  dbo.SY01500    COMP where  ACT.SQLSESID    =       @I_iSQLSessionID and  COMP.CMPNYNAM   =       ACT.CMPNYNAM  if exists (     select  1  from  dbo.SY60100  where  USERID          =       @cUserID        and  CMPANYID        =       @sCompanyID     and  TRKUSER         =       1) begin  if @I_iFileType = 1    begin  if exists (     select  1  from  dbo.SY04300  where  TRKFDEL =       1)   begin  select  @sInquiryType = 7  end  else  begin  select @O_tLogTurnedOff = @TRUE  return  end  end  else if @I_iFileType = 2    begin  if exists (     select  1  from  dbo.SY04300  where  TRKTRXDL        =       1)   begin  select  @sInquiryType = 18  end  else  begin  select @O_tLogTurnedOff = @TRUE  return  end  end  else if @I_iFileType = 3   begin  if exists (     select  1  from  dbo.SY04300  where  TRKSETDL        =       1)   begin  select  @sInquiryType = 21  end  else  begin  select @O_tLogTurnedOff = @TRUE  return  end  end  else   begin  select @O_iErrorState = 20862  return  end   exec @iStatus = dbo.smGetMsgString  11464,  @I_cDBName,  @cMessage1 output,  @O_iErrorState output   select @iError = @@error  if @iStatus = 0 and @iError <> 0  begin  select @iStatus = @iError  end   if @iStatus <> 0 or @O_iErrorState <> 0  return @iStatus   select @iIndex = charindex(@cSearchString1, @cMessage1)   select  @cUpdatedMessage = stuff(@cMessage1, @iIndex, 2, rtrim(@I_cTableName))   select  @iIndex = charindex(@cSearchString2, @cUpdatedMessage)   select  @cSecurityDesc = stuff(@cUpdatedMessage, @iIndex, 2,rtrim(@I_cRecordName))   insert  into  dbo.SY05000  ( INDEX1,  CMPNYNAM,  USERID,  INQYTYPE,  DATE1,  TIME1,  SECDESC,  PRODNAME )  values  (3,  @cCompanyName,  @cUserID,  @sInquiryType,  @sDefaultDate,  @sDefaultTime,  @cSecurityDesc,  @I_cProductName )   if @@RowCount <> 1  begin  select  @O_iErrorState = 20863  end end   else begin     select  @O_tLogTurnedOff = @TRUE end  return    
GO
GRANT EXECUTE ON  [dbo].[smAddRecordAddedRecord] TO [DYNGRP]
GO
